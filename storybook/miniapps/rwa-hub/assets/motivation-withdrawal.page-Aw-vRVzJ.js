import{r as i,j as t,f as I}from"./index-15D1tlVU.js";import{C as z,A as H}from"./nilai-dialog-YTWh9anD.js";import{O as A,P as k,Q as T,R as y,S as X,U as Y,V as Z,W as G,X as J,M as K,Y as tt,Z as et,_ as st,a0 as rt}from"./messages-T-UDpzuG.js";import{u as at}from"./use_flow-CkeMNJ0N.js";import{B}from"./dialog-DgNFENJS.js";import{L as it}from"./input-BLsA2pde.js";import{L as p}from"./list-item-CsDeqkSQ.js";import{N as ot}from"./navbar-DAOi6kaL.js";import{d as nt,g as lt,P as ct}from"./page-BL_iZuG4.js";import{u as mt}from"./use_refresh-BOPBhM6q.js";import{B as n}from"./big-Dt19vo1Q.js";import{L as ut}from"./list-C6l4Q3bV.js";import{P as dt}from"./preloader-DItl4yqJ.js";import{t as u,m as ht,b as pt}from"./dex-api-54xdAOHY.js";import"./use_easy_state-D4HEqK2h.js";import"./polyfills-BATEtbik.js";import"./list-C2Pi8W4W.js";const Lt=nt(({chainName:f,assetType:l,external_user_id:F,decimals:a,amount:w,..._})=>{const[L]=at(pt),[P,W]=i.useState(!0),[$,R]=i.useState(!1),[D,x]=i.useState(!1),[d,q]=i.useState("0"),[o,E]=i.useState(""),[h,j]=i.useState(""),v=i.useRef({withdrawal_ratio:["10","100"]}),b=lt(),c=(e,s)=>{const r=new n(e);return g(r.div(Math.pow(10,s)).toFixed(18),s)};function g(e,s=8,r=!1){const[m,V=""]=String(e).split("."),S=V.slice(0,s),C=S.length>0?`${m}.${S}`:m;return r?C:C.replace(/(?:\.0*|(\.\d+?)0+)$/,"$1")}i.useEffect(()=>{b.trpcClient.exchange.getExchangeWithdrawalConfig.query().then(e=>{W(!1),v.current=e,q(c("10",a))}).catch(e=>{throw u(String(e?.message||e)),e})},[]);const M=e=>{const s=v.current;if(!e||isNaN(+e))j("");else{e=n(e).mul(10**a).toString().split(".")[0];const r=BigInt(n(e).mul(s.withdrawal_ratio[0]).div(s.withdrawal_ratio[1]).round(0,n.roundUp).toString()),m=BigInt(1);j(m>r?m.toString():r.toString())}},U=async()=>{I.preloader.show();try{await b.trpcClient.motivation.withdrawal.mutate({chain:f,assetType:l,amount:n(o).mul(10**a).toString().split(".")[0],external_user_id:F}),x(!1),u(rt()),ht.emit({success:!0}),_.safeF7Navigater.motivationWithdrawalList({reloadCurrent:!0})}catch(e){throw u(String(e)),e}finally{I.preloader.hide()}},O=mt(),N=e=>{let s=e?g(e,a,!0):"";if(s){const r=c(w,a);n(r).lt(s)&&(s=r),s=g(s,8,!0)}M(s),E(s),O()},Q=e=>{const s=(e.target?.value||"").trim();N(s)};return t.jsxs(ct,{name:"withdrawal",style:{"--f7-toolbar-bottom-height":"3.25rem"},children:[t.jsx(ot,{title:A(),backLink:!0}),t.jsx("div",{className:"bg-gray min-h-full w-full pt-5",children:P?t.jsx(dt,{size:32,className:"mx-auto mt-0 !block",color:"black"}):t.jsxs(t.Fragment,{children:[t.jsxs(ut,{strongIos:!0,dividersIos:!0,insetIos:!0,className:"mt-0",children:[t.jsxs(it,{type:"number",value:o,placeholder:k(),onChange:Q,children:[t.jsxs("div",{slot:"label",className:"text-text",children:[T(),d&&t.jsxs(t.Fragment,{children:["(",y({amount:d,assetType:l}),")"]})]}),t.jsx(B,{slot:"input",className:"text-gradient absolute right-0 top-1",onClick:()=>N(c(w,a)),children:X()})]}),t.jsxs(p,{children:[t.jsx("div",{slot:"header",className:"text-text",children:Y()}),t.jsxs("div",{slot:"title",children:[h?c(h,a):"--"," ",t.jsx("span",{className:"text-sm",children:l})]})]}),t.jsx(p,{title:f,children:t.jsx("div",{slot:"header",className:"text-text",children:Z()})}),t.jsx(p,{title:l,children:t.jsx("div",{slot:"header",className:"text-text",children:G()})}),t.jsxs(p,{children:[t.jsx("div",{slot:"header",className:"text-text",children:J()}),t.jsx("div",{slot:"title",className:"text-wrap break-all",children:L.addressList.find(e=>e.chainName===f)?.address})]})]}),t.jsx(B,{className:"mx-5 bg-primary py-5 text-lg !text-white",onClick:()=>{if(!o||isNaN(+o)){u(k());return}if(+o<=+d){u(y({amount:d,assetType:l}));return}x(!0)},children:A()})]})}),t.jsx(z,{open:D,title:tt(),confirmText:K(),onRequireClose:()=>{x(!1)},onConfirmCallback:()=>U(),children:t.jsxs("div",{children:[o&&h&&n(o).minus(c(h,a)).toString()," ",l]})}),t.jsx(H,{open:$,onRequireClose:()=>{R(!1),_.f7router.back()},title:st(),children:et()})]})});export{Lt as default};
