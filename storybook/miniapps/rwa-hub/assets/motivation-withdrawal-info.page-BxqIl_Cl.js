import{r as h,j as e,f as g,R as y}from"./index-AshhoVut.js";import"./pull-to-refresh-BEcMoqjd.js";import{N as b,a as N}from"./navbar-CWXVbsHK.js";import{d as w,P as _,g as v}from"./page-BnBmgj2e.js";import{N as L,g as W,a as T}from"./icon.component-Bbnu8uvo.js";import{L as C}from"./loading-page-data-6-Awkqnm.js";import{N as I}from"./no-data-C6uCQg27.js";import{A as j}from"./nilai-dialog-Dbtzo5f5.js";import{f as p,a as x}from"./asset-type-balance-BGw1Ilcq.js";import{u as f}from"./use_easy_state-BCfQ0rqw.js";import{L as A}from"./list-item-C_pVthwN.js";import{L as R}from"./list-DTz1iW3n.js";import{u as k}from"./use_page_query_state-Dd2x2gMX.js";import{u as P}from"./use_refresh-BXPRqJ_V.js";import{m as E}from"./dex-api-WCaY78Dk.js";import{g as F}from"./setting.page-Cw2AtfIG.js";import"./messages-D1uWWbBR.js";import"./preloader-Cr80DtbA.js";import"./dialog-w37VgwE_.js";import"./big-Dt19vo1Q.js";import"./use_flow-Buvyb0TW.js";import"./noop-ChEnm3CV.js";const le=w(t=>{h.useEffect(()=>{const s=E(c=>{c.success&&i.loadFirst()});return()=>{s()}},[]);const r=f({open:!1,text:""}),l=async s=>{g.preloader.show();try{const u=await a.trpcClient.motivation.getWithdrawalStatus.query({...s,chain:s.chainName});if(BigInt(u.useWithdrawal)>=BigInt(u.quota)){r.value={open:!0,text:`您当前等级（Lv.${u.level}）的该奖励类型提现额度已达上限${u.canUp?"，您可以升级后来提升提取额度上限":""}`};return}}finally{g.preloader.hide()}const{assetType:c,chainName:d,amount:n}=s;t.safeF7Navigater.motivationWithdrawal({props:{chainName:d,assetType:c,decimals:8,amount:n,external_user_id:s.external_user_id}})},m=h.useRef({el:null});P();const a=v(),i=k([],1,async(s,c)=>{const d=await a.trpcClient.motivation.getUserAssetWithdrawalMotivationList.query({page:c,pageSize:20});s.push(...d.data.map(u=>({...u})));const n=s;return{content:n,nextPage:c+1,end:n.length>=d.total}});h.useEffect(()=>{i.loadFirst()},[]);const o=async s=>{await i.loadFirst(),i.onPtrRefresh(s)};return e.jsxs(_,{name:"exchange-withdrawal",style:{"--f7-page-toolbar-bottom-offset":"0"},ref:m,onPtrRefresh:o,...i.f7PageInfiniteProps,children:[e.jsx(b,{title:"每日激励领取",className:"text-white !filter-none",backLink:!0,color:"white",style:{"--f7-bars-bg-color-rgb":"100,15,243","--f7-bars-border-color":"transparent"},children:e.jsx(N,{children:e.jsx("div",{onClick:()=>{t.safeF7Navigater.motivationWithdrawalList()},children:e.jsx(L,{className:"icon-7",name:"common-order"})})})}),e.jsx("div",{className:"min-h-full bg-white p-4 pb-[5rem]",children:i.render({loading:()=>e.jsx(C,{}),listEmpty:()=>e.jsx(I,{}),listItem:(s,c,d)=>e.jsx("div",{className:"mb-3",onClick:()=>{},children:e.jsx(S,{info:s,...t,goMoticationWithdrawal:(...n)=>l(...n)})},s.external_user_id)})}),e.jsx(j,{open:r.value.open,title:"注意",confirmText:"好的",onRequireClose:()=>{r.value={open:!1,text:""}},onConfirmCallback:()=>{r.value={open:!1,text:""}},children:r.value.text})]})}),D=({open:t,onClose:r,quotas:l,assetType:m})=>e.jsx(j,{open:t,onRequireClose:r,title:`${m} 提现额度详情`,confirmText:"好的",onConfirmCallback:r,children:e.jsx(R,{children:l.slice().sort((a,i)=>a.level-i.level).map(a=>e.jsx(A,{title:`等级 ${a.level}`,after:`${x(a.quota,8,!1)}`},a.level))})}),q=({item:t,goMoticationWithdrawal:r})=>{const l=F(),m=v(),a=f(null),i=f(!1),o=f([]);return h.useEffect(()=>{m.trpcClient.motivation.getWithdrawalStatus.query({external_user_id:t.external_user_id,assetType:t.assetType,chain:t.chain}).then(s=>{a.value=s})},[t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"mb-2 flex items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:W(t.assetType,t.chain),alt:"",className:"h-9 w-9"}),e.jsx("img",{src:T(t.chain),alt:"",className:"absolute -bottom-1 -right-0.5 h-5 w-5"})]}),e.jsxs("div",{className:"mx-2",children:[e.jsx("div",{className:"text-base font-bold text-title",children:t.assetType}),e.jsx("div",{className:"text-xs text-subtext",children:t.chain})]}),e.jsx("div",{className:"ml-auto flex items-end justify-end text-sm text-title",children:e.jsx("span",{className:"inline-block rounded-3 bg-primary px-2 py-1 !text-white",onClick:()=>r({assetType:t.assetType,chainName:t.chain,amount:t.amount,external_user_id:t.external_user_id}),children:"提取"})})]}),e.jsxs("div",{className:"ml-auto flex flex-col items-end justify-end text-right text-sm text-text",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-end",children:["可提取量:",e.jsx("span",{className:"ml-1 text-primary",children:p(x(t.amount,8,l))})]}),e.jsxs("div",{className:"mb-1 flex items-center justify-end",children:["激励总量:",e.jsx("span",{className:"ml-1",children:p(x(t.total,8,l))})]}),e.jsxs("div",{className:"mb-1 flex items-center justify-end",children:["已提取量:",e.jsx("span",{className:"ml-1",children:p(x(t.use,8,l))})]})]})]}),e.jsx(D,{open:i.value,onClose:()=>i.value=!1,quotas:o.value,assetType:t.assetType})]})},S=({info:t,safeF7Navigater:r,goMoticationWithdrawal:l,...m})=>{const a=[];return Object.keys(t.assets).forEach(o=>{const s=t.assets[o];s&&Object.keys(s).forEach(d=>{const n=s[d];n&&a.push({assetType:d,chain:o,amount:n.effectiveWithdrawal,total:n.totalWithdrawal,use:n.useWithdrawal,external_user_id:t.external_user_id})})}),e.jsx("div",{className:"card_bg bg-gray rounded-4 p-4",children:e.jsx("div",{className:"rounded-3 bg-grey",children:e.jsx("div",{className:"rounded-3 bg-white px-2 py-3",children:a.map((o,s)=>e.jsxs(y.Fragment,{children:[e.jsx(q,{item:o,goMoticationWithdrawal:l}),s<a.length-1&&e.jsx("div",{className:"my-3 w-full border-b-tiny border-solid border-title/20"})]},o.assetType))})})})};export{S as UserWithdrawalMotivationItem,le as default};
