import{g as D}from"./address-CwlnRuVT.js";import{a as N,$ as O,g as B}from"./signature-MTDex1F4.js";import{a as f}from"./page-BnBmgj2e.js";import{b as d}from"./bridge-DyWekW1m.js";import{b as K,c as P,d as U,f as $,g as q,a as W}from"./noop-ChEnm3CV.js";import"./index-AshhoVut.js";async function b(e,t,n,o){return d("bio_requestCryptoToken",{actions:e,duration:t,address:n,chainId:o})}async function g(e,t){return d("bio_getCryptoTokenInfo",{tokenId:e,sessionSecret:t})}async function A(e,t,n,o){return d("bio_cryptoExecute",{tokenId:e,sessionSecret:t,action:"asymmetricEncrypt",params:{data:n,recipientPublicKey:o}})}const m="bio_crypto_token_cache";function w(){try{const e=localStorage.getItem(m);return e?JSON.parse(e):null}catch{return null}}function x(e){localStorage.setItem(m,JSON.stringify(e))}function E(){localStorage.removeItem(m)}function T(e){if(typeof e=="string")return e;if(e&&typeof e=="object"&&"type"in e&&"data"in e){const t=e;if(t.type==="Buffer"&&Array.isArray(t.data))return f.from(t.data).toString("hex")}if(Array.isArray(e)||e instanceof Uint8Array)return f.from(e).toString("hex");if(f.isBuffer(e))return e.toString("hex");throw new Error(`Invalid input format: ${typeof e}`)}async function C(e){const t=T(e),n=["bfmeta","bfchainv2","bioforest","bfmchain","bfchain"],o=await d("bio_requestAccounts",{chain:"bfmeta"});if(!o||o.length===0)throw new Error("No accounts available");const s=o.find(r=>{const y=r.chain.toLowerCase();return n.includes(y)});if(!s){const r=o.map(y=>y.chain).join(", ");throw new Error(`BFMeta account not found. Available chains: ${r}`)}let c,i;const a=w();if(a&&a.address===s.address&&a.expiresAt>Date.now())try{const r=await g(a.tokenId,a.sessionSecret);r.valid&&r.address===s.address&&(c=a.tokenId,i=a.sessionSecret)}catch{}if(!c||!i){E();const r=await b(["asymmetricEncrypt"],"1day",s.address,s.chain);c=r.tokenId,i=r.sessionSecret,x({tokenId:c,sessionSecret:i,address:r.address,expiresAt:r.expiresAt})}const p=Date.now().toString(),{result:u,publicKey:l,address:h}=await A(c,i,p,t);return{address:h,publicKey:f.from(l,"hex"),signcode:f.from(u,"hex")}}export{N as $WALLET_PLAOC_PATH,O as $WALLET_SIGNATURE_TYPE,K as appVersionUpdate,A as asymmetricEncrypt,P as canOpenUrl,U as dwebAppConfig,$ as focusWindow,q as getDwebAppDownUrl,B as getExternalAppData,D as getWalleterAddresss,W as gotoDwebAppMarketDownLoad,b as requestCryptoToken,C as rwaLogin};
