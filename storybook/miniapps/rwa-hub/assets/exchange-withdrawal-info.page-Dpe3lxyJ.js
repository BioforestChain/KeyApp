import{r as g,j as e,f as _}from"./index-15D1tlVU.js";import{N as I}from"./messages-T-UDpzuG.js";import"./pull-to-refresh-BMqB5p-4.js";import{N as T,a as k}from"./navbar-DAOi6kaL.js";import{d as P,P as C,g as L}from"./page-BL_iZuG4.js";import{N as F,g as N,a as b}from"./icon.component-DqZ9lCdm.js";import{L as W}from"./loading-page-data-CCKDne7Y.js";import{N as A}from"./no-data-CDzRffdr.js";import{A as R}from"./nilai-dialog-YTWh9anD.js";import{z as D}from"./organization-profile.model-CAD2aKmP.js";import{f,a as p}from"./asset-type-balance-BGw1Ilcq.js";import{f as y}from"./date-time-format-CBKMROy6.js";import{u as U}from"./use_easy_state-D4HEqK2h.js";import{u as E}from"./use_flow-CkeMNJ0N.js";import{u as B}from"./use_page_query_state-DR-eHdQu.js";import{u as S}from"./use_refresh-BOPBhM6q.js";import{B as q}from"./big-Dt19vo1Q.js";import{w as z}from"./clipboard-C2H4uUqf.js";import{j as H,b as M,t as $}from"./dex-api-54xdAOHY.js";import{g as O}from"./setting.page-DIHCe7FA.js";import"./polyfills-BATEtbik.js";import"./preloader-DItl4yqJ.js";import"./dialog-DgNFENJS.js";import"./list-item-CsDeqkSQ.js";import"./list-C2Pi8W4W.js";import"./noop-ChEnm3CV.js";const Ne=P(n=>{g.useEffect(()=>{const t=H(l=>{l.success&&r.loadFirst()});return()=>{t()}},[]);const[w]=E(M),c=U({open:!1,text:""}),v=async(t,l)=>{_.preloader.show();try{const x=await s.trpcClient.exchange.getWithdrawalStatus.query({...t,chain:t.chainName});if(BigInt(x.useWithdrawal)>=BigInt(x.quota)){c.value={open:!0,text:`您当前等级（Lv.${x.level}）的该奖励类型提现额度已达上限${x.canUp?"，您可以升级后来提升提取额度上限":""}`};return}}finally{_.preloader.hide()}const{assetType:d,chainName:o,amount:m}=t;n.safeF7Navigater.exchangeWithdrawal({props:{chainName:o,assetType:d,decimals:8,amount:m,type:l,exchangeInfo:t.exchangeInfo,exchangeId:t.exchangeId,external_user_id:t.external_user_id}})},j=g.useRef({el:null});S();const s=L(),r=B([],1,async(t,l)=>{const d=await s.trpcClient.exchange.getUserAssetWithdrawalExchangeList.query({page:l,pageSize:20});t.push(...d.data.map(m=>({...m})));const o=t;return{content:o,nextPage:l+1,end:o.length>=d.total}});g.useEffect(()=>{r.loadFirst()},[]);const i=async t=>{await r.loadFirst(),r.onPtrRefresh(t)};return e.jsxs(C,{name:"exchange-withdrawal",style:{"--f7-page-toolbar-bottom-offset":"0"},ref:j,...r.f7PagePtrProps,onPtrRefresh:i,...r.f7PageInfiniteProps,children:[e.jsx(T,{title:"兑换奖励",className:"text-white !filter-none",backLink:!0,color:"white",style:{"--f7-bars-bg-color-rgb":"100,15,243","--f7-bars-border-color":"transparent"},children:e.jsx(k,{children:e.jsx("div",{onClick:()=>{n.safeF7Navigater.exchangeWithdrawalList()},children:e.jsx(F,{className:"icon-7",name:"common-order"})})})}),e.jsx("div",{className:"min-h-full bg-white p-4 pb-[5rem]",children:r.render({loading:()=>e.jsx(W,{}),listEmpty:()=>e.jsx(A,{}),listItem:(t,l,d)=>e.jsx("div",{className:"mb-3",onClick:()=>{},children:e.jsx(Q,{userWithdrawalExchange:t,...n,goWithdrawal:(...o)=>v(...o)})},t.exchangeId)})}),e.jsx(R,{open:c.value.open,title:"注意",confirmText:"好的",onRequireClose:()=>{c.value={open:!1,text:""}},onConfirmCallback:()=>{c.value={open:!1,text:""}},children:c.value.text})]})}),Q=({userWithdrawalExchange:n,safeF7Navigater:w,goWithdrawal:c,...v})=>{const j=async a=>{await z(a),$(I())},s=n.exchangeInfo;switch(s.status,s.status){case D.enum.chain_error:break}const r=Date.now();s.start_at&&s.start_at<r&&s.end_at&&s.end_at<r,s.start_at&&s.start_at>r,s.start_at&&s.start_at<=r&&s.end_at&&s.end_at>r;const i=s.airdrop_info.chain_name,t=s.airdrop_info.withdrawal_asset_type.assetType,l=n.assets[i][t]?.effectiveWithdrawal||"0",d=n.assets[i][t]?.totalWithdrawal||"0",o=n.assets[i][t]?.useWithdrawal||"0",m=new Map;s.airdrop_info.withdrawal_or_u_asset_type_list.forEach(a=>{let u=m.get(a.assetType);u||m.set(a.assetType,u={assetType:a.assetType,amount:n.assets[i][a.assetType]?.effectiveWithdrawal||"0",total:n.assets[i][a.assetType]?.totalWithdrawal||"0",use:n.assets[i][a.assetType]?.useWithdrawal||"0"})});const x=[...m.values()],h=O();return e.jsxs("div",{className:"card_bg bg-gray rounded-4 p-4",children:[e.jsxs("div",{className:"mb-4 flex items-center text-sm",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:N(s.exchange_info.asset_type,s.exchange_info.chainName),alt:"",className:"h-9 w-9"}),e.jsx("img",{src:b(s.exchange_info.chainName),alt:"",className:"absolute -bottom-1 -right-0.5 h-5 w-5"})]}),e.jsxs("div",{className:"mx-2",children:[e.jsx("div",{className:"text-base font-bold text-title",children:s.exchange_info.asset_type}),e.jsx("div",{className:"text-xs text-subtext",children:s.exchange_info.chainName})]}),e.jsxs("div",{className:"ml-auto flex flex-col items-center justify-end",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between text-xs text-text",children:[e.jsx("div",{children:"开始时间:"}),e.jsx("div",{className:"text-title",children:y(s.start_at)})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-text",children:[e.jsx("div",{children:"结束时间:"}),e.jsx("div",{className:"text-title",children:y(s.end_at)})]})]})]}),e.jsxs("div",{className:"mb-2 flex items-center justify-between text-text",children:[e.jsx("div",{children:"兑换ID"}),e.jsx("div",{className:"text-xs text-subtext",onClick:()=>{j(s.id)},children:s.id})]}),e.jsxs("div",{className:"mt-5 rounded-3 bg-grey",children:[e.jsx("div",{className:"mb-3 text-base font-bold text-title",children:"空投奖励"}),e.jsxs("div",{className:"rounded-3 bg-white px-2 py-3",children:[q(s.airdrop_info.withdrawal_asset_type.ratio).lt(0)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"mb-2 flex items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:N(t,i),alt:"",className:"h-9 w-9"}),e.jsx("img",{src:b(i),alt:"",className:"absolute -bottom-1 -right-0.5 h-5 w-5"})]}),e.jsxs("div",{className:"mx-2",children:[e.jsx("div",{className:"text-base font-bold text-title",children:t}),e.jsx("div",{className:"text-xs text-subtext",children:i})]}),e.jsx("div",{className:"ml-auto flex items-start justify-end",children:e.jsx("span",{className:"inline-block rounded-3 bg-primary px-4 py-1 !text-white",onClick:()=>c({assetType:t,chainName:i,exchangeInfo:s,amount:l,exchangeId:s.id,external_user_id:s.external_user_id},"withdrawal"),children:"提取"})})]}),e.jsxs("div",{className:"ml-auto flex flex-col items-end justify-end text-right text-sm text-text",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-end",children:["可提取量:",e.jsx("span",{className:"ml-1 text-primary",children:f(p(l,8,h))})]}),e.jsxs("div",{className:"mb-1 flex items-center justify-end",children:["空投总量:",e.jsx("span",{className:"ml-1",children:f(p(d,8,h))})]}),e.jsxs("div",{className:"mb-1 flex items-center justify-end",children:["已提取量:",e.jsx("span",{className:"ml-1",children:f(p(o,8,h))})]})]})]})}),e.jsx("div",{className:"my-3 w-full border-b-tiny border-solid border-title/20"})]}),x.map((a,u)=>e.jsxs("div",{children:[e.jsx("div",{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"mb-2 flex items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:N(a.assetType,i),alt:"",className:"h-9 w-9"}),e.jsx("img",{src:b(i),alt:"",className:"absolute -bottom-1 -right-0.5 h-5 w-5"})]}),e.jsxs("div",{className:"mx-2",children:[e.jsx("div",{className:"text-base font-bold text-title",children:a.assetType}),e.jsx("div",{className:"text-xs text-subtext",children:i})]}),e.jsxs("div",{className:"ml-auto flex items-start justify-end",children:[e.jsx("span",{className:"inline-block rounded-3 bg-primary px-4 py-1 !text-white",onClick:()=>c({assetType:a.assetType,chainName:i,amount:a.amount,exchangeInfo:s,exchangeId:s.id,external_user_id:s.external_user_id},"exchange"),children:"兑换"}),e.jsx("span",{className:"ml-4 inline-block rounded-3 bg-primary px-4 py-1 !text-white",onClick:()=>c({assetType:a.assetType,chainName:i,amount:a.amount,exchangeInfo:s,exchangeId:s.id,external_user_id:s.external_user_id},"withdrawal"),children:"提取"})]})]}),e.jsxs("div",{className:"ml-auto flex flex-col items-end justify-end text-right text-sm text-text",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-end",children:["可提取量:",e.jsx("span",{className:"ml-1 text-primary",children:f(p(a.amount,8,h))})]}),e.jsxs("div",{className:"mb-1 flex items-center justify-end",children:["空投总量:",e.jsx("span",{className:"ml-1",children:f(p(a.total,8,h))})]}),e.jsxs("div",{className:"mb-1 flex items-center justify-end",children:["已提取量:",e.jsx("span",{className:"ml-1",children:f(p(a.use,8,h))})]})]})]})}),u<x.length-1&&e.jsx("div",{className:"my-3 w-full border-b-tiny border-solid border-title/20"})]},u))]})]})]})};export{Q as UserWithdrawalExchangeItem,Ne as default};
