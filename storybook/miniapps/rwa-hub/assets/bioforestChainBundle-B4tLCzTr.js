const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/_setup-C2ViQuRv.js","assets/_setup-B7UtBVWE.js","assets/sha256-Ckoyw2Ta.js","assets/WASMInterface-DAdCfnXY.js","assets/page-BnBmgj2e.js","assets/index-AshhoVut.js","assets/index-Cw9OXGwa.css","assets/page-BlSCKfpT.css","assets/ripemd160-5KCgQPR7.js","assets/sha1-CsgZsmbN.js","assets/address-B2LfIEKg.js","assets/networks-ZN7vFv_C.js","assets/script-DijuLAta.js","assets/ops-CO93g0rg.js","assets/typeforce-DQh4knDl.js","assets/index-BjnbLYBu.js","assets/crypto-B0d8PDDp.js","assets/index-D4djhYCF.js","assets/p2pk-1FI4sERP.js","assets/psbt-CHSpNG6y.js","assets/_setup-zqfuA-N7.js","assets/index-B_g-nPjg.js","assets/_setup-B6z42WBz.js","assets/sha512-CPFx-amr.js","assets/wordlists-CYL0orSr.js","assets/index-CtgQB5yp.js","assets/pbkdf2-B6oUcX6E.js","assets/hmac-3RKFvTu5.js","assets/_setup-CC-nphxM.js","assets/bip32-ieQFI03k.js","assets/index-DgJWgfZj.js","assets/_setup-DEVovPQB.js","assets/ecpair-C_48lQHW.js","assets/index-xdEahPYM.js","assets/_setup-C1uiVZaq.js","assets/sha3-FsGMCJNB.js","assets/index-DSbz8f8f.js","assets/keccak-BB9nICn0.js","assets/index-D6oW2-lj.js"])))=>i.map(i=>d[i]);
import{a2 as _s,a as ho}from"./page-BnBmgj2e.js";import{_ as qt,Z as IE,N as qd}from"./index-AshhoVut.js";var tf=function(e,t){return tf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},tf(e,t)};function YI(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");tf(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var rf=function(){return rf=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},rf.apply(this,arguments)};function QI(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r}function u(e,t,r,n){var s=arguments.length,i=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}function Ce(e,t){return function(r,n){t(r,n,e)}}function XI(e,t,r,n,s,i){function o(C){if(C!==void 0&&typeof C!="function")throw new TypeError("Function expected");return C}for(var a=n.kind,p=a==="getter"?"get":a==="setter"?"set":"value",l=!t&&e?n.static?e:e.prototype:null,h=t||(l?Object.getOwnPropertyDescriptor(l,n.name):{}),y,A=!1,_=r.length-1;_>=0;_--){var E={};for(var T in n)E[T]=T==="access"?{}:n[T];for(var T in n.access)E.access[T]=n.access[T];E.addInitializer=function(C){if(A)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(C||null))};var w=(0,r[_])(a==="accessor"?{get:h.get,set:h.set}:h[p],E);if(a==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(y=o(w.get))&&(h.get=y),(y=o(w.set))&&(h.set=y),(y=o(w.init))&&s.push(y)}else(y=o(w))&&(a==="field"?s.push(y):h[p]=y)}l&&Object.defineProperty(l,n.name,h),A=!0}function WI(e,t,r){for(var n=arguments.length>2,s=0;s<t.length;s++)r=n?t[s].call(e,r):t[s].call(e);return n?r:void 0}function qI(e){return typeof e=="symbol"?e:"".concat(e)}function ZI(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function g(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function eT(e,t,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(h){try{l(n.next(h))}catch(y){o(y)}}function p(h){try{l(n.throw(h))}catch(y){o(y)}}function l(h){h.done?i(h.value):s(h.value).then(a,p)}l((n=n.apply(e,t||[])).next())})}function tT(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(h){return p([l,h])}}function p(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(r=0)),r;)try{if(n=1,s&&(i=l[0]&2?s.return:l[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){r.label=l[1];break}if(l[0]===6&&r.label<i[1]){r.label=i[1],i=l;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(l);break}i[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(h){l=[6,h],s=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var Zd=Object.create?function(e,t,r,n){n===void 0&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};function rT(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&Zd(t,e,r)}function nf(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function TE(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),s,i=[],o;try{for(;(t===void 0||t-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function nT(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(TE(arguments[t]));return e}function sT(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),s=0,t=0;t<r;t++)for(var i=arguments[t],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function iT(e,t,r){if(r||arguments.length===2)for(var n=0,s=t.length,i;n<s;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))}function ap(e){return this instanceof ap?(this.v=e,this):new ap(e)}function oT(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(A){n[A]&&(s[A]=function(_){return new Promise(function(E,T){i.push([A,_,E,T])>1||a(A,_)})})}function a(A,_){try{p(n[A](_))}catch(E){y(i[0][3],E)}}function p(A){A.value instanceof ap?Promise.resolve(A.value.v).then(l,h):y(i[0][2],A)}function l(A){a("next",A)}function h(A){a("throw",A)}function y(A,_){A(_),i.shift(),i.length&&a(i[0][0],i[0][1])}}function aT(e){var t,r;return t={},n("next"),n("throw",function(s){throw s}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(s,i){t[s]=e[s]?function(o){return(r=!r)?{value:ap(e[s](o)),done:!1}:i?i(o):o}:i}}function cT(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof nf=="function"?nf(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(o){return new Promise(function(a,p){o=e[i](o),s(a,p,o.done,o.value)})}}function s(i,o,a,p){Promise.resolve(p).then(function(l){i({value:l,done:a})},o)}}function pT(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var hT=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function lT(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&Zd(t,e,r);return hT(t,e),t}function uT(e){return e&&e.__esModule?e:{default:e}}function gT(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function fT(e,t,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r}function dT(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}const yT=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return rf},__asyncDelegator:aT,__asyncGenerator:oT,__asyncValues:cT,__await:ap,__awaiter:eT,__classPrivateFieldGet:gT,__classPrivateFieldIn:dT,__classPrivateFieldSet:fT,__createBinding:Zd,__decorate:u,__esDecorate:XI,__exportStar:rT,__extends:YI,__generator:tT,__importDefault:uT,__importStar:lT,__makeTemplateObject:pT,__metadata:g,__param:Ce,__propKey:qI,__read:TE,__rest:QI,__runInitializers:WI,__setFunctionName:ZI,__spread:nT,__spreadArray:iT,__spreadArrays:sT,__values:nf},Symbol.toStringTag,{value:"Module"})),Bm=new WeakMap;function ai(e,t,r){if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @cacheBytesGetter. <${t}> is not a method!`);const n=r.value,s=function(...i){if(Object.isFrozen(this)){const o=JSON.stringify(i);let a=Bm.get(this);a||(a=new Map,Bm.set(this,a));let p=a.get(o);return p||(p=n.apply(this,i),a.set(o,p)),p}return n.apply(this,i)};return r.value=s,r}var Zc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof _s<"u"?_s:typeof self<"u"?self:{};function Go(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function mT(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){if(this instanceof n){var s=[null];s.push.apply(s,arguments);var i=Function.bind.apply(t,s);return new i}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var bE={};(function(e){var t=e;t.length=function(o){var a=o.length;if(!a)return 0;for(var p=0;--a%4>1&&o.charAt(a)==="=";)++p;return Math.ceil(o.length*3)/4-p};for(var r=new Array(64),n=new Array(123),s=0;s<64;)n[r[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;t.encode=function(o,a,p){for(var l=null,h=[],y=0,A=0,_;a<p;){var E=o[a++];switch(A){case 0:h[y++]=r[E>>2],_=(E&3)<<4,A=1;break;case 1:h[y++]=r[_|E>>4],_=(E&15)<<2,A=2;break;case 2:h[y++]=r[_|E>>6],h[y++]=r[E&63],A=0;break}y>8191&&((l||(l=[])).push(String.fromCharCode.apply(String,h)),y=0)}return A&&(h[y++]=r[_],h[y++]=61,A===1&&(h[y++]=61)),l?(y&&l.push(String.fromCharCode.apply(String,h.slice(0,y))),l.join("")):String.fromCharCode.apply(String,h.slice(0,y))};var i="invalid encoding";t.decode=function(o,a,p){for(var l=p,h=0,y,A=0;A<o.length;){var _=o.charCodeAt(A++);if(_===61&&h>1)break;if((_=n[_])===void 0)throw Error(i);switch(h){case 0:y=_,h=1;break;case 1:a[p++]=y<<2|(_&48)>>4,y=_,h=2;break;case 2:a[p++]=(y&15)<<4|(_&60)>>2,y=_,h=3;break;case 3:a[p++]=(y&3)<<6|_,h=0;break}}if(h===1)throw Error(i);return p-l},t.test=function(o){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(o)}})(bE);const sf=Go(bE);let Nn;try{if(typeof WebAssembly=="object"){const e="AGFzbQEAAAABDQJgAAF/YAR/f39/AX8DBwYAAQEBAQEGBgF/AUEACwcyBgNtdWwAAQVkaXZfcwACBWRpdl91AAMFcmVtX3MABAVyZW1fdQAFCGdldF9oaWdoAAAKvwEGBAAjAAskAQF+IACtIAGtQiCGhCACrSADrUIghoR+IgRCIIenJAAgBKcLJAEBfiAArSABrUIghoQgAq0gA61CIIaEfyIEQiCHpyQAIASnCyQBAX4gAK0gAa1CIIaEIAKtIAOtQiCGhIAiBEIgh6ckACAEpwskAQF+IACtIAGtQiCGhCACrSADrUIghoSBIgRCIIenJAAgBKcLJAEBfiAArSABrUIghoQgAq0gA61CIIaEgiIEQiCHpyQAIASnCw==",t=new Uint8Array(sf.length(e));sf.decode(e,t,0),Nn=new WebAssembly.Instance(new WebAssembly.Module(t),{}).exports}}catch{}let tr=class _e{constructor(t,r,n){this.__isLong__=!0,this.low=t|0,this.high=r|0,this.unsigned=!!n}static isLong(t){return(t&&t.__isLong__)===!0}static fromInt(t,r){var n,s,i;return r?(t>>>=0,(i=0<=t&&t<256)&&(s=this._UINT_CACHE[t],s)?s:(n=this.fromBits(t,(t|0)<0?-1:0,!0),i&&(this._UINT_CACHE[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(s=this._INT_CACHE[t],s)?s:(n=this.fromBits(t,t<0?-1:0,!1),i&&(this._INT_CACHE[t]=n),n))}static fromNumber(t,r){if(isNaN(t))return r?_e.UZERO:_e.ZERO;if(r){if(t<0)return _e.UZERO;if(t>=wE)return _e.MAX_UNSIGNED_VALUE}else{if(t<=-km)return _e.MIN_VALUE;if(t+1>=km)return _e.MAX_VALUE}return t<0?this.fromNumber(-t,r).neg():this.fromBits(t%Na|0,t/Na|0,r)}static fromBits(t,r,n){return new _e(t,r,n)}static fromString(t,r,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return _e.ZERO;if(typeof r=="number"?(n=r,r=!1):r=!!r,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return this.fromString(t.substring(1),r,n).neg();for(var i=this.fromNumber(fl(n,8)),o=_e.ZERO,a=0;a<t.length;a+=8){var p=Math.min(8,t.length-a),l=parseInt(t.substring(a,a+p),n);if(p<8){var h=this.fromNumber(fl(n,p));o=o.mul(h).add(this.fromNumber(l))}else o=o.mul(i),o=o.add(this.fromNumber(l))}return o.unsigned=r,o}static fromValue(t,r){return typeof t=="number"?this.fromNumber(t,r):typeof t=="string"?this.fromString(t,r):this.fromBits(t.low,t.high,typeof r=="boolean"?r:t.unsigned)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){return this.unsigned?(this.high>>>0)*Na+(this.low>>>0):this.high*Na+(this.low>>>0)}toString(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(_e.MIN_VALUE)){var r=_e.fromNumber(t),n=this.div(r),s=n.mul(r).sub(this);return n.toString(t)+s.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var i=_e.fromNumber(fl(t,6),this.unsigned),o=this,a="";;){var p=o.div(i),l=o.sub(p.mul(i)).toInt()>>>0,h=l.toString(t);if(o=p,o.isZero())return h+a;for(;h.length<6;)h="0"+h;a=""+h+a}}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){if(this.isNegative())return this.eq(_e.MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,r=31;r>0&&!(t&1<<r);r--);return this.high!=0?r+33:r+1}isZero(){return this.high===0&&this.low===0}isNegative(){return!this.unsigned&&this.high<0}isPositive(){return this.unsigned||this.high>=0}isOdd(){return(this.low&1)===1}isEven(){return(this.low&1)===0}equals(t){return _e.isLong(t)||(t=_e.fromValue(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low}notEquals(t){return!this.eq(t)}lessThan(t){return this.comp(t)<0}lessThanOrEqual(t){return this.comp(t)<=0}greaterThan(t){return this.comp(t)>0}greaterThanOrEqual(t){return this.comp(t)>=0}compare(t){if(_e.isLong(t)||(t=_e.fromValue(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1}negate(){return!this.unsigned&&this.eq(_e.MIN_VALUE)?_e.MIN_VALUE:this.not().add(_e.ONE)}add(t){_e.isLong(t)||(t=_e.fromValue(t));var r=this.high>>>16,n=this.high&65535,s=this.low>>>16,i=this.low&65535,o=t.high>>>16,a=t.high&65535,p=t.low>>>16,l=t.low&65535,h=0,y=0,A=0,_=0;return _+=i+l,A+=_>>>16,_&=65535,A+=s+p,y+=A>>>16,A&=65535,y+=n+a,h+=y>>>16,y&=65535,h+=r+o,h&=65535,_e.fromBits(A<<16|_,h<<16|y,this.unsigned)}subtract(t){return _e.isLong(t)||(t=_e.fromValue(t)),this.add(t.neg())}multiply(t){if(this.isZero())return _e.ZERO;if(_e.isLong(t)||(t=_e.fromValue(t)),Nn){var r=Nn.mul(this.low,this.high,t.low,t.high);return _e.fromBits(r,Nn.get_high(),this.unsigned)}if(t.isZero())return _e.ZERO;if(this.eq(_e.MIN_VALUE))return t.isOdd()?_e.MIN_VALUE:_e.ZERO;if(t.eq(_e.MIN_VALUE))return this.isOdd()?_e.MIN_VALUE:_e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Hm)&&t.lt(Hm))return _e.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,a=t.high>>>16,p=t.high&65535,l=t.low>>>16,h=t.low&65535,y=0,A=0,_=0,E=0;return E+=o*h,_+=E>>>16,E&=65535,_+=i*h,A+=_>>>16,_&=65535,_+=o*l,A+=_>>>16,_&=65535,A+=s*h,y+=A>>>16,A&=65535,A+=i*l,y+=A>>>16,A&=65535,A+=o*p,y+=A>>>16,A&=65535,y+=n*h+s*l+i*p+o*a,y&=65535,_e.fromBits(_<<16|E,y<<16|A,this.unsigned)}divide(t){if(_e.isLong(t)||(t=_e.fromValue(t)),t.isZero())throw Error("division by zero");if(Nn){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var r=(this.unsigned?Nn.div_u:Nn.div_s)(this.low,this.high,t.low,t.high);return _e.fromBits(r,Nn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?_e.UZERO:_e.ZERO;var n,s,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return _e.UZERO;if(t.gt(this.shru(1)))return _e.UONE;i=_e.UZERO}else{if(this.eq(_e.MIN_VALUE)){if(t.eq(_e.ONE)||t.eq(_e.NEG_ONE))return _e.MIN_VALUE;if(t.eq(_e.MIN_VALUE))return _e.ONE;var o=this.shr(1);return n=o.div(t).shl(1),n.eq(_e.ZERO)?t.isNegative()?_e.ONE:_e.NEG_ONE:(s=this.sub(t.mul(n)),i=n.add(s.div(t)),i)}else if(t.eq(_e.MIN_VALUE))return this.unsigned?_e.UZERO:_e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=_e.ZERO}for(s=this;s.gte(t);){n=Math.max(1,Math.floor(s.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),p=a<=48?1:fl(2,a-48),l=_e.fromNumber(n),h=l.mul(t);h.isNegative()||h.gt(s);)n-=p,l=_e.fromNumber(n,this.unsigned),h=l.mul(t);l.isZero()&&(l=_e.ONE),i=i.add(l),s=s.sub(h)}return i}modulo(t){if(_e.isLong(t)||(t=_e.fromValue(t)),Nn){var r=(this.unsigned?Nn.rem_u:Nn.rem_s)(this.low,this.high,t.low,t.high);return _e.fromBits(r,Nn.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))}not(){return _e.fromBits(~this.low,~this.high,this.unsigned)}and(t){return _e.isLong(t)||(t=_e.fromValue(t)),_e.fromBits(this.low&t.low,this.high&t.high,this.unsigned)}or(t){return _e.isLong(t)||(t=_e.fromValue(t)),_e.fromBits(this.low|t.low,this.high|t.high,this.unsigned)}xor(t){return _e.isLong(t)||(t=_e.fromValue(t)),_e.fromBits(this.low^t.low,this.high^t.high,this.unsigned)}shiftLeft(t){return _e.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?_e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):_e.fromBits(0,this.low<<t-32,this.unsigned)}shiftRight(t){return _e.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?_e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):_e.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)}shiftRightUnsigned(t){if(_e.isLong(t)&&(t=t.toInt()),t&=63,t===0)return this;var r=this.high;if(t<32){var n=this.low;return _e.fromBits(n>>>t|r<<32-t,r>>>t,this.unsigned)}else return t===32?_e.fromBits(r,0,this.unsigned):_e.fromBits(r>>>t-32,0,this.unsigned)}toSigned(){return this.unsigned?_e.fromBits(this.low,this.high,!1):this}toUnsigned(){return this.unsigned?this:_e.fromBits(this.low,this.high,!0)}toBytes(t){return t?this.toBytesLE():this.toBytesBE()}toBytesLE(){var t=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]}toBytesBE(){var t=this.high,r=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,r>>>24,r>>>16&255,r>>>8&255,r&255]}static fromBytes(t,r,n){return n?_e.fromBytesLE(t,r):this.fromBytesBE(t,r)}static fromBytesLE(t,r){return new _e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)}static fromBytesBE(t,r){return new _e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)}};tr._INT_CACHE=Object.create(null);tr._UINT_CACHE=Object.create(null);tr.ZERO=tr.fromInt(0);tr.UZERO=tr.fromInt(0,!0);tr.ONE=tr.fromInt(1);tr.UONE=tr.fromInt(1,!0);tr.NEG_ONE=tr.fromInt(-1);tr.MAX_VALUE=tr.fromBits(-1,2147483647,!1);tr.MAX_UNSIGNED_VALUE=tr.fromBits(-1,-1,!0);tr.MIN_VALUE=tr.fromBits(0,-2147483648,!1);const fl=Math.pow,Pm=65536,_T=1<<24,Na=Pm*Pm,wE=Na*Na,km=wE/2,Hm=tr.fromInt(_T),Xe=tr.prototype;Xe.eqz=Xe.isZero;Xe.eq=Xe.equals;Xe.neq=Xe.notEquals;Xe.ne=Xe.notEquals;Xe.lt=Xe.lessThan;Xe.lte=Xe.lessThanOrEqual;Xe.le=Xe.lessThanOrEqual;Xe.gt=Xe.greaterThan;Xe.gte=Xe.greaterThanOrEqual;Xe.ge=Xe.greaterThanOrEqual;Xe.comp=Xe.compare;Xe.neg=Xe.negate;Xe.sub=Xe.subtract;Xe.mul=Xe.multiply;Xe.div=Xe.divide;Xe.mod=Xe.modulo;Xe.rem=Xe.modulo;Xe.shl=Xe.shiftLeft;Xe.shr=Xe.shiftRight;Xe.shru=Xe.shiftRightUnsigned;Xe.shr_u=Xe.shiftRightUnsigned;var Jn={},zu={};zu.byteLength=IT;zu.toByteArray=bT;zu.fromByteArray=NT;var ms=[],On=[],AT=typeof Uint8Array<"u"?Uint8Array:Array,cg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var oa=0,ET=cg.length;oa<ET;++oa)ms[oa]=cg[oa],On[cg.charCodeAt(oa)]=oa;On[45]=62;On[95]=63;function SE(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function IT(e){var t=SE(e),r=t[0],n=t[1];return(r+n)*3/4-n}function TT(e,t,r){return(t+r)*3/4-r}function bT(e){var t,r=SE(e),n=r[0],s=r[1],i=new AT(TT(e,n,s)),o=0,a=s>0?n-4:n,p;for(p=0;p<a;p+=4)t=On[e.charCodeAt(p)]<<18|On[e.charCodeAt(p+1)]<<12|On[e.charCodeAt(p+2)]<<6|On[e.charCodeAt(p+3)],i[o++]=t>>16&255,i[o++]=t>>8&255,i[o++]=t&255;return s===2&&(t=On[e.charCodeAt(p)]<<2|On[e.charCodeAt(p+1)]>>4,i[o++]=t&255),s===1&&(t=On[e.charCodeAt(p)]<<10|On[e.charCodeAt(p+1)]<<4|On[e.charCodeAt(p+2)]>>2,i[o++]=t>>8&255,i[o++]=t&255),i}function wT(e){return ms[e>>18&63]+ms[e>>12&63]+ms[e>>6&63]+ms[e&63]}function ST(e,t,r){for(var n,s=[],i=t;i<r;i+=3)n=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(e[i+2]&255),s.push(wT(n));return s.join("")}function NT(e){for(var t,r=e.length,n=r%3,s=[],i=16383,o=0,a=r-n;o<a;o+=i)s.push(ST(e,o,o+i>a?a:o+i));return n===1?(t=e[r-1],s.push(ms[t>>2]+ms[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],s.push(ms[t>>10]+ms[t>>4&63]+ms[t<<2&63]+"=")),s.join("")}var ey={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ey.read=function(e,t,r,n,s){var i,o,a=s*8-n-1,p=(1<<a)-1,l=p>>1,h=-7,y=r?s-1:0,A=r?-1:1,_=e[t+y];for(y+=A,i=_&(1<<-h)-1,_>>=-h,h+=a;h>0;i=i*256+e[t+y],y+=A,h-=8);for(o=i&(1<<-h)-1,i>>=-h,h+=n;h>0;o=o*256+e[t+y],y+=A,h-=8);if(i===0)i=1-l;else{if(i===p)return o?NaN:(_?-1:1)*(1/0);o=o+Math.pow(2,n),i=i-l}return(_?-1:1)*o*Math.pow(2,i-n)};ey.write=function(e,t,r,n,s,i){var o,a,p,l=i*8-s-1,h=(1<<l)-1,y=h>>1,A=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=n?0:i-1,E=n?1:-1,T=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(p=Math.pow(2,-o))<1&&(o--,p*=2),o+y>=1?t+=A/p:t+=A*Math.pow(2,1-y),t*p>=2&&(o++,p/=2),o+y>=h?(a=0,o=h):o+y>=1?(a=(t*p-1)*Math.pow(2,s),o=o+y):(a=t*Math.pow(2,y-1)*Math.pow(2,s),o=0));s>=8;e[r+_]=a&255,_+=E,a/=256,s-=8);for(o=o<<s|a,l+=s;l>0;e[r+_]=o&255,_+=E,o/=256,l-=8);e[r+_-E]|=T*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){const t=zu,r=ey,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=a,e.SlowBuffer=N,e.INSPECT_MAX_BYTES=50;const s=2147483647;e.kMaxLength=s,a.TYPED_ARRAY_SUPPORT=i(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{const d=new Uint8Array(1),f={foo:function(){return 42}};return Object.setPrototypeOf(f,Uint8Array.prototype),Object.setPrototypeOf(d,f),d.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(d){if(d>s)throw new RangeError('The value "'+d+'" is invalid for option "size"');const f=new Uint8Array(d);return Object.setPrototypeOf(f,a.prototype),f}function a(d,f,m){if(typeof d=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(d)}return p(d,f,m)}a.poolSize=8192;function p(d,f,m){if(typeof d=="string")return A(d,f);if(ArrayBuffer.isView(d))return E(d);if(d==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d);if(qe(d,ArrayBuffer)||d&&qe(d.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(qe(d,SharedArrayBuffer)||d&&qe(d.buffer,SharedArrayBuffer)))return T(d,f,m);if(typeof d=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const b=d.valueOf&&d.valueOf();if(b!=null&&b!==d)return a.from(b,f,m);const O=w(d);if(O)return O;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof d[Symbol.toPrimitive]=="function")return a.from(d[Symbol.toPrimitive]("string"),f,m);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d)}a.from=function(d,f,m){return p(d,f,m)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l(d){if(typeof d!="number")throw new TypeError('"size" argument must be of type number');if(d<0)throw new RangeError('The value "'+d+'" is invalid for option "size"')}function h(d,f,m){return l(d),d<=0?o(d):f!==void 0?typeof m=="string"?o(d).fill(f,m):o(d).fill(f):o(d)}a.alloc=function(d,f,m){return h(d,f,m)};function y(d){return l(d),o(d<0?0:C(d)|0)}a.allocUnsafe=function(d){return y(d)},a.allocUnsafeSlow=function(d){return y(d)};function A(d,f){if((typeof f!="string"||f==="")&&(f="utf8"),!a.isEncoding(f))throw new TypeError("Unknown encoding: "+f);const m=L(d,f)|0;let b=o(m);const O=b.write(d,f);return O!==m&&(b=b.slice(0,O)),b}function _(d){const f=d.length<0?0:C(d.length)|0,m=o(f);for(let b=0;b<f;b+=1)m[b]=d[b]&255;return m}function E(d){if(qe(d,Uint8Array)){const f=new Uint8Array(d);return T(f.buffer,f.byteOffset,f.byteLength)}return _(d)}function T(d,f,m){if(f<0||d.byteLength<f)throw new RangeError('"offset" is outside of buffer bounds');if(d.byteLength<f+(m||0))throw new RangeError('"length" is outside of buffer bounds');let b;return f===void 0&&m===void 0?b=new Uint8Array(d):m===void 0?b=new Uint8Array(d,f):b=new Uint8Array(d,f,m),Object.setPrototypeOf(b,a.prototype),b}function w(d){if(a.isBuffer(d)){const f=C(d.length)|0,m=o(f);return m.length===0||d.copy(m,0,0,f),m}if(d.length!==void 0)return typeof d.length!="number"||Dn(d.length)?o(0):_(d);if(d.type==="Buffer"&&Array.isArray(d.data))return _(d.data)}function C(d){if(d>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return d|0}function N(d){return+d!=d&&(d=0),a.alloc(+d)}a.isBuffer=function(d){return d!=null&&d._isBuffer===!0&&d!==a.prototype},a.compare=function(d,f){if(qe(d,Uint8Array)&&(d=a.from(d,d.offset,d.byteLength)),qe(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),!a.isBuffer(d)||!a.isBuffer(f))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(d===f)return 0;let m=d.length,b=f.length;for(let O=0,H=Math.min(m,b);O<H;++O)if(d[O]!==f[O]){m=d[O],b=f[O];break}return m<b?-1:b<m?1:0},a.isEncoding=function(d){switch(String(d).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(d,f){if(!Array.isArray(d))throw new TypeError('"list" argument must be an Array of Buffers');if(d.length===0)return a.alloc(0);let m;if(f===void 0)for(f=0,m=0;m<d.length;++m)f+=d[m].length;const b=a.allocUnsafe(f);let O=0;for(m=0;m<d.length;++m){let H=d[m];if(qe(H,Uint8Array))O+H.length>b.length?(a.isBuffer(H)||(H=a.from(H)),H.copy(b,O)):Uint8Array.prototype.set.call(b,H,O);else if(a.isBuffer(H))H.copy(b,O);else throw new TypeError('"list" argument must be an Array of Buffers');O+=H.length}return b};function L(d,f){if(a.isBuffer(d))return d.length;if(ArrayBuffer.isView(d)||qe(d,ArrayBuffer))return d.byteLength;if(typeof d!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof d);const m=d.length,b=arguments.length>2&&arguments[2]===!0;if(!b&&m===0)return 0;let O=!1;for(;;)switch(f){case"ascii":case"latin1":case"binary":return m;case"utf8":case"utf-8":return ct(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m*2;case"hex":return m>>>1;case"base64":return Ct(d).length;default:if(O)return b?-1:ct(d).length;f=(""+f).toLowerCase(),O=!0}}a.byteLength=L;function B(d,f,m){let b=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((m===void 0||m>this.length)&&(m=this.length),m<=0)||(m>>>=0,f>>>=0,m<=f))return"";for(d||(d="utf8");;)switch(d){case"hex":return J(this,f,m);case"utf8":case"utf-8":return k(this,f,m);case"ascii":return K(this,f,m);case"latin1":case"binary":return F(this,f,m);case"base64":return x(this,f,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,f,m);default:if(b)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),b=!0}}a.prototype._isBuffer=!0;function $(d,f,m){const b=d[f];d[f]=d[m],d[m]=b}a.prototype.swap16=function(){const d=this.length;if(d%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let f=0;f<d;f+=2)$(this,f,f+1);return this},a.prototype.swap32=function(){const d=this.length;if(d%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let f=0;f<d;f+=4)$(this,f,f+3),$(this,f+1,f+2);return this},a.prototype.swap64=function(){const d=this.length;if(d%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let f=0;f<d;f+=8)$(this,f,f+7),$(this,f+1,f+6),$(this,f+2,f+5),$(this,f+3,f+4);return this},a.prototype.toString=function(){const d=this.length;return d===0?"":arguments.length===0?k(this,0,d):B.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(d){if(!a.isBuffer(d))throw new TypeError("Argument must be a Buffer");return this===d?!0:a.compare(this,d)===0},a.prototype.inspect=function(){let d="";const f=e.INSPECT_MAX_BYTES;return d=this.toString("hex",0,f).replace(/(.{2})/g,"$1 ").trim(),this.length>f&&(d+=" ... "),"<Buffer "+d+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(d,f,m,b,O){if(qe(d,Uint8Array)&&(d=a.from(d,d.offset,d.byteLength)),!a.isBuffer(d))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof d);if(f===void 0&&(f=0),m===void 0&&(m=d?d.length:0),b===void 0&&(b=0),O===void 0&&(O=this.length),f<0||m>d.length||b<0||O>this.length)throw new RangeError("out of range index");if(b>=O&&f>=m)return 0;if(b>=O)return-1;if(f>=m)return 1;if(f>>>=0,m>>>=0,b>>>=0,O>>>=0,this===d)return 0;let H=O-b,z=m-f;const ye=Math.min(H,z),Ke=this.slice(b,O),$e=d.slice(f,m);for(let je=0;je<ye;++je)if(Ke[je]!==$e[je]){H=Ke[je],z=$e[je];break}return H<z?-1:z<H?1:0};function V(d,f,m,b,O){if(d.length===0)return-1;if(typeof m=="string"?(b=m,m=0):m>2147483647?m=2147483647:m<-2147483648&&(m=-2147483648),m=+m,Dn(m)&&(m=O?0:d.length-1),m<0&&(m=d.length+m),m>=d.length){if(O)return-1;m=d.length-1}else if(m<0)if(O)m=0;else return-1;if(typeof f=="string"&&(f=a.from(f,b)),a.isBuffer(f))return f.length===0?-1:G(d,f,m,b,O);if(typeof f=="number")return f=f&255,typeof Uint8Array.prototype.indexOf=="function"?O?Uint8Array.prototype.indexOf.call(d,f,m):Uint8Array.prototype.lastIndexOf.call(d,f,m):G(d,[f],m,b,O);throw new TypeError("val must be string, number or Buffer")}function G(d,f,m,b,O){let H=1,z=d.length,ye=f.length;if(b!==void 0&&(b=String(b).toLowerCase(),b==="ucs2"||b==="ucs-2"||b==="utf16le"||b==="utf-16le")){if(d.length<2||f.length<2)return-1;H=2,z/=2,ye/=2,m/=2}function Ke(je,ze){return H===1?je[ze]:je.readUInt16BE(ze*H)}let $e;if(O){let je=-1;for($e=m;$e<z;$e++)if(Ke(d,$e)===Ke(f,je===-1?0:$e-je)){if(je===-1&&(je=$e),$e-je+1===ye)return je*H}else je!==-1&&($e-=$e-je),je=-1}else for(m+ye>z&&(m=z-ye),$e=m;$e>=0;$e--){let je=!0;for(let ze=0;ze<ye;ze++)if(Ke(d,$e+ze)!==Ke(f,ze)){je=!1;break}if(je)return $e}return-1}a.prototype.includes=function(d,f,m){return this.indexOf(d,f,m)!==-1},a.prototype.indexOf=function(d,f,m){return V(this,d,f,m,!0)},a.prototype.lastIndexOf=function(d,f,m){return V(this,d,f,m,!1)};function Y(d,f,m,b){m=Number(m)||0;const O=d.length-m;b?(b=Number(b),b>O&&(b=O)):b=O;const H=f.length;b>H/2&&(b=H/2);let z;for(z=0;z<b;++z){const ye=parseInt(f.substr(z*2,2),16);if(Dn(ye))return z;d[m+z]=ye}return z}function X(d,f,m,b){return dt(ct(f,d.length-m),d,m,b)}function U(d,f,m,b){return dt(ft(f),d,m,b)}function v(d,f,m,b){return dt(Ct(f),d,m,b)}function P(d,f,m,b){return dt(mt(f,d.length-m),d,m,b)}a.prototype.write=function(d,f,m,b){if(f===void 0)b="utf8",m=this.length,f=0;else if(m===void 0&&typeof f=="string")b=f,m=this.length,f=0;else if(isFinite(f))f=f>>>0,isFinite(m)?(m=m>>>0,b===void 0&&(b="utf8")):(b=m,m=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const O=this.length-f;if((m===void 0||m>O)&&(m=O),d.length>0&&(m<0||f<0)||f>this.length)throw new RangeError("Attempt to write outside buffer bounds");b||(b="utf8");let H=!1;for(;;)switch(b){case"hex":return Y(this,d,f,m);case"utf8":case"utf-8":return X(this,d,f,m);case"ascii":case"latin1":case"binary":return U(this,d,f,m);case"base64":return v(this,d,f,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,d,f,m);default:if(H)throw new TypeError("Unknown encoding: "+b);b=(""+b).toLowerCase(),H=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function x(d,f,m){return f===0&&m===d.length?t.fromByteArray(d):t.fromByteArray(d.slice(f,m))}function k(d,f,m){m=Math.min(d.length,m);const b=[];let O=f;for(;O<m;){const H=d[O];let z=null,ye=H>239?4:H>223?3:H>191?2:1;if(O+ye<=m){let Ke,$e,je,ze;switch(ye){case 1:H<128&&(z=H);break;case 2:Ke=d[O+1],(Ke&192)===128&&(ze=(H&31)<<6|Ke&63,ze>127&&(z=ze));break;case 3:Ke=d[O+1],$e=d[O+2],(Ke&192)===128&&($e&192)===128&&(ze=(H&15)<<12|(Ke&63)<<6|$e&63,ze>2047&&(ze<55296||ze>57343)&&(z=ze));break;case 4:Ke=d[O+1],$e=d[O+2],je=d[O+3],(Ke&192)===128&&($e&192)===128&&(je&192)===128&&(ze=(H&15)<<18|(Ke&63)<<12|($e&63)<<6|je&63,ze>65535&&ze<1114112&&(z=ze))}}z===null?(z=65533,ye=1):z>65535&&(z-=65536,b.push(z>>>10&1023|55296),z=56320|z&1023),b.push(z),O+=ye}return q(b)}const M=4096;function q(d){const f=d.length;if(f<=M)return String.fromCharCode.apply(String,d);let m="",b=0;for(;b<f;)m+=String.fromCharCode.apply(String,d.slice(b,b+=M));return m}function K(d,f,m){let b="";m=Math.min(d.length,m);for(let O=f;O<m;++O)b+=String.fromCharCode(d[O]&127);return b}function F(d,f,m){let b="";m=Math.min(d.length,m);for(let O=f;O<m;++O)b+=String.fromCharCode(d[O]);return b}function J(d,f,m){const b=d.length;(!f||f<0)&&(f=0),(!m||m<0||m>b)&&(m=b);let O="";for(let H=f;H<m;++H)O+=ae[d[H]];return O}function S(d,f,m){const b=d.slice(f,m);let O="";for(let H=0;H<b.length-1;H+=2)O+=String.fromCharCode(b[H]+b[H+1]*256);return O}a.prototype.slice=function(d,f){const m=this.length;d=~~d,f=f===void 0?m:~~f,d<0?(d+=m,d<0&&(d=0)):d>m&&(d=m),f<0?(f+=m,f<0&&(f=0)):f>m&&(f=m),f<d&&(f=d);const b=this.subarray(d,f);return Object.setPrototypeOf(b,a.prototype),b};function D(d,f,m){if(d%1!==0||d<0)throw new RangeError("offset is not uint");if(d+f>m)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(d,f,m){d=d>>>0,f=f>>>0,m||D(d,f,this.length);let b=this[d],O=1,H=0;for(;++H<f&&(O*=256);)b+=this[d+H]*O;return b},a.prototype.readUintBE=a.prototype.readUIntBE=function(d,f,m){d=d>>>0,f=f>>>0,m||D(d,f,this.length);let b=this[d+--f],O=1;for(;f>0&&(O*=256);)b+=this[d+--f]*O;return b},a.prototype.readUint8=a.prototype.readUInt8=function(d,f){return d=d>>>0,f||D(d,1,this.length),this[d]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(d,f){return d=d>>>0,f||D(d,2,this.length),this[d]|this[d+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(d,f){return d=d>>>0,f||D(d,2,this.length),this[d]<<8|this[d+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(d,f){return d=d>>>0,f||D(d,4,this.length),(this[d]|this[d+1]<<8|this[d+2]<<16)+this[d+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(d,f){return d=d>>>0,f||D(d,4,this.length),this[d]*16777216+(this[d+1]<<16|this[d+2]<<8|this[d+3])},a.prototype.readBigUInt64LE=pe(function(d){d=d>>>0,Re(d,"offset");const f=this[d],m=this[d+7];(f===void 0||m===void 0)&&Be(d,this.length-8);const b=f+this[++d]*2**8+this[++d]*2**16+this[++d]*2**24,O=this[++d]+this[++d]*2**8+this[++d]*2**16+m*2**24;return BigInt(b)+(BigInt(O)<<BigInt(32))}),a.prototype.readBigUInt64BE=pe(function(d){d=d>>>0,Re(d,"offset");const f=this[d],m=this[d+7];(f===void 0||m===void 0)&&Be(d,this.length-8);const b=f*2**24+this[++d]*2**16+this[++d]*2**8+this[++d],O=this[++d]*2**24+this[++d]*2**16+this[++d]*2**8+m;return(BigInt(b)<<BigInt(32))+BigInt(O)}),a.prototype.readIntLE=function(d,f,m){d=d>>>0,f=f>>>0,m||D(d,f,this.length);let b=this[d],O=1,H=0;for(;++H<f&&(O*=256);)b+=this[d+H]*O;return O*=128,b>=O&&(b-=Math.pow(2,8*f)),b},a.prototype.readIntBE=function(d,f,m){d=d>>>0,f=f>>>0,m||D(d,f,this.length);let b=f,O=1,H=this[d+--b];for(;b>0&&(O*=256);)H+=this[d+--b]*O;return O*=128,H>=O&&(H-=Math.pow(2,8*f)),H},a.prototype.readInt8=function(d,f){return d=d>>>0,f||D(d,1,this.length),this[d]&128?(255-this[d]+1)*-1:this[d]},a.prototype.readInt16LE=function(d,f){d=d>>>0,f||D(d,2,this.length);const m=this[d]|this[d+1]<<8;return m&32768?m|4294901760:m},a.prototype.readInt16BE=function(d,f){d=d>>>0,f||D(d,2,this.length);const m=this[d+1]|this[d]<<8;return m&32768?m|4294901760:m},a.prototype.readInt32LE=function(d,f){return d=d>>>0,f||D(d,4,this.length),this[d]|this[d+1]<<8|this[d+2]<<16|this[d+3]<<24},a.prototype.readInt32BE=function(d,f){return d=d>>>0,f||D(d,4,this.length),this[d]<<24|this[d+1]<<16|this[d+2]<<8|this[d+3]},a.prototype.readBigInt64LE=pe(function(d){d=d>>>0,Re(d,"offset");const f=this[d],m=this[d+7];(f===void 0||m===void 0)&&Be(d,this.length-8);const b=this[d+4]+this[d+5]*2**8+this[d+6]*2**16+(m<<24);return(BigInt(b)<<BigInt(32))+BigInt(f+this[++d]*2**8+this[++d]*2**16+this[++d]*2**24)}),a.prototype.readBigInt64BE=pe(function(d){d=d>>>0,Re(d,"offset");const f=this[d],m=this[d+7];(f===void 0||m===void 0)&&Be(d,this.length-8);const b=(f<<24)+this[++d]*2**16+this[++d]*2**8+this[++d];return(BigInt(b)<<BigInt(32))+BigInt(this[++d]*2**24+this[++d]*2**16+this[++d]*2**8+m)}),a.prototype.readFloatLE=function(d,f){return d=d>>>0,f||D(d,4,this.length),r.read(this,d,!0,23,4)},a.prototype.readFloatBE=function(d,f){return d=d>>>0,f||D(d,4,this.length),r.read(this,d,!1,23,4)},a.prototype.readDoubleLE=function(d,f){return d=d>>>0,f||D(d,8,this.length),r.read(this,d,!0,52,8)},a.prototype.readDoubleBE=function(d,f){return d=d>>>0,f||D(d,8,this.length),r.read(this,d,!1,52,8)};function Q(d,f,m,b,O,H){if(!a.isBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>O||f<H)throw new RangeError('"value" argument is out of bounds');if(m+b>d.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(d,f,m,b){if(d=+d,f=f>>>0,m=m>>>0,!b){const z=Math.pow(2,8*m)-1;Q(this,d,f,m,z,0)}let O=1,H=0;for(this[f]=d&255;++H<m&&(O*=256);)this[f+H]=d/O&255;return f+m},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(d,f,m,b){if(d=+d,f=f>>>0,m=m>>>0,!b){const z=Math.pow(2,8*m)-1;Q(this,d,f,m,z,0)}let O=m-1,H=1;for(this[f+O]=d&255;--O>=0&&(H*=256);)this[f+O]=d/H&255;return f+m},a.prototype.writeUint8=a.prototype.writeUInt8=function(d,f,m){return d=+d,f=f>>>0,m||Q(this,d,f,1,255,0),this[f]=d&255,f+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(d,f,m){return d=+d,f=f>>>0,m||Q(this,d,f,2,65535,0),this[f]=d&255,this[f+1]=d>>>8,f+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(d,f,m){return d=+d,f=f>>>0,m||Q(this,d,f,2,65535,0),this[f]=d>>>8,this[f+1]=d&255,f+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(d,f,m){return d=+d,f=f>>>0,m||Q(this,d,f,4,4294967295,0),this[f+3]=d>>>24,this[f+2]=d>>>16,this[f+1]=d>>>8,this[f]=d&255,f+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(d,f,m){return d=+d,f=f>>>0,m||Q(this,d,f,4,4294967295,0),this[f]=d>>>24,this[f+1]=d>>>16,this[f+2]=d>>>8,this[f+3]=d&255,f+4};function fe(d,f,m,b,O){xe(f,b,O,d,m,7);let H=Number(f&BigInt(4294967295));d[m++]=H,H=H>>8,d[m++]=H,H=H>>8,d[m++]=H,H=H>>8,d[m++]=H;let z=Number(f>>BigInt(32)&BigInt(4294967295));return d[m++]=z,z=z>>8,d[m++]=z,z=z>>8,d[m++]=z,z=z>>8,d[m++]=z,m}function ce(d,f,m,b,O){xe(f,b,O,d,m,7);let H=Number(f&BigInt(4294967295));d[m+7]=H,H=H>>8,d[m+6]=H,H=H>>8,d[m+5]=H,H=H>>8,d[m+4]=H;let z=Number(f>>BigInt(32)&BigInt(4294967295));return d[m+3]=z,z=z>>8,d[m+2]=z,z=z>>8,d[m+1]=z,z=z>>8,d[m]=z,m+8}a.prototype.writeBigUInt64LE=pe(function(d,f=0){return fe(this,d,f,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=pe(function(d,f=0){return ce(this,d,f,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(d,f,m,b){if(d=+d,f=f>>>0,!b){const ye=Math.pow(2,8*m-1);Q(this,d,f,m,ye-1,-ye)}let O=0,H=1,z=0;for(this[f]=d&255;++O<m&&(H*=256);)d<0&&z===0&&this[f+O-1]!==0&&(z=1),this[f+O]=(d/H>>0)-z&255;return f+m},a.prototype.writeIntBE=function(d,f,m,b){if(d=+d,f=f>>>0,!b){const ye=Math.pow(2,8*m-1);Q(this,d,f,m,ye-1,-ye)}let O=m-1,H=1,z=0;for(this[f+O]=d&255;--O>=0&&(H*=256);)d<0&&z===0&&this[f+O+1]!==0&&(z=1),this[f+O]=(d/H>>0)-z&255;return f+m},a.prototype.writeInt8=function(d,f,m){return d=+d,f=f>>>0,m||Q(this,d,f,1,127,-128),d<0&&(d=255+d+1),this[f]=d&255,f+1},a.prototype.writeInt16LE=function(d,f,m){return d=+d,f=f>>>0,m||Q(this,d,f,2,32767,-32768),this[f]=d&255,this[f+1]=d>>>8,f+2},a.prototype.writeInt16BE=function(d,f,m){return d=+d,f=f>>>0,m||Q(this,d,f,2,32767,-32768),this[f]=d>>>8,this[f+1]=d&255,f+2},a.prototype.writeInt32LE=function(d,f,m){return d=+d,f=f>>>0,m||Q(this,d,f,4,2147483647,-2147483648),this[f]=d&255,this[f+1]=d>>>8,this[f+2]=d>>>16,this[f+3]=d>>>24,f+4},a.prototype.writeInt32BE=function(d,f,m){return d=+d,f=f>>>0,m||Q(this,d,f,4,2147483647,-2147483648),d<0&&(d=4294967295+d+1),this[f]=d>>>24,this[f+1]=d>>>16,this[f+2]=d>>>8,this[f+3]=d&255,f+4},a.prototype.writeBigInt64LE=pe(function(d,f=0){return fe(this,d,f,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=pe(function(d,f=0){return ce(this,d,f,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function re(d,f,m,b,O,H){if(m+b>d.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("Index out of range")}function se(d,f,m,b,O){return f=+f,m=m>>>0,O||re(d,f,m,4),r.write(d,f,m,b,23,4),m+4}a.prototype.writeFloatLE=function(d,f,m){return se(this,d,f,!0,m)},a.prototype.writeFloatBE=function(d,f,m){return se(this,d,f,!1,m)};function ee(d,f,m,b,O){return f=+f,m=m>>>0,O||re(d,f,m,8),r.write(d,f,m,b,52,8),m+8}a.prototype.writeDoubleLE=function(d,f,m){return ee(this,d,f,!0,m)},a.prototype.writeDoubleBE=function(d,f,m){return ee(this,d,f,!1,m)},a.prototype.copy=function(d,f,m,b){if(!a.isBuffer(d))throw new TypeError("argument should be a Buffer");if(m||(m=0),!b&&b!==0&&(b=this.length),f>=d.length&&(f=d.length),f||(f=0),b>0&&b<m&&(b=m),b===m||d.length===0||this.length===0)return 0;if(f<0)throw new RangeError("targetStart out of bounds");if(m<0||m>=this.length)throw new RangeError("Index out of range");if(b<0)throw new RangeError("sourceEnd out of bounds");b>this.length&&(b=this.length),d.length-f<b-m&&(b=d.length-f+m);const O=b-m;return this===d&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(f,m,b):Uint8Array.prototype.set.call(d,this.subarray(m,b),f),O},a.prototype.fill=function(d,f,m,b){if(typeof d=="string"){if(typeof f=="string"?(b=f,f=0,m=this.length):typeof m=="string"&&(b=m,m=this.length),b!==void 0&&typeof b!="string")throw new TypeError("encoding must be a string");if(typeof b=="string"&&!a.isEncoding(b))throw new TypeError("Unknown encoding: "+b);if(d.length===1){const H=d.charCodeAt(0);(b==="utf8"&&H<128||b==="latin1")&&(d=H)}}else typeof d=="number"?d=d&255:typeof d=="boolean"&&(d=Number(d));if(f<0||this.length<f||this.length<m)throw new RangeError("Out of range index");if(m<=f)return this;f=f>>>0,m=m===void 0?this.length:m>>>0,d||(d=0);let O;if(typeof d=="number")for(O=f;O<m;++O)this[O]=d;else{const H=a.isBuffer(d)?d:a.from(d,b),z=H.length;if(z===0)throw new TypeError('The value "'+d+'" is invalid for argument "value"');for(O=0;O<m-f;++O)this[O+f]=H[O%z]}return this};const R={};function de(d,f,m){R[d]=class extends m{constructor(){super(),Object.defineProperty(this,"message",{value:f.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${d}]`,this.stack,delete this.name}get code(){return d}set code(b){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:b,writable:!0})}toString(){return`${this.name} [${d}]: ${this.message}`}}}de("ERR_BUFFER_OUT_OF_BOUNDS",function(d){return d?`${d} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),de("ERR_INVALID_ARG_TYPE",function(d,f){return`The "${d}" argument must be of type number. Received type ${typeof f}`},TypeError),de("ERR_OUT_OF_RANGE",function(d,f,m){let b=`The value of "${d}" is out of range.`,O=m;return Number.isInteger(m)&&Math.abs(m)>2**32?O=Ee(String(m)):typeof m=="bigint"&&(O=String(m),(m>BigInt(2)**BigInt(32)||m<-(BigInt(2)**BigInt(32)))&&(O=Ee(O)),O+="n"),b+=` It must be ${f}. Received ${O}`,b},RangeError);function Ee(d){let f="",m=d.length;const b=d[0]==="-"?1:0;for(;m>=b+4;m-=3)f=`_${d.slice(m-3,m)}${f}`;return`${d.slice(0,m)}${f}`}function Ie(d,f,m){Re(f,"offset"),(d[f]===void 0||d[f+m]===void 0)&&Be(f,d.length-(m+1))}function xe(d,f,m,b,O,H){if(d>m||d<f){const z=typeof f=="bigint"?"n":"";let ye;throw f===0||f===BigInt(0)?ye=`>= 0${z} and < 2${z} ** ${(H+1)*8}${z}`:ye=`>= -(2${z} ** ${(H+1)*8-1}${z}) and < 2 ** ${(H+1)*8-1}${z}`,new R.ERR_OUT_OF_RANGE("value",ye,d)}Ie(b,O,H)}function Re(d,f){if(typeof d!="number")throw new R.ERR_INVALID_ARG_TYPE(f,"number",d)}function Be(d,f,m){throw Math.floor(d)!==d?(Re(d,m),new R.ERR_OUT_OF_RANGE("offset","an integer",d)):f<0?new R.ERR_BUFFER_OUT_OF_BOUNDS:new R.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${f}`,d)}const Ue=/[^+/0-9A-Za-z-_]/g;function gt(d){if(d=d.split("=")[0],d=d.trim().replace(Ue,""),d.length<2)return"";for(;d.length%4!==0;)d=d+"=";return d}function ct(d,f){f=f||1/0;let m;const b=d.length;let O=null;const H=[];for(let z=0;z<b;++z){if(m=d.charCodeAt(z),m>55295&&m<57344){if(!O){if(m>56319){(f-=3)>-1&&H.push(239,191,189);continue}else if(z+1===b){(f-=3)>-1&&H.push(239,191,189);continue}O=m;continue}if(m<56320){(f-=3)>-1&&H.push(239,191,189),O=m;continue}m=(O-55296<<10|m-56320)+65536}else O&&(f-=3)>-1&&H.push(239,191,189);if(O=null,m<128){if((f-=1)<0)break;H.push(m)}else if(m<2048){if((f-=2)<0)break;H.push(m>>6|192,m&63|128)}else if(m<65536){if((f-=3)<0)break;H.push(m>>12|224,m>>6&63|128,m&63|128)}else if(m<1114112){if((f-=4)<0)break;H.push(m>>18|240,m>>12&63|128,m>>6&63|128,m&63|128)}else throw new Error("Invalid code point")}return H}function ft(d){const f=[];for(let m=0;m<d.length;++m)f.push(d.charCodeAt(m)&255);return f}function mt(d,f){let m,b,O;const H=[];for(let z=0;z<d.length&&!((f-=2)<0);++z)m=d.charCodeAt(z),b=m>>8,O=m%256,H.push(O),H.push(b);return H}function Ct(d){return t.toByteArray(gt(d))}function dt(d,f,m,b){let O;for(O=0;O<b&&!(O+m>=f.length||O>=d.length);++O)f[O+m]=d[O];return O}function qe(d,f){return d instanceof f||d!=null&&d.constructor!=null&&d.constructor.name!=null&&d.constructor.name===f.name}function Dn(d){return d!==d}const ae=(function(){const d="0123456789abcdef",f=new Array(256);for(let m=0;m<16;++m){const b=m*16;for(let O=0;O<16;++O)f[b+O]=d[m]+d[O]}return f})();function pe(d){return typeof BigInt>"u"?me:d}function me(){throw new Error("BigInt not supported")}})(Jn);var OT=CT;function CT(e,t){for(var r=new Array(arguments.length-1),n=0,s=2,i=!0;s<arguments.length;)r[n++]=arguments[s++];return new Promise(function(o,a){r[n]=function(p){if(i)if(i=!1,p)a(p);else{for(var l=new Array(arguments.length-1),h=0;h<l.length;)l[h++]=arguments[h];o.apply(null,l)}};try{e.apply(t||null,r)}catch(p){i&&(i=!1,a(p))}})}const xT=Go(OT);var RT=Ju;function Ju(){this._listeners={}}Ju.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};Ju.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this};Ju.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};const vT=Go(RT);var BT=Mm(Mm);function Mm(e){return typeof Float32Array<"u"?(function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=r[3]===128;function s(p,l,h){t[0]=p,l[h]=r[0],l[h+1]=r[1],l[h+2]=r[2],l[h+3]=r[3]}function i(p,l,h){t[0]=p,l[h]=r[3],l[h+1]=r[2],l[h+2]=r[1],l[h+3]=r[0]}e.writeFloatLE=n?s:i,e.writeFloatBE=n?i:s;function o(p,l){return r[0]=p[l],r[1]=p[l+1],r[2]=p[l+2],r[3]=p[l+3],t[0]}function a(p,l){return r[3]=p[l],r[2]=p[l+1],r[1]=p[l+2],r[0]=p[l+3],t[0]}e.readFloatLE=n?o:a,e.readFloatBE=n?a:o})():(function(){function t(n,s,i,o){var a=s<0?1:0;if(a&&(s=-s),s===0)n(1/s>0?0:2147483648,i,o);else if(isNaN(s))n(2143289344,i,o);else if(s>34028234663852886e22)n((a<<31|2139095040)>>>0,i,o);else if(s<11754943508222875e-54)n((a<<31|Math.round(s/1401298464324817e-60))>>>0,i,o);else{var p=Math.floor(Math.log(s)/Math.LN2),l=Math.round(s*Math.pow(2,-p)*8388608)&8388607;n((a<<31|p+127<<23|l)>>>0,i,o)}}e.writeFloatLE=t.bind(null,Lm),e.writeFloatBE=t.bind(null,Dm);function r(n,s,i){var o=n(s,i),a=(o>>31)*2+1,p=o>>>23&255,l=o&8388607;return p===255?l?NaN:a*(1/0):p===0?a*1401298464324817e-60*l:a*Math.pow(2,p-150)*(l+8388608)}e.readFloatLE=r.bind(null,Fm),e.readFloatBE=r.bind(null,Um)})(),typeof Float64Array<"u"?(function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=r[7]===128;function s(p,l,h){t[0]=p,l[h]=r[0],l[h+1]=r[1],l[h+2]=r[2],l[h+3]=r[3],l[h+4]=r[4],l[h+5]=r[5],l[h+6]=r[6],l[h+7]=r[7]}function i(p,l,h){t[0]=p,l[h]=r[7],l[h+1]=r[6],l[h+2]=r[5],l[h+3]=r[4],l[h+4]=r[3],l[h+5]=r[2],l[h+6]=r[1],l[h+7]=r[0]}e.writeDoubleLE=n?s:i,e.writeDoubleBE=n?i:s;function o(p,l){return r[0]=p[l],r[1]=p[l+1],r[2]=p[l+2],r[3]=p[l+3],r[4]=p[l+4],r[5]=p[l+5],r[6]=p[l+6],r[7]=p[l+7],t[0]}function a(p,l){return r[7]=p[l],r[6]=p[l+1],r[5]=p[l+2],r[4]=p[l+3],r[3]=p[l+4],r[2]=p[l+5],r[1]=p[l+6],r[0]=p[l+7],t[0]}e.readDoubleLE=n?o:a,e.readDoubleBE=n?a:o})():(function(){function t(n,s,i,o,a,p){var l=o<0?1:0;if(l&&(o=-o),o===0)n(0,a,p+s),n(1/o>0?0:2147483648,a,p+i);else if(isNaN(o))n(0,a,p+s),n(2146959360,a,p+i);else if(o>17976931348623157e292)n(0,a,p+s),n((l<<31|2146435072)>>>0,a,p+i);else{var h;if(o<22250738585072014e-324)h=o/5e-324,n(h>>>0,a,p+s),n((l<<31|h/4294967296)>>>0,a,p+i);else{var y=Math.floor(Math.log(o)/Math.LN2);y===1024&&(y=1023),h=o*Math.pow(2,-y),n(h*4503599627370496>>>0,a,p+s),n((l<<31|y+1023<<20|h*1048576&1048575)>>>0,a,p+i)}}}e.writeDoubleLE=t.bind(null,Lm,0,4),e.writeDoubleBE=t.bind(null,Dm,4,0);function r(n,s,i,o,a){var p=n(o,a+s),l=n(o,a+i),h=(l>>31)*2+1,y=l>>>20&2047,A=4294967296*(l&1048575)+p;return y===2047?A?NaN:h*(1/0):y===0?h*5e-324*A:h*Math.pow(2,y-1075)*(A+4503599627370496)}e.readDoubleLE=r.bind(null,Fm,0,4),e.readDoubleBE=r.bind(null,Um,4,0)})(),e}function Lm(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function Dm(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=e&255}function Fm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function Um(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}const PT=Go(BT);var NE={};(function(e){var t=e;t.length=function(r){for(var n=0,s=0,i=0;i<r.length;++i)s=r.charCodeAt(i),s<128?n+=1:s<2048?n+=2:(s&64512)===55296&&(r.charCodeAt(i+1)&64512)===56320?(++i,n+=4):n+=3;return n},t.read=function(r,n,s){var i=s-n;if(i<1)return"";for(var o=null,a=[],p=0,l;n<s;)l=r[n++],l<128?a[p++]=l:l>191&&l<224?a[p++]=(l&31)<<6|r[n++]&63:l>239&&l<365?(l=((l&7)<<18|(r[n++]&63)<<12|(r[n++]&63)<<6|r[n++]&63)-65536,a[p++]=55296+(l>>10),a[p++]=56320+(l&1023)):a[p++]=(l&15)<<12|(r[n++]&63)<<6|r[n++]&63,p>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),p=0);return o?(p&&o.push(String.fromCharCode.apply(String,a.slice(0,p))),o.join("")):String.fromCharCode.apply(String,a.slice(0,p))},t.write=function(r,n,s){for(var i=s,o,a,p=0;p<r.length;++p)o=r.charCodeAt(p),o<128?n[s++]=o:o<2048?(n[s++]=o>>6|192,n[s++]=o&63|128):(o&64512)===55296&&((a=r.charCodeAt(p+1))&64512)===56320?(o=65536+((o&1023)<<10)+(a&1023),++p,n[s++]=o>>18|240,n[s++]=o>>12&63|128,n[s++]=o>>6&63|128,n[s++]=o&63|128):(n[s++]=o>>12|224,n[s++]=o>>6&63|128,n[s++]=o&63|128);return s-i}})(NE);const kT=Go(NE);var HT=MT;function MT(e,t,r){var n=r||8192,s=n>>>1,i=null,o=n;return function(a){if(a<1||a>s)return e(a);o+a>n&&(i=e(n),o=0);var p=t.call(i,o,o+=a);return o&7&&(o=(o|7)+1),p}}const LT=Go(HT);function OE(e,t,r=!1){for(let n=Object.keys(t),s=0;s<n.length;++s)(e[n[s]]===void 0||!r)&&(e[n[s]]=t[n[s]]);return e}function $m(e){function t(r,n){if(!(this instanceof t))return new t(r,n);Object.defineProperty(this,"message",{get:function(){return r}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&OE(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}const Ve={asPromise:xT,base64:sf,EventEmitter:vT,float:PT,utf8:kT,pool:LT,emptyArray:Object.freeze?Object.freeze([]):[],emptyBytes:new Uint8Array,emptyObject:Object.freeze?Object.freeze({}):{},isInteger:Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e},isString:function(e){return typeof e=="string"||e instanceof String},isObject:function(e){return e&&typeof e=="object"},get isset(){return this.isSet},isSet(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1},Buffer:(function(){return Jn.Buffer.prototype.utf8Write?Jn.Buffer:null})(),newBuffer:function(e){return typeof e=="number"?Ve.Buffer?Ve._Buffer_allocUnsafe(e):new Ve.Array(e):Ve.Buffer?Ve._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)},Array:typeof Uint8Array<"u"?Uint8Array:Array,Long:tr,key2Re:/^true|false|0|1$/,key32Re:/^-?(?:0|[1-9][0-9]*)$/,key64Re:/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,merge:OE,lcFirst(e){return e.charAt(0).toLowerCase()+e.substring(1)},newError:$m,ProtocolError:$m("ProtocolError"),oneOfGetter:function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var n=Object.keys(this),s=n.length-1;s>-1;--s)if(t[n[s]]===1&&this[n[s]]!==void 0&&this[n[s]]!==null)return n[s]}},oneOfSetter:function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},toJSONOptions:{longs:String,enums:String,bytes:String,json:!0},_Buffer_from:null,_Buffer_allocUnsafe:null,_configure2:function(){var e=Ve.Buffer;if(!e){Ve._Buffer_from=Ve._Buffer_allocUnsafe=null;return}Ve._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},Ve._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}},isReservedId:function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},isReservedName:function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1}};let dl;class zs{constructor(t,r){if(this.name=t,this.options=r,this.resolved=!1,this.comment=null,this.filename=null,!Ve.isString(t))throw TypeError("name must be a string");if(r&&!Ve.isObject(r))throw TypeError("options must be an object");this.options=r,this.name=t,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}static _configure(t,r,n,s){dl=t}get root(){let t=this;for(;;)if(t&&t.parent)t=t.parent;else return t}get fullName(){for(var t=[this.name],r=this.parent;r;)t.unshift(r.name),r=r.parent;return t.join(".")}onAdd(t){this.parent&&this.parent!==t&&this.parent.remove(this),this.parent=t,this.resolved=!1;var r=t.root;r instanceof dl&&r._handleAdd(this)}onRemove(t){var r=t.root;r instanceof dl&&r._handleRemove(this),this.parent=null,this.resolved=!1}resolve(){return this.resolved?this:(this.root instanceof dl&&(this.resolved=!0),this)}getOption(t){if(this.options)return this.options[t]}setOption(t,r,n=!1){return(!n||!this.options||this.options[t]===void 0)&&((this.options||(this.options={}))[t]=r),this}setOptions(t,r=!1){if(t)for(let n=Object.keys(t),s=0;s<n.length;++s)this.setOption(n[s],t[n[s]],r);return this}toString(){const t=zs.className,r=this.fullName;return r.length?t+" "+r:t}}zs.className="ReflectionObject";var DT=ty;function ty(e,t){typeof e=="string"&&(t=e,e=void 0);var r=[];function n(i){if(typeof i!="string"){var o=s();if(ty.verbose&&console.log("codegen: "+o),o="return "+o,i){for(var a=Object.keys(i),p=new Array(a.length+1),l=new Array(a.length),h=0;h<a.length;)p[h]=a[h],l[h]=i[a[h++]];return p[h]=o,Function.apply(null,p).apply(null,l)}return Function(o)()}for(var y=new Array(arguments.length-1),A=0;A<y.length;)y[A]=arguments[++A];if(A=0,i=i.replace(/%([%dfijs])/g,function(_,E){var T=y[A++];switch(E){case"d":case"f":return String(Number(T));case"i":return String(Math.floor(T));case"j":return JSON.stringify(T);case"s":return String(T)}return"%"}),A!==y.length)throw Error("parameter count mismatch");return r.push(i),n}function s(i){return"function "+(i||t||"")+"("+(e&&e.join(",")||"")+`){
  `+r.join(`
  `)+`
}`}return n.toString=s,n}ty.verbose=!1;const FT=Go(DT);class Zt{constructor(t,r){this.lo=t>>>0,this.hi=r>>>0}static fromNumber(t){if(t===0)return uo;var r=t<0;r&&(t=-t);var n=t>>>0,s=(t-n)/4294967296>>>0;return r&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new Zt(n,s)}static from(t){if(typeof t=="number")return Zt.fromNumber(t);if(Ve.isString(t))if(Ve.Long)t=Ve.Long.fromString(t);else return Zt.fromNumber(parseInt(t,10));const r=t;return r.low||r.high?new Zt(r.low>>>0,r.high>>>0):uo}toNumber(t=!1){if(!t&&this.hi>>>31){var r=~this.lo+1>>>0,n=~this.hi>>>0;return r||(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toLong(t=!1){return Ve.Long?new Ve.Long(this.lo|0,this.hi|0,!!t):{low:this.lo|0,high:this.hi|0,unsigned:!!t}}static fromHash(t){if(t===Zt.zeroHash)return uo;const r=String.prototype.charCodeAt;return new Zt((r.call(t,0)|r.call(t,1)<<8|r.call(t,2)<<16|r.call(t,3)<<24)>>>0,(r.call(t,4)|r.call(t,5)<<8|r.call(t,6)<<16|r.call(t,7)<<24)>>>0)}toHash(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)}zzEncode(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){var t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){var t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}}Zt.zeroHash="\0\0\0\0\0\0\0\0";const uo=Zt.zero=new Zt(0,0);uo.toNumber=function(){return 0};uo.zzEncode=uo.zzDecode=function(){return this};uo.length=function(){return 1};Zt.zeroHash;const Vm={};let Gm,Km,jm,UT=0;const Ra={_configure:function(e,t,r){Gm=e,Km=t,jm=r},decorateType:function(e,t){const r=t||e.name;if(e.hasOwnProperty("$type")||e.$type&&e.$type.name===r)return t&&e.$type.name!==t&&(this.decorateRoot.remove(e.$type),e.$type.name=t,this.decorateRoot.add(e.$type)),e.$type;const n=e.$type,s=new jm(r);return this.decorateRoot.add(s),n&&(Object.setPrototypeOf(s.fields,n.fields),s.oneofs={},n.oneofs||(n.oneofs={}),Object.setPrototypeOf(s.oneofs,n.oneofs)),s.ctor=e,Object.defineProperty(e,"$type",{value:s,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:s,enumerable:!1}),s},decorateEnum:function(e){if(e.$type)return e.$type;const t=new Gm("Enum"+UT++,e);return this.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},get decorateRoot(){return Vm.decorated||(Vm.decorated=new Km)}},$T=/\\/g,VT=/"/g,GT=/_([a-z])/g,Oe=Object.assign(Ra,Ve,{codegen:FT,LongBits:Zt,longToHash(e){return e?Zt.from(e).toHash():Zt.zeroHash},longFromHash(e,t=!1){var r=Zt.fromHash(e);return Ve.Long?Ve.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},compareFieldsById(e,t){return e.id-t.id},toArray(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},toObject(e){const t={};let r=0;for(;r<e.length;){var n=e[r++],s=e[r++];s!==void 0&&(t[n]=s)}return t},isReserved(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},safeProp(e){return!/^[$\w_]+$/.test(e)||this.isReserved(e)?'["'+e.replace($T,"\\\\").replace(VT,'\\"')+'"]':"."+e},ucFirst(e){return e.charAt(0).toUpperCase()+e.substring(1)},camelCase(e){return e.substring(0,1)+e.substring(1).replace(GT,function(t,r){return r.toUpperCase()})}});let Mr=class CE extends zs{constructor(t,r,n,s,i){if(super(t,n),r&&typeof r!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.keys=[],this.comment=s,this.comments=i||{},this.reserved=void 0,r)for(var o=Object.keys(r),a=0;a<o.length;++a){var p=o[a],l=r[p];typeof l=="number"&&(this.values[p]=l,this.valuesById[l]=p,this.keys.push(p))}}lookupType(t){throw new Error("Method not implemented.")}lookup(){throw new Error("Method not implemented.")}get(){throw new Error("Method not implemented.")}static fromJSON(t,r){const n=new CE(t,r.values,r.options,r.comment,r.comments);return n.reserved=r.reserved,n}toJSON(t){const r=t?!!t.keepComments:!1;return Oe.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",r?this.comment:void 0,"comments",r?this.comments:void 0])}add(t,r,n){if(!Oe.isString(t))throw TypeError("name must be a string");if(!Oe.isInteger(r))throw TypeError("id must be an integer");if(this.values[t]!==void 0)throw Error("duplicate name '"+t+"' in "+this);if(this.isReservedId(r))throw Error("id "+r+" is reserved in "+this);if(this.isReservedName(t))throw Error("name '"+t+"' is reserved in "+this);if(this.valuesById[r]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+r+" in "+this);this.values[t]=r}else this.valuesById[this.values[t]=r]=t,this.keys.push(t);return this.comments[t]=n,this}remove(t){if(!Oe.isString(t))throw TypeError("name must be a string");var r=this.values[t];if(r==null)throw Error("name '"+t+"' does not exist in "+this);return delete this.valuesById[r],delete this.values[t],delete this.comments[t],this}isReservedId(t){return Oe.isReservedId(this.reserved,t)}isReservedName(t){return Oe.isReservedName(this.reserved,t)}};Mr.className="Enum";const KT=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function el(e,t=0){let r=0;const n={};for(t|=0;r<e.length;)n[KT[r+t]]=e[r++];return n}const Oa=el([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),jT=el([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",Ve.emptyBytes,null]),xE=el([0,0,0,1,1],7),ry=el([0,0,0,5,5,0,0,0,1,1,0,2],2),ny=el([1,5,0,0,0,5,5,0,0,0,1,1,0]),zT=/^required|optional|repeated$/;let pg;class Es extends zs{constructor(t,r,n,s,i,o,a){if(Oe.isObject(s)?(a=i,o=s,s=i=void 0):Oe.isObject(i)&&(a=o,o=i,i=void 0),super(t,o),!Oe.isInteger(r)||r<0)throw TypeError("id must be a non-negative integer");if(!Oe.isString(n))throw TypeError("type must be a string");if(s!==void 0&&!zT.test(s=s.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!Oe.isString(i))throw TypeError("extend must be a string");this.rule=s&&s!=="optional"?s:void 0,this.type=n,this.id=r,this.extend=i||void 0,this.optional=s==="optional",this.required=s==="required"||!this.optional,this.repeated=s==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Oe.Long?xE[n]!==void 0:!1,this.bytes=n==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=a}add(t,r,n){throw new Error("Method not implemented.")}lookupType(t,r,n){throw new Error("Method not implemented.")}lookup(t,r,n){throw new Error("Method not implemented.")}get(t,r,n){throw new Error("Method not implemented.")}static fromJSON(t,r){return new I(t,r.id,r.type,r.rule,r.extend,r.options,r.comment)}get packed(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}setOption(t,r,n=!1){return t==="packed"&&(this._packed=null),super.setOption(t,r,n)}toJSON(t){const r=t?!!t.keepComments:!1;return Oe.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",r?this.comment:void 0])}resolve(){if(this.resolved)return this;(this.typeDefault=jT[this.type])===void 0&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof pg?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]);const t=this.options&&this.options.default!=null;if(t&&(this.typeDefault=this.options.default,this.resolvedType instanceof Mr&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof Mr))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Oe.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){let r;Oe.base64.test(this.typeDefault)?Oe.base64.decode(this.typeDefault,r=Oe.newBuffer(Oe.base64.length(this.typeDefault)),0):Oe.utf8.write(this.typeDefault,r=Oe.newBuffer(Oe.utf8.length(this.typeDefault)),0),this.typeDefault=r}return this.map?this.defaultValue=Oe.emptyObject:this.repeated?this.defaultValue=Oe.emptyArray:!t&&this.optional?this.defaultValue=void 0:this.defaultValue==null&&(this.defaultValue=this.typeDefault),this.parent instanceof pg&&(this.parent.ctor.prototype[this.name]=this.defaultValue),super.resolve()}static _configure(t){pg=t}}Es.className="Field";let I=class RE extends Es{static d(t,r,n,s){let i;typeof r=="function"?i=Ra.decorateType(r).name:typeof r=="object"?i=Ra.decorateEnum(r).name:i=r;const o=Symbol.for("field");return function(a,p){const l=a.constructor;(l[o]||(l[o]=[])).push(new RE(p,t,i,n,{default:s}))}}},aa,ca,zm;class Kt extends zs{constructor(t,r){super(t,r),this._nestedArray=null}static fromJSON(t,r){return new Kt(t,r.options).addJSON(r.nested)}static arrayToJSON(t,r){if(!(t&&t.length))return;const n={};for(let s=0;s<t.length;++s)n[t[s].name]=t[s].toJSON(r);return n}static isReservedId(t,r){return Oe.isReservedId(t,r)}static isReservedName(t,r){return Oe.isReservedName(t,r)}get nestedArray(){return this._nestedArray||(this._nestedArray=Oe.toArray(this.nested))}toJSON(t){return Oe.toObject(["options",this.options,"nested",Kt.arrayToJSON(this.nestedArray,t)])}addJSON(t){if(t)for(let r=Object.keys(t),n=0,s;n<r.length;++n)s=t[r[n]],this.add((s.fields!==void 0?aa.fromJSON:s.values!==void 0?ca.fromJSON:s.id!==void 0?zm.fromJSON:Kt.fromJSON)(r[n],s));return this}get(t){return this.nested&&this.nested[t]||null}getEnum(t){if(this.nested&&this.nested[t]instanceof ca)return this.nested[t].values;throw Error("no such enum: "+t)}add(t){if(!(t instanceof Es&&t.extend!==void 0||t instanceof aa||t instanceof ca||t instanceof Kt))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{const r=this.get(t.name);if(r)if(r instanceof Kt&&t instanceof Kt&&!(r instanceof aa)){const n=r.nestedArray;for(let s=0;s<n.length;++s)t.add(n[s]);this.remove(r),this.nested||(this.nested={}),t.setOptions(r.options,!0)}else throw Error("duplicate name '"+t.name+"' in "+this)}return this.nested[t.name]=t,t.onAdd(this),this._nestedArray=null,this}remove(t){if(!(t instanceof zs))throw TypeError("object must be a ReflectionObject");if(t.parent!==this)throw Error(t+" is not a member of "+this);return this.nested&&(delete this.nested[t.name],Object.keys(this.nested).length||(this.nested=void 0)),t.onRemove(this),this._nestedArray=null,this}define(t,r){if(typeof t=="string")t=t.split(".");else if(!Array.isArray(t))throw TypeError("illegal path");if(t&&t.length&&t[0]==="")throw Error("path must be relative");let n=this;for(;t.length>0;){let s=t.shift();if(n.nested&&n.nested[s]){if(n=n.nested[s],!(n instanceof Kt))throw Error("path conflicts with non-namespace objects")}else n.add(n=new Kt(s))}return r&&n.addJSON(r),n}resolveAll(){for(var t=this.nestedArray,r=0;r<t.length;)t[r]instanceof Kt?t[r++].resolveAll():t[r++].resolve();return this.resolve()}lookup(t,r,n=!1){if(typeof r=="boolean"?(n=r,r=void 0):r&&!Array.isArray(r)&&(r=[r]),Oe.isString(t)&&t.length){if(t===".")return this.root;t=t.split(".")}else if(!t.length)return this;if(t[0]==="")return this.root.lookup(t.slice(1),r);let s=this.get(t[0]);if(s){if(t.length===1){if(!r||r.indexOf(s.constructor)>-1)return s}else if(s instanceof Kt&&(s=s.lookup(t.slice(1),r,!0)))return s}else for(let i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof Kt&&(s=this._nestedArray[i].lookup(t,r,!0)))return s;return this.parent===null||n?null:this.parent.lookup(t,r)}lookupType(t){var r=this.lookup(t,[aa]);if(!r)throw Error("no such type: "+t);return r}lookupEnum(t){var r=this.lookup(t,[ca]);if(!r)throw Error("no such Enum '"+t+"' in "+this);return r}lookupTypeOrEnum(t){const r=this.lookup(t,[aa,ca]);if(!r)throw Error("no such Type or Enum '"+t+"' in "+this);return r}static _configure(t,r,n){aa=t,ca=r,zm=n}}Kt.className="Namespace";class js extends zs{constructor(t,r,n,s){if(Array.isArray(r)||(n=r,r=void 0),super(t,n),!(r===void 0||Array.isArray(r)))throw TypeError("fieldNames must be an Array");this.oneof=r||[],this.fieldsArray=[],this.comment=s}lookup(t,r,n){throw new Error("Method not implemented.")}lookupType(t,r,n){throw new Error("Method not implemented.")}get(t){throw new Error("Method not implemented.")}static fromJSON(t,r){return new js(t,r.oneof,r.options,r.comment)}toJSON(t){var r=t?!!t.keepComments:!1;return Oe.toObject(["options",this.options,"oneof",this.oneof,"comment",r?this.comment:void 0])}add(t){const r=this;if(!(t instanceof Es))throw TypeError("field must be a Field");return t.parent&&t.parent!==this.parent&&t.parent.remove(t),this.oneof.push(t.name),this.fieldsArray.push(t),t.partOf=r,Jm(r),this}remove(t){if(!(t instanceof Es))throw TypeError("field must be a Field");var r=this.fieldsArray.indexOf(t);if(r<0)throw Error(t+" is not a member of "+this);return this.fieldsArray.splice(r,1),r=this.oneof.indexOf(t.name),r>-1&&this.oneof.splice(r,1),t.partOf=null,this}onAdd(t){super.onAdd(t);for(var r=0;r<this.oneof.length;++r){var n=t.get(this.oneof[r]);n&&!n.partOf&&(n.partOf=this,this.fieldsArray.push(n))}Jm(this)}onRemove(t){for(var r=0,n;r<this.fieldsArray.length;++r)(n=this.fieldsArray[r]).parent&&n.parent.remove(n);super.onRemove(t)}static d(...t){let r=new Array(arguments.length),n=0;for(;n<arguments.length;)r[n]=arguments[n++];const s=Symbol.for("field");return function(i,o){const a=i.constructor;(a[s]||(a[s]=[])).push(new js(o,r)),Object.defineProperty(i,o,{get:Oe.oneOfGetter(r),set:Oe.oneOfSetter(r)})}}}js.className="OneOf";function Jm(e){if(e.parent)for(let t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}const yl=/^[A-Z]/;let Ym;class xi extends Kt{constructor(t){super("",t),this.deferred=[],this.files=[]}static fromJSON(t,r){return r||(r=new xi),t.options&&r.setOptions(t.options),r.addJSON(t.nested)}resolveAll(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(t){return"'extend "+t.extend+"' in "+t.parent.fullName}).join(", "));return super.resolveAll()}_handleAdd(t){const r=t;if(t instanceof Es)t.extend!==void 0&&!t.extensionField&&(Qm(this,t)||this.deferred.push(t));else if(t instanceof Mr)yl.test(t.name)&&(r.parent[t.name]=t.values);else if(!(t instanceof js)){if(t instanceof Ym)for(var n=0;n<this.deferred.length;)Qm(this,this.deferred[n])?this.deferred.splice(n,1):++n;for(var s=0;s<r.nestedArray.length;++s)this._handleAdd(r._nestedArray[s]);yl.test(t.name)&&(r.parent[t.name]=t)}}_handleRemove(t){const r=t;if(t instanceof Es){if(t.extend!==void 0)if(t.extensionField)r.extensionField.parent.remove(t.extensionField),t.extensionField=null;else{var n=this.deferred.indexOf(t);n>-1&&this.deferred.splice(n,1)}}else if(t instanceof Mr)yl.test(t.name)&&delete r.parent[t.name];else if(t instanceof Kt){const i=t;for(var s=0;s<t.nestedArray.length;++s)this._handleRemove(i._nestedArray[s]);yl.test(t.name)&&delete i.parent[t.name]}}static _configure(t){Ym=t}}xi.className="Root";function Qm(e,t){const r=t.parent.lookup(t.extend);if(r){const n=new I(t.fullName,t.id,t.type,t.rule,void 0,t.options);return n.declaringField=t,t.extensionField=n,r.add(n),!0}return!1}class wr extends Es{constructor(t,r,n,s,i,o){if(super(t,r,s,void 0,void 0,i,o),this.map=!0,!Oe.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}static fromJSON(t,r){return new wr(t,r.id,r.keyType,r.type,r.options,r.comment)}toJSON(t){const r=t?!!t.keepComments:!1;return Oe.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",r?this.comment:void 0])}resolve(){if(this.resolved)return this;if(ry[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return super.resolve()}static d(t,r,n){let s;typeof n=="function"?s=Ra.decorateType(n).name:typeof n=="object"?s=Ra.decorateEnum(n).name:s=n;var i=Symbol.for("field");return function(o,a){const p=o.constructor;var l=p[i]||(p[i]=[]);l.push(new wr(a,t,r,s))}}}wr.className="MapField";class oe{constructor(t){if(t){const r=Object.keys(t);for(const n of r)this[n]=t[n]}}getBytes(){return this.$type.encode(this).finish()}static create(t){return this.$type.create(t)}static encode(t,r){return this.$type.encode(t,r)}static encodeDelimited(t,r){return this.$type.encodeDelimited(t,r)}static decode(t){return this.$type.decode(t)}static decodeDelimited(t){return this.$type.decodeDelimited(t)}static verify(t){return this.$type.verify(t)}static fromObject(t){return this.$type.fromObject(t)}static toObject(t,r=Ve.toJSONOptions){return this.$type.toObject(t,r)}toObject(){return this.$type.toObject(this,Ve.toJSONOptions)}toJSON(){return this.$type.toObject(this,{defaults:!0})}clone(){return this.$type.decode(this.$type.encode(this).finish())}}let vE;const JT=Ve.utf8;function zn(e,t){return new RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}const Xm=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new pn(e);throw Error("illegal buffer")}:(function(e){if(Array.isArray(e))return new pn(e);throw Error("illegal buffer")});class pn{constructor(t){this.pos=0,this.uint32=(function(){let r=4294967295;return function(){if(r=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(r=(r|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(r=(r|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(r=(r|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(r=(r|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return r;if((this.pos+=5)>this.len)throw this.pos=this.len,zn(this,10);return r}})(),this._slice=Ve.Array.prototype.subarray||Ve.Array.prototype.slice,this.buf=t,this.len=t.length}int32(){return this.uint32()|0}sint32(){const t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw zn(this,4);return Dl(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw zn(this,4);return Dl(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw zn(this,4);var t=Ve.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw zn(this,4);var t=Ve.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t}bytes(){const t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw zn(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(r,n);if(r===n){const s=this.buf.constructor;return new s(0)}return this._slice.call(this.buf,r,n)}string(){const t=this.bytes();return JT.read(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw zn(this,t);this.pos+=t}else do if(this.pos>=this.len)throw zn(this);while(this.buf[this.pos++]&128);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this}static _configure(t){vE=t;const r=Ve.Long?"toLong":"toNumber";Ve.merge(pn.prototype,{int64:function(){return hg.call(this)[r](!1)},uint64:function(){return hg.call(this)[r](!0)},sint64:function(){return hg.call(this).zzDecode()[r](!1)},fixed64:function(){return Wm.call(this)[r](!0)},sfixed64:function(){return Wm.call(this)[r](!1)}})}}pn.create=Ve.Buffer?function(e){return(pn.create=function(t){return Ve.Buffer.isBuffer(t)?new vE(t):Xm(t)})(e)}:Xm;function Dl(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function hg(){var e=new Zt(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw zn(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw zn(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function Wm(){if(this.pos+8>this.len)throw zn(this,8);return new Zt(Dl(this.buf,this.pos+=4),Dl(this.buf,this.pos+=4))}let BE;class Yc{constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}fn(t,r,n){}}function lg(){}class YT{constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}}class Wn{constructor(){this.len=0,this.head=new Yc(lg,0,0),this.tail=this.head,this.states=null}static alloc(t){return new Ve.Array(t)}_push(t,r,n){return this.tail=this.tail.next=new Yc(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new QT((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(gg,10,Zt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){var r=Zt.from(t);return this._push(gg,r.length(),r)}int64(t){return this.uint64(t)}sint64(t){var r=Zt.from(t).zzEncode();return this._push(gg,r.length(),r)}bool(t){return this._push(ug,1,t?1:0)}fixed32(t){return this._push(fg,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){var r=Zt.from(t);return this._push(fg,4,r.lo)._push(fg,4,r.hi)}sfixed64(t){return this.fixed64(t)}float(t){return this._push(Ve.float.writeFloatLE,4,t)}double(t){return this._push(Ve.float.writeDoubleLE,8,t)}bytes(t){var r=t.length>>>0;if(!r)return this._push(ug,1,0);if(Ve.isString(t)){var n=Wn.alloc(r=Ve.base64.length(t));Ve.base64.decode(t,n,0),t=n}return this.uint32(r)._push(XT,r,t)}string(t){var r=Ve.utf8.length(t);return r?this.uint32(r)._push(Ve.utf8.write,r,t):this._push(ug,1,0)}fork(){return this.states=new YT(this),this.head=this.tail=new Yc(lg,0,0),this.len=0,this}reset(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Yc(lg,0,0),this.len=0),this}ldelim(){var t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){for(var t=this.head.next,r=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}static _configure(t){BE=t}}Wn.create=Ve.Buffer?function(){return(Wn.create=function(){return new BE})()}:(function(){return new Wn});Ve.Array!==Array&&(Wn.alloc=Ve.pool(Wn.alloc,Ve.Array.prototype.subarray));function ug(e,t,r){t[r]=e&255}function qm(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}class QT extends Yc{constructor(t,r){super(qm,t,r),this.len=t,this.next=void 0,this.val=r}fn(t,r,n){return qm(t,r,n)}}function gg(e,t,r){for(;e.hi;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function fg(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function XT(e,t,r){t.set(e,r)}function Zm(e,t,r,n){return t.resolvedType.group?e("%s&&types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("%s&&types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,n,(t.id<<3|2)>>>0)}function WT(e){var t=Oe.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),r,n=e.fieldsArray.slice().sort(Oe.compareFieldsById);if(e._fieldsArray instanceof Array)for(let s=0;s<n.length;++s){const i=n[s].resolve(),o=e._fieldsArray.indexOf(i),a=i.resolvedType instanceof Mr?"int32":i.type,p=Oa[a];if(r="m"+Oe.safeProp(i.name),i.map)t("if(%s!=null){",r)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(i.id<<3|2)>>>0,8|ry[i.keyType],i.keyType),p===void 0?t("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):t(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|p,a,r),t("}")("}");else if(i.repeated)t("if(%s!=null&&%s.length){",r,r),i.packed&&ny[a]!==void 0?t("w.uint32(%i).fork()",(i.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(t("for(var i=0;i<%s.length;++i)",r),p===void 0?Zm(t,i,o,r+"[i]"):t("w.uint32(%i).%s(%s[i])",(i.id<<3|p)>>>0,a,r)),t("}");else if(a==="bytes")t("if(%s!=null&&%s.length)",r,r),t("w.uint32(%i).%s(%s)",(i.id<<3|p)>>>0,a,r);else{if(a.endsWith("64"))if(i.defaultValue){const{unsigned:l,high:h,low:y}=i.defaultValue;t(`if(${r}!=null && 
                   (  ${l}!==${r}.unsigned
                   || ${h}!==${r}.high
                   || ${y}!==${r}.low
                   )
                 )`)}else t(`if(${r}!=null)`);else t("if(%s!=null&&%s!==%j)",r,r,i.defaultValue);p===void 0?Zm(t,i,o,r):t("w.uint32(%i).%s(%s)",(i.id<<3|p)>>>0,a,r)}}return t("return w")}function qT(e){return"missing required '"+e.name+"'"}function ZT(e){var t=Oe.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(a){return a.map}).length?",k":"")),r=0;if(e._fieldsArray instanceof Array){for(;r<e.fieldsArray.length;++r){var n=e._fieldsArray[r].resolve();n.repeated?t("%s=[]","m"+Oe.safeProp(n.name)):n.map&&t("%s={}","m"+Oe.safeProp(n.name))}for(t("while(r.pos<c){")("var t=r.uint32()"),e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){var n=e._fieldsArray[r].resolve(),s=n.resolvedType instanceof Mr?"int32":n.type,i="m"+Oe.safeProp(n.name);t("case %i:",n.id);const p=n.resolvedType;n.map?(t("r.skip().pos++")("k=r.%s()",n.keyType)("r.pos++"),xE[n.keyType]!==void 0?Oa[s]===void 0?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',i,r):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',i,s):Oa[s]===void 0?t("%s[k]=types[%i].decode(r,r.uint32())",i,r):t("%s[k]=r.%s()",i,s)):n.repeated?(ny[s]!==void 0&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",i,s)("}else"),Oa[s]===void 0?t(p.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",i,r):t("%s.push(r.%s())",i,s)):Oa[s]===void 0?t(p.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",i,r):t("%s=r.%s()",i,s),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var o=e._fieldsArray[r];o.required&&t("if(m.%s==null)",o.name)("throw util.ProtocolError(%j,{instance:m})",qT(o))}}return t("return m")}function xn(e,t){return e.name+": "+t+(e.repeated&&t!=="array"?"[]":e.map&&t!=="object"?"{k:"+e.keyType+"}":"")+" expected"}function dg(e,t,r,n){if(t.resolvedType)if(t.resolvedType instanceof Mr){e("switch(%s){",n)("default:")("return%j",xn(t,"enum value"));for(var s=Object.keys(t.resolvedType.values),i=0;i<s.length;++i)e("case %i:",t.resolvedType.values[s[i]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,n)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",n)("return%j",xn(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",n,n,n,n)("return%j",xn(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',n)("return%j",xn(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',n)("return%j",xn(t,"boolean"));break;case"string":e("if(!util.isString(%s))",n)("return%j",xn(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',n,n,n)("return%j",xn(t,"buffer"));break}return e}function e0(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",xn(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",xn(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",xn(t,"boolean key"));break}return e}function t0(e){var t=Oe.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};if(r.length&&t("var p={}"),e._fieldsArray instanceof Array)for(var s=0;s<e.fieldsArray.length;++s){var i=e._fieldsArray[s].resolve(),o="m"+Oe.safeProp(i.name);if(i.optional&&t("if(%s!=null){",o),i.map)t("if(!util.isObject(%s))",o)("return%j",xn(i,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),e0(t,i,"k[i]"),dg(t,i,s,o+"[k[i]]")("}");else if(i.repeated)t("if(!Array.isArray(%s))",o)("return%j",xn(i,"array"))("for(var i=0;i<%s.length;++i){",o),dg(t,i,s,o+"[i]")("}");else{if(i.partOf){var a=Oe.safeProp(i.partOf.name);n[i.partOf.name]===1&&t("if(p%s===1)",a)("return%j",i.partOf.name+": multiple values"),n[i.partOf.name]=1,t("p%s=1",a)}dg(t,i,s,o)}i.optional&&t("}")}return t("return null")}function ml(e,t,r,n){if(t.resolvedType)if(t.resolvedType instanceof Mr){e("switch(d%s){",n);let s=t.resolvedType.values,i=t.resolvedType.keys,o=0;for(;o<i.length;++o)t.repeated&&s[i[o]]===t.typeDefault&&e("default:"),e("case%j:",i[o])("case %i:",s[i[o]])("m%s=%j",n,s[i[o]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i]._ctor.fromObject(d%s)",n,r,n);else{let s=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,s)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,s?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n);break}}return e}function yg(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof Mr?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{let s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n);break}}return e}const e_={fromObject(e){const t=e.fieldsArray,r=Oe.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(let n=0;n<t.length;++n){const s=t[n].resolve(),i=Oe.safeProp(s.name);s.map?(r("m%s={}",i)("if(d%s){",i)('if(typeof d%s!=="object")',i)("throw TypeError(%j)",s.fullName+": object expected")("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",i),ml(r,s,n,i+"[ks[i]]")("}")("}")):s.repeated?(r("m%s=[]",i)("if(d%s){",i)("if(!Array.isArray(d%s))",i)("throw TypeError(%j)",s.fullName+": array expected")("for(var i=0;i<d%s.length;++i){",i),ml(r,s,n,i+"[i]")("}")("}")):s.resolvedType instanceof Mr?ml(r,s,n,i):(s.resolvedType&&s.required&&(r("if(d%s==null)",i),r("d%s={}",i)),r("if(d%s!=null){",i),ml(r,s,n,i),r("}"))}return r("return m")},toObject(e){const t=e.fieldsArray.slice().sort(Oe.compareFieldsById);if(!t.length)return Oe.codegen()("return {}");const r=Oe.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],s=[],i=[];let o=0;for(;o<t.length;++o)t[o].partOf||(t[o].resolve().repeated?n:t[o].map?s:i).push(t[o]);if(n.length){for(r("if(o.arrays||o.defaults){"),o=0;o<n.length;++o)r("d%s=[]",Oe.safeProp(n[o].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),o=0;o<s.length;++o)r("d%s={}",Oe.safeProp(s[o].name));r("}")}if(i.length){for(r("if(o.defaults){"),o=0;o<i.length;++o){const p=i[o],l=Oe.safeProp(p.name);if(p.resolvedType instanceof Mr)r("d%s=o.enums===String?%j:%j",l,p.resolvedType.valuesById[p.typeDefault],p.typeDefault);else if(p.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",p.typeDefault.low,p.typeDefault.high,p.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,p.typeDefault.toString(),p.typeDefault.toNumber());else if(p.bytes){const h="["+Array.prototype.slice.call(p.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,p.typeDefault))("else{")("d%s=%s",l,h)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")}else r("d%s=%j",l,p.typeDefault)}r("}")}let a=!1;for(o=0;o<t.length;++o){let p=t[o],l=e._fieldsArray.indexOf(p),h=Oe.safeProp(p.name);p.map?(a||(a=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),yg(r,p,l,h+"[ks2[j]]")("}")):p.repeated?(r("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),yg(r,p,l,h+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",h,p.name),yg(r,p,l,h),p.partOf&&r("if(o.oneofs)")("d%s=%j",Oe.safeProp(p.partOf.name),p.name)),r("}")}return r("return d")}},t_=Symbol("bindThisProps");function Je(e,t,r){if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${t}> is not a method!`);return{configurable:!0,get(){let n=this[t_];if(n&&n.has(t))return r.value;const s=r.value.bind(this);return Object.defineProperty(this,t,{value:s,configurable:!0,writable:!0}),n||(n=this[t_]=new Set),n.add(t),s}}}const r_=Symbol("CACHE_GETTER_KEYS_STORE");function PE(e){let t=Reflect.get(e,r_);return t||(t=new Map,Reflect.set(e,r_,t)),t}function r0(e,t){const r=PE(e);let n=r.get(t);return n||(n=Symbol(`[${typeof t}]${String(t)}`),r.set(t,n)),n}function ge(e,t,r){if(typeof r.get!="function")throw new TypeError(`property ${String(t)} must has an getter function.`);const n=r.get,s=r0(e,t),i=function(){if(s in this)return this[s].value;{const o=n.call(this),a={target:this,value:o,sourceFun:n};if(this[s]=a,r.set===void 0)try{Object.defineProperty(this,t,{value:o,writable:!1,configurable:!0,enumerable:r.enumerable})}catch(p){console.error(p)}return o}};return Reflect.set(i,"source_fun",n),r.get=i,r}function n0(e){const t=PE(e);for(const[r,n]of t)s0(e,r,n)}function s0(e,t,r){const n=Reflect.get(e,r);return n===void 0||Reflect.deleteProperty(n.target,r)!==!1&&(Reflect.deleteProperty(n.target,t),!0)}class mg{constructor(t=Math.random().toString(36).slice(2)){this.pid=t,this.CLASS_PROTO_ARRAYDATA_POOL=new Map,this.PA_ID_VALUE=0,this.PA_ID_KEY=Symbol(`@PAID:${t}`)}get(t,r){const n=new Set,s=this.CLASS_PROTO_ARRAYDATA_POOL.get(r);if(s)do if(t.hasOwnProperty(this.PA_ID_KEY)){const i=s.get(t[this.PA_ID_KEY]);if(i)for(const o of i)n.add(o)}while(t=Object.getPrototypeOf(t));return n}add(t,r,n){let s=this.CLASS_PROTO_ARRAYDATA_POOL.get(r);s||(s=new Map,this.CLASS_PROTO_ARRAYDATA_POOL.set(r,s));const i=t.hasOwnProperty(this.PA_ID_KEY)?t[this.PA_ID_KEY]:t[this.PA_ID_KEY]=Symbol(`@PAID:${this.pid}#${this.PA_ID_VALUE++}`);let o=s.get(i);o?o.push(n):(o=[n],s.set(i,o))}remove(t,r,n){const s=this.CLASS_PROTO_ARRAYDATA_POOL.get(r);if(s)do{if(!t.hasOwnProperty(this.PA_ID_KEY))break;const i=t[this.PA_ID_KEY],o=s.get(i);if(!o)return;const a=o.indexOf(n);if(a!==-1)return void o.splice(a,1)}while(t=Object.getPrototypeOf(t))}}u([Je,g("design:type",Function),g("design:paramtypes",[Object,Object]),g("design:returntype",void 0)],mg.prototype,"get",null),u([Je,g("design:type",Function),g("design:paramtypes",[Object,Object,Object]),g("design:returntype",void 0)],mg.prototype,"add",null),u([Je,g("design:type",Function),g("design:paramtypes",[Object,Object,Object]),g("design:returntype",void 0)],mg.prototype,"remove",null);const of=e=>{};var i0=(e=>(e[e.WAIT_RESULT_RETURN=0]="WAIT_RESULT_RETURN",e[e.NO_WAIT_EXEC_TIME=1]="NO_WAIT_EXEC_TIME",e))(i0||{});class j extends Kt{constructor(t,r){super(t,r),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}get fieldsById(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var t=Object.keys(this.fields),r=0;r<t.length;++r){var n=this.fields[t[r]],s=n.id;if(this._fieldsById[s])throw Error("duplicate id "+s+" in "+this);this._fieldsById[s]=n}return this._fieldsById}get fieldsArray(){var t=this._fieldsArray;if(!t){t=[];for(var r in this.fields)t.push(this.fields[r]);this._fieldsArray=t}return t}get oneofsArray(){var t=this._oneofsArray;if(!t){t=[];for(var r in this.oneofs)t.push(this.oneofs[r]);this._oneofsArray=t}return t}get ctor(){return this._ctor||(this.ctor=j.generateConstructor(this)())}set ctor(t){const r=t.prototype;r instanceof oe||((t.prototype=new oe).constructor=t,Oe.merge(t.prototype,r)),t.$type=this,Oe.merge(t,oe,!0),this._ctor=t;let n=0;if(this._fieldsArray)for(;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();const s={};if(this._oneofsArray)for(n=0;n<this.oneofsArray.length;++n)s[this._oneofsArray[n].resolve().name]={get:Oe.oneOfGetter(this._oneofsArray[n].oneof),set:Oe.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(t.prototype,s)}static generateConstructor(t){for(var r=Oe.codegen(["p"],t.name),n=0,s;n<t.fieldsArray.length;++n)(s=t._fieldsArray[n]).map?r("this%s={}",Oe.safeProp(s.name)):s.repeated&&r("this%s=[]",Oe.safeProp(s.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")}static fromJSON(t,r){const n=new j(t,r.options);n.extensions=r.extensions,n.reserved=r.reserved;let s=Object.keys(r.fields),i=0;for(;i<s.length;++i)n.add((typeof r.fields[s[i]].keyType<"u"?wr.fromJSON:I.fromJSON)(s[i],r.fields[s[i]]));if(r.oneofs)for(s=Object.keys(r.oneofs),i=0;i<s.length;++i)n.add(js.fromJSON(s[i],r.oneofs[s[i]]));if(r.nested)for(s=Object.keys(r.nested),i=0;i<s.length;++i){const o=r.nested[s[i]];n.add((o.id!==void 0?I.fromJSON:o.fields!==void 0?j.fromJSON:o.values!==void 0?Mr.fromJSON:Kt.fromJSON)(s[i],o))}return r.extensions&&r.extensions.length&&(n.extensions=r.extensions),r.reserved&&r.reserved.length&&(n.reserved=r.reserved),r.group&&(n.group=!0),r.comment&&(n.comment=r.comment),n}toJSON(t){const r=super.toJSON(t),n=t?!!t.keepComments:!1;return Oe.toObject(["options",r&&r.options||void 0,"oneofs",Kt.arrayToJSON(this.oneofsArray,t),"fields",Kt.arrayToJSON(this.fieldsArray.filter(function(s){return!s.declaringField}),t)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",r&&r.nested||void 0,"comment",n?this.comment:void 0])}resolveAll(){for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();var n=this.oneofsArray;for(r=0;r<n.length;)n[r++].resolve();return super.resolveAll()}get(t){return this.fields[t]||this.oneofs&&this.oneofs[t]||this.nested&&this.nested[t]||null}add(t){const r=this;if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);if(t instanceof Es&&t.extend===void 0){if(this._fieldsById?this._fieldsById[t.id]:this.fieldsById[t.id])throw Error("duplicate id "+t.id+" in "+this);if(this.isReservedId(t.id))throw Error("id "+t.id+" is reserved in "+this);if(this.isReservedName(t.name))throw Error("name '"+t.name+"' is reserved in "+this);return t.parent&&t.parent.remove(t),this.fields[t.name]=t,t.message=r,t.onAdd(r),_l(this)}return t instanceof js?(this.oneofs||(this.oneofs={}),this.oneofs[t.name]=t,t.onAdd(r),_l(this)):super.add(t)}remove(t){const r=this;if(t instanceof Es&&t.extend===void 0){if(!this.fields||this.fields[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.fields[t.name],t.parent=null,t.onRemove(r),_l(this)}if(t instanceof js){if(!this.oneofs||this.oneofs[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.oneofs[t.name],t.parent=null,t.onRemove(r),_l(this)}return super.remove(t)}isReservedId(t){return Kt.isReservedId(this.reserved,t)}isReservedName(t){return Kt.isReservedName(this.reserved,t)}create(t){return new this.ctor(t)}get _types(){if(!this._fieldsArray)throw new ReferenceError;const t=[];for(const r of this._fieldsArray)t.push(r.resolve().resolvedType);return t}setup(){const t=this;this.fullName;for(var r=[],n=0;n<this.fieldsArray.length;++n){const i=this._fieldsArray;r.push(i[n].resolve().resolvedType)}const s=WT;return this.encode=s(t)({Writer:Wn,types:r,util:Oe}),this.decode=ZT(t)({Reader:pn,types:r,util:Oe}),this.verify=t0(t)({types:r,util:Oe}),this.fromObject=e_.fromObject(t)({types:r,util:Oe}),this}encode(t,r){return this.setup().encode(t,r)}encodeDelimited(t,r){return this.encode(t,r&&r.len?r.fork():r).ldelim()}decode(t,r){return this.setup().decode(t,r)}decodeDelimited(t){return t instanceof pn||(t=pn.create(t)),this.decode(t,t.uint32())}verify(t){return this.setup().verify(t)}fromObject(t){return this.setup().fromObject(t)}get toObject(){return e_.toObject(this)({types:this._types,util:Oe})}static d(t){const r=Symbol.for("field");return function(n){const s=Ra.decorateType(n,t),i=n[r];if(i)for(let o=0,a;a=i[o];o+=1)s.add(a);delete n[r]}}}j.className="Type";u([ge,g("design:type",Object),g("design:paramtypes",[])],j.prototype,"toObject",null);function _l(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,Reflect.deleteProperty(e,"encode"),Reflect.deleteProperty(e,"decode"),Reflect.deleteProperty(e,"verify"),e}class kE extends pn{constructor(t){super(t)}string(){const t=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len))}}Ve.Buffer&&(kE.prototype._slice=Ve.Buffer.prototype.slice);const vl=Ve.Buffer;class sy extends Wn{constructor(){super()}static alloc(t){return(sy.alloc=Ve._Buffer_allocUnsafe)(t)}bytes(t){Ve.isString(t)&&(t=Ve._Buffer_from(t,"base64"));var r=t.length>>>0;return this.uint32(r),r&&this._push(o0,r,t),this}string(t){var r=vl.byteLength(t);return this.uint32(r),r&&this._push(a0,r,t),this}}var o0=vl&&vl.prototype instanceof Uint8Array&&vl.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:(function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]});function a0(e,t,r){e.length<40?Ve.utf8.write(e,t,r):t.utf8Write(e,r)}var _g=/[\s{}=;:[\],'"()<>]/g,c0=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,p0=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,h0=/^ *[*/]+ */,l0=/^\s*\*?\/*/,u0=/\n/g,g0=/\s/,f0=/\\(.?)/g,d0={0:"\0",r:"\r",n:`
`,t:"	"};function HE(e){return e.replace(f0,function(t,r){switch(r){case"\\":case"":return r;default:return d0[r]||""}})}ME.unescape=HE;function ME(e,t){e=e.toString();var r=0,n=e.length,s=1,i=null,o=null,a=0,p=!1,l=[],h=null;function y(V){return Error("illegal "+V+" (line "+s+")")}function A(){var V=h==="'"?p0:c0;V.lastIndex=r-1;var G=V.exec(e);if(!G)throw y("string");return r=V.lastIndex,N(h),h=null,HE(G[1])}function _(V){return e.charAt(V)}function E(V,G){i=e.charAt(V++),a=s,p=!1;var Y;t?Y=2:Y=3;var X=V-Y,U;do if(--X<0||(U=e.charAt(X))===`
`){p=!0;break}while(U===" "||U==="	");for(var v=e.substring(V,G).split(u0),P=0;P<v.length;++P)v[P]=v[P].replace(t?l0:h0,"").trim();o=v.join(`
`).trim()}function T(V){var G=w(V),Y=e.substring(V,G),X=/^\s*\/{1,2}/.test(Y);return X}function w(V){for(var G=V;G<n&&_(G)!==`
`;)G++;return G}function C(){if(l.length>0)return l.shift();if(h)return A();var V,G,Y,X,U;do{if(r===n)return null;for(V=!1;g0.test(Y=_(r));)if(Y===`
`&&++s,++r===n)return null;if(_(r)==="/"){if(++r===n)throw y("comment");if(_(r)==="/")if(t){if(X=r,U=!1,T(r)){U=!0;do{if(r=w(r),r===n)break;r++}while(T(r))}else r=Math.min(n,w(r)+1);U&&E(X,r),s++,V=!0}else{for(U=_(X=r+1)==="/";_(++r)!==`
`;)if(r===n)return null;++r,U&&E(X,r-1),++s,V=!0}else if((Y=_(r))==="*"){X=r+1,U=t||_(X)==="*";do{if(Y===`
`&&++s,++r===n)throw y("comment");G=Y,Y=_(r)}while(G!=="*"||Y!=="/");++r,U&&E(X,r-2),V=!0}else return"/"}}while(V);var v=r;_g.lastIndex=0;var P=_g.test(_(v++));if(!P)for(;v<n&&!_g.test(_(v));)++v;var x=e.substring(r,r=v);return(x==='"'||x==="'")&&(h=x),x}function N(V){l.push(V)}function L(){if(!l.length){var V=C();if(V===null)return null;N(V)}return l[0]}function B(V,G=!1){var Y=L(),X=Y===V;if(X)return C(),!0;if(!G)throw y("token '"+Y+"', '"+V+"' expected");return!1}function $(V){var G=null;return V===void 0?a===s-1&&(t||i==="*"||p)&&(G=o):(a<V&&L(),a===V&&!p&&(t||i==="/")&&(G=o)),G}return Object.defineProperty({next:C,peek:L,push:N,skip:B,cmnt:$},"line",{get:function(){return s}})}Object.defineProperty(bi,"filename",{value:null});bi.defaults={keepCase:!1};var y0=/^[1-9][0-9]*$/,m0=/^-?[1-9][0-9]*$/,_0=/^0[x][0-9a-fA-F]+$/,A0=/^-?0[x][0-9a-fA-F]+$/,E0=/^0[0-7]+$/,I0=/^-?0[0-7]+$/,T0=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,fi=/^[a-zA-Z_][a-zA-Z_0-9]*$/,di=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,b0=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function bi(e,t,r){t instanceof xi||(r=t,t=new xi),r||(r=bi.defaults);var n=ME(e,r.alternateCommentMode||!1),s=n.next,i=n.push,o=n.peek,a=n.skip,p=n.cmnt,l=!0,h,y,A,_,E=!1,T=t,w=r.keepCase?function(re){return re}:Oe.camelCase;function C(re,se,ee){var R=Object.getOwnPropertyDescriptor(bi,"filename");return ee||Object.defineProperty(bi,"filename",{value:null}),Error("illegal "+(se||"token")+" '"+re+"' ("+(R?R+", ":"")+"line "+n.line+")")}function N(){var re=[],se;do{if((se=s())!=='"'&&se!=="'")throw C(se);re.push(s()),a(se),se=o()}while(se==='"'||se==="'");return re.join("")}function L(re){var se=s();switch(se){case"'":case'"':return i(se),N();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return $(se,!0)}catch{if(di.test(se))return se;throw C(se,"value")}}function B(re,se){var ee,R;do se&&((ee=o())==='"'||ee==="'")?re.push(N()):re.push([R=V(s()),a("to",!0)?V(s()):R]);while(a(",",!0));a(";")}function $(re,se){var ee=1;switch(re.charAt(0)==="-"&&(ee=-1,re=re.substring(1)),re){case"inf":case"INF":case"Inf":return ee*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(y0.test(re))return ee*parseInt(re,10);if(_0.test(re))return ee*parseInt(re,16);if(E0.test(re))return ee*parseInt(re,8);if(T0.test(re))return ee*parseFloat(re);throw C(re,"number",se)}function V(re,se){switch(re){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!se&&re.charAt(0)==="-")throw C(re,"id");if(m0.test(re))return parseInt(re,10);if(A0.test(re))return parseInt(re,16);if(I0.test(re))return parseInt(re,8);throw C(re,"id")}function G(){if(h!==void 0)throw C("package");if(h=s(),!di.test(h))throw C(h,"name");T=T.define(h),a(";")}function Y(){var re=o(),se;switch(re){case"weak":se=A||(A=[]),s();break;case"public":s();default:se=y||(y=[]);break}re=N(),a(";"),se.push(re)}function X(){if(a("="),_=N(),E=_==="proto3",!E&&_!=="proto2")throw C(_,"syntax");a(";")}function U(re,se){switch(se){case"option":return J(re,se),a(";"),!0;case"message":return P(re,se),!0;case"enum":return K(re,se),!0;case"extend":return fe(re,se),!0}return!1}function v(re,se,ee){var R=n.line;if(re&&(re.comment=p(),re.filename=Object.getOwnPropertyDescriptor(bi,"filename")),a("{",!0)){for(var de;(de=s())!=="}";)se(de);a(";",!0)}else ee&&ee(),a(";"),re&&typeof re.comment!="string"&&(re.comment=p(R))}function P(re,se){if(!fi.test(se=s()))throw C(se,"type name");var ee=new j(se);v(ee,function(R){if(!U(ee,R))switch(R){case"map":M(ee);break;case"required":case"optional":case"repeated":x(ee,R);break;case"oneof":q(ee,R);break;case"extensions":B(ee.extensions||(ee.extensions=[]));break;case"reserved":B(ee.reserved||(ee.reserved=[]),!0);break;default:if(!E||!di.test(R))throw C(R);i(R),x(ee,"optional");break}}),re.add(ee)}function x(re,se,ee){var R=s();if(R==="group"){k(re,se);return}if(!di.test(R))throw C(R,"type");var de=s();if(!fi.test(de))throw C(de,"name");de=w(de),a("=");var Ee=new I(de,V(s()),R,se,ee);v(Ee,function(Ie){if(Ie==="option")J(Ee,Ie),a(";");else throw C(Ie)},function(){Q(Ee)}),re.add(Ee),!E&&Ee.repeated&&(ny[R]!==void 0||Oa[R]===void 0)&&Ee.setOption("packed",!1,!0)}function k(re,se){var ee=s();if(!fi.test(ee))throw C(ee,"name");var R=Oe.lcFirst(ee);ee===R&&(ee=Oe.ucFirst(ee)),a("=");var de=V(s()),Ee=new j(ee);Ee.group=!0;var Ie=new I(R,de,ee,se);Ie.filename=Object.getOwnPropertyDescriptor(bi,"filename"),v(Ee,function(xe){switch(xe){case"option":J(Ee,xe),a(";");break;case"required":case"optional":case"repeated":x(Ee,xe);break;default:throw C(xe)}}),re.add(Ee).add(Ie)}function M(re,se){a("<");var ee=s();if(ry[ee]===void 0)throw C(ee,"type");a(",");var R=s();if(!di.test(R))throw C(R,"type");a(">");var de=s();if(!fi.test(de))throw C(de,"name");a("=");var Ee=new wr(w(de),V(s()),ee,R);v(Ee,function(Ie){if(Ie==="option")J(Ee,Ie),a(";");else throw C(Ie)},function(){Q(Ee)}),re.add(Ee)}function q(re,se){if(!fi.test(se=s()))throw C(se,"name");var ee=new js(w(se));v(ee,function(R){R==="option"?(J(ee,R),a(";")):(i(R),x(ee,"optional"))}),re.add(ee)}function K(re,se){if(!fi.test(se=s()))throw C(se,"name");var ee=new Mr(se);v(ee,function(R){switch(R){case"option":J(ee,R),a(";");break;case"reserved":B(ee.reserved||(ee.reserved=[]),!0);break;default:F(ee,R)}}),re.add(ee)}function F(re,se){if(!fi.test(se))throw C(se,"name");a("=");var ee=V(s(),!0),R={};v(R,function(de){if(de==="option")J(R,de),a(";");else throw C(de)},function(){Q(R)}),re.add(se,ee,R.comment)}function J(re,se){var ee=a("(",!0);if(!di.test(se=s()))throw C(se,"name");var R=se;ee&&(a(")"),R="("+R+")",se=o(),b0.test(se)&&(R+=se,s())),a("="),S(re,R)}function S(re,se){if(a("{",!0))do{if(!fi.test(ce=s()))throw C(ce,"name");o()==="{"?S(re,se+"."+ce):(a(":"),o()==="{"?S(re,se+"."+ce):D(re,se+"."+ce,L())),a(",",!0)}while(!a("}",!0));else D(re,se,L())}function D(re,se,ee){re.setOption&&re.setOption(se,ee)}function Q(re){if(a("[",!0)){do J(re,"option");while(a(",",!0));a("]")}return re}function fe(re,se){if(!di.test(se=s()))throw C(se,"reference");var ee=se;v(null,function(R){switch(R){case"required":case"repeated":case"optional":x(re,R,ee);break;default:if(!E||!di.test(R))throw C(R);i(R),x(re,"optional",ee);break}})}for(var ce;(ce=s())!==null;)switch(ce){case"package":if(!l)throw C(ce);G();break;case"import":if(!l)throw C(ce);Y();break;case"syntax":if(!l)throw C(ce);X();break;case"option":if(!l)throw C(ce);J(T,ce),a(";");break;default:if(U(T,ce)){l=!1;continue}throw C(ce)}return Object.defineProperty(bi,"filename",{value:null}),{package:h,imports:y,weakImports:A,syntax:_,root:t}}Oe._configure(Mr,xi,j);Oe._configure2();zs._configure(xi);Kt._configure(j,Mr,I);xi._configure(j);I._configure(j);pn._configure(kE);Wn._configure(sy);const ep=Oe.Long;let Is=class extends oe{toJSON(){return{numerator:this.numerator,denominator:this.denominator}}};u([I.d(1,"int32"),g("design:type",Number)],Is.prototype,"numerator",void 0);u([I.d(2,"int32"),g("design:type",Number)],Is.prototype,"denominator",void 0);Is=u([j.d("Fraction")],Is);let Lr=class extends oe{toJSON(){return{numerator:this.numerator,denominator:this.denominator}}};u([I.d(1,"string"),g("design:type",String)],Lr.prototype,"numerator",void 0);u([I.d(2,"string"),g("design:type",String)],Lr.prototype,"denominator",void 0);Lr=u([j.d("FractionBigIntModel")],Lr);let va=class extends oe{toJSON(){return{start:this.start,end:this.end}}};u([I.d(1,"uint32"),g("design:type",Number)],va.prototype,"start",void 0);u([I.d(2,"uint32"),g("design:type",Number)],va.prototype,"end",void 0);va=u([j.d("Range")],va);let Ba=class extends oe{toJSON(){return{prevWeight:this.prevWeight,nextWeight:this.nextWeight}}};u([I.d(1,"string"),g("design:type",String)],Ba.prototype,"prevWeight",void 0);u([I.d(2,"string"),g("design:type",String)],Ba.prototype,"nextWeight",void 0);Ba=u([j.d("RateModel")],Ba);class zi{constructor(t,r){this._raw=t,this.valueCode=r,this._m=new Map;for(const[n,s]of Object.entries(this._raw))this._m.set(n,r.decode(s,n))}set(t,r){return this._m.set(t,r),this._raw[t]=this.valueCode.encode(r,t),this}delete(t){return this._m.delete(t)?(delete this._raw[t],!0):!1}clear(){for(const t in this._raw)delete this._raw[t];return this._m.clear()}toObject(){const t={};for(const[r,n]of this._m)t[r[0]]=n;return t}toJSON(){const t={};for(const r of this._m.entries()){const n=r[1];t[r[0]]=n&&typeof n.toJSON=="function"?n.toJSON():n}return t}get has(){return this._m.has.bind(this._m)}get get(){return this._m.get.bind(this._m)}get size(){return this._m.size}get[Symbol.iterator](){return this._m[Symbol.iterator].bind(this._m)}get entries(){return this._m.entries.bind(this._m)}get keys(){return this._m.keys.bind(this._m)}get values(){return this._m.values.bind(this._m)}get[Symbol.toStringTag](){return"TypedMap"}}u([ge,g("design:type",Object),g("design:paramtypes",[])],zi.prototype,"has",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],zi.prototype,"get",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],zi.prototype,Symbol.iterator,null);u([ge,g("design:type",Object),g("design:paramtypes",[])],zi.prototype,"entries",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],zi.prototype,"keys",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],zi.prototype,"values",null);class Ri extends zi{constructor(t){super(t,{decode:r=>r,encode:r=>r})}}class LE extends zi{constructor(t){super(t,{decode:r=>JSON.parse(r),encode:r=>JSON.stringify(r)})}}class tl{constructor(t){this._l=t,this._s=new Set(t)}add(t){return this._s.has(t)||(this._l.push(t),this._s.add(t)),this}delete(t){if(this._s.delete(t)){const r=this._l.indexOf(t);return this._l.splice(r,1),!0}return!1}clear(){this._s.clear(),this._l.length=0}get has(){return this._s.has.bind(this._s)}get size(){return this._s.size}get[Symbol.iterator](){return this._s[Symbol.iterator].bind(this._s)}get entries(){return this._s.entries.bind(this._s)}get keys(){return this._s.keys.bind(this._s)}get values(){return this._s.values.bind(this._s)}get[Symbol.toStringTag](){return"TypedSet"}}u([ge,g("design:type",Object),g("design:paramtypes",[])],tl.prototype,"has",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],tl.prototype,Symbol.iterator,null);u([ge,g("design:type",Object),g("design:paramtypes",[])],tl.prototype,"entries",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],tl.prototype,"keys",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],tl.prototype,"values",null);let cp=class extends oe{get remarkMap(){return this._remarkMap||(this._remarkMap=new Ri(this.remark)),this._remarkMap}toJSON(){return{remark:this.remark}}getBytes(){return this.$type.encode(this).finish()}};u([wr.d(1,"string","string"),g("design:type",Object)],cp.prototype,"remark",void 0);u([ai,g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",void 0)],cp.prototype,"getBytes",null);cp=u([j.d("TemplateRemark")],cp);const af=new WeakMap,w0=new Uint8Array,Fl=[],Ul=Object.create({});for(let e=0;e<256;e++){const t=e.toString(16).padStart(2,"0");Fl[e]=t,Ul[t]=e,Ul[t.toUpperCase()]=e}const cf=[];{const e=new Uint16Array(1),t=new Uint8Array(e.buffer);for(const r of Fl)for(const n of Fl)t[0]=Ul[r],t[1]=Ul[n],cf[e[0]]=r+n}const Qc=new Uint8Array(40),n_=new Uint16Array(Qc.buffer);function S0(e){const t=e.length>>1;let r="";if(Qc.length>=e.length){Qc.set(e,0);for(let n=0;n<t;n++)r+=cf[n_[n]]}else{let n=0;do{const s=Math.min(Qc.length,e.length-n);for(let o=0;o<s;++o)Qc[o]=e[o+n];const i=s>>1;for(let o=0;o<i;o++)r+=cf[n_[o]];n+=s}while(n<e.length)}return t<<1!==e.length&&(r+=Fl[e[e.length-1]]),r}function DE(e){const t=new Uint8Array(e.length>>1);let r=0,n=0;for(;n<t.length;){let s=e.charCodeAt(r++);s<=57?s=s-48<<4:s<=70?s=s-55<<4:s<=102&&(s=s-87<<4);let i=e.charCodeAt(r++);i<=57?i-=48:i<=70?i-=55:i<=102&&(i-=87),t[n++]=s+i}return t}function iy(e){if(!e)return"";let t;return e.length===e.byteLength&&(t=af.get(e),typeof t=="string")||(t=S0(e),af.set(e,t)),t}const Pe=iy;function FE(e){if(!e)return w0;const t=DE(e);return af.set(t,e),t}const be=FE;var bc;let bt=bc=class extends oe{get publicKey(){return Pe(this.publicKeyBuffer)}set publicKey(e){this.publicKeyBuffer=be(e)}get signature(){return Pe(this.signatureBuffer)}set signature(e){this.signatureBuffer=be(e)}get secondPublicKey(){return this.secondPublicKeyBuffer&&Pe(this.secondPublicKeyBuffer)||void 0}set secondPublicKey(e){this.secondPublicKeyBuffer=be(e)}get signSignature(){return this.signSignatureBuffer&&Pe(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=be(e)}toJSON(){const e={publicKey:this.publicKey,signature:this.signature};return this.secondPublicKey&&(e.secondPublicKey=this.secondPublicKey),this.signSignature&&(e.signSignature=this.signSignature),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.publicKey&&(t.publicKey=e.publicKey),e.signature&&(t.signature=e.signature),e.secondPublicKey&&(t.secondPublicKey=e.secondPublicKey),e.signSignature&&(t.signSignature=e.signSignature)),t}};bt.INC=1;u([I.d(bc.INC++,"bytes"),g("design:type",Uint8Array)],bt.prototype,"publicKeyBuffer",void 0);u([I.d(bc.INC++,"bytes"),g("design:type",Uint8Array)],bt.prototype,"signatureBuffer",void 0);u([I.d(bc.INC++,"bytes"),g("design:type",Uint8Array)],bt.prototype,"secondPublicKeyBuffer",void 0);u([I.d(bc.INC++,"bytes"),g("design:type",Uint8Array)],bt.prototype,"signSignatureBuffer",void 0);bt=bc=u([j.d("AccountSignatureModel")],bt);let sr=class extends oe{toJSON(){return{taxCollector:this.taxCollector,taxAssetPrealnum:this.taxAssetPrealnum}}};u([I.d(1,"string"),g("design:type",String)],sr.prototype,"taxCollector",void 0);u([I.d(2,"string"),g("design:type",String)],sr.prototype,"taxAssetPrealnum",void 0);sr=u([j.d("TaxInformationModel")],sr);var $l;(function(e){e.TESTNET="c",e.MAINNET="b"})($l||($l={}));const UE="100000000";var s_;(function(e){e[e.CHAIN=2]="CHAIN",e[e.DAPP=4]="DAPP",e[e.LNS=8]="LNS"})(s_||(s_={}));const Vl={ENDPOINT:Symbol("endpoint"),REFUSETIME:Symbol("refuseTime")};var ne;(function(e){e[e.DAPP=1]="DAPP",e[e.LOCATION_NAME=2]="LOCATION_NAME",e[e.ENTITY=3]="ENTITY",e[e.ASSETS=5]="ASSETS",e[e.CERTIFICATE=6]="CERTIFICATE"})(ne||(ne={}));var Et;(function(e){e[e.GIFT=0]="GIFT",e[e.EXCHANGE=1]="EXCHANGE",e[e.TRUST=2]="TRUST",e[e.ENTITY=3]="ENTITY"})(Et||(Et={}));var lo;(function(e){e[e.P_0=0]="P_0",e[e.P_1=1]="P_1",e[e.P_2=2]="P_2",e[e.P_3=3]="P_3",e[e.P_4=4]="P_4",e[e.P_5=5]="P_5",e[e.P_6=6]="P_6",e[e.P_7=7]="P_7",e[e.P_8=8]="P_8",e[e.P_9=9]="P_9",e.P_10="A",e.P_11="B",e.P_12="C",e.P_13="D",e.P_14="E",e.P_15="F",e.P_16="G",e.P_17="H",e.P_18="I",e.P_19="J",e.P_20="K",e.P_21="L",e.P_22="M",e.P_23="N",e.P_24="O",e.P_25="P",e.P_26="Q",e.P_27="R",e.P_28="S",e.P_29="T",e.P_30="U",e.P_31="V",e.P_32="W",e.P_33="X",e.P_34="Y",e.P_35="Z"})(lo||(lo={}));var Gl;(function(e){e.DIFFERENT_PRE_BLOCK_SIGNATURE="the previous block signature is inconsistent",e.GENERATE_BLOCK_FAIL="generate block fail",e.REPLY_BLOCK_FAIL="reply block fail"})(Gl||(Gl={}));var W;(function(e){e.SIGNATURE="BSE-01",e.DAPP="WOD-00",e.DAPP_PURCHASING="WOD-01",e.REGISTER_CHAIN="WOD-02",e.MARK="EXT-00",e.ISSUE_ASSET="AST-00",e.INCREASE_ASSET="AST-01",e.TRANSFER_ASSET="AST-02",e.DESTROY_ASSET="AST-03",e.GIFT_ASSET="AST-04",e.GRAB_ASSET="AST-05",e.TRUST_ASSET="AST-06",e.SIGN_FOR_ASSET="AST-07",e.EMIGRATE_ASSET="AST-08",e.IMMIGRATE_ASSET="AST-09",e.TO_EXCHANGE_ASSET="AST-10",e.BE_EXCHANGE_ASSET="AST-11",e.STAKE_ASSET="AST-12",e.UNSTAKE_ASSET="AST-13",e.LOCATION_NAME="LNS-00",e.SET_LNS_RECORD_VALUE="LNS-01",e.SET_LNS_MANAGER="LNS-02",e.ISSUE_ENTITY_FACTORY="ETY-00",e.ISSUE_ENTITY_FACTORY_V1="ETY-01",e.ISSUE_ENTITY="ETY-02",e.DESTROY_ENTITY="ETY-03",e.ISSUE_ENTITY_MULTI="ETY-04",e.TRANSFER_ANY="ANY-00",e.GIFT_ANY="ANY-01",e.GRAB_ANY="ANY-02",e.TO_EXCHANGE_ANY="ANY-03",e.BE_EXCHANGE_ANY="ANY-04",e.TO_EXCHANGE_ANY_MULTI="ANY-05",e.BE_EXCHANGE_ANY_MULTI="ANY-06",e.TO_EXCHANGE_ANY_MULTI_ALL="ANY-07",e.BE_EXCHANGE_ANY_MULTI_ALL="ANY-08",e.ISSUE_CERTIFICATE="CRT-00",e.DESTROY_CERTIFICATE="CRT-01",e.MULTIPLE="MTP-00",e.PROMISE="PMS-00",e.PROMISE_RESOLVE="PMS-01",e.MACRO="MAC-00",e.MACRO_CALL="MAC-01"})(W||(W={}));const Me={VK:new Map,KV:new Map,VM:new Map,MV:new Map,trsTypeToV(e){const t=e.indexOf("-",e.indexOf("-")+1);return e.substr(t+1)}};class kt extends Map{constructor(t,r,n=i=>i,s){super(r),this.creater=t,this.transformKey=n,this._afterDelete=s}static from(t){return new kt(t.creater,t.entries,t.transformKey,t.afterDelete)}forceGet(t,r=this.creater){const n=this.transformKey(t);if(super.has(n))return super.get(n);const s=r(t,n);return super.set(n,s),s}tryGet(t){return this.get(this.transformKey(t))}trySet(t,r){return this.set(this.transformKey(t),r)}tryDelete(t){return this.delete(this.transformKey(t))}tryHas(t){return this.has(this.transformKey(t))}delete(t){const r=super.delete(t);return r&&this._afterDelete&&this._afterDelete(t),r}get[Symbol.toStringTag](){return"EasyMap"}static call(t,r,n,s,i){if(!(t instanceof kt))throw new TypeError("please use new keyword to create EasyMap instance.");const o=new kt(r,n,s,i),a=Object.getPrototypeOf(o),p=Object.getPrototypeOf(a),l=Object.getOwnPropertyDescriptors(p);for(const A in l)if(A!=="constructor"){const _=l[A];typeof _.value=="function"?_.value=_.value.bind(o):(typeof _.get=="function"&&(_.get=_.get.bind(o)),typeof _.set=="function"&&(_.set=_.set.bind(o))),Object.defineProperty(t,A,_)}const h=Object.getOwnPropertyDescriptors(a);for(const A in h)if(A!=="constructor"){const _=h[A];typeof _.value=="function"?_.value=_.value.bind(o):(typeof _.get=="function"&&(_.get=_.get.bind(o)),typeof _.set=="function"&&(_.set=_.set.bind(o))),Object.defineProperty(t,A,_)}const y=Object.getOwnPropertyDescriptors(o);for(const A in y)A!=="constructor"&&Object.defineProperty(t,A,{enumerable:!0,configurable:!0,get:()=>Reflect.get(o,A),set(_){Reflect.set(o,A,_)}});return t}}class As extends WeakMap{constructor(t,r,n=i=>i,s){super(r),this.creater=t,this.transformKey=n,this._afterDelete=s}static from(t){return new As(t.creater,t.entries,t.transformKey,t.afterDelete)}forceGet(t,r=this.creater){const n=this.transformKey(t);if(this.has(n))return this.get(n);const s=r(t,n);return this.set(n,s),s}tryGet(t){return this.get(this.transformKey(t))}trySet(t,r){return this.set(this.transformKey(t),r)}tryDelete(t){return this.delete(this.transformKey(t))}tryHas(t){return this.has(this.transformKey(t))}delete(t){const r=super.delete(t);return r&&this._afterDelete&&this._afterDelete(t),r}get[Symbol.toStringTag](){return"EasyWeakMap"}static call(t,r,n,s,i){if(!(t instanceof As))throw new TypeError("please use new keyword to create EasyWeakMap instance.");const o=new As(r,n,s,i),a=Object.getPrototypeOf(o),p=Object.getPrototypeOf(a),l=Object.getOwnPropertyDescriptors(p);for(const A in l)if(A!=="constructor"){const _=l[A];typeof _.value=="function"?_.value=_.value.bind(o):(typeof _.get=="function"&&(_.get=_.get.bind(o)),typeof _.set=="function"&&(_.set=_.set.bind(o))),Object.defineProperty(t,A,_)}const h=Object.getOwnPropertyDescriptors(a);for(const A in h)if(A!=="constructor"){const _=h[A];typeof _.value=="function"?_.value=_.value.bind(o):(typeof _.get=="function"&&(_.get=_.get.bind(o)),typeof _.set=="function"&&(_.set=_.set.bind(o))),Object.defineProperty(t,A,_)}const y=Object.getOwnPropertyDescriptors(o);for(const A in y)A!=="constructor"&&Object.defineProperty(t,A,{enumerable:!0,configurable:!0,get:()=>Reflect.get(o,A),set(_){Reflect.set(o,A,_)}});return t}}var Yu,Ut;const N0=new As(e=>new Ri(e.remark)),O0=new As(e=>{const t={},r="blob+sha256+hex://";for(const n in e.remark){const s=e.remark[n];if(s.startsWith(r)){const i=s.slice(r.length).split("?");if(i.length!==2)continue;try{const o=DE(i[0]);if(o.length===32){const a=i[1].split("=");if(a.length!==2||a[0]!=="size")continue;const p=Number(a[1]);if(Number.isNaN(p))continue;t[n]=["SHA256",i[0],o,p]}}catch{}}}return new Ri(t)});let Ts=Yu=class extends oe{toJSON(){return{key:this.key,value:this.value}}};Ts.INC=1;u([I.d(Yu.INC++,"string"),g("design:type",String)],Ts.prototype,"key",void 0);u([I.d(Yu.INC++,"string"),g("design:type",String)],Ts.prototype,"value",void 0);Ts=Yu=u([j.d("TransactionBaseStorageModel")],Ts);let rt=Ut=class extends oe{get senderPublicKey(){return Pe(this.senderPublicKeyBuffer)}set senderPublicKey(e){this.senderPublicKeyBuffer=be(e)}get senderSecondPublicKey(){return this.senderSecondPublicKeyBuffer&&Pe(this.senderSecondPublicKeyBuffer)||void 0}set senderSecondPublicKey(e){this.senderSecondPublicKeyBuffer=be(e)}get signature(){return Pe(this.signatureBuffer)}set signature(e){this.signatureBuffer=be(e)}get storageKey(){return this.storage&&this.storage.key}get storageValue(){return this.storage&&this.storage.value}get signSignature(){return this.signSignatureBuffer&&Pe(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=be(e)}get remarkMap(){return N0.forceGet(this)}get blobMap(){return O0.forceGet(this)}getBlobSize(e=!1){let t=0;const r=this.blobMap.values();for(const n of r)t+=n[3];return t}getBytes(e,t){const r={};e&&(r.signatureBuffer={value:null}),t&&(r.signSignatureBuffer={value:null});const n=Object.create(this,r);return this.$type.encode(n).finish()}toJSON(){const e={version:this.version,type:this.type,senderId:this.senderId,senderPublicKey:this.senderPublicKey,rangeType:this.rangeType,range:this.range,fee:this.fee,timestamp:this.timestamp,fromMagic:this.fromMagic,toMagic:this.toMagic,applyBlockHeight:this.applyBlockHeight,effectiveBlockHeight:this.effectiveBlockHeight,signature:this.signature,remark:this.remark,asset:this.asset.toJSON()};return this.recipientId&&(e.recipientId=this.recipientId),this.dappid&&(e.dappid=this.dappid),this.lns&&(e.lns=this.lns),this.sourceIP&&(e.sourceIP=this.sourceIP),this.senderSecondPublicKey&&(e.senderSecondPublicKey=this.senderSecondPublicKey),this.signSignature&&(e.signSignature=this.signSignature),this.storageKey&&(e.storageKey=this.storageKey),this.storageValue&&(e.storageValue=this.storageValue),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.senderPublicKey&&(t.senderPublicKey=e.senderPublicKey),e.senderSecondPublicKey&&(t.senderSecondPublicKey=e.senderSecondPublicKey),e.signature&&(t.signature=e.signature),e.signSignature&&(t.signSignature=e.signSignature),!t.storage&&typeof e.storageKey=="string"&&typeof e.storageValue=="string"&&(t.storage=new Ts({key:e.storageKey,value:e.storageValue}))),t}as(e,t){}};rt.INC=1;u([I.d(Ut.INC++,"uint32"),g("design:type",Number)],rt.prototype,"version",void 0);u([I.d(Ut.INC++,"string"),g("design:type",String)],rt.prototype,"type",void 0);u([I.d(Ut.INC++,"string"),g("design:type",String)],rt.prototype,"senderId",void 0);u([I.d(Ut.INC++,"bytes"),g("design:type",Uint8Array)],rt.prototype,"senderPublicKeyBuffer",void 0);u([I.d(Ut.INC++,"bytes","optional"),g("design:type",Uint8Array)],rt.prototype,"senderSecondPublicKeyBuffer",void 0);u([I.d(Ut.INC++,"string","optional"),g("design:type",String)],rt.prototype,"recipientId",void 0);u([I.d(Ut.INC++,"uint32"),g("design:type",Number)],rt.prototype,"rangeType",void 0);u([I.d(Ut.INC++,"string","repeated"),g("design:type",Array)],rt.prototype,"range",void 0);u([I.d(Ut.INC++,"string"),g("design:type",String)],rt.prototype,"fee",void 0);u([I.d(Ut.INC++,"uint32"),g("design:type",Number)],rt.prototype,"timestamp",void 0);u([I.d(Ut.INC++,"string","optional"),g("design:type",String)],rt.prototype,"dappid",void 0);u([I.d(Ut.INC++,"string","optional"),g("design:type",String)],rt.prototype,"lns",void 0);u([I.d(Ut.INC++,"string","optional"),g("design:type",String)],rt.prototype,"sourceIP",void 0);u([I.d(Ut.INC++,"string"),g("design:type",String)],rt.prototype,"fromMagic",void 0);u([I.d(Ut.INC++,"string"),g("design:type",String)],rt.prototype,"toMagic",void 0);u([I.d(Ut.INC++,"uint32"),g("design:type",Number)],rt.prototype,"applyBlockHeight",void 0);u([I.d(Ut.INC++,"uint32"),g("design:type",Number)],rt.prototype,"effectiveBlockHeight",void 0);u([I.d(Ut.INC++,"bytes"),g("design:type",Uint8Array)],rt.prototype,"signatureBuffer",void 0);u([I.d(Ut.INC++,Ts,"optional"),g("design:type",Ts)],rt.prototype,"storage",void 0);u([I.d(Ut.INC++,"bytes","optional"),g("design:type",Uint8Array)],rt.prototype,"signSignatureBuffer",void 0);u([wr.d(Ut.INC++,"string","string"),g("design:type",Object)],rt.prototype,"remark",void 0);u([ai,g("design:type",Function),g("design:paramtypes",[Boolean,Boolean]),g("design:returntype",void 0)],rt.prototype,"getBytes",null);rt=Ut=u([j.d("Transaction")],rt);let We=class extends rt{as(e,t){const r=Me.MV.get(e),n=Me.trsTypeToV(this.type);if(r===n)if(t){if(this.signature===t)return this}else return this}};We=u([j.d("AbstractTransaction")],We);let pp=class extends oe{get publicKey(){return Pe(this.publicKeyBuffer)}set publicKey(e){this.publicKeyBuffer=be(e)}toJSON(){return{publicKey:this.publicKey}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.publicKey&&(t.publicKey=e.publicKey),t}};u([I.d(1,"bytes"),g("design:type",Uint8Array)],pp.prototype,"publicKeyBuffer",void 0);pp=u([j.d("SignatureModel")],pp);let hp=class extends oe{toJSON(){return{signature:this.signature.toJSON()}}};u([I.d(1,pp),g("design:type",pp)],hp.prototype,"signature",void 0);hp=u([j.d("SignatureAssetModel")],hp);var Ko;let Wr=Ko=class extends oe{toJSON(){const e={sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,dappid:this.dappid,type:this.type};return this.purchaseAsset&&(e.purchaseAsset=this.purchaseAsset),e}};Wr.INC=1;u([I.d(Ko.INC++,"string"),g("design:type",String)],Wr.prototype,"sourceChainName",void 0);u([I.d(Ko.INC++,"string"),g("design:type",String)],Wr.prototype,"sourceChainMagic",void 0);u([I.d(Ko.INC++,"string"),g("design:type",String)],Wr.prototype,"dappid",void 0);u([I.d(Ko.INC++,"uint32"),g("design:type",Number)],Wr.prototype,"type",void 0);u([I.d(Ko.INC++,"string","optional"),g("design:type",String)],Wr.prototype,"purchaseAsset",void 0);Wr=Ko=u([j.d("DAppModel")],Wr);let lp=class extends oe{toJSON(){return{dapp:this.dapp.toJSON()}}};u([I.d(1,Wr),g("design:type",Wr)],lp.prototype,"dapp",void 0);lp=u([j.d("DAppAssetModel")],lp);var oy;let Pa=oy=class extends oe{toJSON(){return{dappAsset:this.dappAsset.toJSON()}}};Pa.INC=1;u([I.d(oy.INC++,Wr),g("design:type",Wr)],Pa.prototype,"dappAsset",void 0);Pa=oy=u([j.d("DAppPurchasingModel")],Pa);let up=class extends oe{toJSON(){return{dappPurchasing:this.dappPurchasing.toJSON()}}};u([I.d(1,Pa),g("design:type",Pa)],up.prototype,"dappPurchasing",void 0);up=u([j.d("DAppPurchasingAssetModel")],up);var rl;let vi=rl=class extends oe{toJSON(){return{content:this.content,action:this.action,dapp:this.dapp.toJSON()}}};vi.INC=1;u([I.d(rl.INC++,"string"),g("design:type",String)],vi.prototype,"content",void 0);u([I.d(rl.INC++,"string"),g("design:type",String)],vi.prototype,"action",void 0);u([I.d(rl.INC++,Wr),g("design:type",Wr)],vi.prototype,"dapp",void 0);vi=rl=u([j.d("MarkModel")],vi);let gp=class extends oe{toJSON(){return{mark:this.mark.toJSON()}}};u([I.d(1,vi),g("design:type",vi)],gp.prototype,"mark",void 0);gp=u([j.d("MarkAssetModel")],gp);let Bi=class extends oe{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,expectedIssuedAssets:this.expectedIssuedAssets}}};u([I.d(1,"string"),g("design:type",String)],Bi.prototype,"sourceChainName",void 0);u([I.d(2,"string"),g("design:type",String)],Bi.prototype,"sourceChainMagic",void 0);u([I.d(3,"string"),g("design:type",String)],Bi.prototype,"assetType",void 0);u([I.d(4,"string"),g("design:type",String)],Bi.prototype,"expectedIssuedAssets",void 0);Bi=u([j.d("IssueAssetModel")],Bi);let fp=class extends oe{toJSON(){return{issueAsset:this.issueAsset.toJSON()}}};u([I.d(1,Bi),g("design:type",Bi)],fp.prototype,"issueAsset",void 0);fp=u([j.d("IssueAssetAssetModel")],fp);let bs=class extends oe{toJSON(){return{applyAddress:this.applyAddress,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,increasedAssetPrealnum:this.increasedAssetPrealnum,frozenMainAssetPrealnum:this.frozenMainAssetPrealnum}}};u([I.d(1,"string"),g("design:type",String)],bs.prototype,"applyAddress",void 0);u([I.d(2,"string"),g("design:type",String)],bs.prototype,"sourceChainName",void 0);u([I.d(3,"string"),g("design:type",String)],bs.prototype,"sourceChainMagic",void 0);u([I.d(4,"string"),g("design:type",String)],bs.prototype,"assetType",void 0);u([I.d(5,"string"),g("design:type",String)],bs.prototype,"increasedAssetPrealnum",void 0);u([I.d(6,"string"),g("design:type",String)],bs.prototype,"frozenMainAssetPrealnum",void 0);bs=u([j.d("IncreaseAssetModel")],bs);let dp=class extends oe{toJSON(){return{increaseAsset:this.increaseAsset.toJSON()}}};u([I.d(1,bs),g("design:type",bs)],dp.prototype,"increaseAsset",void 0);dp=u([j.d("IncreaseAssetAssetModel")],dp);let Pi=class extends oe{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,amount:this.amount}}};u([I.d(1,"string"),g("design:type",String)],Pi.prototype,"sourceChainName",void 0);u([I.d(2,"string"),g("design:type",String)],Pi.prototype,"sourceChainMagic",void 0);u([I.d(3,"string"),g("design:type",String)],Pi.prototype,"assetType",void 0);u([I.d(4,"string"),g("design:type",String)],Pi.prototype,"amount",void 0);Pi=u([j.d("TransferAssetModel")],Pi);let yp=class extends oe{toJSON(){return{transferAsset:this.transferAsset.toJSON()}}};u([I.d(1,Pi),g("design:type",Pi)],yp.prototype,"transferAsset",void 0);yp=u([j.d("TransferAssetAssetModel")],yp);let ki=class extends oe{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,amount:this.amount}}};u([I.d(1,"string"),g("design:type",String)],ki.prototype,"sourceChainName",void 0);u([I.d(2,"string"),g("design:type",String)],ki.prototype,"sourceChainMagic",void 0);u([I.d(3,"string"),g("design:type",String)],ki.prototype,"assetType",void 0);u([I.d(4,"string"),g("design:type",String)],ki.prototype,"amount",void 0);ki=u([j.d("DestroyAssetModel")],ki);let mp=class extends oe{toJSON(){return{destroyAsset:this.destroyAsset.toJSON()}}};u([I.d(1,ki),g("design:type",ki)],mp.prototype,"destroyAsset",void 0);mp=u([j.d("DestroyAssetAssetModel")],mp);var Bs;const i_=new WeakMap;let jr=Bs=class extends oe{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=i_.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Pe(r))),t}set cipherPublicKeys(e){const t=e.map(r=>be(r));i_.set(t,e),this.cipherPublicKeysBuffer=t}toJSON(){const e={cipherPublicKeys:this.cipherPublicKeys,sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,assetType:this.assetType,amount:this.amount,totalGrabableTimes:this.totalGrabableTimes,giftDistributionRule:this.giftDistributionRule};return this.beginUnfrozenBlockHeight&&(e.beginUnfrozenBlockHeight=this.beginUnfrozenBlockHeight),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};jr.INC=1;u([I.d(Bs.INC++,"bytes","repeated"),g("design:type",Array)],jr.prototype,"cipherPublicKeysBuffer",void 0);u([I.d(Bs.INC++,"string"),g("design:type",String)],jr.prototype,"sourceChainMagic",void 0);u([I.d(Bs.INC++,"string"),g("design:type",String)],jr.prototype,"sourceChainName",void 0);u([I.d(Bs.INC++,"string"),g("design:type",String)],jr.prototype,"assetType",void 0);u([I.d(Bs.INC++,"string"),g("design:type",String)],jr.prototype,"amount",void 0);u([I.d(Bs.INC++,"uint32"),g("design:type",Number)],jr.prototype,"totalGrabableTimes",void 0);u([I.d(Bs.INC++,"uint32","optional"),g("design:type",Number)],jr.prototype,"beginUnfrozenBlockHeight",void 0);u([I.d(Bs.INC++,"uint32"),g("design:type",Number)],jr.prototype,"giftDistributionRule",void 0);jr=Bs=u([j.d("GiftAssetModel")],jr);let _p=class extends oe{toJSON(){return{giftAsset:this.giftAsset.toJSON()}}};u([I.d(1,jr),g("design:type",jr)],_p.prototype,"giftAsset",void 0);_p=u([j.d("GiftAssetAssetModel")],_p);var jo;const Ag=new WeakMap;let qn=jo=class extends oe{get blockSignature(){return Pe(this.blockSignatureBuffer)}set blockSignature(e){this.blockSignatureBuffer=be(e)}get transactionSignature(){return Pe(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=be(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=bt.decode(e);return Ag.set(t,e),t}set ciphertextSignature(e){if(e){let t=Ag.get(e);t||(t=bt.encode(e).finish(),Ag.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={blockSignature:this.blockSignature,transactionSignature:this.transactionSignature,amount:this.amount,giftAsset:this.giftAsset.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.blockSignature&&(t.blockSignature=e.blockSignature),e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=bt.fromObject(e.ciphertextSignature))),t}};qn.INC=1;u([I.d(jo.INC++,"bytes"),g("design:type",Uint8Array)],qn.prototype,"blockSignatureBuffer",void 0);u([I.d(jo.INC++,"bytes"),g("design:type",Uint8Array)],qn.prototype,"transactionSignatureBuffer",void 0);u([I.d(jo.INC++,"string"),g("design:type",String)],qn.prototype,"amount",void 0);u([I.d(jo.INC++,"bytes","optional"),g("design:type",Uint8Array)],qn.prototype,"ciphertextSignatureBuffer",void 0);u([I.d(jo.INC++,jr),g("design:type",jr)],qn.prototype,"giftAsset",void 0);qn=jo=u([j.d("GrabAssetModel")],qn);let Ap=class extends oe{toJSON(){return{grabAsset:this.grabAsset.toJSON()}}};u([I.d(1,qn),g("design:type",qn)],Ap.prototype,"grabAsset",void 0);Ap=u([j.d("GrabAssetAssetModel")],Ap);var Ji;let un=Ji=class extends oe{toJSON(){return{trustees:this.trustees,numberOfSignFor:this.numberOfSignFor,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,amount:this.amount}}};un.INC=1;u([I.d(Ji.INC++,"string","repeated"),g("design:type",Array)],un.prototype,"trustees",void 0);u([I.d(Ji.INC++,"uint32"),g("design:type",Number)],un.prototype,"numberOfSignFor",void 0);u([I.d(Ji.INC++,"string"),g("design:type",String)],un.prototype,"sourceChainName",void 0);u([I.d(Ji.INC++,"string"),g("design:type",String)],un.prototype,"sourceChainMagic",void 0);u([I.d(Ji.INC++,"string"),g("design:type",String)],un.prototype,"assetType",void 0);u([I.d(Ji.INC++,"string"),g("design:type",String)],un.prototype,"amount",void 0);un=Ji=u([j.d("TrustAssetModel")],un);let Ep=class extends oe{toJSON(){return{trustAsset:this.trustAsset.toJSON()}}};u([I.d(1,un),g("design:type",un)],Ep.prototype,"trustAsset",void 0);Ep=u([j.d("TrustAssetAssetModel")],Ep);var wc;let ws=wc=class extends oe{get transactionSignature(){return Pe(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=be(e)}getBytes(){const e=Object.create(this,{signatureBufferList:{value:null}});return this.$type.encode(e).finish()}toJSON(){return{transactionSignature:this.transactionSignature,trustSenderId:this.trustSenderId,trustRecipientId:this.trustRecipientId,trustAsset:this.trustAsset.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.transactionSignature&&(t.transactionSignature=e.transactionSignature),t}};ws.INC=1;u([I.d(wc.INC++,"bytes"),g("design:type",Uint8Array)],ws.prototype,"transactionSignatureBuffer",void 0);u([I.d(wc.INC++,"string"),g("design:type",String)],ws.prototype,"trustSenderId",void 0);u([I.d(wc.INC++,"string"),g("design:type",String)],ws.prototype,"trustRecipientId",void 0);u([I.d(wc.INC++,un),g("design:type",un)],ws.prototype,"trustAsset",void 0);u([ai,g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",void 0)],ws.prototype,"getBytes",null);ws=wc=u([j.d("SignForAssetModel")],ws);let Ip=class extends oe{toJSON(){return{signForAsset:this.signForAsset.toJSON()}}};u([I.d(1,ws),g("design:type",ws)],Ip.prototype,"signForAsset",void 0);Ip=u([j.d("SignForAssetAssetModel")],Ip);let Tp=class extends oe{toJSON(){return{migrateCertificate:this.migrateCertificate}}};u([I.d(1,"string"),g("design:type",String)],Tp.prototype,"migrateCertificate",void 0);Tp=u([j.d("EmigrateAssetModel")],Tp);let bp=class extends oe{toJSON(){return{emigrateAsset:this.emigrateAsset.toJSON()}}};u([I.d(1,Tp),g("design:type",Tp)],bp.prototype,"emigrateAsset",void 0);bp=u([j.d("EmigrateAssetAssetModel")],bp);let wp=class extends oe{toJSON(){return{migrateCertificate:this.migrateCertificate}}};u([I.d(1,"string"),g("design:type",String)],wp.prototype,"migrateCertificate",void 0);wp=u([j.d("ImmigrateAssetModel")],wp);let Sp=class extends oe{toJSON(){return{immigrateAsset:this.immigrateAsset.toJSON()}}};u([I.d(1,wp),g("design:type",wp)],Sp.prototype,"immigrateAsset",void 0);Sp=u([j.d("ImmigrateAssetAssetModel")],Sp);var cs;const Eg=new WeakMap;let yr=cs=class extends oe{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=Eg.get(e);return t||(t=Object.freeze(e.map(r=>Pe(r))),Eg.set(e,t)),t}set cipherPublicKeys(e){const t=[];for(const r of e)t.push(be(r));Object.isFrozen(e)&&Eg.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return{magic:this.toExchangeSource,chainName:this.toExchangeChainName,assetType:this.toExchangeAsset,amount:this.toExchangeNumber}}get be(){return{magic:this.beExchangeSource,chainName:this.beExchangeChainName,assetType:this.beExchangeAsset}}toJSON(){return{cipherPublicKeys:this.cipherPublicKeys,toExchangeSource:this.toExchangeSource,beExchangeSource:this.beExchangeSource,toExchangeChainName:this.toExchangeChainName,beExchangeChainName:this.beExchangeChainName,toExchangeAsset:this.toExchangeAsset,beExchangeAsset:this.beExchangeAsset,toExchangeNumber:this.toExchangeNumber,exchangeRate:this.exchangeRate.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};yr.INC=1;u([I.d(cs.INC++,"bytes","repeated"),g("design:type",Array)],yr.prototype,"cipherPublicKeysBuffer",void 0);u([I.d(cs.INC++,"string"),g("design:type",String)],yr.prototype,"toExchangeSource",void 0);u([I.d(cs.INC++,"string"),g("design:type",String)],yr.prototype,"beExchangeSource",void 0);u([I.d(cs.INC++,"string"),g("design:type",String)],yr.prototype,"toExchangeChainName",void 0);u([I.d(cs.INC++,"string"),g("design:type",String)],yr.prototype,"beExchangeChainName",void 0);u([I.d(cs.INC++,"string"),g("design:type",String)],yr.prototype,"toExchangeAsset",void 0);u([I.d(cs.INC++,"string"),g("design:type",String)],yr.prototype,"beExchangeAsset",void 0);u([I.d(cs.INC++,"string"),g("design:type",String)],yr.prototype,"toExchangeNumber",void 0);u([I.d(cs.INC++,Ba),g("design:type",Ba)],yr.prototype,"exchangeRate",void 0);u([ge,g("design:type",Object),g("design:paramtypes",[])],yr.prototype,"to",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],yr.prototype,"be",null);yr=cs=u([j.d("ToExchangeAssetModel")],yr);let Np=class extends oe{toJSON(){return{toExchangeAsset:this.toExchangeAsset.toJSON()}}};u([I.d(1,yr),g("design:type",yr)],Np.prototype,"toExchangeAsset",void 0);Np=u([j.d("ToExchangeAssetAssetModel")],Np);var zo;const Ig=new WeakMap;let Zn=zo=class extends oe{get transactionSignature(){return Pe(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=be(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=bt.decode(e);return Ig.set(t,e),t}set ciphertextSignature(e){if(e){let t=Ig.get(e);t||(t=bt.encode(e).finish(),Ig.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}get to(){return{magic:this.exchangeAsset.toExchangeSource,chainName:this.exchangeAsset.toExchangeChainName,assetType:this.exchangeAsset.toExchangeAsset,amount:this.toExchangeNumber}}get be(){return{magic:this.exchangeAsset.beExchangeSource,chainName:this.exchangeAsset.beExchangeChainName,assetType:this.exchangeAsset.beExchangeAsset,amount:this.beExchangeNumber}}get exchangeRate(){return this.exchangeAsset.exchangeRate}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeNumber:this.toExchangeNumber,beExchangeNumber:this.beExchangeNumber,exchangeAsset:this.exchangeAsset.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=bt.fromObject(e.ciphertextSignature))),t}};Zn.INC=1;u([I.d(zo.INC++,"bytes"),g("design:type",Uint8Array)],Zn.prototype,"transactionSignatureBuffer",void 0);u([I.d(zo.INC++,"bytes","optional"),g("design:type",Uint8Array)],Zn.prototype,"ciphertextSignatureBuffer",void 0);u([I.d(zo.INC++,"string"),g("design:type",String)],Zn.prototype,"toExchangeNumber",void 0);u([I.d(zo.INC++,"string"),g("design:type",String)],Zn.prototype,"beExchangeNumber",void 0);u([I.d(zo.INC++,yr),g("design:type",yr)],Zn.prototype,"exchangeAsset",void 0);u([ge,g("design:type",Object),g("design:paramtypes",[])],Zn.prototype,"to",null);Zn=zo=u([j.d("BeExchangeAssetModel")],Zn);let Op=class extends oe{toJSON(){return{beExchangeAsset:this.beExchangeAsset.toJSON()}}};u([I.d(1,Zn),g("design:type",Zn)],Op.prototype,"beExchangeAsset",void 0);Op=u([j.d("BeExchangeAssetAssetModel")],Op);var Yi;let es=Yi=class extends oe{toJSON(){return{stakeId:this.stakeId,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,assetPrealnum:this.assetPrealnum,beginUnstakeHeight:this.beginUnstakeHeight}}};es.INC=1;u([I.d(Yi.INC++,"string"),g("design:type",String)],es.prototype,"stakeId",void 0);u([I.d(Yi.INC++,"string"),g("design:type",String)],es.prototype,"sourceChainName",void 0);u([I.d(Yi.INC++,"string"),g("design:type",String)],es.prototype,"sourceChainMagic",void 0);u([I.d(Yi.INC++,"string"),g("design:type",String)],es.prototype,"assetType",void 0);u([I.d(Yi.INC++,"string"),g("design:type",String)],es.prototype,"assetPrealnum",void 0);u([I.d(Yi.INC++,"uint32"),g("design:type",Number)],es.prototype,"beginUnstakeHeight",void 0);es=Yi=u([j.d("StakeAssetModel")],es);let Cp=class extends oe{toJSON(){return{stakeAsset:this.stakeAsset.toJSON()}}};u([I.d(1,es),g("design:type",es)],Cp.prototype,"stakeAsset",void 0);Cp=u([j.d("StakeAssetAssetModel")],Cp);var Jo;let Ss=Jo=class extends oe{toJSON(){return{stakeId:this.stakeId,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,assetPrealnum:this.assetPrealnum}}};Ss.INC=1;u([I.d(Jo.INC++,"string"),g("design:type",String)],Ss.prototype,"stakeId",void 0);u([I.d(Jo.INC++,"string"),g("design:type",String)],Ss.prototype,"sourceChainName",void 0);u([I.d(Jo.INC++,"string"),g("design:type",String)],Ss.prototype,"sourceChainMagic",void 0);u([I.d(Jo.INC++,"string"),g("design:type",String)],Ss.prototype,"assetType",void 0);u([I.d(Jo.INC++,"string"),g("design:type",String)],Ss.prototype,"assetPrealnum",void 0);Ss=Jo=u([j.d("UnstakeAssetModel")],Ss);let xp=class extends oe{toJSON(){return{unstakeAsset:this.unstakeAsset.toJSON()}}};u([I.d(1,Ss),g("design:type",Ss)],xp.prototype,"unstakeAsset",void 0);xp=u([j.d("UnstakeAssetAssetModel")],xp);let Hi=class extends oe{toJSON(){return{name:this.name,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,operationType:this.operationType}}};u([I.d(1,"string"),g("design:type",String)],Hi.prototype,"name",void 0);u([I.d(2,"string"),g("design:type",String)],Hi.prototype,"sourceChainName",void 0);u([I.d(3,"string"),g("design:type",String)],Hi.prototype,"sourceChainMagic",void 0);u([I.d(4,"uint32"),g("design:type",Number)],Hi.prototype,"operationType",void 0);Hi=u([j.d("LocationNameInfo")],Hi);let Rp=class extends oe{toJSON(){return{locationName:this.locationName.toJSON()}}};u([I.d(1,Hi),g("design:type",Hi)],Rp.prototype,"locationName",void 0);Rp=u([j.d("LocationNameAssetModel")],Rp);let fo=class extends oe{toJSON(){return{name:this.name,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic}}};u([I.d(1,"string"),g("design:type",String)],fo.prototype,"name",void 0);u([I.d(2,"string"),g("design:type",String)],fo.prototype,"sourceChainName",void 0);u([I.d(3,"string"),g("design:type",String)],fo.prototype,"sourceChainMagic",void 0);fo=u([j.d("SetLnsManagerModel")],fo);let vp=class extends oe{toJSON(){return{lnsManager:this.lnsManager.toJSON()}}};u([I.d(1,fo),g("design:type",fo)],vp.prototype,"lnsManager",void 0);vp=u([j.d("SetLnsManagerAssetModel")],vp);let Mi=class extends oe{toJSON(){return{recordType:this.recordType,recordValue:this.recordValue}}};u([I.d(1,"int32"),g("design:type",Number)],Mi.prototype,"recordType",void 0);u([I.d(2,"string"),g("design:type",String)],Mi.prototype,"recordValue",void 0);Mi=u([j.d("LocationNameRecordInfo")],Mi);var Qi;let ts=Qi=class extends oe{toJSON(){const e={name:this.name,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,operationType:this.operationType};return this.addRecord&&(e.addRecord=this.addRecord.toJSON()),this.deleteRecord&&(e.deleteRecord=this.deleteRecord.toJSON()),e}};ts.INC=1;u([I.d(Qi.INC++,"string"),g("design:type",String)],ts.prototype,"name",void 0);u([I.d(Qi.INC++,"string"),g("design:type",String)],ts.prototype,"sourceChainName",void 0);u([I.d(Qi.INC++,"string"),g("design:type",String)],ts.prototype,"sourceChainMagic",void 0);u([I.d(Qi.INC++,"uint32"),g("design:type",Number)],ts.prototype,"operationType",void 0);u([I.d(Qi.INC++,Mi,"optional"),g("design:type",Mi)],ts.prototype,"addRecord",void 0);u([I.d(Qi.INC++,Mi,"optional"),g("design:type",Mi)],ts.prototype,"deleteRecord",void 0);ts=Qi=u([j.d("SetLnsRecordValueModel")],ts);let Bp=class extends oe{toJSON(){return{lnsRecordValue:this.lnsRecordValue.toJSON()}}};u([I.d(1,ts),g("design:type",ts)],Bp.prototype,"lnsRecordValue",void 0);Bp=u([j.d("SetLnsRecordValueAssetModel")],Bp);let Kl=class extends oe{toJSON(){return{senderPaidFeeRate:this.senderPaidFeeRate.toJSON(),recipientPaidFeeRate:this.recipientPaidFeeRate.toJSON()}}};u([I.d(1,Is),g("design:type",Is)],Kl.prototype,"senderPaidFeeRate",void 0);u([I.d(2,Is),g("design:type",Is)],Kl.prototype,"recipientPaidFeeRate",void 0);Kl=u([j.d("FeeRateModel")],Kl);var Xi;let cr=Xi=class extends oe{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,factoryId:this.factoryId,entityPrealnum:this.entityPrealnum,entityFrozenAssetPrealnum:this.entityFrozenAssetPrealnum,purchaseAssetPrealnum:this.purchaseAssetPrealnum}}};cr.INC=1;u([I.d(Xi.INC++,"string"),g("design:type",String)],cr.prototype,"sourceChainName",void 0);u([I.d(Xi.INC++,"string"),g("design:type",String)],cr.prototype,"sourceChainMagic",void 0);u([I.d(Xi.INC++,"string"),g("design:type",String)],cr.prototype,"factoryId",void 0);u([I.d(Xi.INC++,"string"),g("design:type",String)],cr.prototype,"entityPrealnum",void 0);u([I.d(Xi.INC++,"string"),g("design:type",String)],cr.prototype,"entityFrozenAssetPrealnum",void 0);u([I.d(Xi.INC++,"string"),g("design:type",String)],cr.prototype,"purchaseAssetPrealnum",void 0);cr=Xi=u([j.d("IssueEntityFactoryModel")],cr);let yo=class extends oe{toJSON(){return{issueEntityFactory:this.issueEntityFactory.toJSON()}}};u([I.d(1,cr),g("design:type",cr)],yo.prototype,"issueEntityFactory",void 0);yo=u([j.d("IssueEntityFactoryAssetModel")],yo);var Yo;let Bn=Yo=class extends oe{toJSON(){const e={sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,entityId:this.entityId,taxAssetPrealnum:this.taxAssetPrealnum,entityFactoryPossessor:this.entityFactoryPossessor,entityFactory:this.entityFactory.toJSON()};return this.taxAssetRecipientId&&(e.taxAssetRecipientId=this.taxAssetRecipientId),e}};Bn.INC=1;u([I.d(Yo.INC++,"string"),g("design:type",String)],Bn.prototype,"sourceChainName",void 0);u([I.d(Yo.INC++,"string"),g("design:type",String)],Bn.prototype,"sourceChainMagic",void 0);u([I.d(Yo.INC++,"string"),g("design:type",String)],Bn.prototype,"entityId",void 0);u([I.d(cr.INC++,"string"),g("design:type",String)],Bn.prototype,"taxAssetPrealnum",void 0);u([I.d(Yo.INC++,"string"),g("design:type",String)],Bn.prototype,"entityFactoryPossessor",void 0);u([I.d(Yo.INC++,cr),g("design:type",cr)],Bn.prototype,"entityFactory",void 0);u([I.d(cr.INC++,"string","optional"),g("design:type",String)],Bn.prototype,"taxAssetRecipientId",void 0);Bn=Yo=u([j.d("IssueEntityModel")],Bn);let Pp=class extends oe{toJSON(){return{issueEntity:this.issueEntity.toJSON()}}};u([I.d(1,Bn),g("design:type",Bn)],Pp.prototype,"issueEntity",void 0);Pp=u([j.d("IssueEntityAssetModel")],Pp);var ci;let Pn=ci=class extends oe{get transactionSignature(){return Pe(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=be(e)}toJSON(){return{transactionSignature:this.transactionSignature,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,entityId:this.entityId,entityFactoryApplicant:this.entityFactoryApplicant,entityFactoryPossessor:this.entityFactoryPossessor,entityFactory:this.entityFactory.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.transactionSignature&&(t.transactionSignature=e.transactionSignature),t}};Pn.INC=1;u([I.d(ci.INC++,"bytes"),g("design:type",Uint8Array)],Pn.prototype,"transactionSignatureBuffer",void 0);u([I.d(ci.INC++,"string"),g("design:type",String)],Pn.prototype,"sourceChainName",void 0);u([I.d(ci.INC++,"string"),g("design:type",String)],Pn.prototype,"sourceChainMagic",void 0);u([I.d(ci.INC++,"string"),g("design:type",String)],Pn.prototype,"entityId",void 0);u([I.d(ci.INC++,"string"),g("design:type",String)],Pn.prototype,"entityFactoryApplicant",void 0);u([I.d(ci.INC++,"string"),g("design:type",String)],Pn.prototype,"entityFactoryPossessor",void 0);u([I.d(ci.INC++,cr),g("design:type",cr)],Pn.prototype,"entityFactory",void 0);Pn=ci=u([j.d("DestroyEntityModel")],Pn);let kp=class extends oe{toJSON(){return{destroyEntity:this.destroyEntity.toJSON()}}};u([I.d(1,Pn),g("design:type",Pn)],kp.prototype,"destroyEntity",void 0);kp=u([j.d("DestroyEntityAssetModel")],kp);var Qo;let ka=class extends oe{toJSON(){const e={entityId:this.entityId,taxAssetPrealnum:this.taxAssetPrealnum};return this.taxAssetRecipientId&&(e.taxAssetRecipientId=this.taxAssetRecipientId),e}};u([I.d(1,"string"),g("design:type",String)],ka.prototype,"entityId",void 0);u([I.d(2,"string"),g("design:type",String)],ka.prototype,"taxAssetPrealnum",void 0);u([I.d(3,"string","optional"),g("design:type",String)],ka.prototype,"taxAssetRecipientId",void 0);ka=u([j.d("EntityStructModel")],ka);let Ns=Qo=class extends oe{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,entityStructList:this.entityStructList.map(e=>e.toJSON()),entityFactoryPossessor:this.entityFactoryPossessor,entityFactory:this.entityFactory.toJSON()}}};Ns.INC=1;u([I.d(Qo.INC++,"string"),g("design:type",String)],Ns.prototype,"sourceChainName",void 0);u([I.d(Qo.INC++,"string"),g("design:type",String)],Ns.prototype,"sourceChainMagic",void 0);u([I.d(Qo.INC++,ka,"repeated"),g("design:type",Array)],Ns.prototype,"entityStructList",void 0);u([I.d(Qo.INC++,"string"),g("design:type",String)],Ns.prototype,"entityFactoryPossessor",void 0);u([I.d(Qo.INC++,cr),g("design:type",cr)],Ns.prototype,"entityFactory",void 0);Ns=Qo=u([j.d("IssueEntityMultiModel")],Ns);let Hp=class extends oe{toJSON(){return{issueEntityMulti:this.issueEntityMulti.toJSON()}}};u([I.d(1,Ns),g("design:type",Ns)],Hp.prototype,"issueEntityMulti",void 0);Hp=u([j.d("IssueEntityMultiAssetModel")],Hp);let Os=class extends oe{toJSON(){const e={sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,parentAssetType:this.parentAssetType,assetType:this.assetType,amount:this.amount};return this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};u([I.d(1,"string"),g("design:type",String)],Os.prototype,"sourceChainName",void 0);u([I.d(2,"string"),g("design:type",String)],Os.prototype,"sourceChainMagic",void 0);u([I.d(3,ne),g("design:type",Number)],Os.prototype,"parentAssetType",void 0);u([I.d(4,"string"),g("design:type",String)],Os.prototype,"assetType",void 0);u([I.d(5,"string"),g("design:type",String)],Os.prototype,"amount",void 0);u([I.d(6,sr,"optional"),g("design:type",sr)],Os.prototype,"taxInformation",void 0);Os=u([j.d("TransferAnyModel")],Os);let Mp=class extends oe{toJSON(){return{transferAny:this.transferAny.toJSON()}}};u([I.d(1,Os),g("design:type",Os)],Mp.prototype,"transferAny",void 0);Mp=u([j.d("TransferAnyAssetModel")],Mp);var Mn;const o_=new WeakMap;let Sr=Mn=class extends oe{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=o_.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Pe(r))),t}set cipherPublicKeys(e){const t=e.map(r=>be(r));o_.set(t,e),this.cipherPublicKeysBuffer=t}toJSON(){const e={cipherPublicKeys:this.cipherPublicKeys,sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,parentAssetType:this.parentAssetType,assetType:this.assetType,amount:this.amount,totalGrabableTimes:this.totalGrabableTimes};return this.giftDistributionRule!==void 0&&(e.giftDistributionRule=this.giftDistributionRule),this.beginUnfrozenBlockHeight&&(e.beginUnfrozenBlockHeight=this.beginUnfrozenBlockHeight),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Sr.INC=1;u([I.d(Mn.INC++,"bytes","repeated"),g("design:type",Array)],Sr.prototype,"cipherPublicKeysBuffer",void 0);u([I.d(Mn.INC++,"string"),g("design:type",String)],Sr.prototype,"sourceChainMagic",void 0);u([I.d(Mn.INC++,"string"),g("design:type",String)],Sr.prototype,"sourceChainName",void 0);u([I.d(Mn.INC++,ne),g("design:type",Number)],Sr.prototype,"parentAssetType",void 0);u([I.d(Mn.INC++,"string"),g("design:type",String)],Sr.prototype,"assetType",void 0);u([I.d(Mn.INC++,"string"),g("design:type",String)],Sr.prototype,"amount",void 0);u([I.d(Mn.INC++,"uint32"),g("design:type",Number)],Sr.prototype,"totalGrabableTimes",void 0);u([I.d(Mn.INC++,"uint32","optional"),g("design:type",Number)],Sr.prototype,"beginUnfrozenBlockHeight",void 0);u([I.d(Mn.INC++,"uint32","optional"),g("design:type",Number)],Sr.prototype,"giftDistributionRule",void 0);u([I.d(Mn.INC++,sr,"optional"),g("design:type",sr)],Sr.prototype,"taxInformation",void 0);Sr=Mn=u([j.d("GiftAnyModel")],Sr);let Lp=class extends oe{toJSON(){return{giftAny:this.giftAny.toJSON()}}};u([I.d(1,Sr),g("design:type",Sr)],Lp.prototype,"giftAny",void 0);Lp=u([j.d("GiftAnyAssetModel")],Lp);var Xo;const Tg=new WeakMap;let Cs=Xo=class extends oe{get blockSignature(){return Pe(this.blockSignatureBuffer)}set blockSignature(e){this.blockSignatureBuffer=be(e)}get transactionSignature(){return Pe(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=be(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=bt.decode(e);return Tg.set(t,e),t}set ciphertextSignature(e){if(e){let t=Tg.get(e);t||(t=bt.encode(e).finish(),Tg.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={blockSignature:this.blockSignature,transactionSignature:this.transactionSignature,amount:this.amount,giftAny:this.giftAny.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.blockSignature&&(t.blockSignature=e.blockSignature),e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=bt.fromObject(e.ciphertextSignature))),t}};Cs.INC=1;u([I.d(Xo.INC++,"bytes"),g("design:type",Uint8Array)],Cs.prototype,"blockSignatureBuffer",void 0);u([I.d(Xo.INC++,"bytes"),g("design:type",Uint8Array)],Cs.prototype,"transactionSignatureBuffer",void 0);u([I.d(Xo.INC++,"string"),g("design:type",String)],Cs.prototype,"amount",void 0);u([I.d(Xo.INC++,"bytes","optional"),g("design:type",Uint8Array)],Cs.prototype,"ciphertextSignatureBuffer",void 0);u([I.d(Xo.INC++,Sr),g("design:type",Sr)],Cs.prototype,"giftAny",void 0);Cs=Xo=u([j.d("GrabAnyModel")],Cs);let Dp=class extends oe{toJSON(){return{grabAny:this.grabAny.toJSON()}}};u([I.d(1,Cs),g("design:type",Cs)],Dp.prototype,"grabAny",void 0);Dp=u([j.d("GrabAnyAssetModel")],Dp);var Jr;const a_=new WeakMap;let Li=class extends oe{toJSON(){return{toExchangeAssetWeight:this.toExchangeAssetWeight,beExchangeAssetWeight:this.beExchangeAssetWeight}}};u([I.d(1,"string"),g("design:type",String)],Li.prototype,"toExchangeAssetWeight",void 0);u([I.d(2,"string"),g("design:type",String)],Li.prototype,"beExchangeAssetWeight",void 0);Li=u([j.d("AssetExchangeWeightRatioModel")],Li);let Jt=Jr=class extends oe{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=a_.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Pe(r))),t}set cipherPublicKeys(e){const t=e.map(r=>be(r));a_.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return{magic:this.toExchangeSource,chainName:this.toExchangeChainName,toExchangeAssetType:this.toExchangeAssetType,toExchangeParentAssetType:this.toExchangeParentAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum}}get be(){return{magic:this.beExchangeSource,chainName:this.beExchangeChainName,beExchangeAssetType:this.beExchangeAssetType,beExchangeParentAssetType:this.beExchangeParentAssetType,beExchangeAssetPrealnum:this.beExchangeAssetPrealnum||"1"}}toJSON(){const e={cipherPublicKeys:this.cipherPublicKeys,toExchangeSource:this.toExchangeSource,beExchangeSource:this.beExchangeSource,toExchangeChainName:this.toExchangeChainName,beExchangeChainName:this.beExchangeChainName,toExchangeAssetType:this.toExchangeAssetType,beExchangeAssetType:this.beExchangeAssetType,toExchangeParentAssetType:this.toExchangeParentAssetType,beExchangeParentAssetType:this.beExchangeParentAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum};return this.beExchangeAssetPrealnum&&(e.beExchangeAssetPrealnum=this.beExchangeAssetPrealnum),this.assetExchangeWeightRatio&&(e.assetExchangeWeightRatio=this.assetExchangeWeightRatio.toJSON()),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Jt.INC=1;u([I.d(Jr.INC++,"bytes","repeated"),g("design:type",Array)],Jt.prototype,"cipherPublicKeysBuffer",void 0);u([I.d(Jr.INC++,"string"),g("design:type",String)],Jt.prototype,"toExchangeSource",void 0);u([I.d(Jr.INC++,"string"),g("design:type",String)],Jt.prototype,"beExchangeSource",void 0);u([I.d(Jr.INC++,"string"),g("design:type",String)],Jt.prototype,"toExchangeChainName",void 0);u([I.d(Jr.INC++,"string"),g("design:type",String)],Jt.prototype,"beExchangeChainName",void 0);u([I.d(Jr.INC++,ne),g("design:type",Number)],Jt.prototype,"toExchangeParentAssetType",void 0);u([I.d(Jr.INC++,ne),g("design:type",Number)],Jt.prototype,"beExchangeParentAssetType",void 0);u([I.d(Jr.INC++,"string"),g("design:type",String)],Jt.prototype,"toExchangeAssetType",void 0);u([I.d(Jr.INC++,"string"),g("design:type",String)],Jt.prototype,"beExchangeAssetType",void 0);u([I.d(Jr.INC++,"string"),g("design:type",String)],Jt.prototype,"toExchangeAssetPrealnum",void 0);u([I.d(Jr.INC++,"string","optional"),g("design:type",String)],Jt.prototype,"beExchangeAssetPrealnum",void 0);u([I.d(Jr.INC++,Li,"optional"),g("design:type",Li)],Jt.prototype,"assetExchangeWeightRatio",void 0);u([I.d(Jr.INC++,sr,"optional"),g("design:type",sr)],Jt.prototype,"taxInformation",void 0);u([ge,g("design:type",Object),g("design:paramtypes",[])],Jt.prototype,"to",null);Jt=Jr=u([j.d("ToExchangeAnyModel")],Jt);let Fp=class extends oe{toJSON(){return{toExchangeAny:this.toExchangeAny.toJSON()}}};u([I.d(1,Jt),g("design:type",Jt)],Fp.prototype,"toExchangeAny",void 0);Fp=u([j.d("ToExchangeAnyAssetModel")],Fp);var Wo;const bg=new WeakMap;let rs=Wo=class extends oe{get transactionSignature(){return Pe(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=be(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=bt.decode(e);return bg.set(t,e),t}set ciphertextSignature(e){if(e){let t=bg.get(e);t||(t=bt.encode(e).finish(),bg.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum,beExchangeAssetPrealnum:this.beExchangeAssetPrealnum,exchangeAny:this.exchangeAny.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=bt.fromObject(e.ciphertextSignature))),t}};rs.INC=1;u([I.d(Wo.INC++,"bytes"),g("design:type",Uint8Array)],rs.prototype,"transactionSignatureBuffer",void 0);u([I.d(Wo.INC++,"bytes","optional"),g("design:type",Uint8Array)],rs.prototype,"ciphertextSignatureBuffer",void 0);u([I.d(Wo.INC++,"string"),g("design:type",String)],rs.prototype,"toExchangeAssetPrealnum",void 0);u([I.d(Wo.INC++,"string"),g("design:type",String)],rs.prototype,"beExchangeAssetPrealnum",void 0);u([I.d(Wo.INC++,Jt),g("design:type",Jt)],rs.prototype,"exchangeAny",void 0);u([I.d(Jt.INC++,sr,"optional"),g("design:type",sr)],rs.prototype,"taxInformation",void 0);rs=Wo=u([j.d("BeExchangeAnyModel")],rs);let Up=class extends oe{toJSON(){return{beExchangeAny:this.beExchangeAny.toJSON()}}};u([I.d(1,rs),g("design:type",rs)],Up.prototype,"beExchangeAny",void 0);Up=u([j.d("BeExchangeAnyAssetModel")],Up);var pi,qo,nl;const c_=new WeakMap;let gn=pi=class extends oe{toJSON(){const e={toExchangeSource:this.toExchangeSource,toExchangeChainName:this.toExchangeChainName,toExchangeParentAssetType:this.toExchangeParentAssetType,toExchangeAssetType:this.toExchangeAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum};return this.assetExchangeWeightRatio&&(e.assetExchangeWeightRatio=this.assetExchangeWeightRatio.toJSON()),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};gn.INC=1;u([I.d(pi.INC++,"string"),g("design:type",String)],gn.prototype,"toExchangeSource",void 0);u([I.d(pi.INC++,"string"),g("design:type",String)],gn.prototype,"toExchangeChainName",void 0);u([I.d(pi.INC++,ne),g("design:type",Number)],gn.prototype,"toExchangeParentAssetType",void 0);u([I.d(pi.INC++,"string"),g("design:type",String)],gn.prototype,"toExchangeAssetType",void 0);u([I.d(pi.INC++,"string"),g("design:type",String)],gn.prototype,"toExchangeAssetPrealnum",void 0);u([I.d(pi.INC++,Li,"optional"),g("design:type",Li)],gn.prototype,"assetExchangeWeightRatio",void 0);u([I.d(pi.INC++,sr,"optional"),g("design:type",sr)],gn.prototype,"taxInformation",void 0);gn=pi=u([j.d("ToExchangeAssetV1Model")],gn);let fn=qo=class extends oe{toJSON(){const e={beExchangeSource:this.beExchangeSource,beExchangeChainName:this.beExchangeChainName,beExchangeParentAssetType:this.beExchangeParentAssetType,beExchangeAssetType:this.beExchangeAssetType};return this.beExchangeAssetPrealnum&&(e.beExchangeAssetPrealnum=this.beExchangeAssetPrealnum),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};fn.INC=1;u([I.d(qo.INC++,"string"),g("design:type",String)],fn.prototype,"beExchangeSource",void 0);u([I.d(qo.INC++,"string"),g("design:type",String)],fn.prototype,"beExchangeChainName",void 0);u([I.d(qo.INC++,ne),g("design:type",Number)],fn.prototype,"beExchangeParentAssetType",void 0);u([I.d(qo.INC++,"string"),g("design:type",String)],fn.prototype,"beExchangeAssetType",void 0);u([I.d(qo.INC++,"string","optional"),g("design:type",String)],fn.prototype,"beExchangeAssetPrealnum",void 0);u([I.d(gn.INC++,sr,"optional"),g("design:type",sr)],fn.prototype,"taxInformation",void 0);fn=qo=u([j.d("BeExchangeAssetV1Model")],fn);let Js=nl=class extends oe{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=c_.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Pe(r))),t}set cipherPublicKeys(e){const t=e.map(r=>be(r));c_.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return this.toExchangeAssets.map(e=>e.toJSON())}get be(){return this.beExchangeAsset.toJSON()}toJSON(){return{cipherPublicKeys:this.cipherPublicKeys,toExchangeAssets:this.toExchangeAssets.map(e=>e.toJSON()),beExchangeAsset:this.beExchangeAsset.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Js.INC=1;u([I.d(nl.INC++,"bytes","repeated"),g("design:type",Array)],Js.prototype,"cipherPublicKeysBuffer",void 0);u([I.d(nl.INC++,gn,"repeated"),g("design:type",Array)],Js.prototype,"toExchangeAssets",void 0);u([I.d(nl.INC++,fn),g("design:type",fn)],Js.prototype,"beExchangeAsset",void 0);u([ge,g("design:type",Object),g("design:paramtypes",[])],Js.prototype,"to",null);Js=nl=u([j.d("ToExchangeAnyMultiModel")],Js);let $p=class extends oe{toJSON(){return{toExchangeAnyMulti:this.toExchangeAnyMulti.toJSON()}}};u([I.d(1,Js),g("design:type",Js)],$p.prototype,"toExchangeAnyMulti",void 0);$p=u([j.d("ToExchangeAnyMultiAssetModel")],$p);var Sc;const wg=new WeakMap;let Ys=Sc=class extends oe{get transactionSignature(){return Pe(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=be(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=bt.decode(e);return wg.set(t,e),t}set ciphertextSignature(e){if(e){let t=wg.get(e);t||(t=bt.encode(e).finish(),wg.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeAssets:this.toExchangeAssets.map(t=>t.toJSON()),beExchangeAsset:this.beExchangeAsset.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=bt.fromObject(e.ciphertextSignature))),t}};Ys.INC=1;u([I.d(Sc.INC++,"bytes"),g("design:type",Uint8Array)],Ys.prototype,"transactionSignatureBuffer",void 0);u([I.d(Sc.INC++,"bytes","optional"),g("design:type",Uint8Array)],Ys.prototype,"ciphertextSignatureBuffer",void 0);u([I.d(Sc.INC++,gn,"repeated"),g("design:type",Array)],Ys.prototype,"toExchangeAssets",void 0);u([I.d(Sc.INC++,fn),g("design:type",fn)],Ys.prototype,"beExchangeAsset",void 0);Ys=Sc=u([j.d("BeExchangeAnyMultiModel")],Ys);let Vp=class extends oe{toJSON(){return{beExchangeAnyMulti:this.beExchangeAnyMulti.toJSON()}}};u([I.d(1,Ys),g("design:type",Ys)],Vp.prototype,"beExchangeAnyMulti",void 0);Vp=u([j.d("BeExchangeAnyMultiAssetModel")],Vp);var Wi,Zo,sl;const p_=new WeakMap;let kn=Wi=class extends oe{toJSON(){const e={toExchangeSource:this.toExchangeSource,toExchangeChainName:this.toExchangeChainName,toExchangeParentAssetType:this.toExchangeParentAssetType,toExchangeAssetType:this.toExchangeAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum};return this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};kn.INC=1;u([I.d(Wi.INC++,"string"),g("design:type",String)],kn.prototype,"toExchangeSource",void 0);u([I.d(Wi.INC++,"string"),g("design:type",String)],kn.prototype,"toExchangeChainName",void 0);u([I.d(Wi.INC++,ne),g("design:type",Number)],kn.prototype,"toExchangeParentAssetType",void 0);u([I.d(Wi.INC++,"string"),g("design:type",String)],kn.prototype,"toExchangeAssetType",void 0);u([I.d(Wi.INC++,"string"),g("design:type",String)],kn.prototype,"toExchangeAssetPrealnum",void 0);u([I.d(Wi.INC++,sr,"optional"),g("design:type",sr)],kn.prototype,"taxInformation",void 0);kn=Wi=u([j.d("ToExchangeAssetV2Model")],kn);let ns=Zo=class extends oe{toJSON(){const e={beExchangeSource:this.beExchangeSource,beExchangeChainName:this.beExchangeChainName,beExchangeParentAssetType:this.beExchangeParentAssetType,beExchangeAssetType:this.beExchangeAssetType,beExchangeAssetPrealnum:this.beExchangeAssetPrealnum};return this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};ns.INC=1;u([I.d(Zo.INC++,"string"),g("design:type",String)],ns.prototype,"beExchangeSource",void 0);u([I.d(Zo.INC++,"string"),g("design:type",String)],ns.prototype,"beExchangeChainName",void 0);u([I.d(Zo.INC++,ne),g("design:type",Number)],ns.prototype,"beExchangeParentAssetType",void 0);u([I.d(Zo.INC++,"string"),g("design:type",String)],ns.prototype,"beExchangeAssetType",void 0);u([I.d(Zo.INC++,"string"),g("design:type",String)],ns.prototype,"beExchangeAssetPrealnum",void 0);u([I.d(kn.INC++,sr,"optional"),g("design:type",sr)],ns.prototype,"taxInformation",void 0);ns=Zo=u([j.d("BeExchangeAssetV2Model")],ns);let Qs=sl=class extends oe{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=p_.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Pe(r))),t}set cipherPublicKeys(e){const t=e.map(r=>be(r));p_.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return this.toExchangeAssets.map(e=>e.toJSON())}get be(){return this.beExchangeAssets.map(e=>e.toJSON())}toJSON(){return{cipherPublicKeys:this.cipherPublicKeys,toExchangeAssets:this.toExchangeAssets.map(e=>e.toJSON()),beExchangeAssets:this.beExchangeAssets.map(e=>e.toJSON())}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Qs.INC=1;u([I.d(sl.INC++,"bytes","repeated"),g("design:type",Array)],Qs.prototype,"cipherPublicKeysBuffer",void 0);u([I.d(sl.INC++,kn,"repeated"),g("design:type",Array)],Qs.prototype,"toExchangeAssets",void 0);u([I.d(sl.INC++,ns,"repeated"),g("design:type",Array)],Qs.prototype,"beExchangeAssets",void 0);u([ge,g("design:type",Object),g("design:paramtypes",[])],Qs.prototype,"to",null);Qs=sl=u([j.d("ToExchangeAnyMultiAllModel")],Qs);let Gp=class extends oe{toJSON(){return{toExchangeAnyMultiAll:this.toExchangeAnyMultiAll.toJSON()}}};u([I.d(1,Qs),g("design:type",Qs)],Gp.prototype,"toExchangeAnyMultiAll",void 0);Gp=u([j.d("ToExchangeAnyMultiAllAssetModel")],Gp);var Nc;const Sg=new WeakMap;let Xs=Nc=class extends oe{get transactionSignature(){return Pe(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=be(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=bt.decode(e);return Sg.set(t,e),t}set ciphertextSignature(e){if(e){let t=Sg.get(e);t||(t=bt.encode(e).finish(),Sg.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeAssets:this.toExchangeAssets.map(t=>t.toJSON()),beExchangeAssets:this.beExchangeAssets.map(t=>t.toJSON())};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=bt.fromObject(e.ciphertextSignature))),t}};Xs.INC=1;u([I.d(Nc.INC++,"bytes"),g("design:type",Uint8Array)],Xs.prototype,"transactionSignatureBuffer",void 0);u([I.d(Nc.INC++,"bytes","optional"),g("design:type",Uint8Array)],Xs.prototype,"ciphertextSignatureBuffer",void 0);u([I.d(Nc.INC++,kn,"repeated"),g("design:type",Array)],Xs.prototype,"toExchangeAssets",void 0);u([I.d(Nc.INC++,ns,"repeated"),g("design:type",Array)],Xs.prototype,"beExchangeAssets",void 0);Xs=Nc=u([j.d("BeExchangeAnyMultiAllModel")],Xs);let Kp=class extends oe{toJSON(){return{beExchangeAnyMultiAll:this.beExchangeAnyMultiAll.toJSON()}}};u([I.d(1,Xs),g("design:type",Xs)],Kp.prototype,"beExchangeAnyMultiAll",void 0);Kp=u([j.d("BeExchangeAnyMultiAllAssetModel")],Kp);var Oc;let Ws=Oc=class extends oe{toJSON(){return{sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,certificateId:this.certificateId,type:this.type}}};Ws.INC=1;u([I.d(Oc.INC++,"string"),g("design:type",String)],Ws.prototype,"sourceChainName",void 0);u([I.d(Oc.INC++,"string"),g("design:type",String)],Ws.prototype,"sourceChainMagic",void 0);u([I.d(Oc.INC++,"string"),g("design:type",String)],Ws.prototype,"certificateId",void 0);u([I.d(Oc.INC++,"uint32"),g("design:type",Number)],Ws.prototype,"type",void 0);Ws=Oc=u([j.d("IssueCertificateModel")],Ws);let jp=class extends oe{toJSON(){return{issueCertificate:this.issueCertificate.toJSON()}}};u([I.d(1,Ws),g("design:type",Ws)],jp.prototype,"issueCertificate",void 0);jp=u([j.d("IssueCertificateAssetModel")],jp);var Cc;let qs=Cc=class extends oe{toJSON(){return{sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,certificateId:this.certificateId,type:this.type}}};qs.INC=1;u([I.d(Cc.INC++,"string"),g("design:type",String)],qs.prototype,"sourceChainName",void 0);u([I.d(Cc.INC++,"string"),g("design:type",String)],qs.prototype,"sourceChainMagic",void 0);u([I.d(Cc.INC++,"string"),g("design:type",String)],qs.prototype,"certificateId",void 0);u([I.d(Cc.INC++,"uint32"),g("design:type",Number)],qs.prototype,"type",void 0);qs=Cc=u([j.d("DestroyCertificateModel")],qs);let zp=class extends oe{toJSON(){return{destroyCertificate:this.destroyCertificate.toJSON()}}};u([I.d(1,qs),g("design:type",qs)],zp.prototype,"destroyCertificate",void 0);zp=u([j.d("DestroyCertificateAssetModel")],zp);var ay;let Jp=ay=class extends We{};u([I.d(ay.INC++,hp),g("design:type",hp)],Jp.prototype,"asset",void 0);Jp=ay=u([j.d("SignatureTransaction")],Jp);var cy;let Yp=cy=class extends We{};u([I.d(cy.INC++,lp),g("design:type",lp)],Yp.prototype,"asset",void 0);Yp=cy=u([j.d("DAppTransaction")],Yp);var py;let Qp=py=class extends We{};u([I.d(py.INC++,up),g("design:type",up)],Qp.prototype,"asset",void 0);Qp=py=u([j.d("DAppPurchasingTransaction")],Qp);var hy;let Xp=hy=class extends We{};u([I.d(hy.INC++,gp),g("design:type",gp)],Xp.prototype,"asset",void 0);Xp=hy=u([j.d("MarkTransaction")],Xp);var ly;let Wp=ly=class extends We{};u([I.d(ly.INC++,fp),g("design:type",fp)],Wp.prototype,"asset",void 0);Wp=ly=u([j.d("IssueAssetTransaction")],Wp);var uy;let qp=uy=class extends We{};u([I.d(uy.INC++,dp),g("design:type",dp)],qp.prototype,"asset",void 0);qp=uy=u([j.d("IncreaseAssetTransaction")],qp);var gy;let Zp=gy=class extends We{};u([I.d(gy.INC++,yp),g("design:type",yp)],Zp.prototype,"asset",void 0);Zp=gy=u([j.d("TransferAssetTransaction")],Zp);var fy;let eh=fy=class extends We{};u([I.d(fy.INC++,mp),g("design:type",mp)],eh.prototype,"asset",void 0);eh=fy=u([j.d("DestroyAssetTransaction")],eh);var dy;let mo=dy=class extends We{};u([I.d(dy.INC++,_p),g("design:type",_p)],mo.prototype,"asset",void 0);mo=dy=u([j.d("GiftAssetTransaction")],mo);var yy;let th=yy=class extends We{};u([I.d(yy.INC++,Ap),g("design:type",Ap)],th.prototype,"asset",void 0);th=yy=u([j.d("GrabAssetTransaction")],th);var my;let Ha=my=class extends We{};u([I.d(my.INC++,Ep),g("design:type",Ep)],Ha.prototype,"asset",void 0);Ha=my=u([j.d("TrustAssetTransaction")],Ha);var _y;let rh=_y=class extends We{};u([I.d(_y.INC++,Ip),g("design:type",Ip)],rh.prototype,"asset",void 0);rh=_y=u([j.d("SignForAssetTransaction")],rh);var Ay;let nh=Ay=class extends We{};u([I.d(Ay.INC++,bp),g("design:type",bp)],nh.prototype,"asset",void 0);nh=Ay=u([j.d("EmigrateAssetTransaction")],nh);var Ey;let sh=Ey=class extends We{};u([I.d(Ey.INC++,Sp),g("design:type",Sp)],sh.prototype,"asset",void 0);sh=Ey=u([j.d("ImmigrateAssetTransaction")],sh);var Iy;let Ma=Iy=class extends We{};u([I.d(Iy.INC++,Np),g("design:type",Np)],Ma.prototype,"asset",void 0);Ma=Iy=u([j.d("ToExchangeAssetTransaction")],Ma);var Ty;let ih=Ty=class extends We{};u([I.d(Ty.INC++,Op),g("design:type",Op)],ih.prototype,"asset",void 0);ih=Ty=u([j.d("BeExchangeAssetTransaction")],ih);var by;let _o=by=class extends We{};u([I.d(by.INC++,Cp),g("design:type",Cp)],_o.prototype,"asset",void 0);_o=by=u([j.d("StakeAssetTransaction")],_o);var wy;let oh=wy=class extends We{};u([I.d(wy.INC++,xp),g("design:type",xp)],oh.prototype,"asset",void 0);oh=wy=u([j.d("UnstakeAssetTransaction")],oh);var Sy;let ah=Sy=class extends We{};u([I.d(Sy.INC++,Rp),g("design:type",Rp)],ah.prototype,"asset",void 0);ah=Sy=u([j.d("LocationNameTransaction")],ah);var Ny;let ch=Ny=class extends We{};u([I.d(Ny.INC++,vp),g("design:type",vp)],ch.prototype,"asset",void 0);ch=Ny=u([j.d("SetLnsManagerTransaction")],ch);var Oy;let ph=Oy=class extends We{};u([I.d(Oy.INC++,Bp),g("design:type",Bp)],ph.prototype,"asset",void 0);ph=Oy=u([j.d("SetLnsRecordValueTransaction")],ph);var Cy;let hh=Cy=class extends We{};u([I.d(Cy.INC++,yo),g("design:type",yo)],hh.prototype,"asset",void 0);hh=Cy=u([j.d("IssueEntityFactoryTransaction")],hh);var xy;let lh=xy=class extends We{};u([I.d(xy.INC++,yo),g("design:type",yo)],lh.prototype,"asset",void 0);lh=xy=u([j.d("IssueEntityFactoryTransactionV1")],lh);var Ry;let Ao=Ry=class extends We{};u([I.d(Ry.INC++,Pp),g("design:type",Pp)],Ao.prototype,"asset",void 0);Ao=Ry=u([j.d("IssueEntityTransaction")],Ao);var vy;let uh=vy=class extends We{};u([I.d(vy.INC++,kp),g("design:type",kp)],uh.prototype,"asset",void 0);uh=vy=u([j.d("DestroyEntityTransaction")],uh);var By;let Eo=By=class extends We{};u([I.d(By.INC++,Hp),g("design:type",Hp)],Eo.prototype,"asset",void 0);Eo=By=u([j.d("IssueEntityMultiTransaction")],Eo);var Py;let gh=Py=class extends We{};u([I.d(Py.INC++,Mp),g("design:type",Mp)],gh.prototype,"asset",void 0);gh=Py=u([j.d("TransferAnyTransaction")],gh);var ky;let Io=ky=class extends We{};u([I.d(ky.INC++,Lp),g("design:type",Lp)],Io.prototype,"asset",void 0);Io=ky=u([j.d("GiftAnyTransaction")],Io);var Hy;let fh=Hy=class extends We{};u([I.d(Hy.INC++,Dp),g("design:type",Dp)],fh.prototype,"asset",void 0);fh=Hy=u([j.d("GrabAnyTransaction")],fh);var My;let La=My=class extends We{};u([I.d(My.INC++,Fp),g("design:type",Fp)],La.prototype,"asset",void 0);La=My=u([j.d("ToExchangeAnyTransaction")],La);var Ly;let dh=Ly=class extends We{};u([I.d(Ly.INC++,Up),g("design:type",Up)],dh.prototype,"asset",void 0);dh=Ly=u([j.d("BeExchangeAnyTransaction")],dh);var Dy;let Da=Dy=class extends We{};u([I.d(Dy.INC++,$p),g("design:type",$p)],Da.prototype,"asset",void 0);Da=Dy=u([j.d("ToExchangeAnyMultiTransaction")],Da);var Fy;let yh=Fy=class extends We{};u([I.d(Fy.INC++,Vp),g("design:type",Vp)],yh.prototype,"asset",void 0);yh=Fy=u([j.d("BeExchangeAnyMultiTransaction")],yh);var Uy;let Fa=Uy=class extends We{};u([I.d(Uy.INC++,Gp),g("design:type",Gp)],Fa.prototype,"asset",void 0);Fa=Uy=u([j.d("ToExchangeAnyMultiAllTransaction")],Fa);var $y;let mh=$y=class extends We{};u([I.d($y.INC++,Kp),g("design:type",Kp)],mh.prototype,"asset",void 0);mh=$y=u([j.d("BeExchangeAnyMultiAllTransaction")],mh);var Vy;let _h=Vy=class extends We{};u([I.d(Vy.INC++,jp),g("design:type",jp)],_h.prototype,"asset",void 0);_h=Vy=u([j.d("IssueCertificateTransaction")],_h);var Gy;let Ah=Gy=class extends We{};u([I.d(Gy.INC++,zp),g("design:type",zp)],Ah.prototype,"asset",void 0);Ah=Gy=u([j.d("DestroyCertificateTransaction")],Ah);class te{constructor(t,r){this.__code=t,this.__message=r}get code(){return this.__code}get message(){return this.__message}set message(t){this.__message=t}build(t){return t?this.__message.replace(/\{([^\\]+?)\}/g,(r,n)=>t[n]??r):this.__message}}const Ky=Symbol("InjectionToken"),pf=Symbol("SingletonToken"),$E=Symbol("GroupToken"),hf=new WeakMap,VE=new WeakMap,jl=[];function C0(e){return VE.get(e)||jl[jl.length-1]}const GE="injectProps:afertInit",KE="injectProps:onInit";function jE(e){return e[Ky]}function zE(e){const t=new Set;let r=e;for(;;){const n=r[$E];if(!n)break;for(const s of n)t.add(s);if(r=Object.getPrototypeOf(r),!r)break}return t}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var h_;(function(e){(function(t){var r=typeof Zc=="object"?Zc:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=s(e);typeof r.Reflect>"u"?r.Reflect=e:n=s(r.Reflect,n),t(n);function s(i,o){return function(a,p){typeof i[a]!="function"&&Object.defineProperty(i,a,{configurable:!0,writable:!0,value:p}),o&&o(a,p)}}})(function(t){var r=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",s=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",i=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,p=!o&&!a,l={create:o?function(){return Dn(Object.create(null))}:a?function(){return Dn({__proto__:null})}:function(){return Dn({})},has:p?function(ae,pe){return r.call(ae,pe)}:function(ae,pe){return pe in ae},get:p?function(ae,pe){return r.call(ae,pe)?ae[pe]:void 0}:function(ae,pe){return ae[pe]}},h=Object.getPrototypeOf(Function),y=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",A=!y&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ct(),_=!y&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:dt(),E=!y&&typeof WeakMap=="function"?WeakMap:qe(),T=new E;function w(ae,pe,me,d){if(D(me)){if(!Ee(ae))throw new TypeError;if(!xe(pe))throw new TypeError;return U(ae,pe)}else{if(!Ee(ae))throw new TypeError;if(!ce(pe))throw new TypeError;if(!ce(d)&&!D(d)&&!Q(d))throw new TypeError;return Q(d)&&(d=void 0),me=de(me),v(ae,pe,me,d)}}t("decorate",w);function C(ae,pe){function me(d,f){if(!ce(d))throw new TypeError;if(!D(f)&&!Re(f))throw new TypeError;K(ae,pe,d,f)}return me}t("metadata",C);function N(ae,pe,me,d){if(!ce(me))throw new TypeError;return D(d)||(d=de(d)),K(ae,pe,me,d)}t("defineMetadata",N);function L(ae,pe,me){if(!ce(pe))throw new TypeError;return D(me)||(me=de(me)),x(ae,pe,me)}t("hasMetadata",L);function B(ae,pe,me){if(!ce(pe))throw new TypeError;return D(me)||(me=de(me)),k(ae,pe,me)}t("hasOwnMetadata",B);function $(ae,pe,me){if(!ce(pe))throw new TypeError;return D(me)||(me=de(me)),M(ae,pe,me)}t("getMetadata",$);function V(ae,pe,me){if(!ce(pe))throw new TypeError;return D(me)||(me=de(me)),q(ae,pe,me)}t("getOwnMetadata",V);function G(ae,pe){if(!ce(ae))throw new TypeError;return D(pe)||(pe=de(pe)),F(ae,pe)}t("getMetadataKeys",G);function Y(ae,pe){if(!ce(ae))throw new TypeError;return D(pe)||(pe=de(pe)),J(ae,pe)}t("getOwnMetadataKeys",Y);function X(ae,pe,me){if(!ce(pe))throw new TypeError;D(me)||(me=de(me));var d=P(pe,me,!1);if(D(d)||!d.delete(ae))return!1;if(d.size>0)return!0;var f=T.get(pe);return f.delete(me),f.size>0||T.delete(pe),!0}t("deleteMetadata",X);function U(ae,pe){for(var me=ae.length-1;me>=0;--me){var d=ae[me],f=d(pe);if(!D(f)&&!Q(f)){if(!xe(f))throw new TypeError;pe=f}}return pe}function v(ae,pe,me,d){for(var f=ae.length-1;f>=0;--f){var m=ae[f],b=m(pe,me,d);if(!D(b)&&!Q(b)){if(!ce(b))throw new TypeError;d=b}}return d}function P(ae,pe,me){var d=T.get(ae);if(D(d)){if(!me)return;d=new A,T.set(ae,d)}var f=d.get(pe);if(D(f)){if(!me)return;f=new A,d.set(pe,f)}return f}function x(ae,pe,me){var d=k(ae,pe,me);if(d)return!0;var f=mt(pe);return Q(f)?!1:x(ae,f,me)}function k(ae,pe,me){var d=P(pe,me,!1);return D(d)?!1:ee(d.has(ae))}function M(ae,pe,me){var d=k(ae,pe,me);if(d)return q(ae,pe,me);var f=mt(pe);if(!Q(f))return M(ae,f,me)}function q(ae,pe,me){var d=P(pe,me,!1);if(!D(d))return d.get(ae)}function K(ae,pe,me,d){var f=P(me,d,!0);f.set(ae,pe)}function F(ae,pe){var me=J(ae,pe),d=mt(ae);if(d===null)return me;var f=F(d,pe);if(f.length<=0)return me;if(me.length<=0)return f;for(var m=new _,b=[],O=0,H=me;O<H.length;O++){var z=H[O],ye=m.has(z);ye||(m.add(z),b.push(z))}for(var Ke=0,$e=f;Ke<$e.length;Ke++){var z=$e[Ke],ye=m.has(z);ye||(m.add(z),b.push(z))}return b}function J(ae,pe){var me=[],d=P(ae,pe,!1);if(D(d))return me;for(var f=d.keys(),m=Ue(f),b=0;;){var O=ct(m);if(!O)return me.length=b,me;var H=gt(O);try{me[b]=H}catch(z){try{ft(m)}finally{throw z}}b++}}function S(ae){if(ae===null)return 1;switch(typeof ae){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return ae===null?1:6;default:return 6}}function D(ae){return ae===void 0}function Q(ae){return ae===null}function fe(ae){return typeof ae=="symbol"}function ce(ae){return typeof ae=="object"?ae!==null:typeof ae=="function"}function re(ae,pe){switch(S(ae)){case 0:return ae;case 1:return ae;case 2:return ae;case 3:return ae;case 4:return ae;case 5:return ae}var me="string",d=Be(ae,s);if(d!==void 0){var f=d.call(ae,me);if(ce(f))throw new TypeError;return f}return se(ae)}function se(ae,pe){var me,d,f;{var m=ae.toString;if(Ie(m)){var d=m.call(ae);if(!ce(d))return d}var me=ae.valueOf;if(Ie(me)){var d=me.call(ae);if(!ce(d))return d}}throw new TypeError}function ee(ae){return!!ae}function R(ae){return""+ae}function de(ae){var pe=re(ae);return fe(pe)?pe:R(pe)}function Ee(ae){return Array.isArray?Array.isArray(ae):ae instanceof Object?ae instanceof Array:Object.prototype.toString.call(ae)==="[object Array]"}function Ie(ae){return typeof ae=="function"}function xe(ae){return typeof ae=="function"}function Re(ae){switch(S(ae)){case 3:return!0;case 4:return!0;default:return!1}}function Be(ae,pe){var me=ae[pe];if(me!=null){if(!Ie(me))throw new TypeError;return me}}function Ue(ae){var pe=Be(ae,i);if(!Ie(pe))throw new TypeError;var me=pe.call(ae);if(!ce(me))throw new TypeError;return me}function gt(ae){return ae.value}function ct(ae){var pe=ae.next();return pe.done?!1:pe}function ft(ae){var pe=ae.return;pe&&pe.call(ae)}function mt(ae){var pe=Object.getPrototypeOf(ae);if(typeof ae!="function"||ae===h||pe!==h)return pe;var me=ae.prototype,d=me&&Object.getPrototypeOf(me);if(d==null||d===Object.prototype)return pe;var f=d.constructor;return typeof f!="function"||f===ae?pe:f}function Ct(){var ae={},pe=[],me=(function(){function b(O,H,z){this._index=0,this._keys=O,this._values=H,this._selector=z}return b.prototype["@@iterator"]=function(){return this},b.prototype[i]=function(){return this},b.prototype.next=function(){var O=this._index;if(O>=0&&O<this._keys.length){var H=this._selector(this._keys[O],this._values[O]);return O+1>=this._keys.length?(this._index=-1,this._keys=pe,this._values=pe):this._index++,{value:H,done:!1}}return{value:void 0,done:!0}},b.prototype.throw=function(O){throw this._index>=0&&(this._index=-1,this._keys=pe,this._values=pe),O},b.prototype.return=function(O){return this._index>=0&&(this._index=-1,this._keys=pe,this._values=pe),{value:O,done:!0}},b})();return(function(){function b(){this._keys=[],this._values=[],this._cacheKey=ae,this._cacheIndex=-2}return Object.defineProperty(b.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),b.prototype.has=function(O){return this._find(O,!1)>=0},b.prototype.get=function(O){var H=this._find(O,!1);return H>=0?this._values[H]:void 0},b.prototype.set=function(O,H){var z=this._find(O,!0);return this._values[z]=H,this},b.prototype.delete=function(O){var H=this._find(O,!1);if(H>=0){for(var z=this._keys.length,ye=H+1;ye<z;ye++)this._keys[ye-1]=this._keys[ye],this._values[ye-1]=this._values[ye];return this._keys.length--,this._values.length--,O===this._cacheKey&&(this._cacheKey=ae,this._cacheIndex=-2),!0}return!1},b.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=ae,this._cacheIndex=-2},b.prototype.keys=function(){return new me(this._keys,this._values,d)},b.prototype.values=function(){return new me(this._keys,this._values,f)},b.prototype.entries=function(){return new me(this._keys,this._values,m)},b.prototype["@@iterator"]=function(){return this.entries()},b.prototype[i]=function(){return this.entries()},b.prototype._find=function(O,H){return this._cacheKey!==O&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=O)),this._cacheIndex<0&&H&&(this._cacheIndex=this._keys.length,this._keys.push(O),this._values.push(void 0)),this._cacheIndex},b})();function d(b,O){return b}function f(b,O){return O}function m(b,O){return[b,O]}}function dt(){return(function(){function ae(){this._map=new A}return Object.defineProperty(ae.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),ae.prototype.has=function(pe){return this._map.has(pe)},ae.prototype.add=function(pe){return this._map.set(pe,pe),this},ae.prototype.delete=function(pe){return this._map.delete(pe)},ae.prototype.clear=function(){this._map.clear()},ae.prototype.keys=function(){return this._map.keys()},ae.prototype.values=function(){return this._map.values()},ae.prototype.entries=function(){return this._map.entries()},ae.prototype["@@iterator"]=function(){return this.keys()},ae.prototype[i]=function(){return this.keys()},ae})()}function qe(){var ae=16,pe=l.create(),me=d();return(function(){function H(){this._key=d()}return H.prototype.has=function(z){var ye=f(z,!1);return ye!==void 0?l.has(ye,this._key):!1},H.prototype.get=function(z){var ye=f(z,!1);return ye!==void 0?l.get(ye,this._key):void 0},H.prototype.set=function(z,ye){var Ke=f(z,!0);return Ke[this._key]=ye,this},H.prototype.delete=function(z){var ye=f(z,!1);return ye!==void 0?delete ye[this._key]:!1},H.prototype.clear=function(){this._key=d()},H})();function d(){var H;do H="@@WeakMap@@"+O();while(l.has(pe,H));return pe[H]=!0,H}function f(H,z){if(!r.call(H,me)){if(!z)return;Object.defineProperty(H,me,{value:l.create()})}return H[me]}function m(H,z){for(var ye=0;ye<z;++ye)H[ye]=Math.random()*255|0;return H}function b(H){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(H)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(H)):m(new Uint8Array(H),H):m(new Array(H),H)}function O(){var H=b(ae);H[6]=H[6]&79|64,H[8]=H[8]&191|128;for(var z="",ye=0;ye<ae;++ye){var Ke=H[ye];(ye===4||ye===6||ye===8)&&(z+="-"),Ke<16&&(z+="0"),z+=Ke.toString(16).toLowerCase()}return z}}function Dn(ae){return ae.__=void 0,delete ae.__,ae}})})(h_||(h_={}));function ie(e,t){return r=>{let n,s,i;typeof e=="object"?(n=e.module_name,t=e,s=e.singleton):n=e,n===void 0&&(n=Symbol(r.name)),t&&(t.singleton!==void 0&&(s=t.singleton),t.group!==void 0&&(typeof t.group=="boolean"?t.group===!0&&(i=[n]):i=t.group instanceof Array?t.group:[t.group])),r[Ky]=n,r[pf]=!!s,i&&(r[$E]=i)}}var JE,YE,QE;const lf=Symbol("module-map"),Bl=Symbol("mask-level"),uf=Symbol("mask-self");let et=class{constructor(e,t){this.parent=t,this[JE]="ModuleStroge",this[YE]=0,this[QE]=this,this._stroge=new Map(e),this.set(lf,this)}clear(){return this._stroge.clear()}delete(e){return this._stroge.delete(e)}forEach(e,t){return this._stroge.forEach(e,t)}set(e,t){return this._stroge.set(e,t),this}get size(){return this._stroge.size}[Symbol.iterator](){return this._stroge[Symbol.iterator]()}entries(){return this._stroge.entries()}keys(){return this._stroge.keys()}values(){return this._stroge.values()}get(e){return!this.parent||this._stroge.has(e)?this._stroge.get(e):this.parent.get(e)}has(e){return!!this._stroge.has(e)||!!this.parent&&this.parent.has(e)}installMask(e){const t=s=>s===lf&&e.get(s)===e?n:e.has(s)?e.get(s):this.get(s),r=s=>e.has(s)||this.has(s),n=new Proxy(this,{get:(s,i,o)=>i==="_mask"?e:i===Bl?this[Bl]+1:i===uf?this:i==="get"?t:i==="has"?r:Reflect.get(s,i,o)});return n}uninstallMask(e=1){e=Math.min(this[Bl],e);let t=this;for(let r=0;r<e;r+=1)t=this[uf];return t}groupInsert(e,t){(this._groupCollection||(this._groupCollection=new kt(r=>new Set))).forceGet(e).add(t)}groupGet(...e){let t;for(const r of e){let n;switch(typeof r){case"function":n=[...zE(r)];break;case"object":n=r;break;default:n=[r]}if(!(n instanceof Array))throw new TypeError;const s=this.groupsGet_(n);if(s)if(t)for(const i of s)t.add(i);else t=s;if(this.parent){const i=this.parent.groupsGet_(n);if(i)if(t)for(const o of i)t.add(o);else t=i}}return t||new Set}groupsGet_(e){let t;e=e.slice();let r=n=>!0;for(;;){const n=e.shift();if(n===void 0)break;t=new Set;for(const s of this.groupGet_(n))r(s)&&t.add(s);if(!t.size)break;{const s=t;r=i=>s.has(i)}}return t}groupGet_(e){const t=[];if(this._groupCollection){const r=this._groupCollection.get(e);r&&t.push(...r)}return this.parent&&t.push(...this.parent.groupGet_(e)),t}};JE=Symbol.toStringTag,YE=Bl,QE=uf,et=u([ie(lf),g("design:paramtypes",[Object,et])],et);const x0=new Map;function R0(e){for(;;){const t=hf.get(e);if(t)return t;if((e=Object.getPrototypeOf(e))===Object.prototype||!e)break}return x0}function Ht(e,t=new et){const r=e[Ky],n=e[pf],s=zE(e);let i;if(n instanceof e?t.set(r,i=n):i=t.get(r),!i){const o=R0(e),a=Reflect.getMetadata("design:paramtypes",e),p=a?a.map((y,A)=>{const _=o&&o.get(A);if(_!==void 0){if(!(_.conf&&_.conf.optional)&&!t.has(_.id))throw new ReferenceError(`Need Inject Module '${String(_.id)}' in ${String(r)}`);return t.get(_.id)}return Ht(y,t)}):[];jl.push(t),i=new e(...p),jl.pop(),VE.set(i,t),n&&(e[pf]=i),r!==void 0&&t.set(r,i);for(const y of s)t.groupInsert(y,i);typeof i.bfOnInit=="function"&&i.bfOnInit();const l=Reflect.getMetadata(KE,e.prototype);if(l)for(const[y,A]of l)i[y]=Ht(A.injectModel,t);typeof i.bfAfterInit=="function"&&queueMicrotask(()=>{i.bfAfterInit()});const h=Reflect.getMetadata(GE,e.prototype);h&&queueMicrotask(()=>{for(const[y,A]of h)i[y]=Ht(A.injectModel,t)})}return i}function Z(e,t){return(r,n,s)=>{if(typeof s!="number"){if(e===void 0)throw new ReferenceError("inject_moudle should not be empty");return B0(e,t)(r,n,s)}{const i=typeof e=="function"?jE(e):e;if(i!==void 0){const o=hf.get(r)||new Map;hf.set(r,o),o.set(s,{id:i,conf:t})}}}}var v0=(e=>(e[e.NO_RESOLVE=0]="NO_RESOLVE",e[e.ON_GETTER=1]="ON_GETTER",e[e.ON_INIT=2]="ON_INIT",e[e.AFTER_INIT=3]="AFTER_INIT",e))(v0||{});function l_(e,t){let r=Reflect.getMetadata(t,e);return r||(r=new Map,Reflect.metadata(t,r)(e)),r}function B0(e,t={}){const{dynamics:r,optional:n,autoResolve:s,writable:i=!0}=t;let o;o=s===!1?0:s===!0||s===void 0?1:s;const a=typeof e=="function"?jE(e):e;if(a===void 0)throw new TypeError("module name is undefined");return(p,l,h)=>{if(o!==0&&o!==1){if(typeof e!="function")throw new TypeError(`${p} could not resolve prop '${l}', inject_module not an function.`);o===3?l_(p,GE).set(l,{injectModel:e}):o===2&&l_(p,KE).set(l,{injectModel:e})}const y=T=>{const w=C0(T);if(!w)throw new ReferenceError(`instance of ${T.constructor.name} is not an instance which is created by Resolve`);return w},A=(T,w)=>{y(T).set(a,w)},_=T=>{const w=y(T);if(w.has(a))return w.get(a);if(o!==0&&typeof e=="function")return Ht(e,w);if(!n)throw new ReferenceError(`module of ${String(a)} must been Injected first.`)},E={configurable:!0,enumerable:!0};if(r)i&&(E.set=function(T){A(this,T)}),E.get=function(){return _(this)};else{const T=(w,C)=>{Object.defineProperty(w,l,{value:C,writable:i,configurable:!0,enumerable:!0})};i&&(E.set=function(w){A(this,w),T(this,w)}),E.get=function(){const w=_(this);return T(this,w),w}}Object.defineProperty(p,l,E)}}function ea(e){return t=>{}}var gf,tp;(function(e){e.CHINESE="zh_CN.UTF-8",e.ENGLISH="en_US.UTF-8"})(tp||(tp={}));const XE=Symbol("errorCodeLang");let ff=gf=class{constructor(e=tp.ENGLISH){this.__store=new Map,this.__checkLanguage(e),this.__lang=e}static from(e,t=new et){return Ht(gf,t.installMask(new et([[XE,e]])))}__checkLanguage(e){if(e!==tp.CHINESE&&e!==tp.ENGLISH)throw new Error(`Invalid lang type ${e}`)}getErrorCodeList(e){const t=this.__store.get(e);if(!t)throw new Error(`Failed to get error code list by ${e}`);return t.sourceErrorCodeList}formatErrorCodeList(e,t){const r=t.get(this.__lang);if(!r)return console.debug(`Translated error code list not found, language ${this.__lang}`),e;for(const n in e){const s=e[n];s.message=r[s.code]||s.message}return e}addErrorCodeList(e,t,r){this.formatErrorCodeList(t,r),this.__store.set(e,{sourceErrorCodeList:t,translatedErrorCodeListMap:r})}setLanguage(e){if(this.__lang!==e){this.__checkLanguage(e),this.__lang=e;for(const{sourceErrorCodeList:t,translatedErrorCodeListMap:r}of this.__store.values())this.formatErrorCodeList(t,r)}}};ff=gf=u([ie(),Ce(0,Z(XE,{optional:!0})),g("design:paramtypes",[String])],ff);const P0={"001-00001":"params {param} lost","001-00002":"{prop} in {target} is required","001-00003":"{prop} in {target} is invalid","001-00004":"{to_compare_prop} in {to_target} and {be_compare_prop} in {be_target} not match","001-00005":"{prop} in {target} should greater than {field}","001-00006":"{prop} in {target} should greater than or equals to {field}","001-00007":"{prop} in {target} should less than {field}","001-00008":"{prop} in {target} should less than or equals to {field}","001-00009":"{prop} in {target} should equals to {field}","001-00010":"{to_compare_prop} in {to_target} should be {be_compare_prop}","001-00011":"{to_compare_prop} in {to_target} should not be {be_compare_prop}","001-00012":"{prop} in {target} not exist","001-00013":"{prop} in {target} should not exist","001-00014":"Transaction fee is not enough, errorId {errorId}, minFee {minFee}","001-00015":"{prop} in {target} not in [{min}, {max}]","001-00016":"{prop} in {target} is over length {limit}","001-00017":"{prop} in {target} should not start with or end with {field}","001-00018":"{prop} in {target} not a string, value {value}","001-00019":"{prop} in {target} not a ip, value {value}","001-00020":"{prop} in {target} not a ipv4, value {value}","001-00021":"{prop} in {target} not a ipv6, value {value}","001-00022":"{prop} in {target} not a longitude-latitude, value {value}","001-00023":"{prop} in {target} not a longitude, value {value}","001-00024":"{prop} in {target} not a latitude, value {value}","001-00025":"{prop} in {target} not a address, value {value}","001-00026":"{prop} in {target} not a locationName, value {value}","001-00027":"{prop} in {target} not a dns, value {value}","001-00028":"{prop} in {target} not a email, value {value}","001-00029":"{prop} in {target} not a url, value {value}","001-00030":"Permission denied at operation {operationName}","001-00031":"{prop} in {target} should not inclue {value}","001-00032":"{prop} in {target} should inclue {value}","001-00033":"{prop} in {target} should not duplicate","001-00034":"{prop} in {target} already exist, errorId {errorId}","001-00035":"Genesis generator not enough, at least {expected}, actual {actual}","001-00036":"{prop} in {target} should be an array","001-00037":"Invalid block generator, reason {reason}","001-00038":"transaction's porf of work verify fail","001-00039":"{prop} not found","001-00040":"{prop} is too large, reason {reason}, errorId {errorId}","001-00041":"{prop} length in {target} should less than {field}","001-00042":"{prop} length in {target} should less than or equals to {field}","001-00043":"{prop} length in {target} should greater than {field}","001-00044":"{prop} length in {target} should greater than or equals to {field}","001-00045":"{prop} length in {target} should equals to {field}","001-00046":"{prop} length in {target} should not equals to {field}","001-00047":"Invalid transaction base type: {base_type}","001-00048":"Invalid block constructor: {name}","001-00049":"Invalid block type: {type}","001-00050":"Custom transaction verify fail: {message}","001-00051":"Disabled create {trsName} Transaction","001-00052":"Disabled insert {trsName} Transaction","001-00053":"Transaction is in unchangable state","001-00054":"AssetStatistic index: {index} already in use","001-00055":"Invalid {taskLabel} signature","001-00056":"Invalid {taskLabel} signSignature","001-00057":"Invalid base type {base_type}","001-00058":"Unregistered TransactionFactory {factoryName}","001-00059":"Unregistered Transaction base type {trs_base}","001-00060":"Unregistered Transaction type {trs_key}","001-00061":"Invalid {taskLabel} fromAuthSignature","001-00062":"Invalid {taskLabel} fromAuthSignSignature","001-00063":"Invalid {taskLabel} toAuthSignature","001-00064":"Invalid {taskLabel} toAuthSignSignature","001-00065":"Invalid macro input type: {type}","001-00066":"{prop} in {target} already expired","001-11001":"{prop} in {target} lose","001-11002":"Account with address {address} was frozen, status {status}, errorId {errorId}","001-11003":"Transaction signSignature is required, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11004":"Transaction sender second secret have already change, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11005":"Transaction should not have senderSecondPublicKey, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11006":"Transaction should not have signSignature, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11007":"Invalid transaction({signature}) apply block height, reason {reason}","001-11008":"Invalid transaction({signature}) effective block height, reason {reason}","001-11009":"Invalid transaction from magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11010":"Invalid transaction to magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11011":"Invalid transaction timestamp, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11012":"DAppid is not exist, dappid {dappid}","001-11013":"DAppid is already exist, dappid {dappid}, errorId {errorId}","001-11014":"LocationName is not exist, locationName {locationName}, errorId {errorId}","001-11015":"LocationName is already exist, locationName {locationName}, errorId {errorId}","001-11016":"Entity factory is not exist, factoryId {factoryId}","001-11017":"Entity factory is already exist, factoryId {factoryId}, errorId {errorId}","001-11018":"Entity is not exist, entityId {entityId}","001-11019":"Entity is already exist, entityId {entityId}, errorId {errorId}","001-11020":"Unknow rangeType, rangeType {rangeType}","001-11021":"Invalid transaction byte length, reason {reason}","001-11022":"Need purchase dappid before use, dappid {dappid}","001-11025":"Can not delete locationName {locationName}, reason {reason}","001-11026":"Set locationName {locationName} manager field, reason {reason}, errorId {errorId}","001-11027":"Set locationName {locationName} recordValue field, reason {reason}, errorId {errorId}","001-11028":"Asset not enough, reason {reason}, errorId {errorId}","001-11029":"Account remain equity not enough, reason {reason}, errorId {errorId}","001-11030":"Frozen asset is not begin to unfrozen yet, frozenId {frozenId}","001-11031":"Frozen asset is already expiration, frozenId {frozenId}","001-11032":"Gift asset unfrozen time use up, frozenId {frozenId}","001-11034":"Account with address {address} is already an generator, errorId {errorId}","001-11035":"Account with address {address} is not an generator, errorId {errorId}","001-11038":"{prop} in {target} is forbidden","001-11039":"Asset not exist, magic {magic} assetType {assetType}","001-11040":"Account with address {address} not dappid {dappid} possessor, errorId {errorId}","001-11041":"Account with address {address} not locationName {locationName} possessor, errorId {errorId}","001-11042":"Account with address {address} not entityId {entityId} possessor, errorId {errorId}","001-11043":"DAppid not frozen, dappid {dappid}","001-11044":"DAppid already frozen, dappid {dappid}","001-11045":"LocationName not frozen, locationName {locationName}","001-11046":"LocationName already frozen, locationName {locationName}","001-11047":"Entity not frozen, entityId {entityId}","001-11048":"Entity already frozen, entityId {entityId}","001-11049":"No need to purchase asset, type {type} asset {asset}","001-11050":"Only top level location name can exchange","001-11051":"Can not destroy entityId {entityId}, reason {reason}","001-11052":"Entity already destroy, entityId {entityId}","001-11053":"Asset is already migration, migrateCertificateId {migrateCertificateId}","001-11054":"{prop} in {target} not exist or expired","001-11055":"Transaction with signature {signature} is not an expected related transaction","001-11056":"Can not secondary transaction, reason {reason}","001-11057":"The register generator quota is full in round {round}","001-11058":"Generator can not migrate asset","001-11059":"You can only migrate main asset, {assetType} is not main asset {mainAsset}","001-11060":"Can not carry second publicKey","001-11061":"Can not carry second signature","001-11063":"Account possess frozen asset","001-11064":"Need emigrate total asset, address {address}","001-11065":"Account possess asset expect chain asset","001-11066":"Account possess frozen asset expect chain asset","001-11067":"Account with address {address} can not be frozen, reason {reason}, errorId {errorId}","001-11068":"You can only trust main asset, {assetType} is not main asset {mainAsset}","001-11070":"Issue entity times use up, entityFactory {entityFactory}","001-11071":"Asset already exist, magic {magic} assetType {assetType}","001-11072":"Frozen asset with frozenAddress {frozenAddress} signature {signature} assetType {assetType} in blockChain not exist or expired","001-11073":"Not enough issue entity times, entityFactory {entityFactory}","001-11074":"Promise is not begin to resolve yet, promiseId {promiseId}","001-11075":"Certificate is not exist, certificateId {certificateId}","001-11076":"Certificate is already exist, certificateId {certificateId}, errorId {errorId}","001-11077":"Can not destroy certificate, certificateId {certificateId}, reason {reason}","001-11078":"Account with address {address} not certificate {certificateId} possessor, errorId {errorId}","001-11079":"Certificate not frozen, certificateId {certificateId}","001-11080":"Certificate already frozen, certificateId {certificateId}","001-11081":"Certificate already destroy, certificateId {certificateId}","001-12001":"Block signSignature is required, signature {signature} generatorAddress {generatorAddress} height {height}","001-12002":"Block generator second secret have already change, signature {signature} generatorAddress {generatorAddress} height {height}","001-12003":"Block should not have generatorSecondPublicKey, signature {signature} generatorAddress {generatorAddress} height {height}","001-12004":"Block should not have signSignature, signature {signature} generatorAddress {generatorAddress} height {height}","001-12005":"{variable} out of range","001-12006":"Failed to find nearest same block in one round, should not happen","001-12007":"GenesisBlock not match, the signature of genesisBlock and synchronized peer's genesisBlock's signature not equal","000-12008":"Falied to get blocks by range({minHeight}~{maxHeight})","001-22001":"Invalid params: {params}","001-22002":"Invalid params field: {field}","001-22003":"GenesisBlock maybe no equal","001-22004":"Invalid QueryBlockArg query params, no query conditions","001-22005":"QueryBlock ({query}) from peer({peerId}) timeout","001-22006":"ReqId reuse","001-22007":"ChainChannel closed","001-22008":"Refuse response query transaction","001-22009":"Refuse response index transaction","001-22010":"Refuse response download transaction","001-22011":"Refuse response broadcast transaction","001-22012":"Refuse response query block","001-22013":"Refuse response broadcast block","001-22014":"Message type error","001-22015":"OnMessage get invalid req_id: {req_id}","001-22016":"Request limit","001-22017":"Invalid message cmd","001-22018":"ChainChannel Timeout, cmd {cmd}","001-22019":"Task {task_id} abort because the free chainChannel size is zero","001-22020":"Refuse response open blob","001-22021":"Refuse response read blob","001-22022":"Refuse response close blob","001-23001":"blob({hash}) algorithm({algorithm}) is invalid","001-23002":"Fail to download blob({hash}) size({size})"},k0={"001-00001":" {param} ","001-00002":"{target}  {prop} ","001-00003":"{target}  {prop} ","001-00004":"{to_target}  {to_compare_prop}  {be_target}  {be_compare_prop} ","001-00005":"{target}  {prop}  {field}","001-00006":"{target}  {prop}  {field}","001-00007":"{target}  {prop}  {field}","001-00008":"{target}  {prop}  {field}","001-00009":"{target}  {prop}  {field}","001-00010":"{to_target}  {to_compare_prop}  {be_compare_prop}","001-00011":"{to_target}  {to_compare_prop}  {be_compare_prop}","001-00012":"{target}  {prop} ","001-00013":"{target}  {prop} ","001-00014":" id {errorId} {minFee}","001-00015":"{target}  {prop}  [{min}, {max}] ","001-00016":"{target}  {prop}  {limit}","001-00017":"{target}  {prop}  {field} ","001-00018":"{target}  {prop}  {value}","001-00019":"{target}  {prop}  ip,  {value}","001-00020":"{target}  {prop}  ipv4,  {value}","001-00021":"{target}  {prop}  ipv6,  {value}","001-00022":"{target}  {prop} ,  {value}","001-00023":"{target}  {prop} ,  {value}","001-00024":"{target}  {prop} ,  {value}","001-00025":"{target}  {prop} ,  {value}","001-00026":"{target}  {prop} ,  {value}","001-00027":"{target}  {prop}  dns,  {value}","001-00028":"{target}  {prop}  email,  {value}","001-00029":"{target}  {prop}  url,  {value}","001-00030":" {operationName} ","001-00031":"{target}  {prop}  {value}","001-00032":"{target}  {prop}  {value}","001-00033":"{target}  {prop} ","001-00034":"{target}  {prop}  id {errorId}","001-00035":" {expected} {actual}","001-00036":"{target}  {prop} ","001-00037":" {reason}","001-00038":"","001-00039":"{prop} ","001-00040":"{prop}  {reason} id {errorId}","001-00041":"{target}  {prop}  {field}","001-00042":"{target}  {prop}  {field}","001-00043":"{target}  {prop}  {field}","001-00044":"{target}  {prop}  {field}","001-00045":"{target}  {prop}  {field}","001-00046":"{target}  {prop}  {field}","001-00047":"{base_type}","001-00048":"{name}","001-00049":"{type}","001-00050":"{message}","001-00051":" {trsName}","001-00052":" {trsName}","001-00053":"","001-00054":"{index} ","001-00055":" {taskLabel} signature","001-00056":" {taskLabel} signSignature","001-00057":" base type {base_type}","001-00058":" factory {factoryName}","001-00059":" base type {trs_base}","001-00060":" type {trs_key}","001-00061":" {taskLabel} fromAuthSignature","001-00062":" {taskLabel} fromAuthSignSignature","001-00063":" {taskLabel} toAuthSignature","001-00064":" {taskLabel} toAuthSignSignature","001-00065":": {type}","001-00066":"{target}  {prop} ","001-11001":"{target}  {prop} ","001-11002":" {address}  {status} id {errorId}","001-11003":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11004":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11005":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11006":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11007":"{signature} {reason}","001-11008":"{signature} {reason}","001-11009":" {reason} {signature}  {senderId}  {applyBlockHeight}  {type}","001-11010":" {reason} {signature}  {senderId}  {applyBlockHeight}  {type}","001-11011":" {reason} {signature}  {senderId}  {applyBlockHeight}  {type}","001-11012":"DAppid dappid {dappid}","001-11013":"DAppid , dappid {dappid} id {errorId}","001-11014":",  {locationName} id {errorId}","001-11015":" {locationName} id {errorId}","001-11016":"Entity factory , factoryId {factoryId}","001-11017":"Entity factory , factoryId {factoryId} id {errorId}","001-11018":"Entity , entityId {entityId}","001-11019":"Entity , entityId {entityId} id {errorId}","001-11020":" rangeTyperangeType {rangeType}","001-11021":" {reason}","001-11022":" dappid dappid {dappid}","001-11023":" dappid  dappid dappid {dappid} id {errorId}","001-11024":" id {errorId {reason}","001-11025":" {locationName} {reason}","001-11026":" {locationName}  {reason} id {errorId}","001-11027":" {locationName}  {reason} id {errorId}","001-11028":" {reason} id {errorId}","001-11029":" {reason} id {errorId}","001-11030":"frozenId {frozenId}","001-11031":"frozenId {frozenId}","001-11032":"frozenId {frozenId}","001-11033":" id {errorId}","001-11034":" {address}  id {errorId}","001-11035":" {address}  id {errorId}","001-11036":" {address}  id {errorId}","001-11037":" {address}  id {errorId}","001-11038":"{target}  {prop} ","001-11039":" {magic}  {assetType}","001-11040":" {address}  dappid {dappid}  id {errorId}","001-11041":" {address}  locationName {locationName}  id {errorId}","001-11042":" {address}  entityId {entityId}  id {errorId}","001-11043":"DAppid dappid {dappid}","001-11044":"DAppid dappid {dappid}","001-11045":" {locationName}","001-11046":" {locationName}","001-11047":"Entity EntityId {entityId}","001-11048":"Entity entityId {entityId}","001-11049":" {type} {asset}","001-11050":"","001-11051":" entityId {entityId} {reason}","001-11052":"Entity  entityId {entityId}","001-11053":" id {migrateCertificateId}","001-11054":"{target}  {prop} ","001-11055":" {signature} ","001-11056":" {reason}","001-11057":" {round} ","001-11058":"","001-11059":"{assetType}  {mainAsset}","001-11060":"","001-11061":"","001-11062":"","001-11063":"","001-11064":" {address}","001-11065":"","001-11066":"","001-11067":" {address}  {reason} id {errorId}","001-11068":"{assetType}  {mainAsset}","001-11069":" id {errorId}","001-11070":" entity entityFactory {entityFactory}","001-11071":" {magic}  {assetType}","001-11072":" frozenAddress {frozenAddress} signature {signature} assetType {assetType} ","001-11073":" entity entityFactory {entityFactory}","001-11074":"promiseId {promiseId}","001-11075":" certificateId {certificateId}","001-11076":"certificateId {certificateId} id {errorId}","001-11077":"certificateId {certificateId}reason {reason}","001-11078":" address {address}  {certificateId}  id {errorId}","001-11079":"certificateId {certificateId}","001-11080":"certificateId {certificateId}","001-11081":"certificateId {certificateId}","001-12001":" {signature}  {generatorAddress}  {height}","001-12002":" {signature}  {generatorAddress}  {height}","001-12003":" {signature}  {generatorAddress}  {height}","001-12004":" {signature}  {generatorAddress}  {height}","001-12005":"{variable} ","001-12006":"","001-12007":",  signature  signature ","000-12008":"{minHeight}~{maxHeight}","001-22001":"{params}","001-22002":"{field}","001-22003":"","001-22004":" QueryBlockArg ","001-22005":" {peerId}  {query} ","001-22006":"ReqId ","001-22007":"ChainChannel ","001-22008":"","001-22009":"","001-22010":"","001-22011":"","001-22012":"","001-22013":"","001-22014":"Message ","001-22015":"OnMessage  req_id{req_id}","001-22016":"","001-22017":" message cmd","001-22018":"ChainChannel cmd {cmd}","001-22019":"Task {task_id}  chainChannel  0","001-22020":" blob","001-22021":" blob","001-22022":" blob","001-23001":"blob({hash})  algorithm({algorithm}) ","001-23002":" blob({hash}) size({size}) "},jy=new Map;jy.set("en_US.UTF-8",P0);jy.set("zh_CN.UTF-8",k0);const H0=jy,c={PARAM_LOST:new te("001-00001","params {param} lost"),PROP_IS_REQUIRE:new te("001-00002","{prop} in {target} is required"),PROP_IS_INVALID:new te("001-00003","{prop} in {target} is invalid"),NOT_MATCH:new te("001-00004","{to_compare_prop} in {to_target} and {be_compare_prop} in {be_target} not match"),PROP_SHOULD_GT_FIELD:new te("001-00005","{prop} in {target} should greater than {field}"),PROP_SHOULD_GTE_FIELD:new te("001-00006","{prop} in {target} should greater than or equals to {field}"),PROP_SHOULD_LT_FIELD:new te("001-00007","{prop} in {target} should less than {field}"),PROP_SHOULD_LTE_FIELD:new te("001-00008","{prop} in {target} should less than or equals to {field}"),PROP_SHOULD_EQ_FIELD:new te("001-00009","{prop} in {target} should equals to {field}"),SHOULD_BE:new te("001-00010","{to_compare_prop} in {to_target} should be {be_compare_prop}"),SHOULD_NOT_BE:new te("001-00011","{to_compare_prop} in {to_target} should not be {be_compare_prop}"),NOT_EXIST:new te("001-00012","{prop} in {target} not exist"),SHOULD_NOT_EXIST:new te("001-00013","{prop} in {target} should not exist"),TRANSACTION_FEE_NOT_ENOUGH:new te("001-00014","Transaction fee is not enough, errorId {errorId}, minFee {minFee}"),NOT_IN_EXPECTED_RANGE:new te("001-00015","{prop} in {target} not in [{min}, {max}]"),OVER_LENGTH:new te("001-00016","{prop} in {target} is over length {limit}"),SHOULD_NOT_START_WITH_OR_END_WITH:new te("001-00017","{prop} in {target} should not start with or end with {field}"),NOT_A_STRING:new te("001-00018","{prop} in {target} not a string, value {value}"),NOT_A_IP:new te("001-00019","{prop} in {target} not a ip, value {value}"),NOT_A_IPV4:new te("001-00020","{prop} in {target} not a ipv4, value {value}"),NOT_A_IPV6:new te("001-00021","{prop} in {target} not a ipv6, value {value}"),NOT_A_LONGITUDE_LATITUDE:new te("001-00022","{prop} in {target} not a longitude-latitude, value {value}"),NOT_A_LONGITUDE:new te("001-00023","{prop} in {target} not a longitude, value {value}"),NOT_A_LATITUDE:new te("001-00024","{prop} in {target} not a latitude, value {value}"),NOT_A_ADDRESS:new te("001-00025","{prop} in {target} not a address, value {value}"),NOT_A_LOCATION_NAME:new te("001-00026","{prop} in {target} not a locationName, value {value}"),NOT_A_DNS:new te("001-00027","{prop} in {target} not a dns, value {value}"),NOT_A_EMAIL:new te("001-00028","{prop} in {target} not a email, value {value}"),NOT_A_URL:new te("001-00029","{prop} in {target} not a url, value {value}"),PERMISSION_DENIED:new te("001-00030","Permission denied at operation {operationName}"),SHOULD_NOT_INCLUDE:new te("001-00031","{prop} in {target} should not inclue {value}"),SHOULD_INCLUDE:new te("001-00032","{prop} in {target} should inclue {value}"),SHOULD_NOT_DUPLICATE:new te("001-00033","{prop} in {target} should not duplicate"),ALREADY_EXIST:new te("001-00034","{prop} in {target} already exist, errorId {errorId}"),GENESIS_GENERATOR_NOT_ENOUGH:new te("001-00035","Genesis generator not enough, at least {expected}, actual {actual}"),PROP_SHOULD_BE_ARRAY:new te("001-00036","{prop} in {target} should be an array"),INVALID_BLOCK_GENERATOR:new te("001-00037","Invalid block generator, reason {reason}"),NOT_FOUND:new te("001-00039","{prop} not found"),TOO_LARGE:new te("001-00040","{prop} is too large, reason {reason}, errorId {errorId}"),PROP_LENGTH_SHOULD_LT_FIELD:new te("001-00041","{prop} length in {target} should less than {field}"),PROP_LENGTH_SHOULD_LTE_FIELD:new te("001-00042","{prop} length in {target} should less than or equals to {field}"),PROP_LENGTH_SHOULD_GT_FIELD:new te("001-00043","{prop} length in {target} should greater than {field}"),PROP_LENGTH_SHOULD_GTE_FIELD:new te("001-00044","{prop} length in {target} should greater than or equals to {field}"),PROP_LENGTH_SHOULD_EQ_FIELD:new te("001-00045","{prop} length in {target} should equals to {field}"),PROP_LENGTH_SHOULD_NOT_EQ_FIELD:new te("001-00046","{prop} length in {target} should not equals to {field}"),INVALID_TRANSACTION_BASE_TYPE:new te("001-00047","Invalid transaction base type: {base_type}"),INVALID_BLOCK_CONSTRUCTOR:new te("001-00048","Invalid block constructor: {name}"),INVALID_BLOCK_TYPE:new te("001-00049","Invalid block type: {type}"),CUSTOM_TRANS_VERIFY_FAIL:new te("001-00050","Custom transaction verify fail: {message}"),DISABLED_CREATE_TRANSACTION:new te("001-00051","Disabled create {trsName} Transaction"),DISABLED_INSERT_TRANSACTION:new te("001-00052","Disabled insert {trsName} Transaction"),TRANSACTION_IS_IN_UNCHANGABLE_STATE:new te("001-00053","Transaction is in unchangable state"),ASSETSTATISTIC_INDEX_ALREADY_IN_USE:new te("001-00054","AssetStatistic index: {index} already in use"),INVALID_SIGNATURE:new te("001-00055","Invalid {taskLabel} signature"),INVALID_SIGNSIGNATURE:new te("001-00056","Invalid {taskLabel} signSignature"),INVALID_BASE_TYPE:new te("001-00057","Invalid base type {base_type}"),UNREGISTERED_TRANSACTION_FACTORY:new te("001-00058","Unregistered TransactionFactory {factoryName}"),UNREGISTERED_TRANSACTION_BASE_TYPE:new te("001-00059","Unregistered Transaction base type {trs_base}"),UNREGISTERED_TRANSACTION_TYPE:new te("001-00060","Unregistered Transaction type {trs_key}"),INVALID_FROMAUTHSIGNATURE:new te("001-00061","Invalid {taskLabel} fromAuthSignature"),INVALID_FROMAUTHSIGNSIGNATURE:new te("001-00062","Invalid {taskLabel} fromAuthSignSignature"),INVALID_TOAUTHSIGNATURE:new te("001-00063","Invalid {taskLabel} toAuthSignature"),INVALID_TOAUTHSIGNSIGNATURE:new te("001-00064","Invalid {taskLabel} toAuthSignSignature"),INVALID_MACRO_INPUT_TYPE:new te("001-00065","Invalid macro input type: {type}"),ALREADY_EXPIRED:new te("001-00066","{prop} in {target} already expired"),PROP_LOSE:new te("001-11001","{prop} in {target} lose"),ACCOUNT_FROZEN:new te("001-11002","Account with address {address} was frozen, status {status}, errorId {errorId}"),TRANSACTION_SIGN_SIGNATURE_IS_REQUIRED:new te("001-11003","Transaction signSignature is required, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),TRANSACTION_SENDER_SECOND_PUBLICKEY_ALREADY_CHANGE:new te("001-11004","Transaction sender second secret have already change, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),TRANSACTION_SHOULD_NOT_HAVE_SENDER_SECOND_PUBLICKEY:new te("001-11005","Transaction should not have senderSecondPublicKey, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),TRANSACTION_SHOULD_NOT_HAVE_SIGN_SIGNATURE:new te("001-11006","Transaction should not have signSignature, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),INVALID_TRANSACTION_APPLY_BLOCK_HEIGHT:new te("001-11007","Invalid transaction({signature}) apply block height, reason {reason}"),INVALID_TRANSACTION_EFFECTIVE_BLOCK_HEIGHT:new te("001-11008","Invalid transaction({signature}) effective block height, reason {reason}"),INVALID_TRANSACTION_FROM_MAGIC:new te("001-11009","Invalid transaction from magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),INVALID_TRANSACTION_TO_MAGIC:new te("001-11010","Invalid transaction to magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),INVALID_TRANSACTION_TIMESTAMP:new te("001-11011","Invalid transaction timestamp, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),DAPPID_IS_NOT_EXIST:new te("001-11012","DAppid is not exist, dappid {dappid}"),DAPPID_IS_ALREADY_EXIST:new te("001-11013","DAppid is already exist, dappid {dappid}, errorId {errorId}"),LOCATION_NAME_IS_NOT_EXIST:new te("001-11014","LocationName is not exist, locationName {locationName}, errorId {errorId}"),LOCATION_NAME_IS_ALREADY_EXIST:new te("001-11015","LocationName is already exist, locationName {locationName}, errorId {errorId}"),ENTITY_FACTORY_IS_NOT_EXIST:new te("001-11016","Entity factory is not exist, factoryId {factoryId}"),ENTITY_FACTORY_IS_ALREADY_EXIST:new te("001-11017","Entity factory is already exist, factoryId {factoryId}, errorId {errorId}"),ENTITY_IS_NOT_EXIST:new te("001-11018","Entity is not exist, entityId {entityId}"),ENTITY_IS_ALREADY_EXIST:new te("001-11019","Entity is already exist, entityId {entityId}, errorId {errorId}"),UNKNOWN_RANGE_TYPE:new te("001-11020","Unknow rangeType, rangeType {rangeType}"),INVALID_TRANSACTION_BYTE_LENGTH:new te("001-11021","Invalid transaction byte length, reason {reason}"),NEED_PURCHASE_DAPPID_BEFORE_USE:new te("001-11022","Need purchase dappid before use, dappid {dappid}"),CAN_NOT_DELETE_LOCATION_NAME:new te("001-11025","Can not delete locationName {locationName}, reason {reason}"),SET_LOCATION_NAME_MANAGER_FIELD:new te("001-11026","Set locationName {locationName} manager field, reason {reason}, errorId {errorId}"),SET_LOCATION_NAME_RECORD_VALUE_FIELD:new te("001-11027","Set locationName {locationName} recordValue field, reason {reason}, errorId {errorId}"),ASSET_NOT_ENOUGH:new te("001-11028","Asset not enough, reason {reason}, errorId {errorId}"),ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH:new te("001-11029","Account remain equity not enough, reason {reason}, errorId {errorId}"),NOT_BEGIN_UNFROZEN_YET:new te("001-11030","Frozen asset is not begin to unfrozen yet, frozenId {frozenId}"),FROZEN_ASSET_EXPIRATION:new te("001-11031","Frozen asset is already expiration, frozenId {frozenId}"),UNFROZEN_TIME_USE_UP:new te("001-11032","Gift asset unfrozen time use up, frozenId {frozenId}"),FORBIDDEN:new te("001-11038","{prop} in {target} is forbidden"),ASSET_NOT_EXIST:new te("001-11039","Asset not exist, magic {magic} assetType {assetType}"),ACCOUNT_NOT_DAPPID_POSSESSOR:new te("001-11040","Account with address {address} not dappid {dappid} possessor, errorId {errorId}"),ACCOUNT_NOT_LOCATION_NAME_POSSESSOR:new te("001-11041","Account with address {address} not locationName {locationName} possessor, errorId {errorId}"),ACCOUNT_NOT_ENTITY_POSSESSOR:new te("001-11042","Account with address {address} not entityId {entityId} possessor, errorId {errorId}"),DAPPID_NOT_FROZEN:new te("001-11043","DAppid not frozen, dappid {dappid}"),DAPPID_ALREADY_FROZEN:new te("001-11044","DAppid already frozen, dappid {dappid}"),LOCATION_NAME_NOT_FROZEN:new te("001-11045","LocationName not frozen, locationName {locationName}"),LOCATION_NAME_ALREADY_FROZEN:new te("001-11046","LocationName already frozen, locationName {locationName}"),ENTITY_NOT_FROZEN:new te("001-11047","Entity not frozen, entityId {entityId}"),ENTITY_ALREADY_FROZEN:new te("001-11048","Entity already frozen, entityId {entityId}"),NO_NEED_TO_PURCHASE_SPECIAL_ASSET:new te("001-11049","No need to purchase asset, type {type} asset {asset}"),ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE:new te("001-11050","Only top level location name can exchange"),CAN_NOT_DESTROY_ENTITY:new te("001-11051","Can not destroy entityId {entityId}, reason {reason}"),ENTITY_ALREADY_DESTROY:new te("001-11052","Entity already destroy, entityId {entityId}"),ASSET_IS_ALREADY_MIGRATION:new te("001-11053","Asset is already migration, migrateCertificateId {migrateCertificateId}"),NOT_EXIST_OR_EXPIRED:new te("001-11054","{prop} in {target} not exist or expired"),NOT_EXPECTED_RELATED_TRANSACTION:new te("001-11055","Transaction with signature {signature} is not an expected related transaction"),CAN_NOT_SECONDARY_TRANSACTION:new te("001-11056","Can not secondary transaction, reason {reason}"),REGISTER_GENERATOR_QUOTA_FULL:new te("001-11057","The register generator quota is full in round {round}"),GENERATOR_CAN_NOT_MIGRATE_ASSET:new te("001-11058","Generator can not migrate asset"),MIGRATE_MAIN_ASSET_ONLY:new te("001-11059","You can only migrate main asset, {assetType} is not main asset {mainAsset}"),CAN_NOT_CARRY_SECOND_PUBLICKEY:new te("001-11060","Can not carry second publicKey"),CAN_NOT_CARRY_SECOND_SIGNATURE:new te("001-11061","Can not carry second signature"),POSSESS_FROZEN_ASSET:new te("001-11063","Account possess frozen asset"),NEED_EMIGRATE_TOTAL_ASSET:new te("001-11064","Need emigrate total asset, address {address}"),POSSESS_ASSET_EXCEPT_CHAIN_ASSET:new te("001-11065","Account possess asset expect chain asset"),POSSESS_FROZEN_ASSET_EXCEPT_CHAIN_ASSET:new te("001-11066","Account possess frozen asset expect chain asset"),ACCOUNT_CAN_NOT_BE_FROZEN:new te("001-11067","Account with address {address} can not be frozen, reason {reason}, errorId {errorId}"),TRUST_MAIN_ASSET_ONLY:new te("001-11068","You can only trust main asset, {assetType} is not main asset {mainAsset}"),ISSUE_ENTITY_TIMES_USE_UP:new te("001-11070","Issue entity times use up, entityFactory {entityFactory}"),ASSET_ALREADY_EXIST:new te("001-11071","Asset already exist, magic {magic} assetType {assetType}"),FROZEN_ASSET_NOT_EXIST_OR_EXPIRED:new te("001-11072","Frozen asset with frozenAddress {frozenAddress} signature {signature} assetType {assetType} in blockChain not exist or expired"),NOT_ENOUGH_ISSUE_ENTITY_TIMES:new te("001-11073","Not enough issue entity times, entityFactory {entityFactory}"),NOT_BEGIN_RESOLVE_YET:new te("001-11074","Promise is not begin to resolve yet, promiseId {promiseId}"),CERTIFICATE_IS_NOT_EXIST:new te("001-11075","Certificate is not exist, certificateId {certificateId}"),CERTIFICATE_IS_ALREADY_EXIST:new te("001-11076","Certificate is already exist, certificateId {certificateId}, errorId {errorId}"),CAN_NOT_DESTROY_CERTIFICATE:new te("001-11077","Can not destroy certificate, certificateId {certificateId}, reason {reason}"),ACCOUNT_NOT_CERTIFICATE_POSSESSOR:new te("001-11078","Account with address {address} not certificate {certificateId} possessor, errorId {errorId}"),CERTIFICATE_NOT_FROZEN:new te("001-11079","Certificate not frozen, certificateId {certificateId}"),CERTIFICATE_ALREADY_FROZEN:new te("001-11080","Certificate already frozen, certificateId {certificateId}"),CERTIFICATE_ALREADY_DESTROY:new te("001-11081","Certificate already destroy, certificateId {certificateId}"),FROZEN_ASSET_NOT_ENOUGH:new te("001-11082","Frozen asset not enough, frozenId {frozenId}, reason {reason}"),STAKE_ASSET_NOT_EXIST_OR_EXPIRED:new te("001-11083","Stake asset with stakeAddress {stakeAddress} stakeId {stakeId} in blockChain not exist or expired"),NOT_BEGIN_UNSTAKE_YET:new te("001-11084","Stake asset is not begin to unstake yet, stakeId {stakeId}"),STAKE_ASSET_NOT_ENOUGH:new te("001-11085","Stake asset not enough, stakeId {stakeId}, reason {reason}"),BLOCK_SIGN_SIGNATURE_IS_REQUIRED:new te("001-12001","Block signSignature is required, signature {signature} generatorAddress {generatorAddress} height {height}"),BLOCK_GENERATOR_SECOND_PUBLICKEY_ALREADY_CHANGE:new te("001-12002","Block generator second secret have already change, signature {signature} generatorAddress {generatorAddress} height {height}"),BLOCK_SHOULD_NOT_HAVE_GENERATOR_SECOND_PUBLICKEY:new te("001-12003","Block should not have generatorSecondPublicKey, signature {signature} generatorAddress {generatorAddress} height {height}"),BLOCK_SHOULD_NOT_HAVE_SIGN_SIGNATURE:new te("001-12004","Block should not have signSignature, signature {signature} generatorAddress {generatorAddress} height {height}"),OUT_OF_RANGE:new te("001-12005","{variable} out of range"),FAILED_TO_FIND_NEAREST_SAME_BLOCK_IN_ONE_ROUND:new te("001-12006","Failed to find nearest same block in one round, should not happen"),GENESIS_BLOCK_NOT_MATCH:new te("001-12007","GenesisBlock not match, the signature of genesisBlock and synchronized peer's genesisBlock's signature not equal"),FAILED_TO_GET_BLOCKS_BY_RANGE:new te("000-12008","Falied to get blocks by range({minHeight}~{maxHeight})"),INVALID_PARAMS:new te("001-22001","Invalid params: {params}"),INVALID_PARAMS_FIELD:new te("001-22002","Invalid params field: {field}"),GENESIS_BLOCK_MAYBE_NO_EQUAL:new te("001-22003","GenesisBlock maybe no equal"),INVALID_QUERYBLOCKARG_QUERY_PARAMS:new te("001-22004","Invalid QueryBlockArg query params, no query conditions"),QUERY_BLOCK_FROM_PEER_TIMEOUT:new te("001-22005","QueryBlock ({query}) from peer({peerId}) timeout"),REQID_REUSE:new te("001-22006","ReqId reuse"),CHAINCHANNEL_CLOSED:new te("001-22007","chainChannel closed"),REFUSE_RESPONSE_QUERY_TRANSACTION:new te("001-22008","Refuse response query transaction"),REFUSE_RESPONSE_INDEX_TRANSACTION:new te("001-22009","Refuse response index transaction"),REFUSE_RESPONSE_DOWNLOAD_TRANSACTION:new te("001-22010","Refuse response download transaction"),REFUSE_RESPONSE_BROADCAST_TRANSACTION:new te("001-22011","Refuse response broadcast transaction"),REFUSE_RESPONSE_QUERY_BLOCK:new te("001-22012","Refuse response query block"),REFUSE_RESPONSE_BROADCAST_BLOCK:new te("001-22013","Refuse response broadcast block"),MESSAGE_TYPE_ERROR:new te("001-22014","Message type error"),ONMESSAGE_GET_INVALID_REQ_ID:new te("001-22015","OnMessage get invalid req_id: {req_id}"),REQUEST_LIMIT:new te("001-22016","Request limit"),INVALID_MESSAGE_CMD:new te("001-22017","Invalid message cmd"),CHAINCHANNEL_TIMEOUT:new te("001-22018","ChainChannel Timeout, cmd {cmd}"),TASK_ABORT:new te("001-22019","Task {task_id} abort because the free chainChannel size is zero"),REFUSE_RESPONSE_OPEN_BLOB:new te("001-22020","Refuse response open blob"),REFUSE_RESPONSE_READ_BLOB:new te("001-22021","Refuse response read blob"),REFUSE_RESPONSE_CLOSE_BLOB:new te("001-22022","Refuse response close blob"),BLOB_ALGORITHM_IS_INVALID:new te("001-23001","blob({hash}) algorithm({algorithm}) is invalid"),FAIL_TO_DOWNLOAD_BLOB:new te("001-23002","Fail to download blob({hash}) size({size})")},M0=new Map,il=Error.captureStackTrace?e=>{const t={stack:""};return Error.captureStackTrace(t,e),t.stack}:Function("f",`
    let deep = 0;
    let caller = arguments.callee;
    do {
      if (caller.caller === f) {
        break;
      }
      deep += 1;
      caller = caller.caller;
      if (caller === null) {
        break;
      }
    } while (true);
    const stack = new Error().stack || "";
    const stackLineLine = stack.split('\\n');
    stackLineLine.splice(1, deep);
    return stackLineLine.join('\\n');
  `);class Qu extends Error{get name(){return this.constructor.name}static call(t,r){if(!(t instanceof Qu))throw new TypeError("please use new keyword to create CustomError instance.");return t.stack=il(t.constructor),t.message=r||"",t}}const Ng=()=>{},u_=Symbol("cog");function WE(e){for(const[t,r]of Object.entries(Object.getOwnPropertyDescriptors(e))){const n=r.get;n&&!n[u_]&&(r.get=()=>{const s=n();return Object.defineProperty(e,t,{value:s}),s},r.get[u_]=!0,Object.defineProperty(e,t,r))}return e}const qE=new Map;var L0=(e=>(e.BLOCKER="blocker",e.CRITICAL="critical",e.MAJOR="major",e.MINOR="minor",e))(L0||{});class ot extends Qu{constructor(t="",r,n,s){super(r?t instanceof te?t.build(r):t.replace(/\{([^\\]+?)\}/g,(a,p)=>r[p]??a):t instanceof te?t.message:t),this.detail=r;const i=this.constructor,{ERROR_CODE_MAP:o}=i;Object.defineProperties(this,{detail:{value:r,enumerable:!1,writable:!1},sourceMessage:{value:t,enumerable:!1,writable:!1},type:{value:i.TYPE,enumerable:!1,writable:!1},PLATFORM:{value:i.PLATFORM,enumerable:!1,writable:!1},CHANNEL:{value:i.CHANNEL,enumerable:!1,writable:!1},BUSINESS:{value:i.BUSINESS,enumerable:!1,writable:!1},MODULE:{value:i.MODULE,enumerable:!1,writable:!1},FILE:{value:i.FILE,enumerable:!1,writable:!1},CODE:{value:n??(t instanceof te?t.code:o.get(t)||o.get("unknown error")||""),enumerable:!1,writable:!1},SEVERIFY:{value:s||"major",enumerable:!1,writable:!1}})}get name(){return this.constructor.TYPE}static is(t){return!(!t||t.type!==this.TYPE)}}function D0(e,t,r,n,s,i){function o(a){return a.PLATFORM=e,a.CHANNEL=t,a.BUSINESS=r,a.MODULE=n,a.FILE=s,a.ERROR_CODE_MAP=i,Object.freeze(a),a}return WE({getException:o,get Exception(){const a=ot;return o(class extends a{})},get OutOfRangeException(){var a;return o(((a=class extends ot{}).TYPE="OutOfRangeException",a))},get ArgumentException(){var a;return o(((a=class extends ot{}).TYPE="ArgumentException",a))},get ArgumentIllegalException(){var a;return o(((a=class extends ot{}).TYPE="ArgumentIllegalException",a))},get ArgumentFormatException(){var a;return o(((a=class extends ot{}).TYPE="ArgumentFormatException",a))},get NoFoundException(){var a;return o(((a=class extends ot{}).TYPE="NoFoundException",a))},get ResponseException(){var a;return o(((a=class extends ot{}).TYPE="ResponseException",a))},get IOException(){var a;return o(((a=class extends ot{}).TYPE="IOException",a))},get NetworkIOException(){var a;return o(((a=class extends ot{}).TYPE="NetworkIOException",a))},get BusyIOException(){var a;return o(((a=class extends ot{}).TYPE="BusyIOException",a))},get DatebaseIOException(){var a;return o(((a=class extends ot{}).TYPE="DatebaseIOException",a))},get InterruptedException(){var a;return o(((a=class extends ot{}).TYPE="InterruptedException",a))},get IllegalStateException(){var a;return o(((a=class extends ot{}).TYPE="IllegalStateException",a))},get TimeOutException(){var a;return o(((a=class extends ot{}).TYPE="TimeOutException",a))},get BusyException(){var a;return o(((a=class extends ot{}).TYPE="BusyException",a))},get ConsensusException(){var a;return o(((a=class extends ot{}).TYPE="ConsensusException",a))},get AbortException(){var a;return o(((a=class extends ot{}).TYPE="AbortException",a))},get RefuseException(){var a;return o(((a=class extends ot{}).TYPE="RefuseException",a))}})}ot.TYPE="Exception",ot.PLATFORM="",ot.CHANNEL="",ot.BUSINESS="",ot.MODULE="",ot.FILE="",ot.CODE="",ot.SEVERIFY="major",ot.ERROR_CODE_MAP=qE,typeof Error.stackTraceLimit=="number"&&(Error.stackTraceLimit+=3);const Ua=1e3,$a=60*Ua,Va=60*$a,To=24*Va,F0=7*To,U0=365.25*To;function $0(e,t={}){switch(typeof e){case"string":if(e.length>0)return V0(e);break;case"number":if(isFinite(e))return t.long?K0(e):G0(e)}throw new Error(`val is not a non-empty string or a valid number. val=${JSON.stringify(e)}`)}function V0(e){const t=String(e);if(t.length>100)return;const r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!r)return;const n=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*U0;case"weeks":case"week":case"w":return n*F0;case"days":case"day":case"d":return n*To;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Va;case"minutes":case"minute":case"mins":case"min":case"m":return n*$a;case"seconds":case"second":case"secs":case"sec":case"s":return n*Ua;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}function G0(e){const t=Math.abs(e);return t>=To?`${Math.round(e/To)}d`:t>=Va?`${Math.round(e/Va)}h`:t>=$a?`${Math.round(e/$a)}m`:t>=Ua?`${Math.round(e/Ua)}s`:`${e}ms`}function K0(e){const t=Math.abs(e);return t>=To?Al(e,t,To,"day"):t>=Va?Al(e,t,Va,"hour"):t>=$a?Al(e,t,$a,"minute"):t>=Ua?Al(e,t,Ua,"second"):`${e} ms`}function Al(e,t,r,n){const s=t>=1.5*r;return`${Math.round(e/r)} ${n}${s?"s":""}`}var g_,f_,d_,Xr;function j0(e){return e.source.slice(1,-1).replace(/\.\*\?$/,"*").replace(/\\/g,"")}function y_(e){const t=e[0]==="-";return{type:t?"disable":"enable",source:e,regexp:new RegExp("^"+e.substr(t?1:0).replace(/\*/g,".*?")+"$")}}function z0(e){return(e.type==="disable"?"-":"")+j0(e.regexp)}class J0{constructor(){this.namespaceFilters=[],this._levelFilter=t=>!0,this._createdDebugCache=new kt(t=>new Xc(t,this)),this.setNamespaceFilter(this.load())}getNamespaceFilter(){return this.namespaceFilters.map(t=>t.source)}_resetInstancesEnabled(){for(const t of this._createdDebugCache.values()){t.forceSetEnabled(this.isEnabled(t.namespace,t.level));for(const r of t.scopePrinterMap.keys())r.enabled=this.levelFilter(r.level)}}setNamespaceFilter(t){t=typeof t=="string"?t:t.join(","),this.namespaceFilters.length=0;const r=[...new Set(t.split(/[\s,]+/))];for(const n of r)n&&this.namespaceFilters.push(y_(n));this._resetInstancesEnabled(),this.save(r.join(","))}addNamespaceFilter(t,r){this.removeNamespaceFilter(t),t=typeof t=="string"?y_(t):t,r===void 0||r>this.namespaceFilters.length-1||r<0?this.namespaceFilters.push(t):this.namespaceFilters.splice(r,0,t),this._resetInstancesEnabled(),this.save(this.getNamespaceFilter().join(","))}removeNamespaceFilter(t){const r=n=>n>=0&&n<this.namespaceFilters.length&&(this.namespaceFilters.splice(n,1),this._resetInstancesEnabled(),this.save(this.getNamespaceFilter().join(",")),!0);return typeof t=="number"?r(t):typeof t=="string"?r(this.namespaceFilters.findIndex(n=>n.source===t)):r(this.namespaceFilters.indexOf(t))||this.removeNamespaceFilter(z0(t))}get levelFilter(){return this._levelFilter}set levelFilter(t){this._levelFilter=t,this._resetInstancesEnabled()}isEnabled(t,r){if(!this.levelFilter(r))return!1;if(t[t.length-1]==="*")return!0;for(let n=this.namespaceFilters.length-1;n>=0;n--){const s=this.namespaceFilters[n];if(s.regexp.test(t))return s.type==="enable"}return!1}selectColor(t){let r=0;for(let n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n),r|=0;return this.colors[Math.abs(r)%this.colors.length]}getCreatedDebugs(){return this._createdDebugCache.values()}create(t){return this._createdDebugCache.forceGet(t)}destroy(t){return this._createdDebugCache.delete(t)}}class Xc{constructor(t,r,n){this.namespace=t,this._creater=r,this.__prev=0,this.__curr=0,this._scope=new kt(a=>{const p=kt.from({creater:l=>({id:this._scopeIdAcc++,color:a,level:l,enabled:this._creater.levelFilter(l)}),afterDelete:()=>{p.size===0&&this._scope.delete(a)}});return p}),this._scopeIdAcc=0,this.scopePrinterMap=kt.from({creater:a=>this._printerBuilder(a)}),this.$enableDefaultFormatter=!1,typeof r.init=="function"&&r.init(this);let s=0,i=!1,o=!1;return n&&(n.enableTime!==void 0&&(i=n.enableTime),n.enableDuration!==void 0&&(o=n.enableDuration),n.level!==void 0&&(s=n.level)),this._config={useColors:this._creater.canUseColors(),enabled:this._creater.isEnabled(this.namespace,s),color:this._creater.selectColor(this.namespace),level:s,enableTime:i,enableDuration:o},this}get useColors(){return this._config.useColors}forceSetUseColors(t){this._config.useColors=t}get enabled(){return this._config.enabled}forceSetEnabled(t){this._config.enabled=t}get color(){return this._config.color}get level(){return this._config.level}get enableTime(){return this._config.enableTime}get enableDuration(){return this._config.enableDuration}getDiff(){return this._curr-this._prev}get _prev(){return this.__prev}get _curr(){return this.__curr||(this.__curr=Date.now())}_resetDiff(){this.__prev=this.__curr,this.__curr=0}getDuration(){return $0(this.getDiff())}get _dater(){return new Date}getTime(){return this._dater.setTime(Date.now()),this._dater.toLocaleTimeString()}destroy(){this._config.enabled=!1,this._creater.destroy(this.namespace)}get print(){return this.scopePrinterMap.forceGet(this._config)}createPrinter(t,r){const n=this._scope.forceGet(t).forceGet(r);return this.scopePrinterMap.forceGet(n)}deletePrinter(t,r){const n=this._scope.tryGet(t);if(n){const s=n.tryGet(r);if(s)return n.delete(r),this.scopePrinterMap.delete(s)}return!1}_printerBuilder(t){const{_creater:r}=this,n=()=>t.enabled&&this.enabled,s=(...i)=>{if(!n())return;this._resetDiff();let o=typeof i[0]!="string"?"%O":i.shift();if(this.$enableDefaultFormatter){let p=0;o=o.replace(/%([a-zA-Z%])/g,(l,h)=>{if(l==="%%")return l;const y=r.formatters[h];return typeof y=="function"&&(l=y(this,i[p]),i.splice(p,1),p--),p++,l})}const a=[o,...i];r.formatArgs(this,a,t),r.printArgs(this,a,t)};return Object.defineProperty(s,"enabled",{get:n}),s}}u([ge,g("design:type",Object),g("design:paramtypes",[])],Xc.prototype,"_dater",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Xc.prototype,"print",null),u([Je,g("design:type",Function),g("design:paramtypes",[Object,typeof(g_=typeof BFChainUtilLogger<"u"&&BFChainUtilLogger.DebugLevel)=="function"?g_:Object]),g("design:returntype",typeof(f_=typeof BFChainUtilLogger<"u"&&BFChainUtilLogger.Pinter)=="function"?f_:Object)],Xc.prototype,"createPrinter",null),u([Je,g("design:type",Function),g("design:paramtypes",[Object,typeof(d_=typeof BFChainUtilLogger<"u"&&BFChainUtilLogger.DebugLevel)=="function"?d_:Object]),g("design:returntype",Boolean)],Xc.prototype,"deletePrinter",null),(function(e){e[e.log=0]="log",e[e.info=1]="info",e[e.warn=2]="warn",e[e.trace=3]="trace",e[e.success=4]="success",e[e.error=5]="error"})(Xr||(Xr={}));class Gs extends J0{constructor(){super(...arguments),this.formatters={j(t,r){try{return JSON.stringify(r)}catch(n){return"[UnexpectedJSONParseError]: "+(n instanceof Error?n.message:n)}},t(t,r){let n;switch(typeof r){case"string":case"number":n=r;break;default:n=r instanceof Date?r:String(r)}return new Date(n).toLocaleString()},s:(t,r)=>String(r),d:(t,r)=>Number(r).toString()}}get colorTypeName(){return"browser"}get colors(){return"0000CC 0000FF 0033CC 0033FF 0066CC 0050c8 006080 005c99 006800 00681a 006733 00654c 006363 006179 3300CC 3300FF 3333CC 3232fb 2b55aa 274ec4 205f7e 1e5b97 1a6700 1a671a 196633 19644b 196262 186078 6600CC 6500fd 6633CC 5c2ee6 326500 326419 9100c2 8300da 842cb1 7928ca 496100 486018 b60000 b4002d b00058 a9007e 9f009f 9500ba a72a00 a62a2a a32951 9d2776 952595 8c23af 8c4600 8b4523 715400 70541c 5c5c00 5b5b17 b50024 b20047 ad0068 a70086 ac2200 ab2222 a82243 a42163 9f207f 981e98 973d00 973c1e 804d00 804d1a 6c5600 6c5616".split(" ").map(t=>"#"+t)}get storage(){try{return localStorage}catch{}}load(){let t;return t=this.storage&&this.storage.getItem("debug"),!t&&typeof process<"u"&&"env"in process&&(t={}.DEBUG),t||""}save(t){this.storage&&(t?this.storage.setItem("debug",t):this.storage.removeItem("debug"))}canUseColors(){return!0}static _getHtmlNamespace(t){let r=this._NamespaceWithToHtmlCache.get(t);return r===void 0&&(r=new this._namespaceCtor(t.namespace),this._NamespaceWithToHtmlCache.set(t,r)),r}static _getHtmlDuration(t){return new this._durationCtor(t)}formatArgs(t,r,n=t){const s="color: "+n.color;if(t.useColors){const i=[],o=Gs._getHtmlNamespace(t);o.buildHTML(s),t.enableTime?(r[0]=`[%s] %o %c${r[0]}`,i[i.length]=t.getTime(),i[i.length]=o):(r[0]=`%o ${r[0]}`,i[i.length]=o),r.splice(1,0,...i)}else r[0]=`${t.namespace} ${r[0]}`,t.enableTime&&(r[0]=`[${t.getTime()}] ${r[0]}`);if(t.enableDuration)if(t.useColors){const i=Gs._getHtmlDuration(t.getDiff());i.buildHTML(s),r[r.length]=i}else r.push(`+${t.getDuration()}`);return r}printArgs(t,r,n=t){switch(n.level){case Xr.log:console.log(...r);break;case Xr.info:console.info(...r);break;case Xr.warn:console.warn(...r);break;case Xr.trace:console.trace(...r);break;case Xr.success:console.info(...r);break;case Xr.error:console.error(...r)}}}Gs._NamespaceWithToHtmlCache=new WeakMap,Gs._namespaceCtor=new Function(`return class Namespace extends String {
    buildHTML(style) {
      if ((this.buildHTML.tmpStyle = style)) {
        this.buildHTML.tmpStyle = style;
        this.buildHTML.tmpHTML = \`<i class="logger-namespace" style="\${style}">\${this}ms</i>\`;
      }
    }
    toHTML() {
      return this.buildHTML.tmpHTML || this.toString();
    }
  }`)(),Gs._durationCtor=new Function(`return class Duration extends Number {
      buildHTML(style) {
        if ((this.buildHTML.tmpStyle = style)) {
          this.buildHTML.tmpStyle = style;
          this.buildHTML.tmpHTML = \`<i class="logger-duration" style="\${style}">+\${this}</i>\`;
        }
      }
      toHTML() {
        return this.buildHTML.tmpHTML || this.toString();
      }
    }`)(),u([ge,g("design:type",Object),g("design:paramtypes",[])],Gs.prototype,"colors",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Gs.prototype,"storage",null);const Y0=()=>new Gs,Q0=Y0(),pa={log:"inherit",info:"inherit",trace:"inherit",success:"inherit",warn:"inherit",error:"inherit"};function ha(e,t,r){const n=Q0.create(e);return n.forceSetUseColors(!0),n.createPrinter(n.color,r)}function X0(e){return WE({get log(){return ha(e,pa.log,Xr.log)},get info(){return ha(e,pa.info,Xr.info)},get warn(){return ha(e,pa.warn,Xr.warn)},get success(){return ha(e,pa.success,Xr.success)},get trace(){return ha(e,pa.trace,Xr.trace)},get error(){return ha(e,pa.error,Xr.error)}})}const ZE=!!(typeof process<"u"&&process&&process.versions&&process.versions.node),W0=typeof process<"u"&&(process.platform==="win32"||/^(msys|cygwin)$/.test(process.env&&{}.OSTYPE)),zy=(e,t)=>{try{return new Function(`return typeof ${e} === "${t}"`)()}catch{return!1}},eI=zy("cordova","object"),ol=zy("navigator","object"),q0=ol&&/Android/i.test(navigator.userAgent),Z0=ol&&/iPhone|iPod|iPad/i.test(navigator.userAgent),Jy=ol&&zy("document","object"),tI=ol&&!Jy,Vs={getGlobalFlag(e,t=""){const r=this.global();return r[e]||r.process&&r.process.env&&r.process.env[e]||r.location&&r.location.href&&new URL(r.location.href).searchParams.get(e)||r.localStorage&&r.localStorage.getItem(e)||t},global(){const e=typeof globalThis=="object"?globalThis:typeof self=="object"?self.globalThis=self:typeof _s=="object"?_s.globalThis=_s:Function("return this")();return this.global=()=>e,e},platformName(){if(ZE)return"Nodejs";const e=q0?"Android":Z0?"IOS":"unknown";return eI?"Cordova-"+e:Jy?"WebMaster-"+e:tI?"WebWorker-"+e:"UNKNOWN"},getChannel:()=>"UNKNOWN",getBusiness:()=>"UNKNOWN"};var m_,rp;function eb(e,t,r,n,s,i){let o=`${t.toLowerCase()}-${r.toLowerCase()}`;n&&(o+=`:${n}`),s&&(o+=`/${s}`);const a=X0(o),p=D0(e,t,r,n,s,i);return new Proxy({},{get:(l,h)=>l[h]||a[h]||p[h]})}function tb(e){const t=typeof e.platform=="string"?e.platform:Vs.getGlobalFlag("PLATFORM")||Vs.platformName(),r=typeof e.platform=="string"?e.platform:Vs.getGlobalFlag("CHANNEL")||Vs.getChannel(),n=typeof e.platform=="string"?e.platform:Vs.getGlobalFlag("BUSINESS")||Vs.getBusiness();return function(s,i,o){return eb(o.platformName||t,o.channelName||r,o.businessName||n,s,i,o.errorCodeMap)}}(function(e){e.PLATFORM="exception.platform",e.CHANNEL="exception.channel",e.BUSINESS="exception.business"})(rp||(rp={}));let wa=class{constructor(e){this.moduleMap=e,this.platformName=void 0,this.channelName=void 0,this.businessName=void 0,this.exceptionGeneratorDefiner=tb({platform:this.platformName,channel:this.channelName,business:this.businessName})}};u([Z(rp.PLATFORM,{dynamics:!0,optional:!0}),g("design:type",String)],wa.prototype,"platformName",void 0),u([Z(rp.CHANNEL,{dynamics:!0,optional:!0}),g("design:type",String)],wa.prototype,"channelName",void 0),u([Z(rp.BUSINESS,{dynamics:!0,optional:!0}),g("design:type",String)],wa.prototype,"businessName",void 0),wa=u([ie("bfchain-util:custom-exception",{singleton:!0}),g("design:paramtypes",[typeof(m_=et!==void 0&&et)=="function"?m_:Object])],wa);const rb=Ht(wa);function rI(e,t,r){return rb.exceptionGeneratorDefiner(e,t,Object.assign({errorCodeMap:qE,businessName:"util"},r))}let nI=class extends ot{};nI.TYPE="IdempotentException";function le(e,t){const r=rI(e,t,{errorCodeMap:M0,businessName:"core"});let n;return Object.create(r,{IdempotentException:{get(){return n??(n=r.getException(nI))}}})}var Xu;const{ArgumentFormatException:Og,error:RN,IllegalStateException:nb}=le("MODEL","transactionModel");(()=>{const e=new Map,t=new Map;for(const s in W){const i=W[s];t.set(s,i),e.set(i,s)}const r=new Map,n=new Map;[[W.SIGNATURE,Jp],[W.DAPP,Yp],[W.DAPP_PURCHASING,Qp],[W.MARK,Xp],[W.ISSUE_ASSET,Wp],[W.INCREASE_ASSET,qp],[W.DESTROY_ASSET,eh],[W.TRANSFER_ASSET,Zp],[W.GIFT_ASSET,mo],[W.GRAB_ASSET,th],[W.TRUST_ASSET,Ha],[W.SIGN_FOR_ASSET,rh],[W.EMIGRATE_ASSET,nh],[W.IMMIGRATE_ASSET,sh],[W.TO_EXCHANGE_ASSET,Ma],[W.BE_EXCHANGE_ASSET,ih],[W.STAKE_ASSET,_o],[W.UNSTAKE_ASSET,oh],[W.LOCATION_NAME,ah],[W.SET_LNS_RECORD_VALUE,ph],[W.SET_LNS_MANAGER,ch],[W.ISSUE_ENTITY_FACTORY,hh],[W.ISSUE_ENTITY_FACTORY_V1,lh],[W.ISSUE_ENTITY,Ao],[W.DESTROY_ENTITY,uh],[W.ISSUE_ENTITY_MULTI,Eo],[W.TRANSFER_ANY,gh],[W.GIFT_ANY,Io],[W.GRAB_ANY,fh],[W.TO_EXCHANGE_ANY,La],[W.BE_EXCHANGE_ANY,dh],[W.TO_EXCHANGE_ANY_MULTI,Da],[W.BE_EXCHANGE_ANY_MULTI,yh],[W.TO_EXCHANGE_ANY_MULTI_ALL,Fa],[W.BE_EXCHANGE_ANY_MULTI_ALL,mh],[W.ISSUE_CERTIFICATE,_h],[W.DESTROY_CERTIFICATE,Ah]].forEach(([s,i])=>{r.set(s,i),n.set(i,s)}),Me.VK=e,Me.KV=t,Me.VM=r,Me.MV=n})();const Cg=new WeakMap;let bo=Xu=class extends oe{get transaction(){let e=Cg.get(this._trs_bytes);if(!e){const t=Me.VM.get(this._trs_base_type);if(!t)throw new Og(c.INVALID_TRANSACTION_BASE_TYPE,{base_type:this._trs_base_type});e=t.decode(this._trs_bytes),Cg.set(this._trs_bytes,Object.freeze(e))}return e}set transaction(e){const t=Me.trsTypeToV(e.type);if(!Me.VK.has(t))throw new Og(c.INVALID_TRANSACTION_BASE_TYPE,{base_type:t});if(Object.isFrozen(this))throw new nb(c.TRANSACTION_IS_IN_UNCHANGABLE_STATE);this._trs_base_type=t,this._trs_bytes=new Uint8Array(e.constructor.encode(e).finish()),Object.isFrozen(e)&&Cg.set(this._trs_bytes,e)}static fromObject(e){const t=super.fromObject(e);if(e!==t){const r=e.transaction;if(r)if(r instanceof oe)t.transaction=r;else{const n=r.type;if(n){const s=Me.trsTypeToV(n),i=Me.VM.get(s);if(!i)throw new Og(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.transaction=i.fromObject(r)}}}return t}toJSON(){return{transaction:this.transaction.toJSON()}}};bo.INC=1;u([I.d(Xu.INC++,"string"),g("design:type",String)],bo.prototype,"_trs_base_type",void 0);u([I.d(Xu.INC++,"bytes"),g("design:type",Uint8Array)],bo.prototype,"_trs_bytes",void 0);bo=Xu=u([j.d("SomeTransactionModel")],bo);var Wu,ta;let wo=Wu=class extends oe{toJSON(){return{remainAssetPrealnum:this.remainAssetPrealnum,frozenMainAssetPrealnum:this.frozenMainAssetPrealnum}}};wo.INC=1;u([I.d(Wu.INC++,"string"),g("design:type",String)],wo.prototype,"remainAssetPrealnum",void 0);u([I.d(Wu.INC++,"string"),g("design:type",String)],wo.prototype,"frozenMainAssetPrealnum",void 0);wo=Wu=u([j.d("AssetPrealnumModel")],wo);let ar=ta=class extends bo{get signature(){return Pe(this.signatureBuffer)}set signature(e){this.signatureBuffer=be(e)}get signSignature(){return this.signSignatureBuffer&&Pe(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=be(e)}getBytes(e,t){const r={};e&&(r.signatureBuffer={value:null}),t&&(r.signSignatureBuffer={value:null});const n=Object.create(this,r);return this.$type.encode(n).finish()}toJSON(){const e={tIndex:this.tIndex,height:this.height,signature:this.signature,transaction:this.transaction.toJSON()};return this.assetPrealnum&&(e.assetPrealnum=this.assetPrealnum.toJSON()),this.signSignature&&(e.signSignature=this.signSignature),e}static fromObject(e){const t=super.fromObject(e);return e!==t&&(e.signature&&(t.signature=e.signature),e.signSignature&&(t.signSignature=e.signSignature)),t}};u([I.d(ta.INC++,"uint32"),g("design:type",Number)],ar.prototype,"tIndex",void 0);u([I.d(ta.INC++,"uint32"),g("design:type",Number)],ar.prototype,"height",void 0);u([I.d(ta.INC++,wo,"optional"),g("design:type",wo)],ar.prototype,"assetPrealnum",void 0);u([I.d(ta.INC++,"bytes"),g("design:type",Uint8Array)],ar.prototype,"signatureBuffer",void 0);u([I.d(ta.INC++,"bytes","optional"),g("design:type",Uint8Array)],ar.prototype,"signSignatureBuffer",void 0);u([ai,g("design:type",Function),g("design:paramtypes",[Boolean,Boolean]),g("design:returntype",void 0)],ar.prototype,"getBytes",null);ar=ta=u([j.d("TransactionInBlock")],ar);function Yy(e,t,r){const n=[];for(const s in e)n[n.length]={sortKey:s,value:r(e[s])};n.sort((s,i)=>s.sortKey>i.sortKey?1:-1),t.clear();for(const s of n)t.set(s.sortKey,s.value);return t}var xc;let ss=xc=class extends oe{toJSON(){return{changeAmount:this.changeAmount,changeCount:this.changeCount,moveAmount:this.moveAmount,transactionCount:this.transactionCount}}};ss.INC=1;u([I.d(xc.INC++,"string","required","0"),g("design:type",String)],ss.prototype,"changeAmount",void 0);u([I.d(xc.INC++,"uint32","required",0),g("design:type",Number)],ss.prototype,"changeCount",void 0);u([I.d(xc.INC++,"string","required","0"),g("design:type",String)],ss.prototype,"moveAmount",void 0);u([I.d(xc.INC++,"uint32","required",0),g("design:type",Number)],ss.prototype,"transactionCount",void 0);ss=xc=u([j.d("CountAndAmountStatisticModel")],ss);var qu,Qy;let So=qu=class extends oe{get typeStatisticMap(){return this._typeStatisticMap||(this._typeStatisticMap=new Ri(this.typeStatisticHashMap))}toJSON(){return{typeStatisticHashMap:this.typeStatisticMap.toJSON(),total:this.total.toJSON()}}static fromObject(e){return e.total||(e=Object.create(e,{total:{}})),super.fromObject(e)}format(){return Yy(this.typeStatisticHashMap,this.typeStatisticMap,e=>e),this}};So.INC=1;u([wr.d(qu.INC++,"string",ss),g("design:type",Object)],So.prototype,"typeStatisticHashMap",void 0);u([I.d(qu.INC++,ss),g("design:type",ss)],So.prototype,"total",void 0);So=qu=u([j.d("AssetStatisticModel")],So);let No=Qy=class extends oe{get assetTypeTypeStatisticMap(){return this._assetTypeTypeStatisticMap||(this._assetTypeTypeStatisticMap=new Ri(this.assetTypeTypeStatisticHashMap))}toJSON(){return{assetTypeTypeStatisticHashMap:this.assetTypeTypeStatisticMap.toJSON()}}format(){return Yy(this.assetTypeTypeStatisticHashMap,this.assetTypeTypeStatisticMap,e=>e.format()),this}static fromObject(e){return super.fromObject(e)}};No.INC=1;u([wr.d(Qy.INC++,"string",So),g("design:type",Object)],No.prototype,"assetTypeTypeStatisticHashMap",void 0);No=Qy=u([j.d("AssetTypeAssetStatisticModel")],No);var qi;let dn=qi=class extends oe{get magicAssetTypeTypeStatisticMap(){return this._magicAssetTypeTypeStatisticMap||(this._magicAssetTypeTypeStatisticMap=new Ri(this.magicAssetTypeTypeStatisticHashMap))}get numberOfTransactionsMap(){return this._numberOfTransactionsMap||(this._numberOfTransactionsMap=new Ri(this.numberOfTransactionsHashMap))}get numberOfTransactions(){let e=0;const t=this.numberOfTransactionsHashMap;for(const r in t)e+=t[r];return e}toJSON(){return{totalFee:this.totalFee,totalAsset:this.totalAsset,totalChainAsset:this.totalChainAsset,totalAccount:this.totalAccount,magicAssetTypeTypeStatisticHashMap:this.magicAssetTypeTypeStatisticMap.toJSON(),numberOfTransactionsHashMap:this.numberOfTransactionsHashMap}}getBytes(){return super.getBytes()}format(){return Yy(this.magicAssetTypeTypeStatisticHashMap,this.magicAssetTypeTypeStatisticMap,e=>e.format()),this}};dn.INC=1;u([I.d(qi.INC++,"string","required","0"),g("design:type",String)],dn.prototype,"totalFee",void 0);u([I.d(qi.INC++,"string","required","0"),g("design:type",String)],dn.prototype,"totalAsset",void 0);u([I.d(qi.INC++,"string","required","0"),g("design:type",String)],dn.prototype,"totalChainAsset",void 0);u([I.d(qi.INC++,"uint32","required",0),g("design:type",Number)],dn.prototype,"totalAccount",void 0);u([wr.d(qi.INC++,"string",No),g("design:type",Object)],dn.prototype,"magicAssetTypeTypeStatisticHashMap",void 0);u([wr.d(qi.INC++,"string","uint32"),g("design:type",Object)],dn.prototype,"numberOfTransactionsHashMap",void 0);u([ai,g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",void 0)],dn.prototype,"getBytes",null);dn=qi=u([j.d("StatisticInfoModel")],dn);var Ps,Rc;const sb=new As(e=>new Ri(e.remark)),__=new WeakMap,xg=new WeakMap;let df=class extends oe{};u([I.d(1,"uint32"),g("design:type",Number)],df.prototype,"version",void 0);df=u([j.d("BlockVersionReader")],df);let yn=Ps=class extends oe{get payloadHash(){return Pe(this.payloadHashBuffer)}set payloadHash(e){this.payloadHashBuffer=be(e)}get blobSize(){return this.blobSizeLong.toNumber()}set blobSize(e){this.blobSizeLong=ep.fromNumber(e,!0)}get totalAmount(){return this.statisticInfo.totalAsset||"0"}get totalFee(){return this.statisticInfo.totalFee||"0"}get transactionInBlocks(){const{transactionInBlockBufferList:e}=this;let t=__.get(e);return t||(t=this.transactionInBlockBufferList.map(r=>{const n=ar.decode(r);return xg.set(n,r),n})),t}set transactionInBlocks(e){const t=e.map(r=>{let n=xg.get(r);return n||(n=ar.encode(r).finish(),xg.set(r,n)),n});__.set(t,e),this.transactionInBlockBufferList=t}toJSON(){return{startTindex:this.startTindex,offset:this.offset,numberOfTransactions:this.numberOfTransactions,payloadHash:this.payloadHash,payloadLength:this.payloadLength,blobSize:this.blobSize,totalAmount:this.totalAmount,totalFee:this.totalFee,transactionInBlocks:this.transactionInBlocks.map(e=>e.toJSON()),statisticInfo:this.statisticInfo.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e){e.blobSize!==void 0&&(t.blobSize=e.blobSize),e.payloadHash&&(t.payloadHash=e.payloadHash);const r=[];if(e.transactionInBlocks){const n=e.transactionInBlocks;for(const s of n)r[r.length]=ar.fromObject(s)}t.transactionInBlocks=r}return t}};yn.INC=1;u([I.d(Ps.INC++,"uint32"),g("design:type",Number)],yn.prototype,"startTindex",void 0);u([I.d(Ps.INC++,"uint32"),g("design:type",Number)],yn.prototype,"offset",void 0);u([I.d(Ps.INC++,"uint32"),g("design:type",Number)],yn.prototype,"numberOfTransactions",void 0);u([I.d(Ps.INC++,"bytes"),g("design:type",Uint8Array)],yn.prototype,"payloadHashBuffer",void 0);u([I.d(Ps.INC++,"uint32"),g("design:type",Number)],yn.prototype,"payloadLength",void 0);u([I.d(Ps.INC++,"uint64"),g("design:type",Object)],yn.prototype,"blobSizeLong",void 0);u([I.d(Ps.INC++,dn),g("design:type",dn)],yn.prototype,"statisticInfo",void 0);u([I.d(Ps.INC++,"bytes","repeated"),g("design:type",Array)],yn.prototype,"transactionInBlockBufferList",void 0);yn=Ps=u([j.d("BlockTransactionInfo")],yn);let Mt=Rc=class extends oe{get signature(){return Pe(this.signatureBuffer)}set signature(e){this.signatureBuffer=be(e)}get generatorPublicKey(){return Pe(this.generatorPublicKeyBuffer)}set generatorPublicKey(e){this.generatorPublicKeyBuffer=be(e)}get generatorSecondPublicKey(){return this.generatorSecondPublicKeyBuffer&&Pe(this.generatorSecondPublicKeyBuffer)||void 0}set generatorSecondPublicKey(e){this.generatorSecondPublicKeyBuffer=be(e)}get signSignature(){return this.signSignatureBuffer&&Pe(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=be(e)}get remarkMap(){return sb.forceGet(this)}get startTindex(){return this.transactionInfo.startTindex}get offset(){return this.transactionInfo.offset}get numberOfTransactions(){return this.transactionInfo.numberOfTransactions}get payloadHash(){return this.transactionInfo.payloadHash}get payloadLength(){return this.transactionInfo.payloadLength}get blobSize(){return this.transactionInfo.blobSize}get totalAmount(){return this.transactionInfo.totalAmount}get totalFee(){return this.transactionInfo.totalFee}get statisticInfo(){return this.transactionInfo.statisticInfo}get transactionBufferList(){return this.transactionInfo.transactionInBlockBufferList}get transactions(){return this.transactionInfo.transactionInBlocks}getBytes(e,t,r){const n={};if(e&&(n.signatureBuffer={value:null}),t&&(n.signSignatureBuffer={value:null}),r){const i=this.transactionInfo;r===!0?n.transactionInfo={value:{startTindex:i.startTindex,offset:i.offset,numberOfTransactions:i.numberOfTransactions,payloadHashBuffer:i.payloadHashBuffer,payloadLength:i.payloadLength,blobSizeLong:i.blobSizeLong,statisticInfo:i.statisticInfo,transactionInBlockBufferList:[],totalAmount:i.totalAmount,totalFee:i.totalFee}}:n.transactionInfo={value:{startTindex:i.startTindex,offset:i.offset,numberOfTransactions:i.numberOfTransactions,payloadHashBuffer:i.payloadHashBuffer,payloadLength:i.payloadLength,blobSizeLong:i.blobSizeLong,statisticInfo:i.statisticInfo,transactionInBlockBufferList:r,totalAmount:i.totalAmount,totalFee:i.totalFee}}}const s=Object.create(this,n);return this.$type.encode(s).finish()}toJSON(){const e={version:this.version,height:this.height,blockSize:this.blockSize,timestamp:this.timestamp,signature:this.signature,generatorPublicKey:this.generatorPublicKey,previousBlockSignature:this.previousBlockSignature,reward:this.reward,magic:this.magic,remark:this.remark,asset:this.asset.toJSON(),transactionInfo:this.transactionInfo.toJSON()};return this.generatorSecondPublicKey&&(e.generatorSecondPublicKey=this.generatorSecondPublicKey),this.signSignature&&(e.signSignature=this.signSignature),e}static fromObject(e){const t=super.fromObject(e);return e.generatorPublicKey&&(t.generatorPublicKey=e.generatorPublicKey),e.generatorSecondPublicKey&&(t.generatorSecondPublicKey=e.generatorSecondPublicKey),e.signature&&(t.signature=e.signature),e.signSignature&&(t.signSignature=e.signSignature),t}};Mt.INC=10;u([I.d(1,"uint32"),g("design:type",Number)],Mt.prototype,"version",void 0);u([I.d(2,"uint32"),g("design:type",Number)],Mt.prototype,"height",void 0);u([I.d(3,"bytes"),g("design:type",Uint8Array)],Mt.prototype,"signatureBuffer",void 0);u([I.d(4,"uint32"),g("design:type",Number)],Mt.prototype,"timestamp",void 0);u([I.d(5,"bytes"),g("design:type",Uint8Array)],Mt.prototype,"generatorPublicKeyBuffer",void 0);u([I.d(6,"string"),g("design:type",String)],Mt.prototype,"previousBlockSignature",void 0);u([I.d(7,"string"),g("design:type",String)],Mt.prototype,"magic",void 0);u([I.d(8,"bytes","optional"),g("design:type",Uint8Array)],Mt.prototype,"generatorSecondPublicKeyBuffer",void 0);u([I.d(9,"bytes","optional"),g("design:type",Uint8Array)],Mt.prototype,"signSignatureBuffer",void 0);u([I.d(Rc.INC++,"uint32"),g("design:type",Number)],Mt.prototype,"blockSize",void 0);u([wr.d(Rc.INC++,"string","string"),g("design:type",Object)],Mt.prototype,"remark",void 0);u([I.d(Rc.INC++,"string","required","0"),g("design:type",String)],Mt.prototype,"reward",void 0);u([I.d(Rc.INC++,yn),g("design:type",yn)],Mt.prototype,"transactionInfo",void 0);u([ai,g("design:type",Function),g("design:paramtypes",[Boolean,Boolean,Object]),g("design:returntype",void 0)],Mt.prototype,"getBytes",null);Mt=Rc=u([j.d("Block")],Mt);var Xy;let Oo=Xy=class extends oe{get assetChangeHash(){if(this.assetChangeBuffer!==void 0)return Pe(this.assetChangeBuffer)}set assetChangeHash(e){this.assetChangeBuffer=be(e)}toJSON(){const e={};return this.assetChangeHash&&(e.assetChangeHash=this.assetChangeHash),e}getBytes(){return this.$type.encode(this).finish()}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.assetChangeHash&&(t.assetChangeHash=e.assetChangeHash),t}};Oo.INC=1;u([I.d(Xy.INC++,"bytes","optional"),g("design:type",Uint8Array)],Oo.prototype,"assetChangeBuffer",void 0);u([ai,g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",void 0)],Oo.prototype,"getBytes",null);Oo=Xy=u([j.d("CommonAssetModel")],Oo);let Eh=class extends oe{toJSON(){return{commonAsset:this.commonAsset.toJSON()}}};u([I.d(1,Oo),g("design:type",Oo)],Eh.prototype,"commonAsset",void 0);Eh=u([j.d("CommonBlockAssetModel")],Eh);var Zu,Wy;let Ga=Zu=class extends oe{toJSON(){return{address:this.address,numberOfForgeEntities:this.numberOfForgeEntities}}};Ga.INC=1;u([I.d(Zu.INC++,"string"),g("design:type",String)],Ga.prototype,"address",void 0);u([I.d(Zu.INC++,"uint32"),g("design:type",Number)],Ga.prototype,"numberOfForgeEntities",void 0);Ga=Zu=u([j.d("NextRoundGeneratorModel")],Ga);let Ka=Wy=class extends oe{get nextRoundGeneratorAddressList(){if(!this._next_round_generator_address_list){this._next_round_generator_address_list=[];for(const e of this.nextRoundGenerators)this._next_round_generator_address_list.push(e.address)}return this._next_round_generator_address_list}toJSON(){return{nextRoundGenerators:this.nextRoundGenerators.map(e=>e.toJSON())}}};Ka.INC=1;u([I.d(Wy.INC++,Ga,"repeated"),g("design:type",Array)],Ka.prototype,"nextRoundGenerators",void 0);Ka=Wy=u([j.d("RoundGeneratorModel")],Ka);var pt;let Ih=class extends oe{toJSON(){return{port:this.port}}};u([I.d(1,"uint32"),g("design:type",Number)],Ih.prototype,"port",void 0);Ih=u([j.d("PortsModel")],Ih);let at=pt=class extends Ka{get beginEpochTime(){return this.beginEpochTimeLong.toNumber()}set beginEpochTime(e){this.beginEpochTimeLong=ep.fromNumber(e,!0)}get maxTransactionBlobSize(){return this.maxTransactionBlobSizeLong.toNumber()}set maxTransactionBlobSize(e){this.maxTransactionBlobSizeLong=ep.fromNumber(e,!0)}get maxBlockBlobSize(){return this.maxBlockBlobSizeLong.toNumber()}set maxBlockBlobSize(e){this.maxBlockBlobSizeLong=ep.fromNumber(e,!0)}get assetChangeHash(){if(this.assetChangeBuffer!==void 0)return Pe(this.assetChangeBuffer)}set assetChangeHash(e){this.assetChangeBuffer=be(e)}toJSON(){const e=Object.assign({chainName:this.chainName,assetType:this.assetType,magic:this.magic,bnid:this.bnid,beginEpochTime:this.beginEpochTime,genesisLocationName:this.genesisLocationName,genesisAmount:this.genesisAmount,maxSupply:this.maxSupply,minTransactionFeePerByte:this.minTransactionFeePerByte.toJSON(),maxTransactionSize:this.maxTransactionSize,maxTransactionBlobSize:this.maxTransactionBlobSize,maxBlockSize:this.maxBlockSize,maxBlockBlobSize:this.maxBlockBlobSize,maxTPSPerBlock:this.maxTPSPerBlock,consessusBeforeSyncBlockDiff:this.consessusBeforeSyncBlockDiff,maxGrabTimesOfGiftAsset:this.maxGrabTimesOfGiftAsset,issueAssetMinChainAsset:this.issueAssetMinChainAsset,maxMultipleOfAssetAndMainAsset:this.maxMultipleOfAssetAndMainAsset.toJSON(),issueEntityFactoryMinChainAsset:this.issueEntityFactoryMinChainAsset,maxMultipleOfEntityAndMainAsset:this.maxMultipleOfEntityAndMainAsset.toJSON(),registerChainMinChainAsset:this.registerChainMinChainAsset,maxApplyAndConfirmedBlockHeightDiff:this.maxApplyAndConfirmedBlockHeightDiff,blockPerRound:this.blockPerRound,whetherToAllowGeneratorContinusElections:this.whetherToAllowGeneratorContinusElections,forgeInterval:this.forgeInterval,basicRewards:this.basicRewards,ports:this.ports.toJSON()},super.toJSON());return this.assetChangeHash&&(e.assetChangeHash=this.assetChangeHash),e}getBytes(){return this.$type.encode(this).finish()}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.beginEpochTime!==void 0&&(t.beginEpochTime=e.beginEpochTime),e.maxTransactionBlobSize!==void 0&&(t.maxTransactionBlobSize=e.maxTransactionBlobSize),e.maxBlockBlobSize!==void 0&&(t.maxBlockBlobSize=e.maxBlockBlobSize),e.assetChangeHash!==void 0&&(t.assetChangeHash=e.assetChangeHash)),t}};u([I.d(pt.INC++,"string"),g("design:type",String)],at.prototype,"chainName",void 0);u([I.d(pt.INC++,"string"),g("design:type",String)],at.prototype,"assetType",void 0);u([I.d(pt.INC++,"string"),g("design:type",String)],at.prototype,"magic",void 0);u([I.d(pt.INC++,"string"),g("design:type",String)],at.prototype,"bnid",void 0);u([I.d(pt.INC++,"uint64"),g("design:type",Object)],at.prototype,"beginEpochTimeLong",void 0);u([I.d(pt.INC++,"string"),g("design:type",String)],at.prototype,"genesisLocationName",void 0);u([I.d(pt.INC++,"string"),g("design:type",String)],at.prototype,"genesisAmount",void 0);u([I.d(pt.INC++,"string"),g("design:type",String)],at.prototype,"maxSupply",void 0);u([I.d(pt.INC++,Is),g("design:type",Is)],at.prototype,"minTransactionFeePerByte",void 0);u([I.d(pt.INC++,"uint32"),g("design:type",Number)],at.prototype,"maxTransactionSize",void 0);u([I.d(pt.INC++,"uint64","required"),g("design:type",Object)],at.prototype,"maxTransactionBlobSizeLong",void 0);u([I.d(pt.INC++,"uint32"),g("design:type",Number)],at.prototype,"maxBlockSize",void 0);u([I.d(pt.INC++,"uint64","required"),g("design:type",Object)],at.prototype,"maxBlockBlobSizeLong",void 0);u([I.d(pt.INC++,"uint32"),g("design:type",Number)],at.prototype,"maxTPSPerBlock",void 0);u([I.d(pt.INC++,"uint32"),g("design:type",Number)],at.prototype,"consessusBeforeSyncBlockDiff",void 0);u([I.d(pt.INC++,"uint32"),g("design:type",Number)],at.prototype,"maxGrabTimesOfGiftAsset",void 0);u([I.d(pt.INC++,"string"),g("design:type",String)],at.prototype,"issueAssetMinChainAsset",void 0);u([I.d(pt.INC++,Lr),g("design:type",Lr)],at.prototype,"maxMultipleOfAssetAndMainAsset",void 0);u([I.d(pt.INC++,"string","required"),g("design:type",String)],at.prototype,"issueEntityFactoryMinChainAsset",void 0);u([I.d(pt.INC++,Lr),g("design:type",Lr)],at.prototype,"maxMultipleOfEntityAndMainAsset",void 0);u([I.d(pt.INC++,"string"),g("design:type",String)],at.prototype,"registerChainMinChainAsset",void 0);u([I.d(pt.INC++,"uint32"),g("design:type",Number)],at.prototype,"maxApplyAndConfirmedBlockHeightDiff",void 0);u([I.d(pt.INC++,"uint32"),g("design:type",Number)],at.prototype,"blockPerRound",void 0);u([I.d(pt.INC++,"bool"),g("design:type",Boolean)],at.prototype,"whetherToAllowGeneratorContinusElections",void 0);u([I.d(pt.INC++,"uint32","required"),g("design:type",Number)],at.prototype,"forgeInterval",void 0);u([I.d(pt.INC++,"string"),g("design:type",String)],at.prototype,"basicRewards",void 0);u([I.d(pt.INC++,Ih,"required"),g("design:type",Ih)],at.prototype,"ports",void 0);u([I.d(pt.INC++,"bytes","optional"),g("design:type",Uint8Array)],at.prototype,"assetChangeBuffer",void 0);u([ai,g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",void 0)],at.prototype,"getBytes",null);at=pt=u([j.d("GenesisAssetModel")],at);let Th=class extends oe{toJSON(){return{genesisAsset:this.genesisAsset.toJSON()}}};u([I.d(1,at),g("design:type",at)],Th.prototype,"genesisAsset",void 0);Th=u([j.d("GenesisBlockAssetModel")],Th);var eg;let Co=eg=class extends Ka{get assetChangeHash(){if(this.assetChangeBuffer!==void 0)return Pe(this.assetChangeBuffer)}set assetChangeHash(e){this.assetChangeBuffer=be(e)}get chainOnChainHash(){return Pe(this.chainOnChainBuffer)}set chainOnChainHash(e){this.chainOnChainBuffer=be(e)}toJSON(){const e=Object.assign({chainOnChainHash:this.chainOnChainHash},super.toJSON());return this.assetChangeHash&&(e.assetChangeHash=this.assetChangeHash),e}getBytes(){return this.$type.encode(this).finish()}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.assetChangeHash&&(t.assetChangeHash=e.assetChangeHash),e.chainOnChainHash&&(t.chainOnChainHash=e.chainOnChainHash)),t}};u([I.d(eg.INC++,"bytes","optional"),g("design:type",Uint8Array)],Co.prototype,"assetChangeBuffer",void 0);u([I.d(eg.INC++,"bytes"),g("design:type",Uint8Array)],Co.prototype,"chainOnChainBuffer",void 0);u([ai,g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",void 0)],Co.prototype,"getBytes",null);Co=eg=u([j.d("RoundLastAssetModel")],Co);let bh=class extends oe{toJSON(){return{roundLastAsset:this.roundLastAsset.toJSON()}}};u([I.d(1,Co),g("design:type",Co)],bh.prototype,"roundLastAsset",void 0);bh=u([j.d("RoundLastBlockAssetModel")],bh);let ja=class extends Mt{};u([I.d(21,Eh),g("design:type",Eh)],ja.prototype,"asset",void 0);ja=u([j.d("CommonBlock")],ja);let xo=class extends Mt{};u([I.d(21,Th),g("design:type",Th)],xo.prototype,"asset",void 0);xo=u([j.d("GenesisBlock")],xo);let za=class extends Mt{};u([I.d(22,bh),g("design:type",bh)],za.prototype,"asset",void 0);za=u([j.d("RoundLastBlock")],za);var tg;const{ArgumentFormatException:A_}=le("MODEL","blockModel");var er;(function(e){e[e.GENESIS=0]="GENESIS",e[e.COMMON=1]="COMMON",e[e.ROUNDEND=2]="ROUNDEND"})(er||(er={}));const Pl=(()=>{const e=new Map,t=new Map;return[[er.GENESIS,xo],[er.COMMON,ja],[er.ROUNDEND,za]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{KM:e,MK:t}})(),Rg=new WeakMap;let Di=tg=class extends oe{get block(){let e=Rg.get(this._block_bytes);if(!e){const t=Pl.KM.get(this._block_type);if(!t)throw new A_(c.INVALID_BLOCK_TYPE,{type:this._block_type});e=t.decode(this._block_bytes),Rg.set(this._block_bytes,e)}return e}set block(e){const t=e.constructor,r=Pl.MK.get(t);if(r===void 0)throw new A_(c.INVALID_BLOCK_CONSTRUCTOR,{name:t.name});this._block_type=r,this._block_bytes=new Uint8Array(t.encode(e).finish()),Rg.set(this._block_bytes,e)}static fromObject(e){const t=super.fromObject(e);if(e!==t){const r=e.block;if(r)if(r instanceof oe)t.block=r;else{let n=er.COMMON;r.height===0?n=er.GENESIS:r.remark&&"hash"in r.remark&&(n=er.ROUNDEND);const s=Pl.KM.get(n);s&&(t.block=s.fromObject(r))}}return t}toJSON(){return{block:this.block}}};Di.INC=1;u([I.d(tg.INC++,er),g("design:type",Number)],Di.prototype,"_block_type",void 0);u([I.d(tg.INC++,"bytes"),g("design:type",Uint8Array)],Di.prototype,"_block_bytes",void 0);Di=tg=u([j.d("SomeBlockModel")],Di);let wh=class extends oe{toJSON(){return{genesisBlock:this.genesisBlock}}};u([I.d(1,"string"),g("design:type",String)],wh.prototype,"genesisBlock",void 0);wh=u([j.d("RegisterChainModel")],wh);let Sh=class extends oe{toJSON(){return{registerChain:this.registerChain.toJSON()}}};u([I.d(1,wh),g("design:type",wh)],Sh.prototype,"registerChain",void 0);Sh=u([j.d("RegisterChainAssetModel")],Sh);var qy;let Ja=qy=class extends rt{};u([I.d(qy.INC++,Sh),g("design:type",Sh)],Ja.prototype,"asset",void 0);Ja=qy=u([j.d("RegisterChainTransaction")],Ja);var Zy;const{ArgumentFormatException:E_,error:vN,IllegalStateException:BN}=le("MODEL","transactionModel"),I_=new WeakMap,vg=new WeakMap;let Ya=Zy=class extends oe{get transactions(){const{transactionBufferList:e}=this;let t=I_.get(e);return t||(t=this.transactionBufferList.map(r=>{const n=rt.decode(r),s=Me.trsTypeToV(n.type),i=Me.VM.get(s);if(!i)throw new E_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});const o=i.decode(r);return vg.set(o,r),o})),t}set transactions(e){const t=e.map(r=>{let n=vg.get(r);return n||(n=r.getBytes(),vg.set(r,n)),n});I_.set(t,e),this.transactionBufferList=t}toJSON(){return{transactions:this.transactions.map(e=>e.toJSON())}}static fromObject(e){const t=super.fromObject(e);if(t!==e&&e.transactions){const r=e.transactions,n=[];for(const s of r)if(s instanceof oe)n.push(s);else{const i=s.type;if(i){const o=Me.trsTypeToV(i),a=Me.VM.get(o);if(!a)throw new E_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:o});n.push(a.fromObject(s))}}t.transactions=n}return t}};Ya.INC=1;u([I.d(Zy.INC++,"bytes","repeated"),g("design:type",Array)],Ya.prototype,"transactionBufferList",void 0);Ya=Zy=u([j.d("MultipleModel")],Ya);let Nh=class extends oe{toJSON(){return{multiple:this.multiple.toJSON()}}};u([I.d(1,Ya),g("design:type",Ya)],Nh.prototype,"multiple",void 0);Nh=u([j.d("MultipleAssetModel")],Nh);var em;let Qa=em=class extends rt{as(e,t){const r=Me.MV.get(e),n=Me.trsTypeToV(this.type);if(r===n)if(t){if(this.signature===t)return this}else return this;const{transactions:s}=this.asset.multiple;for(const i of s){const o=i.as(e,t);if(o)return o}}getBlobSize(e=!1){let t=0;const r=this.blobMap.values();for(const n of r)t+=n[3];if(e===!1){const{transactions:n}=this.asset.multiple;for(const s of n)t+=s.getBlobSize(e)}return t}};u([I.d(em.INC++,Nh),g("design:type",Nh)],Qa.prototype,"asset",void 0);Qa=em=u([j.d("MultipleTransaction")],Qa);var tm;const{ArgumentFormatException:T_,error:PN,IllegalStateException:kN}=le("MODEL","transactionModel"),Bg=new WeakMap,Pg=new WeakMap;let Xa=tm=class extends oe{get transaction(){const{transactionBuffer:e}=this;let t=Bg.get(e);if(!t){const r=rt.decode(e),n=Me.trsTypeToV(r.type),s=Me.VM.get(n);if(!s)throw new T_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:n});t=s.decode(e),Pg.set(t,e),Bg.set(e,t)}return t}set transaction(e){let t=Pg.get(e);t||(t=e.getBytes(),Pg.set(e,t),Bg.set(t,e)),this.transactionBuffer=t}toJSON(){return{transaction:this.transaction.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e&&e.transaction){const r=e.transaction;if(r instanceof oe)t.transaction=r;else{const n=r.type;if(n){const s=Me.trsTypeToV(n),i=Me.VM.get(s);if(!i)throw new T_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.transaction=i.fromObject(r)}}}return t}};Xa.INC=1;u([I.d(tm.INC++,"bytes"),g("design:type",Uint8Array)],Xa.prototype,"transactionBuffer",void 0);Xa=tm=u([j.d("PromiseModel")],Xa);let Oh=class extends oe{toJSON(){return{promise:this.promise.toJSON()}}};u([I.d(1,Xa),g("design:type",Xa)],Oh.prototype,"promise",void 0);Oh=u([j.d("PromiseAssetModel")],Oh);var rm;let Ro=rm=class extends We{};u([I.d(rm.INC++,Oh),g("design:type",Oh)],Ro.prototype,"asset",void 0);Ro=rm=u([j.d("PromiseTransaction")],Ro);var rg;const{ArgumentFormatException:b_}=le("MODEL","transactionModel");let vo=rg=class extends oe{get promiseId(){return Pe(this.promiseIdBuffer)}set promiseId(e){this.promiseIdBuffer=be(e)}get transaction(){const{transactionBuffer:e}=this,t=rt.decode(e),r=Me.trsTypeToV(t.type),n=Me.VM.get(r);if(!n)throw new b_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:r});return n.decode(e)}set transaction(e){this.transactionBuffer=e.getBytes()}toJSON(){return{promiseId:this.promiseId,transaction:this.transaction.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e&&(e.promiseId&&(t.promiseId=e.promiseId),e.transaction)){const r=e.transaction;if(r instanceof oe)t.transaction=r;else{const n=r.type;if(n){const s=Me.trsTypeToV(n),i=Me.VM.get(s);if(!i)throw new b_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.transaction=i.fromObject(r)}}}return t}};vo.INC=1;u([I.d(rg.INC++,"bytes"),g("design:type",Uint8Array)],vo.prototype,"promiseIdBuffer",void 0);u([I.d(rg.INC++,"bytes"),g("design:type",Uint8Array)],vo.prototype,"transactionBuffer",void 0);vo=rg=u([j.d("PromiseResolveModel")],vo);let Ch=class extends oe{toJSON(){return{resolve:this.resolve.toJSON()}}};u([I.d(1,vo),g("design:type",vo)],Ch.prototype,"resolve",void 0);Ch=u([j.d("PromiseResolveAssetModel")],Ch);var nm;let Wa=nm=class extends rt{as(e,t){const r=Me.MV.get(e);let n=Me.trsTypeToV(this.type);if(r===n)if(t){if(this.signature===t)return this}else return this;const{transaction:s}=this.asset.resolve;return s.as(e,t)}getBlobSize(e=!1){let t=0;const r=this.blobMap.values();for(const n of r)t+=n[3];return e===!1&&(t+=this.asset.resolve.transaction.getBlobSize(e)),t}};u([I.d(nm.INC++,Ch),g("design:type",Ch)],Wa.prototype,"asset",void 0);Wa=nm=u([j.d("PromiseResolveTransaction")],Wa);var zt;(function(e){e.TEXT="text",e.ADDRESS="address",e.PUBLICKEY="publicKey",e.SIGNATURE="signature",e.NUMBER="number",e.CALC="calc"})(zt||(zt={}));var qa;(function(e){e.STRING="string",e.LITERAL="literal"})(qa||(qa={}));var w_;(function(e){e.FLOAT_32="float32",e.FLOAT_64="float64",e.FLOAT_128="float128",e.FLOAT_big="bigfloat"})(w_||(w_={}));var ra;let is=ra=class extends oe{toJSON(){const e={type:this.type,name:this.name,keyPath:this.keyPath};return this.pattern&&(e.pattern=this.pattern),this.repeat!==void 0&&(e.repeat=this.repeat),e}};is.INC=1;u([I.d(ra.INC++,"string"),g("design:type",String)],is.prototype,"type",void 0);u([I.d(ra.INC++,"string"),g("design:type",String)],is.prototype,"name",void 0);u([I.d(ra.INC++,"string"),g("design:type",String)],is.prototype,"keyPath",void 0);u([I.d(ra.INC++,"string","optional"),g("design:type",String)],is.prototype,"pattern",void 0);u([I.d(ra.INC++,"bool","optional"),g("design:type",Boolean)],is.prototype,"repeat",void 0);is=ra=u([j.d("BaseInputModel")],is);var na;let Zs=na=class extends is{toJSON(){const e={...super.toJSON(),format:this.format};return this.base&&(e.base=this.base.toJSON()),this.min&&(e.min=this.min.toJSON()),this.max&&(e.max=this.max.toJSON()),this.step&&(e.step=this.step.toJSON()),e}};u([I.d(na.INC++,Lr,"optional"),g("design:type",Lr)],Zs.prototype,"base",void 0);u([I.d(na.INC++,Lr,"optional"),g("design:type",Lr)],Zs.prototype,"min",void 0);u([I.d(na.INC++,Lr,"optional"),g("design:type",Lr)],Zs.prototype,"max",void 0);u([I.d(na.INC++,Lr,"optional"),g("design:type",Lr)],Zs.prototype,"step",void 0);u([I.d(na.INC++,"string","required",qa.LITERAL),g("design:type",String)],Zs.prototype,"format",void 0);Zs=na=u([j.d("NumberInputModel")],Zs);class Ft{constructor(t,r){if(Object.defineProperty(this,"numerator",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"denominator",{enumerable:!0,configurable:!0,writable:!0,value:r}),r<0n)throw new RangeError("invalid denominator: should not be negative number.")}static from(t,r=1){t=t.toString().trim();let n=BigInt(r);const s=t.lastIndexOf(".");s!==-1&&(n=10n**BigInt(t.length-s-1),t=t.slice(0,s)+t.slice(s+1));let i=BigInt(t);return n<0n&&(n=-n,i=-i),new Ft(i,n)}isFinite(){return this.denominator!==0n}isInfinity(){return this.denominator===0n&&this.numerator!==0n}isNaN(){return this.denominator===0n&&this.numerator===0n}isNeg(){return this.numerator<0n}toString(){return this.toPrecision(8)}toPrecision(t,r=np.ROUND){if(this.isNaN())return"NaN";if(this.isInfinity())return this.isNeg()?"-Infinity":"Infinity";let{denominator:n,numerator:s}=this;if(n===1n)return s.toString();const i=Math.floor(t),o=i+1;if(o<1)throw new Error("invalid digits");const a=10n**BigInt(o);let p=s*a/n,l="";p<0&&(l="-",p=-p);const h=p/10n;let y;switch(r){case np.FLOOR:y=h.toString();break;case np.CEIL:{p%10n!==0n?y=(h+1n).toString():y=h.toString();break}default:p%10n>=5n?y=(h+1n).toString():y=h.toString()}y=y.padStart(o,"0");let A=y.slice(0,-i)+"."+y.slice(-i);return A.endsWith("0")&&(A=A.replace(/[\.0]+$/,"")),l+A}}var np;(function(e){e[e.FLOOR=0]="FLOOR",e[e.ROUND=1]="ROUND",e[e.CEIL=2]="CEIL"})(np||(np={}));const sm=(e,t,r)=>{if(e.denominator===t.denominator)return new Ft(r(e.numerator,t.numerator,e.denominator),e.denominator);const n=e.numerator*t.denominator,s=t.numerator*e.denominator,i=e.denominator*t.denominator;return new Ft(r(n,s,i),e.denominator*t.denominator)},ib=(e,t)=>sm(e,t,(r,n)=>r+n),ob=(e,t)=>sm(e,t,(r,n)=>r-n),sI=(e,t)=>sm(e,t,(r,n)=>r*n),ab=(e,t)=>sI(e,new Ft(t.denominator,t.numerator));new Ft(0n,0n);new Ft(1n,1n);new Ft(0n,1n);Ft.from(Math.PI);Ft.from(Math.E);Ft.from(Math.LN2);Ft.from(Math.LN10);Ft.from(Math.LOG2E);Ft.from(Math.LOG10E);Ft.from(Math.SQRT1_2);class Qr{constructor(t,r={}){Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isBinary",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isPrefix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"precedence",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateContext",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=t,this.isBinary=!!r.isBinary,this.isPrefix=!!r.isPrefix,this.precedence=r.precedence??-1}}const Bt={start:new Qr("start"),end:new Qr("end"),parenL:new Qr("("),parenR:new Qr(")"),numeric:new Qr("numeric"),identifier:new Qr("identifier"),plus:new Qr("+",{isBinary:!0,precedence:13}),minus:new Qr("-",{isBinary:!0,precedence:13}),times:new Qr("*",{isBinary:!0,precedence:14}),div:new Qr("/",{isBinary:!0,precedence:14}),prefixPlus:new Qr("+",{isPrefix:!0,precedence:16}),prefixMinus:new Qr("-",{isPrefix:!0,precedence:16})};Bt.parenL.updateContext=function(){this.allowPrefix=!0};Bt.parenR.updateContext=function(){this.allowPrefix=!1};Bt.numeric.updateContext=function(){this.allowPrefix=!1};Bt.identifier.updateContext=function(){this.allowPrefix=!1};class im{constructor(t){Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type="",this.start=t,this.end=t}}function om(e){return e>=48&&e<=57}function iI(e){return e===46?!0:om(e)}function oI(e){return e>=65&&e<=90||e>=97&&e<=122}function cb(e){return!!(oI(e)||om(e)||e===95)}function pb(e){let t=e;const r=[];for(let n=0;n<t.length;n++)t.charCodeAt(n)!==95&&r.push(t[n]);return r.length!==t.length&&(t=r.join("")),t}const S_=["+","-","*","/","(",")"],ei=[];function hb(e){ei.includes(e)||ei.unshift(e)}function aI(e,t){if(typeof e!="string"||!/^\S+$/.test(e))throw new Error("The custom operator should be a non-empty string");if(S_.includes(e))throw new Error(`The custom operator cannot use reserved character, including: ${S_.join(", ")}`);if(iI(e.charCodeAt(0)))throw new Error("The custom operator cannot start with a possible number, including: `.`, 0-9");if(e.charCodeAt(0)===63)throw new Error("The custom operator cannot start with `?`");if(t!=null&&(typeof t!="number"||t<0))throw new Error("The precedence should be a number greater than 0")}class cI{constructor(t,r,n,s=!1){Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"codes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"calc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=t,this.codes=t.split("").map((i,o)=>t.charCodeAt(o)),this.type=new Qr(t,{isBinary:!s,isPrefix:s,precedence:r}),this.calc=n}}function lb(e,t,r){if(aI(e,t),typeof r!="function")throw new Error("Expected to receive a calculation method, like: `(left, right) => String(left - right)`");return new cI(e,t,r,!1)}function ub(e,t,r){if(aI(e,t),typeof r!="function")throw new Error("Expected to receive a calculation method, like: `(value) => String(Math.abs(value))`");return new cI(e,t,r,!0)}let pI={"+":(e,t)=>String(Number(e)+Number(t)),"-":(e,t)=>String(Number(e)-Number(t)),"*":(e,t)=>String(Number(e)*Number(t)),"/":(e,t)=>String(Number(e)/Number(t))};function gb(e){const t=["+","-","*","/"];e=e||{},t.forEach(r=>{if(typeof e[r]!="function")throw new Error(`Missing method for calculation operator \`${r}\``)}),pI=e}function fb(e,t,r){switch(r){case"+":case"-":case"*":case"/":return pI[r](e,t);default:for(let n=0;n<ei.length;n++){const s=ei[n];if(s.type.isBinary&&s.value===r)return s.calc(e,t)}}throw new Error(`Unexpected binary operator: ${r}`)}function db(e,t){switch(t){case"+":return e;case"-":return String(-e);default:for(let r=0;r<ei.length;r++){const n=ei[r];if(n.type.isPrefix&&n.value===t)return n.calc(e)}}throw new Error(`Unexpected unary operator: ${t}`)}function Wc(e,t={}){if(e instanceof im){let r;switch(e.type){case"Expression":return Wc(e.expression,t);case"BinaryExpression":return fb(Wc(e.left,t),Wc(e.right,t),e.operator);case"UnaryExpression":return db(Wc(e.argument,t),e.operator);case"NumericLiteral":return e.value;case"Identifier":if(r=t[e.name],r===void 0)throw new Error(`The scope name \`${e.name}\` is not initialized`);return String(r);default:throw new Error(`Unexpected type: ${e.type}`)}}return e}class Ln{static evaluate(t,r){return new Ln(t).compile()(r)}constructor(t){Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastTokenStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastTokenEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowPrefix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.input=String(t),this.tokenType=Bt.start,this.value="",this.pos=0,this.start=0,this.end=0,this.lastTokenStart=0,this.lastTokenEnd=0,this.allowPrefix=!0}compile(){let t=this.node;return t===void 0&&(t=this.parse()),r=>t?Wc(t,r??{}):"0"}parse(){this.next();const t=this.startNode(this.start);return this.tokenType===Bt.end?this.node=null:(t.expression=this.parseExprAtom(this.start,-1),this.tokenType!==Bt.end&&this.unexpected(this.value),this.node=this.finishNode(t,"Expression"))}parseExprAtom(t,r){if(this.tokenType===Bt.parenL){this.next();const n=this.parseExprAtom(this.start,-1);return this.expect(Bt.parenR),this.parseMaybeBinary(n,t,r)}else{const n=this.parseMaybeUnary(r);return this.parseMaybeBinary(n,t,r)}}parseMaybeBinary(t,r,n){const s=this.tokenType.precedence;if(this.tokenType.isBinary&&s>n){const i=this.startNode(r),o=this.value;this.next();const a=this.start,p=this.parseExprAtom(a,s),l=this.parseMaybeBinary(p,a,s);return i.left=t,i.operator=o,i.right=l,this.finishNode(i,"BinaryExpression"),this.parseMaybeBinary(i,r,n)}return t}parseMaybeUnary(t){const r=this.tokenType.precedence,n=this.startNode(),s=this.start,i=this.value;if(this.tokenType.isPrefix&&r>=t)return n.operator=i,n.prefix=!0,this.next(),n.argument=this.parseExprAtom(this.start,r),this.finishNode(n,"UnaryExpression");if(this.tokenType===Bt.numeric){const o=pb(i);return n.rawValue=i,n.value=o,this.next(),this.finishNode(n,"NumericLiteral")}return this.tokenType===Bt.identifier?(n.name=i,this.next(),this.finishNode(n,"Identifier")):this.unexpected(i,s)}next(){if(this.lastTokenStart=this.start,this.lastTokenEnd=this.end,this.skipSpace(),this.start=this.pos,this.pos>=this.input.length){if(this.tokenType===Bt.end)return;this.finishToken(Bt.end)}else this.readToken()}readToken(){const t=this.codeAt(this.pos);return iI(t)?this.readNumeric():this.readTokenFromCode()}readNumeric(){const t=this.pos;let r=-1,n=!0,s=!1,i=!1,o=-1;for(;this.isValidPosition();){const p=this.codeAt(this.pos);if(om(p))r===-1&&(r=0),this.pos++,i=!1,s=!0;else if(i){o=this.pos,i=!1;break}else if(p===69||p===101){if(r!==0){o=this.pos;break}r++,this.pos++,this.isValidPosition()&&(this.codeAt(this.pos)===43||this.codeAt(this.pos)===45)&&this.pos++,n=!1,i=!0}else if(p===46){if(!n){o=this.pos;break}n=!1,this.pos++,this.pos-t===1&&(i=!0)}else if(p===95){if(!s){o=this.pos;break}s=!1,i=!0,this.pos++}else break}i&&(o=this.pos-1),o>=0&&this.unexpected(this.input[o],o);const a=this.input.slice(t,this.pos);this.finishToken(Bt.numeric,a)}readTokenFromCode(){const t=this.codeAt(this.pos);let r,n,s;for(n=0;n<ei.length;n++){const i=ei[n];for(s=0;s<i.codes.length&&i.codes[s]===this.codeAt(this.pos+s);s++);if(s===i.codes.length){r=i;break}}if(r)return this.pos+=r.codes.length,this.finishToken(r.type,r.value);switch(t){case 40:return this.pos++,this.finishToken(Bt.parenL,"(");case 41:return this.pos++,this.finishToken(Bt.parenR,")");case 42:return this.pos++,this.finishToken(Bt.times,"*");case 43:return this.pos++,this.allowPrefix?this.finishToken(Bt.prefixPlus,"+"):this.finishToken(Bt.plus,"+");case 45:return this.pos++,this.allowPrefix?this.finishToken(Bt.prefixMinus,"-"):this.finishToken(Bt.minus,"-");case 47:return this.pos++,this.finishToken(Bt.div,"/");default:if(oI(t))return this.readIdentifier()}this.unexpected(this.input[this.pos])}readIdentifier(){const t=this.pos;for(;this.isValidPosition();){const n=this.codeAt(this.pos);if(cb(n))this.pos++;else break}const r=this.input.slice(t,this.pos);this.finishToken(Bt.identifier,r)}finishToken(t,r=""){const n=this.tokenType;this.end=this.pos,this.tokenType=t,this.value=r,this.updateContext(n)}updateContext(t){const r=this.tokenType;r.isBinary||r.isPrefix?this.allowPrefix=!0:r.updateContext&&r.updateContext.call(this,t)}codeAt(t){return this.input.charCodeAt(t)}isValidPosition(){return this.pos<this.input.length}startNode(t){return new im(t??this.start)}finishNode(t,r){return t.type=r,t.end=this.lastTokenEnd,t}skipSpace(){for(;this.isValidPosition();){const t=this.codeAt(this.pos);if(t===32||t===160)this.pos++;else if(t===13||t===10||t===8232||t===8233)t===13&&this.codeAt(this.pos+1)===10&&this.pos++,this.pos++;else if(t>8&&t<14)this.pos++;else break}}expect(t){this.eat(t)||this.unexpected(this.value)}eat(t){return this.tokenType===t?(this.next(),!0):!1}unexpected(t="",r){this.raise(r??this.start,`Unexpected token ${t}`)}raise(t,r){throw t>this.input.length-1?r="Unexpected end of input":r+=` at position ${t}`,new SyntaxError(r)}}Object.defineProperty(Ln,"Node",{enumerable:!0,configurable:!0,writable:!0,value:im});Object.defineProperty(Ln,"TokenType",{enumerable:!0,configurable:!0,writable:!0,value:Qr});Object.defineProperty(Ln,"tokenTypes",{enumerable:!0,configurable:!0,writable:!0,value:Bt});Object.defineProperty(Ln,"installedOperators",{enumerable:!0,configurable:!0,writable:!0,value:ei});const hI=Ln.evaluate;Ln.createBinaryOperator=lb;Ln.createUnaryOperator=ub;Ln.useOperator=hb;Ln.useAdapter=gb;const yb={"+":(e,t)=>ib(Ft.from(e),Ft.from(t)).toString(),"-":(e,t)=>ob(Ft.from(e),Ft.from(t)).toString(),"*":(e,t)=>sI(Ft.from(e),Ft.from(t)).toString(),"/":(e,t)=>ab(Ft.from(e),Ft.from(t)).toString()};Ln.useAdapter(yb);var ng;let xh=ng=class extends Zs{toJSON(){return{...super.toJSON(),calc:this.calc,precision:this.precision}}evaluate(e){return hI(this.calc,e)}};u([I.d(ng.INC++,"string"),g("design:type",String)],xh.prototype,"calc",void 0);u([I.d(ng.INC++,"string"),g("design:type",String)],xh.prototype,"precision",void 0);xh=ng=u([j.d("CalcInputModel")],xh);let Za=class extends is{};Za=u([j.d("TextInputModel")],Za);let yf=class extends Za{};yf=u([j.d("AddressInputModel")],yf);let mf=class extends Za{};mf=u([j.d("SignatureInputModel")],mf);let _f=class extends Za{};_f=u([j.d("PublicKeyInputModel")],_f);const N_=(()=>{const e=new Map,t=new Map;return[[zt.NUMBER,Zs],[zt.CALC,xh],[zt.TEXT,Za],[zt.ADDRESS,yf],[zt.PUBLICKEY,_f],[zt.SIGNATURE,mf]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{VM:e,MV:t}})();var sg;const{ArgumentFormatException:El}=le("MODEL","transactionModel");let Bo=sg=class extends oe{get inputs(){return this.inputBufferList.map(e=>{const t=is.decode(e),r=N_.VM.get(t.type);if(!r)throw new El(c.INVALID_MACRO_INPUT_TYPE,{type_base:t.type});return r.decode(e)})}set inputs(e){const t=e.map(r=>r.getBytes());this.inputBufferList=t}get template(){const{templateBuffer:e}=this,t=rt.decode(e),r=Me.trsTypeToV(t.type),n=Me.VM.get(r);if(!n)throw new El(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:r});return n.decode(e)}set template(e){this.templateBuffer=e.getBytes()}toJSON(){return{inputs:this.inputs.map(e=>e.toJSON()),template:this.template.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e){if(e.inputs){const r=e.inputs,n=[];for(const s of r)if(s instanceof oe)n.push(s);else{const i=s.type,o=N_.VM.get(i);if(!o)throw new El(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:i});n.push(o.fromObject(s))}t.inputs=n}if(e.template){const r=e.template;if(r instanceof oe)t.template=r;else{const n=r.type;if(n){const s=Me.trsTypeToV(n),i=Me.VM.get(s);if(!i)throw new El(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.template=i.fromObject(r)}}}}return t}};Bo.INC=1;u([I.d(sg.INC++,"bytes","repeated"),g("design:type",Array)],Bo.prototype,"inputBufferList",void 0);u([I.d(sg.INC++,"bytes"),g("design:type",Uint8Array)],Bo.prototype,"templateBuffer",void 0);Bo=sg=u([j.d("MacroModel")],Bo);let Rh=class extends oe{toJSON(){return{macro:this.macro.toJSON()}}};u([I.d(1,Bo),g("design:type",Bo)],Rh.prototype,"macro",void 0);Rh=u([j.d("MacroAssetModel")],Rh);var am;let Po=am=class extends We{};u([I.d(am.INC++,Rh),g("design:type",Rh)],Po.prototype,"asset",void 0);Po=am=u([j.d("MacroTransaction")],Po);const mb=e=>typeof e=="object"&&e!==null&&typeof e.then=="function";class nr{constructor(){this.is_resolved=!1,this.is_rejected=!1,this.is_finished=!1,this.promise=new Promise((t,r)=>{this.resolve=n=>{try{mb(n)?n.then(this.resolve,this.reject):(this.is_resolved=!0,this.is_finished=!0,t(this.value=n),this._runThen(),this._innerFinallyArg=Object.freeze({status:"resolved",result:this.value}),this._runFinally())}catch(s){this.reject(s)}},this.reject=n=>{this.is_rejected=!0,this.is_finished=!0,r(this.reason=n),this._runCatch(),this._innerFinallyArg=Object.freeze({status:"rejected",reason:this.reason}),this._runFinally()}})}onSuccess(t){this.is_resolved?this.__callInnerThen(t):(this._innerThen||(this._innerThen=[])).push(t)}onError(t){this.is_rejected?this.__callInnerCatch(t):(this._innerCatch||(this._innerCatch=[])).push(t)}onFinished(t){this.is_finished?this.__callInnerFinally(t):(this._innerFinally||(this._innerFinally=[])).push(t)}_runFinally(){if(this._innerFinally){for(const t of this._innerFinally)this.__callInnerFinally(t);this._innerFinally=void 0}}__callInnerFinally(t){queueMicrotask(async()=>{try{await t(this._innerFinallyArg)}catch(r){console.error("Unhandled promise rejection when running onFinished",t,r)}})}_runThen(){if(this._innerThen){for(const t of this._innerThen)this.__callInnerThen(t);this._innerThen=void 0}}_runCatch(){if(this._innerCatch){for(const t of this._innerCatch)this.__callInnerCatch(t);this._innerCatch=void 0}}__callInnerThen(t){queueMicrotask(async()=>{try{await t(this.value)}catch(r){console.error("Unhandled promise rejection when running onSuccess",t,r)}})}__callInnerCatch(t){queueMicrotask(async()=>{try{await t(this.value)}catch(r){console.error("Unhandled promise rejection when running onError",t,r)}})}}var _b=(e,t)=>["%c"+e,t];const Ci=Symbol("eventemitter.description"),jt={head:_b,MIDNIGHTBLUE_BOLD_UNDERLINE:"color:midnightblue;text-decoration: underline;font-weight: bold;",DARKVIOLET_BOLD_UNDERLINE:"color:darkviolet;text-decoration: underline;font-weight: bold;"};function lI(e,t){const r=Object.getOwnPropertyDescriptor(e,"name");r&&r.configurable&&Object.defineProperty(e,"name",{value:t,configurable:!0})}const uI=Vs.getGlobalFlag("BFCHAIN_ENV","development");uI.split(",").map(e=>e.trim());const Af=new Map;for(const e of uI.split(",")){const[t,r]=e.split("=").map(i=>i.trim());let n=t,s=!1;n.startsWith("- ")&&(s=!0,n=n.substr(2)),s?Af.delete(n):Af.set(n,r)}function vh(e){return Af.has(e)}const cn=vh("eventemitter")&&vh("browser");class Rn{constructor(){this._e=Object.create(null)}on(t,r,n={}){this._on(t,r,n.taskname,n.once)}_on(t,r,n,s){const i=this._e;let o=i[t];o?o.has(r)&&console.warn(`hanlder '${r.name}' already exits in event set ${t}.`):o=i[t]=new Map,n===void 0&&(n=il(this.constructor)),o.set(r,{taskname:n,once:s})}once(t,r,n={}){this._on(t,r,n.taskname,!0)}off(t,r){return this._off(t,r)}_off(t,r){const n=this._e[t];let s=!0;return n?r?n.delete(r)&&n.size===0&&delete this._e[t]:(n.clear(),delete this._e[t]):s=!1,s}get[Ci](){return""}emit(t,...r){this._emit(t,r)}_emit(t,r){const n=this._e[t];if(cn&&(console.group(...jt.head("%s EMIT [%s]",jt.MIDNIGHTBLUE_BOLD_UNDERLINE),this[Ci]||this,t),console.log(...jt.head("%s ARGS:",jt.MIDNIGHTBLUE_BOLD_UNDERLINE),...r)),n)for(const[s,i]of n.entries())try{if(cn){const{taskname:a=s.name}=i;console.log(...jt.head("%s RUN [%s]",jt.MIDNIGHTBLUE_BOLD_UNDERLINE),this[Ci]||this,a)}const o=s(...r);o instanceof Promise&&o.catch(a=>this._emitErrorHanlder(a,t,r))}catch(o){this._emitErrorHanlder(o,t,r)}finally{i.once&&n.delete(s)}cn&&console.groupEnd()}_emitErrorHanlder(t,r,n){if(!this._hasEmitErrorHandlerSet)throw cn&&console.error(`EventEmitter '${this.constructor.name}' emit '${r.toString()}' fail:`,t),t;for(const s of this._emitErrorHandlerSet)s(t,{eventname:r,args:n})}get _emitErrorHandlerSet(){return this._hasEmitErrorHandlerSet=!0,new Set}onError(t,r){typeof r=="string"&&lI(t,r),this._emitErrorHandlerSet.has(t)&&console.warn(`hanlder '${t.name}' already exits in custom error hanlder event set.`),this._emitErrorHandlerSet.add(t)}offError(t){return!!this._hasEmitErrorHandlerSet&&(t?this._emitErrorHandlerSet.delete(t):(this._emitErrorHandlerSet.clear(),!0))}clear(t={}){this._e=Object.create(null);const{ignoreCustomErrorHanlder:r}=t;!r&&this._hasEmitErrorHandlerSet&&this._emitErrorHandlerSet.clear()}get removeAllListeners(){return this.clear}get addListener(){return this.on}get removeListener(){return this.off}}u([ge,g("design:type",Object),g("design:paramtypes",[])],Rn.prototype,"_emitErrorHandlerSet",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Rn.prototype,"removeAllListeners",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Rn.prototype,"addListener",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Rn.prototype,"removeListener",null);const O_=e=>!(!e||!e.constructor)&&typeof e.next=="function"&&typeof e.return=="function"&&typeof e.throw=="function"&&typeof e[Symbol.asyncIterator]=="function"&&e[Symbol.asyncIterator]()===e,C_=e=>!!e&&typeof e.next=="function"&&typeof e.return=="function"&&typeof e.throw=="function"&&typeof e[Symbol.iterator]=="function"&&e[Symbol.iterator]()===e;class Ni{constructor(){this._e=Object.create(null)}on(t,r,n={}){let s=this._e[t];s?s.has(r)&&console.warn(`[${n.taskname||t.toString()}]`):s=this._e[t]=new Map,n.taskname===void 0&&(n.taskname=il(this.on)),s.set(r,n)}once(t,r,n){return this.on(t,r,n?new Proxy(n,{get:(s,i,o)=>i==="once"||Reflect.get(s,i,o)}):{once:!0})}has(t,r){const n=this._e[t];return!!n&&(r?n.has(r):n.size>0)}off(t,r){const n=this._e[t];let s=!1;return n&&(s=n.delete(r))&&n.size===0&&delete this._e[t],s}get[Ci](){return""}emit(t,r){const n=this._e[t];if(n){cn&&n.size&&console.log(...jt.head("%s QUENE EMIT [%s]",jt.DARKVIOLET_BOLD_UNDERLINE),this[Ci]||this,t,r);const s=n.entries(),i=a=>{if(typeof a=="object"){if(O_(a))return(async()=>{try{const p=a[Symbol.asyncIterator]();for(;;){const l=await p.next();if(l.done)return l.value}}catch(p){this._emitErrorHanlder(p,t,r)}})();if(C_(a)){const p=a[Symbol.iterator]();try{for(;;){const l=p.next();if(l.done)return l.value}}catch(l){this._emitErrorHanlder(l,t,r)}}}return a},o=()=>{const a=s.next();if(!a.done){const[p,l]=a.value;try{cn&&console.log(...jt.head("RUN [%s]",jt.DARKVIOLET_BOLD_UNDERLINE),p.name);const h=p(r,o);return h instanceof Promise?h.then(i,y=>this._emitErrorHanlder(y,t,r)):i(h)}catch(h){this._emitErrorHanlder(h,t,r)}finally{l.once&&n.delete(p)}}};return o()}}async*emitToAsyncGenerator(t,r){const n=this._e[t];if(n){cn&&n.size&&console.log(...jt.head("%s QUENE EMIT [%s]",jt.DARKVIOLET_BOLD_UNDERLINE),this[Ci]||this,t,r);const s=n.entries(),i=async function*(){const o=s.next();if(!o.done){const[a,p]=o.value;try{cn&&console.log(...jt.head("RUN [%s]",jt.DARKVIOLET_BOLD_UNDERLINE),a.name),yield;const l=await a(r,i);if(typeof l=="object"){if(O_(l))return yield*l;if(C_(l))return yield*l}return l}catch(l){this._emitErrorHanlder(l,t,r)}finally{p.once&&n.delete(a)}}}.bind(this);return yield*i()}}clear(t={}){this._e=Object.create(null);const{ignoreCustomErrorHanlder:r}=t;!r&&this._hasEmitErrorHandlerSet&&this._emitErrorHandlerSet.clear()}get removeAllListeners(){return this.clear}get addListener(){return this.on}get removeListener(){return this.off}_emitErrorHanlder(t,r,n){if(!this._hasEmitErrorHandlerSet)throw cn&&console.error(`QueneEventEmitter '${this.constructor.name}' emit '${r.toString()}' fail:`,t),t;for(const s of this._emitErrorHandlerSet)s(t,{eventname:r,arg:n})}get _emitErrorHandlerSet(){return this._hasEmitErrorHandlerSet=!0,new Set}onError(t,r){typeof r=="string"&&lI(t,r),this._emitErrorHandlerSet.has(t)&&console.warn(`hanlder '${t.name}' already exits in custom error hanlder event set.`),this._emitErrorHandlerSet.add(t)}offError(t){return!!this._hasEmitErrorHandlerSet&&(t?this._emitErrorHandlerSet.delete(t):(this._emitErrorHandlerSet.clear(),!0))}}u([ge,g("design:type",Object),g("design:paramtypes",[])],Ni.prototype,"removeAllListeners",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Ni.prototype,"addListener",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Ni.prototype,"removeListener",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Ni.prototype,"_emitErrorHandlerSet",null);class kl extends Rn{_emit(t,r){if(this._hasBeforeTaskMap){const n=this._beforeTasks[t];n&&(delete this._beforeTasks[t],n.resolve(r))}if(this._hasCommonEmitHandlerMap){cn&&this._commonEmitHandlerMap.size&&console.log(...jt.head("%s EMIT WILDCARDS * [%s]",jt.MIDNIGHTBLUE_BOLD_UNDERLINE),this[Ci]||this,{eventname:t,args:r});for(const[n,s]of this._commonEmitHandlerMap)try{if(cn){const{taskname:o=n.name}=s;console.log(...jt.head("RUN [%s]",jt.MIDNIGHTBLUE_BOLD_UNDERLINE),o)}const i=n({eventname:t,args:r});i instanceof Promise&&i.catch(o=>this._emitErrorHanlder(o,t,r))}catch(i){this._emitErrorHanlder(i,t,r)}finally{s.once&&this._commonEmitHandlerMap.delete(n)}}if(super._emit(t,r),this._hasAfterTaskMap){const n=this._afterTasks[t];n&&(delete this._afterTasks[t],n.resolve(r))}}clear(t={}){super.clear(t);const{ignoreCommonErrorHanlder:r,ignoreBeforeTask:n,ignoreAfterTask:s}=t;if(!r&&this._hasCommonEmitHandlerMap&&this._commonEmitHandlerMap.clear(),!n&&this._hasBeforeTaskMap){const i=new Error("Remove all listeners");for(const o in this._beforeTasks)this._beforeTasks[o].reject(i)}if(!s&&this._hasAfterTaskMap){const i=new Error("Remove all listeners");for(const o in this._afterTasks)this._afterTasks[o].reject(i)}}get _commonEmitHandlerMap(){return this._hasCommonEmitHandlerMap=!0,new Map}onEmit(t,r={}){this._commonEmitHandlerMap.has(t)&&console.warn(`hanlder '${t.name}' already exits in common hanlder event set.`),r.taskname===void 0&&(r.taskname=il(this.onEmit)),this._commonEmitHandlerMap.set(t,r)}offEmit(t){return!!this._hasCommonEmitHandlerMap&&(t?this._commonEmitHandlerMap.delete(t):(this._commonEmitHandlerMap.clear(),!0))}get _afterTasks(){return this._hasAfterTaskMap=!0,Object.create(null)}after(t){let r=this._afterTasks[t];return r||(r=this._afterTasks[t]=new nr),r.promise}abortAfter(t,r){const n=this._afterTasks[t];return n&&n.reject(r),n}get _beforeTasks(){return this._hasBeforeTaskMap=!0,Object.create(null)}before(t){let r=this._beforeTasks[t];return r||(r=this._beforeTasks[t]=new nr),r.promise}abortBefore(t,r){const n=this._beforeTasks[t];return n&&n.reject(r),n}}u([ge,g("design:type",Object),g("design:paramtypes",[])],kl.prototype,"_commonEmitHandlerMap",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],kl.prototype,"_afterTasks",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],kl.prototype,"_beforeTasks",null);class gI extends Ni{emit(t,r){if(this._hasCommonEmitHandlerMap){if(cn&&this._commonEmitHandlerMap.size){const n=this[Ci]||this;console.log(...jt.head("%s QUENE EMIT WILDCARDS * [%s]",jt.DARKVIOLET_BOLD_UNDERLINE),n,t,r)}for(const[n,s]of this._commonEmitHandlerMap)try{if(cn){const{taskname:o=n.name}=s;console.log(...jt.head("RUN [%s]",jt.DARKVIOLET_BOLD_UNDERLINE),o)}const i=n({eventname:t,args:r});i instanceof Promise&&i.catch(o=>this._emitErrorHanlder(o,t,r))}catch(i){this._emitErrorHanlder(i,t,r)}finally{s.once&&this._commonEmitHandlerMap.delete(n)}}return super.emit(t,r)}get _commonEmitHandlerMap(){return this._hasCommonEmitHandlerMap=!0,new Map}onEmit(t,r={}){this._commonEmitHandlerMap.has(t)&&console.warn(`hanlder '${t.name}' already exits in common hanlder event set.`),r.taskname===void 0&&(r.taskname=il(this.onEmit)),this._commonEmitHandlerMap.set(t,r)}offEmit(t){return!!this._hasCommonEmitHandlerMap&&(t?this._commonEmitHandlerMap.delete(t):(this._commonEmitHandlerMap.clear(),!0))}clear(t={}){super.clear(t);const{ignoreCommonErrorHanlder:r}=t;!r&&this._hasCommonEmitHandlerMap&&this._commonEmitHandlerMap.clear()}}u([ge,g("design:type",Object),g("design:paramtypes",[])],gI.prototype,"_commonEmitHandlerMap",null);class kr extends Ni{constructor(){super(...arguments),this.list=[],this.min_next_index=0,this.calcs=[],this._is_rejected=!1,this._is_resolved=!1,this._requestProcess=0}canPush(t){return!(t<this.min_next_index||t in this.list||this.is_done)}push(t,r=this.min_next_index){if(r<this.min_next_index)throw new RangeError(`push into wrong index:${r}, should be ${this.min_next_index}`);if(r in this.list||r in this.calcs)throw new TypeError(`index:${r} already have value`);for(this.list[r]=t;this.list[this.min_next_index];)this.min_next_index+=1;return this.emit("push",{item:t,index:r})}pushCalc(t,r=this.min_next_index){if(r<this.min_next_index)throw new RangeError(`push into wrong index:${r}, should be ${this.min_next_index}`);if(r in this.list||r in this.calcs)throw new TypeError(`index:${r} already have value`);const n=()=>{delete this.calcs[r];const s=this.list[r]=t();return this.emit("push",{item:s,index:r}),s};for(this.calcs[r]=n;this.list[this.min_next_index];)this.min_next_index+=1;return this.emit("pushCalc",{calc:n,index:r})}get is_done(){return this._is_rejected||this._is_resolved}_initTask(){let t=this._task;return t||(t=this._task=new nr,this._is_rejected?t.reject(this._reason):this._is_resolved?t.resolve(this.list):(this._requestProcess=1/0,this.emit("requestAll",void 0))),t.promise}async done(){var t;if(!this.is_done){for(this._is_resolved=!0,(t=this._task)==null?void 0:t.resolve(this.list);;){const r=new Set(Object.keys(this.calcs));if(r.size===0)break;await new Promise((n,s)=>{const i=()=>{this.off("push",o),this.off("error",a)},o=p=>{r.delete(p.index.toString())&&r.size===0&&(n(),i())},a=()=>{s(),i()};this.on("push",o),this.once("error",a)})}return Object.freeze(this.list),this.emit("done",void 0)}}throw(t){var r;if(!this.is_done)return this._is_rejected=!0,(r=this._task)==null||r.reject(t),Object.freeze(this.list),this.emit("error",this._reason=t)}resolve(){return this.done()}reject(t){return this.throw(t)}then(...t){return this._initTask().then(...t)}catch(...t){return this._initTask().catch(...t)}get requestProcess(){return this._requestProcess}[Symbol.asyncIterator](){const t=this,{list:r,calcs:n}=t;return{index:0,return:()=>(of(t.done()),Promise.resolve({done:!0,value:void 0})),async next(){const s=this.index;n[s]&&of(n[s]());const i=r[s];let o={done:t.is_done,value:i};return s in r?o.done=!1:t.is_done||(o=await new Promise(async(a,p)=>{const l=()=>{t.off("error",h),t.off("push",A),t.off("pushCalc",_),t.off("done",y)},h=(E,T)=>(l(),p(E),T()),y=(E,T)=>(l(),a({done:!0,value:i}),T()),A=({item:E,index:T},w)=>(s===T&&(l(),a({done:!1,value:E})),w()),_=({calc:E,index:T},w)=>(s===T&&(l(),a({done:!1,value:E()})),w());t.on("error",h),t.on("done",y),t.on("push",A),t.on("pushCalc",_);try{await t.emit("requestItem",t._requestProcess=s)}catch(E){t.emit("error",E)}})),this.index+=1,o}}}toAsyncIterableIterator(){return Ab(this)}}async function*Ab(e){yield*e}u([Je,g("design:type",Function),g("design:paramtypes",[Object,Object]),g("design:returntype",void 0)],kr.prototype,"push",null),u([Je,g("design:type",Function),g("design:paramtypes",[Function,Object]),g("design:returntype",void 0)],kr.prototype,"pushCalc",null),u([Je,g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",Promise)],kr.prototype,"done",null),u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",void 0)],kr.prototype,"throw",null),u([Je,g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",void 0)],kr.prototype,"resolve",null),u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",void 0)],kr.prototype,"reject",null),u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",void 0)],kr.prototype,"then",null),u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",void 0)],kr.prototype,"catch",null);const kg=(e,t,r)=>{let n=[new nr];const s=(a,p)=>{let l=a[p];return l===void 0&&(l=a[p]=new nr),l},i=a=>{if(n!==void 0)return s(n,a).promise};let o=0;(async()=>{await i(o);for await(const a of e){let p=r(a);if(p.async&&(p=await p.value),p.filter){if(p.multi)for(const l of p.maps)t.push(l);else t.push(p.map);await i(o)}}await t.done()})().catch(t.throw),t.on("done",(a,p)=>(e.done(),p())),t.on("error",(a,p)=>(e.throw(a),p())),t.on("requestItem",(a,p)=>{n!==void 0&&(s(n,o).resolve(),o+=1),p()}),t.on("requestAll",(a,p)=>{if(n!==void 0){for(const l of n)l.is_resolved===!1&&l.resolve();n=void 0}p()})},wi=class{static InitCryptTable(){const e=new Array(1280);let t,r,n,s=1048577,i=0,o=0;for(i=0;i<256;i++)for(o=i,t=0;t<5;t++,o+=256)s=(125*s+3)%2796203,r=(65535&s)<<16,s=(125*s+3)%2796203,n=65535&s,e[o]=r|n;return e}static hashString(e,t){const{cryptTable:r,cryptTable_length:n}=wi;let s,i=2146271213,o=4008636142;for(let a=0;a<e.length;a+=1)s=((t<<8)+e.charCodeAt(a))%n,i=r[s]^i+o,o=s+i+o+(o<<5)+3;return i}static inRangePosition(e){const{hashRange:t}=wi;return(e-t.min)/t.dis%1}static hashToRandom(e,t,r=0,n=1,s){const i=(wi.hashString(e,t)-wi.hashRange.min)/wi.hashRange.dis*(n-r)+r;return s?Math.floor(i):i}};let Hg=wi;Hg.cryptTable=Object.freeze(wi.InitCryptTable()),Hg.cryptTable_length=wi.cryptTable.length,Hg.hashRange=Object.freeze({min:-2147483648,max:2147483647,dis:Math.pow(2,32)});class Eb extends kt{constructor(t){super(r=>[],t)}add(t,r){this.forceGet(t).push(r)}remove(t,r){const n=this.get(t);if(n){const s=n.indexOf(r);if(s!==-1)return n.splice(s,1),!0}return!1}}class Mg{constructor(t){this.eventEmitter=t,this.BINDED_EVENTS_MAP=new Eb}on(t,r,n){return this.eventEmitter.on(t,r,n),this.BINDED_EVENTS_MAP.add(t,r),this}off(t,r){return this.BINDED_EVENTS_MAP.remove(t,r)&&this.eventEmitter.off(t,r),this}emit(t,...r){return this.eventEmitter.emit(t,...r),this}once(t,r,n){const s=(...i)=>(this.BINDED_EVENTS_MAP.remove(t,s),r(...i));return this.BINDED_EVENTS_MAP.add(t,s),this.eventEmitter.once(t,r,n),this}removeAllListeners(){for(const[t,r]of this.BINDED_EVENTS_MAP)for(const n of r)this.eventEmitter.off(t,n);return this.BINDED_EVENTS_MAP.clear(),this}get clear(){return this.removeAllListeners}get addListener(){return this.on}get removeListener(){return this.off}}u([ge,g("design:type",Object),g("design:paramtypes",[])],Mg.prototype,"clear",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Mg.prototype,"addListener",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Mg.prototype,"removeListener",null);var x_;let Ef=class{constructor(){this._instanceParamWM=new WeakMap}getParam(e){return this._instanceParamWM.get(e)}setParam(e,t){this._instanceParamWM.set(e,t)}};Ef=u([ie()],Ef);const Ib=/"(?:\.|(\\\")|[^\""\n])*"|'(?:\.|(\\\')|[^\''\n])*'/g;let zl=class{constructor(e,t){this.moduleMap=e,this.flagParamStack=t,this._applyedFlagMap=new Map,this._flagInfomationMap=new Map}strToBool_(e){const t=e.toLowerCase();return t!=="disable"&&t!=="disabled"&&t!=="false"&&(t==="enable"||t==="enabled"||t==="true"||t===""||e)}_formatString(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}parse(e){const t=[],r=`_PLACE_${Math.random().toString(36).slice(2)}_HOLDER_`,n=e.replace(Ib,i=>(t.push(i),r)).split(/\s+/).filter(i=>!!i),s=new Map;for(const i of n){const o=i.indexOf("=");let a,p,l="";if(o===-1)a=i;else{if(a=i.substr(0,o),a.includes(r))throw new Error(`Flags format error: ${a.replace(r,t.shift()||r)} is invilde.`);l=i.substr(o+1).replace(new RegExp(r,"g"),y=>{const A=t.shift();if(!A)throw new Error;return A})}const h=this._flagInfomationMap.get(i);if(h)switch(h.type){case"boolean":p=!!this.strToBool_(l);break;case"number":const y=Number.parseFloat(l);p=Number.isNaN(y)?void 0:y;break;case"string":p=this._formatString(l)}else{if(p=this.strToBool_(l),typeof p=="string"){const y=parseFloat(p);y.toString()===p&&(p=y)}typeof p=="string"&&(p=this._formatString(p))}s.delete(a),s.set(a,p)}return s}quote(e){const t=[];for(let[r,n]of e)n===void 0?t.push(r):(typeof n=="string"&&(n=JSON.stringify(n)),t.push(`${r}=${n}`));return t.join(" ")}applyFlags(e){e instanceof Map||(e=this.parse(e));for(const[t,r]of e)this.setFlagValue(t,r);return this._applyedFlagMap=e}getFlagValue(e){return this._applyedFlagMap.get(e)}setFlagValue(e,t){const r=this._flagInfomationMap.get(e);return!!r&&(t===!1?(r.onDisable instanceof Function&&r.onDisable(),this._applyedFlagMap.delete(e)):(r.onEnable instanceof Function&&r.onEnable(t),this._applyedFlagMap.set(e,t)),!0)}hasFlag(e){return this._applyedFlagMap.has(e)}getApplyedFlags(){return this.quote(this._applyedFlagMap)}registerBooleanFlag(e,t,r){if(this._flagInfomationMap.has(e))throw new Error(`Duplicate registration boolean flag: ${e}.`);this._flagInfomationMap.set(e,{type:"boolean",onEnable:t,onDisable:r})}registerStringFlag(e,t,r){if(this._flagInfomationMap.has(e))throw new Error(`Duplicate registration string flag: ${e}.`);this._flagInfomationMap.set(e,{type:"string",onEnable:t,onDisable:r})}registerNumberFlag(e,t,r){if(this._flagInfomationMap.has(e))throw new Error(`Duplicate registration number flag: ${e}.`);this._flagInfomationMap.set(e,{type:"number",onEnable:t,onDisable:r})}registerInjectionFlag(e,t,r="boolean"){if(this._flagInfomationMap.has(e))throw new Error(`Duplicate registration injection flag: ${e}.`);this._flagInfomationMap.set(e,{type:r,onEnable:n=>{const s=this.moduleMap,i=Ht(t,s.installMask(new et([[Tb,n]])));this.flagParamStack.setParam(i,n)}})}};zl=u([ie(),g("design:paramtypes",[typeof(x_=et!==void 0&&et)=="function"?x_:Object,Ef])],zl);const Tb=Symbol("flag param in constructor");var bb=()=>performance;let jn=class{constructor(){this.platformInfo=Vs,this.performance=bb()}get platformName(){return Vs.platformName()}get isNodejs(){return ZE}get isWindows(){return W0}get isCordova(){return eI}get isWebView(){return ol}get isWebMainThread(){return Jy}get isWebWorker(){return tI}};u([ge,g("design:type",Object),g("design:paramtypes",[])],jn.prototype,"platformName",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],jn.prototype,"isNodejs",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],jn.prototype,"isWindows",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],jn.prototype,"isCordova",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],jn.prototype,"isWebView",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],jn.prototype,"isWebMainThread",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],jn.prototype,"isWebWorker",null),jn=u([ie()],jn);const If=new WeakMap;function go(e,t,r){let n,s=If.get(e);if(!s){const i={resolves:new Set,rejects:new Set},o=()=>{i.resolves.clear(),i.rejects.clear(),p.cbs=void 0},a=e.then(l=>{for(const h of i.resolves)queueMicrotask(async()=>{try{await h(l)}catch(y){console.error("Unhandled promise rejection when running onfulfilled",h,y)}});o()},async l=>{for(const h of i.rejects)queueMicrotask(async()=>{try{await h(l)}catch(y){console.error("Unhandled promise rejection when running onrejected",h,y)}});o()}),p={cbs:i,promise:a};If.set(e,s=p)}return s.cbs?(t&&s.cbs.resolves.add(t),r&&s.cbs.rejects.add(r),n=s.promise):n=e.then(t,r),{thened:s,toPromise:n}}function Hl(e,t,r){const n=If.get(e);return n&&n.cbs&&r&&n.cbs.rejects.delete(r),n}class cm{constructor(t){this.rankList=[],this.thenedMap=new Map,this._cter=!1,this.options=cm.mergeOptions(t)}static mergeOptions(t){return Object.assign({throwWhenNoRacer:!1},t)}resolve(t){this.quota?(this.quota.resolve(t),this.quota=void 0):this.rankList.push({type:1,value:t})}reject(t){this.quota?(this.quota.reject(t),this.quota=void 0):this.rankList.push({type:0,value:t})}addRacer(t){const r=this.thenedMap.get(t);if(!r){const n=a=>{this.resolve(a),this.thenedMap.delete(t)},s=a=>{this.reject(a),this.thenedMap.delete(t)},{thened:i,toPromise:o}=go(t,n,s);return i.cbs&&this.thenedMap.set(t,{cbs:i.cbs,onfulfilled:n,onrejected:s,toPromise:o}),o}return r.toPromise}removeRacer(t){const r=this.thenedMap.get(t);return!!r&&(this._removeRacer(t,r),this._checkToEndRace(),!0)}_removeRacer(t,r){r.cbs.resolves.delete(r.onfulfilled),r.cbs.rejects.delete(r.onrejected),this.thenedMap.delete(t)}hasRacer(t){return this.thenedMap.has(t)}get size(){return this.thenedMap.size}_queneToCheck(){}_checkToEndRace(){this.options.throwWhenNoRacer&&this._cter===!1&&this.thenedMap.size===0&&(this._cter=!0,queueMicrotask(()=>{this.thenedMap.size===0&&this.quota&&this.quota.is_finished===!1&&this.quota.reject(new RangeError("no racer to race"))}))}static isNoRacerException(t){return t instanceof RangeError&&t.message==="no racer to race"}race(t){const r=this.rankList.shift();if(!r)return t?(this.quota?this.quota!==t&&this.quota.promise.then(t.resolve,t.reject):this.quota=t,t.promise):(this._checkToEndRace(),(this.quota||(this.quota=new nr)).promise);if(r.type===1)return r.value;throw r.value}clear(t){for(const r of this.thenedMap)this._removeRacer(r[0],r[1]);this.rankList.length=0,this.quota&&(this.quota.reject(t),this.quota=void 0)}}function fI(e){const t=new nr;let r=!0;const n=[];for(const s of e){if(typeof s!="object"||s===null||typeof s.then!="function"){r=!1,t.resolve(s);break}n.push(s)}if(r)if(n.length===0)console.warn("safePromiseRace got empty array");else{const s=new cm;t.onFinished(()=>s.clear());for(const i of n)s.addRacer(i);s.race(t)}return t.promise}const Tf=Symbol("then"),bf=Symbol("catch");class wf{constructor(t){let r,n;const s=new Promise((a,p)=>{r=a,n=p});this.promise=Object.assign(s,{[Tf]:s.then,[bf]:s.catch});let i=!1;const o=()=>{i||(t(r,n),i=!0)};s.then=(a,p)=>(o(),this.delayThen(a,p)),s.catch=a=>(o(),this.delayCatch(a))}delayThen(t,r){return this.promise[Tf](t,r)}delayCatch(t){return this.promise[bf](t)}get then(){return this.promise.then}get catch(){return this.promise.catch}}wf.THEN_SYMBOL=Tf,wf.CATCH_SYMBOL=bf;class wb{constructor(t=2){this.maxParallelNum=t,this._runningTasks=[],this._waitingQuene=[]}addTaskExecutor(t){const r=new nr;return this._waitingQuene.push({executor:t,po:r}),r.promise}get isDone(){return this._runningTasks.length===0&&this._waitingQuene.length===0}get hasTask(){return!this.isDone}get isFull(){return this._runningTasks.length+this._waitingQuene.length>=this.maxParallelNum}async*_startParallel(){for(;;){const t=this._waitingQuene.shift();if(!t)break;try{const r=await t.executor();t.po.resolve(r),yield{asset:r}}catch(r){yield{error:r},t.po.reject(r)}}}async doAll(t){const r=[];for await(const n of this.yieldResults(t))r.push(n);return r}async doRace(t){for await(const r of this.yieldResults(t))return r}yieldResults(t){return this._yielding||(this._yielding=this._yieldResults(t)),this._yielding}async*_yieldResults(t={}){const r=[],n=()=>this._startParallel(),s=this._runningTasks;for(;;){for(;s.length<this.maxParallelNum&&this._waitingQuene.length>0;){const o=r.shift()||n(),a=o.next().then(l=>{if(!l.done){r.push(o);const h=l.value;if(h){if(!("error"in h))return{asset:h.asset,rm:p};if(t.onError&&t.onError(h.error),!t.ignoreError)throw h.error}}p()});s.push(a);const p=()=>{const l=s.indexOf(a);l!==-1&&s.splice(l,1)}}if(s.length===0)break;const i=await fI(s);i&&(yield i.asset,i.rm())}this._yielding=void 0}}class Sb extends Qu{constructor(t,r){super(t),this.silence=r,this.ABORT_ERROR_FLAG=!0}}class pm extends nr{constructor(){super()}get is_done(){return this.is_resolved||this.is_rejected}abort(t="Abort"){this.is_done||(this.reject(this.abort_error=new Sb(t)),this._hasAbortEvent&&this._abortEvent.emit("abort",this.abort_error,this))}get _abortEvent(){return this._hasAbortEvent=!0,new Rn}onAbort(t){this._abortEvent.on("abort",t)}follow(t){return t.then(this.resolve).catch(this.reject),this.promise}static fromPromise(t){const r=new pm;return of(t instanceof wf?t.delayThen(r.resolve,r.reject):t.then(r.resolve,r.reject)),r}finally(t){return this.promise.finally(t)}}u([ge,g("design:type",Object),g("design:paramtypes",[])],pm.prototype,"_abortEvent",null);const Jl=new WeakMap,Ks=(e,t)=>{let r;e<=0&&(e=1);const n=new Promise(s=>r=setTimeout(()=>{Jl.delete(n),s()},e)).then(t);return Jl.set(n,r),n},dI=e=>{const t=Jl.get(e);t!==void 0&&(Jl.delete(e),clearTimeout(t))};class yI{constructor(){this._task_list=[]}toPromise(){return Promise.all(this._task_list)}set next(t){this._task_list.push(t)}tryToPromise(){return this._task_list.some(t=>t&&typeof t.then=="function")?Promise.all(this._task_list):this._task_list}}const Qe=async e=>{const t=new yI;try{await e(t)}catch(r){t.next=Promise.reject(r)}return t.toPromise()};var Ml,R_;const{info:Nb}=rI("util","TimeHelper"),Ob={TIME_SPEED:"TIME_SPEED"};let Ll=Ml=class{constructor(e,t=1){this.platformHelper=e,this.TIME_SPEED=t,this.clearTimeout=clearTimeout,this.clearInterval=clearInterval,this.time_offset_ms=0,this.SYSTEM_START_TIME=this.platformHelper.performance.timeOrigin,typeof t=="number"&&t>0||(this.TIME_SPEED=1),Nb("TIME SPPED  %d.",this.TIME_SPEED)}setTimeout(e,t){return setTimeout(e,t/this.TIME_SPEED)}setInterval(e,t){return setInterval(e,t/this.TIME_SPEED)}sleep(e,t){return Ks(e/this.TIME_SPEED,t)}get BLOCKCHAIN_SYSTEM_START_TIME(){return this.SYSTEM_START_TIME+this.time_offset_ms}now(e=!1){const t=this.platformHelper.performance.now()+this.SYSTEM_START_TIME+this.time_offset_ms,r=Date.now()-t;r>1&&(this.time_offset_ms+=r);const n=this.SYSTEM_START_TIME+(this.platformHelper.performance.now()+this.time_offset_ms)*this.TIME_SPEED;return e?parseInt(n.toString()):n}changeNowByDiff(e){const{NOW_DIFF_SYMBOL:t}=Ml,r=Reflect.get(Date,t);if(this.time_offset_ms+=e-(r||0),e!==0){if(r===void 0){const n=Date.now,s=Date.now=()=>n()+Reflect.get(Date,t);Reflect.set(s,"source",n)}Reflect.set(Date,t,e)}else{const n=Date.now,s=Reflect.get(n,"source");s!==void 0&&(Date.now=s,Reflect.deleteProperty(Date,t))}}changeNowByTime(e){const{NOW_DIFF_SYMBOL:t}=Ml,r=Reflect.get(Date,t)||0,n=e-(Date.now()-r);return this.changeNowByDiff(n)}formatDate(e,t="yyyy-MM-dd hh:mm:ss"){const r=e.getMonth()+1,n={"M+":r,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),E:["","","",""][Math.floor(r%12/3)],W:["","","","","","",""][e.getDay()],S:e.getMilliseconds()};let s=t;/(y+)/.test(s)&&(s=s.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(const i in n)new RegExp("("+i+")").test(s)&&(s=s.replace(RegExp.$1,RegExp.$1.length===1?""+n[i]:("00"+n[i]).substr((""+n[i]).length)));return s}formatDateTime(e=this.now()){return this.formatDate(new Date(e))}formatYMDHMS(e,t,r,n,s,i){const o=(a,p=2)=>String(a).padStart(p,"0");return`${o(e,4)}-${o(t)}-${o(r)} ${o(n)}:${o(s)}:${o(i)}`}};Ll.NOW_DIFF_SYMBOL=Symbol("now-diff-ms"),Ll=Ml=u([ie(),Ce(1,Z(Ob.TIME_SPEED,{optional:!0})),g("design:paramtypes",[typeof(R_=jn!==void 0&&jn)=="function"?R_:Object,Object])],Ll);let Sa=class{get v4(){return"(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}"}get v6seg(){return"[a-fA-F\\d]{1,4}"}get v6(){const{v4:e,v6seg:t}=this;return`
    (
    (?:${t}:){7}(?:${t}|:)|                                // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
    (?:${t}:){6}(?:${e}|:${t}|:)|                         // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
    (?:${t}:){5}(?::${e}|(:${t}){1,2}|:)|                 // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
    (?:${t}:){4}(?:(:${t}){0,1}:${e}|(:${t}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
    (?:${t}:){3}(?:(:${t}){0,2}:${e}|(:${t}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
    (?:${t}:){2}(?:(:${t}){0,3}:${e}|(:${t}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
    (?:${t}:){1}(?:(:${t}){0,4}:${e}|(:${t}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
    (?::((?::${t}){0,5}:${e}|(?::${t}){1,7}|:))           // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
    )(%[0-9a-zA-Z]{1,})?                                           // %eth0            %1
    `.replace(/\/\/.*$/gm,"").replace(/(^\s+)|(\s+$)|\s+/g,"").replace(/\n/g,"")}isIp(e){const{v4:t,v6:r}=this;return new RegExp(`(?:^${t}$)|(?:^${r}$)`).test(e)}isIpV4(e){const{v4:t}=this;return new RegExp(`^${t}$`).test(e)}isIpV6(e){const{v6:t}=this;return new RegExp(`^${t}$`).test(e)}ipv4ToUint32(e){return e.split(".").reduce((t,r,n)=>t+ +r*Math.pow(256,3-n),0)}uint32ToIpv4(e){return`${e/16777216|0}.${e%16777216/65536|0}.${e%65536/256|0}.${e%256}`}};u([ge,g("design:type",Object),g("design:paramtypes",[])],Sa.prototype,"v4",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Sa.prototype,"v6seg",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Sa.prototype,"v6",null),Sa=u([ie()],Sa);class Hr extends Jn.Buffer{static from(t,r,n){return Jn.Buffer.from(t,r,n)}static alloc(t,r,n){return Jn.Buffer.alloc(t,r,n)}static allocUnsafe(t){return Jn.Buffer.allocUnsafe(t)}static allocUnsafeSlow(t){return Jn.Buffer.allocUnsafeSlow(t)}}function Sf(e){return typeof e=="object"&&e!==null&&!(Symbol.iterator in e)}function Nf(e){return e.length===1?e[0]:new Proxy(e[0],{get(t,r,n){const s=e.filter(a=>Reflect.has(a,r));if(s.length===0)return;if(s.length===1)return Reflect.get(s[0],r);const i=s.map(a=>Reflect.get(a,r)),o=i.filter(a=>Sf(a));return o.length===0?i[i.length-1]:Nf(o)},getOwnPropertyDescriptor(t,r){const n=e.filter(a=>Reflect.has(a,r));if(n.length===0)return;if(n.length===1)return Object.getOwnPropertyDescriptor(n[0],r);const s=n.map(a=>({obj:a,value:Reflect.get(a,r)})),i=s.filter(a=>Sf(a.value)),o=Object.getOwnPropertyDescriptor(s[s.length-1].obj,r);return i.length===0?o:{...o,value:Nf(s.map(a=>a.value))}},ownKeys(){const t=new Set;for(const r of e)for(const n of Reflect.ownKeys(r))t.add(n);return[...t]}})}function Cb(...e){const t=e.filter(Sf);return t.length===0?{}:Nf(t)}var xb=()=>({TextDecoder,TextEncoder});const Rb=new WeakMap,{TextEncoder:vb,TextDecoder:Bb}=xb(),Pb=new vb;new Bb("utf-8");const kb=new Uint8Array;function Hb(e){if(!e)return kb;const t=e.length<=128?Mb(e):Pb.encode(e);return Rb.set(t,e),t}function Mb(e){const t=[];let r,n;for(let s=0;s<e.length;++s)r=e.charCodeAt(s),r<128?t[t.length]=r:r<2048?(t[t.length]=r>>6|192,t[t.length]=63&r|128):(64512&r)==55296&&(64512&(n=e.charCodeAt(s+1)))==56320?(r=65536+((1023&r)<<10)+(1023&n),++s,t[t.length]=r>>18|240,t[t.length]=r>>12&63|128,t[t.length]=r>>6&63|128,t[t.length]=63&r|128):(t[t.length]=r>>12|224,t[t.length]=r>>6&63|128,t[t.length]=63&r|128);return new Uint8Array(t)}var mI;class Cn{constructor(t,r=s=>s,n){this.transformKey=r,this._afterDelete=n,this._set=new Set(t)}static from(t){return new Cn(t.entries,t.transformKey,t.afterDelete)}tryAdd(t){return this.add(this.transformKey(t))}tryDelete(t){return this.delete(this.transformKey(t))}tryHas(t){return this.has(this.transformKey(t))}get clear(){return this._set.clear.bind(this._set)}get delete(){const t=this._set.delete.bind(this._set),{_afterDelete:r}=this;return r?n=>!!t(n)&&(r(n),!0):t}get forEach(){return this._set.forEach.bind(this._set)}get has(){return this._set.has.bind(this._set)}get add(){return this._set.add.bind(this._set)}get size(){return this._set.size}get[mI=Symbol.iterator](){return this._set[Symbol.iterator].bind(this._set)}get entries(){return this._set.entries.bind(this._set)}get keys(){return this._set.keys.bind(this._set)}get values(){return this._set.values.bind(this._set)}get[Symbol.toStringTag](){return"EasySet"}}u([ge,g("design:type",Object),g("design:paramtypes",[])],Cn.prototype,"clear",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Cn.prototype,"delete",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Cn.prototype,"forEach",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Cn.prototype,"has",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Cn.prototype,"add",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Cn.prototype,mI,null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Cn.prototype,"entries",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Cn.prototype,"keys",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],Cn.prototype,"values",null);class sp{constructor(t,r=s=>s,n){this.transformKey=r,this._afterDelete=n,this._ws=new WeakSet(t)}static from(t){return new sp(t.entries,t.transformKey,t.afterDelete)}tryAdd(t){return this.add(this.transformKey(t))}tryDelete(t){return this.delete(this.transformKey(t))}tryHas(t){return this.has(this.transformKey(t))}get delete(){const t=this._ws.delete.bind(this._ws),{_afterDelete:r}=this;return r?n=>!!t(n)&&(r(n),!0):t}get add(){return this._ws.add.bind(this._ws)}get has(){return this._ws.has.bind(this._ws)}get[Symbol.toStringTag](){return"EasyWeakSet"}}u([ge,g("design:type",Object),g("design:paramtypes",[])],sp.prototype,"delete",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],sp.prototype,"add",null),u([ge,g("design:type",Object),g("design:paramtypes",[])],sp.prototype,"has",null);const Lb=typeof Promise=="function",Db=typeof self=="object"?self:_s,_I=typeof Symbol<"u",Of=typeof Map<"u",Cf=typeof Set<"u",Fb=typeof WeakMap<"u",Ub=typeof WeakSet<"u",$b=typeof DataView<"u",AI=_I&&Symbol.iterator!==void 0,v_=_I&&Symbol.toStringTag!==void 0,Vb=Cf&&typeof Set.prototype.entries=="function",Gb=Of&&typeof Map.prototype.entries=="function",Kb=Vb&&Object.getPrototypeOf(new Set().entries()),jb=Gb&&Object.getPrototypeOf(new Map().entries()),EI=AI&&typeof Array.prototype[Symbol.iterator]=="function",zb=EI&&Object.getPrototypeOf([][Symbol.iterator]()),II=AI&&typeof String.prototype[Symbol.iterator]=="function",Jb=II&&Object.getPrototypeOf(""[Symbol.iterator]());function Yb(e){const t=typeof e;if(t!=="object")return t;if(e===null)return"null";if(e===Db)return"global";if(Array.isArray(e)&&(v_===!1||!(Symbol.toStringTag in e)))return"Array";if(typeof window=="object"&&window!==null){if(typeof window.location=="object"&&e===window.location)return"Location";if(typeof window.document=="object"&&e===window.document)return"Document";if(typeof window.navigator=="object"){if(typeof window.navigator.mimeTypes=="object"&&e===window.navigator.mimeTypes)return"MimeTypeArray";if(typeof window.navigator.plugins=="object"&&e===window.navigator.plugins)return"PluginArray"}if((typeof window.HTMLElement=="function"||typeof window.HTMLElement=="object")&&e instanceof window.HTMLElement){if(e.tagName==="BLOCKQUOTE")return"HTMLQuoteElement";if(e.tagName==="TD")return"HTMLTableDataCellElement";if(e.tagName==="TH")return"HTMLTableHeaderCellElement"}}const r=v_&&e[Symbol.toStringTag];if(typeof r=="string")return r;const n=Object.getPrototypeOf(e);return n===RegExp.prototype?"RegExp":n===Date.prototype?"Date":Lb&&n===Promise.prototype?"Promise":Cf&&n===Set.prototype?"Set":Of&&n===Map.prototype?"Map":Ub&&n===WeakSet.prototype?"WeakSet":Fb&&n===WeakMap.prototype?"WeakMap":$b&&n===DataView.prototype?"DataView":Of&&n===jb?"Map Iterator":Cf&&n===Kb?"Set Iterator":EI&&n===zb?"Array Iterator":II&&n===Jb?"String Iterator":n===null?"Object":Object.prototype.toString.call(e).slice(8,-1)}const TI=typeof ho<"u";TI&&ho.from;const Qb=TI?function(e){return ho.isBuffer(e)}:function(e){return!1};function B_(e){return Qb(e)?"Buffer":Yb(e)}const bI=new class{get(e,t,r=B_(e)){switch(r){case"Arguments":case"Array":case"Object":return e[t];case"Map":return e.get(t);case"Set":return t}}set(e,t,r,n=B_(e)){switch(n){case"Arguments":case"Array":case"Object":e[t]=r;break;case"Map":e.set(t,r);break;case"Set":e.add(r)}return e}};bI.get;bI.set;const Xb=typeof globalThis<"u"&&globalThis!==null&&globalThis.Object===Object&&globalThis,Wb=typeof _s<"u"&&_s!==null&&_s.Object===Object&&_s,qb=typeof self<"u"&&self!==null&&self.Object===Object&&self;Xb||Wb||qb||Function("return this")();var al;const{ArgumentFormatException:P_}=le("MODEL","transactionModel"),Zb=new As(e=>new LE(e.inputs));let Fi=al=class extends oe{get macroId(){return Pe(this.macroIdBuffer)}set macroId(e){this.macroIdBuffer=be(e)}get inputMap(){return Zb.forceGet(this)}get transaction(){const{transactionBuffer:e}=this,t=rt.decode(e),r=Me.trsTypeToV(t.type),n=Me.VM.get(r);if(!n)throw new P_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:r});return n.decode(e)}set transaction(e){this.transactionBuffer=e.getBytes()}toJSON(){return{macroId:this.macroId,inputs:this.inputs,transaction:this.transaction.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e&&(e.macroId&&(t.macroId=e.macroId),e.transaction)){const r=e.transaction;if(r instanceof oe)t.transaction=r;else{const n=r.type;if(n){const s=Me.trsTypeToV(n),i=Me.VM.get(s);if(!i)throw new P_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.transaction=i.fromObject(r)}}}return t}};Fi.INC=1;u([I.d(al.INC++,"bytes"),g("design:type",Uint8Array)],Fi.prototype,"macroIdBuffer",void 0);u([wr.d(al.INC++,"string","string"),g("design:type",Object)],Fi.prototype,"inputs",void 0);u([I.d(al.INC++,"bytes"),g("design:type",Uint8Array)],Fi.prototype,"transactionBuffer",void 0);Fi=al=u([j.d("MacroCallModel")],Fi);let Bh=class extends oe{toJSON(){return{call:this.call.toJSON()}}};u([I.d(1,Fi),g("design:type",Fi)],Bh.prototype,"call",void 0);Bh=u([j.d("MacroCallAssetModel")],Bh);var hm;let ec=hm=class extends rt{as(e,t){const r=Me.MV.get(e),n=Me.trsTypeToV(this.type);if(r===n)if(t){if(this.signature===t)return this}else return this;const{transaction:s}=this.asset.call;return s.as(e,t)}getBlobSize(e=!1){let t=0;const r=this.blobMap.values();for(const n of r)t+=n[3];return e===!1&&(t+=this.asset.call.transaction.getBlobSize(e)),t}};u([I.d(hm.INC++,Bh),g("design:type",Bh)],ec.prototype,"asset",void 0);ec=hm=u([j.d("MacroCallTransaction")],ec);Me.VM.set(W.REGISTER_CHAIN,Ja);Me.MV.set(Ja,W.REGISTER_CHAIN);Me.VM.set(W.MULTIPLE,Qa);Me.MV.set(Qa,W.MULTIPLE);Me.VM.set(W.PROMISE,Ro);Me.MV.set(Ro,W.PROMISE);Me.VM.set(W.PROMISE_RESOLVE,Wa);Me.MV.set(Wa,W.PROMISE_RESOLVE);Me.VM.set(W.MACRO,Po);Me.MV.set(Po,W.MACRO);Me.VM.set(W.MACRO_CALL,ec);Me.MV.set(ec,W.MACRO_CALL);var sa,Si;(function(e){e[e.INDETERMINATE=0]="INDETERMINATE",e[e.DETERMINATE=1]="DETERMINATE",e[e.BUFFER=2]="BUFFER",e[e.QUERY=3]="QUERY"})(Si||(Si={}));let zr=sa=class extends oe{get loaded(){return this._loaded>this.total?this.total:this._loaded}set loaded(e){this._loaded=e}get buffer(){return this._buffer&&this._buffer>this.total?this.total:this._buffer}set buffer(e){this._buffer=e}toJSON(){var e;const t={type:this.type,mode:this.mode,loaded:this.loaded,buffer:this.buffer,total:this.total};return(e=this.buffer)!==null&&e!==void 0||(t.buffer=this.buffer),t}static fromObject(e){const t=super.fromObject(e);return e.loaded&&(t.loaded=e.loaded),e.buffer&&(t.buffer=e.buffer),t}};zr.INC=1;u([I.d(sa.INC++,"string"),g("design:type",String)],zr.prototype,"type",void 0);u([I.d(sa.INC++,Si),g("design:type",Number)],zr.prototype,"mode",void 0);u([I.d(sa.INC++,"uint32"),g("design:type",Number)],zr.prototype,"_loaded",void 0);u([I.d(sa.INC++,"uint32","optional"),g("design:type",Number)],zr.prototype,"_buffer",void 0);u([I.d(sa.INC++,"uint32"),g("design:type",Number)],zr.prototype,"total",void 0);zr=sa=u([j.d("ProgressEvent")],zr);var lm;let Yl=lm=class extends zr{toJSON(){return Object.assign({finishedDetails:this.finishedDetails.map(e=>e.toJSON())},super.toJSON())}};u([I.d(lm.INC++,va,"repeated"),g("design:type",Array)],Yl.prototype,"finishedDetails",void 0);Yl=lm=u([j.d("TransactionsProgressEvent")],Yl);var ig;let Ui=ig=class extends zr{toJSON(){return Object.assign({finishedDetails:this.finishedDetails.map(e=>e.toJSON()),processingDetails:this.processingDetails},super.toJSON())}};u([I.d(ig.INC++,va,"repeated"),g("design:type",Array)],Ui.prototype,"finishedDetails",void 0);u([wr.d(ig.INC++,"uint32",Yl),g("design:type",Object)],Ui.prototype,"processingDetails",void 0);Ui=ig=u([j.d("BlocksProgressEvent")],Ui);var um;let ti=um=class extends zr{toJSON(){return Object.assign({currentBlockDetails:this.currentBlockDetails.toJSON()},super.toJSON())}};u([I.d(um.INC++,Ui),g("design:type",Ui)],ti.prototype,"currentBlockDetails",void 0);ti=um=u([j.d("BlockchainRebuidingProgressEvent")],ti);let tc=class extends zr{};tc=u([j.d("BlockchainPeerScanningProgressEvent")],tc);let $i=class extends zr{toJSON(){const e={};for(const r in this.applyDetails)e[r]=this.applyDetails[r].toJSON();const t={};for(const r in this.syncDetails)t[r]=this.syncDetails[r].toJSON();return Object.assign({applyDetails:e,syncDetails:t},super.toJSON())}};u([wr.d(ti.INC++,"uint32",Ui),g("design:type",Object)],$i.prototype,"applyDetails",void 0);u([wr.d(ti.INC++,"uint32",Ui),g("design:type",Object)],$i.prototype,"syncDetails",void 0);$i=u([j.d("BlockchainReplayBlockProgressEvent")],$i);let rc=class extends zr{};rc=u([j.d("BlockchainRollbackProgressEventModel")],rc);let nc=class extends zr{};nc=u([j.d("BlockchainGeneratingProgressEvent")],nc);var ve;(function(e){e[e.error=0]="error",e[e.busy=1]="busy",e[e.success=2]="success",e[e.idempotentError=3]="idempotentError"})(ve||(ve={}));var an;(function(e){e[e.OFFLINE=0]="OFFLINE",e[e.FREE=1]="FREE",e[e.REBUIDING=2]="REBUIDING",e[e.PEER_SCANNING=3]="PEER_SCANNING",e[e.REPLAY_BLOCK=4]="REPLAY_BLOCK",e[e.GENERATING=5]="GENERATING",e[e.ROLLBACK=6]="ROLLBACK"})(an||(an={}));var Ql;(function(e){e[e.Refuse=0]="Refuse",e[e.InBlock=1]="InBlock",e[e.InUnconfirmQuene=2]="InUnconfirmQuene"})(Ql||(Ql={}));var He;(function(e){e[e.FEE_LESS_THAN_WEB_FEE=0]="FEE_LESS_THAN_WEB_FEE",e[e.TRS_EXPRIED=1]="TRS_EXPRIED",e[e.TRANSACTION_IN_UNTREATEDTR=2]="TRANSACTION_IN_UNTREATEDTR",e[e.TRANSACTION_IN_TRS=3]="TRANSACTION_IN_TRS",e[e.TRANSACTION_BASE_TYPE_NOT_FOUND=4]="TRANSACTION_BASE_TYPE_NOT_FOUND",e[e.TRANSACTION_BASE_NOT_FOUND=5]="TRANSACTION_BASE_NOT_FOUND",e[e.CHAIN_ASSET_NOT_ENOUGH=6]="CHAIN_ASSET_NOT_ENOUGH",e[e.ASSET_NOT_ENOUGH=7]="ASSET_NOT_ENOUGH",e[e.TRANSACTION_SENDER_ASSET_FROZEN=8]="TRANSACTION_SENDER_ASSET_FROZEN",e[e.TRANSACTION_RECIPIENT_ASSET_FROZEN=9]="TRANSACTION_RECIPIENT_ASSET_FROZEN",e[e.TRANSACTION_FEE_NOT_ENOUGH=10]="TRANSACTION_FEE_NOT_ENOUGH",e[e.TRANSACTION_ASSET_DEBT=11]="TRANSACTION_ASSET_DEBT",e[e.LOCATION_NAME_NOT_EXIST=12]="LOCATION_NAME_NOT_EXIST",e[e.ACCOUNT_NOT_LNS_POSSESSOR=13]="ACCOUNT_NOT_LNS_POSSESSOR",e[e.DAPP_ALREADY_EXISTS=14]="DAPP_ALREADY_EXISTS",e[e.ASSETTYPE_ALREADY_EXIST=15]="ASSETTYPE_ALREADY_EXIST",e[e.CHAINNAME_ALREADY_EXIST=16]="CHAINNAME_ALREADY_EXIST",e[e.ASSET_ALREADY_EXIST=17]="ASSET_ALREADY_EXIST",e[e.LOCATION_NAME_ALREADY_EXIST=18]="LOCATION_NAME_ALREADY_EXIST",e[e.CAN_NOT_SET_FROZEN_ACCOUNT_AS_MANAGER=19]="CAN_NOT_SET_FROZEN_ACCOUNT_AS_MANAGER",e[e.CAN_NOT_SET_SAME_ACCOUNT_AS_MANAGER=20]="CAN_NOT_SET_SAME_ACCOUNT_AS_MANAGER",e[e.SET_LNS_MANAGER_PERMISSION_DENIED=21]="SET_LNS_MANAGER_PERMISSION_DENIED",e[e.SET_LNS_RECORD_VALUE_PERMISSION_DENIED=22]="SET_LNS_RECORD_VALUE_PERMISSION_DENIED",e[e.TRS_IN_FEATURE=23]="TRS_IN_FEATURE",e[e.TRUST_MAIN_ASSET_ONLY=24]="TRUST_MAIN_ASSET_ONLY",e[e.USE_MAIN_ASSET_PURCHASE_ONLY=25]="USE_MAIN_ASSET_PURCHASE_ONLY",e[e.ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH=26]="ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH",e[e.MIGRATE_MAIN_ASSET_ONLY=27]="MIGRATE_MAIN_ASSET_ONLY",e[e.ASSET_IS_ALREADY_MIGRATION=28]="ASSET_IS_ALREADY_MIGRATION",e[e.MAGIC_ALREADY_EXIST=29]="MAGIC_ALREADY_EXIST",e[e.ENTITY_FACTORY_ALREADY_EXIST=30]="ENTITY_FACTORY_ALREADY_EXIST",e[e.ENTITY_FACTORY_NOT_EXIST=31]="ENTITY_FACTORY_NOT_EXIST",e[e.ENTITY_ALREADY_EXIST=32]="ENTITY_ALREADY_EXIST",e[e.ENTITY_NOT_EXIST=33]="ENTITY_NOT_EXIST",e[e.ACCOUNT_NOT_ENTITY_POSSESSOR=34]="ACCOUNT_NOT_ENTITY_POSSESSOR",e[e.ACCOUNT_NOT_DAPPID_POSSESSOR=35]="ACCOUNT_NOT_DAPPID_POSSESSOR",e[e.ASSET_NOT_EXIST=36]="ASSET_NOT_EXIST",e[e.DAPPID_NOT_EXIST=37]="DAPPID_NOT_EXIST",e[e.CERTIFICATE_ALREADY_EXIST=38]="CERTIFICATE_ALREADY_EXIST",e[e.CERTIFICATE_NOT_EXIST=39]="CERTIFICATE_NOT_EXIST",e[e.ACCOUNT_NOT_CERTIFICATE_POSSESSOR=40]="ACCOUNT_NOT_CERTIFICATE_POSSESSOR"})(He||(He={}));var Se;(function(e){e[e.REFUSE=0]="REFUSE",e[e.RESPONSE=1]="RESPONSE",e[e.QUERY_TRANSACTION=2]="QUERY_TRANSACTION",e[e.NEW_TRANSACTION=4]="NEW_TRANSACTION",e[e.QUERY_BLOCK=8]="QUERY_BLOCK",e[e.NEW_BLOCK=16]="NEW_BLOCK",e[e.GET_PEER_INFO=32]="GET_PEER_INFO",e[e.INDEX_TRANSACTION=64]="INDEX_TRANSACTION",e[e.DOWNLOAD_TRANSACTION=128]="DOWNLOAD_TRANSACTION",e[e.OPEN_BLOB=256]="OPEN_BLOB",e[e.READ_BLOB=512]="READ_BLOB",e[e.CLOSE_BLOB=1024]="CLOSE_BLOB",e[e.QUERY_TINDEX=2048]="QUERY_TINDEX",e[e.GET_TRANSACTIONINBLOCK=4096]="GET_TRANSACTIONINBLOCK",e[e.QUERY_TRANSACTION_RETURN=3]="QUERY_TRANSACTION_RETURN",e[e.NEW_TRANSACTION_RETURN=5]="NEW_TRANSACTION_RETURN",e[e.QUERY_BLOCK_RETURN=9]="QUERY_BLOCK_RETURN",e[e.NEW_BLOCK_RETURN=17]="NEW_BLOCK_RETURN",e[e.GET_PEER_INFO_RETURN=33]="GET_PEER_INFO_RETURN",e[e.INDEX_TRANSACTION_RETURN=65]="INDEX_TRANSACTION_RETURN",e[e.DOWNLOAD_TRANSACTION_RETURN=129]="DOWNLOAD_TRANSACTION_RETURN",e[e.OPEN_BLOB_RETURN=257]="OPEN_BLOB_RETURN",e[e.READ_BLOB_RETURN=513]="READ_BLOB_RETURN",e[e.CLOSE_BLOB_RETURN=1025]="CLOSE_BLOB_RETURN",e[e.QUERY_TINDEX_RETURN=2049]="QUERY_TINDEX_RETURN",e[e.GET_TRANSACTIONINBLOCK_RETURN=4097]="GET_TRANSACTIONINBLOCK_RETURN"})(Se||(Se={}));var xf,og;let Pt=xf=class extends oe{constructor(){super(...arguments),this._parsed_detail=!1}get detail(){if(!this._parsed_detail){this._parsed_detail=!0;try{this._detail=this.detailJSON?JSON.parse(this.detailJSON):{}}catch{this._detail={}}}return this._detail}set detail(e){this.detailJSON=JSON.stringify(e),this._detail=e,this._parsed_detail=!0}static fromException(e){const t=xf.fromObject(e);return t.detail=e.detail,t}toJSON(){return{message:this.message,detailJSON:this.detailJSON,PLATFORM:this.PLATFORM,CHANNEL:this.CHANNEL,BUSINESS:this.BUSINESS,MODULE:this.MODULE,FILE:this.FILE,CODE:this.CODE}}};u([I.d(1,"string"),g("design:type",String)],Pt.prototype,"message",void 0);u([I.d(2,"string","required",""),g("design:type",String)],Pt.prototype,"detailJSON",void 0);u([I.d(3,"string","optional"),g("design:type",String)],Pt.prototype,"PLATFORM",void 0);u([I.d(4,"string","optional"),g("design:type",String)],Pt.prototype,"CHANNEL",void 0);u([I.d(5,"string","optional"),g("design:type",String)],Pt.prototype,"BUSINESS",void 0);u([I.d(6,"string","optional"),g("design:type",String)],Pt.prototype,"MODULE",void 0);u([I.d(7,"string","optional"),g("design:type",String)],Pt.prototype,"FILE",void 0);u([I.d(8,"string","optional"),g("design:type",String)],Pt.prototype,"CODE",void 0);Pt=xf=u([j.d("ExceptionMessage")],Pt);let pr=og=class extends oe{toJSON(){const e={status:this.status};return this.error&&(e.error=this.error.toJSON()),e}};pr.INC=1;u([I.d(og.INC++,ve),g("design:type",Number)],pr.prototype,"status",void 0);u([I.d(og.INC++,Pt,"optional"),g("design:type",Pt)],pr.prototype,"error",void 0);pr=og=u([j.d("CommonResponse")],pr);var hr,gm,fm,dm,ym,mm,_m,ia,Am,Em;let ut=hr=class extends oe{get signature(){return this.signatureBuffer&&Pe(this.signatureBuffer)||void 0}set signature(e){this.signatureBuffer=be(e)}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.signature&&(t.signature=e.signature),t}toJSON(){return{type:this.type,types:this.types,signature:this.signature,senderId:this.senderId,recipientId:this.recipientId,dappid:this.dappid,lns:this.lns,storage:this.storage,blockSignature:this.blockSignature,minHeight:this.minHeight,maxHeight:this.maxHeight,trusteeId:this.trusteeId,purchaseDAppid:this.purchaseDAppid,range:this.range,offset:this.offset,limit:this.limit,address:this.address}}};ut.INC=1;u([I.d(hr.INC++,"string","optional"),g("design:type",String)],ut.prototype,"type",void 0);u([I.d(hr.INC++,"string","repeated"),g("design:type",Array)],ut.prototype,"types",void 0);u([I.d(hr.INC++,"bytes","optional"),g("design:type",Uint8Array)],ut.prototype,"signatureBuffer",void 0);u([I.d(hr.INC++,"string","optional"),g("design:type",String)],ut.prototype,"senderId",void 0);u([I.d(hr.INC++,"string","optional"),g("design:type",String)],ut.prototype,"recipientId",void 0);u([I.d(hr.INC++,"string","optional"),g("design:type",String)],ut.prototype,"dappid",void 0);u([I.d(hr.INC++,"string","optional"),g("design:type",String)],ut.prototype,"lns",void 0);u([I.d(hr.INC++,Ts,"optional"),g("design:type",Ts)],ut.prototype,"storage",void 0);u([I.d(hr.INC++,"string","optional"),g("design:type",String)],ut.prototype,"blockSignature",void 0);u([I.d(hr.INC++,"uint32","optional"),g("design:type",Number)],ut.prototype,"minHeight",void 0);u([I.d(hr.INC++,"uint32","optional"),g("design:type",Number)],ut.prototype,"maxHeight",void 0);u([I.d(hr.INC++,"string","optional"),g("design:type",String)],ut.prototype,"trusteeId",void 0);u([I.d(hr.INC++,"string","optional"),g("design:type",String)],ut.prototype,"purchaseDAppid",void 0);u([I.d(hr.INC++,"uint32"),g("design:type",Number)],ut.prototype,"offset",void 0);u([I.d(hr.INC++,"uint32","optional"),g("design:type",Number)],ut.prototype,"limit",void 0);u([I.d(hr.INC++,"string","optional"),g("design:type",String)],ut.prototype,"range",void 0);u([I.d(hr.INC++,"string","optional"),g("design:type",String)],ut.prototype,"address",void 0);ut=hr=u([j.d("TransactionQueryOptions")],ut);let hn=gm=class extends oe{toJSON(){return{tIndex:this.tIndex}}};hn.INC=1;u([I.d(gm.INC++,"int32","required",1),g("design:type",Number)],hn.prototype,"tIndex",void 0);hn=gm=u([j.d("TransactionSortOptions")],hn);let ko=class extends oe{toJSON(){return{query:this.query.toJSON(),sort:this.sort.toJSON()}}};u([I.d(1,ut),g("design:type",ut)],ko.prototype,"query",void 0);u([I.d(2,hn),g("design:type",hn)],ko.prototype,"sort",void 0);ko=u([j.d("QueryTransactionArg")],ko);let sc=fm=class extends pr{toJSON(){return Object.assign({transactions:this.transactions.map(e=>e.toJSON())},super.toJSON())}};u([I.d(fm.INC++,ar,"repeated"),g("design:type",Array)],sc.prototype,"transactions",void 0);sc=fm=u([j.d("QueryTransactionReturn")],sc);let Ph=class extends oe{toJSON(){return{query:this.query,sort:this.sort}}};u([I.d(1,ut),g("design:type",ut)],Ph.prototype,"query",void 0);u([I.d(2,hn),g("design:type",hn)],Ph.prototype,"sort",void 0);Ph=u([j.d("QueryTindexArg")],Ph);let ic=dm=class extends pr{toJSON(){return Object.assign({tIndexes:this.tIndexes},super.toJSON())}};u([I.d(dm.INC++,"uint32","repeated"),g("design:type",Array)],ic.prototype,"tIndexes",void 0);ic=dm=u([j.d("QueryTindexReturn")],ic);let Ho=ym=class extends oe{static fromObject(e){return super.fromObject(e)}toJSON(){return{tIndexRanges:this.tIndexRanges}}};Ho.INC=1;u([I.d(ym.INC++,"uint32","repeated"),g("design:type",Array)],Ho.prototype,"tIndexRanges",void 0);Ho=ym=u([j.d("TransactionInBlockGetOptions")],Ho);let kh=class extends oe{toJSON(){return{query:this.query}}};u([I.d(1,Ho),g("design:type",Ho)],kh.prototype,"query",void 0);kh=u([j.d("GetTransactionInBlockArg")],kh);let oc=mm=class extends pr{toJSON(){return Object.assign({transactionInBlocks:this.transactionInBlocks.map(e=>e.toJSON())},super.toJSON())}};u([I.d(mm.INC++,ar,"repeated"),g("design:type",Array)],oc.prototype,"transactionInBlocks",void 0);oc=mm=u([j.d("GetTransactionInBlockReturn")],oc);let Hh=_m=class extends bo{static fromObject(e){return super.fromObject(e)}};u([I.d(_m.INC++,"string","optional"),g("design:type",String)],Hh.prototype,"grabSecret",void 0);Hh=_m=u([j.d("NewTransactionArg")],Hh);let xs=ia=class extends pr{toJSON(){var e,t,r;const n=Object.assign({newTrsStatus:this.newTrsStatus,minFee:this.minFee},super.toJSON());return(e=this.refuseReason)!==null&&e!==void 0||(n.refuseReason=this.refuseReason),(t=this.errorCode)!==null&&t!==void 0||(n.errorCode=this.errorCode),(r=this.errorMessage)!==null&&r!==void 0||(n.errorMessage=this.errorMessage),n}};u([I.d(ia.INC++,Ql,"required",Ql.Refuse),g("design:type",Number)],xs.prototype,"newTrsStatus",void 0);u([I.d(ia.INC++,"string","required","0"),g("design:type",String)],xs.prototype,"minFee",void 0);u([I.d(ia.INC++,He,"optional"),g("design:type",Number)],xs.prototype,"refuseReason",void 0);u([I.d(ia.INC++,"string","optional"),g("design:type",String)],xs.prototype,"errorCode",void 0);u([I.d(ia.INC++,"string","optional"),g("design:type",String)],xs.prototype,"errorMessage",void 0);xs=ia=u([j.d("NewTransactionReturn")],xs);let Rs=class extends oe{toJSON(){const e={height:this.height,tIndex:this.tIndex,length:this.length};return this.blockSignature&&(e.blockSignature=this.blockSignature),e}};u([I.d(1,"uint32"),g("design:type",Number)],Rs.prototype,"height",void 0);u([I.d(2,"uint32"),g("design:type",Number)],Rs.prototype,"tIndex",void 0);u([I.d(3,"uint32","required",1),g("design:type",Number)],Rs.prototype,"length",void 0);u([I.d(4,"string"),g("design:type",String)],Rs.prototype,"blockSignature",void 0);Rs=u([j.d("TransactionIndexModel")],Rs);let Mh=class extends oe{toJSON(){return{query:this.query.toJSON(),sort:this.sort.toJSON()}}};u([I.d(1,ut),g("design:type",ut)],Mh.prototype,"query",void 0);u([I.d(2,hn),g("design:type",hn)],Mh.prototype,"sort",void 0);Mh=u([j.d("IndexTransactionArg")],Mh);let ac=Am=class extends pr{toJSON(){return Object.assign({tIndexes:this.tIndexes.map(e=>e.toJSON())},super.toJSON())}};u([I.d(Am.INC++,Rs,"repeated"),g("design:type",Array)],ac.prototype,"tIndexes",void 0);ac=Am=u([j.d("IndexTransactionReturn")],ac);let Lh=class extends oe{toJSON(){return{tIndexes:this.tIndexes.map(e=>e.toJSON())}}};u([I.d(1,Rs,"repeated"),g("design:type",Array)],Lh.prototype,"tIndexes",void 0);Lh=u([j.d("DownloadTransactionArg")],Lh);let cc=Em=class extends pr{toJSON(){return Object.assign({transactions:this.transactions.map(e=>e.toJSON())},super.toJSON())}};u([I.d(Em.INC++,ar,"repeated"),g("design:type",Array)],cc.prototype,"transactions",void 0);cc=Em=u([j.d("DownloadTransactionReturn")],cc);var cl,pl,Im,hl;let Vi=cl=class extends oe{get hash(){return Pe(this.hashBuffer)}set hash(e){this.hashBuffer=be(e)}toJSON(){return{algorithm:this.algorithm,hash:this.hash,downloadSize:this.downloadSize}}static fromObject(e){const t=super.fromObject(e);return e.hash&&(t.hash=e.hash),t}};Vi.INC=1;u([I.d(cl.INC++,"string"),g("design:type",String)],Vi.prototype,"algorithm",void 0);u([I.d(cl.INC++,"bytes"),g("design:type",Uint8Array)],Vi.prototype,"hashBuffer",void 0);u([I.d(cl.INC++,"int32"),g("design:type",Number)],Vi.prototype,"downloadSize",void 0);Vi=cl=u([j.d("OpenBlobArgModel")],Vi);let Gi=pl=class extends pr{toJSON(){const e=super.toJSON();return e.descriptor=this.descriptor,e.contentType=this.contentType,e}static fromObject(e){return super.fromObject(e)}};u([I.d(pl.INC++,"string","optional"),g("design:type",String)],Gi.prototype,"descriptor",void 0);u([I.d(pl.INC++,"string","optional"),g("design:type",String)],Gi.prototype,"contentType",void 0);u([I.d(pl.INC++,"uint32","optional"),g("design:type",Number)],Gi.prototype,"size",void 0);Gi=pl=u([j.d("OpenBlobReturn")],Gi);let pc=Im=class extends oe{toJSON(){return{descriptor:this.descriptor}}};pc.INC=1;u([I.d(Im.INC++,"string"),g("design:type",String)],pc.prototype,"descriptor",void 0);pc=Im=u([j.d("CloseBlobArg")],pc);let Dh=class extends pr{};Dh=u([j.d("CloseBlobReturn")],Dh);let ri=hl=class extends oe{toJSON(){return{descriptor:this.descriptor,start:this.start,end:this.end}}};ri.INC=1;u([I.d(hl.INC++,"string"),g("design:type",String)],ri.prototype,"descriptor",void 0);u([I.d(hl.INC++,"uint32"),g("design:type",Number)],ri.prototype,"start",void 0);u([I.d(hl.INC++,"uint32"),g("design:type",Number)],ri.prototype,"end",void 0);ri=hl=u([j.d("ReadBlobArg")],ri);let Mo=class extends pr{get chunk(){return Pe(this.chunkBuffer)}set chunk(e){this.chunkBuffer=be(e)}toJSON(){const e=super.toJSON();return e.chunk=this.chunk,e}static fromObject(e){const t=super.fromObject(e);return e.chunk&&(t.chunk=e.chunk),t}};Mo.INC=1;u([I.d(ri.INC++,"bytes"),g("design:type",Uint8Array)],Mo.prototype,"chunkBuffer",void 0);Mo=u([j.d("ReadBlobReturn")],Mo);var Tm,ks;let Lo=class extends oe{toJSON(){const e=super.toJSON();return this.signature&&(e.signature=this.signature),this.height&&(e.height=this.height),e}};u([I.d(1,"string","optional"),g("design:type",String)],Lo.prototype,"signature",void 0);u([I.d(2,"uint32","optional"),g("design:type",Number)],Lo.prototype,"height",void 0);Lo=u([j.d("BlockQueryOptions")],Lo);let hc=class extends oe{toJSON(){return{query:this.query.toJSON()}}};u([I.d(1,Lo),g("design:type",Lo)],hc.prototype,"query",void 0);hc=u([j.d("QueryBlockArg")],hc);let lc=Tm=class extends pr{toJSON(){const e=super.toJSON();return this.someBlock&&(e.someBlock=this.someBlock.toJSON()),e}};u([I.d(Tm.INC++,Di,"optional"),g("design:type",Di)],lc.prototype,"someBlock",void 0);lc=Tm=u([j.d("QueryBlockReturn")],lc);let qr=ks=class extends oe{get generatorPublicKey(){return Pe(this.generatorPublicKeyBuffer)}set generatorPublicKey(e){this.generatorPublicKeyBuffer=be(e)}toJSON(){return{height:this.height,signature:this.signature,previousBlockSignature:this.previousBlockSignature,timestamp:this.timestamp,totalFee:this.totalFee,numberOfTransactions:this.numberOfTransactions,generatorPublicKey:this.generatorPublicKey,version:this.version}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.generatorPublicKey&&(t.generatorPublicKey=e.generatorPublicKey),t}};qr.INC=1;u([I.d(ks.INC++,"uint32"),g("design:type",Number)],qr.prototype,"height",void 0);u([I.d(ks.INC++,"string"),g("design:type",String)],qr.prototype,"signature",void 0);u([I.d(ks.INC++,"string"),g("design:type",String)],qr.prototype,"previousBlockSignature",void 0);u([I.d(ks.INC++,"uint32"),g("design:type",Number)],qr.prototype,"timestamp",void 0);u([I.d(ks.INC++,"string"),g("design:type",String)],qr.prototype,"totalFee",void 0);u([I.d(ks.INC++,"uint32"),g("design:type",Number)],qr.prototype,"numberOfTransactions",void 0);u([I.d(ks.INC++,"bytes"),g("design:type",Uint8Array)],qr.prototype,"generatorPublicKeyBuffer",void 0);u([I.d(ks.INC++,"uint32"),g("design:type",Number)],qr.prototype,"version",void 0);qr=ks=u([j.d("NewBlockArg")],qr);let uc=class extends pr{};uc=u([j.d("NewBlockReturn")],uc);var An,Zi,hi,bm;const k_=new WeakMap,Lg=new WeakMap;let Fh=class extends oe{toJSON(){return{uid:this.uid}}};u([I.d(1,"uint32","optional"),g("design:type",Number)],Fh.prototype,"uid",void 0);Fh=u([j.d("GetPeerInfoArg")],Fh);let Uh=class extends oe{get peerTime(){return this.peerTimeLong.toNumber()}set peerTime(e){this.peerTimeLong=ep.fromNumber(e,!0)}toJSON(){return{peerTime:this.peerTime}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.peerTime!==void 0&&(t.peerTime=e.peerTime),t}};u([I.d(1,"uint64"),g("design:type",Object)],Uh.prototype,"peerTimeLong",void 0);Uh=u([j.d("PeerConsensus")],Uh);let br=An=class extends oe{get servicePeerInfo(){return{peerInfoDelay:this.peerInfoDelay,onlineUser:this.onlineUser,productivity:this.productivity,paidSourceChainMagic:this.paidSourceChainMagic,paidsourceChainName:this.paidsourceChainName,paidAssetType:this.paidAssetType,paidAmount:this.paidAmount,paidType:this.paidType,serviceNotesName:this.serviceNotesName,noteIP:this.noteIP,dappOnChainBuy:this.dappOnChainBuy}}set servicePeerInfo(e){this.peerInfoDelay=e.peerInfoDelay,this.onlineUser=e.onlineUser,this.productivity=e.productivity,this.paidSourceChainMagic=e.paidSourceChainMagic,this.paidsourceChainName=e.paidsourceChainName,this.paidAssetType=e.paidAssetType,this.paidAmount=e.paidAmount,this.paidType=e.paidType,this.serviceNotesName=e.serviceNotesName,this.noteIP=e.noteIP,this.dappOnChainBuy=e.dappOnChainBuy}toJSON(){return{peerInfoDelay:this.peerInfoDelay,onlineUser:this.onlineUser,productivity:this.productivity,paidSourceChainMagic:this.paidSourceChainMagic,paidsourceChainName:this.paidsourceChainName,paidAssetType:this.paidAssetType,paidAmount:this.paidAmount,paidType:this.paidType,serviceNotesName:this.serviceNotesName,noteIP:this.noteIP,dappOnChainBuy:this.dappOnChainBuy}}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.peerInfoDelay&&(t.peerInfoDelay=e.peerInfoDelay),e.onlineUser&&(t.onlineUser=e.onlineUser),e.productivity&&(t.productivity=e.productivity),e.paidSourceChainMagic&&(t.paidSourceChainMagic=e.paidSourceChainMagic),e.paidsourceChainName&&(t.paidsourceChainName=e.paidsourceChainName),e.paidAmount&&(t.paidAmount=e.paidAmount),e.paidType&&(t.paidType=e.paidType),e.serviceNotesName&&(t.serviceNotesName=e.serviceNotesName),e.noteIP&&(t.noteIP=e.noteIP),e.dappOnChainBuy&&(t.dappOnChainBuy=e.dappOnChainBuy)),t}};br.INC=1;u([I.d(An.INC++,"uint32"),g("design:type",Number)],br.prototype,"peerInfoDelay",void 0);u([I.d(An.INC++,"uint32"),g("design:type",Number)],br.prototype,"onlineUser",void 0);u([I.d(An.INC++,"uint32"),g("design:type",Number)],br.prototype,"productivity",void 0);u([I.d(An.INC++,"string"),g("design:type",String)],br.prototype,"paidSourceChainMagic",void 0);u([I.d(An.INC++,"string"),g("design:type",String)],br.prototype,"paidsourceChainName",void 0);u([I.d(An.INC++,"string"),g("design:type",String)],br.prototype,"paidAssetType",void 0);u([I.d(An.INC++,"string"),g("design:type",String)],br.prototype,"paidAmount",void 0);u([I.d(An.INC++,"string"),g("design:type",String)],br.prototype,"paidType",void 0);u([I.d(An.INC++,"string"),g("design:type",String)],br.prototype,"serviceNotesName",void 0);u([I.d(An.INC++,"string"),g("design:type",String)],br.prototype,"noteIP",void 0);u([I.d(An.INC++,"bool"),g("design:type",Boolean)],br.prototype,"dappOnChainBuy",void 0);br=An=u([j.d("ServicePeerInfo")],br);let os=Zi=class extends oe{get progress(){const{status:e}=this;return e===an.REBUIDING?{status:e,progressEvent:this.rebuildingProgressEvent}:e===an.PEER_SCANNING?{status:e,progressEvent:this.peerScanningProgressEvent}:e===an.REPLAY_BLOCK?{status:e,progressEvent:this.replayBlockProgressEvent}:e===an.GENERATING?{status:e,progressEvent:this.generatingProgressEvent}:e===an.ROLLBACK?{status:e,progressEvent:this.rollbackProgressEvent}:{status:e,progressEvent:void 0}}get progressEvent(){return this._progressEvent}set progressEvent(e){e&&(e instanceof ti?this.rebuildingProgressEvent=e:e instanceof tc?this.peerScanningProgressEvent=e:e instanceof $i?this.replayBlockProgressEvent=e:e instanceof nc?this.generatingProgressEvent=e:e instanceof rc&&(this.rollbackProgressEvent=e))}get status(){return this._status}set status(e){e!==this._status&&(this._status=e,this._clearProgressEvent(),e===an.REBUIDING?this.rebuildingProgressEvent=ti.fromObject({mode:Si.DETERMINATE}):e===an.PEER_SCANNING?this.peerScanningProgressEvent=tc.fromObject({mode:Si.BUFFER}):e===an.REPLAY_BLOCK?this.replayBlockProgressEvent=$i.fromObject({mode:Si.BUFFER}):e===an.GENERATING?this.generatingProgressEvent=nc.fromObject({mode:Si.QUERY}):e===an.ROLLBACK&&(this.rollbackProgressEvent=rc.fromObject({mode:Si.BUFFER})))}_clearProgressEvent(){this.rebuildingProgressEvent=void 0,this.peerScanningProgressEvent=void 0,this.replayBlockProgressEvent=void 0,this.generatingProgressEvent=void 0,this.rollbackProgressEvent=void 0}toJSON(){return this.progress}};os.INC=1;u([I.d(Zi.INC++,ti,"optional"),g("design:type",ti)],os.prototype,"rebuildingProgressEvent",void 0);u([I.d(Zi.INC++,tc,"optional"),g("design:type",tc)],os.prototype,"peerScanningProgressEvent",void 0);u([I.d(Zi.INC++,$i,"optional"),g("design:type",$i)],os.prototype,"replayBlockProgressEvent",void 0);u([I.d(Zi.INC++,nc,"optional"),g("design:type",nc)],os.prototype,"generatingProgressEvent",void 0);u([I.d(Zi.INC++,rc,"optional"),g("design:type",rc)],os.prototype,"rollbackProgressEvent",void 0);u([I.d(Zi.INC++,an),g("design:type",Number)],os.prototype,"_status",void 0);os=Zi=u([j.d("BlockchainStatus")],os);let mn=hi=class extends oe{constructor(){super(...arguments),this._parsed_serviceInfo=!1}get serviceInfo(){return!this._parsed_serviceInfo&&typeof this.serviceInfoJSON=="string"&&(this._parsed_serviceInfo=!0,this._serviceInfo=JSON.parse(this.serviceInfoJSON)),this._serviceInfo}set serviceInfo(e){this.serviceInfoJSON=(this._serviceInfo=e)?JSON.stringify(e):void 0,this._parsed_serviceInfo=!0}get servicePeerInfo(){const{servicePeerInfoBufferList:e}=this;let t=k_.get(e);return t||(t=this.servicePeerInfoBufferList.map(r=>{const n=br.decode(r);return Lg.set(n,r),n})),t}set servicePeerInfo(e){const t=e.map(r=>{let n=Lg.get(r);return n||(n=br.encode(r).finish(),Lg.set(r,n)),n});k_.set(t,e),this.servicePeerInfoBufferList=t}toJSON(){return{uid:this.uid,height:this.height,blockchainStatus:this.blockchainStatus.toJSON(),serviceInfo:this.serviceInfo,servicePeerInfo:this.servicePeerInfo.map(e=>e.toJSON()),peerConsensus:this.peerConsensus.toJSON(),peerLinkCount:this.peerLinkCount}}static fromObject(e){const t=super.fromObject(e);if(t!==e){const r=[];if(e.servicePeerInfo){const n=e.servicePeerInfo;for(const s of n)r[r.length]=br.fromObject(s)}t.servicePeerInfo=r}return t}};mn.INC=1;u([I.d(hi.INC++,"uint32"),g("design:type",Number)],mn.prototype,"uid",void 0);u([I.d(hi.INC++,"uint32"),g("design:type",Number)],mn.prototype,"height",void 0);u([I.d(hi.INC++,os),g("design:type",os)],mn.prototype,"blockchainStatus",void 0);u([I.d(hi.INC++,"string","optional"),g("design:type",String)],mn.prototype,"serviceInfoJSON",void 0);u([I.d(hi.INC++,"bytes","repeated"),g("design:type",Array)],mn.prototype,"servicePeerInfoBufferList",void 0);u([I.d(hi.INC++,Uh),g("design:type",Uh)],mn.prototype,"peerConsensus",void 0);u([I.d(hi.INC++,"uint32"),g("design:type",Number)],mn.prototype,"peerLinkCount",void 0);mn=hi=u([j.d("PeerInfo")],mn);let gc=bm=class extends pr{toJSON(){const e=super.toJSON();return this.peerInfo&&(e.peerInfo=this.peerInfo.toJSON()),e}};u([I.d(bm.INC++,mn,"optional"),g("design:type",mn)],gc.prototype,"peerInfo",void 0);gc=bm=u([j.d("GetPeerInfoReturn")],gc);var li;let ln=li=class extends oe{};ln.INC=1;u([I.d(li.INC++,"uint32"),g("design:type",Number)],ln.prototype,"version",void 0);u([I.d(li.INC++,"uint32"),g("design:type",Number)],ln.prototype,"req_id",void 0);u([I.d(li.INC++,Se),g("design:type",Number)],ln.prototype,"cmd",void 0);u([I.d(li.INC++,"bytes"),g("design:type",Uint8Array)],ln.prototype,"binary",void 0);u([I.d(li.INC++,"uint32"),g("design:type",Number)],ln.prototype,"lockTimespan",void 0);u([I.d(li.INC++,"uint32"),g("design:type",Number)],ln.prototype,"refuseTimespan",void 0);u([I.d(li.INC++,"uint32"),g("design:type",Number)],ln.prototype,"messageVersion",void 0);ln=li=u([j.d("ChainChannelMessageModel")],ln);var Xl;(function(e){e[e.TESTNET=0]="TESTNET",e[e.MAINNET=1]="MAINNET"})(Xl||(Xl={}));let ue=class{constructor(e,t){this.genesisBlock=e,this.business=t,this.events=new Rn,this._hookBlockMap=new Map,this._hookBlockMap.set(e.version,e),this.hookedGenesisBlock=this.genesisBlock}_applyHookGenesisBlock(){const e=[...this._hookBlockMap].sort((t,r)=>t[0]-r[0]);this.hookedGenesisBlock=Cb(this.genesisBlock,...e.map(t=>({...t[1],version:t[0]}))),n0(this),this.events.emit("hookGenesisBlockApply",this.toJSON())}setHookGenesisBlock(e,t){this._hookBlockMap.set(e,t),this._applyHookGenesisBlock()}getHookGenesisBlock(e){return this._hookBlockMap.get(e)}rollBackHookGenesisBlock(e){this._hookBlockMap.delete(e)&&this._applyHookGenesisBlock()}get version(){return this.hookedGenesisBlock.version}get miniUnit(){return"1"}get netType(){return this.initials==="b"?Xl.MAINNET:Xl.TESTNET}get initials(){return this.bnid}get genesisAccountPublicKey(){return this.hookedGenesisBlock.generatorPublicKey}get chainName(){return this.hookedGenesisBlock.asset.genesisAsset.chainName}get assetType(){return this.hookedGenesisBlock.asset.genesisAsset.assetType}get magic(){return this.hookedGenesisBlock.asset.genesisAsset.magic}get bnid(){return this.hookedGenesisBlock.asset.genesisAsset.bnid}get beginEpochTime(){return this.hookedGenesisBlock.asset.genesisAsset.beginEpochTime}get genesisLocationName(){return this.hookedGenesisBlock.asset.genesisAsset.genesisLocationName}get genesisAmount(){return this.hookedGenesisBlock.asset.genesisAsset.genesisAmount}get maxSupply(){return this.hookedGenesisBlock.asset.genesisAsset.maxSupply}get minTransactionFeePerByte(){return this.hookedGenesisBlock.asset.genesisAsset.minTransactionFeePerByte}get maxTransactionSize(){return this.hookedGenesisBlock.asset.genesisAsset.maxTransactionSize}get maxTransactionBlobSize(){return this.hookedGenesisBlock.asset.genesisAsset.maxTransactionBlobSize}get maxBlockSize(){return this.hookedGenesisBlock.asset.genesisAsset.maxBlockSize}get maxBlockBlobSize(){return this.hookedGenesisBlock.asset.genesisAsset.maxBlockBlobSize}get maxTPSPerBlock(){return this.hookedGenesisBlock.asset.genesisAsset.maxTPSPerBlock}get consessusBeforeSyncBlockDiff(){return this.hookedGenesisBlock.asset.genesisAsset.consessusBeforeSyncBlockDiff}get maxGrabTimesOfGiftAsset(){return this.hookedGenesisBlock.asset.genesisAsset.maxGrabTimesOfGiftAsset}get issueAssetMinChainAsset(){return this.magic==="RRJJO"?"100000000000":this.hookedGenesisBlock.asset.genesisAsset.issueAssetMinChainAsset}get maxMultipleOfAssetAndMainAsset(){return this.magic==="RRJJO"?{numerator:"1000000",denominator:"1"}:this.hookedGenesisBlock.asset.genesisAsset.maxMultipleOfAssetAndMainAsset}get issueEntityFactoryMinChainAsset(){return this.hookedGenesisBlock.asset.genesisAsset.issueEntityFactoryMinChainAsset}get maxMultipleOfEntityAndMainAsset(){return this.hookedGenesisBlock.asset.genesisAsset.maxMultipleOfEntityAndMainAsset}get registerChainMinChainAsset(){return this.hookedGenesisBlock.asset.genesisAsset.registerChainMinChainAsset}get maxApplyAndConfirmedBlockHeightDiff(){return this.hookedGenesisBlock.asset.genesisAsset.maxApplyAndConfirmedBlockHeightDiff}get blockPerRound(){return this.hookedGenesisBlock.asset.genesisAsset.blockPerRound}get whetherToAllowGeneratorContinusElections(){return this.hookedGenesisBlock.asset.genesisAsset.whetherToAllowGeneratorContinusElections}get forgeInterval(){return this.hookedGenesisBlock.asset.genesisAsset.forgeInterval}get basicRewards(){return this.hookedGenesisBlock.asset.genesisAsset.basicRewards}get ports(){return this.hookedGenesisBlock.asset.genesisAsset.ports}get generatorPublicKey(){return this.hookedGenesisBlock.generatorPublicKey}get signature(){return this.hookedGenesisBlock.signature}get nextRoundGenerators(){return this.hookedGenesisBlock.asset.genesisAsset.nextRoundGenerators}get blobFeeMultipleRatio(){return{numerator:BigInt(this.genesisAmount),denominator:BigInt(31456e11)}}toJSON(){return{version:this.version,miniUnit:this.miniUnit,chainName:this.chainName,assetType:this.assetType,magic:this.magic,bnid:this.bnid,beginEpochTime:this.beginEpochTime,genesisLocationName:this.genesisLocationName,genesisAmount:this.genesisAmount,maxSupply:this.maxSupply,minTransactionFeePerByte:this.minTransactionFeePerByte,maxTransactionSize:this.maxTransactionSize,maxTransactionBlobSize:this.maxTransactionBlobSize,maxBlockSize:this.maxBlockSize,maxBlockBlobSize:this.maxBlockBlobSize,maxTPSPerBlock:this.maxTPSPerBlock,consessusBeforeSyncBlockDiff:this.consessusBeforeSyncBlockDiff,maxGrabTimesOfGiftAsset:this.maxGrabTimesOfGiftAsset,issueAssetMinChainAsset:this.issueAssetMinChainAsset,maxMultipleOfAssetAndMainAsset:this.maxMultipleOfAssetAndMainAsset,issueEntityFactoryMinChainAsset:this.issueEntityFactoryMinChainAsset,maxMultipleOfEntityAndMainAsset:this.maxMultipleOfEntityAndMainAsset,registerChainMinChainAsset:this.registerChainMinChainAsset,maxApplyAndConfirmedBlockHeightDiff:this.maxApplyAndConfirmedBlockHeightDiff,blockPerRound:this.blockPerRound,whetherToAllowGeneratorContinusElections:this.whetherToAllowGeneratorContinusElections,forgeInterval:this.forgeInterval,basicRewards:this.basicRewards,ports:this.ports}}};u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"version",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"miniUnit",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"netType",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"genesisAccountPublicKey",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"chainName",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"assetType",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"magic",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"bnid",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"beginEpochTime",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"genesisLocationName",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"genesisAmount",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"maxSupply",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"minTransactionFeePerByte",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"maxTransactionSize",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"maxTransactionBlobSize",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"maxBlockSize",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"maxBlockBlobSize",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"maxTPSPerBlock",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"consessusBeforeSyncBlockDiff",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"maxGrabTimesOfGiftAsset",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"issueAssetMinChainAsset",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"maxMultipleOfAssetAndMainAsset",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"issueEntityFactoryMinChainAsset",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"maxMultipleOfEntityAndMainAsset",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"registerChainMinChainAsset",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"maxApplyAndConfirmedBlockHeightDiff",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"blockPerRound",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"whetherToAllowGeneratorContinusElections",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"forgeInterval",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"basicRewards",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"ports",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"generatorPublicKey",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"signature",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],ue.prototype,"nextRoundGenerators",null);ue=u([ie("config"),g("design:paramtypes",[Object,String])],ue);let Dr=class{constructor(){this._map=new Map}get clear(){return this._map.clear.bind(this._map)}get delete(){return this._map.delete.bind(this._map)}get forEach(){return this._map.forEach.bind(this._map)}get get(){return this._map.get.bind(this._map)}get has(){return this._map.has.bind(this._map)}get set(){return this._map.set.bind(this._map)}get size(){return this._map.size}get[Symbol.iterator](){return this._map[Symbol.iterator].bind(this._map)}get entries(){return this._map.entries.bind(this._map)}get keys(){return this._map.keys.bind(this._map)}get values(){return this._map.values.bind(this._map)}get[Symbol.toStringTag](){return"EasyMap"}};u([ge,g("design:type",Object),g("design:paramtypes",[])],Dr.prototype,"delete",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],Dr.prototype,"forEach",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],Dr.prototype,"get",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],Dr.prototype,"has",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],Dr.prototype,"set",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],Dr.prototype,Symbol.iterator,null);u([ge,g("design:type",Object),g("design:paramtypes",[])],Dr.prototype,"entries",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],Dr.prototype,"keys",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],Dr.prototype,"values",null);Dr=u([ie("configMap")],Dr);class Yt extends Ll{getTimestamp(t=this.now()){return Math.floor((t-this.config.beginEpochTime)/1e3)}getTimeByTimestamp(t){return t*1e3+this.config.beginEpochTime}get beginEpochTime(){return new Date(this.config.beginEpochTime)}getSlotNumberByTimestamp(t=this.getTimestamp()){return Math.floor(t/this.config.forgeInterval)}getNextSlotNumberByTimestamp(t=this.getTimestamp()){return this.getSlotNumberByTimestamp(t)+1}getTimestampBySlotNumber(t){return t*this.config.forgeInterval}formatTimestamp(t=this.getTimestamp()){return this.formatDateTime(t*1e3+this.config.beginEpochTime)}}u([Z(ue),g("design:type",ue)],Yt.prototype,"config",void 0);u([ge,g("design:type",Object),g("design:paramtypes",[])],Yt.prototype,"beginEpochTime",null);const{ArgumentIllegalException:ew}=le("HELPER","jsbiHelper");function Nr(e){try{if(typeof e=="string"){if(/^[0-9-]*$/.test(e)===!1)throw new Error("QAQ");e=parseInt(e)}else if(typeof e=="number")e=Math.floor(e);else return e;return BigInt(e)}catch{throw new ew(c.PROP_IS_INVALID,{prop:`param ${e}`,target:"fraction"})}}let Lt=class{multiplyFloor(e,t){return this.multiplyFloorFraction(e,this.numberToFraction(t))}floorFraction(e){const t=Nr(e.numerator),r=Nr(e.denominator);return t/r}ceilFraction(e){const t=Nr(e.numerator),r=Nr(e.denominator),n=t/r;return n*r===t?n:n+BigInt(1)}multiplyFraction(e,t){const r=BigInt(e.numerator),n=BigInt(e.denominator),s=BigInt(t.numerator),i=BigInt(t.denominator);return{numerator:r*s,denominator:n*i}}multiplyFractionAndFloor(e,t){return this.floorFraction(this.multiplyFraction(e,t))}multiplyFractionAndCeil(e,t){return this.ceilFraction(this.multiplyFraction(e,t))}multiplyFloorFraction(e,t){const r=Nr(e),n=BigInt(t.numerator),s=BigInt(t.denominator);return r*n/s}multiplyFloorFractionString(e,t){const r=Nr(e),n=BigInt(t.numerator),s=BigInt(t.denominator);return r*n/s}multiplyRound(e,t){return this.multiplyRoundFraction(e,this.numberToFraction(t))}multiplyRoundFraction(e,t){const r=this.multiplyFloorFraction(e,{numerator:BigInt(t.numerator)*BigInt(10),denominator:BigInt(t.denominator)}),n=r/BigInt(10);return r%BigInt(10)>=BigInt(5)?n+BigInt(1):n}numberToFraction(e){const t=e.toFixed(45).split("."),r=t.length>1?t[1].length:0,n=1+"0".repeat(r);return{numerator:t.join(""),denominator:n}}multiplyCeil(e,t){return this.multiplyCeilFraction(e,this.numberToFraction(t))}multiplyCeilFraction(e,t){const r=Nr(e),n=BigInt(t.numerator),s=BigInt(t.denominator),i=r*n,o=i/s;return o*s===i?o:o+BigInt(1)}divisionCeilFraction(e,t){const r=Nr(e),n=BigInt(t.numerator),s=BigInt(t.denominator),i=r*s,o=i/n;return o*n===i?o:o+BigInt(1)}divisionFraction(e,t){const r=BigInt(e.numerator),n=BigInt(e.denominator),s=BigInt(t.numerator),i=BigInt(t.denominator);return{numerator:r*i,denominator:n*s}}divisionFractionAndFloor(e,t){return this.floorFraction(this.divisionFraction(e,t))}divisionFractionAndCeil(e,t){return this.ceilFraction(this.divisionFraction(e,t))}compareFraction(e,t){const r=Nr(e.numerator),n=Nr(e.denominator),s=Nr(t.numerator),i=Nr(t.denominator),o=r*i,a=s*n;return o===a?0:o>a?1:-1}greatestCommonDivisor(e,t){return t===BigInt(0)?e:this.greatestCommonDivisor(t,e%t)}toFraction(e){if(e.includes(".")){const t=e.split(".");let r=BigInt(t[0]+t[1]),n=BigInt("1"+"0".repeat(t[1].length));const s=this.greatestCommonDivisor(r,n);return{numerator:(r/s).toString(),denominator:(n/s).toString()}}else return{numerator:e,denominator:"1"}}minusFraction(e,t){const r=Nr(e.numerator),n=Nr(e.denominator),s=Nr(t.numerator),i=Nr(t.denominator),o=n*i,a=r*i-s*n,p=this.greatestCommonDivisor(a,o);return{numerator:(a/p).toString(),denominator:(o/p).toString()}}};Lt=u([ie()],Lt);let Fr=class{constructor(e,t,r){this.cryptoHelper=e,this.keypairHelper=t,this.ed2curveHelper=r}async detachedSign(e,t){const r=await this.cryptoHelper.sha256(e);return this.keypairHelper.detached_sign(r,t)}async detachedVeriy(e,t,r){const n=await this.cryptoHelper.sha256(e);return this.keypairHelper.detached_verify(n,t,r)}async signToString(e,t,r="hex"){return(await this.detachedSign(e,t)).toString(r)}async asymmetricEncrypt(e,t,r){const n=await this.ed2curveHelper.convertPublicKey(t);if(!n)throw new Error("decryptPK convertPublicKey fail");const s=await this.ed2curveHelper.convertSecretKey(r);return this.keypairHelper.box(e,n,s)}async asymmetricDecrypt(e,t,r,n=new Uint8Array(24)){const s=await this.ed2curveHelper.convertPublicKey(t);if(!s)throw new Error("decryptPK convertPublicKey fail");const i=await this.ed2curveHelper.convertSecretKey(r);return await this.keypairHelper.open(e,n,s,i)}};Fr=u([ie("asymmetricHelper"),Ce(0,Z("cryptoHelper")),Ce(1,Z("keypairHelper")),Ce(2,Z("ed2curveHelper")),g("design:paramtypes",[Object,Object,Object])],Fr);let Wl=class{calcParityBit(e){let t=0;for(let r=0;r<e.length;r++)t+=e.charCodeAt(r);return t%36}shuffle(e){let t=e.length;for(;t;){const r=Math.floor(Math.random()*t--);[e[r],e[t]]=[e[t],e[r]]}return e}__getRandomString(e){const t=[];for(let s=0;s<10;s++)t[t.length]=s;for(let s=65;s<91;s++)t[t.length]=String.fromCharCode(s);const r=this.shuffle(t);let n="";for(let s=0;s<e;s++)n+=r[Math.floor(Math.random()*e)];return n}__addParityBit(e){const t=`P_${this.calcParityBit(e)}`;return e+lo[t]}createMagic(e){if(e){if(typeof e!="string")throw new Error(`Not a valid magic ${e}`);if(!new RegExp("^[A-Z0-9]{4}$").test(e))throw new Error(`Not a valid magic ${e}`)}else e=this.__getRandomString(4);return this.__addParityBit(e)}createDAppId(e){if(e){if(typeof e!="string")throw new Error(`Not a valid dappid ${e}`);if(!new RegExp("^[A-Z0-9]{7}$").test(e))throw new Error(`Not a valid dappid ${e}`)}else e=this.__getRandomString(7);return this.__addParityBit(e)}};Wl=u([ie()],Wl);const tw="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";class rw{constructor(t=tw){this.ALPHABET=t,this.BASE=this.ALPHABET.length,this.ALPHABET_MAP={},this.LEADER=this.ALPHABET.charAt(0);for(let r=0;r<t.length;r++){const n=t.charAt(r);if(this.ALPHABET_MAP[n]!==void 0)throw new TypeError(n+" is ambiguous");this.ALPHABET_MAP[n]=r}}encode(t){if(t.length===0)return"";const r=[0];for(let s=0;s<t.length;++s){let i=t[s];for(let o=0;o<r.length;++o)i+=r[o]<<8,r[o]=i%this.BASE,i=i/this.BASE|0;for(;i>0;)r.push(i%this.BASE),i=i/this.BASE|0}let n="";for(let s=0;t[s]===0&&s<t.length-1;++s)n+=this.ALPHABET[0];for(let s=r.length-1;s>=0;--s)n+=this.ALPHABET[r[s]];return n}decodeUnsafe(t){if(t.length===0)return new Uint8Array;const r=[0];for(let n=0;n<t.length;n++){let s=this.ALPHABET_MAP[t[n]];if(s===void 0)return;let i=s;for(let o=0;o<r.length;++o)i+=r[o]*this.BASE,r[o]=i&255,i>>=8;for(;i>0;)r.push(i&255),i>>=8}for(let n=0;t[n]===this.LEADER&&n<t.length-1;++n)r.push(0);return new Uint8Array(r).reverse()}decode(t){const r=this.decodeUnsafe(t);if(r)return r;throw new Error("Non-base"+this.BASE+" character")}}const nw=new rw;let ql=class{constructor(e,t){this.cryptoHelper=e,this.Buffer=t,this.bs58=nw}async sha256x2(e){const t=await this.cryptoHelper.sha256(e);return this.cryptoHelper.sha256(t)}async encode(e){return this.bs58.encode(this.Buffer.concat([e,await this.sha256x2(e)],e.length+4))}async decodeRaw(e){let t=e.slice(0,-4),r=e.slice(-4),n=await this.sha256x2(t);if(!(r[0]^n[0]|r[1]^n[1]|r[2]^n[2]|r[3]^n[3]))return this.Buffer.from(t)}async decodeUnsafe(e){let t=await this.bs58.decodeUnsafe(e);if(t)return this.decodeRaw(t)}async decode(e){let t=this.bs58.decode(e),r=await this.decodeRaw(t);if(!r)throw new Error("Invalid checksum");return r}};ql=u([ie(),Ce(0,Z("cryptoHelper")),Ce(1,Z("Buffer")),g("design:paramtypes",[Object,Object])],ql);const H_=new WeakMap;let Te=class{constructor(e,t,r,n,s){this.cryptoHelper=e,this.keypairHelperInterface=t,this.Buffer=r,this.base58Helper=n,this.config=s}get _prefix(){return this.config.initials}checkSecret(e){if(/^\s|\s$/.test(e))throw new SyntaxError("Main Secret cannot contain spaces at the beginning or end");if(/[\cA-\cZ]/.test(e))throw new SyntaxError("Main Secret cannot contain Special Characters");return!0}async createSecretKeypair(e){return await this.keypairHelperInterface.create(await this.cryptoHelper.sha256(Hb(e)))}async getPublicKeyFromSecret(e){return(await this.createSecretKeypair(e)).publicKey}async getPublicKeyStringFromSecret(e,t="hex"){return(await this.getPublicKeyFromSecret(e)).toString(t)}async getBinaryAddressFromPublicKey(e){const t=H_.get(e);if(t)return t;const r=await this.cryptoHelper.sha256(e),n=await this.cryptoHelper.ripemd160(r);return H_.set(e,n),n}async getAddressFromPublicKey(e,t=this._prefix){return t+await this.base58Helper.encode(await this.getBinaryAddressFromPublicKey(e))}getAddressFromPublicKeyString(e,t){return this.getAddressFromPublicKey(FE(e),t)}async getAddressFromSecret(e,t){return this.getAddressFromPublicKey(await this.getPublicKeyFromSecret(e),t)}async isAddress(e){return typeof e!="string"||/^[0-9]{1,20}$/g.test(e)?!1:!(e[0]!==this._prefix||!await this.base58Helper.decodeUnsafe(e.slice(1)))}async createSecondSecretKeypair(e,t){return this.createSecretKeypair(`${e}-${t}`)}async getPublicKeyFromSecondSecret(e,t){return(await this.createSecondSecretKeypair(e,t)).publicKey}async getPublicKeyStringFromSecondSecret(e,t,r="hex"){return(await this.getPublicKeyFromSecondSecret(e,t)).toString(r)}async checkSecondSecret(e,t,r){return await this.getPublicKeyStringFromSecondSecret(e,t)===r}};Te=u([ie(),Ce(0,Z("cryptoHelper")),Ce(1,Z("keypairHelper")),Ce(2,Z("Buffer")),g("design:paramtypes",[Object,Object,Object,ql,ue])],Te);let Le=class{constructor(e,t,r,n,s){this.accountBaseHelper=e,this.configHelper=t,this.ipHelper=r,this.parityBitHelper=n,this.jsbiHelper=s,this.MAX_UINT_32_INTEGER=2**32,this.MAX_INT_32_INTEGER=2**31-1,this.MIN_INT_32_INTEGER=-2147483648,this.isValidSecondPublicKey=this.isValidPublicKey,this.isValidAssetNumber=this.isStringNumber,this.isValidAccountEquity=this.isStringNumber,this.isValidBlockParticipation=this.isStringNumber,this.isValidEquityRate=this.isStringNumber,this.isValidAssetPrealnum=this.isStringNumber}isIp(e){return this.ipHelper.isIp(e)}isIpV4(e){return this.ipHelper.isIpV4(e)}isIpV6(e){return this.ipHelper.isIpV6(e)}isLongitude(e){return/^[\-\+]((0(\.\d{1,10})?)|(([1,9](\d)?)(\.\d{1,10})?)|(1[0-7]\d{1}(\.\d{1,10})?)|(180(\.0{1,10})?))$/.test(e)}isLatitude(e){return/^[\-\+]((0(\.\d{1,10})?)|([1,9](\.\d{1,10})?)|([1-8]\d?(\.\d{1,10})?)|(90(\.0{1,10})?))$/.test(e)}isDNS(e){return/^(?=^.{3,255}$)[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/.test(e)}isEmail(e){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)?["qq.com","163.com","vip.163.com","263.net","yeah.net","sohu.com","sina.cn","sina.com","eyou.com","gmail.com","hotmail.com","42du.cn"].includes(e.substring(e.indexOf("@")+1)):!1}async isValidLocationNameRecord(e){if(!this.isObject(e))return!1;const{recordType:t,recordValue:r}=e;if(t===void 0||r===void 0||!this.isString(r))return!1;if(t===0)return!0;if(t===1)return this.isIpV4(r);if(t===2)return this.isIpV6(r);if(t===3){const n=r.split(",");return n.length!==2?!1:this.isLongitude(n[0])&&this.isLatitude(n[1])}return t===4?await this.accountBaseHelper.isAddress(r):t===5?this.isValidLocationName(r):t===6?this.isDNS(r):t===8?this.isEmail(r):t===7?this.isURL(r):!1}async isValidRange(e,t){if(e!==0&&e!==1&&e!==2&&e!==4||!this.isArray(t))return!1;if(e===0){if(t.length!==0)return!1}else{if(t.length===0)return!1;switch(e){case 1:for(const r of t)if(!await this.accountBaseHelper.isAddress(r))return!1;break;case 2:for(const r of t)if(!this.isValidDAppId(r))return!1;break;case 4:for(const r of t)if(!this.isValidLocationName(r))return!1;break;default:return!1}}return!0}isValidCipherPublicKeys(e){if(!this.isArray(e))return!1;for(const t of e)if(!this.isValidPublicKey(t))return!1;return!0}isValidAccountSignature(e){if(!e||!this.isObject(e))return!1;const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;return!(!(this.isValidPublicKey(t)&&this.isValidSignature(r))||n&&!s||!n&&s||n&&s&&!(this.isValidPublicKey(n)&&this.isValidSignature(s)))}getVariableType(e){return Object.prototype.toString.call(e)}isBoolean(e){return typeof e=="boolean"}isNaturalNumber(e){return Number.isInteger(e)&&e>=0}isUint32(e){return this.isNaturalNumber(e)&&e<this.MAX_UINT_32_INTEGER}isInt32(e){return Number.isInteger(e)&&e<this.MAX_INT_32_INTEGER&&e>this.MIN_INT_32_INTEGER}isNoEmptyUint8Array(e){return e instanceof Uint8Array&&e.length>0}isPositiveInteger(e){return Number.isInteger(e)&&e>0}isPositiveFloatMatchCondition(e,t){let r=e;if(e&&typeof e.denominator=="number"&&typeof e.numerator=="number"){if(e.denominator===0)return!1;r=e.numerator/e.denominator}return Number.isNaN(r)?!1:t(r)}isPositiveFloatContainZero(e){return this.isPositiveFloatMatchCondition(e,t=>t>=0)}isPositiveFloatNotContainZero(e){return this.isPositiveFloatMatchCondition(e,t=>t>0)}isPositiveBigFloatMatchCondition(e,t,r=32){if(!(e&&typeof e.denominator=="string"&&typeof e.numerator=="string"))return!1;const{numerator:n,denominator:s}=e;return this.isStringNumber(n)===!1||n.length>r||this.isPositiveStringNumber(s)===!1||s.length>r?!1:t(e)}isPositiveBigFloatContainZero(e,t=32){return this.isPositiveBigFloatMatchCondition(e,r=>this.jsbiHelper.compareFraction(r,{numerator:0,denominator:888})>=0,t)}isPositiveBigFloatNotContainZero(e,t=32){return this.isPositiveBigFloatMatchCondition(e,r=>this.jsbiHelper.compareFraction(r,{numerator:0,denominator:888})>0,t)}isFraction(e){if(typeof e!="object"||e===null||!(e.numerator&&e.denominator))return!1;try{const t=BigInt(e.denominator),r=BigInt(0);if(t===r)return!1}catch{return!1}return!0}isFiniteBigInt(e){try{return BigInt(e),!0}catch{return!1}}isEmptyObject(e){if(!this.isObject(e))return!1;let t;for(t in e)return!1;return!0}isArrayEqual(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}isValidBufferSize(e,t){if(e instanceof Uint8Array)return e.length===t;if(this.isString(e)&&e.length===t*2)for(let r=0;r<e.length;r+=1){let n=e[r];return n>="0"&&n<="f"}return!1}isValidPublicKey(e){return this.isValidBufferSize(e,32)}isValidSecretKey(e){return this.isValidBufferSize(e,64)}isString(e){return typeof e=="string"}isHexString(e){return typeof e=="string"&&/^[A-F0-9]+$/i.test(e)}isArray(e){return this.getVariableType(e)==="[object Array]"}isObject(e){return this.getVariableType(e)==="[object Object]"}isImage(e){return this.isString(e)}isURL(e){try{if(this.isString(e))return new URL(e).hostname!==""}catch{}return!1}isValidTransactionSignature(e){return this.isValidSignature(e)}isValidBlockSignature(e){return this.isValidSignature(e)}isValidSignature(e){return this.isValidBufferSize(e,64)}isValidAssetChangeHash(e){return this.isValidBufferSize(e,32)}isValidChainOnChainHash(e){return this.isValidBufferSize(e,32)}isValidUpperChainName(e){return this.isString(e)?/^[A-Z0-9]{5,20}$/.test(e):!1}isValidChainName(e){return this.isString(e)?/^[a-z0-9]{5,20}$/.test(e):!1}isValidAssetType(e){return this.isString(e)?/^[A-Z]{3,10}$/.test(e):!1}isValidChainMagic(e){if(!this.isString(e)||!/^[A-Z0-9]{5}$/.test(e))return!1;const t=e.slice(0,4),r=e.slice(4),n=`P_${this.parityBitHelper.calcParityBit(t)}`;return lo[n]===void 0?!1:lo[n].toString()===r}isValidTransactionType(e){if(!this.isString(e))return!1;const t=e.split("-");if(t.length!==4||!this.isValidAssetType(t[0])||!this.isValidUpperChainName(t[1]))return!1;const r=t[2];if(!(r===r.trim().toUpperCase()&&r.length===3))return!1;const n=t[3];return!!(/^[0-9]+$/.test(n)&&n.length===2)}isValidDAppId(e){if(!this.isString(e)||!/^[A-Z0-9]{8}$/.test(e))return!1;const t=e.slice(0,7),r=e.slice(7),n=`P_${this.parityBitHelper.calcParityBit(t)}`;return lo[n]===void 0?!1:lo[n].toString()===r}isMakeUpWithNumber(e){return/^(([0-9])|([1-9](\d)+?))$/.test(e)}isStringNumber(e){return this.isString(e)?this.isMakeUpWithNumber(e):!1}isPositiveStringNumber(e){return this.isStringNumber(e)&&BigInt(e)>BigInt(0)}isValidLocationName(e,t=this.configHelper.chainName){if(!this.isString(e)||e.length>512||this.isStartWithOrEndWithPoint(e))return!1;const r=e.split("."),n=r.length;if(n<2)return!1;for(let s=0;s<n;s++){const i=r[s];if(i.length>128)return!1;if(s===n-2){if(!this.isLowerCaseLetter(i))return!1}else if(s===n-1){if(i!==t)return!1}else if(i.length<=2){if(!this.isLowerCaseLetterOrNumber(i))return!1}else if(!this.isLowerCaseLetterOrNumberOrUnderline(i))return!1}return!0}isValidNumber(e){const t=e.toString();return!(t.length>1&&t.startsWith("0"))}isValidPort(e){return!Number.isNaN(e)&&this.isValidNumber(e)&&e>0&&e<65536}isValidChainPorts(e){return this.isEmptyObject(e)?!1:this.isValidPort(e.port)}isUpperCaseString(e){return this.isString(e)&&e===e.trim().toUpperCase()}isLowerCaseString(e){return this.isString(e)&&e===e.trim().toLowerCase()}isScientificCounting(e){return e.includes(".")||e.includes("e")}isLowerCaseLetter(e){return this.isString(e)&&/^[a-z]+$/.test(e)}isUpperCaseLetter(e){return this.isString(e)&&/^[A-Z]+$/.test(e)}isUpperCaseLetterOrNumber(e){return this.isString(e)&&/^[A-Z0-9]+$/.test(e)}isUpperCaseOrLowerCaseLetter(e){return this.isString(e)&&/^[A-Za-z]+$/.test(e)}isUpperCaseOrLowerCaseLetterOrNumber(e){return this.isString(e)&&/^[A-Za-z0-9]+$/.test(e)}isStartWithOrEndWithPoint(e){return!/^[^\.].*[^\.]$/.test(e)}isLowerCaseLetterOrNumber(e){return/^[a-z0-9]+$/.test(e)}isLowerCaseLetterOrNumberOrUnderline(e){return/^[a-z0-9][a-z0-9_]*[a-z0-9]+$/.test(e)}isValidStakeId(e){return this.isString(e)?/^[a-z0-9]{1,30}$/.test(e):!1}isValidFeeRate(e){if(!e)return!1;const t=e.senderPaidFeeRate,r=e.recipientPaidFeeRate;return!(!this.isPositiveFloatContainZero(t)||!this.isPositiveFloatContainZero(r)||!(t.denominator===1&&r.denominator===1)||!(t.numerator===1&&r.numerator===0||t.numerator===0&&r.numerator===1))}isValidRate(e){if(!e)return!1;const t=e.prevWeight,r=e.nextWeight;try{const n=BigInt(t),s=BigInt(r);return n===BigInt(0)||s===BigInt(0)?!1:typeof r==typeof t}catch{return!1}}isValidAssetExchangeWeightRatio(e){if(!e)return!1;const{toExchangeAssetWeight:t,beExchangeAssetWeight:r}=e;return!(!(this.isStringNumber(e.toExchangeAssetWeight)&&this.isStringNumber(e.beExchangeAssetWeight))||t==="0"||r==="0")}isValidEntityFactoryId(e){return this.isString(e)?/^[a-z0-9]{3,15}$/.test(e):!1}isValidEntityId(e){if(!this.isString(e))return!1;const t=e.split("_");if(t.length!==2&&t.length!==3)return!1;const r=/^[a-z0-9]{3,30}$/;return t.length===3?t[0]!=="m"||!this.isValidEntityFactoryId(t[1])?!1:r.test(t[2]):this.isValidEntityFactoryId(t[0])?r.test(t[1]):!1}isValidTindexRanges(e){const t=e.length;if(t===0||t%2!==0||!this.isNaturalNumber(e[0]))return!1;for(let r=1;r<t;r++)if(!this.isPositiveInteger(e[r]))return!1;return!0}isValidCertificateId(e){if(!this.isString(e)||e.length<3||e.length>100||e.includes(":")===!1)return!1;const t=e.split(":");return t.length!==2||this.isPositiveStringNumber(t[0])===!1?!1:/^[A-Za-z0-9\-_]*$/.test(t[1])}isValidMacroInputName(e){return this.isString(e)===!1?!1:/^\S.{1,30}\S$/.test(e)}};Le=u([ie(),g("design:paramtypes",[Te,ue,Sa,Wl,Lt])],Le);const sw=Symbol("bfchain-core:TransactionFilter"),iw=Symbol("bfchain-core:AbortForbiddenTransaction"),{ArgumentFormatException:Dg,ArgumentIllegalException:M_,NoFoundException:ow}=le("HELPER","transactionHelper");let we=class{constructor(e,t,r,n,s,i,o,a){this.config=e,this.baseHelper=t,this.jsbiHelper=r,this.cryptoHelper=n,this.keypairHelper=s,this.Buffer=i,this.asymmetricHelper=o,this.accountBaseHelper=a,this.ALL_TRANSACTION_TYPES=[this.SIGNATURE,this.DAPP,this.DAPP_PURCHASING,this.REGISTER_CHAIN,this.MARK,this.ISSUE_ASSET,this.INCREASE_ASSET,this.DESTROY_ASSET,this.TRANSFER_ASSET,this.TO_EXCHANGE_ASSET,this.BE_EXCHANGE_ASSET,this.GIFT_ASSET,this.GRAB_ASSET,this.TRUST_ASSET,this.SIGN_FOR_ASSET,this.EMIGRATE_ASSET,this.IMMIGRATE_ASSET,this.LOCATION_NAME,this.SET_LNS_RECORD_VALUE,this.SET_LNS_MANAGER,this.ISSUE_ENTITY_FACTORY,this.ISSUE_ENTITY,this.DESTROY_ENTITY,this.ISSUE_ENTITY_MULTI,this.TRANSFER_ANY,this.GIFT_ANY,this.GRAB_ANY,this.TO_EXCHANGE_ANY,this.BE_EXCHANGE_ANY,this.TO_EXCHANGE_ANY_MULTI,this.BE_EXCHANGE_ANY_MULTI,this.TO_EXCHANGE_ANY_MULTI_ALL,this.BE_EXCHANGE_ANY_MULTI_ALL,this.ISSUE_CERTIFICATE,this.DESTROY_CERTIFICATE,this.MULTIPLE,this.PROMISE,this.PROMISE_RESOLVE,this.MACRO,this.MACRO_CALL],this.abortForbiddenTransaction=!0}get _ASSETTYPE(){return this.config.assetType}get _CHAIN_NAME(){return this.config.chainName.toUpperCase()}parseType(e){const t=e.indexOf("-"),r=e.indexOf("-",t+1),n=e.substr(r+1);return{assetType:e.substr(0,t),chainName:e.substring(t+1,r),baseType:n}}resolveType(e){return`${e.assetType}-${e.chainName}-${e.baseType}`}getTypeName(e){const{baseType:t}=this.parseType(e);return this.getTypeNameByBaseType(t)}getTypeNameByBaseType(e){return Me.VK.get(e)}getTransactionType(e){return`${this._ASSETTYPE}-${this._CHAIN_NAME}-${e}`}isValidType(e){return this.baseHelper.isValidTransactionType(e)}async generateSignature(e){return iy(await this.cryptoHelper.sha256(e.getBytes(!0,!0)))}isValidTransactionSignature(e){return this.baseHelper.isValidTransactionSignature(e)}get SIGNATURE(){return this.getTransactionType(W.SIGNATURE)}get DAPP(){return this.getTransactionType(W.DAPP)}get DAPP_PURCHASING(){return this.getTransactionType(W.DAPP_PURCHASING)}get REGISTER_CHAIN(){return this.getTransactionType(W.REGISTER_CHAIN)}get MARK(){return this.getTransactionType(W.MARK)}get ISSUE_ASSET(){return this.getTransactionType(W.ISSUE_ASSET)}get INCREASE_ASSET(){return this.getTransactionType(W.INCREASE_ASSET)}get DESTROY_ASSET(){return this.getTransactionType(W.DESTROY_ASSET)}get TRANSFER_ASSET(){return this.getTransactionType(W.TRANSFER_ASSET)}get GIFT_ASSET(){return this.getTransactionType(W.GIFT_ASSET)}get GRAB_ASSET(){return this.getTransactionType(W.GRAB_ASSET)}get TRUST_ASSET(){return this.getTransactionType(W.TRUST_ASSET)}get SIGN_FOR_ASSET(){return this.getTransactionType(W.SIGN_FOR_ASSET)}get EMIGRATE_ASSET(){return this.getTransactionType(W.EMIGRATE_ASSET)}get IMMIGRATE_ASSET(){return this.getTransactionType(W.IMMIGRATE_ASSET)}get TO_EXCHANGE_ASSET(){return this.getTransactionType(W.TO_EXCHANGE_ASSET)}get BE_EXCHANGE_ASSET(){return this.getTransactionType(W.BE_EXCHANGE_ASSET)}get STAKE_ASSET(){return this.getTransactionType(W.STAKE_ASSET)}get UNSTAKE_ASSET(){return this.getTransactionType(W.UNSTAKE_ASSET)}get LOCATION_NAME(){return this.getTransactionType(W.LOCATION_NAME)}get SET_LNS_RECORD_VALUE(){return this.getTransactionType(W.SET_LNS_RECORD_VALUE)}get SET_LNS_MANAGER(){return this.getTransactionType(W.SET_LNS_MANAGER)}get ISSUE_ENTITY_FACTORY(){return this.getTransactionType(W.ISSUE_ENTITY_FACTORY)}get ISSUE_ENTITY_FACTORY_V1(){return this.getTransactionType(W.ISSUE_ENTITY_FACTORY_V1)}get ISSUE_ENTITY(){return this.getTransactionType(W.ISSUE_ENTITY)}get DESTROY_ENTITY(){return this.getTransactionType(W.DESTROY_ENTITY)}get ISSUE_ENTITY_MULTI(){return this.getTransactionType(W.ISSUE_ENTITY_MULTI)}get TRANSFER_ANY(){return this.getTransactionType(W.TRANSFER_ANY)}get GIFT_ANY(){return this.getTransactionType(W.GIFT_ANY)}get GRAB_ANY(){return this.getTransactionType(W.GRAB_ANY)}get TO_EXCHANGE_ANY(){return this.getTransactionType(W.TO_EXCHANGE_ANY)}get BE_EXCHANGE_ANY(){return this.getTransactionType(W.BE_EXCHANGE_ANY)}get TO_EXCHANGE_ANY_MULTI(){return this.getTransactionType(W.TO_EXCHANGE_ANY_MULTI)}get BE_EXCHANGE_ANY_MULTI(){return this.getTransactionType(W.BE_EXCHANGE_ANY_MULTI)}get TO_EXCHANGE_ANY_MULTI_ALL(){return this.getTransactionType(W.TO_EXCHANGE_ANY_MULTI_ALL)}get BE_EXCHANGE_ANY_MULTI_ALL(){return this.getTransactionType(W.BE_EXCHANGE_ANY_MULTI_ALL)}get ISSUE_CERTIFICATE(){return this.getTransactionType(W.ISSUE_CERTIFICATE)}get DESTROY_CERTIFICATE(){return this.getTransactionType(W.DESTROY_CERTIFICATE)}get MULTIPLE(){return this.getTransactionType(W.MULTIPLE)}get PROMISE(){return this.getTransactionType(W.PROMISE)}get PROMISE_RESOLVE(){return this.getTransactionType(W.PROMISE_RESOLVE)}get MACRO(){return this.getTransactionType(W.MACRO)}get MACRO_CALL(){return this.getTransactionType(W.MACRO_CALL)}genesisGenerators(e=this.config){const t=e.genesisBlock.transactionInfo.transactionInBlocks.filter(r=>r.transaction.type===this.ISSUE_ENTITY).map(r=>r.transaction.senderId);return[...new Set(t)]}async getGensisAcountAddress(e=this.config){return this.accountBaseHelper.getAddressFromPublicKeyString(e.genesisAccountPublicKey)}async verifyTransactionSignature(e,t){const r=t&&t.taskLabel||"Transaction",{signSignatureBuffer:n,signatureBuffer:s,senderSecondPublicKeyBuffer:i,senderPublicKeyBuffer:o}=e,a=await this.cryptoHelper.sha256().update(e.getBytes(!0,!0)).digest();if(!await this.keypairHelper.detached_verify(a,s,o))throw new Dg(c.INVALID_SIGNATURE,{taskLabel:r});if(i&&i.length>0||n&&n.length>0)if(i&&n){const p=await this.cryptoHelper.sha256().update(e.getBytes(!1,!0)).digest();if(!await this.keypairHelper.detached_verify(p,n,i))throw new Dg(c.INVALID_SIGNSIGNATURE,{taskLabel:r})}else throw new Dg(`Invalid ${r} miss signSignature or senderSecondPublicKey`)}verifyTransactionSize(e){const{maxTransactionSize:t}=this.config,r=e.getBytes().length;if(r>t)throw new M_(c.PROP_SHOULD_LTE_FIELD,{prop:`transaction size ${r}`,target:"transaction",field:t})}verifyTransactionBlobSize(e){const{maxTransactionBlobSize:t}=this.config,r=e.getBlobSize(!0);if(r>t)throw new M_(c.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${r}`,target:"transaction",field:t})}__calcStandardMinFee(e){const t=this.config.minTransactionFeePerByte;return e?this.jsbiHelper.compareFraction(t,e)>=0?t:e:t}calcMinFeePerBytes(e,t,r=this.config.minTransactionFeePerByte){let n=t,s=e;do{const i=this.jsbiHelper.multiplyCeilFraction(n,r).toString();if(i.length===s.length)return i;n+=i.length-s.length,s=i}while(!0)}calcTransactionMinFeeByBytes(e,t,r){return BigInt(this.calcMinFeePerBytes(e.fee,t||e.getBytes().length,this.__calcStandardMinFee(r)))}calcTransactionMinFeeByMaxBytes(e,t){return this.jsbiHelper.multiplyCeilFraction(this.config.maxTransactionSize,this.__calcStandardMinFee(t))*BigInt(e)}calcTransactionMinFeeByMulti(e,t,r,n){const s=this.calcMinFeePerBytes(e.fee,r||e.getBytes().length,this.__calcStandardMinFee(n));return BigInt(s)*BigInt(t)}calcTransactionBlobFee(e,t){const r=e.getBlobSize(!0);if(r===0)return BigInt(0);const n=this.calcMinFeePerBytes(e.fee,r,this.__calcStandardMinFee(t));return this.jsbiHelper.multiplyCeilFraction(BigInt(n),this.config.blobFeeMultipleRatio)}calcTransactionMinFee(e,t,r){const n=e.type;if(n===this.GIFT_ASSET){const s=e.asset.giftAsset.totalGrabableTimes+1;return(this.calcTransactionMinFeeByMaxBytes(s,r)+this.calcTransactionBlobFee(e,r)).toString()}if(n===this.GIFT_ANY){const s=e.asset.giftAny.totalGrabableTimes+1;return(this.calcTransactionMinFeeByMaxBytes(s,r)+this.calcTransactionBlobFee(e,r)).toString()}if(n===this.TRUST_ASSET){const s=e.asset.trustAsset.numberOfSignFor+1;return(this.calcTransactionMinFeeByMaxBytes(s,r)+this.calcTransactionBlobFee(e,r)).toString()}return n===this.ISSUE_ENTITY_MULTI?(this.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length,void 0,r)+this.calcTransactionBlobFee(e,r)).toString():n==this.TO_EXCHANGE_ANY_MULTI?(this.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.calcTransactionBlobFee(e,r)).toString():n===this.BE_EXCHANGE_ANY_MULTI?(this.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.calcTransactionBlobFee(e,r)).toString():n===this.GRAB_ASSET||n===this.GRAB_ANY||n===this.SIGN_FOR_ASSET?this.calcTransactionBlobFee(e,r):(this.calcTransactionMinFeeByBytes(e,t,r)+this.calcTransactionBlobFee(e,r)).toString()}calcTransactionFee(e,t=this.config.minTransactionFeePerByte){return this.calcMinFeePerBytes(e.fee,e.getBytes().length,t)}hashCode(e){let t=0,r=0;const n=e.length;for(;r<n;)t=(t<<5)-t+e.charCodeAt(r++)<<0;return Math.abs(t)}async calcGrabRandomGiftAssetNumber(e,t,r,n,s,i){const o=BigInt(s);if(i===1)return o;const{jsbiHelper:a}=this,p=BigInt(0),l=BigInt(this.config.miniUnit),h=o/BigInt(i);if(h===p)return l;const y=BigInt(`0x${await this.cryptoHelper.md5().update(e).update(t).update(r).update(n).digest("hex")}`),A=a.multiplyFloorFractionString(s,{numerator:y,denominator:BigInt(2)**BigInt(128)});if(A<l)return l;const _=h*BigInt(2);if(A<=_)return A;let E=A%_;return A>_*BigInt(2)&&E<=h&&(E+=h),E}async calcGrabRecipientRandomGiftAssetNumber(e,t,r,n,s,i){const o=new Map;let a=BigInt(0);for(const l of s){const h=BigInt(`0x${(await this.cryptoHelper.md5().update(t).update(r).update(n).update(l).digest("hex")).substr(0,16)}`);a=a+h,o.set(l,h)}const p=o.get(e);if(!p)throw new ow(c.NOT_EXIST,{prop:`grabId(${e})`,target:"giftTransactionRecipient"});return p*BigInt(i)/a}calcGrabAverageGiftAssetNumber(e,t){const r=BigInt(e),n=BigInt(this.config.miniUnit);if(t===1)return r;const s=BigInt(0),i=r/BigInt(t);return i===s?n:i}async calcGrabGiftAssetNumber(e,t,r){const n=t.asset.giftAsset;switch(n.giftDistributionRule){case 0:return this.calcGrabAverageGiftAssetNumber(n.amount,n.totalGrabableTimes);case 1:return await this.calcGrabRandomGiftAssetNumber(e,r,t.signatureBuffer,t.senderId,n.amount,n.totalGrabableTimes);case 2:return await this.calcGrabRandomGiftAssetNumber(e,r,t.signatureBuffer,t.senderId,n.amount,n.totalGrabableTimes)}}async calcGrabbedAssetNumber(e,t,r,n,s,i,o){switch(o){case 0:return this.calcGrabAverageGiftAssetNumber(s,i);case 1:return await this.calcGrabRandomGiftAssetNumber(e,be(t),be(r),n,s,i);case 2:return this.calcGrabRandomGiftAssetNumber(e,be(t),be(r),n,s,i)}}async generateGrabAsset(e,t,r){const n=await this.accountBaseHelper.createSecretKeypair(r.mainSecret),s=e.asset.giftAsset,{grabId:i=await this.accountBaseHelper.getAddressFromPublicKey(n.publicKey),grabSecret:o}=r,a=e.signatureBuffer;let p;o&&(p=bt.fromObject({signatureBuffer:await this.getCiphertextSignature({secret:o,transactionSignatureBuffer:a,senderId:i}),publicKeyBuffer:n.publicKey}));const l=qn.fromObject({blockSignatureBuffer:t,transactionSignatureBuffer:a,giftAsset:s,ciphertextSignature:p});return l.amount=(await this.calcGrabGiftAssetNumber(i,e,t)).toString(),l}async getCiphertextSignature(e){return this.asymmetricHelper.detachedSign(await this.cryptoHelper.sha256().update(e.transactionSignatureBuffer).update(e.senderId).digest(),(await this.accountBaseHelper.createSecretKeypair(e.secret)).secretKey)}async verifyCiphertextSignature(e){return this.asymmetricHelper.detachedVeriy(await this.cryptoHelper.sha256().update(e.transactionSignatureBuffer).update(e.senderId).digest(),e.ciphertextSignatureBuffer,e.secretPublicKey)}getTransactionMaxEffectiveHeight(e){let t=e.effectiveBlockHeight;return(e instanceof Ao||e instanceof Eo||e instanceof _o)&&(t=Number.MAX_SAFE_INTEGER),t}getTransactionMinEffectiveHeight(e){let t=e.applyBlockHeight;if(e instanceof mo){const r=e.asset.giftAsset.beginUnfrozenBlockHeight;r&&(t=r)}else if(e instanceof Io){const r=e.asset.giftAny.beginUnfrozenBlockHeight;r&&(t=r)}else e instanceof _o&&(t=e.asset.stakeAsset.beginUnstakeHeight);return t}isTransactionInFilter(e){return!(this.transactionFilter&&!this.transactionFilter.includes(e))}calcTransactionQueryRange(e,t=this.config){const r=e-t.maxApplyAndConfirmedBlockHeightDiff;return{startHeight:r<=0?1:r,endHeight:e-1}}calcTransactionQueryRangeByApplyBlockHeight(e,t){return{startHeight:e,endHeight:t-1}}getFactoryIdByEntityId(e){const t=e.split("_");return t.length>2?t[1]:t[0]}calcDestroyMainAssetsOfIsseuEntityFactory(e,t=this.config){const r=this.jsbiHelper,n=r.divisionFraction({numerator:e,denominator:"1"},t.maxMultipleOfEntityAndMainAsset);return r.multiplyCeilFraction(UE,n).toString()}tIndexRangesToTindexes(e){let t=e[0];const r=[t];for(let n=1;n<e.length;n++)if(n%2===1)for(let s=0;s<e[n]-1;s++)r[r.length]=++t;else t+=e[n]+1,r[r.length]=t;return r}tIndexRangesToStartAndEndTindex(e){let t=e[0];const r=[t];t+=e[1],r.push(t-1);for(let n=2;n<e.length;n+=2)t+=e[n],r.push(t),t+=e[n+1],r.push(t-1);return r}getStakeSaveId(e,t){return`${t}_${e}`}};u([Z(sw,{optional:!0}),g("design:type",Array)],we.prototype,"transactionFilter",void 0);u([Z(iw,{dynamics:!0}),g("design:type",Object)],we.prototype,"abortForbiddenTransaction",void 0);we=u([ie(),Ce(3,Z("cryptoHelper")),Ce(4,Z("keypairHelper")),Ce(5,Z("Buffer")),g("design:paramtypes",[ue,Le,Lt,Object,Object,Object,Fr,Te])],we);const{NoFoundException:aw,ArgumentIllegalException:Fg,RefuseException:Il}=le("helper","blobHelper");let Ki=class{constructor(e){this.timeHelper=e}support(e,t="readwrite"){let r=!0;return e==="SHA256"?(t.includes("read")&&(r=r&&this.blobSha256Reader!==void 0),t.includes("write")&&(r=r&&this.blobSha256Writer!==void 0)):r=!1,r}supportAlgorithms(e){const t=new Set;for(const r of["SHA256"])this.support(r,e)&&t.add(r);return t}async exists(e){const{blobSha256Reader:t}=this;return!t||e.algorithm!=="SHA256"?!1:t.has(e.hash)}async open(e){const{blobSha256Reader:t}=this;if(t===void 0)throw new aw(c.PARAM_LOST,{param:"blobSha256Reader"});const{hash:r,algorithm:n}=e;if(n!=="SHA256")throw new Fg(c.BLOB_ALGORITHM_IS_INVALID,{hash:r,algorithm:n});return await t.open(r)}async read(e){const{blobSha256Reader:t}=this;if(t===void 0)throw new Fg(c.PARAM_LOST,{param:"blobSha256Reader"});return{chunkBuffer:await t.read(e.descriptor,e.start,e.end)}}async close(e){const{blobSha256Reader:t}=this;if(t===void 0)throw new Fg(c.PARAM_LOST,{param:"blobSha256Reader"});return await t.close(e.descriptor)}requestStorage(e,t,r,n,s){const{blobSha256Writer:i}=this;if(!i)throw new Il(c.PARAM_LOST,{param:"blobSha256Writer"});return i.requestStorage(e,t,r,n,s)}saveChunk(e,t,r){const{blobSha256Writer:n}=this;if(!n)throw new Il(c.PARAM_LOST,{param:"blobSha256Writer"});return n.saveChunk(e,t,r)}saveAsBlob(e){const{blobSha256Writer:t}=this;if(!t)throw new Il(c.PARAM_LOST,{param:"blobSha256Writer"});return t.saveAsBlob(e)}changeBlobStrategy(e,t){const{blobSha256Writer:r}=this;if(!r)throw new Il(c.PARAM_LOST,{param:"blobSha256Writer"});return r.changeBlobStrategy(e,t)}};u([Z("blobSha256Reader",{optional:!0}),g("design:type",Object)],Ki.prototype,"blobSha256Reader",void 0);u([Z("blobSha256Writer",{optional:!0}),g("design:type",Object)],Ki.prototype,"blobSha256Writer",void 0);Ki=u([ie(),g("design:paramtypes",[Yt])],Ki);class cw{constructor(t,r,n){this.chainName=t,this.magic=r,this.assetType=n}}const L_=new Map,D_=new WeakSet;let Ge=class{isChainAssetInfo(e){return D_.has(e)}getAssetInfo(e,t,r){const n=e+":"+t+":"+r;let s=L_.get(n);return s||(s=new cw(e,t,r),Object.freeze(s),L_.set(n,s),D_.add(s)),s}};Ge=u([ie()],Ge);var Rf,vf;le("helper-block_base_statistics","blockBaseStatisticsHelper");let ni=Rf=class{constructor(e,t,r,n){this.transactionHelper=e,this.chainAssetInfo=t,this.config=r,this.moduleMap=n,this._block_statistics_m=new Map}getConfig(){return this.tempConfig||this.config}forceGetStatisticsInfoByBlock(e,t,r,n){let s=this._block_statistics_m.get(e);return s||(s=Ht($h,new et([[$h.SOURCE_DATA_SYMBOL,r]],this.moduleMap)),s.on("destroy",()=>{this._block_statistics_m.delete(e)}),this._block_statistics_m.set(e,s)),s.ref(t),n&&(this.tempConfig=n,s.on("destroy",()=>{this._block_statistics_m.delete(e),this.tempConfig=void 0})),s}getStatisticsInfoByBlock(e){return this._block_statistics_m.get(e)}_applyFee(e,t){const{applyInfo:r,transaction:n}=e,{address:s,assetInfo:i}=r,o=BigInt(r.sourceAmount),{baseType:a}=this.transactionHelper.parseType(n.type),p=t.initAssetStatistic(i);p.total.changeAmount=(BigInt(p.total.changeAmount)+o).toString(),p.total.moveAmount=(BigInt(p.total.moveAmount)+o).toString(),p.total.changeCount+=1;const l=n.signature;t.subIdMap.has(l)||(p.total.transactionCount+=1,t.subIdMap.set(l,!0));const h=t.initTypeStatistic(i,a);t.totalFee=t.totalFee+o,t.totalAsset=t.totalAsset+o,t.totalChainAsset=t.totalChainAsset+o,t.addTotalAccount(s),h.changeAmount=(BigInt(h.changeAmount)+o).toString(),h.changeCount+=1,h.moveAmount=(BigInt(h.moveAmount)+o).toString(),t.typeSubIdMap.has(l)||(h.transactionCount+=1,t.typeSubIdMap.set(l,!0))}_applyAsset(e,t,r=!1){const{applyInfo:n,transaction:s}=e,{type:i}=s,o=BigInt(n.sourceAmount),{baseType:a}=this.transactionHelper.parseType(i),p=t.initAssetStatistic(n.assetInfo),l=t.initTypeStatistic(n.assetInfo,a);p.total.changeAmount=(BigInt(p.total.changeAmount)+o).toString(),p.total.changeCount+=1;const h=s.signature;if(t.subIdMap.has(h)||(p.total.transactionCount+=1,t.subIdMap.set(h,!0)),l.changeAmount=(BigInt(l.changeAmount)+o).toString(),l.changeCount+=1,t.typeSubIdMap.has(h)||(l.transactionCount+=1,t.typeSubIdMap.set(h,!0)),n.amount.startsWith("-")||r){p.total.moveAmount=(BigInt(p.total.moveAmount)+o).toString(),t.totalAsset=t.totalAsset+o;const{assetInfo:y}=n,A=this.getConfig();y.assetType===A.assetType&&y.magic===A.magic&&(t.totalChainAsset=t.totalChainAsset+o),l.moveAmount=(BigInt(l.moveAmount)+o).toString()}t.addTotalAccount(n.address)}_applyCount(e,t){const{transaction:r}=e,{baseType:n}=this.transactionHelper.parseType(r.type),s=t.numberOfTransactions;s[n]?s[n]++:s[n]=1}bindApplyTransactionEventEmiter(e,t){const r=Rf.eventEmitterStatisticsWM.forceGet(e);if(!r.has(t))return r.add(t),e.on("fee",(n,s)=>(this._applyFee(n,t),s()),{taskname:"applyTransaction/blockStatistic/fee"}),e.on("feeFromUnfrozen",(n,s)=>(this._applyFee(n,t),s()),{taskname:"applyTransaction/blockStatistic/feeFromUnfrozen"}),e.on("asset",(n,s)=>(this._applyAsset(n,t),s()),{taskname:"applyTransaction/blockStatistic/asset"}),e.on("frozenAsset",(n,s)=>(this._applyAsset(n,t),s()),{taskname:"applyTransaction/blockStatistic/frozenAsset"}),e.on("unfrozenAsset",(n,s)=>(this._applyAsset(n,t,!0),s()),{taskname:"applyTransaction/blockStatistic/unfrozenAsset"}),e.on("issueAsset",(n,s)=>(this._applyAsset(n,t,!0),s()),{taskname:"applyTransaction/blockStatistic/issueAsset"}),e.on("count",(n,s)=>(this._applyCount(n,t),s())),!0}};ni.eventEmitterStatisticsWM=new As(e=>new WeakSet);ni=Rf=u([ie("bfchain-core:BlockBaseStatistics"),g("design:paramtypes",[we,Ge,ue,et])],ni);let $h=vf=class extends Rn{constructor(e=dn.fromObject({}),t){super(),this.source_data=e,this.chainAssetInfoHelper=t,this.subIdMap=new Map,this.typeSubIdMap=new Map,this._accountAddressSet=new Set,this._souce_data_totalAccount=this.source_data.totalAccount,this._reasonSet=new Set}get totalFee(){return this._totalFee||(this._totalFee=BigInt(this.source_data.totalFee))}set totalFee(e){this._totalFee=e}get totalAsset(){return this._totalAsset||(this._totalAsset=BigInt(this.source_data.totalAsset))}set totalAsset(e){this._totalAsset=e}get totalChainAsset(){return this._totalChainAsset||(this._totalChainAsset=BigInt(this.source_data.totalChainAsset))}set totalChainAsset(e){this._totalChainAsset=e}get numberOfTransactions(){return this._numberOfTransactions||(this._numberOfTransactions=this.source_data.numberOfTransactionsHashMap)}get totalAccount(){return this.source_data.totalAccount}addTotalAccount(e){return this._accountAddressSet.add(e),this.source_data.totalAccount=this._souce_data_totalAccount+this._accountAddressSet.size}getAssetTypeTypeStatisticMap(e){let t=this.source_data.magicAssetTypeTypeStatisticMap.get(e);return t||(t=No.fromObject({}),this.source_data.magicAssetTypeTypeStatisticMap.set(e,t)),t.assetTypeTypeStatisticMap}__initAssetStatistic(){return So.fromObject({typeStatisticHashMap:{},total:{changeAmount:"0",changeCount:0,moveAmount:"0",transactionCount:0}})}getAssetStatistic(e){const{magic:t,assetType:r}=e,n=this.getAssetTypeTypeStatisticMap(t);let s=n.get(r);return s||(s=this.__initAssetStatistic(),n.set(r,s)),s}setAssetStatistic(e,t){const{magic:r,assetType:n}=e;let s=this.source_data.magicAssetTypeTypeStatisticMap.get(r);return s||(s=No.fromObject({}),this.source_data.magicAssetTypeTypeStatisticMap.set(r,s)),s.assetTypeTypeStatisticMap.set(n,t),this}initAssetStatistic(e){const{magic:t,assetType:r}=e,n=this.getAssetTypeTypeStatisticMap(t);let s=n.get(r);return s||(s=this.__initAssetStatistic(),n.set(r,s)),s}__initTypeStatistic(){return ss.fromObject({changeAmount:"0",changeCount:0,moveAmount:"0",transactionCount:0})}getTypeStatistic(e,t){let r=this.getAssetStatistic(e).typeStatisticMap.get(t);return r||(r=this.__initTypeStatistic()),r}setTypeStatistic(e,t,r){return this.getAssetStatistic(e).typeStatisticMap.set(t,r),this}initTypeStatistic(e,t){const r=this.getAssetStatistic(e);let n=r.typeStatisticMap.get(t);return n||(n=this.__initTypeStatistic(),r.typeStatisticMap.set(t,n)),n}ref(e){this._reasonSet.add(e)}unref(e){this._reasonSet.delete(e),this._reasonSet.size===0&&this.emit("destroy")}toModel(){return this._totalFee&&(this.source_data.totalFee=this._totalFee.toString()),this._totalAsset&&(this.source_data.totalAsset=this._totalAsset.toString()),this._totalChainAsset&&(this.source_data.totalChainAsset=this._totalChainAsset.toString()),this.source_data.format()}};$h.SOURCE_DATA_SYMBOL=Symbol("source-data");$h=vf=u([ie(),Ce(0,Z(vf.SOURCE_DATA_SYMBOL,{optional:!0})),g("design:paramtypes",[Object,Ge])],$h);const{ArgumentFormatException:yi,NoFoundException:eo,ArgumentIllegalException:HN,OutOfRangeException:pw,IllegalStateException:hw,ConsensusException:lw}=le("HELPER","blockHelper");let wt=class{constructor(e,t,r,n,s,i,o){this.config=e,this.baseHelper=t,this.accountBaseHelper=r,this.jsbiHelper=n,this.cryptoHelper=s,this.keypairHelper=i,this.Buffer=o,this._BTC_BLOCK_WM=new WeakMap,this._BLOCK_BTC_WM=new WeakMap}async generateSignature(e){return iy(await this.cryptoHelper.sha256(e.getBytes(!0,!0)))}isValidSignature(e){return this.baseHelper.isValidSignature(e)}async verifyBlockSignature(e,t){const r=t&&t.taskLabel||"Block",{Buffer:n}=this,{generatorPublicKeyBuffer:s,signatureBuffer:i,generatorSecondPublicKeyBuffer:o,signSignatureBuffer:a}=e,p=await this.cryptoHelper.sha256(e.getBytes(!0,!0,!0));if(!await this.keypairHelper.detached_verify(p,i,s))throw new yi(c.INVALID_SIGNATURE,{taskLabel:r});if(o&&o.length>0||a&&a.length>0)if(o&&a){const l=await this.cryptoHelper.sha256().update(e.getBytes(!1,!0,!0)).digest();if(!this.keypairHelper.detached_verify(l,n.from(a),n.from(o)))throw new yi(c.INVALID_SIGNSIGNATURE,{taskLabel:r})}else throw new yi(`Invalid ${r} miss signSignature or senderSecondPublicKey`)}verifyBlockVersion(e,t=this.config){if(e.version>t.version)throw new lw(c.NOT_MATCH,{to_compare_prop:`block version ${e.version}`,be_compare_prop:`blockChain version ${t.version}`,to_target:"block",be_target:"config"})}parseTypeByHeight(e){return e===1?er.GENESIS:e%this.config.blockPerRound===0?er.ROUNDEND:er.COMMON}calcRoundByHeight(e){return Math.ceil(e/this.config.blockPerRound)}calcBlockNumberToRoundEnd(e){return this.config.blockPerRound-(e%this.config.blockPerRound||this.config.blockPerRound)}calcRoundStartHeight(e){return(e-1)*this.config.blockPerRound+1}calcRoundEndHeight(e){return e*this.config.blockPerRound}calcRoundStartHeightByHeight(e){const t=this.calcRoundByHeight(e);return this.calcRoundStartHeight(t)}calcRoundEndHeightByHeight(e){const t=this.calcRoundByHeight(e);return this.calcRoundEndHeight(t)}calcBlockChainRoundByHeight(e){return this.calcRoundByHeight(e+1)}isRoundLastBlock(e){return e%this.config.blockPerRound===0}isRoundChange(e,t){return this.calcRoundByHeight(e)===this.calcRoundByHeight(t)}async forceGetBlockByHeight(e,t=this.blockGetterHelper){if(!t)throw new eo(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=await t.getBlockByHeight(e);if(!r)throw new yi(c.NOT_EXIST,{prop:`height:${e}`,target:"blocks"});return r}async forceGetBlockBySignature(e,t=this.blockGetterHelper){if(!t)throw new eo(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=await t.getBlockBySignature(e);if(!r)throw new yi(c.NOT_EXIST,{prop:`signature: ${e}`,target:"blockChain"});return r}async forceGetBlockListByHeightRange(e,t,r=this.blockGetterHelper){const n=[];if(e>t)throw new pw(c.OUT_OF_RANGE,{variable:"min and max",message:`min: ${e} max: ${t}`});for(let s=e;s<=t;s++)n[n.length]=await this.forceGetBlockByHeight(s,r);return n}async forceGetBlockGeneratorAddressByHeight(e,t=this.blockGetterHelper){if(!t)throw new eo(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=typeof t.getBlockGeneratorPublicKeyBufferByHeight=="function"?await t.getBlockGeneratorPublicKeyBufferByHeight(e):(await this.forceGetBlockByHeight(e,t)).generatorPublicKeyBuffer;if(!r)throw new yi(c.NOT_EXIST,{prop:`height:${e}`,target:"generatorPublicKey"});return this.accountBaseHelper.getAddressFromPublicKey(r)}async forceGetBlockSignatureBufferByHeight(e,t=this.blockGetterHelper){if(!t)throw new eo(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=typeof t.getBlockSignatureByHeight=="function"?await t.getBlockSignatureByHeight(e):(await this.forceGetBlockByHeight(e,t)).signatureBuffer;if(!r)throw new yi(c.NOT_EXIST,{prop:`height:${e}`,target:"generatorPublicKey"});return r}async forceGetBlockSignatureByHeight(e,t=this.blockGetterHelper){return Pe(await this.forceGetBlockSignatureBufferByHeight(e,t))}async getLastBlock(e=this.blockGetterHelper){if(!e)throw new eo(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});return e.getLastBlock()}async getBlocksByRange(e,t,r=this.blockGetterHelper){if(!r)throw new eo(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});if(!("getBlockByHeight"in r))return r.getBlocksByRange(e,t);if("getBlockByHeight"in r){const n=[];for(let s=e;s<t;s++){const i=await r.getBlockByHeight(s);if(!i)break;n.push(i)}return n}throw new hw(c.FAILED_TO_GET_BLOCKS_BY_RANGE,{minHeight:e,maxHeight:t})}async getCurrentGenerateBlock(e=this.blockGetterHelper){if(e&&e.getCurrentGenerateBlock)return e.getCurrentGenerateBlock()}async getCurrentReplayingBlockInfo(e=this.blockGetterHelper){if(e&&e.getCurrentReplayingBlockInfo)return e.getCurrentReplayingBlockInfo()}async getCurrentProcessingBlockPlotChecker(e=this.blockGetterHelper){const t=await this.getCurrentGenerateBlock();if(t)return this.parseNewBlockToPlotChecker(t);const r=await this.getCurrentReplayingBlockInfo(e);if(r)return this.parseBlockToPlotChecker(r.replayingBlock||r.currentBlock)}parseBlockToPlotChecker(e){let t=this._BLOCK_BTC_WM.get(e);return t||(t={height:e.height,timestamp:e.timestamp,numberOfTransactions:e.numberOfTransactions,get totalFee(){return Object.defineProperty(this,"totalFee",{value:BigInt(e.totalFee)}),this.totalFee},signature:e.signature,previousBlockSignature:e.previousBlockSignature},this._BLOCK_BTC_WM.set(e,t),this._BTC_BLOCK_WM.set(t,e)),t}getBlockFromPlotChecker(e){return this._BTC_BLOCK_WM.get(e)}parseNewBlockToPlotChecker(e){return{height:e.height,timestamp:e.timestamp,numberOfTransactions:e.numberOfTransactions,get totalFee(){return Object.defineProperty(this,"totalFee",{value:BigInt(e.totalFee)}),this.totalFee},signature:"signature"in e?e.signature:"ff".repeat(64),previousBlockSignature:e.previousBlockSignature}}parseBlockPlotCheckerListToPlotChecker(e){const t=e[0],r=e[e.length-1];return{height:r.height,timestamp:r.timestamp,get numberOfTransactions(){return Object.defineProperty(this,"numberOfTransactions",{value:e.reduce((n,s)=>n+s.numberOfTransactions,0)}),this.numberOfTransactions},get totalFee(){return Object.defineProperty(this,"totalFee",{value:e.reduce((n,s)=>n+s.totalFee,BigInt(0))}),this.totalFee},get signature(){return Object.defineProperty(this,"signature",{value:e.reduce((n,s)=>n+s.signature,"")}),this.signature},previousBlockSignature:t.previousBlockSignature}}async forceGetBlockGeneratorAddressByRound(e,t=this.blockGetterHelper){if(!t)throw new eo(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=(e-1)*this.config.blockPerRound+1,n=e*this.config.blockPerRound,s=[];for(let i=r;i<=n;i++){const o=typeof t.getBlockGeneratorPublicKeyBufferByHeight=="function"?await t.getBlockGeneratorPublicKeyBufferByHeight(i):(await this.forceGetBlockByHeight(i,t)).generatorPublicKeyBuffer;if(!o)throw new yi(c.NOT_EXIST,{prop:`height:${i}`,target:"generatorPublicKey"});const a=await this.accountBaseHelper.getAddressFromPublicKey(o);s.includes(a)||s.push(a)}return s}async calcAssetChangeHash(e,t="utf-8"){const r=[];for(const s in e){const i=e[s];for(const o in i){const a=i[o];for(const p in a)r.push(`${s}-${o}-${p}-${a[p]}`)}}if(r.sort((s,i)=>s>i?1:-1),r.length===0)return;const n=this.cryptoHelper.sha256();for(const s of r)n.update(Hr.from(s,t));return(await n.digest()).toString("hex")}async calcChainOnChainHash(e,t){let r=(this.calcRoundByHeight(e)-1)*this.config.blockPerRound;r=r===0?1:r;const n=this.cryptoHelper.sha256();if(r!==1){const s=await this.forceGetBlockByHeight(r,t);n.update(s.asset.roundLastAsset.chainOnChainBuffer)}for(let s=r;s<e;s++){const i=await this.forceGetBlockSignatureBufferByHeight(s,t);n.update(i)}return(await n.digest()).toString("hex")}nextRoundGeneratorsCompareFn(e,t){return t.numberOfForgeEntities>e.numberOfForgeEntities?1:t.numberOfForgeEntities<e.numberOfForgeEntities?-1:t.producedblocks>e.producedblocks?1:t.producedblocks<e.producedblocks?-1:e.publicKey>t.publicKey?1:e.publicKey===t.publicKey?0:-1}sortInRankAccountInfoList(e){return e.sort(this.nextRoundGeneratorsCompareFn)}calcForginAndHoldingRewards(e,t,r,n){const s=BigInt(e.reward),i={forgingRewards:BigInt(e.totalFee)+s,holdingRewardsList:[],circulations:BigInt(0)};let o=s;if(s>BigInt(0)){if(t>BigInt(0)&&r>0){const a=BigInt(r),p=[];for(const l of n){const h=t*BigInt(l.numberOfShareEntities)/a;h>BigInt(0)&&(o=o+h,p.push({address:l.address,rewards:h}))}i.holdingRewardsList=p}i.circulations=o}return i}};u([Z("blockGetterHelper",{optional:!0}),g("design:type",Object)],wt.prototype,"blockGetterHelper",void 0);wt=u([ie(),Ce(4,Z("cryptoHelper")),Ce(5,Z("keypairHelper")),Ce(6,Z("Buffer")),g("design:paramtypes",[ue,Le,Te,Lt,Object,Object,Object])],wt);class ps{constructor(t){this._map=new Map(t)}get(t){return this._map.get(t)}has(t){return this._map.has(t)}set(t,r){return this._map.set(t,r)}[Symbol.iterator](){return this._map.entries()}entries(){return this._map[Symbol.iterator]}static fromPrefix(t,r){const n=new ps;for(const[s,i]of r)n.set(t+s,i);return n}mergeWithPrefix(t,r){for(const[n,s]of r)this.set(t+n,s);return this}}const it="/",vn="utf-8",{ArgumentIllegalException:hs}=le("HELPER","transactionHelper");let Bf=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new hs(c.PROP_IS_REQUIRE,{prop:`chainInfo ${e}`,target:"encodeArgs"});const{chainName:t,magic:r,genesisBlockSignature:n}=e;if(!t)throw new hs(c.PROP_IS_REQUIRE,{prop:`chainName ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new hs(c.PROP_IS_INVALID,{prop:`chainName ${t}`,target:"encodeArgs"});if(!r)throw new hs(c.PROP_IS_REQUIRE,{prop:`magic ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new hs(c.PROP_IS_INVALID,{prop:`magic ${r}`,target:"encodeArgs"});if(!n)throw new hs(c.PROP_IS_REQUIRE,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new hs(c.PROP_IS_INVALID,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new hs(c.PROP_IS_REQUIRE,{prop:`fromChainId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new hs(c.PROP_IS_INVALID,{prop:`fromChainId ${e}`,target:"decodeArgs"});if(e.split(it).length!==4)throw new hs(c.PROP_IS_INVALID,{prop:`fromChainId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${it}${e.magic}${it}${e.chainName}${it}${e.genesisBlockSignature}`}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(it);return{magic:r[1],chainName:r[2],genesisBlockSignature:r[3]}}};Bf=u([ie()],Bf);function uw(e="fromChainId"){const t=new Bf;return new ps([[`${e}/${t.version}`,t]])}const{ArgumentIllegalException:ls}=le("HELPER","transactionHelper");let Pf=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new ls(c.PROP_IS_REQUIRE,{prop:`chainInfo ${e}`,target:"encodeArgs"});const{chainName:t,magic:r,genesisBlockSignature:n}=e;if(!t)throw new ls(c.PROP_IS_REQUIRE,{prop:`chainName ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new ls(c.PROP_IS_INVALID,{prop:`chainName ${t}`,target:"encodeArgs"});if(!r)throw new ls(c.PROP_IS_REQUIRE,{prop:`magic ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new ls(c.PROP_IS_INVALID,{prop:`magic ${r}`,target:"encodeArgs"});if(!n)throw new ls(c.PROP_IS_REQUIRE,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new ls(c.PROP_IS_INVALID,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new ls(c.PROP_IS_REQUIRE,{prop:`toChainId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new ls(c.PROP_IS_INVALID,{prop:`toChainId ${e}`,target:"decodeArgs"});if(e.split(it).length!==4)throw new ls(c.PROP_IS_INVALID,{prop:`toChainId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${it}${e.magic}${it}${e.chainName}${it}${e.genesisBlockSignature}`}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(it);return{magic:r[1],chainName:r[2],genesisBlockSignature:r[3]}}};Pf=u([ie()],Pf);function gw(e="toChainId"){const t=new Pf;return new ps([[`${e}/${t.version}`,t]])}const{ArgumentIllegalException:Pc}=le("HELPER","transactionHelper");let kf=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new Pc(c.PROP_IS_REQUIRE,{prop:`address ${e}`,target:"encodeArgs"});if(typeof e!="string")throw new Pc(c.PROP_IS_INVALID,{prop:`address ${e}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new Pc(c.PROP_IS_REQUIRE,{prop:`fromId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new Pc(c.PROP_IS_INVALID,{prop:`fromId ${e}`,target:"decodeArgs"});if(e.split(it).length!==2)throw new Pc(c.PROP_IS_INVALID,{prop:`fromId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${it}${e}`}decode(e,t=!1){return t||this.checkDecodeArgs(e),e.split(it)[1]}};kf=u([ie()],kf);function fw(e="fromId"){const t=new kf;return new ps([[`${e}/${t.version}`,t]])}const{ArgumentIllegalException:kc}=le("HELPER","transactionHelper");let Hf=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new kc(c.PROP_IS_REQUIRE,{prop:`address ${e}`,target:"encodeArgs"});if(typeof e!="string")throw new kc(c.PROP_IS_INVALID,{prop:`address ${e}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new kc(c.PROP_IS_REQUIRE,{prop:`toId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new kc(c.PROP_IS_INVALID,{prop:`toId ${e}`,target:"decodeArgs"});if(e.split(it).length!==2)throw new kc(c.PROP_IS_INVALID,{prop:`toId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${it}${e}`}decode(e,t=!1){return t||this.checkDecodeArgs(e),e.split(it)[1]}};Hf=u([ie()],Hf);function dw(e="toId"){const t=new Hf;return new ps([[`${e}/${t.version}`,t]])}const{ArgumentIllegalException:la}=le("HELPER","transactionHelper");let Mf=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new la(c.PROP_IS_REQUIRE,{prop:`assetInfo ${e}`,target:"encodeArgs"});const{parentAssetType:t,assetType:r}=e;if(t!==ne.DAPP&&t!==ne.LOCATION_NAME&&t!==ne.ENTITY&&t!==ne.ASSETS)throw new la(c.PROP_IS_INVALID,{prop:`parentAssetType ${t}`,target:"encodeArgs"});if(typeof r!="string")throw new la(c.PROP_IS_INVALID,{prop:`assetType ${r}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new la(c.PROP_IS_REQUIRE,{prop:`assetId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new la(c.PROP_IS_INVALID,{prop:`assetId ${e}`,target:"decodeArgs"});if(e.split(it).length!==3)throw new la(c.PROP_IS_INVALID,{prop:`assetId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${it}${e.parentAssetType}${it}${e.assetType}`}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(it);return{parentAssetType:Number(r[1]),assetType:r[2]}}};Mf=u([ie()],Mf);function yw(e="assetId"){const t=new Mf;return new ps([[`${e}/${t.version}`,t]])}const{ArgumentIllegalException:Or}=le("HELPER","transactionHelper");let Lf=class{constructor(){this.version="1"}checkEncodeArgs(e){const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;if(!t)throw new Or(c.PROP_IS_REQUIRE,{prop:`publicKey ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new Or(c.PROP_IS_INVALID,{prop:`publicKey ${t}`,target:"encodeArgs"});if(!r)throw new Or(c.PROP_IS_REQUIRE,{prop:`signature ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new Or(c.PROP_IS_INVALID,{prop:`signature ${r}`,target:"encodeArgs"});if(n){if(!n)throw new Or(c.PROP_IS_REQUIRE,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new Or(c.PROP_IS_INVALID,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(!s)throw new Or(c.PROP_IS_REQUIRE,{prop:`signSignature ${s}`,target:"encodeArgs"});if(typeof s!="string")throw new Or(c.PROP_IS_INVALID,{prop:`signSignature ${s}`,target:"encodeArgs"})}else if(s)throw new Or(c.SHOULD_NOT_EXIST,{prop:`signSignature ${s}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new Or(c.PROP_IS_REQUIRE,{prop:`signature ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new Or(c.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"});const t=e.split("/");if(t.length!==2&&t.length!==3)throw new Or(c.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"});if(t[1].split("-").length!==2)throw new Or(c.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"});if(t[2]&&t[2].split("-").length!==2)throw new Or(c.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"})}encode(e,t=!1){t||this.checkEncodeArgs(e);let r=`${this.version}${it}${e.publicKey}-${e.signature}`;return e.secondPublicKey&&e.signSignature&&(r+=`${it}${e.secondPublicKey}-${e.signSignature}`),r}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(it),n=r[1].split("-"),s={publicKey:n[0],signature:n[1]};if(r[2]){const i=r[2].split("-");s.secondPublicKey=i[0],s.signSignature=i[1]}return s}splitSignature(e){return e.split("/")[0]}splitSignSignature(e){return e.split("/").slice(0,2).join(it)}async generateSignature(e,t,r){const{secret:n,secondSecret:s,migrateCertificate:i}=e;i.signature=this.version;const o=await t.createSecretKeypair(n),a=Pe(o.publicKey),p=await r.detachedSign(Hr.from(JSON.stringify({body:i.body,signature:i.signature}),vn),o.secretKey);if(i.signature+=`/${a}-${Pe(p)}`,s){const l=await t.createSecondSecretKeypair(n,s),h=Pe(l.publicKey),y=await r.detachedSign(Hr.from(JSON.stringify({body:i.body,signature:i.signature}),vn),l.secretKey);i.signature+=`/${h}-${Pe(y)}`}return i}async verifySignature(e,t,r){const n=r&&r.taskLabel||"MigrateCertificate",s=e.signature,i=this.decode(s);if(!await t.detachedVeriy(Hr.from(JSON.stringify({body:e.body,signature:this.splitSignature(s)}),vn),be(i.signature),be(i.publicKey)))throw new Or(c.INVALID_SIGNATURE,{taskLabel:n});if(i.secondPublicKey&&i.signSignature&&!await t.detachedVeriy(Hr.from(JSON.stringify({body:e.body,signature:this.splitSignSignature(s)}),vn),be(i.signSignature),be(i.secondPublicKey)))throw new Or(c.INVALID_SIGNSIGNATURE,{taskLabel:n})}};Lf=u([ie()],Lf);function mw(e="signature"){const t=new Lf;return new ps([[`${e}/${t.version}`,t]])}const{ArgumentIllegalException:Cr}=le("HELPER","transactionHelper");let Df=class{constructor(){this.version="1"}checkEncodeArgs(e){const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;if(!t)throw new Cr(c.PROP_IS_REQUIRE,{prop:`publicKey ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new Cr(c.PROP_IS_INVALID,{prop:`publicKey ${t}`,target:"encodeArgs"});if(!r)throw new Cr(c.PROP_IS_REQUIRE,{prop:`signature ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new Cr(c.PROP_IS_INVALID,{prop:`signature ${r}`,target:"encodeArgs"});if(n){if(!n)throw new Cr(c.PROP_IS_REQUIRE,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new Cr(c.PROP_IS_INVALID,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(!s)throw new Cr(c.PROP_IS_REQUIRE,{prop:`signSignature ${s}`,target:"encodeArgs"});if(typeof s!="string")throw new Cr(c.PROP_IS_INVALID,{prop:`signSignature ${s}`,target:"encodeArgs"})}else if(s)throw new Cr(c.SHOULD_NOT_EXIST,{prop:`signSignature ${s}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new Cr(c.PROP_IS_REQUIRE,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new Cr(c.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});const t=e.split("/");if(t.length!==2&&t.length!==3)throw new Cr(c.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});if(t[1].split("-").length!==2)throw new Cr(c.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});if(t[2]&&t[2].split("-").length!==2)throw new Cr(c.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"})}encode(e,t=!1){t||this.checkEncodeArgs(e);let r=`${this.version}${it}${e.publicKey}-${e.signature}`;return e.secondPublicKey&&e.signSignature&&(r+=`${it}${e.secondPublicKey}-${e.signSignature}`),r}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(it),n=r[1].split("-"),s={publicKey:n[0],signature:n[1]};if(r[2]){const i=r[2].split("-");s.secondPublicKey=i[0],s.signSignature=i[1]}return s}splitSignature(e){return e.split("/")[0]}splitSignSignature(e){return e.split("/").slice(0,2).join(it)}async generateSignature(e,t,r){const{authSecret:n,authSecondSecret:s,migrateCertificate:i}=e;i.fromAuthSignature=this.version;const o=await t.createSecretKeypair(n),a=Pe(o.publicKey),p=await r.detachedSign(Hr.from(JSON.stringify({body:i.body,signature:i.signature,fromAuthSignature:i.fromAuthSignature}),vn),o.secretKey);if(i.fromAuthSignature+=`/${a}-${Pe(p)}`,s){const l=await t.createSecondSecretKeypair(n,s),h=Pe(l.publicKey),y=await r.detachedSign(Hr.from(JSON.stringify({body:i.body,signature:i.signature,fromAuthSignature:i.fromAuthSignature}),vn),l.secretKey);i.fromAuthSignature+=`/${h}-${Pe(y)}`}return i}async verifySignature(e,t,r){const n=r&&r.taskLabel||"MigrateCertificate",s=e.fromAuthSignature,i=this.decode(s);if(!await t.detachedVeriy(Hr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:this.splitSignature(s)}),vn),be(i.signature),be(i.publicKey)))throw new Cr(c.INVALID_FROMAUTHSIGNATURE,{taskLabel:n});if(i.secondPublicKey&&i.signSignature&&!await t.detachedVeriy(Hr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:this.splitSignSignature(s)}),vn),be(i.signSignature),be(i.secondPublicKey)))throw new Cr(c.INVALID_FROMAUTHSIGNSIGNATURE,{taskLabel:n})}};Df=u([ie()],Df);function _w(e="fromAuthSignature"){const t=new Df;return new ps([[`${e}/${t.version}`,t]])}const{ArgumentIllegalException:xr}=le("HELPER","transactionHelper");let Ff=class{constructor(){this.version="1"}checkEncodeArgs(e){const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;if(!t)throw new xr(c.PROP_IS_REQUIRE,{prop:`publicKey ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new xr(c.PROP_IS_INVALID,{prop:`publicKey ${t}`,target:"encodeArgs"});if(!r)throw new xr(c.PROP_IS_REQUIRE,{prop:`signature ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new xr(c.PROP_IS_INVALID,{prop:`signature ${r}`,target:"encodeArgs"});if(n){if(!n)throw new xr(c.PROP_IS_REQUIRE,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new xr(c.PROP_IS_INVALID,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(!s)throw new xr(c.PROP_IS_REQUIRE,{prop:`signSignature ${s}`,target:"encodeArgs"});if(typeof s!="string")throw new xr(c.PROP_IS_INVALID,{prop:`signSignature ${s}`,target:"encodeArgs"})}else if(s)throw new xr(c.SHOULD_NOT_EXIST,{prop:`signSignature ${s}`,target:"encodeArgs"})}checkDecodeArgs(e,t){if(!e)throw new xr(c.PROP_IS_REQUIRE,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new xr(c.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});const r=e.split("/");if(r.length!==2&&r.length!==3)throw new xr(c.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});if(r[1].split("-").length!==2)throw new xr(c.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});if(r[2]&&r[2].split("-").length!==2)throw new xr(c.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"})}encode(e,t=!1){t||this.checkEncodeArgs(e);let r=`${this.version}${it}${e.publicKey}-${e.signature}`;return e.secondPublicKey&&e.signSignature&&(r+=`${it}${e.secondPublicKey}-${e.signSignature}`),r}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(it),n=r[1].split("-"),s={publicKey:n[0],signature:n[1]};if(r[2]){const i=r[2].split("-");s.secondPublicKey=i[0],s.signSignature=i[1]}return s}splitSignature(e){return e.split("/")[0]}splitSignSignature(e){return e.split("/").slice(0,2).join(it)}async generateSignature(e,t,r){const{authSecret:n,authSecondSecret:s,migrateCertificate:i}=e;i.toAuthSignature=this.version;const o=await t.createSecretKeypair(n),a=Pe(o.publicKey),p=await r.detachedSign(Hr.from(JSON.stringify({body:i.body,signature:i.signature,fromAuthSignature:i.fromAuthSignature,toAuthSignature:i.toAuthSignature}),vn),o.secretKey);if(i.toAuthSignature+=`/${a}-${Pe(p)}`,s){const l=await t.createSecondSecretKeypair(n,s),h=Pe(l.publicKey),y=await r.detachedSign(Hr.from(JSON.stringify({body:i.body,signature:i.signature,fromAuthSignature:i.fromAuthSignature,toAuthSignature:i.toAuthSignature}),vn),l.secretKey);i.toAuthSignature+=`/${h}-${Pe(y)}`}return i}async verifySignature(e,t,r){const n=r&&r.taskLabel||"MigrateCertificate",s=e.toAuthSignature,i=this.decode(s);if(!await t.detachedVeriy(Hr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:e.fromAuthSignature,toAuthSignature:this.splitSignature(s)}),vn),be(i.signature),be(i.publicKey)))throw new xr(c.INVALID_TOAUTHSIGNATURE,{taskLabel:n});if(i.secondPublicKey&&i.signSignature&&!await t.detachedVeriy(Hr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:e.fromAuthSignature,toAuthSignature:this.splitSignSignature(s)}),vn),be(i.signSignature),be(i.secondPublicKey)))throw new xr(c.INVALID_TOAUTHSIGNSIGNATURE,{taskLabel:n})}};Ff=u([ie()],Ff);function Aw(e="toAuthSignature"){const t=new Ff;return new ps([[`${e}/${t.version}`,t]])}function Ew(e=1){return new ps().mergeWithPrefix(`${e}/`,uw()).mergeWithPrefix(`${e}/`,gw()).mergeWithPrefix(`${e}/`,fw()).mergeWithPrefix(`${e}/`,dw()).mergeWithPrefix(`${e}/`,yw()).mergeWithPrefix(`${e}/`,mw()).mergeWithPrefix(`${e}/`,_w()).mergeWithPrefix(`${e}/`,Aw())}const mr=Ew();let Zl=class{constructor(e){this.config=e,this.fieldConverter=mr,this._init(),this._check()}get fromChainId(){return this.__fromChainId}get toChainId(){return this.__toChainId}get fromId(){return this.__fromId}get toId(){return this.__toId}get assetId(){return this.__assetId}get signature(){return this.__signature}get fromAuthSignature(){return this.__fromAuthSignature}get toAuthSignature(){return this.__toAuthSignature}getUUID(e){return this.signature.decode(e.fromAuthSignature,!0).signature}_init(){if(!this.config){this.__fromChainId=mr.get("1/fromChainId/1"),this.__toChainId=mr.get("1/toChainId/1"),this.__fromId=mr.get("1/fromId/1"),this.__toId=mr.get("1/toId/1"),this.__assetId=mr.get("1/assetId/1"),this.__signature=mr.get("1/signature/1"),this.__fromAuthSignature=mr.get("1/fromAuthSignature/1"),this.__toAuthSignature=mr.get("1/toAuthSignature/1");return}const{fromChainIdVersion:e,toChainIdVersion:t,fromIdVersion:r,toIdVersion:n,assetIdVersion:s,signatureVersion:i,fromAuthSignatureVersion:o,toAuthSignatureVersion:a}=this.config;this.__fromChainId=mr.get(`1/fromChainId/${e}`),this.__toChainId=mr.get(`1/toChainId/${t}`),this.__fromId=mr.get(`1/fromId/${r}`),this.__toId=mr.get(`1/toId/${n}`),this.__assetId=mr.get(`1/assetId/${s}`),this.__signature=mr.get(`1/signature/${i}`),this.__fromAuthSignature=mr.get(`1/fromAuthSignature/${o||i}`),this.__toAuthSignature=mr.get(`1/toAuthSignature/${a||o||i}`)}_check(){if(this.config){if(!this.__fromChainId)throw new SyntaxError(`unknown fromChainId version ${this.config.fromChainIdVersion}`);if(!this.__toChainId)throw new SyntaxError(`unknown toChainId version ${this.config.toChainIdVersion}`);if(!this.__fromId)throw new SyntaxError(`unknown fromId version ${this.config.fromIdVersion}`);if(!this.__toId)throw new SyntaxError(`unknown toId version ${this.config.toIdVersion}`);if(!this.__assetId)throw new SyntaxError(`unknown assetId version ${this.config.assetIdVersion}`);if(!this.__signature)throw new SyntaxError(`unknown signature version ${this.config.signatureVersion}`);if(!this.__fromAuthSignature)throw new SyntaxError(`unknown fromAuthSignature version ${this.config.fromAuthSignatureVersion}`);if(!this.__toAuthSignature)throw new SyntaxError(`unknown toAuthSignature version ${this.config.toAuthSignatureVersion}`)}}};Zl=u([ie(),g("design:paramtypes",[Object])],Zl);const{ArgumentIllegalException:F_}=le("HELPER","transactionHelper");function mi(e){return e.split("/",1)[0]}function Fn(e){if(!e)return new Zl;const{body:t,signature:r,fromAuthSignature:n,toAuthSignature:s}=e;if(!t)throw new F_(c.PROP_IS_REQUIRE,{prop:"json.body"});if(!r)throw new F_(c.PROP_IS_REQUIRE,{prop:"json.signature"});const{fromChainId:i,toChainId:o,fromId:a,toId:p,assetId:l}=t,h=mi(i),y=mi(o),A=mi(a),_=mi(p),E=mi(l),T=mi(r),w={fromChainIdVersion:h,toChainIdVersion:y,fromIdVersion:A,toIdVersion:_,assetIdVersion:E,signatureVersion:T};return n&&(w.fromAuthSignatureVersion=mi(n)),s&&(w.toAuthSignatureVersion=mi(s)),new Zl(w)}let Uf=class{constructor(){this.__version="0.0.1"}get version(){return this.__version}set version(e){this.__version=e}};Uf=u([ie()],Uf);const{ArgumentIllegalException:lr}=le("HELPER","transactionHelper");let si=class{constructor(e,t,r,n,s,i,o){this.baseHelper=e,this.configHelper=t,this.chainTimeHelper=r,this.asymmetricHelper=n,this.accountBaseHelper=s,this.transactionHelper=i,this.config=o}__checkVersion(e){if(!e)throw new lr(c.PROP_IS_REQUIRE,{prop:"version",target:"migrateCertificate"});if(typeof e!="string")throw new lr(c.PROP_IS_INVALID,{prop:"version",target:"migrateCertificate"})}__checkTimestamp(e){if(!e)throw new lr(c.PROP_IS_REQUIRE,{prop:"timestamp",target:"migrateCertificate"});if(!this.baseHelper.isPositiveInteger(e))throw new lr(c.PROP_IS_INVALID,{prop:"timestamp",target:"migrateCertificate"})}__checkAssets(e){if(!e)throw new lr(c.PROP_IS_REQUIRE,{prop:"assets",target:"migrateCertificate"});if(!this.baseHelper.isValidAssetNumber(e))throw new lr(c.PROP_IS_INVALID,{prop:"assets",target:"migrateCertificate"});if(e==="0")throw new lr(c.PROP_SHOULD_GT_FIELD,{prop:"assets",fueld:"0",target:"migrateCertificate"})}getMigrateCertificateConverter(e){return Fn(e)}formatMigrateCertificate(e){const{body:t,signature:r,fromAuthSignature:n,toAuthSignature:s}=e;return{body:{version:t.version,timestamp:t.timestamp,fromChainId:t.fromChainId,toChainId:t.toChainId,fromId:t.fromId,toId:t.toId,assetId:t.assetId,assetPrealnum:t.assetPrealnum},signature:r||"",fromAuthSignature:n||"",toAuthSignature:s||""}}combineMigrateCertificateBody(e,t=this.configHelper){const r=Fn(),{senderId:n,recipientId:s,toChainInfo:i,assetInfo:o,assetPrealnum:a}=e;return{body:{version:t.version.toString(),timestamp:this.chainTimeHelper.now(!0),fromChainId:r.fromChainId.encode({magic:t.magic,chainName:t.chainName,genesisBlockSignature:t.signature},!0),toChainId:r.toChainId.encode(i),fromId:r.fromId.encode(n,!0),toId:r.toId.encode(s,!0),assetId:r.assetId.encode(o,!0),assetPrealnum:a},signature:r.signature.version}}combineMigrateCertificateSignature(e,t){const r=Fn(e),{signature:n,fromAuthSignature:s,toAuthSignature:i}=t;return n&&(e.signature=r.signature.encode(n)),s&&(e.fromAuthSignature=r.fromAuthSignature.encode(s)),i&&(e.toAuthSignature=r.toAuthSignature.encode(i)),e}async generateMigrateCertificate(e,t=this.configHelper){const{senderSecret:r,senderSecondSecret:n,recipientId:s,toChainInfo:i,assetInfo:o,assetPrealnum:a}=e,p=Fn();this.__checkAssets(a);const l=this.accountBaseHelper,h=await l.createSecretKeypair(r),y=await l.getAddressFromPublicKey(h.publicKey);let A={body:{version:this.config.version,timestamp:this.chainTimeHelper.now(!0),fromChainId:p.fromChainId.encode({magic:t.magic,chainName:t.chainName,genesisBlockSignature:t.signature},!0),toChainId:p.toChainId.encode(i),fromId:p.fromId.encode(y,!0),toId:p.toId.encode(s,!0),assetId:p.assetId.encode(o,!0),assetPrealnum:a},signature:"",fromAuthSignature:"",toAuthSignature:""};return r&&(A=await p.signature.generateSignature({secret:r,secondSecret:n,migrateCertificate:A},l,this.asymmetricHelper)),A}parseMigrateCertificateToJson(e){const{body:t,signature:r,fromAuthSignature:n,toAuthSignature:s}=e,i=Fn(e);return{body:{version:t.version,senderId:i.fromId.decode(t.fromId),recipientId:i.toId.decode(t.toId),timestamp:t.timestamp,fromChain:i.fromChainId.decode(t.fromChainId),toChain:i.toChainId.decode(t.toChainId),asset:i.assetId.decode(t.assetId),assetPrealnum:t.assetPrealnum},signature:i.signature.decode(r),fromAuthSignature:n&&n.includes("/")?i.fromAuthSignature.decode(n):void 0,toAuthSignature:s&&s.includes("/")?i.toAuthSignature.decode(s):void 0}}async fromAuthSignMigrateCertificate(e){return Fn(e.migrateCertificate).fromAuthSignature.generateSignature(e,this.accountBaseHelper,this.asymmetricHelper)}async toAuthSignMigrateCertificate(e){return Fn(e.migrateCertificate).toAuthSignature.generateSignature(e,this.accountBaseHelper,this.asymmetricHelper)}async verifyMigrateCertificateSignature(e,t){return Fn(e).signature.verifySignature(e,this.asymmetricHelper,t)}async verifyMigrateCertificateFromAuthSignature(e,t){return Fn(e).fromAuthSignature.verifySignature(e,this.asymmetricHelper,t)}async verifyMigrateCertificateToAuthSignature(e,t){return Fn(e).toAuthSignature.verifySignature(e,this.asymmetricHelper,t)}async __checkAuthAccount(e,t,r){const n=await this.accountBaseHelper.getAddressFromPublicKeyString(r.publicKey),s=t.genesisGenerators,i=await this.accountBaseHelper.getAddressFromPublicKeyString(t.generatorPublicKey);if(s.push(i),!s.includes(n))throw new lr(c.NOT_MATCH,{to_compare_prop:`${e} auth signature address ${n}`,be_compare_prop:"genesis generator address",to_target:"migrateCertificate",be_target:"fromChain"})}async checkChainInfo(e,t,r,n){if(t.magic!==r.magic)throw new lr(c.SHOULD_BE,{to_compare_prop:`${e}.magic ${t.magic}`,to_target:"migrateCertificate",be_compare_prop:r.magic});if(t.chainName!==r.chainName)throw new lr(c.SHOULD_BE,{to_compare_prop:`${e}.chainName ${t.chainName}`,to_target:"migrateCertificate",be_compare_prop:r.chainName});if(t.genesisBlockSignature!==t.genesisBlockSignature)throw new lr(c.SHOULD_BE,{to_compare_prop:`${e}.genesisBlockSignature ${t.genesisBlockSignature}`,to_target:"migrateCertificate",be_compare_prop:t.genesisBlockSignature});n&&await this.__checkAuthAccount(e,r,n)}async verifyMigrateCertificate(e,t){const r={target:"migrateCertificate"},n=Fn(e),{forceCheckFromChainInfo:s,fromChainBaseConfig:i,forceCheckFromAuthSignature:o,forceCheckToChainInfo:a,toChainBaseConfig:p,forceCheckToAuthSignature:l}=t,{body:h,signature:y,fromAuthSignature:A,toAuthSignature:_}=e;this.__checkVersion(h.version),this.__checkTimestamp(h.timestamp),n.fromChainId.checkDecodeArgs(h.fromChainId),n.toChainId.checkDecodeArgs(h.toChainId),n.fromId.checkDecodeArgs(h.fromId),n.toId.checkDecodeArgs(h.toId),n.assetId.checkDecodeArgs(h.assetId),this.__checkAssets(h.assetPrealnum),n.signature.checkDecodeArgs(y);const E=this.baseHelper,T=n.signature.decode(y,!0);if(!E.isValidAccountSignature(T))throw new lr(c.PROP_IS_INVALID,{prop:`signature ${y}`,...r});if(await n.signature.verifySignature(e,this.asymmetricHelper),s){if(!i)throw new lr(c.PROP_IS_REQUIRE,{prop:"fromChainBaseConfig",target:"options"});const w=n.fromChainId.decode(h.fromChainId);if(await this.checkChainInfo("fromChain",w,i),A&&A.includes(it)){n.fromAuthSignature.checkDecodeArgs(A);const C=n.fromAuthSignature.decode(A,!0);if(!E.isValidAccountSignature(C))throw new lr(c.PROP_IS_INVALID,{prop:`fromAuthSignature ${A}`,...r});await this.__checkAuthAccount("fromChain",i,C)}}if(o){if(!A)throw new lr(c.PROP_IS_REQUIRE,{prop:"fromAuthSignature",...r});await this.verifyMigrateCertificateFromAuthSignature(e)}if(a){if(!p)throw new lr(c.PROP_IS_REQUIRE,{prop:"toChainBaseConfig",target:"options"});const w=n.toChainId.decode(h.toChainId);if(await this.checkChainInfo("toChain",w,p),_&&_.includes(it)){n.toAuthSignature.checkDecodeArgs(_);const C=n.toAuthSignature.decode(_,!0);if(!E.isValidAccountSignature(C))throw new lr(c.PROP_IS_INVALID,{prop:`toAuthSignature ${_}`,...r});await this.__checkAuthAccount("toChain",p,C)}}if(l){if(!_)throw new lr(c.PROP_IS_REQUIRE,{prop:"toAuthSignature",...r});await this.verifyMigrateCertificateToAuthSignature(e)}return n}};si=u([ie(),g("design:paramtypes",[Le,ue,Yt,Fr,Te,we,Uf])],si);let $f=class{constructor(){this.__version="0.0.1"}get version(){return this.__version}set version(e){this.__version=e}};$f=u([ie()],$f);const Tl="utf-8",{ArgumentIllegalException:en}=le("HELPER","RegisterChainCertificateHelper");let eu=class{constructor(e,t,r,n,s){this.baseHelper=e,this.chainTimeHelper=t,this.asymmetricHelper=r,this.accountBaseHelper=n,this.config=s}__checkVersion(e){if(!e)throw new en(c.PROP_IS_REQUIRE,{prop:"version",target:"registerChainCertificate"});if(typeof e!="string")throw new en(c.PROP_IS_INVALID,{prop:"version",target:"registerChainCertificate"})}__checkTimestamp(e){if(!e)throw new en(c.PROP_IS_REQUIRE,{prop:"timestamp",target:"registerChainCertificate"});if(!this.baseHelper.isPositiveInteger(e))throw new en(c.PROP_IS_INVALID,{prop:"timestamp",target:"registerChainCertificate"})}__checkPublicKey(e){if(!e)throw new en(c.PROP_IS_REQUIRE,{prop:"publicKey",target:"registerChainCertificate"});if(!this.baseHelper.isValidPublicKey(e))throw new en(c.PROP_IS_INVALID,{prop:"publicKey",target:"registerChainCertificate"})}__checkSignature(e){if(!e)throw new en(c.PROP_IS_REQUIRE,{prop:"signature",target:"registerChainCertificate"});if(!this.baseHelper.isValidSignature(e))throw new en(c.PROP_IS_INVALID,{prop:"signature",target:"registerChainCertificate"})}async generateRegisterChainCertificate(e){const{generatorSecret:t,generatorSecondSecret:r,genesisBlockInfo:n,version:s,timestamp:i}=e,o=this.accountBaseHelper,a=await o.createSecretKeypair(t),p=Pe(a.publicKey);let l;const h={body:{version:s||this.config.version,timestamp:i===void 0?this.chainTimeHelper.now(!0):i,genesisBlockInfo:{genesisAccount:{address:await o.getAddressFromPublicKey(a.publicKey),publicKey:p},...n}},publicKey:p};r&&(l=await o.createSecretKeypair(t),h.secondPublicKey=Pe(l.publicKey));const y=await this.asymmetricHelper.detachedSign(ho.from(JSON.stringify(h),Tl),a.secretKey),A={...h,signature:Pe(y)};if(l){const _=await this.asymmetricHelper.detachedSign(ho.from(JSON.stringify(h),Tl),l.secretKey);A.signSignature=Pe(_)}return A}async verifyRegisterChainCertificateSignature(e,t){const r=t&&t.taskLabel||"RegisterChainCertificate",{body:n,publicKey:s,signature:i,secondPublicKey:o,signSignature:a}=e;if(!await this.asymmetricHelper.detachedVeriy(ho.from(JSON.stringify({body:n,publicKey:s}),Tl),be(i),be(s)))throw new en(c.INVALID_SIGNATURE,{taskLabel:r});if(o&&a&&!await this.asymmetricHelper.detachedVeriy(ho.from(JSON.stringify({body:n,publicKey:s,secondPublicKey:o,signature:i}),Tl),be(a),be(o)))throw new en(c.INVALID_SIGNSIGNATURE,{taskLabel:r})}async verifyRegisterChainCertificate(e){const{body:t,publicKey:r,signature:n,secondPublicKey:s,signSignature:i}=e;if(r!==t.genesisBlockInfo.genesisAccount.publicKey)throw new en(c.NOT_MATCH,{to_compare_prop:`publicKey ${r}`,be_compare_prop:`generatorPublicKey ${t.genesisBlockInfo.genesisAccount.publicKey}`,to_target:"registerChainCertificate",be_target:"registerChainCertificate.body.genesisBlockInfo"});if(this.__checkVersion(t.version),this.__checkTimestamp(t.timestamp),this.__checkPublicKey(r),this.__checkSignature(n),s&&i)this.__checkPublicKey(s),this.__checkSignature(i);else{if(s)throw new en(c.SHOULD_NOT_EXIST,{prop:`secondPublicKey ${s}`,target:"registerChainCertificate"});if(i)throw new en(c.SHOULD_NOT_EXIST,{prop:`signSignature ${i}`,target:"registerChainCertificate"})}return await this.verifyRegisterChainCertificateSignature(e),!0}encode(e){return JSON.stringify(e)}decode(e){return JSON.parse(e)}};eu=u([ie(),g("design:paramtypes",[Le,Yt,Fr,Te,$f])],eu);const{ArgumentIllegalException:Ne}=le("CONTROLLER","_txbase");class Ze{async fromJSON(t,r){const n=this.init(t,t.asset);return r&&r.verify&&await this.verify(n,r.config),n}verifyKeypair(t){if(!t)throw new Ne(c.PARAM_LOST,{param:"keypair"});const r={target:"keypair"};if(!t.publicKey)throw new Ne(c.PROP_IS_REQUIRE,{prop:"publicKey",...r});if(!t.secretKey)throw new Ne(c.PROP_IS_REQUIRE,{param:"secretKey",...r})}verifySecondKeypair(t){if(!t)throw new Ne(c.PARAM_LOST,{param:"keypair"});const r={target:"keypair"};if(!t.publicKey)throw new Ne(c.PROP_IS_REQUIRE,{prop:"publicKey",...r});if(!t.secretKey)throw new Ne(c.PROP_IS_REQUIRE,{param:"secretKey",...r})}async verifyTransactionBody(t,r,n=this.configHelper){if(!t)throw new Ne(c.PARAM_LOST,{param:"body"});if(!r)throw new Ne(c.PARAM_LOST,{param:"asset"});const s={target:"body"},{baseHelper:i,accountBaseHelper:o}=this;if(!i.isPositiveInteger(t.version))throw new Ne(c.PROP_IS_REQUIRE,{prop:"version",...s});if(!t.type)throw new Ne(c.PROP_IS_REQUIRE,{prop:"type",...s});if(!i.isValidTransactionType(t.type))throw new Ne(c.PROP_IS_INVALID,{prop:"type",type:"transaction type",...s});if(!t.senderId)throw new Ne(c.PROP_IS_REQUIRE,{prop:"senderId",...s});if(!await o.isAddress(t.senderId))throw new Ne(c.PROP_IS_INVALID,{prop:`senderId ${t.senderId}`,type:"account address",...s});if(!t.senderPublicKey)throw new Ne(c.PROP_IS_REQUIRE,{prop:"senderPublicKey",...s});if(!i.isValidPublicKey(t.senderPublicKey))throw new Ne(c.PROP_IS_INVALID,{prop:`senderPublicKey ${t.senderPublicKey}`,type:"account publicKey",...s});const a=await o.getAddressFromPublicKeyString(t.senderPublicKey);if(t.senderId!==a)throw new Ne(c.NOT_MATCH,{to_compare_prop:`senderId ${t.senderId}`,be_compare_prop:`publicKey => address ${a}`,to_target:"senderPublicKey",be_target:"body",...s});if(t.senderSecondPublicKey&&!i.isValidPublicKey(t.senderSecondPublicKey))throw new Ne(c.PROP_IS_INVALID,{prop:`senderSecondPublicKey ${t.senderSecondPublicKey}`,type:"account publicKey",...s});if(t.recipientId!==void 0&&!await o.isAddress(t.recipientId))throw new Ne(c.PROP_IS_INVALID,{prop:`recipientId ${t.recipientId}`,type:"account address",...s});const{range:p}=t;if(p.length>0){const E=new Set(p);if(p.length!==E.size)throw new Ne(c.SHOULD_NOT_DUPLICATE,{prop:"range",...s})}if(!await this.baseHelper.isValidRange(t.rangeType,p))throw new Ne(c.PROP_IS_INVALID,{prop:`range ${t.rangeType}`,type:"transaction range",...s});if(!i.isNaturalNumber(t.timestamp))throw new Ne(c.PROP_IS_INVALID,{prop:`timestamp ${t.timestamp}`,type:"natural number",...s});const l=t.applyBlockHeight;if(!i.isPositiveInteger(l))throw new Ne(c.PROP_IS_INVALID,{prop:`applyBlockHeight ${l}`,type:"positive integer",...s});const h=t.effectiveBlockHeight;if(!i.isPositiveInteger(h))throw new Ne(c.PROP_IS_INVALID,{prop:`effectiveBlockHeight ${h}`,type:"positive integer",...s});if(h<l)throw new Ne(c.PROP_SHOULD_GTE_FIELD,{prop:`effectiveBlockHeight ${h}`,field:l,...s});const{maxApplyAndConfirmedBlockHeightDiff:y}=n,A=l+y;if(h>A)throw new Ne(c.PROP_SHOULD_LTE_FIELD,{prop:`effectiveBlockHeight ${h}`,field:A,...s});if(this.checkTrsBaseFee(t.fee,s),!t.fromMagic)throw new Ne(c.PROP_IS_REQUIRE,{prop:"fromMagic",...s});if(!i.isValidChainMagic(t.fromMagic))throw new Ne(c.PROP_IS_INVALID,{prop:`fromMagic ${t.fromMagic}`,type:"chain magic",...s});if(!t.toMagic)throw new Ne(c.PROP_IS_REQUIRE,{prop:"toMagic",...s});if(!i.isValidChainMagic(t.toMagic))throw new Ne(c.PROP_IS_INVALID,{prop:`toMagic ${t.toMagic}`,type:"chain magic",...s});if(t.sourceIP!==void 0&&!i.isIp(t.sourceIP))throw new Ne(c.PROP_IS_INVALID,{prop:`sourceIP ${t.sourceIP}`,type:"ip",...s});if(t.dappid!==void 0&&!i.isValidDAppId(t.dappid))throw new Ne(c.PROP_IS_INVALID,{prop:`dappid ${t.dappid}`,type:"dappid",...s});if(t.lns!==void 0&&!i.isValidLocationName(t.lns,n.chainName))throw new Ne(c.PROP_IS_INVALID,{prop:`lns ${t.lns}`,type:"location name",...s});const _=t.remark;if(!_)throw new Ne(c.PROP_IS_REQUIRE,{prop:"remark",...s});if(i.getVariableType(_)!=="[object Object]")throw new Ne(c.PROP_IS_INVALID,{prop:"remark",...s});for(const E in _)if(!i.isString(_[E]))throw new Ne(c.PROP_IS_INVALID,{prop:"remark",...s})}async verifyBaseInfo(t,r=this.configHelper){if(!t)throw new Ne(c.PARAM_LOST,{param:"transaction"});await this.verifyTransactionBody(t,t.asset,r);const n={target:"transaction"},{baseHelper:s}=this;if(!t.signature)throw new Ne(c.PROP_IS_REQUIRE,{prop:"signature",...n});if(!s.isValidSignature(t.signature))throw new Ne(c.PROP_IS_INVALID,{prop:`signature ${t.signature}`,type:"signature",...n});if(t.signSignature&&!s.isValidSignature(t.signSignature))throw new Ne(c.PROP_IS_INVALID,{prop:`signSignature ${t.signSignature}`,type:"signature",...n})}async verifySignature(t){await this.transactionHelper.verifyTransactionSignature(t)}verifyTransactionSize(t){this.transactionHelper.verifyTransactionSize(t)}verifyTransactionBlobSize(t){this.transactionHelper.verifyTransactionBlobSize(t)}async verify(t,r=this.configHelper){await this.verifyBaseInfo(t,r),this.verifyTransactionSize(t),this.verifyTransactionBlobSize(t),await this.verifySignature(t)}checkAssetAmount(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});const{baseHelper:s}=this;if(!s.isValidAssetNumber(t))throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,type:"asset number",...n});const i=BigInt(0),o=BigInt(t);if(i>=o)throw new Ne(c.PROP_SHOULD_GT_FIELD,{prop:`${r} ${t}`,field:"0",...n})}checkAssetPrealnum(t,r,n){this.checkBaseAssetPrealnum(n,r,t),this.isAssetPrealnumGtZero(t,r,n)}checkBaseAssetPrealnum(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});const{baseHelper:s}=this;if(!s.isValidAssetNumber(t))throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,type:"asset prealnum",...n});const i=BigInt(0),o=BigInt(t);if(i>o)throw new Ne(c.PROP_SHOULD_GTE_FIELD,{prop:`${r} ${t}`,field:"0",...n})}isAssetPrealnumGtZero(t,r,n){if(t==="0")throw new Ne(c.PROP_SHOULD_GT_FIELD,{prop:`${r} ${t}`,field:"0",...n})}checkTrsBaseFee(t,r){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:"fee",...r});const{baseHelper:n}=this;if(!n.isValidAssetNumber(t))throw new Ne(c.PROP_IS_INVALID,{prop:`fee ${t}`,type:"asset number",...r});const s=BigInt(t);if(BigInt("0")>s)throw new Ne(c.PROP_SHOULD_GTE_FIELD,{prop:`fee ${t}`,field:"0",...r})}emptyRangeType(t,r){if(t.rangeType!==0)throw new Ne(c.SHOULD_BE,{to_compare_prop:`rangeType ${t.rangeType}`,to_target:"body",be_compare_prop:"RANGE_TYPE.EMPTY",...r})}checkChainName(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});if(!this.baseHelper.isValidChainName(t))throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,type:"chain name",...n})}checkChainMagic(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});if(!this.baseHelper.isValidChainMagic(t))throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,type:"chain magic",...n})}checkParentAssetType(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});if(!ne[t])throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,...n})}checkAsset(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});if(!this.baseHelper.isValidAssetType(t))throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,...n})}checkDAppId(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});if(!this.baseHelper.isValidDAppId(t))throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,...n})}checkLocationName(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});if(!this.baseHelper.isValidLocationName(t))throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,...n})}checkEntityFactoryId(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});if(!this.baseHelper.isValidEntityFactoryId(t))throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,...n})}checkEntityId(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});if(!this.baseHelper.isValidEntityId(t))throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,...n})}checkCertificateId(t,r,n){if(!t)throw new Ne(c.PROP_IS_REQUIRE,{prop:r,...n});if(!this.baseHelper.isValidCertificateId(t))throw new Ne(c.PROP_IS_INVALID,{prop:`${r} ${t}`,...n})}checkAssetType(t,r,n,s){if(t===ne.ASSETS){this.checkAsset(r,n,s);return}if(t===ne.DAPP){this.checkDAppId(r,n,s);return}if(t===ne.LOCATION_NAME){this.checkLocationName(r,n,s);return}if(t===ne.ENTITY){this.checkEntityId(r,n,s);return}if(t===ne.CERTIFICATE){this.checkCertificateId(r,n,s);return}throw new Ne(c.PROP_IS_INVALID,{prop:`parentAssetType ${t}`,...s})}async checkTaxInformation(t,r){if(!r)throw new Ne(c.PROP_IS_REQUIRE,{prop:"taxInformation",...t});const{taxCollector:n,taxAssetPrealnum:s}=r;if(!n)throw new Ne(c.PROP_IS_REQUIRE,{prop:"taxInformation.taxCollector",...t});if(!await this.accountBaseHelper.isAddress(n))throw new Ne(c.PROP_IS_INVALID,{prop:`taxInformation.taxCollector ${n}`,...t});if(!s)throw new Ne(c.PROP_IS_REQUIRE,{prop:"taxInformation.taxAssetPrealnum",...t});if(!this.baseHelper.isValidAssetPrealnum(s))throw new Ne(c.PROP_IS_INVALID,{prop:`taxInformation.taxAssetPrealnum ${s}`,...t})}async applyTransaction(t,r,n=this.configHelper){const s=this.chainAssetInfoHelper.getAssetInfo(n.chainName,n.magic,n.assetType);return Qe(i=>{i.next=r.emit("fee",{type:"fee",transaction:t,applyInfo:{address:t.senderId,publicKeyBuffer:t.senderPublicKeyBuffer,assetInfo:s,amount:"-"+t.fee,sourceAmount:t.fee}}),i.next=r.emit("count",{type:"count",transaction:t})})}beginDealTransaction(t,r){return r.emit("beginDealTransaction",{type:"beginDealTransaction",transaction:t,applyInfo:void 0})}endDealTransaction(t,r){return r.emit("endDealTransaction",{transactionInBlock:t})}_applyTransactionEmitAsset(t,r,n,s){return Qe(i=>{i.next=t.emit("asset",{type:"asset",transaction:r,applyInfo:{address:s.senderId,publicKeyBuffer:s.senderPublicKeyBuffer,assetInfo:s.assetInfo,amount:"-"+n,sourceAmount:n}}),s.recipientId&&(i.next=t.emit("asset",{type:"asset",transaction:r,applyInfo:{address:s.recipientId,publicKeyBuffer:s.recipientPublicKeyBuffer,assetInfo:s.assetInfo,amount:n,sourceAmount:n}}))})}getMoveAmount(t,r={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}}const{ArgumentIllegalException:to}=le("CONTROLLER","SignatureTransactionFactory");let tu=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(e.recipientId)throw new to(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new to(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new to(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new to(c.SHOULD_NOT_EXIST,{prop:"storage",...n});const i=t.signature;if(!i)throw new to(c.PARAM_LOST,{param:"signature"});const o={...n,target:"signatureAsset"},a=i.publicKey;if(!a)throw new to(c.PROP_IS_REQUIRE,{prop:"publicKey",...o});if(!s.isValidSecondPublicKey(a))throw new to(c.PROP_IS_INVALID,{prop:`publicKey ${a}`,type:"account second publicKey",...o})}init(e,t){return Jp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r),n.next=t.emit("setSecondPublicKey",{type:"setSecondPublicKey",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,secondPublicKeyBuffer:e.asset.signature.publicKeyBuffer}})})}};tu=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],tu);const{ArgumentIllegalException:_r}=le("CONTROLLER","DAppTransactionFactory");let Vh=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new _r(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new _r(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new _r(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new _r(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="dappid")throw new _r(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"dappid",...n});const i=t.dapp;if(this.verifyDAppAsset(i,r),s.value!==i.dappid)throw new _r(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`dappid ${i.dappid}`,to_target:"storage",be_target:"dapp",...n})}verifyDAppAsset(e,t=this.configHelper){const{baseHelper:r}=this,n={target:"body"};if(!e)throw new _r(c.PARAM_LOST,{param:"dapp",...n});const s={...n,target:"dappAsset"},{dappid:i,sourceChainMagic:o,sourceChainName:a,type:p,purchaseAsset:l}=e;if(!i)throw new _r(c.PROP_IS_REQUIRE,{prop:"dappid",...s});if(!r.isString(i))throw new _r(c.PROP_IS_INVALID,{prop:`dappid ${i}`,type:"string",...s});if(i.length!==8)throw new _r(c.PROP_LENGTH_SHOULD_EQ_FIELD,{prop:`dappid ${i}`,fileds:8,...s});if(!r.isUpperCaseLetterOrNumber(i))throw new _r(c.PROP_IS_INVALID,{prop:`dappid ${i}`,type:"uppercase or number",...s});if(this.checkChainName(a,"sourceChainName",s),a!==t.chainName)throw new _r(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${a}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(o,"sourceChainMagic",s),o!==t.magic)throw new _r(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${o}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(p!==1&&p!==0)throw new _r(c.NOT_MATCH,{to_compare_prop:`type ${p}`,be_compare_prop:"dappType",to_target:"dapp",be_target:"DAPP_TYPE",...s});if(p===0){if(!l)throw new _r(c.PROP_IS_REQUIRE,{prop:"purchaseAsset",...s});if(!r.isValidAssetNumber(l))throw new _r(c.PROP_IS_INVALID,{prop:"purchaseAsset",type:"asset number",...s});this.checkAssetAmount(l,"purchaseAsset",s)}else if(p===1&&l)throw new _r(c.SHOULD_NOT_EXIST,{prop:"purchaseAsset",...s})}init(e,t){return Yp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{sourceChainName:s,sourceChainMagic:i,dappid:o,type:a,purchaseAsset:p}=e.asset.dapp;n.next=t.emit("issueDAppid",{type:"issueDAppid",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:s,sourceChainMagic:i,dappid:o,possessorAddress:e.recipientId,type:a,purchaseAsset:p,status:0}})})}};Vh=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],Vh);const{ArgumentIllegalException:_i}=le("CONTROLLER","DAppPurchasingTransactionFactory");let Vf=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.dappTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new _i(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new _i(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new _i(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new _i(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="dappid")throw new _i(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"dappid",...n});const i=t.dappPurchasing;if(!i)throw new _i(c.PARAM_LOST,{param:"dappPurchasing"});const o={...n,target:"dappPurchasingAsset"},{dappAsset:a}=i;if(this.dappTransactionFactory.verifyDAppAsset(a),s.value!==a.dappid)throw new _i(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`dappid ${a.dappid}`,to_target:"storage",be_target:"dapp",...o});if(a.type!==0)throw new _i(c.SHOULD_NOT_BE,{to_compare_prop:`type ${a.type}`,to_target:"dappAsset",be_compare_prop:0,...o})}init(e,t){return Qp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{chainName:s,magic:i,assetType:o}=r,{purchaseAsset:a}=e.asset.dappPurchasing.dappAsset,p=this.chainAssetInfoHelper.getAssetInfo(s,i,o);n.next=this._applyTransactionEmitAsset(t,e,a,{senderId:e.senderId,senderPublicKeyBuffer:e.senderPublicKeyBuffer,recipientId:e.recipientId,assetInfo:p})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,purchaseAsset:n}=e.asset.dappPurchasing.dappAsset;return t.magic===r&&t.assetType===this.configHelper.assetType&&n||"0"}};Vf=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Vh])],Vf);const{ArgumentIllegalException:$r}=le("CONTROLLER","MarkTransactionFactory");let Gf=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.dappTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new $r(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new $r(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new $r(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.dappid)throw new $r(c.PROP_IS_REQUIRE,{prop:"dappid",...n});if(!e.storage)throw new $r(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="dappid")throw new $r(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"dappid",...n});const o=t.mark;if(!o)throw new $r(c.PARAM_LOST,{param:"mark"});const a={...n,target:"markAsset"},p=o.dapp;if(this.dappTransactionFactory.verifyDAppAsset(p),e.dappid!==p.dappid)throw new $r(c.NOT_MATCH,{to_compare_prop:`dappid ${i.value}`,be_compare_prop:`dappid ${p.dappid}`,to_target:"body",be_target:"mark",...n});if(i.value!==p.dappid)throw new $r(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`dappid ${p.dappid}`,to_target:"storage",be_target:"mark",...n});const l=o.content;if(!l)throw new $r(c.PROP_IS_REQUIRE,{prop:"content",...a});if(!s.isString(l))throw new $r(c.PROP_IS_INVALID,{prop:`content ${l}`,type:"string",...a});if(l.length>1024)throw new $r(c.OVER_LENGTH,{prop:`content ${l}`,limit:1024,...a});const h=o.action;if(!h)throw new $r(c.PROP_IS_REQUIRE,{prop:"action",...a});if(!s.isString(h))throw new $r(c.PROP_IS_INVALID,{prop:`action ${h}`,type:"string",...a});const y=h.length;if(y<1||y>10)throw new $r(c.NOT_IN_EXPECTED_RANGE,{prop:`action ${h}`,min:1,max:10,...a})}init(e,t){return Xp.fromObject({...e,asset:t})}};Gf=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Vh])],Gf);const{ArgumentIllegalException:Rr}=le("CONTROLLER","IssueAssetTransactionFactory");let Kf=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this,i=e.recipientId;if(!e.recipientId)throw new Rr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.senderId===i)throw new Rr(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${i}`,...n});if(e.fromMagic!==r.magic)throw new Rr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Rr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Rr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="assetType")throw new Rr(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const a=t.issueAsset;if(!a)throw new Rr(c.PARAM_LOST,{param:"issueAsset"});const p={...n,target:"issueAssetAsset"},{sourceChainName:l,sourceChainMagic:h,assetType:y,expectedIssuedAssets:A}=a;if(this.checkChainName(l,"sourceChainName",p),l!==r.chainName)throw new Rr(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${l}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(h,"sourceChainMagic",p),h!==r.magic)throw new Rr(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${h}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!y)throw new Rr(c.PROP_IS_REQUIRE,{prop:"assetType",...p});if(!s.isUpperCaseLetter(y))throw new Rr(c.PROP_IS_INVALID,{prop:`assetType ${y}`,type:"uppercase",...p});const _=y.length;if(_<3||_>10)throw new Rr(c.NOT_IN_EXPECTED_RANGE,{prop:`assetType ${y}`,type:"string length",min:3,max:10,...p});if(o.value!==y)throw new Rr(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`assetType ${y}`,to_target:"storage",be_target:"issueAsset",...n});if(!A)throw new Rr(c.PROP_IS_REQUIRE,{prop:"expectedIssuedAssets",...p});if(!s.isValidAssetNumber(A))throw new Rr(c.PROP_IS_INVALID,{prop:`expectedIssuedAssets ${A}`,type:"asset number",...p});if(BigInt(A)<BigInt(0))throw new Rr(c.PROP_SHOULD_GT_FIELD,{prop:"expectedIssuedAssets",field:"0",...p})}init(e,t){return Wp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{sourceChainName:a,sourceChainMagic:p,assetType:l,expectedIssuedAssets:h}=e.asset.issueAsset;n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,accountStatus:16}});const y=this.chainAssetInfoHelper.getAssetInfo(a,p,l);n.next=t.emit("issueAsset",{type:"issueAsset",transaction:e,applyInfo:{address:s,genesisAddress:i,publicKeyBuffer:o,sourceChainName:a,assetInfo:y,amount:h,sourceAmount:h}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,expectedIssuedAssets:s}=e.asset.issueAsset;return t.magic===r&&t.assetType===n?s:"0"}};Kf=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],Kf);const{ArgumentIllegalException:vr}=le("CONTROLLER","IncreaseAssetTransactionFactory");let jf=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new vr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new vr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new vr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new vr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="assetType")throw new vr(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const o=t.increaseAsset;if(!o)throw new vr(c.PARAM_LOST,{param:"increaseAsset"});const a={...n,target:"increaseAssetAsset"},{applyAddress:p,sourceChainName:l,sourceChainMagic:h,assetType:y,increasedAssetPrealnum:A,frozenMainAssetPrealnum:_}=o;if(!await this.accountBaseHelper.isAddress(p))throw new vr(c.PROP_IS_INVALID,{prop:`applyAddress ${p}`,type:"account address",...n,target:"increaseAsset"});if(this.checkChainName(l,"sourceChainName",a),l!==r.chainName)throw new vr(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${l}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(h,"sourceChainMagic",a),h!==r.magic)throw new vr(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${h}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(this.checkAssetType(ne.ASSETS,y,"assetType",a),y===r.assetType)throw new vr(c.SHOULD_NOT_BE,{to_compare_prop:`assetType ${y}`,to_target:"body",be_compare_prop:"local chain assetType",...n});if(i.value!==y)throw new vr(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`assetType ${y}`,to_target:"storage",be_target:"increaseAsset",...n});if(!A)throw new vr(c.PROP_IS_REQUIRE,{prop:"increasedAssetPrealnum",...a});if(!s.isValidAssetNumber(A))throw new vr(c.PROP_IS_INVALID,{prop:`increasedAssetPrealnum ${A}`,type:"asset number",...a});if(BigInt(A)<=BigInt(0))throw new vr(c.PROP_SHOULD_GT_FIELD,{prop:"increasedAssetPrealnum",field:"0",...a});if(!_)throw new vr(c.PROP_IS_REQUIRE,{prop:"frozenMainAssetPrealnum",...a});if(!s.isValidAssetNumber(_))throw new vr(c.PROP_IS_INVALID,{prop:`frozenMainAssetPrealnum ${_}`,type:"asset number",...a})}init(e,t){return qp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{applyAddress:a,sourceChainName:p,sourceChainMagic:l,assetType:h,increasedAssetPrealnum:y,frozenMainAssetPrealnum:A}=e.asset.increaseAsset,_=this.chainAssetInfoHelper.getAssetInfo(p,l,h);n.next=t.emit("increaseAsset",{type:"increaseAsset",transaction:e,applyInfo:{address:s,recipientId:i,applyAddress:a,publicKeyBuffer:o,sourceChainName:p,assetInfo:_,amount:y,sourceAmount:y,frozenMainAssetPrealnum:A}});const E=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,A,{senderId:e.senderId,senderPublicKeyBuffer:e.senderPublicKeyBuffer,recipientId:a,assetInfo:E})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,increasedAssetPrealnum:s}=e.asset.increaseAsset;return t.magic===r&&t.assetType===n?s:"0"}};jf=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],jf);const{ArgumentIllegalException:ua}=le("CONTROLLER","TransferTransactionFactory");let ru=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async commonVerifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const s=e.recipientId;if(!s)throw new ua(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.senderId===s)throw new ua(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${s}`,...n});if(e.fromMagic!==r.magic)throw new ua(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ua(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new ua(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="assetType")throw new ua(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"assetType",...n});return i}};ru=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],ru);const{ArgumentIllegalException:U_}=le("CONTROLLER","TransferAssetTransactionFactory");let nu=class extends ru{async verifyTransactionBody(e,t,r=this.configHelper){const n={target:"transferAssetAsset"},s=await super.commonVerifyTransactionBody(e,t,r),i=t.transferAsset;if(!i)throw new U_(c.PARAM_LOST,{param:"transferAsset"});const{sourceChainMagic:o,sourceChainName:a,assetType:p,amount:l}=i;if(o===this.configHelper.magic&&(this.checkChainName(a,"sourceChainName",n),this.checkChainMagic(o,"sourceChainMagic",n),this.checkAsset(p,"assetType",n)),s.value!==p)throw new U_(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`assetType ${p}`,to_target:"storage",be_target:"transferAsset"});this.checkAssetAmount(l,"amount",n)}init(e,t){return Zp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{amount:s,assetType:i,sourceChainMagic:o,sourceChainName:a}=e.asset.transferAsset,p=this.chainAssetInfoHelper.getAssetInfo(a,o,i);n.next=this._applyTransactionEmitAsset(t,e,s,{senderId:e.senderId,senderPublicKeyBuffer:e.senderPublicKeyBuffer,recipientId:e.recipientId,assetInfo:p})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.transferAsset;return t.magic===r&&t.assetType===n?s:"0"}};nu=u([ie()],nu);const{ArgumentIllegalException:ga}=le("CONTROLLER","TransferAnyTransactionFactory");let su=class extends ru{async verifyTransactionBody(e,t,r=this.configHelper){const n=await super.commonVerifyTransactionBody(e,t,r),s={target:"transferAnyAsset"};if(n.key!=="assetType")throw new ga(c.SHOULD_BE,{to_compare_prop:`storage.key ${n.key}`,to_target:"storage",be_compare_prop:"assetType",...s});const i=t.transferAny;if(!i)throw new ga(c.PARAM_LOST,{param:"transferAny"});const{sourceChainMagic:o,sourceChainName:a,parentAssetType:p,assetType:l,taxInformation:h}=i;if(o===this.configHelper.magic&&(this.checkChainName(a,"sourceChainName",s),this.checkChainMagic(o,"sourceChainMagic",s),this.checkAssetType(p,l,"assetType",s)),n.value!==l)throw new ga(c.NOT_MATCH,{to_compare_prop:`storage.value ${n.value}`,be_compare_prop:`assetType ${l}`,to_target:"storage",be_target:"transferAny",...s});if(this.checkAssetAmount(i.amount,"amount",s),p!==ne.ASSETS&&i.amount!=="1")throw new ga(c.SHOULD_BE,{to_compare_prop:`amount ${i.amount}`,to_target:"transferAny",be_compare_prop:"1"});if(p===ne.ENTITY)await this.checkTaxInformation(s,h);else if(h)throw new ga(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...s})}init(e,t){return gh.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,recipientId:o,asset:a}=e,{amount:p,assetType:l,sourceChainMagic:h,sourceChainName:y,parentAssetType:A,taxInformation:_}=a.transferAny;if(A===ne.ASSETS){const E=this.chainAssetInfoHelper.getAssetInfo(y,h,l);n.next=this._applyTransactionEmitAsset(t,e,p,{senderId:s,senderPublicKeyBuffer:i,recipientId:o,assetInfo:E})}else if(A===ne.DAPP)n.next=t.emit("changeDAppidPossessor",{type:"changeDAppidPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,possessorAddress:o,sourceChainName:y,sourceChainMagic:h,dappid:l}});else if(A===ne.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,possessorAddress:o,sourceChainName:y,sourceChainMagic:h,name:l}});else if(A===ne.ENTITY&&_){n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,possessorAddress:o,sourceChainName:y,sourceChainMagic:h,entityId:l}}),n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:y,sourceChainMagic:h,parentAssetType:A,assetType:l,taxInformation:_.toJSON()}});const E=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,_.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:i,recipientId:_.taxCollector,assetInfo:E})}else if(A===ne.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,possessorAddress:o,sourceChainName:y,sourceChainMagic:h,certificateId:l}});else throw new ga(c.PROP_IS_INVALID,{prop:`parentAssetType ${A}`,target:"transaction.asset.transferAsset"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.transferAny;return t.magic===r&&t.assetType===n?s:"0"}};su=u([ie()],su);const{ArgumentIllegalException:us}=le("CONTROLLER","DestroyAssetTransactionFactory");let iu=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const s=e.recipientId;if(!s)throw new us(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.senderId===s)throw new us(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${s}`,...n});if(e.fromMagic!==r.magic)throw new us(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new us(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new us(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="assetType")throw new us(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const o=t.destroyAsset;if(!o)throw new us(c.PARAM_LOST,{param:"destroyAsset"});const a={...n,target:"destroyAssetAsset"},{sourceChainMagic:p,sourceChainName:l,assetType:h}=o;if(l!==r.chainName)throw new us(c.SHOULD_BE,{to_compare_prop:"sourceChainName",to_target:"body",be_compare_prop:"local chain name",...a});if(p!==r.magic)throw new us(c.SHOULD_BE,{to_compare_prop:"sourceChainMagic",to_target:"body",be_compare_prop:"local chain magic",...a});if(this.checkAsset(h,"assetType",a),i.value!==h)throw new us(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`assetType ${h}`,to_target:"storage",be_target:"destroyAsset",...n});this.checkAssetAmount(o.amount,"amount",a)}init(e,t){return eh.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,recipientId:o}=e,{amount:a,assetType:p,sourceChainMagic:l,sourceChainName:h}=e.asset.destroyAsset,y=this.chainAssetInfoHelper.getAssetInfo(h,l,p);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:y,amount:`-${a}`,sourceAmount:a}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:o,publicKeyBuffer:i,assetInfo:y,amount:a,sourceAmount:a}}),n.next=t.emit("destroyAsset",{type:"destroyAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:e.senderPublicKeyBuffer,assetsApplyAddress:o,assetInfo:y,amount:a,sourceAmount:a}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.destroyAsset;return t.magic===r&&t.assetType===n?s:"0"}};iu=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],iu);const{ArgumentIllegalException:tn}=le("CONTROLLER","ToExchangeAssetTransactionFactory");let ou=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new tn(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new tn(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new tn(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});const s=t.toExchangeAsset;if(this.verifyToExchangeAsset(s,r),s.toExchangeNumber==="0")throw new tn(c.PROP_SHOULD_GT_FIELD,{prop:"toExchangeNumber",field:"0",target:"toExchangeAsset"});if(e.storage)throw new tn(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}verifyToExchangeAsset(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new tn(c.PARAM_LOST,{param:"toExchangeAsset"});const n={target:"toExchangeAssetAsset"},s=e.cipherPublicKeys,i=new Set(s);if(s.length!==i.size)throw new tn(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(s))throw new tn(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",...n});if(e.toExchangeSource===this.configHelper.magic&&(this.checkChainName(e.toExchangeChainName,"toExchangeChainName",n),this.checkChainMagic(e.toExchangeSource,"toExchangeSource",n),this.checkAsset(e.toExchangeAsset,"toExchangeAsset",n)),e.beExchangeSource===this.configHelper.magic&&(this.checkChainName(e.beExchangeChainName,"beExchangeChainName",n),this.checkChainMagic(e.beExchangeSource,"beExchangeSource",n),this.checkAsset(e.beExchangeAsset,"beExchangeAsset",n)),!e.toExchangeNumber)throw new tn(c.PROP_IS_REQUIRE,{prop:"toExchangeNumber",...n});if(!r.isValidAssetNumber(e.toExchangeNumber))throw new tn(c.PROP_IS_INVALID,{prop:"toExchangeNumber",type:"asset number",...n});if(e.toExchangeNumber==="0")throw new tn(c.PROP_SHOULD_GT_FIELD,{prop:"toExchangeNumber",field:"0",...n});if(!r.isValidRate(e.exchangeRate))throw new tn(c.PROP_IS_INVALID,{prop:`exchangeRate ${JSON.stringify(e.exchangeRate)}`,type:"rate",...n});if(e.toExchangeAsset===e.beExchangeAsset)throw new tn(c.SHOULD_NOT_BE,{to_compare_prop:`toExchangeAsset ${e.toExchangeAsset}`,to_target:"toExchangeAsset",be_compare_prop:e.beExchangeAsset})}init(e,t){return Ma.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{toExchangeChainName:s,toExchangeSource:i,toExchangeAsset:o,toExchangeNumber:a}=e.asset.toExchangeAsset,p=this.chainAssetInfoHelper.getAssetInfo(s,i,o);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:p,amount:`-${a}`,sourceAmount:a,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:e.signature,frozenReason:Et.EXCHANGE}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeSource:s,toExchangeAsset:i,toExchangeNumber:o}=e.asset.toExchangeAsset;return r===s&&n===i?o:"0"}};ou=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],ou);const{ArgumentIllegalException:rr}=le("CONTROLLER","BeExchangeAssetTransactionFactory");let zf=class extends Ze{constructor(e,t,r,n,s,i,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=i,this.toExchangeAssetTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s,jsbiHelper:i}=this;if(!e.recipientId)throw new rr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new rr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new rr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new rr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="transactionSignature")throw new rr(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const a=t.beExchangeAsset;if(!a)throw new rr(c.PARAM_LOST,{param:"beExchangeAsset"});const p={...n,target:"beExchangeAsset"},{transactionSignature:l}=a;if(!l)throw new rr(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...p});if(!s.isValidSignature(l))throw new rr(c.PROP_IS_INVALID,{prop:`transactionSignature ${l}`,type:"transaction signature",...p});if(o.value!==l)throw new rr(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`transactionSignature ${l}`,to_target:"storage",be_target:"beExchangeAsset",...n});const{toExchangeNumber:h,beExchangeNumber:y}=a;if(!h)throw new rr(c.PROP_IS_REQUIRE,{prop:"toExchangeNumber",...p});if(!s.isValidAssetNumber(h))throw new rr(c.PROP_IS_INVALID,{prop:"toExchangeNumber",type:"asset number",...p});if(!y)throw new rr(c.PROP_IS_REQUIRE,{prop:"beExchangeNumber",...p});if(!s.isValidAssetNumber(y))throw new rr(c.PROP_IS_INVALID,{prop:"beExchangeNumber",type:"asset number",...p});const{exchangeAsset:A,ciphertextSignature:_}=a;if(this.toExchangeAssetTransactionFactory.verifyToExchangeAsset(A),BigInt(h)>BigInt(A.toExchangeNumber))throw new rr(c.PROP_SHOULD_LTE_FIELD,{prop:`toExchangeNumber ${h}`,field:A.toExchangeNumber,...p});if(!s.isValidRate(A.exchangeRate))throw new rr(c.PROP_IS_INVALID,{prop:`exchangeRate ${A.exchangeRate}`,type:"rate",...p});const{cipherPublicKeys:E}=A;if(E.length>0){if(!_)throw new rr(c.NOT_EXIST,{prop:`ciphertextSignature ${_}`,...p});if(!s.isValidAccountSignature(_))throw new rr(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${_}`,...p});const{signature:T,publicKey:w}=_;if(!E.includes(w))throw new rr(c.NOT_MATCH,{to_compare_prop:`publicKey ${w}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...p});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:be(w),ciphertextSignatureBuffer:be(T),transactionSignatureBuffer:be(l),senderId:e.senderId}))throw new rr(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${T}`,type:"signature",...p})}else if(_)throw new rr(c.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${_}`,...p})}init(e,t){return ih.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{exchangeAsset:s,toExchangeNumber:i,beExchangeNumber:o}=e.asset.beExchangeAsset,{toExchangeChainName:a,toExchangeSource:p,toExchangeAsset:l,beExchangeChainName:h,beExchangeSource:y,beExchangeAsset:A}=s,_=this.chainAssetInfoHelper.getAssetInfo(h,y,A);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:_,amount:`-${o}`,sourceAmount:o}});const E=e.recipientId;n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:E,assetInfo:_,amount:o,sourceAmount:o}});const T=this.chainAssetInfoHelper.getAssetInfo(a,p,l);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:T,amount:i,sourceAmount:i,recipientId:E,frozenId:e.asset.beExchangeAsset.transactionSignature,frozenReason:Et.EXCHANGE}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{exchangeAsset:s,toExchangeNumber:i,beExchangeNumber:o}=e.asset.beExchangeAsset,{toExchangeSource:a,beExchangeSource:p,toExchangeAsset:l,beExchangeAsset:h}=s;return r===a&&n===l?i:r===p&&n===h?o:"0"}};zf=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Lt,ou])],zf);const{ArgumentIllegalException:fa}=le("CONTROLLER","GiftTransactionFactory");let au=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=i}async commonVerifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new fa(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new fa(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new fa(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new fa(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="assetType")throw new fa(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"assetType",...n});return s}checkTransactionFee(e,t,r=this.configHelper){const{maxTransactionSize:n,minTransactionFeePerByte:s}=r,i=n*(t+1),o={numerator:BigInt(e),denominator:i};if(this.jsbiHelper.compareFraction(o,s)<0){const a=this.jsbiHelper.multiplyCeilFraction(o.denominator,s).toString();throw new fa(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:He.TRANSACTION_FEE_NOT_ENOUGH,minFee:a.toString(),target:"body"})}}};au=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Lt])],au);const{ArgumentIllegalException:gs}=le("CONTROLLER","GiftAssetTransactionFactory");let cu=class extends au{async verifyTransactionBody(e,t,r=this.configHelper){const n=await this.commonVerifyTransactionBody(e,t,r),s=t.giftAsset;if(this.verifyGiftAsset(s,r),s.giftDistributionRule===2&&e.rangeType!==1)throw new gs(c.SHOULD_BE,{to_compare_prop:`rangeType ${e.rangeType}`,to_target:"body",be_compare_prop:1});if(s.beginUnfrozenBlockHeight&&s.beginUnfrozenBlockHeight>=e.effectiveBlockHeight)throw new gs(c.PROP_SHOULD_LT_FIELD,{prop:`beginUnfrozenBlockHeight ${s.beginUnfrozenBlockHeight}`,field:e.effectiveBlockHeight,target:"giftAsset"});if(n.value!==s.assetType)throw new gs(c.NOT_MATCH,{to_compare_prop:`storage.value ${n.value}`,be_compare_prop:`assetType ${s.assetType}`,to_target:"storage",be_target:"giftAsset"});this.checkTransactionFee(e.fee,s.totalGrabableTimes,r)}verifyGiftAsset(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new gs(c.PARAM_LOST,{param:"giftAsset"});const n={target:"giftAssetAsset"},s=e.cipherPublicKeys,i=new Set(s);if(s.length!==i.size)throw new gs(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(s))throw new gs(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",type:"cipher publicKeys",...n});const{sourceChainMagic:o,sourceChainName:a,assetType:p,amount:l,giftDistributionRule:h,totalGrabableTimes:y,beginUnfrozenBlockHeight:A}=e;if(o===this.configHelper.magic&&(this.checkChainName(a,"sourceChainName",n),this.checkChainMagic(o,"sourceChainMagic",n),this.checkAsset(p,"assetType",n)),!r.isPositiveInteger(y))throw new gs(c.PROP_IS_INVALID,{prop:`totalGrabableTimes ${y}`,type:"positive integer",...n});if(y>t.maxGrabTimesOfGiftAsset)throw new gs(c.PROP_SHOULD_LTE_FIELD,{prop:`totalGrabableTimes ${y}`,field:t.maxGrabTimesOfGiftAsset,...n});if(A!==void 0&&!r.isPositiveInteger(A))throw new gs(c.PROP_IS_INVALID,{prop:`beginUnfrozenBlockHeight ${A}`,type:"positive integer",...n});if(h!==1&&h!==0&&h!==2)throw new gs(c.PROP_IS_INVALID,{prop:`giftDistributionRule ${h}`,type:"enum of GIFT_DISTRIBUTION_RULE",...n});this.checkAssetAmount(l,"amount",n)}init(e,t){return mo.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{chainAssetInfoHelper:s}=this,{amount:i,assetType:o,sourceChainMagic:a,sourceChainName:p,totalGrabableTimes:l}=e.asset.giftAsset,h=s.getAssetInfo(p,a,o),y=this.transactionHelper.getTransactionMinEffectiveHeight(e),A=this.transactionHelper.getTransactionMaxEffectiveHeight(e);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:h,amount:`-${i}`,sourceAmount:i,minEffectiveHeight:y,maxEffectiveHeight:A,totalUnfrozenTimes:l,frozenId:e.signature,frozenReason:Et.GIFT}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.giftAsset;return t.magic===r&&t.assetType===n?s:"0"}};cu=u([ie()],cu);const{ArgumentIllegalException:Br}=le("CONTROLLER","GiftAnyTransactionFactory");let Gh=class extends au{async verifyTransactionBody(e,t,r=this.configHelper){const n=await this.commonVerifyTransactionBody(e,t,r),s=t.giftAny;if(await this.verifyGiftAny(s,r),s.giftDistributionRule===2&&e.rangeType!==1)throw new Br(c.SHOULD_BE,{to_compare_prop:`rangeType ${e.rangeType}`,to_target:"body",be_compare_prop:1});if(s.beginUnfrozenBlockHeight&&s.beginUnfrozenBlockHeight>=e.effectiveBlockHeight)throw new Br(c.PROP_SHOULD_LT_FIELD,{prop:`beginUnfrozenBlockHeight ${s.beginUnfrozenBlockHeight}`,field:e.effectiveBlockHeight,target:"giftAsset"});if(n.value!==s.assetType)throw new Br(c.NOT_MATCH,{to_compare_prop:`storage.value ${n.value}`,be_compare_prop:`assetType ${s.assetType}`,to_target:"storage",be_target:"giftAsset"});this.checkTransactionFee(e.fee,s.totalGrabableTimes,r)}async verifyGiftAny(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new Br(c.PARAM_LOST,{param:"giftAny"});const n={target:"giftAnyAsset"},s=e.cipherPublicKeys,i=new Set(s);if(s.length!==i.size)throw new Br(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(e.cipherPublicKeys))throw new Br(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",...n});const{sourceChainMagic:o,sourceChainName:a,parentAssetType:p,assetType:l,amount:h,giftDistributionRule:y,totalGrabableTimes:A,beginUnfrozenBlockHeight:_,taxInformation:E}=e;if(o===this.configHelper.magic&&(this.checkChainName(a,"sourceChainName",n),this.checkChainMagic(o,"sourceChainMagic",n),this.checkAssetType(p,l,"assetType",n)),!r.isPositiveInteger(A))throw new Br(c.PROP_IS_INVALID,{prop:`totalGrabableTimes ${A}`,type:"positive integer",...n});if(A>t.maxGrabTimesOfGiftAsset)throw new Br(c.PROP_SHOULD_LTE_FIELD,{prop:`totalGrabableTimes ${A}`,field:t.maxGrabTimesOfGiftAsset,...n});if(_!==void 0&&!r.isPositiveInteger(_))throw new Br(c.PROP_IS_INVALID,{prop:`beginUnfrozenBlockHeight ${e.beginUnfrozenBlockHeight}`,type:"positive integer",...n});if(this.checkAssetAmount(h,"amount",n),p===ne.ASSETS){if(y===void 0)throw new Br(c.PROP_IS_REQUIRE,{prop:"giftDistributionRule",...n});if(y!==1&&y!==0&&y!==2)throw new Br(c.PROP_IS_INVALID,{prop:`giftDistributionRule ${y}`,type:"enum of GIFT_DISTRIBUTION_RULE",...n})}else{if(A!==1)throw new Br(c.SHOULD_BE,{to_compare_prop:`totalGrabableTimes ${A}`,to_target:"giftAny",be_compare_prop:1});if(h!=="1")throw new Br(c.SHOULD_BE,{to_compare_prop:`amount ${h}`,to_target:"giftAny",be_compare_prop:"1"});if(y!==void 0)throw new Br(c.SHOULD_NOT_EXIST,{prop:"giftDistributionRule",target:"giftAny"})}if(p===ne.ENTITY)await this.checkTaxInformation(n,E);else if(E)throw new Br(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...n})}init(e,t){return Io.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{chainAssetInfoHelper:s}=this,{senderId:i,senderPublicKeyBuffer:o,signature:a,asset:p}=e,{taxInformation:l,amount:h,assetType:y,parentAssetType:A,sourceChainMagic:_,sourceChainName:E,totalGrabableTimes:T}=p.giftAny,w=this.transactionHelper.getTransactionMinEffectiveHeight(e),C=this.transactionHelper.getTransactionMaxEffectiveHeight(e);if(A===ne.ASSETS){const N=s.getAssetInfo(E,_,y);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:i,publicKeyBuffer:o,assetInfo:N,amount:`-${h}`,sourceAmount:h,minEffectiveHeight:w,maxEffectiveHeight:C,totalUnfrozenTimes:T,frozenId:a,frozenReason:Et.GIFT}})}else if(A===ne.DAPP)n.next=t.emit("frozenDAppid",{type:"frozenDAppid",transaction:e,applyInfo:{address:i,sourceChainName:E,sourceChainMagic:_,dappid:y,minEffectiveHeight:w,maxEffectiveHeight:C,status:17,frozenId:a}});else if(A===ne.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:i,sourceChainName:E,sourceChainMagic:_,name:y,minEffectiveHeight:w,maxEffectiveHeight:C,status:17,frozenId:a}});else if(A===ne.ENTITY&&l){n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:i,sourceChainName:E,sourceChainMagic:_,entityId:y,minEffectiveHeight:w,maxEffectiveHeight:C,status:17,frozenId:a}}),n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:E,sourceChainMagic:_,parentAssetType:A,assetType:y,taxInformation:l.toJSON()}});const{taxAssetPrealnum:N}=l;if(N!=="0"){const L=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:i,publicKeyBuffer:o,assetInfo:L,amount:`-${N}`,sourceAmount:N,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:a,frozenReason:Et.GIFT}})}}else if(A===ne.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:i,sourceChainName:E,sourceChainMagic:_,certificateId:y,minEffectiveHeight:w,maxEffectiveHeight:C,status:17,frozenId:a}});else throw new Br(c.PROP_IS_INVALID,{prop:`parentAssetType ${A}`,target:"transaction.asset.giftAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.giftAny;return t.magic===r&&t.assetType===n?s:"0"}};Gh=u([ie()],Gh);const{ArgumentIllegalException:Pr}=le("CONTROLLER","GrabAssetTransactionFactory");let Jf=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.__giftAssetTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Pr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Pr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Pr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Pr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="transactionSignature")throw new Pr(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const o=t.grabAsset;if(!o)throw new Pr(c.PARAM_LOST,{param:"grabAsset"});const a={...n,target:"grabAssetAsset"},{blockSignature:p,transactionSignature:l}=o;if(!p)throw new Pr(c.PROP_IS_REQUIRE,{prop:"blockSignature",...a});if(!s.isValidSignature(p))throw new Pr(c.PROP_IS_INVALID,{prop:`blockSignature ${p}`,type:"block signature",...a});if(!l)throw new Pr(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...a});if(!s.isValidSignature(l))throw new Pr(c.PROP_IS_INVALID,{prop:`transactionSignature ${l}`,type:"transaction signature",...a});if(i.value!==l)throw new Pr(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`transactionSignature ${l}`,to_target:"storage",be_target:"grabAsset",...n});this.checkAssetAmount(o.amount,"amount",a);const{giftAsset:h,ciphertextSignature:y}=o;this.__giftAssetTransactionFactory.verifyGiftAsset(h);const{cipherPublicKeys:A}=h;if(A.length>0){if(!y)throw new Pr(c.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...a});if(!s.isValidAccountSignature(y))throw new Pr(c.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...a});const{publicKey:_,signature:E}=y;if(!A.includes(_))throw new Pr(c.NOT_MATCH,{to_compare_prop:`publicKey ${_}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...a});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:be(_),ciphertextSignatureBuffer:be(E),transactionSignatureBuffer:be(l),senderId:e.senderId}))throw new Pr(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${E}`,type:"signature",...a})}else if(y)throw new Pr(c.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${y}`,type:"grabAsset",...a})}init(e,t){return th.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{const{chainAssetInfoHelper:s}=this,{grabAsset:i}=e.asset,{amount:o,transactionSignature:a}=i,{assetType:p,sourceChainMagic:l,sourceChainName:h}=i.giftAsset,y=e.recipientId,A=s.getAssetInfo(h,l,p);n.next=super.applyTransaction(e,t,r),n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:A,amount:o,sourceAmount:o,recipientId:y,frozenId:a,frozenReason:Et.GIFT}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{amount:r,giftAsset:n}=e.asset.grabAsset,{sourceChainMagic:s,assetType:i}=n;return t.magic===s&&t.assetType===i?r:"0"}};Jf=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,cu])],Jf);const{ArgumentIllegalException:Ar}=le("CONTROLLER","GrabAnyTransactionFactory");let pu=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.__giftAnyTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Ar(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Ar(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Ar(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Ar(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="transactionSignature")throw new Ar(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const o=t.grabAny;if(!o)throw new Ar(c.PARAM_LOST,{param:"grabAny"});const a={...n,target:"grabAnyAsset"},{blockSignature:p,transactionSignature:l}=o;if(!p)throw new Ar(c.PROP_IS_REQUIRE,{prop:"blockSignature",...a});if(!s.isValidSignature(p))throw new Ar(c.PROP_IS_INVALID,{prop:`blockSignature ${p}`,type:"block signature",...a});if(!l)throw new Ar(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...a});if(!s.isValidSignature(l))throw new Ar(c.PROP_IS_INVALID,{prop:`transactionSignature ${l}`,type:"transaction signature",...a});if(i.value!==l)throw new Ar(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`transactionSignature ${l}`,to_target:"storage",be_target:"grabAsset",...n});this.checkAssetAmount(o.amount,"amount",a);const{giftAny:h,ciphertextSignature:y}=o;await this.__giftAnyTransactionFactory.verifyGiftAny(h);const{cipherPublicKeys:A}=h;if(A.length>0){if(!y)throw new Ar(c.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...a});if(!s.isValidAccountSignature(y))throw new Ar(c.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...a});const{publicKey:_,signature:E}=y;if(!A.includes(_))throw new Ar(c.NOT_MATCH,{to_compare_prop:`publicKey ${_}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...a});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:be(_),ciphertextSignatureBuffer:be(E),transactionSignatureBuffer:be(l),senderId:e.senderId}))throw new Ar(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${E}`,type:"signature",...a})}else if(y)throw new Ar(c.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${y}`,type:"grabAsset",...a})}init(e,t){return fh.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{const{chainAssetInfoHelper:s}=this,{senderId:i,recipientId:o,senderPublicKeyBuffer:a,asset:p}=e,{amount:l,giftAny:h,transactionSignature:y}=p.grabAny,{assetType:A,parentAssetType:_,sourceChainMagic:E,sourceChainName:T}=h,w=s.getAssetInfo(T,E,A);if(n.next=super.applyTransaction(e,t,r),_===ne.ASSETS)n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:i,publicKeyBuffer:a,assetInfo:w,amount:l,sourceAmount:l,recipientId:o,frozenId:y,frozenReason:Et.GIFT}});else if(_===ne.DAPP)n.next=t.emit("unfrozenDAppid",{type:"unfrozenDAppid",transaction:e,applyInfo:{address:i,publicKeyBuffer:a,possessorAddress:i,sourceChainName:T,sourceChainMagic:E,dappid:A,status:0,frozenId:y}});else if(_===ne.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:i,publicKeyBuffer:a,possessorAddress:i,sourceChainName:T,sourceChainMagic:E,name:A,status:0,frozenId:y}});else if(_===ne.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:i,publicKeyBuffer:a,possessorAddress:i,sourceChainName:T,sourceChainMagic:E,entityId:A,status:0,frozenId:y}}),h.taxInformation){const{taxCollector:C,taxAssetPrealnum:N}=h.taxInformation,L=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);N==="0"?n.next=this._applyTransactionEmitAsset(t,e,N,{senderId:i,senderPublicKeyBuffer:a,recipientId:C,assetInfo:L}):n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:C,publicKeyBuffer:a,assetInfo:L,amount:N,sourceAmount:N,recipientId:o,frozenId:y,frozenReason:Et.GIFT}})}}else if(_===ne.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:i,publicKeyBuffer:a,possessorAddress:i,sourceChainName:T,sourceChainMagic:E,certificateId:A,status:0,frozenId:y}});else throw new Ar(c.PROP_IS_INVALID,{prop:`parentAssetType ${_}`,target:"transaction.asset.grabAny.giftAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{amount:r,giftAny:n}=e.asset.grabAny,{sourceChainMagic:s,assetType:i}=n;return t.magic===s&&t.assetType===i?r:"0"}};pu=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Gh])],pu);const{ArgumentIllegalException:ur}=le("CONTROLLER","TrustAssetTransactionFactory");let hu=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{senderId:s,recipientId:i}=e;if(!i)throw new ur(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(s===i)throw new ur(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${s}`,to_target:"body",be_compare_prop:`recipientId ${i}`,...n});if(e.fromMagic!==r.magic)throw new ur(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ur(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new ur(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="assetType")throw new ur(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const a=t.trustAsset;await this.verifyTrustAsset(a,s,i);const p=a.trustees;if(!p.includes(s))throw new ur(c.SHOULD_INCLUDE,{prop:"trustees",value:`senderId ${s}`,...n,target:"trustAsset"});if(!p.includes(i))throw new ur(c.SHOULD_INCLUDE,{prop:"trustee",value:`recipientId ${i}`,...n,target:"trustAsset"});if(o.value!==a.assetType)throw new ur(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`assetType ${a.assetType}`,to_target:"storage",be_target:"trustAsset",...n})}async verifyTrustAsset(e,t,r){const{baseHelper:n,accountBaseHelper:s}=this;if(!e)throw new ur(c.PARAM_LOST,{param:"trustAsset"});const i={target:"trustAssetAsset"},{trustees:o,numberOfSignFor:a,sourceChainName:p,sourceChainMagic:l}=e;if(!n.isArray(o))throw new ur(c.PROP_IS_INVALID,{prop:"trustees",type:"string array",...i,target:"trustAsset"});if(o.length<0)throw new ur(c.PROP_IS_REQUIRE,{prop:`trustees length ${o.length}`,...i});for(const y of o)if(!await s.isAddress(y))throw new ur(c.PROP_IS_INVALID,{prop:`trustee ${y}`,type:"account address",target:"trustees"});const h=[...new Set([...o,t,r])];if(o.length!==h.length)throw new ur(c.SHOULD_NOT_DUPLICATE,{prop:"trustee",...i});if(!n.isPositiveInteger(a))throw new ur(c.PROP_IS_INVALID,{prop:`numberOfSignFor ${a}`,type:"positive integer",...i});if(a>h.length)throw new ur(c.PROP_SHOULD_LTE_FIELD,{prop:`numberOfSignFor ${a}`,field:h.length,...i,target:"trustAsset"});if(a<1)throw new ur(c.PROP_SHOULD_GTE_FIELD,{prop:`numberOfSignFor ${a}`,field:1,...i,target:"trustAsset"});if(l===this.configHelper.magic&&(this.checkChainName(p,"sourceChainName",i),this.checkChainMagic(l,"sourceChainMagic",i),this.checkAsset(e.assetType,"assetType",i)),this.checkAssetAmount(e.amount,"amount",i),e.amount==="0")throw new ur(c.PROP_SHOULD_GT_FIELD,{prop:`amount ${e.amount}`,fueld:"0",...i})}init(e,t){return Ha.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{amount:s,assetType:i,sourceChainMagic:o,sourceChainName:a,numberOfSignFor:p}=e.asset.trustAsset,l=this.chainAssetInfoHelper.getAssetInfo(a,o,i);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:l,amount:`-${s}`,sourceAmount:s,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),totalUnfrozenTimes:p,frozenId:e.signature,frozenReason:Et.TRUST}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.trustAsset;return t.magic===r&&t.assetType===n?s:"0"}};hu=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],hu);const{ArgumentIllegalException:Vr}=le("CONTROLLER","signForAssetTransactionFactory");let Yf=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.trustAssetTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s,accountBaseHelper:i,transactionHelper:o}=this,a=e.recipientId;if(!a)throw new Vr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});const p=e.senderId;if(e.fromMagic!==r.magic)throw new Vr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Vr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Vr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const l=e.storage;if(l.key!=="transactionSignature")throw new Vr(c.SHOULD_BE,{to_compare_prop:`storage.key ${l.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const h={...n,target:"signForAssetAsset"},y=t.signForAsset;if(!y)throw new Vr(c.PARAM_LOST,{param:"signForAsset"});const{trustAsset:A,trustSenderId:_,trustRecipientId:E,transactionSignature:T}=y;if(!T)throw new Vr(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...h});if(!s.isValidSignature(T))throw new Vr(c.PROP_IS_INVALID,{prop:`transactionSignature ${T}`,type:"transaction signature",...h});if(l.value!==T)throw new Vr(c.NOT_MATCH,{to_compare_prop:`storage.value ${l.value}`,be_compare_prop:`transactionSignature ${T}`,to_target:"storage",be_target:"signForAsset",...n});if(!_)throw new Vr(c.PROP_IS_REQUIRE,{prop:"trustSenderId",...h});if(!await i.isAddress(_))throw new Vr(c.PROP_IS_INVALID,{prop:`trustSenderId ${_}`,type:"account address",...n,target:"trustAsset"});if(!E)throw new Vr(c.PROP_IS_REQUIRE,{prop:"trustRecipientId",...h});if(!await i.isAddress(E))throw new Vr(c.PROP_IS_INVALID,{prop:`trustRecipientId ${E}`,type:"account address",...h});if(a!==E)throw new Vr(c.SHOULD_BE,{to_compare_prop:`recipientId ${a}`,to_target:"body",be_compare_prop:`trustRecipientId ${E}`,...h});await this.trustAssetTransactionFactory.verifyTrustAsset(A,_,E);const{trustees:w}=A;if(![...new Set([...w,_,E])].includes(p))throw new Vr(c.PERMISSION_DENIED,{operationName:`sign for asset ${T}`,...h})}init(e,t){return rh.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{transactionSignature:s,trustSenderId:i,trustRecipientId:o,trustAsset:a}=e.asset.signForAsset,p=this.chainAssetInfoHelper.getAssetInfo(a.sourceChainName,a.sourceChainMagic,a.assetType);n.next=t.emit("signForAsset",{type:"signForAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:p,frozenAddress:i,recipientId:o,frozenId:s,frozenReason:Et.TRUST}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.signForAsset.trustAsset;return t.magic===r&&t.assetType===n?s:"0"}};Yf=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,hu])],Yf);const{ArgumentIllegalException:rn}=le("CONTROLLER","EmigrateAssetTransactionFactory");let Qf=class extends Ze{constructor(e,t,r,n,s,i){super(),this.baseHelper=e,this.configHelper=t,this.accountBaseHelper=r,this.transactionHelper=n,this.chainAssetInfoHelper=s,this.migrateCertificateHelper=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new rn(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new rn(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic===r.magic)throw new rn(c.SHOULD_NOT_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new rn(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="assetType")throw new rn(c.SHOULD_BE,{to_compare_prop:`key ${s.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const i=t.emigrateAsset;if(!i)throw new rn(c.PARAM_LOST,{param:"emigrateAsset"});if(!i.migrateCertificate)throw new rn(c.PROP_IS_REQUIRE,{prop:"migrateCertificate",target:"emigrateAsset"});let o;try{o=JSON.parse(i.migrateCertificate)}catch{throw new rn(c.PROP_IS_INVALID,{prop:"migrateCertificate",target:"emigrateAsset"})}const a=await this.migrateCertificateHelper.verifyMigrateCertificate(o,{forceCheckFromChainInfo:!0,fromChainBaseConfig:{chainName:r.chainName,magic:r.magic,generatorPublicKey:r.generatorPublicKey,genesisBlockSignature:r.signature,genesisGenerators:this.transactionHelper.genesisGenerators(r)},forceCheckFromAuthSignature:!0});if(o.toAuthSignature)throw new rn(c.SHOULD_NOT_EXIST,{prop:"toAuthSignature",...n,target:"aemigrateAsset.migrateCertificate"});const{toChainId:p,fromId:l,toId:h,assetId:y}=o.body,A=a.fromId.decode(l);if(e.senderId!==A)throw new rn(c.NOT_MATCH,{to_compare_prop:`senderId ${e.senderId}`,be_compare_prop:`fromId ${A}`,to_target:"body",be_target:"migrateCertificate",...n});const _=a.toId.decode(h);if(e.recipientId!==_)throw new rn(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`toId ${_}`,to_target:"body",be_target:"migrateCertificate",...n});const E=a.toChainId.decode(p);if(e.toMagic!==E.magic)throw new rn(c.NOT_MATCH,{to_compare_prop:`toMagic ${e.toMagic}`,be_compare_prop:`toChainId ${E.magic}`,to_target:"body",be_target:"migrateCertificate",...n});const T=a.assetId.decode(y);if(s.value!==T.assetType)throw new rn(c.NOT_MATCH,{to_compare_prop:`value ${s.value}`,be_compare_prop:`assetTypeId ${T.assetType}`,to_target:"storage",be_target:"migrateCertificateBody",...n})}init(e,t){return nh.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i}=e;n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,accountStatus:17}})})}};Qf=u([ie(),g("design:paramtypes",[Le,ue,Te,we,Ge,si])],Qf);const{ArgumentIllegalException:nn}=le("CONTROLLER","ImmigrateAssetTransactionFactory");let Xf=class extends Ze{constructor(e,t,r,n,s,i){super(),this.baseHelper=e,this.configHelper=t,this.accountBaseHelper=r,this.transactionHelper=n,this.chainAssetInfoHelper=s,this.migrateCertificateHelper=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new nn(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic===r.magic)throw new nn(c.SHOULD_NOT_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new nn(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new nn(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="assetType")throw new nn(c.SHOULD_BE,{to_compare_prop:`key ${s.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const i=t.immigrateAsset;if(!i)throw new nn(c.PARAM_LOST,{param:"immigrateAsset"});const o={...n,target:"immigrateAsset"};if(!i.migrateCertificate)throw new nn(c.PROP_IS_REQUIRE,{prop:"migrateCertificate",...o});let a;try{a=JSON.parse(i.migrateCertificate)}catch{throw new nn(c.PROP_IS_INVALID,{prop:"migrateCertificate",...o})}const p=await this.migrateCertificateHelper.verifyMigrateCertificate(a,{forceCheckToChainInfo:!0,toChainBaseConfig:{chainName:r.chainName,magic:r.magic,generatorPublicKey:r.generatorPublicKey,genesisBlockSignature:r.signature,genesisGenerators:this.transactionHelper.genesisGenerators(r)},forceCheckToAuthSignature:!0,forceCheckFromAuthSignature:!0}),{fromChainId:l,toId:h,assetId:y}=a.body,A=p.toId.decode(h,!0);if(e.recipientId!==A)throw new nn(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`toId ${A}`,to_target:"body",be_target:"migrateCertificate",...n});const _=p.fromChainId.decode(l,!0);if(e.fromMagic!==_.magic)throw new nn(c.NOT_MATCH,{to_compare_prop:`fromMagic ${e.fromMagic}`,be_compare_prop:`fromChainId ${_.magic}`,to_target:"body",be_target:"migrateCertificate",...n});const E=p.assetId.decode(y,!0);if(s.value!==E.assetType)throw new nn(c.NOT_MATCH,{to_compare_prop:`value ${s.value}`,be_compare_prop:`asset ${JSON.stringify(E)}`,to_target:"storage",be_target:"migrateCertificate",...n})}init(e,t){return sh.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);let s;try{s=JSON.parse(e.asset.immigrateAsset.migrateCertificate)}catch{throw new nn(c.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const i=this.migrateCertificateHelper.getMigrateCertificateConverter(s),{fromChainId:o,assetId:a,assetPrealnum:p}=s.body,l=i.fromChainId.decode(o),h=i.assetId.decode(a),{parentAssetType:y,assetType:A}=h;if(y===ne.ASSETS){const _=this.chainAssetInfoHelper.getAssetInfo(l.chainName,l.magic,A);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:e.recipientId,assetInfo:_,amount:p,sourceAmount:p}})}else throw new Error("");n.next=t.emit("migrateCertificate",{type:"migrateCertificate",transaction:e,applyInfo:{migrateCertificateId:i.getUUID(s),assetInfo:{chainName:l.chainName,magic:l.magic,assetType:A},assets:p,migrateIdBuffer:e.signatureBuffer}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){let r;try{r=JSON.parse(e.asset.immigrateAsset.migrateCertificate)}catch{throw new nn(c.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const n=this.migrateCertificateHelper.getMigrateCertificateConverter(r),{fromChainId:s,assetId:i,assetPrealnum:o}=r.body,a=n.fromChainId.decode(s),p=n.assetId.decode(i);return t.magic===a.magic&&t.assetType===p.assetType?o:"0"}};Xf=u([ie(),g("design:paramtypes",[Le,ue,Te,we,Ge,si])],Xf);const{ArgumentIllegalException:Un}=le("CONTROLLER","StakeAssetTransactionFactory");let lu=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new Un(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Un(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Un(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Un(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="stakeId")throw new Un(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"stakeId",...n});const i=t.stakeAsset;if(!i)throw new Un(c.PARAM_LOST,{param:"stakeAsset"});const o={target:"stakeAssetAsset"},{baseHelper:a}=this,{stakeId:p,sourceChainName:l,sourceChainMagic:h,assetType:y,assetPrealnum:A,beginUnstakeHeight:_}=i;if(a.isValidStakeId(p)===!1)throw new Un(c.PROP_IS_INVALID,{prop:`stakeId ${p}`,...o});if(h===this.configHelper.magic&&(this.checkChainName(l,"sourceChainName",o),this.checkChainMagic(h,"sourceChainMagic",o),this.checkAsset(y,"assetType",o)),this.checkAssetAmount(A,"assetPrealnum",o),A==="0")throw new Un(c.PROP_SHOULD_GT_FIELD,{prop:`assetPrealnum ${A}`,fueld:"0",...o});if(a.isPositiveInteger(_)===!1)throw new Un(c.PROP_IS_INVALID,{prop:`beginUnstakeHeight ${_}`,...o});if(i.beginUnstakeHeight<e.applyBlockHeight)throw new Un(c.PROP_SHOULD_GT_FIELD,{prop:`beginUnstakeHeight ${i.beginUnstakeHeight}`,field:e.applyBlockHeight,target:"stakeAssetAsset"});if(s.value!==i.stakeId)throw new Un(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`stakeId ${i.stakeId}`,to_target:"storage",be_target:"stakeAsset",...n})}init(e,t){return _o.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i}=e,{stakeId:o,assetType:a,sourceChainName:p,sourceChainMagic:l,assetPrealnum:h,beginUnstakeHeight:y}=e.asset.stakeAsset,A=this.chainAssetInfoHelper.getAssetInfo(p,l,a);n.next=t.emit("stakeAsset",{type:"stakeAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:A,amount:`-${h}`,sourceAmount:h,beginUnstakeHeight:y,stakeId:o}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,assetPrealnum:s}=e.asset.stakeAsset;return t.magic===r&&t.assetType===n?s:"0"}};lu=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],lu);const{ArgumentIllegalException:fs}=le("CONTROLLER","UnstakeAssetTransactionFactory");let Wf=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.stakeAssetTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s,accountBaseHelper:i}=this;if(e.recipientId)throw new fs(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new fs(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new fs(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new fs(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="stakeId")throw new fs(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"stakeId",...n});const a=t.unstakeAsset;if(!a)throw new fs(c.PARAM_LOST,{param:"unstakeAsset"});const p={target:"unstakeAssetAsset"},{stakeId:l,sourceChainName:h,sourceChainMagic:y,assetType:A,assetPrealnum:_}=a;if(s.isValidStakeId(l)===!1)throw new fs(c.PROP_IS_INVALID,{prop:`stakeId ${l}`,...p});if(y===this.configHelper.magic&&(this.checkChainName(h,"sourceChainName",p),this.checkChainMagic(y,"sourceChainMagic",p),this.checkAsset(A,"assetType",p)),this.checkAssetAmount(_,"assetPrealnum",p),_==="0")throw new fs(c.PROP_SHOULD_GT_FIELD,{prop:`assetPrealnum ${_}`,fueld:"0",...p});if(o.value!==l)throw new fs(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`stakeId ${l}`,to_target:"storage",be_target:"unstakeAsset",...n});if(this.checkAssetAmount(_,"assetPrealnum",p),_==="0")throw new fs(c.PROP_SHOULD_GT_FIELD,{prop:`assetPrealnum ${_}`,fueld:"0",...p})}init(e,t){return oh.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s}=e,{stakeId:i,sourceChainName:o,sourceChainMagic:a,assetType:p,assetPrealnum:l}=e.asset.unstakeAsset,h=this.chainAssetInfoHelper.getAssetInfo(o,a,p);n.next=t.emit("unstakeAsset",{type:"unstakeAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:h,amount:l,sourceAmount:l,stakeId:i}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,assetPrealnum:s}=e.asset.unstakeAsset;return t.magic===r&&t.assetType===n?s:"0"}};Wf=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,lu])],Wf);const{ArgumentIllegalException:Wt}=le("CONTROLLER","LocationNameTransactionFactory");let qf=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Wt(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Wt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Wt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Wt(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="name")throw new Wt(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"name",...n});const o=t.locationName;if(!o)throw new Wt(c.PARAM_LOST,{param:"locationName"});const a={...n,target:"locationName"},p=o.name;if(!p)throw new Wt(c.PROP_IS_REQUIRE,{prop:"name",...a});if(!s.isString(p))throw new Wt(c.PROP_IS_INVALID,{prop:`name ${p}`,type:"string",...a});if(p.length>512)throw new Wt(c.OVER_LENGTH,{prop:`name ${p}`,limit:512,...a});if(s.isStartWithOrEndWithPoint(p))throw new Wt(c.SHOULD_NOT_START_WITH_OR_END_WITH,{prop:`name ${p}`,field:".",...a});const l=p.split("."),h=l.length;if(h<2)throw new Wt(c.PROP_IS_INVALID,{prop:`name ${p}`,...a});for(let E=0;E<h;E++){const T=l[E];if(T.length>128)throw new Wt(c.OVER_LENGTH,{prop:`name ${T}`,limit:128,...a});if(E===h-2){if(!s.isLowerCaseLetter(T))throw new Wt(c.PROP_IS_INVALID,{prop:`name ${T}`,type:"lowercase",...a})}else if(E===h-1){if(T!==r.chainName)throw new Wt(c.SHOULD_BE,{to_compare_prop:"root location name",to_target:`name ${T}`,be_compare_prop:r.chainName,...a})}else if(T.length<=2){if(!s.isLowerCaseLetterOrNumber(T))throw new Wt(c.PROP_IS_INVALID,{prop:`name ${T}`,type:"lowercase letter or number",...a})}else if(!s.isLowerCaseLetterOrNumberOrUnderline(T))throw new Wt(c.PROP_IS_INVALID,{prop:`name ${T}`,type:"lowercase letter or number or underline",...a})}if(i.value!==p)throw new Wt(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`name ${p}`,to_target:"storage",be_target:"locationName",...n});const{sourceChainName:y,sourceChainMagic:A,operationType:_}=o;if(this.checkChainName(y,"sourceChainName",a),y!==r.chainName)throw new Wt(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${y}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(A,"sourceChainMagic",a),A!==r.magic)throw new Wt(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${A}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(_!==0&&_!==1)throw new Wt(c.NOT_MATCH,{to_compare_prop:`operationType ${_}`,be_compare_prop:"locationNameType",to_target:"locationName",be_target:"LOCATION_NAME_OPERATION_TYPE",...a});if(_===1&&e.senderId!==e.recipientId)throw new Wt(c.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"transaction",be_compare_prop:e.senderId,...n})}init(e,t){return ah.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i}=e,{name:o,sourceChainMagic:a,sourceChainName:p,operationType:l}=e.asset.locationName;l===0?n.next=t.emit("registerLocationName",{type:"registerLocationName",transaction:e,applyInfo:{address:s,name:o,sourceChainMagic:a,sourceChainName:p,possessorAddress:i,status:0}}):n.next=t.emit("cancelLocationName",{type:"cancelLocationName",transaction:e,applyInfo:{address:s,sourceChainName:p,sourceChainMagic:a,name:o,status:255}})})}};qf=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],qf);const{ArgumentIllegalException:Ms}=le("CONTROLLER","SetLnsManagerTransactionFactory");let Zf=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Ms(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Ms(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Ms(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Ms(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="name")throw new Ms(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"name",...n});const o=t.lnsManager;if(!o)throw new Ms(c.PARAM_LOST,{param:"lnsManager"});const a={...n,target:"lnsManagerAsset"},p=o.name;if(!p)throw new Ms(c.PROP_IS_REQUIRE,{prop:"name",...a});if(!s.isValidLocationName(p))throw new Ms(c.PROP_IS_INVALID,{prop:`name ${p}`,type:"location name",...a});if(i.value!==p)throw new Ms(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`name ${p}`,to_target:"storage",be_target:"lnsManager",...n});const{sourceChainName:l,sourceChainMagic:h}=o;this.checkChainName(l,"sourceChainName",a),this.checkChainMagic(h,"sourceChainMagic",a)}init(e,t){return ch.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{name:s,sourceChainMagic:i,sourceChainName:o}=e.asset.lnsManager;n.next=t.emit("setLnsManager",{type:"setLnsManager",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:o,sourceChainMagic:i,name:s,manager:e.recipientId}})})}};Zf=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],Zf);const{ArgumentIllegalException:ht}=le("CONTROLLER","SetLnsRecordValueTransactionFactory");let ed=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(e.recipientId)throw new ht(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ht(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ht(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new ht(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="name")throw new ht(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"name",...n});const o=t.lnsRecordValue;if(!o)throw new ht(c.PARAM_LOST,{param:"lnsRecordValue"});const a={...n,target:"lnsRecordValueAsset"},p=o.name;if(!p)throw new ht(c.PROP_IS_REQUIRE,{prop:"name",...a});if(!s.isValidLocationName(p))throw new ht(c.PROP_IS_INVALID,{prop:`name ${p}`,type:"location name",...a});if(i.value!==p)throw new ht(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`name ${p}`,to_target:"storage",be_target:"lnsRecordValue",...n});const{sourceChainName:l,sourceChainMagic:h}=o;switch(this.checkChainName(l,"sourceChainName",a),this.checkChainMagic(h,"sourceChainMagic",a),o.operationType){case 0:if(!o.addRecord)throw new ht(c.PROP_IS_REQUIRE,{prop:"addRecord",...a});if(o.deleteRecord)throw new ht(c.SHOULD_NOT_EXIST,{prop:"deleteRecord",...a});await this.checkLocationNameRecord(o.addRecord);break;case 1:if(o.addRecord)throw new ht(c.SHOULD_NOT_EXIST,{prop:"addRecord",...a});if(!o.deleteRecord)throw new ht(c.PROP_IS_REQUIRE,{prop:"deleteRecord",...a});await this.checkLocationNameRecord(o.deleteRecord);break;case 2:if(!o.addRecord)throw new ht(c.PROP_IS_REQUIRE,{prop:"addRecord",...a});if(!o.deleteRecord)throw new ht(c.PROP_IS_REQUIRE,{prop:"deleteRecord",...a});await this.checkLocationNameRecord(o.addRecord),await this.checkLocationNameRecord(o.deleteRecord);break;default:throw new ht(c.PROP_IS_INVALID,{prop:"operationType",type:"location name operation type",...a})}}async checkLocationNameRecord(e){const{baseHelper:t,accountBaseHelper:r}=this;if(!e)throw new ht(c.PARAM_LOST,{param:"record"});const n={target:"lnsRecordValue"},{recordType:s,recordValue:i}=e;if(!t.isString(i))throw new ht(c.NOT_A_STRING,{prop:"recordValue",value:i,...n});if(s===1){if(!t.isIpV4(i))throw new ht(c.NOT_A_IPV4,{prop:"recordValue",value:i,...n})}else if(s===2){if(!t.isIpV6(i))throw new ht(c.NOT_A_IPV6,{prop:"recordValue",value:i,...n})}else if(s===3){const o=i.split(",");if(o.length!==2)throw new ht(c.NOT_A_LONGITUDE_LATITUDE,{prop:"recordValue",value:i,...n});if(!t.isLongitude(o[0]))throw new ht(c.NOT_A_LONGITUDE,{prop:"recordValue",value:i,...n});if(!t.isLatitude(o[1]))throw new ht(c.NOT_A_LATITUDE,{prop:"recordValue",value:i,...n})}else if(s===4){if(!await r.isAddress(i))throw new ht(c.NOT_A_ADDRESS,{prop:"recordValue",value:i,...n})}else if(s===5){if(!t.isValidLocationName(i))throw new ht(c.NOT_A_LOCATION_NAME,{prop:"recordValue",value:i,...n})}else if(s===6){if(!t.isDNS(i))throw new ht(c.NOT_A_DNS,{prop:"recordValue",value:i,...n})}else if(s===8){if(!t.isEmail(i))throw new ht(c.NOT_A_EMAIL,{prop:"recordValue",value:i,...n})}else if(s===7){if(!t.isURL(i))throw new ht(c.NOT_A_URL,{prop:"recordValue",value:i,...n})}else if(s!==0)throw new ht(c.NOT_EXIST,{prop:"recordType",...n})}init(e,t){return ph.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{name:s,sourceChainMagic:i,sourceChainName:o,operationType:a,addRecord:p,deleteRecord:l}=e.asset.lnsRecordValue;n.next=t.emit("setLnsRecordValue",{type:"setLnsRecordValue",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainMagic:i,sourceChainName:o,name:s,operationType:a,addRecord:p,deleteRecord:l}})})}};ed=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],ed);const{ArgumentIllegalException:ir}=le("CONTROLLER","IssueEntityFactoryTransactionFactory");let Do=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=i}async commonVerifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new ir(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ir(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ir(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new ir(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="factoryId")throw new ir(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"factoryId",...n});const i=t.issueEntityFactory;if(this.verifyIssueEntityFactoryAsset(i,r),s.value!==i.factoryId)throw new ir(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`factoryId ${i.factoryId}`,to_target:"storage",be_target:"dapp",...n})}async verifyTransactionBody(e,t,r=this.configHelper){if(await this.commonVerifyTransactionBody(e,t,r),e.senderId===e.recipientId)throw new ir(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${e.recipientId}`,target:"body"})}verifyIssueEntityFactoryAsset(e,t=this.configHelper){const{baseHelper:r}=this,n={target:"body"};if(!e)throw new ir(c.PARAM_LOST,{param:"issueEntityFactory",...n});const s={...n,target:"issueEntityFactory"},{sourceChainMagic:i,sourceChainName:o,factoryId:a,entityPrealnum:p,entityFrozenAssetPrealnum:l,purchaseAssetPrealnum:h}=e;if(o!==t.chainName)throw new ir(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${o}`,to_target:"body",be_compare_prop:"local chain name",...n});if(i!==t.magic)throw new ir(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${i}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!a)throw new ir(c.PROP_IS_REQUIRE,{prop:"factoryId",...s});if(!r.isString(a))throw new ir(c.PROP_IS_INVALID,{prop:`factoryId ${a}`,type:"string",...s});const y=a.length;if(y<3||y>15)throw new ir(c.NOT_IN_EXPECTED_RANGE,{prop:`factoryId ${a}`,type:"string length",min:3,max:15,...s});if(!r.isLowerCaseLetterOrNumber(a))throw new ir(c.PROP_IS_INVALID,{prop:`factoryId ${a}`,type:"lowercase letter or number",...s});if(!r.isPositiveStringNumber(p))throw new ir(c.PROP_IS_INVALID,{prop:`entityPrealnum ${p}`,type:"positive integer",IssueEntityFactoryAsset_Exception_Detail:s});if(!l)throw new ir(c.PROP_IS_REQUIRE,{prop:"entityFrozenAssetPrealnum",...s});if(!r.isValidAssetPrealnum(l))throw new ir(c.PROP_IS_INVALID,{prop:`entityFrozenAssetPrealnum ${l}`,type:"string number",...s});if(!h)throw new ir(c.PROP_IS_REQUIRE,{prop:"purchaseAssetPrealnum",...s});if(!r.isValidAssetPrealnum(h))throw new ir(c.PROP_IS_INVALID,{prop:`purchaseAssetPrealnum ${h}`,type:"string number",...s})}init(e,t){return hh.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{sourceChainName:s,sourceChainMagic:i,factoryId:o,entityPrealnum:a,entityFrozenAssetPrealnum:p,purchaseAssetPrealnum:l}=e.asset.issueEntityFactory;n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,accountStatus:16}}),n.next=t.emit("issueEntityFactoryByFrozen",{type:"issueEntityFactoryByFrozen",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:s,sourceChainMagic:i,factoryId:o,entityPrealnum:a,entityFrozenAssetPrealnum:p,possessorAddress:e.recipientId,purchaseAssetPrealnum:l,status:0}})})}};Do=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Lt])],Do);let uu=class extends Do{async verifyTransactionBody(e,t,r=this.configHelper){await this.commonVerifyTransactionBody(e,t,r)}init(e,t){return lh.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Qe(n=>{const{senderId:s,recipientId:i,senderPublicKeyBuffer:o,fee:a}=e,p=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("fee",{type:"fee",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:p,amount:"-"+e.fee,sourceAmount:e.fee}}),n.next=t.emit("count",{type:"count",transaction:e});const{sourceChainName:l,sourceChainMagic:h,factoryId:y,entityPrealnum:A,entityFrozenAssetPrealnum:_,purchaseAssetPrealnum:E}=e.asset.issueEntityFactory,T=this.transactionHelper.calcDestroyMainAssetsOfIsseuEntityFactory(A,r);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:p,amount:"-"+T,sourceAmount:T}}),n.next=t.emit("destroyMainAsset",{type:"destroyMainAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:p,amount:"-"+T,sourceAmount:T}}),n.next=t.emit("issueEntityFactoryByDestroy",{type:"issueEntityFactoryByDestroy",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:l,sourceChainMagic:h,factoryId:y,entityPrealnum:A,entityFrozenAssetPrealnum:_,possessorAddress:e.recipientId,purchaseAssetPrealnum:E,status:0}})})}};uu=u([ie()],uu);const{ArgumentIllegalException:or}=le("CONTROLLER","IssueEntityTransactionFactory");let gu=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.issueEntityFactoryTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new or(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new or(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new or(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new or(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="entityId")throw new or(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"entityId",...n});const o=t.issueEntity;if(!o)throw new or(c.PARAM_LOST,{param:"issueEntity"});const a={...n,target:"issueEntityAsset"},{sourceChainName:p,sourceChainMagic:l,entityId:h,taxAssetPrealnum:y,entityFactoryPossessor:A,entityFactory:_}=o;if(p!==r.chainName)throw new or(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${p}`,to_target:"body",be_compare_prop:"local chain name",...n});if(l!==r.magic)throw new or(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${p}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!A)throw new or(c.PROP_IS_REQUIRE,{prop:"entityFactoryPossessor",...n});if(!await this.accountBaseHelper.isAddress(A))throw new or(c.PROP_IS_INVALID,{prop:`entityFactoryPossessor ${A}`,type:"account address",...n,target:"issueEntity"});if(!h)throw new or(c.PROP_IS_REQUIRE,{prop:"entityId",...a});const E=h.split("_");if(E.length!==2)throw new or(c.PROP_IS_INVALID,{prop:`entityId ${h}`,...a});if(!s.isValidEntityFactoryId(E[0]))throw new or(c.PROP_IS_INVALID,{prop:`factoryId ${E[0]}`,...a});const T=E[1].length;if(T<3||T>30)throw new or(c.NOT_IN_EXPECTED_RANGE,{prop:`entityId ${E[1]}`,type:"string length",min:3,max:30,...a});if(!s.isLowerCaseLetterOrNumber(E[1]))throw new or(c.PROP_IS_INVALID,{prop:`entityId ${E[1]}`,type:"lowercase or number",...a});if(!y)throw new or(c.PROP_IS_REQUIRE,{prop:"taxAssetPrealnum",...a});if(!this.baseHelper.isValidAssetPrealnum(y))throw new or(c.PROP_IS_INVALID,{prop:`taxAssetPrealnum ${y}`,...a});if(i.value!==h)throw new or(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`entityId ${h}`,to_target:"storage",be_target:"issueEntityAsset",...n});if(this.issueEntityFactoryTransactionFactory.verifyIssueEntityFactoryAsset(_),E[0]!==_.factoryId)throw new or(c.NOT_MATCH,{to_compare_prop:`factoryId ${E[0]}`,be_compare_prop:`factoryId ${_.factoryId}`,to_target:"entityId",be_target:"entityFactory",...n})}init(e,t){return Ao.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Qe(n=>{const{senderId:s,recipientId:i,senderPublicKeyBuffer:o,signature:a}=e,{sourceChainName:p,sourceChainMagic:l,entityId:h,taxAssetPrealnum:y,entityFactoryPossessor:A,entityFactory:_,taxAssetRecipientId:E}=e.asset.issueEntity,{factoryId:T,entityFrozenAssetPrealnum:w,purchaseAssetPrealnum:C}=_,N=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("fee",{type:"fee",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:N,amount:"-"+e.fee,sourceAmount:e.fee}}),n.next=t.emit("count",{type:"count",transaction:e}),n.next=t.emit("issueEntity",{type:"issueEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,sourceChainName:p,sourceChainMagic:l,factoryId:T,entityId:h,taxAssetPrealnum:y,possessorAddress:i,entityFactoryPossessorAddress:A,entityFrozenAssetPrealnum:w,issueId:a,status:0,taxAssetRecipientId:E||s}}),w!=="0"&&(n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:N,amount:`-${w}`,sourceAmount:w,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),totalUnfrozenTimes:1,frozenId:a,frozenReason:Et.ENTITY}})),n.next=this._applyTransactionEmitAsset(t,e,C,{senderId:s,senderPublicKeyBuffer:o,recipientId:A,assetInfo:N})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,entityFrozenAssetPrealnum:n,purchaseAssetPrealnum:s}=e.asset.issueEntity.entityFactory;return t.magic===r&&t.assetType===this.configHelper.assetType?(BigInt(n)+BigInt(s)).toString():"0"}};gu=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Do])],gu);const{ArgumentIllegalException:gr}=le("CONTROLLER","DestroyEntityTransactionFactory");let td=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.issueEntityFactoryTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new gr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new gr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new gr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new gr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="entityId")throw new gr(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"entityId",...n});const i=t.destroyEntity;if(!i)throw new gr(c.PARAM_LOST,{param:"destroyEntity"});const o={...n,target:"destroyAssetAsset"},{sourceChainMagic:a,sourceChainName:p,entityId:l,entityFactoryApplicant:h,entityFactoryPossessor:y,entityFactory:A,transactionSignature:_}=i;if(p!==r.chainName)throw new gr(c.SHOULD_BE,{to_compare_prop:"sourceChainName",to_target:"body",be_compare_prop:"local chain name",...o});if(a!==r.magic)throw new gr(c.SHOULD_BE,{to_compare_prop:"sourceChainMagic",to_target:"body",be_compare_prop:"local chain magic",...o});const E=this.baseHelper;if(!l)throw new gr(c.PROP_IS_REQUIRE,{prop:"entityId",...o});if(!E.isValidEntityId(l))throw new gr(c.PROP_IS_INVALID,{prop:`entityId ${l}`,type:"entityId",...o});if(s.value!==l)throw new gr(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`entityId ${l}`,to_target:"storage",be_target:"destroyEntity",...n});if(!y)throw new gr(c.PROP_IS_REQUIRE,{prop:"entityFactoryPossessor",...n});if(!await this.accountBaseHelper.isAddress(y))throw new gr(c.PROP_IS_INVALID,{prop:`entityFactoryPossessor ${y}`,type:"account address",...n,target:"destroyEntity"});if(!h)throw new gr(c.PROP_IS_REQUIRE,{prop:"entityFactoryApplicant",...n});if(!await this.accountBaseHelper.isAddress(h))throw new gr(c.PROP_IS_INVALID,{prop:`entityFactoryApplicant ${h}`,type:"account address",...n,target:"destroyEntity"});this.issueEntityFactoryTransactionFactory.verifyIssueEntityFactoryAsset(A);const T=this.transactionHelper.getFactoryIdByEntityId(l);if(T!==A.factoryId)throw new gr(c.NOT_MATCH,{to_compare_prop:`factoryId ${T}`,be_compare_prop:`factoryId ${A.factoryId}`,to_target:"entityId",be_target:"entityFactory",...n});if(!_)throw new gr(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...o});if(!E.isValidTransactionSignature(_))throw new gr(c.PROP_IS_INVALID,{prop:`transactionSignature ${_}`,type:"transaction signature",...o})}init(e,t){return uh.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,recipientId:o}=e,{sourceChainMagic:a,sourceChainName:p,entityId:l,entityFactoryApplicant:h,entityFactoryPossessor:y,entityFactory:A,transactionSignature:_}=e.asset.destroyEntity;n.next=t.emit("destroyEntity",{type:"destroyEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,sourceChainMagic:a,sourceChainName:p,entityId:l,entityFactoryApplicantAddress:h,entityFactoryPossessorAddress:y,entityFactory:A.toJSON(),frozenId:_,status:255}});const E=A.entityFrozenAssetPrealnum;if(E!=="0"){const T=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:T,amount:E,sourceAmount:E,recipientId:o,frozenId:_,frozenReason:Et.ENTITY}})}})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,entityFactory:n}=e.asset.destroyEntity;return t.magic===r&&t.assetType===this.configHelper.assetType?n.entityFrozenAssetPrealnum:"0"}};td=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Do])],td);const{ArgumentIllegalException:St}=le("CONTROLLER","ToExchangeAnyTransactionFactory");let Kh=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new St(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new St(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new St(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic"});const s=t.toExchangeAny;if(await this.verifyToExchangeAny(s,r),s.toExchangeAssetPrealnum==="0")throw new St(c.PROP_SHOULD_GT_FIELD,{prop:"toExchangeAssetPrealnum",field:"0",target:"toExchangeAny"});if(e.storage)throw new St(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}async verifyToExchangeAny(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new St(c.PARAM_LOST,{param:"toExchangeAny"});const n={target:"toExchangeAnyAsset"},s=e.cipherPublicKeys,i=new Set(s);if(s.length!==i.size)throw new St(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(s))throw new St(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",...n});const{toExchangeParentAssetType:o,toExchangeAssetType:a,beExchangeParentAssetType:p,beExchangeAssetType:l}=e;this.checkParentAssetType(o,"toExchangeParentAssetType",n),this.checkParentAssetType(p,"beExchangeParentAssetType",n),e.toExchangeSource===this.configHelper.magic&&(this.checkChainName(e.toExchangeChainName,"toExchangeChainName",n),this.checkChainMagic(e.toExchangeSource,"toExchangeSource",n),this.checkAssetType(o,a,"toExchangeAssetType",n)),e.beExchangeSource===this.configHelper.magic&&(this.checkChainName(e.beExchangeChainName,"beExchangeChainName",n),this.checkChainMagic(e.beExchangeSource,"beExchangeSource",n),this.checkAssetType(p,l,"beExchangeAssetType",n));const{toExchangeAssetPrealnum:h,beExchangeAssetPrealnum:y,assetExchangeWeightRatio:A,taxInformation:_}=e;if(!h)throw new St(c.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...n});if(!r.isValidAssetNumber(h))throw new St(c.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...n});if(o===ne.ASSETS)if(p===ne.ASSETS){if(y)throw new St(c.SHOULD_NOT_EXIST,{prop:"beExchangeAssetPrealnum",...n});if(!A)throw new St(c.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",...n});if(!r.isValidAssetExchangeWeightRatio(A))throw new St(c.PROP_IS_INVALID,{prop:`assetExchangeWeightRatio ${JSON.stringify(A)}`,...n})}else{if(!y)throw new St(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...n});if(y!=="1")throw new St(c.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${y}`,to_target:"toExchangeAnyAsset",be_compare_prop:"1"});if(A)throw new St(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...n})}else{if(h!=="1")throw new St(c.SHOULD_BE,{to_compare_prop:`toExchangeAssetPrealnum ${h}`,to_target:"toExchangeAnyAsset",be_compare_prop:"1",...n});if(!y)throw new St(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...n});if(A)throw new St(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...n});if(!r.isValidAssetNumber(y))throw new St(c.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...n});if(p===ne.ASSETS){if(y==="0")throw new St(c.PROP_SHOULD_GT_FIELD,{prop:"beExchangeAssetPrealnum",field:"0",...n})}else if(y!=="1")throw new St(c.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${y}`,to_target:"toExchangeAnyAsset",be_compare_prop:"1"})}if(a===l)throw new St(c.SHOULD_NOT_BE,{to_compare_prop:`toExchangeAssetType ${a}`,to_target:"toExchangeAny",be_compare_prop:l});if(o===ne.ENTITY)await this.checkTaxInformation(n,_);else if(_)throw new St(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...n})}init(e,t){return La.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,signature:o}=e,{toExchangeChainName:a,toExchangeSource:p,toExchangeParentAssetType:l,toExchangeAssetType:h,toExchangeAssetPrealnum:y,taxInformation:A}=e.asset.toExchangeAny;if(l===ne.ASSETS){const _=this.chainAssetInfoHelper.getAssetInfo(a,p,h);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:_,amount:`-${y}`,sourceAmount:y,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o,frozenReason:Et.EXCHANGE}})}else if(l===ne.DAPP)n.next=t.emit("frozenDAppid",{type:"frozenDAppid",transaction:e,applyInfo:{address:s,sourceChainName:a,sourceChainMagic:p,dappid:h,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(l===ne.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:s,sourceChainName:a,sourceChainMagic:p,name:h,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(l===ne.ENTITY){if(n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:s,sourceChainName:a,sourceChainMagic:p,entityId:h,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}}),A){n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:a,sourceChainMagic:p,parentAssetType:l,assetType:h,taxInformation:A.toJSON()}});const{taxAssetPrealnum:_}=A;if(_!=="0"){const E=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:E,amount:`-${_}`,sourceAmount:_,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o,frozenReason:Et.EXCHANGE}})}}}else if(l===ne.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:s,sourceChainName:a,sourceChainMagic:p,certificateId:h,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else throw new St(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${l}`,target:"transaction.asset.toExchangeAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeSource:s,toExchangeAssetType:i,toExchangeAssetPrealnum:o}=e.asset.toExchangeAny;return r===s&&n===i?o:"0"}};Kh=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],Kh);const{ArgumentIllegalException:$t}=le("CONTROLLER","BeExchangeAnyTransactionFactory");let fu=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.toExchangeAnyTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new $t(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new $t(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new $t(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new $t(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="transactionSignature")throw new $t(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const o=t.beExchangeAny;if(!o)throw new $t(c.PARAM_LOST,{param:"beExchangeAny"});const a={...n,target:"beExchangeAny"},{transactionSignature:p}=o;if(!p)throw new $t(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...a});if(!s.isValidSignature(p))throw new $t(c.PROP_IS_INVALID,{prop:`transactionSignature ${p}`,type:"transaction signature",...a});if(i.value!==p)throw new $t(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`transactionSignature ${p}`,to_target:"storage",be_target:"beExchangeAny",...n});const{toExchangeAssetPrealnum:l,beExchangeAssetPrealnum:h}=o;if(!l)throw new $t(c.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...a});if(!s.isValidAssetNumber(l))throw new $t(c.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",type:"asset prealnum",...a});if(!h)throw new $t(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...a});if(!s.isValidAssetNumber(h))throw new $t(c.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",type:"asset prealnum",...a});const{exchangeAny:y,ciphertextSignature:A}=o;await this.toExchangeAnyTransactionFactory.verifyToExchangeAny(y);const{beExchangeParentAssetType:_}=y;if(BigInt(l)>BigInt(y.toExchangeAssetPrealnum))throw new $t(c.PROP_SHOULD_LTE_FIELD,{prop:`toExchangeAssetPrealnum ${l}`,field:y.toExchangeAssetPrealnum,...a});if(_===ne.ENTITY)await this.checkTaxInformation(a,o.taxInformation);else if(o.taxInformation)throw new $t(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...a});const{cipherPublicKeys:E}=y;if(E.length>0){if(!A)throw new $t(c.NOT_EXIST,{prop:`ciphertextSignature ${A}`,...a});if(!s.isValidAccountSignature(A))throw new $t(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${A}`,...a});const{signature:T,publicKey:w}=A;if(!E.includes(w))throw new $t(c.NOT_MATCH,{to_compare_prop:`publicKey ${w}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...a});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:be(w),ciphertextSignatureBuffer:be(T),transactionSignatureBuffer:be(p),senderId:e.senderId}))throw new $t(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${T}`,type:"signature",...a})}else if(A)throw new $t(c.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${A}`,...a})}init(e,t){return dh.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{exchangeAny:a,toExchangeAssetPrealnum:p,beExchangeAssetPrealnum:l,taxInformation:h,transactionSignature:y}=e.asset.beExchangeAny,{toExchangeChainName:A,toExchangeSource:_,toExchangeParentAssetType:E,toExchangeAssetType:T,beExchangeChainName:w,beExchangeSource:C,beExchangeParentAssetType:N,beExchangeAssetType:L}=a;if(E===ne.ASSETS){const B=this.chainAssetInfoHelper.getAssetInfo(A,_,T);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:B,amount:p,sourceAmount:p,recipientId:i,frozenId:y,frozenReason:Et.EXCHANGE}})}else{let B=s;if(p==="0"&&(B=i),E===ne.DAPP)n.next=t.emit("unfrozenDAppid",{type:"unfrozenDAppid",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:B,sourceChainName:A,sourceChainMagic:_,dappid:T,status:0,frozenId:y}});else if(E===ne.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:B,sourceChainName:A,sourceChainMagic:_,name:T,status:0,frozenId:y}});else if(E===ne.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:B,sourceChainName:A,sourceChainMagic:_,entityId:T,status:0,frozenId:y}}),a.taxInformation){const{taxCollector:$,taxAssetPrealnum:V}=a.taxInformation,G=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);V==="0"?n.next=this._applyTransactionEmitAsset(t,e,V,{senderId:s,senderPublicKeyBuffer:o,recipientId:$,assetInfo:G}):n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:$,publicKeyBuffer:o,assetInfo:G,amount:V,sourceAmount:V,frozenId:y,recipientId:i,frozenReason:Et.EXCHANGE}})}}else if(E===ne.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:B,sourceChainName:A,sourceChainMagic:_,certificateId:T,status:0,frozenId:y}});else throw new $t(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${E}`,target:"transaction.asset.beExchangeAny.exchangeAny"})}if(N===ne.ENTITY&&h&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:w,sourceChainMagic:C,parentAssetType:N,assetType:L,taxInformation:h.toJSON()}})),l==="0"){if(h){const B=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,"0",{senderId:s,senderPublicKeyBuffer:o,recipientId:h.taxCollector,assetInfo:B})}return}if(N===ne.ASSETS){const B=this.chainAssetInfoHelper.getAssetInfo(w,C,L);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:B,amount:`-${l}`,sourceAmount:l}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:i,assetInfo:B,amount:l,sourceAmount:l}})}else if(N===ne.DAPP)n.next=t.emit("changeDAppidPossessor",{type:"changeDAppidPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:w,sourceChainMagic:C,dappid:L}});else if(N===ne.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:w,sourceChainMagic:C,name:L}});else if(N===ne.ENTITY){if(n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:w,sourceChainMagic:C,entityId:L}}),h){const B=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,h.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:o,recipientId:h.taxCollector,assetInfo:B})}}else if(N===ne.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:w,sourceChainMagic:C,certificateId:L}});else throw new $t(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${N}`,target:"transaction.asset.beExchangeAny.exchangeAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{exchangeAny:s,toExchangeAssetPrealnum:i,beExchangeAssetPrealnum:o}=e.asset.beExchangeAny,{toExchangeSource:a,beExchangeSource:p,toExchangeAssetType:l,beExchangeAssetType:h}=s;return r===a&&n===l?i:r===p&&n===h?o:"0"}};fu=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Kh])],fu);const{ArgumentIllegalException:Vt}=le("CONTROLLER","IssueEntityMultiTransactionV1");let du=class extends Ze{constructor(e,t,r,n,s,i,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=i,this.issueEntityFactoryTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Vt(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Vt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Vt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Vt(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="factoryId")throw new Vt(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"factoryId",...n});const o=t.issueEntityMulti;if(!o)throw new Vt(c.PARAM_LOST,{param:"issueEntityMulti"});const a={...n,target:"issueEntityMultiAsset"},{sourceChainName:p,sourceChainMagic:l,entityStructList:h,entityFactoryPossessor:y,entityFactory:A}=o;if(this.issueEntityFactoryTransactionFactory.verifyIssueEntityFactoryAsset(A),p!==r.chainName)throw new Vt(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${p}`,to_target:"body",be_compare_prop:"local chain name",...n});if(l!==r.magic)throw new Vt(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${p}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!y)throw new Vt(c.PROP_IS_REQUIRE,{prop:"entityFactoryPossessor",...n});if(!await this.accountBaseHelper.isAddress(y))throw new Vt(c.PROP_IS_INVALID,{prop:`entityFactoryPossessor ${y}`,type:"account address",...n,target:"issueEntityMulti"});const _=h.length;if(!(s.isArray(h)&&_>0))throw new Vt(c.PROP_IS_INVALID,{prop:`entityStructList ${JSON.stringify(h)}`,...n,target:"issueEntityMulti"});const E=A.factoryId,T=new Set;for(const{entityId:w,taxAssetPrealnum:C}of h){if(!w)throw new Vt(c.PROP_IS_REQUIRE,{prop:"entityId",...a});T.add(w);const N=w.split("_");if(N.length!==3)throw new Vt(c.PROP_IS_INVALID,{prop:`entityId ${w}`,target:"issueEntityMulti.entityStructList"});if(N[0]!=="m")throw new Vt(c.SHOULD_BE,{to_compare_prop:`entityId first item ${N[0]}`,be_compare_prop:"m",to_target:"issueEntityMulti.entityStructList"});if(!s.isValidEntityFactoryId(N[1]))throw new Vt(c.PROP_IS_INVALID,{prop:`factoryId ${N[0]}`,target:"issueEntityMulti.entityStructList"});if(N[1]!==E)throw new Vt(c.NOT_MATCH,{to_compare_prop:`factoryId ${N[1]}`,be_compare_prop:`factoryId ${E}`,to_target:"entityId",be_target:"entityFactory",...n});const L=N[2].length;if(L<3||L>30)throw new Vt(c.NOT_IN_EXPECTED_RANGE,{prop:`entityId ${N[2]}`,min:3,max:30,target:"issueEntityMulti.entityStructList"});if(!s.isLowerCaseLetterOrNumber(N[2]))throw new Vt(c.PROP_IS_INVALID,{prop:`entityId ${N[2]}`,target:"issueEntityMulti.entityStructList"});if(!C)throw new Vt(c.PROP_IS_REQUIRE,{prop:"taxAssetPrealnum",target:"issueEntityMulti.entityStructList"});if(!this.baseHelper.isValidAssetPrealnum(C))throw new Vt(c.PROP_IS_INVALID,{prop:`taxAssetPrealnum ${C}`,target:`issueEntityMulti.entityStructList ${w}`})}if(T.size<_)throw new Vt(c.SHOULD_NOT_DUPLICATE,{prop:`entityStructList ${JSON.stringify(h)}`,target:"issueEntityMulti"});if(i.value!==E)throw new Vt(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`factoryId ${E}`,to_target:"storage",be_target:"issueEntityMultiAsset",...n})}init(e,t){return Eo.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Qe(n=>{const{senderId:s,recipientId:i,senderPublicKeyBuffer:o,signature:a,fee:p}=e,{sourceChainName:l,sourceChainMagic:h,entityStructList:y,entityFactoryPossessor:A,entityFactory:_}=e.asset.issueEntityMulti,{factoryId:E,entityFrozenAssetPrealnum:T,purchaseAssetPrealnum:w}=_;n.next=super.applyTransaction(e,t,r),n.next=t.emit("issueEntityMulti",{type:"issueEntityMulti",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,sourceChainName:l,sourceChainMagic:h,factoryId:E,entityStructList:y.map(L=>({...L,taxAssetRecipientId:L.taxAssetRecipientId||s})),possessorAddress:i,entityFactoryPossessorAddress:A,entityFrozenAssetPrealnum:T,issueId:a,status:0}});const C=y.length,N=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);if(T!=="0"){const L=(BigInt(T)*BigInt(C)).toString();n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:N,amount:`-${L}`,sourceAmount:L,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),totalUnfrozenTimes:C,frozenId:a,frozenReason:Et.ENTITY}})}n.next=this._applyTransactionEmitAsset(t,e,(BigInt(w)*BigInt(C)).toString(),{senderId:s,senderPublicKeyBuffer:o,recipientId:A,assetInfo:N})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{entityStructList:r,entityFactory:n}=e.asset.issueEntityMulti,{sourceChainMagic:s,entityFrozenAssetPrealnum:i,purchaseAssetPrealnum:o}=n;if(t.magic===s&&t.assetType===this.configHelper.assetType){const a=r.length;return(BigInt(i)*BigInt(a)+BigInt(o)*BigInt(a)).toString()}return"0"}};du=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Lt,Do])],du);const{ArgumentIllegalException:yt}=le("CONTROLLER","ToExchangeAnyMultiTransactionFactory");let yu=class extends Ze{constructor(e,t,r,n,s,i){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new yt(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new yt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new yt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});const s=t.toExchangeAnyMulti;if(!s)throw new yt(c.PARAM_LOST,{param:"toExchangeAnyMulti",...n});const i=s.cipherPublicKeys,o=new Set(i);if(i.length!==o.size)throw new yt(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",target:"toExchangeAnyMulti"});if(!this.baseHelper.isValidCipherPublicKeys(i))throw new yt(c.PROP_IS_INVALID,{prop:"toExchangeAnyMulti.cipherPublicKeys",target:"toExchangeAnyMulti"});const{toExchangeAssets:a,beExchangeAsset:p}=s,l=await this.verifyToExchangeAnyMulti("toExchangeAnyMulti",a,p,r);for(const y of a)if(y.toExchangeAssetPrealnum==="0")throw new yt(c.PROP_SHOULD_GT_FIELD,{prop:"toExchangeAssetPrealnum",field:"0",target:"toExchangeAnyMulti.toExchangeAssets.toExchangeAsset"});const h=p.beExchangeAssetPrealnum;if(l){if(p.beExchangeParentAssetType!==ne.ASSETS){if(h!=="1")throw new yt(c.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${h}`,to_target:"toExchangeAnyMulti.beExchangeAsset",be_compare_prop:"1"})}else if(h==="0")throw new yt(c.PROP_SHOULD_GT_FIELD,{prop:`beExchangeAssetPrealnum ${h}`,target:"toExchangeAnyMulti.beExchangeAsset",field:"0"})}else if(h)throw new yt(c.SHOULD_NOT_EXIST,{prop:"beExchangeAssetPrealnum",target:"toExchangeAnyMulti.beExchangeAsset"});if(e.storage)throw new yt(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}async verifyToExchangeAnyMulti(e,t,r,n=this.configHelper){const{baseHelper:s}=this;if(!t)throw new yt(c.PARAM_LOST,{param:`${e}.toExchangeAssets`});if(!r)throw new yt(c.PARAM_LOST,{param:`${e}.beExchangeAsset`});if(t.length<=0)throw new yt(c.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"toExchangeAssets",target:e,field:0});const{beExchangeChainName:i,beExchangeSource:o,beExchangeParentAssetType:a,beExchangeAssetType:p,beExchangeAssetPrealnum:l}=r,h={target:`${e}.beExchangeAsset`},y=this.configHelper.magic;this.checkParentAssetType(a,"beExchangeParentAssetType",h),o===y&&(this.checkChainName(i,"beExchangeChainName",h),this.checkChainMagic(o,"beExchangeSource",h),this.checkAssetType(a,p,"beExchangeAssetType",h));let A=!1,_=new Set;const E={target:`${e}.toExchangeAssets.toExchangeAsset`};for(const T of t){const{toExchangeChainName:w,toExchangeSource:C,toExchangeParentAssetType:N,toExchangeAssetType:L,toExchangeAssetPrealnum:B,assetExchangeWeightRatio:$,taxInformation:V}=T;if(_.has(L))throw new yt(c.SHOULD_NOT_DUPLICATE,{prop:`toExchangeAssets ${JSON.stringify(t)}`,target:e});if(_.add(L),this.checkParentAssetType(N,"toExchangeParentAssetType",E),C===y&&(this.checkChainName(w,"toExchangeChainName",E),this.checkChainMagic(C,"toExchangeSource",E),this.checkAssetType(N,L,"toExchangeAssetType",E)),!B)throw new yt(c.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...E});if(!s.isValidAssetNumber(B))throw new yt(c.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...E});if(N===ne.ENTITY)await this.checkTaxInformation(E,V);else if(V)throw new yt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...E});if(N!==ne.ASSETS){if(A=!0,B!=="1")throw new yt(c.SHOULD_BE,{to_compare_prop:`toExchangeAssetPrealnum ${B}`,to_target:"toExchangeAnyMulti.toExchangeAssets",be_compare_prop:"1"});if($)throw new yt(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...E})}else if(a===ne.ASSETS){if(!$)throw new yt(c.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",...E});if(!s.isValidAssetExchangeWeightRatio($))throw new yt(c.PROP_IS_INVALID,{prop:`assetExchangeWeightRatio ${$}`,...E})}else{if($)throw new yt(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...E});A=!0}}if(_.has(p))throw new yt(c.SHOULD_NOT_BE,{to_compare_prop:`beExchangeAssetType ${p}`,to_target:"toExchangeAsset",be_compare_prop:p});if(A){if(!l)throw new yt(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...h});if(!s.isValidAssetNumber(l))throw new yt(c.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...h})}if(a===ne.ENTITY)await this.checkTaxInformation(h,r.taxInformation);else if(r.taxInformation)throw new yt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:`${e}.toExchangeAssets.beExchangeAsset`});return A}init(e,t){return Da.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,signature:o}=e,{toExchangeAssets:a,beExchangeAsset:p}=e.asset.toExchangeAnyMulti;let l=BigInt(0);for(const h of a){const{toExchangeSource:y,toExchangeChainName:A,toExchangeParentAssetType:_,toExchangeAssetType:E,toExchangeAssetPrealnum:T,taxInformation:w}=h;if(_===ne.ASSETS){const C=this.chainAssetInfoHelper.getAssetInfo(A,y,E);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:C,amount:`-${T}`,sourceAmount:T,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o,frozenReason:Et.EXCHANGE}})}else if(_===ne.DAPP)n.next=t.emit("frozenDAppid",{type:"frozenDAppid",transaction:e,applyInfo:{address:s,sourceChainName:A,sourceChainMagic:y,dappid:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(_===ne.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:s,sourceChainName:A,sourceChainMagic:y,name:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(_===ne.ENTITY){if(n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:s,sourceChainName:A,sourceChainMagic:y,entityId:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}}),w){n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:A,sourceChainMagic:y,parentAssetType:_,assetType:E,taxInformation:w.toJSON()}});const{taxAssetPrealnum:C}=w;C!=="0"&&(l+=BigInt(w.taxAssetPrealnum))}}else if(_===ne.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:s,sourceChainName:A,sourceChainMagic:y,certificateId:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else throw new yt(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${_}`,target:"transaction.asset.toExchangeAnyMulti"})}if(l!==BigInt(0)){const h=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:h,amount:`-${l.toString()}`,sourceAmount:l.toString(),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o+this.Buffer.from("_entity").toString("hex"),frozenReason:Et.EXCHANGE}})}p.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:p.beExchangeChainName,sourceChainMagic:p.beExchangeSource,parentAssetType:p.beExchangeParentAssetType,assetType:p.beExchangeAssetType,taxInformation:p.taxInformation.toJSON()}}))})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,s=e.asset.toExchangeAnyMulti.toExchangeAssets;for(const i of s){const{toExchangeSource:o,toExchangeAssetType:a,toExchangeAssetPrealnum:p}=i;if(r===o&&n===a)return p}return"0"}};yu=u([ie(),Ce(0,Z("Buffer")),g("design:paramtypes",[Object,Te,we,Le,ue,Ge])],yu);const{ArgumentIllegalException:lt}=le("CONTROLLER","BeExchangeAnyMultiTransactionFactory");let mu=class extends Ze{constructor(e,t,r,n,s,i){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=i}async verifyToExchangeAnyMulti(e,t,r,n=this.configHelper){const{baseHelper:s}=this;if(!t)throw new lt(c.PARAM_LOST,{param:`${e}.toExchangeAssets`});if(!r)throw new lt(c.PARAM_LOST,{param:`${e}.beExchangeAsset`});if(t.length<=0)throw new lt(c.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"toExchangeAssets",target:e,field:0});const{beExchangeChainName:i,beExchangeSource:o,beExchangeParentAssetType:a,beExchangeAssetType:p,beExchangeAssetPrealnum:l}=r,h={target:`${e}.beExchangeAsset`},y=this.configHelper.magic;this.checkParentAssetType(a,"beExchangeParentAssetType",h),o===y&&(this.checkChainName(i,"beExchangeChainName",h),this.checkChainMagic(o,"beExchangeSource",h),this.checkAssetType(a,p,"beExchangeAssetType",h));let A=!1,_=new Set;const E={target:`${e}.toExchangeAssets.toExchangeAsset`};for(const T of t){const{toExchangeChainName:w,toExchangeSource:C,toExchangeParentAssetType:N,toExchangeAssetType:L,toExchangeAssetPrealnum:B,assetExchangeWeightRatio:$,taxInformation:V}=T;if(_.has(L))throw new lt(c.SHOULD_NOT_DUPLICATE,{prop:`toExchangeAssets ${JSON.stringify(t)}`,target:e});if(_.add(L),this.checkParentAssetType(N,"toExchangeParentAssetType",E),C===y&&(this.checkChainName(w,"toExchangeChainName",E),this.checkChainMagic(C,"toExchangeSource",E),this.checkAssetType(N,L,"toExchangeAssetType",E)),!B)throw new lt(c.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...E});if(!s.isValidAssetNumber(B))throw new lt(c.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...E});if(N===ne.ENTITY)await this.checkTaxInformation(E,V);else if(V)throw new lt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...E});if(N!==ne.ASSETS){if(A=!0,$)throw new lt(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...E});if(a!==ne.ASSETS&&p===L)throw new lt(c.SHOULD_NOT_BE,{to_compare_prop:`beExchangeAssetType ${p}`,to_target:"toExchangeAnyMulti.beExchangeAsset",be_compare_prop:L})}else if(a===ne.ASSETS){if(!$)throw new lt(c.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",...E});if(!s.isValidAssetExchangeWeightRatio($))throw new lt(c.PROP_IS_INVALID,{prop:`assetExchangeWeightRatio ${$}`,...E})}else{if($)throw new lt(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...E});A=!0}}if(A){if(!l)throw new lt(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...h});if(!s.isValidAssetNumber(l))throw new lt(c.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...h})}return A}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new lt(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new lt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new lt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new lt(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="transactionSignature")throw new lt(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const o=t.beExchangeAnyMulti;if(!o)throw new lt(c.PARAM_LOST,{param:"beExchangeAnyMulti"});const a={...n,target:"beExchangeAnyMulti"},{transactionSignature:p}=o;if(!p)throw new lt(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...a});if(!s.isValidSignature(p))throw new lt(c.PROP_IS_INVALID,{prop:`transactionSignature ${p}`,type:"transaction signature",...a});if(i.value!==p)throw new lt(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`transactionSignature ${p}`,to_target:"storage",be_target:"beExchangeAnyMulti",...n});const{toExchangeAssets:l,beExchangeAsset:h,ciphertextSignature:y}=o;await this.verifyToExchangeAnyMulti("beExchangeAnyMulti",l,h,r);const{beExchangeParentAssetType:A,beExchangeAssetPrealnum:_,taxInformation:E}=h;if(!_)throw new lt(c.PROP_IS_REQUIRE,{prop:"beExchangeAsset.beExchangeAssetPrealnum",...a});if(A===ne.ENTITY)await this.checkTaxInformation(a,E);else if(E)throw new lt(c.SHOULD_NOT_EXIST,{prop:"beExchangeAsset.taxInformation",...a});if(y){if(!s.isValidAccountSignature(y))throw new lt(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${y}`,...a});const{signature:T,publicKey:w}=y;if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:be(w),ciphertextSignatureBuffer:be(T),transactionSignatureBuffer:be(p),senderId:e.senderId}))throw new lt(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${T}`,type:"signature",...a})}}init(e,t){return yh.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{toExchangeAssets:a,beExchangeAsset:p,transactionSignature:l}=e.asset.beExchangeAnyMulti,{beExchangeChainName:h,beExchangeSource:y,beExchangeParentAssetType:A,beExchangeAssetType:_,beExchangeAssetPrealnum:E}=p;let T=0;for(const w of a){const{toExchangeSource:C,toExchangeChainName:N,toExchangeParentAssetType:L,toExchangeAssetType:B,toExchangeAssetPrealnum:$,taxInformation:V}=w;if(L===ne.ASSETS){const G=this.chainAssetInfoHelper.getAssetInfo(N,C,B);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:G,amount:$,sourceAmount:$,frozenId:l,recipientId:i,frozenReason:Et.EXCHANGE}}),T++}else{let G=s;if($==="0"&&(G=i),L===ne.DAPP)n.next=t.emit("unfrozenDAppid",{type:"unfrozenDAppid",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:G,sourceChainName:N,sourceChainMagic:C,dappid:B,status:0,frozenId:l}}),T++;else if(L===ne.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:G,sourceChainName:N,sourceChainMagic:C,name:B,status:0,frozenId:l}}),T++;else if(L===ne.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:G,sourceChainName:N,sourceChainMagic:C,entityId:B,status:0,frozenId:l}}),T++,V){const{taxCollector:Y,taxAssetPrealnum:X}=V,U=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);X==="0"?n.next=this._applyTransactionEmitAsset(t,e,X,{senderId:s,senderPublicKeyBuffer:o,recipientId:Y,assetInfo:U}):n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:Y,assetInfo:U,amount:X,sourceAmount:X,recipientId:i,frozenId:l+this.Buffer.from("_entity").toString("hex"),frozenReason:Et.EXCHANGE}})}}else if(L===ne.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:G,sourceChainName:N,sourceChainMagic:C,certificateId:B,status:0,frozenId:l}});else throw new lt(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${L}`,target:"transaction.asset.beExchangeAnyMulti.toExchangeAsset"})}}if(A===ne.ENTITY&&p.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:h,sourceChainMagic:y,parentAssetType:A,assetType:_,taxInformation:p.taxInformation.toJSON()}})),E==="0"){if(p.taxInformation){const w=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,"0",{senderId:s,senderPublicKeyBuffer:o,recipientId:p.taxInformation.taxCollector,assetInfo:w})}return}if(A===ne.ASSETS){const w=this.chainAssetInfoHelper.getAssetInfo(h,y,_),C=(BigInt(E)*BigInt(T)).toString();n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:w,amount:`-${C}`,sourceAmount:C}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:i,assetInfo:w,amount:C,sourceAmount:C}})}else if(A===ne.DAPP)n.next=t.emit("changeDAppidPossessor",{type:"changeDAppidPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:h,sourceChainMagic:y,dappid:_}});else if(A===ne.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:h,sourceChainMagic:y,name:_}});else if(A===ne.ENTITY){if(n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:h,sourceChainMagic:y,entityId:_}}),p.taxInformation){const w=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,p.taxInformation.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:o,recipientId:p.taxInformation.taxCollector,assetInfo:w})}}else if(A===ne.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:h,sourceChainMagic:y,certificateId:_}});else throw new lt(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${A}`,target:"transaction.asset.beExchangeAnyMulti.beExchangeAsset"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeAssets:s,beExchangeAsset:i}=e.asset.beExchangeAnyMulti;for(const o of s){const{toExchangeSource:a,toExchangeAssetType:p,toExchangeAssetPrealnum:l}=o;if(r===a&&n===p)return l}return r===i.beExchangeSource&&n===i.beExchangeAssetType?i.beExchangeAssetPrealnum:"0"}};mu=u([ie(),Ce(0,Z("Buffer")),g("design:paramtypes",[Object,Te,we,Le,ue,Ge])],mu);const{ArgumentIllegalException:Nt}=le("CONTROLLER","ToExchangeAnyMultiAllTransactionFactory");let _u=class extends Ze{constructor(e,t,r,n,s,i){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new Nt(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Nt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Nt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});const s=t.toExchangeAnyMultiAll;if(!s)throw new Nt(c.PARAM_LOST,{param:"toExchangeAnyMultiAll",...n});const i=s.cipherPublicKeys,o=new Set(i);if(i.length!==o.size)throw new Nt(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",target:"toExchangeAnyMultiAll"});if(!this.baseHelper.isValidCipherPublicKeys(i))throw new Nt(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",target:"toExchangeAnyMultiAll"});const{toExchangeAssets:a,beExchangeAssets:p}=s;await this.verifyExchangeAnyMultiAll("toExchangeAnyMultiAll",a,p,r);for(const{beExchangeParentAssetType:l,beExchangeAssetPrealnum:h}of p)if(l===ne.ASSETS){if(h==="0")throw new Nt(c.PROP_SHOULD_GT_FIELD,{prop:"beExchangeAssetPrealnum",field:"0",target:"toExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}else if(h!=="1")throw new Nt(c.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${h}`,to_target:"toExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset",be_compare_prop:"1"});if(e.storage)throw new Nt(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}async verifyExchangeAnyMultiAll(e,t,r,n=this.configHelper){const{baseHelper:s}=this;if(!t)throw new Nt(c.PARAM_LOST,{param:`${e}.toExchangeAssets`});if(!r)throw new Nt(c.PARAM_LOST,{param:`${e}.beExchangeAssets`});if(t.length<=0)throw new Nt(c.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"toExchangeAssets",target:e,field:0});if(r.length<=0)throw new Nt(c.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"beExchangeAssets",target:e,field:0});const i=this.configHelper.magic,o=new Set,a={target:`${e}.toExchangeAssets.toExchangeAsset`};for(const h of t){const{toExchangeChainName:y,toExchangeSource:A,toExchangeParentAssetType:_,toExchangeAssetType:E,toExchangeAssetPrealnum:T,taxInformation:w}=h,C=`${A}-${E}`;if(o.has(C))throw new Nt(c.SHOULD_NOT_DUPLICATE,{prop:`toExchangeAssets.toExchangeAsset ${JSON.stringify(h)}`,target:e});if(o.add(C),this.checkParentAssetType(_,"toExchangeParentAssetType",a),A===i&&(this.checkChainName(y,"toExchangeChainName",a),this.checkChainMagic(A,"toExchangeSource",a),this.checkAssetType(_,E,"toExchangeAssetType",a)),!T)throw new Nt(c.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...a});if(!s.isValidAssetNumber(T))throw new Nt(c.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...a});if(_===ne.ENTITY)await this.checkTaxInformation(a,w);else if(w)throw new Nt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...a});if(_===ne.ASSETS){if(T==="0")throw new Nt(c.PROP_SHOULD_GT_FIELD,{prop:"toExchangeAssetPrealnum",field:"0",target:`${e}.toExchangeAssets.toExchangeAsset`})}else if(T!=="1")throw new Nt(c.SHOULD_BE,{to_compare_prop:`toExchangeAssetPrealnum ${T}`,to_target:`${e}.toExchangeAssets.toExchangeAsset`,be_compare_prop:"1"})}const p={target:`${e}.beExchangeAssets.beExchangeAsset`},l=new Set;for(const h of r){const{beExchangeChainName:y,beExchangeSource:A,beExchangeParentAssetType:_,beExchangeAssetType:E,beExchangeAssetPrealnum:T,taxInformation:w}=h,C=`${A}-${E}`;if(o.has(C))throw new Nt(c.SHOULD_NOT_BE,{to_compare_prop:`beExchangeAssetType ${E}`,to_target:"toExchangeAnyMultiAll.beExchangeAssets",be_compare_prop:E});if(l.has(C))throw new Nt(c.SHOULD_NOT_DUPLICATE,{prop:`beExchangeAssets.beExchangeAsset ${JSON.stringify(h)}`,target:e});if(l.add(C),this.checkParentAssetType(_,"beExchangeParentAssetType",p),A===i&&(this.checkChainName(y,"beExchangeChainName",p),this.checkChainMagic(A,"beExchangeSource",p),this.checkAssetType(_,E,"beExchangeAssetType",p)),!T)throw new Nt(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...p});if(!s.isValidAssetNumber(T))throw new Nt(c.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...p});if(_===ne.ENTITY)await this.checkTaxInformation(p,w);else if(w)throw new Nt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:`${e}.beExchangeAssets.beExchangeAsset`})}}init(e,t){return Fa.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,signature:o}=e,{toExchangeAssets:a,beExchangeAssets:p}=e.asset.toExchangeAnyMultiAll;let l=BigInt(0);for(const h of a){const{toExchangeSource:y,toExchangeChainName:A,toExchangeParentAssetType:_,toExchangeAssetType:E,toExchangeAssetPrealnum:T,taxInformation:w}=h;if(_===ne.ASSETS){const C=this.chainAssetInfoHelper.getAssetInfo(A,y,E);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:C,amount:`-${T}`,sourceAmount:T,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o,frozenReason:Et.EXCHANGE}})}else if(_===ne.DAPP)n.next=t.emit("frozenDAppid",{type:"frozenDAppid",transaction:e,applyInfo:{address:s,sourceChainName:A,sourceChainMagic:y,dappid:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(_===ne.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:s,sourceChainName:A,sourceChainMagic:y,name:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(_===ne.ENTITY){if(n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:s,sourceChainName:A,sourceChainMagic:y,entityId:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}}),w){n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:A,sourceChainMagic:y,parentAssetType:_,assetType:E,taxInformation:w.toJSON()}});const{taxAssetPrealnum:C}=w;C!=="0"&&(l+=BigInt(w.taxAssetPrealnum))}}else if(_===ne.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:s,sourceChainName:A,sourceChainMagic:y,certificateId:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else throw new Nt(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${_}`,target:"toExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}if(l!==BigInt(0)){const h=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:h,amount:`-${l.toString()}`,sourceAmount:l.toString(),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o+this.Buffer.from("_entity").toString("hex"),frozenReason:Et.EXCHANGE}})}for(const h of p)h.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:h.beExchangeChainName,sourceChainMagic:h.beExchangeSource,parentAssetType:h.beExchangeParentAssetType,assetType:h.beExchangeAssetType,taxInformation:h.taxInformation.toJSON()}}))})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,s=e.asset.toExchangeAnyMultiAll.toExchangeAssets;for(const i of s){const{toExchangeSource:o,toExchangeAssetType:a,toExchangeAssetPrealnum:p}=i;if(r===o&&n===a)return p}return"0"}};_u=u([ie(),Ce(0,Z("Buffer")),g("design:paramtypes",[Object,Te,we,Le,ue,Ge])],_u);const{ArgumentIllegalException:sn}=le("CONTROLLER","BeExchangeAnyMultiAllTransactionFactory");let rd=class extends Ze{constructor(e,t,r,n,s,i,o){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=i,this.toExchangeAnyMultiAllTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new sn(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new sn(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new sn(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new sn(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="transactionSignature")throw new sn(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const o=t.beExchangeAnyMultiAll;if(!o)throw new sn(c.PARAM_LOST,{param:"beExchangeAnyMultiAll"});const a={...n,target:"beExchangeAnyMultiAll"},{transactionSignature:p}=o;if(!p)throw new sn(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...a});if(!s.isValidSignature(p))throw new sn(c.PROP_IS_INVALID,{prop:`transactionSignature ${p}`,type:"transaction signature",...a});if(i.value!==p)throw new sn(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`transactionSignature ${p}`,to_target:"storage",be_target:"beExchangeAnyMultiAll",...n});const{toExchangeAssets:l,beExchangeAssets:h,ciphertextSignature:y}=o;if(await this.toExchangeAnyMultiAllTransactionFactory.verifyExchangeAnyMultiAll("beExchangeAnyMultiAll",l,h,r),y){if(!s.isValidAccountSignature(y))throw new sn(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${y}`,...a});const{signature:A,publicKey:_}=y;if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:be(_),ciphertextSignatureBuffer:be(A),transactionSignatureBuffer:be(p),senderId:e.senderId}))throw new sn(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${A}`,type:"signature",...a})}}init(e,t){return mh.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{toExchangeAssets:a,beExchangeAssets:p,transactionSignature:l}=e.asset.beExchangeAnyMultiAll;for(const h of a){const{toExchangeSource:y,toExchangeChainName:A,toExchangeParentAssetType:_,toExchangeAssetType:E,toExchangeAssetPrealnum:T,taxInformation:w}=h;if(_===ne.ASSETS){const C=this.chainAssetInfoHelper.getAssetInfo(A,y,E);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:C,amount:T,sourceAmount:T,frozenId:l,recipientId:i,frozenReason:Et.EXCHANGE}})}else{const C=s;if(_===ne.DAPP)n.next=t.emit("unfrozenDAppid",{type:"unfrozenDAppid",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:C,sourceChainName:A,sourceChainMagic:y,dappid:E,status:0,frozenId:l}});else if(_===ne.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:C,sourceChainName:A,sourceChainMagic:y,name:E,status:0,frozenId:l}});else if(_===ne.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:C,sourceChainName:A,sourceChainMagic:y,entityId:E,status:0,frozenId:l}}),w){const{taxCollector:N,taxAssetPrealnum:L}=w,B=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);L==="0"?n.next=this._applyTransactionEmitAsset(t,e,L,{senderId:s,senderPublicKeyBuffer:o,recipientId:N,assetInfo:B}):n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:N,assetInfo:B,amount:L,sourceAmount:L,recipientId:i,frozenId:l+this.Buffer.from("_entity").toString("hex"),frozenReason:Et.EXCHANGE}})}}else if(_===ne.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:C,sourceChainName:A,sourceChainMagic:y,certificateId:E,status:0,frozenId:l}});else throw new sn(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${_}`,target:"beExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}}for(const h of p){const{beExchangeChainName:y,beExchangeSource:A,beExchangeParentAssetType:_,beExchangeAssetType:E,beExchangeAssetPrealnum:T,taxInformation:w}=h;if(_===ne.ENTITY&&h.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:y,sourceChainMagic:A,parentAssetType:_,assetType:E,taxInformation:h.taxInformation.toJSON()}})),T==="0"){if(h.taxInformation){const C=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,"0",{senderId:s,senderPublicKeyBuffer:o,recipientId:h.taxInformation.taxCollector,assetInfo:C})}continue}if(_===ne.ASSETS){const C=this.chainAssetInfoHelper.getAssetInfo(y,A,E),N=T;n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:C,amount:`-${N}`,sourceAmount:N}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:i,assetInfo:C,amount:N,sourceAmount:N}})}else if(_===ne.DAPP)n.next=t.emit("changeDAppidPossessor",{type:"changeDAppidPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:y,sourceChainMagic:A,dappid:E}});else if(_===ne.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:y,sourceChainMagic:A,name:E}});else if(_===ne.ENTITY){if(n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:y,sourceChainMagic:A,entityId:E}}),w){const C=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,w.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:o,recipientId:w.taxCollector,assetInfo:C})}}else if(_===ne.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:y,sourceChainMagic:A,certificateId:E}});else throw new sn(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${_}`,target:"beExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeAssets:s,beExchangeAssets:i}=e.asset.beExchangeAnyMultiAll;for(const o of s){const{toExchangeSource:a,toExchangeAssetType:p,toExchangeAssetPrealnum:l}=o;if(r===a&&n===p)return l}for(const o of i)if(r===o.beExchangeSource&&n===o.beExchangeAssetType)return o.beExchangeAssetPrealnum;return"0"}};rd=u([ie(),Ce(0,Z("Buffer")),g("design:paramtypes",[Object,Te,we,Le,ue,Ge,_u])],rd);const{ArgumentIllegalException:Tn}=le("CONTROLLER","IssueCertificateTransactionFactory");let nd=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(e.recipientId,!e.recipientId)throw new Tn(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Tn(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Tn(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Tn(c.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="certificateId")throw new Tn(c.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"certificateId",...n});const o=t.issueCertificate;if(!o)throw new Tn(c.PARAM_LOST,{param:"issueCertificate"});const a={...n,target:"issueCertificateAsset"},{sourceChainMagic:p,sourceChainName:l,certificateId:h,type:y}=o;if(this.checkChainName(l,"sourceChainName",a),l!==r.chainName)throw new Tn(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${l}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(p,"sourceChainMagic",a),p!==r.magic)throw new Tn(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${l}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!h)throw new Tn(c.PROP_IS_REQUIRE,{prop:"certificateId",...a});if(!s.isValidCertificateId(h))throw new Tn(c.PROP_IS_INVALID,{prop:`certificateId ${h}`,...a});if(y!==0&&y!==1&&y!==2)throw new Tn(c.NOT_MATCH,{to_compare_prop:`type ${y}`,be_compare_prop:"type",to_target:"dapp",be_target:"CERTIFICATE_TYPE"});if(i.value!==h)throw new Tn(c.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`certificateId ${h}`,to_target:"storage",be_target:"issueCertificate",...n})}init(e,t){return _h.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{sourceChainName:a,sourceChainMagic:p,certificateId:l,type:h}=e.asset.issueCertificate;n.next=t.emit("issueCertificate",{type:"issueCertificate",transaction:e,applyInfo:{address:s,possessorAddress:i,publicKeyBuffer:o,sourceChainName:a,sourceChainMagic:p,certificateId:l,type:h,status:0,issueId:e.signature}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};nd=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],nd);const{ArgumentIllegalException:ds}=le("CONTROLLER","DestroyCertificateTransactionFactory");let sd=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new ds(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ds(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ds(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new ds(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="certificateId")throw new ds(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"certificateId",...n});const i=t.destroyCertificate;if(!i)throw new ds(c.PARAM_LOST,{param:"destroyCertificate"});const o={...n,target:"destroyCertificateAsset"},{sourceChainMagic:a,sourceChainName:p,certificateId:l,type:h}=i;if(p!==r.chainName)throw new ds(c.SHOULD_BE,{to_compare_prop:"sourceChainName",to_target:"body",be_compare_prop:"local chain name",...o});if(a!==r.magic)throw new ds(c.SHOULD_BE,{to_compare_prop:"sourceChainMagic",to_target:"body",be_compare_prop:"local chain magic",...o});if(!this.baseHelper.isValidCertificateId(l))throw new ds(c.PROP_IS_INVALID,{prop:`certificateId ${l}`,...o});if(s.value!==l)throw new ds(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`certificateId ${l}`,to_target:"storage",be_target:"destroyCertificate"})}init(e,t){return Ah.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,recipientId:o}=e,{sourceChainMagic:a,sourceChainName:p,certificateId:l,type:h}=e.asset.destroyCertificate;n.next=t.emit("destroyCertificate",{type:"destroyCertificate",transaction:e,applyInfo:{address:s,possessorAddress:o,publicKeyBuffer:i,sourceChainName:p,sourceChainMagic:a,certificateId:l,status:255}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};sd=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],sd);const{ArgumentFormatException:Hc,OutOfRangeException:MN,ConsensusException:$_,warn:V_}=le("CONTROLLER","transaction");let Qt=class{constructor(e,t,r,n,s,i,o){this.transactionHelper=e,this.accountBaseHelper=t,this.asymmetricHelper=r,this.keypairHelper=n,this.Buffer=s,this.config=i,this.moduleMap=o,this._txFactoryCache=new Map,this.fromJSON=this.recombineTransaction}getTransactionFactory(e){let t=this._txFactoryCache.get(e);return t||(t=Ht(e,this.moduleMap),this._txFactoryCache.set(e,t)),t}getTransactionFactoryFromType(e){const{baseType:t}=this.transactionHelper.parseType(e);return this.getTransactionFactoryFromBaseType(t)}getTransactionFactoryFromBaseType(e){const t=Kr.VF.get(e);if(!t)throw new Hc(c.INVALID_BASE_TYPE,{base_type:e});return this.getTransactionFactory(t)}canCreateTransaction(e){return this.transactionHelper.isTransactionInFilter(e)}get abortForbiddenTransaction(){return this.transactionHelper.abortForbiddenTransaction}async createTransactionWithoutSignature(e,t,r,n=this.config){const s=t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e);if(!this.canCreateTransaction(s)){const a=Me.VK.get(Me.trsTypeToV(s)),p=new $_(c.DISABLED_CREATE_TRANSACTION,{trsName:a});if(this.abortForbiddenTransaction)throw p;V_(p)}const i=this.getTransactionFactory(e);await i.verifyTransactionBody(t,r,n);const o={version:t.version,type:t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e),senderId:t.senderId,senderPublicKey:t.senderPublicKey,senderSecondPublicKey:t.senderSecondPublicKey,recipientId:t.recipientId||void 0,rangeType:t.rangeType,range:t.range,timestamp:t.timestamp,fee:t.fee,remark:t.remark,dappid:t.dappid||void 0,lns:t.lns||void 0,sourceIP:t.sourceIP||void 0,fromMagic:t.fromMagic,toMagic:t.toMagic,applyBlockHeight:t.applyBlockHeight,effectiveBlockHeight:t.effectiveBlockHeight,storage:t.storage};return i.init(o,r)}async createTransaction(e,t,r,n,s,i=this.config){const o=t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e);if(!this.canCreateTransaction(o)){const h=Me.VK.get(Me.trsTypeToV(o)),y=new $_(c.DISABLED_CREATE_TRANSACTION,{trsName:h});if(this.abortForbiddenTransaction)throw y;V_(y)}const a=this.getTransactionFactory(e);a.verifyKeypair(n),s&&a.verifySecondKeypair(s),await a.verifyTransactionBody(t,r,i);const p={version:t.version,type:t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e),senderId:t.senderId,senderPublicKey:t.senderPublicKey,senderSecondPublicKey:t.senderSecondPublicKey,recipientId:t.recipientId||void 0,rangeType:t.rangeType,range:t.range,timestamp:t.timestamp,fee:t.fee,remark:t.remark,dappid:t.dappid||void 0,lns:t.lns||void 0,sourceIP:t.sourceIP||void 0,fromMagic:t.fromMagic,toMagic:t.toMagic,applyBlockHeight:t.applyBlockHeight,effectiveBlockHeight:t.effectiveBlockHeight,storage:t.storage},l=a.init(p,r);return l.signatureBuffer=await this.asymmetricHelper.detachedSign(l.getBytes(!0,!0),n.secretKey),s&&(l.signSignatureBuffer=await this.asymmetricHelper.detachedSign(l.getBytes(!1,!0),s.secretKey)),this.transactionHelper.verifyTransactionSize(l),this.transactionHelper.verifyTransactionBlobSize(l),l}async recombineTransaction(e){return await this.getTransactionFactoryFromType(e.type).fromJSON(e)}recombineTransactionInBlock(e){return ar.fromObject(e)}parseBytesToTransaction(e){return rt.decode(e)}parseBytesToSomeTransaction(e){const t=new pn(e);t.uint32(),t.uint32(),t.uint32();const r=t.string();return this.getTransactionModelConstructorFromType(r).decode(e)}getTransactionModelConstructorFromType(e){const{baseType:t}=this.transactionHelper.parseType(e);return this.getTransactionModelConstructorFromBaseType(t)}getTransactionModelConstructorFromBaseType(e){const t=Me.VM.get(e);if(!t)throw new Hc(c.INVALID_BASE_TYPE,{base_type:e});return t}getTransactionTypeFromTransactionFactoryConstructor(e){const t=Kr.FV.get(e);if(!t)throw new Hc(c.UNREGISTERED_TRANSACTION_FACTORY,{factoryName:e.name});const r=Kr.VK.get(t);if(!r)throw new Hc(c.UNREGISTERED_TRANSACTION_BASE_TYPE,{trs_base:t});const n=this.transactionHelper[r];if(!n)throw new Hc(c.UNREGISTERED_TRANSACTION_TYPE,{trs_key:r});return n}getMoveAmount(e,t={magic:this.config.magic,assetType:this.config.assetType}){return this.getTransactionFactoryFromType(e.type).getMoveAmount(e,t)}};Qt=u([ie("bfchain-core:TransactionCore"),Ce(3,Z("keypairHelper")),Ce(4,Z("Buffer")),g("design:paramtypes",[we,Te,Fr,Object,Object,ue,et])],Qt);const Kr=(()=>{const e=new Map,t=new Map;for(const s in W){const i=W[s];t.set(s,i),e.set(i,s)}const r=new Map,n=new Map;return[[W.SIGNATURE,tu],[W.DAPP,Vh],[W.DAPP_PURCHASING,Vf],[W.MARK,Gf],[W.ISSUE_ASSET,Kf],[W.INCREASE_ASSET,jf],[W.DESTROY_ASSET,iu],[W.TRANSFER_ASSET,nu],[W.TO_EXCHANGE_ASSET,ou],[W.BE_EXCHANGE_ASSET,zf],[W.GIFT_ASSET,cu],[W.GRAB_ASSET,Jf],[W.TRUST_ASSET,hu],[W.SIGN_FOR_ASSET,Yf],[W.EMIGRATE_ASSET,Qf],[W.IMMIGRATE_ASSET,Xf],[W.STAKE_ASSET,lu],[W.UNSTAKE_ASSET,Wf],[W.LOCATION_NAME,qf],[W.SET_LNS_RECORD_VALUE,ed],[W.SET_LNS_MANAGER,Zf],[W.ISSUE_ENTITY_FACTORY,Do],[W.ISSUE_ENTITY_FACTORY_V1,uu],[W.ISSUE_ENTITY,gu],[W.DESTROY_ENTITY,td],[W.ISSUE_ENTITY_MULTI,du],[W.TRANSFER_ANY,su],[W.GIFT_ANY,Gh],[W.GRAB_ANY,pu],[W.TO_EXCHANGE_ANY,Kh],[W.BE_EXCHANGE_ANY,fu],[W.TO_EXCHANGE_ANY_MULTI,yu],[W.BE_EXCHANGE_ANY_MULTI,mu],[W.TO_EXCHANGE_ANY_MULTI_ALL,_u],[W.BE_EXCHANGE_ANY_MULTI_ALL,rd],[W.ISSUE_CERTIFICATE,nd],[W.DESTROY_CERTIFICATE,sd]].forEach(([s,i])=>{r.set(s,i),n.set(i,s)}),{VK:e,KV:t,VF:r,FV:n,trsTypeToV(s){const i=s.indexOf("-",s.indexOf("-")+1);return s.substr(i+1)}}})(),{ConsensusException:xt}=le("VERIFIER","HelperLogicVerifier");let ji=class{deepClone(e){const t=Array.isArray(e)?[]:{};if(typeof e=="object"){for(const r in e)e[r]&&typeof e[r]=="object"?t[r]=this.deepClone(e[r]):t[r]=e[r];return t}else return e}async isAccountFrozen(e,t){const r=await this.accountGetterHelper.getAccountInfo(e,t);if(r&&r.accountStatus!==0)throw new xt(c.ACCOUNT_FROZEN,{address:e,status:r.accountStatus})}async isPossessAssetExceptChainAsset(e,t,r=this.configHelper){for(const n in t){const s=t[n];for(const i in s)if(i!==r.assetType&&s[i].assetNumber>BigInt(0))throw new xt(c.POSSESS_ASSET_EXCEPT_CHAIN_ASSET)}if(await this.accountGetterHelper.isPossessFrozenAssetExceptMain(e))throw new xt(c.POSSESS_FROZEN_ASSET_EXCEPT_CHAIN_ASSET)}async isDAppPossessor(e,t=this.configHelper){if(await this.accountGetterHelper.isDAppPossessor(t.magic,e))throw new xt(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"DApp id possessor can not initiate a frozen account transaction"})}async isLnsPossessorOrManager(e,t=this.configHelper){if(await this.accountGetterHelper.isLocationNamePossessor(t.magic,e))throw new xt(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Location name possessor or manager can not initiate a frozen account transaction"})}async isEntityFactoryPossessor(e,t=this.configHelper){if(await this.accountGetterHelper.isEntityFactoryPossessor(t.magic,e))throw new xt(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"EntityFactory possessor can not initiate a frozen account transaction"})}async isEntityPossessor(e,t=this.configHelper){if(await this.accountGetterHelper.isEntityPossessor(t.magic,e))throw new xt(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Entity possessor can not initiate a frozen account transaction"})}async isCertApplicantOrPossessor(e,t=this.configHelper){if(await this.accountGetterHelper.isCertApplicantOrPossessor(t.magic,e))throw new xt(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Certificate applicant or possessor can not initiate a frozen account transaction"})}async isStakeAsset(e){if(await this.accountGetterHelper.isStakeAsset(e))throw new xt(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Already stake asset can not initiate a frozen account transaction"})}async isChainAssetPossessor(e){await this.isDAppPossessor(e,this.configHelper),await this.isLnsPossessorOrManager(e,this.configHelper),await this.isEntityFactoryPossessor(e,this.configHelper),await this.isEntityPossessor(e,this.configHelper),await this.isCertApplicantOrPossessor(e,this.configHelper),await this.isStakeAsset(e)}async isAssetExist(e,t,r){const n=await this.accountGetterHelper.getAsset(t,r);if(!n)throw new xt(c.NOT_EXIST,{prop:`asset with magic ${t} assetType ${r}`,target:"blockChain"});if(n.sourceChainName!==e)throw new xt(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${n.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} assetType ${r}`,be_target:`transaction magic ${t} assetType ${r}`});return n}async isDAppExist(e,t,r,n){const s=await this.accountGetterHelper.getDApp(t,r,n);if(!s)throw new xt(c.DAPPID_IS_NOT_EXIST,{dappid:r,errorId:He.DAPPID_NOT_EXIST});if(s.sourceChainName!==e)throw new xt(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} dappid ${r}`,be_target:`transaction magic ${t} dappid ${r}`});return s}async isLocationNameExist(e,t,r,n){const s=await this.accountGetterHelper.getLocationName(t,r,n);if(!s)throw new xt(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:r,errorId:He.LOCATION_NAME_NOT_EXIST});if(s.sourceChainName!==e)throw new xt(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} locationName ${r}`,be_target:`transaction magic ${t} locationName ${r}`});return s}async isEntityFactoryExist(e,t,r,n){const s=await this.accountGetterHelper.getEntityFactory(t,r,n);if(!s)throw new xt(c.ENTITY_FACTORY_IS_NOT_EXIST,{factoryId:r,errorId:He.ENTITY_FACTORY_NOT_EXIST});if(s.sourceChainName!==e)throw new xt(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} factoryId ${r}`,be_target:`transaction magic ${t} factoryId ${r}`});return s}async isEntityExist(e,t,r,n){const s=await this.accountGetterHelper.getEntity(t,r,n);if(!s)throw new xt(c.ENTITY_IS_NOT_EXIST,{entityId:r,errorId:He.ENTITY_NOT_EXIST});if(s.sourceChainName!==e)throw new xt(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} entityId ${r}`,be_target:`transaction magic ${t} entityId ${r}`});return s}async isCertificateExist(e,t,r,n){const s=await this.accountGetterHelper.getCertificate(t,r,n);if(!s)throw new xt(c.CERTIFICATE_IS_NOT_EXIST,{certificateId:r,errorId:He.CERTIFICATE_NOT_EXIST});if(s.sourceChainName!==e)throw new xt(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} certificateId ${r}`,be_target:`transaction magic ${t} certificateId ${r}`});return s}async getAccountForce(e,t,r){let n=e.get(t);if(!n){if(n=await this.accountGetterHelper.getAccountInfo(t,r),!n)throw new xt(c.NOT_EXIST,{prop:`Account with address ${t}`,target:"blockChain"});e.set(t,n)}return n}async getFrozenAssetForce(e,t,r){const n=await this.accountGetterHelper.getFrozenAsset(e,t,r);if(!n)throw new xt(c.FROZEN_ASSET_NOT_EXIST_OR_EXPIRED,{frozenAddress:e,signature:t,assetType:r});return n}async getStakeAssetForce(e,t){const r=await this.accountGetterHelper.getStakeAsset(e,t);if(!r)throw new xt(c.STAKE_ASSET_NOT_EXIST_OR_EXPIRED,{stakeAddress:e,stakeId:t});return r}};u([Z(ue),g("design:type",ue)],ji.prototype,"configHelper",void 0);u([Z("accountGetterHelper",{dynamics:!0}),g("design:type",Object)],ji.prototype,"accountGetterHelper",void 0);ji=u([ie()],ji);const{ConsensusException:he,NoFoundException:LN}=le("VERIFIER","EventLogicVerifier");let as=class{addRecord(e,t,r){const{recordType:n,recordValue:s}=t;if(r&&r[n]&&r[n][s])throw new he(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:e,reason:"New location name record value already exist"})}deleteRecord(e,t,r){const{recordType:n,recordValue:s}=t;if(!(r[n]&&r[n][s]))throw new he(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:e,reason:"Delete location name record value not exist"})}__listenEventFee(e,t,r){r.on("fee",async({transaction:n,applyInfo:s},i)=>{const{magic:o,assetType:a}=this.configHelper;if(o!==this.configHelper.magic)throw new he(c.SHOULD_BE,{to_compare_prop:`magic ${o}`,to_target:"applyInfo",be_compare_prop:this.configHelper.magic});if(a!==this.configHelper.assetType)throw new he(c.SHOULD_BE,{to_compare_prop:`assetType ${a}`,to_target:"applyInfo",be_compare_prop:this.configHelper.assetType});const p=BigInt(s.amount),l=s.address,{assets:h}=await this.helperLogicVerifier.getAccountForce(e,l,t);h[o]=h[o]||{},h[o][a]=h[o][a]||{sourceChainMagic:o,assetType:a,assetNumber:BigInt(0),history:{}};const y=h[o][a],A=y.assetNumber;if(y.assetNumber+=p,y.assetNumber<BigInt(0))throw new he(c.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${n.signature} address: ${l} magic ${s.assetInfo.magic} assetType: ${s.assetInfo.assetType} hodingAsset: ${A.toString()} spendFee: ${s.amount}`,errorId:He.ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/fee"})}__listenEventDestroyMainAsset(e,t,r){r.on("destroyMainAsset",async({transaction:n,applyInfo:s},i)=>{const{magic:o,assetType:a}=this.configHelper;if(o!==this.configHelper.magic)throw new he(c.SHOULD_BE,{to_compare_prop:`magic ${o}`,to_target:"applyInfo",be_compare_prop:this.configHelper.magic});if(a!==this.configHelper.assetType)throw new he(c.SHOULD_BE,{to_compare_prop:`assetType ${a}`,to_target:"applyInfo",be_compare_prop:this.configHelper.assetType});const{amount:p,sourceAmount:l}=s,h=await this.accountGetterHelper.getAsset(o,a);if(!h)throw new he(c.ASSET_NOT_EXIST,{magic:o,assetType:a,errorId:He.ASSET_NOT_EXIST});if(h.remainAssetPrealnum<BigInt(l))throw new he(c.ASSET_NOT_ENOUGH,{reason:`Asset ${o} ${a} remain: ${h.remainAssetPrealnum.toString()} destroyAsset: ${p}`,errorId:He.ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/destroyMainAsset"})}__listenEventAsset(e,t,r){r.on("asset",async({transaction:n,applyInfo:s},i)=>{const{magic:o,assetType:a}=s.assetInfo,p=s.address,{assets:l}=await this.helperLogicVerifier.getAccountForce(e,p,t);l[o]=l[o]||{},l[o][a]=l[o][a]||{sourceChainMagic:o,assetType:a,assetNumber:BigInt(0),history:{}};const h=l[o][a],y=h.assetNumber;if(h.assetNumber+=BigInt(s.amount),h.assetNumber<BigInt(0))throw new he(c.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${n.signature} address: ${p} magic ${s.assetInfo.magic} assetType: ${s.assetInfo.assetType} hodingAsset: ${y.toString()} spendAsset: ${s.amount}`,errorId:He.ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/asset"})}__listenEventFrozenAsset(e,t,r){r.on("frozenAsset",async({transaction:n,applyInfo:s},i)=>{const{magic:o,assetType:a}=s.assetInfo,p=s.address,{assets:l}=await this.helperLogicVerifier.getAccountForce(e,p,t);l[o]=l[o]||{},l[o][a]=l[o][a]||{sourceChainMagic:o,assetType:a,assetNumber:BigInt(0),history:{}};const h=l[o][a],y=h.assetNumber;if(h.assetNumber+=BigInt(s.amount),h.assetNumber<BigInt(0))throw new he(c.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${n.signature} address: ${p} magic ${s.assetInfo.magic} assetType: ${s.assetInfo.assetType} hodingAsset: ${y.toString()} frozenAsset: ${s.amount}`,errorId:He.ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/frozenAsset"})}__listenEventUnfrozenAsset(e,t){t.on("unfrozenAsset",async({transaction:r,applyInfo:n},s)=>{const{assetInfo:i,frozenId:o,amount:a,recipientId:p}=n,{magic:l,assetType:h}=i,y=await this.helperLogicVerifier.getFrozenAssetForce(p,o,h),{maxEffectiveHeight:A,minEffectiveHeight:_,remainUnfrozenTimes:E,amount:T}=y;if(_>e)throw new he(c.NOT_BEGIN_UNFROZEN_YET,{frozenId:o});if(e>A)throw new he(c.FROZEN_ASSET_EXPIRATION,{frozenId:o});if(A<e)throw new he(c.FROZEN_ASSET_EXPIRATION,{frozenId:o});if(BigInt(a)>BigInt(T))throw new he(c.FROZEN_ASSET_NOT_ENOUGH,{reason:`No enough asset to unfrozen magic ${l} assetType ${h} remain ${T} spend ${a}`,frozenId:o});if(E!==void 0&&E===0)throw new he(c.UNFROZEN_TIME_USE_UP,{frozenId:o});return s()},{taskname:"applyTransaction/logicVerifier/unfrozenAsset"})}__listenEventSignForAsset(e,t){t.on("signForAsset",async({transaction:r,applyInfo:n},s)=>{const{frozenId:i,frozenAddress:o,assetInfo:a}=n,p=await this.helperLogicVerifier.getFrozenAssetForce(o,i,a.assetType),{maxEffectiveHeight:l,minEffectiveHeight:h,remainUnfrozenTimes:y,amount:A}=p;if(h>e)throw new he(c.NOT_BEGIN_UNFROZEN_YET,{frozenId:i});if(e>l)throw new he(c.FROZEN_ASSET_EXPIRATION,{frozenId:i});if(l<e)throw new he(c.FROZEN_ASSET_EXPIRATION,{frozenId:i});if(BigInt(A)===BigInt(0))throw new he(c.ASSET_NOT_ENOUGH,{reason:`No enough asset to sign for magic ${p.sourceChainMagic} assetType ${p.assetType} remain ${A}`});if(y!==void 0&&y===0)throw new he(c.UNFROZEN_TIME_USE_UP,{frozenId:i});return s()},{taskname:"applyTransaction/logicVerifier/signForAsset"})}__listenEventFrozenAccount(e,t,r){r.on("frozenAccount",async({applyInfo:n},s)=>{const{address:i}=n,o=(await this.helperLogicVerifier.getAccountForce(e,i,t)).accountStatus;if(o===1||o===16||o===17)throw new he(c.ACCOUNT_FROZEN,{address:i,status:o});return s()},{taskname:"applyTransaction/logicVerifier/frozenAccount"})}__listenEventSetSecondPublicKey(e){e.on("setSecondPublicKey",({applyInfo:t},r)=>r(),{taskname:"applyTransaction/logicVerifier/setSecondPublicKey"})}async __checkAsset(e,t,r){await this.helperLogicVerifier.isAccountFrozen(e,r);const n=this.configHelper.magic;if(await this.accountGetterHelper.isCurrencyForbidden(t))throw new he(c.FORBIDDEN,{prop:`AssetType ${t}`,target:"blockChain"});if(await this.accountGetterHelper.getCurrency(t))throw new he(c.ALREADY_EXIST,{prop:`AssetType ${t}`,target:"blockChain",errorId:He.ASSETTYPE_ALREADY_EXIST});if(await this.accountGetterHelper.getAsset(n,t))throw new he(c.ASSET_ALREADY_EXIST,{magic:n,assetType:t,errorId:He.ASSET_ALREADY_EXIST})}__listenEventIssueAsset(e,t,r){r.on("issueAsset",async({transaction:n,applyInfo:s},i)=>{const{address:o,assetInfo:a,genesisAddress:p,sourceAmount:l}=s,{assetType:h}=a;await this.__checkAsset(p,h,t);const{assets:y}=await this.helperLogicVerifier.getAccountForce(e,o,t);await this.helperLogicVerifier.isPossessAssetExceptChainAsset(o,y),await this.helperLogicVerifier.isChainAssetPossessor(o);const{magic:A,assetType:_,issueAssetMinChainAsset:E}=this.configHelper,T=y[A][_].assetNumber;if(BigInt(E)>T)throw new he(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${E}, remain Assets: ${T}`,errorId:He.CHAIN_ASSET_NOT_ENOUGH});const w=this.jsbiHelper.multiplyFloorFraction(T,this.configHelper.maxMultipleOfAssetAndMainAsset);if(BigInt(l)>w)throw new he(c.PROP_SHOULD_LTE_FIELD,{prop:`expectedIssuedAssets ${l}`,target:"issueAsset",field:`calc max assets ${w}`});return i()},{taskname:"applyTransaction/logicVerifier/issueAsset"})}__listenEventIncreaseAsset(e,t,r){r.on("increaseAsset",async({transaction:n,applyInfo:s},i)=>{const{address:o,recipientId:a,assetInfo:p,applyAddress:l,sourceAmount:h}=s,{magic:y,assetType:A}=p,_=await this.accountGetterHelper.getAsset(y,A);if(!_)throw new he(c.ASSET_NOT_EXIST,{magic:y,assetType:A,errorId:He.ASSET_NOT_EXIST});if(l!==_.applyAddress)throw new he(c.NOT_MATCH,{to_compare_prop:`applyAddress ${l}`,to_target:"increaseAsset",be_compare_prop:`applyAddress ${_.applyAddress}`,be_target:"blockChain"});if(o!==_.genesisAddress)throw new he(c.NOT_MATCH,{to_compare_prop:`genesisAddress ${o}`,to_target:"increaseAsset",be_compare_prop:`genesisAddress ${_.genesisAddress}`,be_target:"blockChain"});return i()},{taskname:"applyTransaction/logicVerifier/increaseAsset"})}__listenEventDestroyAsset(e){e.on("destroyAsset",async({applyInfo:t},r)=>{const{sourceAmount:n,assetInfo:s}=t,{magic:i,assetType:o}=s,a=await this.accountGetterHelper.getAsset(i,o);if(!a)throw new he(c.ASSET_NOT_EXIST,{magic:i,assetType:o,errorId:He.ASSET_NOT_EXIST});if(a.remainAssetPrealnum<BigInt(n))throw new he(c.ASSET_NOT_ENOUGH,{reason:`Asset ${i} ${o} remain: ${a.remainAssetPrealnum.toString()} destroyAsset: ${n}`,errorId:He.ASSET_NOT_ENOUGH});return r()},{taskname:"applyTransaction/logicVerifier/destroyAsset"})}__listenEventIssueDAppid(e,t){t.on("issueDAppid",async({applyInfo:r},n)=>{const{address:s,dappid:i,sourceChainMagic:o,possessorAddress:a}=r;if(s!==a&&await this.helperLogicVerifier.isAccountFrozen(a,e),await this.accountGetterHelper.getDApp(o,i,e))throw new he(c.DAPPID_IS_ALREADY_EXIST,{dappid:i,errorId:He.DAPP_ALREADY_EXISTS});return n()},{taskname:"applyTransaction/logicVerifier/issueDAppid"})}__listenEventFrozenDAppid(e,t){t.on("frozenDAppid",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,dappid:a}=r,p=await this.helperLogicVerifier.isDAppExist(i,o,a,e);if(p.possessorAddress!==s)throw new he(c.ACCOUNT_NOT_DAPPID_POSSESSOR,{address:s,dappid:a,errorId:He.ACCOUNT_NOT_DAPPID_POSSESSOR});if(p.status===17)throw new he(c.DAPPID_ALREADY_FROZEN,{dappid:a});return n()},{taskname:"applyTransaction/logicVerifier/frozenDAppid"})}__listenEventUnfrozenDAppid(e,t){t.on("unfrozenDAppid",async({transaction:r,applyInfo:n},s)=>{const{address:i,sourceChainName:o,sourceChainMagic:a,dappid:p,frozenId:l}=n,h=await this.helperLogicVerifier.isDAppExist(o,a,p,e);if(h.status!==17)throw new he(c.DAPPID_NOT_FROZEN,{dappid:p});if(h.frozenId!==l)throw new he(c.SHOULD_BE,{to_compare_prop:`frozenId ${l}`,to_target:"transaction",be_compare_prop:`dapp frozenId ${h.frozenId}`});if(r.recipientId!==h.possessorAddress)throw new he(c.SHOULD_BE,{to_compare_prop:`recipientId ${r.recipientId}`,to_target:"transaction",be_compare_prop:`dapp possessor ${h.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/unfrozenDAppid"})}__listenEventChangeDAppidPossessor(e,t){t.on("changeDAppidPossessor",async({transaction:r,applyInfo:n},s)=>{const{address:i,possessorAddress:o,sourceChainName:a,sourceChainMagic:p,dappid:l}=n;i!==o&&await this.helperLogicVerifier.isAccountFrozen(o,e);const h=await this.helperLogicVerifier.isDAppExist(a,p,l,e);if(h.status===17)throw new he(c.DAPPID_ALREADY_FROZEN,{dappid:l});if(r.senderId!==h.possessorAddress)throw new he(c.SHOULD_BE,{to_compare_prop:`senderId ${r.senderId}`,to_target:"transaction",be_compare_prop:`dapp possessor ${h.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/changeDAppidPossessor"})}__listenEventRegisterChain(e,t,r){r.on("registerChain",async({transaction:n,applyInfo:s},i)=>{const{address:o,genesisBlock:a}=s,{assets:p}=await this.helperLogicVerifier.getAccountForce(e,o,t);await this.helperLogicVerifier.isPossessAssetExceptChainAsset(o,p),await this.helperLogicVerifier.isChainAssetPossessor(o);const{magic:l,assetType:h,registerChainMinChainAsset:y}=this.configHelper,A=p[l][h].assetNumber;if(BigInt(y)>A)throw new he(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${y}, remain Assets: ${A}`,errorId:He.CHAIN_ASSET_NOT_ENOUGH});const{magic:_,assetType:E,chainName:T}=a;if(await this.accountGetterHelper.getMagic(_))throw new he(c.ALREADY_EXIST,{prop:`Magic ${_}`,target:"blockChain",errorId:He.MAGIC_ALREADY_EXIST});if(await this.accountGetterHelper.getCurrency(T))throw new he(c.ALREADY_EXIST,{prop:`ChainName ${T}`,target:"blockChain",errorId:He.CHAINNAME_ALREADY_EXIST});if(await this.accountGetterHelper.getCurrency(E))throw new he(c.ALREADY_EXIST,{prop:`AssetType ${E}`,target:"blockChain",errorId:He.ASSETTYPE_ALREADY_EXIST});if(await this.accountGetterHelper.getChain(_))throw new he(c.ALREADY_EXIST,{prop:`Chain with magic ${_}`,target:"blockChain"});return i()},{taskname:"applyTransaction/logicVerifier/registerChain"})}__listenEventRegisterLocationName(e,t){t.on("registerLocationName",async({applyInfo:r},n)=>{const{address:s,sourceChainMagic:i,name:o,possessorAddress:a}=r;if(s!==a&&await this.helperLogicVerifier.isAccountFrozen(a,e),await this.accountGetterHelper.getLocationName(i,o,e))throw new he(c.LOCATION_NAME_IS_ALREADY_EXIST,{prop:o,target:"blockChain",errorId:He.LOCATION_NAME_ALREADY_EXIST});if(await this.accountGetterHelper.isLocationNameForbidden(o))throw new he(c.FORBIDDEN,{prop:`Location name ${o}`,target:"blockChain"});if(o.split(".").length>2){const p=o.indexOf(".")+1,l=o.substr(p);if(!await this.accountGetterHelper.getLocationName(i,l,e))throw new he(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:l})}return n()},{taskname:"applyTransaction/logicVerifier/registerLocationName"})}__listenEventCancelLocationName(e,t){t.on("cancelLocationName",async({transaction:r,applyInfo:n},s)=>{const{sourceChainName:i,sourceChainMagic:o,name:a}=n,p=await this.helperLogicVerifier.isLocationNameExist(i,o,a,e);if(p.status===17)throw new he(c.CAN_NOT_DELETE_LOCATION_NAME,{locationName:a,reason:"Frozen location name can not be delete"});if(p.status===255)throw new he(c.CAN_NOT_DELETE_LOCATION_NAME,{locationName:a,reason:"Location name has been deleted"});if(r.senderId!==r.recipientId)throw new he(c.SHOULD_BE,{to_compare_prop:"recipientId",to_target:"transaction",be_compare_prop:r.senderId});if(p.possessorAddress!==r.senderId)throw new he(c.CAN_NOT_DELETE_LOCATION_NAME,{locationName:a,reason:"Only location name possessor can delete location name"});if(await this.accountGetterHelper.isSubLocationNameExist(o,a))throw new he(c.CAN_NOT_DELETE_LOCATION_NAME,{locationName:a,reason:"Location name have child location name, please delete it at first"});return s()},{taskname:"applyTransaction/logicVerifier/cancelLocationName"})}__listenEventSetLnsManager(e,t){t.on("setLnsManager",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,name:a,manager:p}=r;await this.helperLogicVerifier.isAccountFrozen(p,e);const l=await this.helperLogicVerifier.isLocationNameExist(i,o,a,e);if(l.status===17)throw new he(c.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:a,reason:"Frozen location name can not set manager"});if(p===l.manager)throw new he(c.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:a,reason:"Can not set the same account as manager",errorId:He.CAN_NOT_SET_SAME_ACCOUNT_AS_MANAGER});if(l.type==="MULTI_LEVEL"){const h=a.split(".")[0].length+1,y=a.substr(h),A=await this.accountGetterHelper.getLocationName(o,y,e);if(!A)throw new he(c.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:y,reason:"Last location name is not exists"});if(!(s===l.possessorAddress||s===A.manager))throw new he(c.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:y,reason:"Only the location name possessor or upper level location name manager can set manager of multi level location name"})}else if(s!==l.possessorAddress)throw new he(c.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:a,reason:"Only the location name possessor can set manager of top level location name"});return n()},{taskname:"applyTransaction/logicVerifier/setLnsManager"})}__listenEventSetLnsRecordValue(e,t){t.on("setLnsRecordValue",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,name:a,operationType:p,addRecord:l,deleteRecord:h}=r,y=await this.helperLogicVerifier.isLocationNameExist(i,o,a,e),{records:A,status:_}=y;if(_===17)throw new he(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:a,reason:"Frozen location name can not set record value"});if(!(s===y.possessorAddress||s===y.manager))throw new he(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:a,reason:"Only the location name possessor or manager can set record value"});if(p===0){if(!l)throw new he(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:a,reason:"New location name record value lose"});this.addRecord(a,l,A)}else if(p===1){if(!h)throw new he(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:a,reason:"Delete location name record value lose"});this.deleteRecord(a,h,A)}else if(p===2){if(!(l&&h))throw new he(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:a,reason:"New location name record value and delete location name record value lose"});this.deleteRecord(a,h,A),this.addRecord(a,l,A)}return n()},{taskname:"applyTransaction/logicVerifier/setLnsRecordValue"})}__listenEventFrozenLocationName(e,t){t.on("frozenLocationName",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,name:a}=r,p=await this.helperLogicVerifier.isLocationNameExist(i,o,a,e);if(p.status===17)throw new he(c.LOCATION_NAME_ALREADY_FROZEN,{locationName:a});if(p.type!=="TOP_LEVEL")throw new he(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(p.possessorAddress!==s)throw new he(c.ACCOUNT_NOT_LOCATION_NAME_POSSESSOR,{address:s,locationName:a,errorId:He.ACCOUNT_NOT_LNS_POSSESSOR});return n()},{taskname:"applyTransaction/logicVerifier/frozenLocationName"})}__listenEventUnfrozenLocationName(e,t){t.on("unfrozenLocationName",async({transaction:r,applyInfo:n},s)=>{const{address:i,sourceChainName:o,sourceChainMagic:a,name:p,frozenId:l}=n,h=await this.helperLogicVerifier.isLocationNameExist(o,a,p,e);if(h.status!==17)throw new he(c.LOCATION_NAME_NOT_FROZEN,{locationName:p});if(h.frozenId!==l)throw new he(c.SHOULD_BE,{to_compare_prop:`frozenId ${l}`,to_target:"transaction",be_compare_prop:`location name frozenId ${h.frozenId}`});if(h.type!=="TOP_LEVEL")throw new he(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(r.recipientId!==h.possessorAddress)throw new he(c.SHOULD_BE,{to_compare_prop:`recipientId ${r.recipientId}`,to_target:"transaction",be_compare_prop:`locationName possessor ${h.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/unfrozenLocationName"})}__listenEventChangeLocationNamePossessor(e,t){t.on("changeLocationNamePossessor",async({transaction:r,applyInfo:n},s)=>{const{address:i,possessorAddress:o,sourceChainName:a,sourceChainMagic:p,name:l}=n;i!==o&&await this.helperLogicVerifier.isAccountFrozen(o,e);const h=await this.helperLogicVerifier.isLocationNameExist(a,p,l,e);if(h.type!=="TOP_LEVEL")throw new he(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(h.status===17)throw new he(c.LOCATION_NAME_ALREADY_FROZEN,{locationName:l});if(r.senderId!==h.possessorAddress)throw new he(c.SHOULD_BE,{to_compare_prop:`senderId ${r.senderId}`,to_target:"transaction",be_compare_prop:`locationName possessor ${h.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/changeLocationNamePossessor"})}async __checkEntityFactory(e,t,r,n){if(await this.helperLogicVerifier.isAccountFrozen(t,e),await this.accountGetterHelper.getEntityFactory(r,n,e))throw new he(c.ENTITY_FACTORY_IS_ALREADY_EXIST,{factoryId:n,errorId:He.ENTITY_FACTORY_ALREADY_EXIST})}__listenEventIssueEntityFactoryByFrozen(e,t,r){r.on("issueEntityFactoryByFrozen",async({transaction:n,applyInfo:s},i)=>{const{address:o,factoryId:a,sourceChainMagic:p,possessorAddress:l,entityPrealnum:h}=s;await this.__checkEntityFactory(t,l,p,a);const{assets:y}=await this.helperLogicVerifier.getAccountForce(e,o,t);await this.helperLogicVerifier.isPossessAssetExceptChainAsset(o,y),await this.helperLogicVerifier.isChainAssetPossessor(o);const{magic:A,assetType:_,issueEntityFactoryMinChainAsset:E}=this.configHelper,T=y[A][_].assetNumber;if(BigInt(E)>T)throw new he(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${E}, remain Assets: ${T}`,errorId:He.CHAIN_ASSET_NOT_ENOUGH});const w=this.jsbiHelper.multiplyFractionAndFloor({numerator:T,denominator:UE},this.configHelper.maxMultipleOfEntityAndMainAsset);if(BigInt(h)>w)throw new he(c.PROP_SHOULD_LTE_FIELD,{prop:`entityPrealnum ${h}`,target:"issueEntityFactory",field:`calc max entities ${w}`});return i()},{taskname:"applyTransaction/logicVerifier/issueEntityFactoryByFrozen"})}__listenEventIssueEntityFactoryByDestroy(e,t){t.on("issueEntityFactoryByDestroy",async({transaction:r,applyInfo:n},s)=>{const{factoryId:i,sourceChainMagic:o,possessorAddress:a}=n;return await this.__checkEntityFactory(e,a,o,i),s()},{taskname:"applyTransaction/logicVerifier/issueEntityFactoryByDestroy"})}__isEntityFactoryMatch(e,t,r){if(e.sourceChainMagic!==t.sourceChainMagic||e.sourceChainName!==t.sourceChainName||e.factoryId!==t.factoryId||e.entityPrealnum!==t.entityPrealnum.toString()||e.entityFrozenAssetPrealnum!==t.entityFrozenAssetPrealnum||e.purchaseAssetPrealnum!==t.purchaseAssetPrealnum)throw new he(c.NOT_MATCH,{to_compare_prop:`entityFactory ${JSON.stringify(e)}`,be_compare_prop:`entityFactory ${JSON.stringify({sourceChainName:t.sourceChainName,sourceChainMagic:t.sourceChainMagic,factoryId:t.factoryId,entityPrealnum:t.entityPrealnum.toString(),entityFrozenAssetPrealnum:t.entityFrozenAssetPrealnum,purchaseAssetPrealnum:t.purchaseAssetPrealnum})}`,to_target:r,be_target:"blockChain"})}__listenEventIssueEntity(e,t,r){r.on("issueEntity",async({transaction:n,applyInfo:s},i)=>{const{address:o,possessorAddress:a,entityFactoryPossessorAddress:p,factoryId:l,entityId:h,sourceChainName:y,sourceChainMagic:A,entityFrozenAssetPrealnum:_}=s;o!==a&&await this.helperLogicVerifier.isAccountFrozen(a,t);const E=await this.helperLogicVerifier.isEntityFactoryExist(y,A,l,t);if(this.__isEntityFactoryMatch(n.asset.issueEntity.entityFactory.toJSON(),E,"IssueEntityTransaction"),p!==E.possessorAddress)throw new he(c.NOT_MATCH,{to_compare_prop:`entityFactoryPossessor ${p}`,be_compare_prop:`possessorAddress ${E.possessorAddress}`,to_target:"issueEntity",be_target:"memEntityFactory"});if(E.remainEntityPrealnum===BigInt(0))throw new he(c.ISSUE_ENTITY_TIMES_USE_UP,{entityFactory:l});if(await this.accountGetterHelper.getEntity(A,h,t))throw new he(c.ENTITY_IS_ALREADY_EXIST,{entityId:h,errorId:He.ENTITY_ALREADY_EXIST});const{assets:T}=await this.helperLogicVerifier.getAccountForce(e,o,t),{magic:w,assetType:C}=this.configHelper;let N=T[w][C].assetNumber;const L=E.purchaseAssetPrealnum;if(L!=="0"&&(N-=BigInt(L),N<BigInt(0)))throw new he(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${L}, remain Assets: ${N}`,errorId:He.CHAIN_ASSET_NOT_ENOUGH});if(_!=="0"&&BigInt(_)>N)throw new he(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${_}, remain Assets: ${N}`,errorId:He.CHAIN_ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/issueEntityV1"})}__listenEventIssueEntityMulti(e,t,r){r.on("issueEntityMulti",async({transaction:n,applyInfo:s},i)=>{const{address:o,possessorAddress:a,entityFactoryPossessorAddress:p,factoryId:l,entityStructList:h,sourceChainName:y,sourceChainMagic:A,entityFrozenAssetPrealnum:_}=s;o!==a&&await this.helperLogicVerifier.isAccountFrozen(a,t);const E=await this.helperLogicVerifier.isEntityFactoryExist(y,A,l,t);if(this.__isEntityFactoryMatch(n.asset.issueEntityMulti.entityFactory.toJSON(),E,"IssueEntityMultiTransactionV1"),p!==E.possessorAddress)throw new he(c.NOT_MATCH,{to_compare_prop:`entityFactoryPossessor ${p}`,be_compare_prop:`possessorAddress ${E.possessorAddress}`,to_target:"issueEntity",be_target:"memEntityFactory"});const{remainEntityPrealnum:T}=E;if(T===BigInt(0))throw new he(c.ISSUE_ENTITY_TIMES_USE_UP,{entityFactory:l});if(T<BigInt(h.length))throw new he(c.NOT_ENOUGH_ISSUE_ENTITY_TIMES,{entityFactory:l});if(E.entityPrealnum!==T){for(const{entityId:$}of h)if(await this.accountGetterHelper.getEntity(A,$,t))throw new he(c.ENTITY_IS_ALREADY_EXIST,{entityId:$,errorId:He.ENTITY_ALREADY_EXIST})}const{assets:w}=await this.helperLogicVerifier.getAccountForce(e,o,t),{magic:C,assetType:N}=this.configHelper;let L=w[C][N].assetNumber;const B=E.purchaseAssetPrealnum;if(B!=="0"&&(L-=BigInt(B),L<BigInt(0)))throw new he(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${B}, remain Assets: ${L}`,errorId:He.CHAIN_ASSET_NOT_ENOUGH});if(_!=="0"&&BigInt(_)>L)throw new he(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${_}, remain Assets: ${L}`,errorId:He.CHAIN_ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/issueEntityV1"})}__listenEventDestroyEntity(e,t){t.on("destroyEntity",async({transaction:r,applyInfo:n},s)=>{const{sourceChainName:i,sourceChainMagic:o,entityId:a,entityFactoryApplicantAddress:p,entityFactoryPossessorAddress:l,entityFactory:h}=n,y=h.factoryId,A=await this.helperLogicVerifier.isEntityFactoryExist(i,o,y,e);if(this.__isEntityFactoryMatch(r.asset.destroyEntity.entityFactory.toJSON(),A,"DestroyEntityTransaction"),p!==A.applyAddress)throw new he(c.NOT_MATCH,{to_compare_prop:`entityFactoryApplicant ${p}`,be_compare_prop:`applyAddress ${A.applyAddress}`,to_target:"destroyEntity",be_target:"memEntityFactory"});if(l!==A.possessorAddress)throw new he(c.NOT_MATCH,{to_compare_prop:`entityFactoryPossessor ${l}`,be_compare_prop:`possessorAddress ${A.possessorAddress}`,to_target:"destroyEntity",be_target:"memEntityFactory"});const _=await this.helperLogicVerifier.isEntityExist(i,o,a,e);if(_.status===17)throw new he(c.CAN_NOT_DESTROY_ENTITY,{entityId:a,reason:"Frozen entity can not be destroy"});if(_.status===255)throw new he(c.ENTITY_ALREADY_DESTROY,{entityId:a,reason:"Entity already be destroy"});if(_.possessorAddress!==r.senderId)throw new he(c.CAN_NOT_DESTROY_ENTITY,{entityId:a,reason:`Only entity possessor can deestory entity ${a}`});return s()},{taskname:"applyTransaction/logicVerifier/destroyEntity"})}__listenEventFrozenEntity(e,t){t.on("frozenEntity",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,entityId:a}=r,p=await this.helperLogicVerifier.isEntityExist(i,o,a,e);if(p.possessorAddress!==s)throw new he(c.ACCOUNT_NOT_ENTITY_POSSESSOR,{address:s,entityId:a,errorId:He.ACCOUNT_NOT_ENTITY_POSSESSOR});if(p.status===17)throw new he(c.ENTITY_ALREADY_FROZEN,{entityId:a});if(p.status===255)throw new he(c.ENTITY_ALREADY_DESTROY,{entityId:a});return n()},{taskname:"applyTransaction/logicVerifier/frozenEntity"})}__listenEventUnfrozenEntity(e,t){t.on("unfrozenEntity",async({transaction:r,applyInfo:n},s)=>{const{address:i,sourceChainName:o,sourceChainMagic:a,entityId:p,frozenId:l}=n,h=await this.helperLogicVerifier.isEntityExist(o,a,p,e);if(h.status===0)throw new he(c.ENTITY_NOT_FROZEN,{entityId:p});if(h.frozenId!==l)throw new he(c.SHOULD_BE,{to_compare_prop:`frozenId ${l}`,to_target:"transaction",be_compare_prop:`entity frozenId ${h.frozenId}`});if(h.status===255)throw new he(c.ENTITY_ALREADY_DESTROY,{entityId:p});if(r.recipientId!==h.possessorAddress)throw new he(c.SHOULD_BE,{to_compare_prop:`recipientId ${r.recipientId}`,to_target:"transaction",be_compare_prop:`entity possessor ${h.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/unfrozenEntity"})}__listenEventChangeEntityPossessor(e,t){t.on("changeEntityPossessor",async({transaction:r,applyInfo:n},s)=>{const{address:i,possessorAddress:o,sourceChainName:a,sourceChainMagic:p,entityId:l}=n;i!==o&&await this.helperLogicVerifier.isAccountFrozen(o,e);const h=await this.helperLogicVerifier.isEntityExist(a,p,l,e);if(h.status===17)throw new he(c.ENTITY_ALREADY_FROZEN,{entityId:l});if(h.status===255)throw new he(c.ENTITY_ALREADY_DESTROY,{entityId:l});if(r.senderId!==h.possessorAddress)throw new he(c.SHOULD_BE,{to_compare_prop:`senderId ${r.senderId}`,to_target:"transaction",be_compare_prop:`entity possessor ${h.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/changeEntityPossessor"})}__listenEventMigrateCertificate(e){e.on("migrateCertificate",async({applyInfo:t},r)=>{const{migrateCertificateId:n}=t;if(await this.accountGetterHelper.getMigrateCertificate(n))throw new he(c.ASSET_IS_ALREADY_MIGRATION,{migrateCertificateId:n});return r()},{taskname:"applyTransaction/logicVerifier/migrateCertificate"})}__listenEventPayTax(e,t){t.on("payTax",async({applyInfo:r},n)=>{const{sourceChainName:s,sourceChainMagic:i,parentAssetType:o,assetType:a,taxInformation:p}=r;if(o===ne.ENTITY){const l=await this.helperLogicVerifier.isEntityExist(s,i,a,e);if(l.taxAssetRecipientId!==p.taxCollector)throw new he(c.NOT_MATCH,{to_compare_prop:`taxAssetRecipientId ${l.taxAssetRecipientId}`,be_compare_prop:`taxCollector ${p.taxCollector}`,to_target:"taxInformation",be_target:"memEntity"});if(l.taxAssetPrealnum!==p.taxAssetPrealnum)throw new he(c.NOT_MATCH,{to_compare_prop:`taxAssetPrealnum ${l.taxAssetPrealnum}`,be_compare_prop:`taxAssetPrealnum ${p.taxAssetPrealnum}`,to_target:"taxInformation",be_target:"memEntity"})}return n()},{taskname:"applyTransaction/logicVerifier/payTax"})}__listenEventIssueCertificate(e,t){t.on("issueCertificate",async({transaction:r,applyInfo:n},s)=>{const{address:i,possessorAddress:o,sourceChainMagic:a,sourceChainName:p,certificateId:l}=n;if(i!==o&&await this.helperLogicVerifier.isAccountFrozen(o,e),await this.accountGetterHelper.getCertificate(a,l,e))throw new he(c.CERTIFICATE_IS_ALREADY_EXIST,{certificateId:l,errorId:He.CERTIFICATE_ALREADY_EXIST});return s()},{taskname:"applyTransaction/logicVerifier/issueCertificate"})}__listenEventDestroyCertificate(e,t){t.on("destroyCertificate",async({transaction:r,applyInfo:n},s)=>{const{sourceChainMagic:i,sourceChainName:o,certificateId:a}=n,p=await this.helperLogicVerifier.isCertificateExist(o,i,a,e);if(p.status===255)throw new he(c.CERTIFICATE_ALREADY_DESTROY,{certificateId:a});if(p.status===17)throw new he(c.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:a,reason:"Frozen certificate can not be destroy"});if(p.type===0)throw new he(c.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:a,reason:"Certificate with type 0 can not be destroy"});if(p.type===1&&p.applyAddress!==r.senderId)throw new he(c.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:a,reason:`Only certificate applicant can deestory certificate ${a}`});if(p.possessorAddress!==r.senderId)throw new he(c.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:a,reason:`Only certificate possessor can deestory certificate ${a}`});return s()},{taskname:"applyTransaction/logicVerifier/destroyCertificate"})}__listenEventFrozenCertificate(e,t){t.on("frozenCertificate",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,certificateId:a}=r,p=await this.helperLogicVerifier.isCertificateExist(i,o,a,e);if(p.status===255)throw new he(c.CERTIFICATE_ALREADY_DESTROY,{certificateId:a});if(p.status===17)throw new he(c.CERTIFICATE_ALREADY_FROZEN,{certificateId:a});if(p.possessorAddress!==s)throw new he(c.ACCOUNT_NOT_CERTIFICATE_POSSESSOR,{address:s,certificateId:a,errorId:He.ACCOUNT_NOT_CERTIFICATE_POSSESSOR});return n()},{taskname:"applyTransaction/logicVerifier/frozenCertificate"})}__listenEventUnfrozenCertificate(e,t){t.on("unfrozenCertificate",async({transaction:r,applyInfo:n},s)=>{const{address:i,sourceChainName:o,sourceChainMagic:a,certificateId:p,frozenId:l}=n,h=await this.helperLogicVerifier.isCertificateExist(o,a,p,e);if(h.status===255)throw new he(c.CERTIFICATE_ALREADY_DESTROY,{certificateId:p});if(h.status!==17)throw new he(c.CERTIFICATE_NOT_FROZEN,{certificateId:p});if(h.frozenId!==l)throw new he(c.SHOULD_BE,{to_compare_prop:`frozenId ${l}`,to_target:"transaction",be_compare_prop:`certificate frozenId ${h.frozenId}`});if(r.recipientId!==h.possessorAddress)throw new he(c.SHOULD_BE,{to_compare_prop:`recipientId ${r.recipientId}`,to_target:"transaction",be_compare_prop:`Certificate possessor ${h.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/unfrozenCertificate"})}__listenEventChangeCertificatePossessor(e,t){t.on("changeCertificatePossessor",async({transaction:r,applyInfo:n},s)=>{const{address:i,possessorAddress:o,sourceChainName:a,sourceChainMagic:p,certificateId:l}=n;i!==o&&await this.helperLogicVerifier.isAccountFrozen(o,e);const h=await this.helperLogicVerifier.isCertificateExist(a,p,l,e);if(h.status===255)throw new he(c.CERTIFICATE_ALREADY_DESTROY,{certificateId:l});if(h.status===17)throw new he(c.CERTIFICATE_ALREADY_FROZEN,{certificateId:l});if(r.senderId!==h.possessorAddress)throw new he(c.SHOULD_BE,{to_compare_prop:`senderId ${r.senderId}`,to_target:"transaction",be_compare_prop:`Certificate possessor ${h.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/changeCertificatePossessor"})}__listenEventStakeAsset(e,t,r){r.on("stakeAsset",async({transaction:n,applyInfo:s},i)=>{const{address:o,stakeId:a,beginUnstakeHeight:p,assetInfo:l}=s,{magic:h,chainName:y,assetType:A}=l,_=await this.accountGetterHelper.getStakeAsset(o,a);if(_){if(p<_.beginUnstakeHeight)throw new he(c.PROP_SHOULD_GTE_FIELD,{prop:`beginUnstakeHeight ${p}`,target:"stakeAsset",field:_.beginUnstakeHeight});if(h!==_.sourceChainMagic||A!==_.assetType)throw new he(c.NOT_MATCH,{to_compare_prop:`stakeAsset: ${JSON.stringify({sourceChainMagic:h,sourceChainName:y,assetType:A})}`,be_compare_prop:`stakeAsset: ${JSON.stringify({sourceChainMagic:_.sourceChainMagic,sourceChainName:_.sourceChainName,assetType:_.assetType})}`,to_target:"StakeAssetTransaction.asset.stakeAsset",be_target:"blockChain"})}const{assets:E}=await this.helperLogicVerifier.getAccountForce(e,o,t);E[h]=E[h]||{},E[h][A]=E[h][A]||{sourceChainMagic:h,assetType:A,assetNumber:BigInt(0),history:{}};const T=E[h][A],w=T.assetNumber;if(T.assetNumber+=BigInt(s.amount),T.assetNumber<BigInt(0))throw new he(c.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${n.signature} address: ${o} magic ${s.assetInfo.magic} assetType: ${s.assetInfo.assetType} hodingAsset: ${w.toString()} stakeAsset: ${s.amount}`,errorId:He.ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/stakeAsset"})}__listenEventUnstakeAsset(e,t){t.on("unstakeAsset",async({transaction:r,applyInfo:n},s)=>{const{address:i,assetInfo:o,stakeId:a,amount:p}=n,{magic:l,assetType:h}=o,y=await this.helperLogicVerifier.getStakeAssetForce(i,a),{beginUnstakeHeight:A,amount:_}=y;if(A>e)throw new he(c.NOT_BEGIN_UNSTAKE_YET,{stakeId:a});if(BigInt(p)>BigInt(_))throw new he(c.STAKE_ASSET_NOT_ENOUGH,{reason:`No enough asset to unstake magic ${l} assetType ${h} remain ${_} spend ${p}`,stakeId:a});return s()},{taskname:"applyTransaction/logicVerifier/unstakeAsset"})}listenEvent(e,t,r){this.__listenEventFee(e,t,r),this.__listenEventDestroyMainAsset(e,t,r),this.__listenEventAsset(e,t,r),this.__listenEventFrozenAsset(e,t,r),this.__listenEventUnfrozenAsset(t,r),this.__listenEventSignForAsset(t,r),this.__listenEventFrozenAccount(e,t,r),this.__listenEventSetSecondPublicKey(r),this.__listenEventIssueAsset(e,t,r),this.__listenEventIncreaseAsset(e,t,r),this.__listenEventDestroyAsset(r),this.__listenEventIssueDAppid(t,r),this.__listenEventFrozenDAppid(t,r),this.__listenEventUnfrozenDAppid(t,r),this.__listenEventChangeDAppidPossessor(t,r),this.__listenEventRegisterChain(e,t,r),this.__listenEventRegisterLocationName(t,r),this.__listenEventCancelLocationName(t,r),this.__listenEventSetLnsManager(t,r),this.__listenEventSetLnsRecordValue(t,r),this.__listenEventFrozenLocationName(t,r),this.__listenEventUnfrozenLocationName(t,r),this.__listenEventChangeLocationNamePossessor(t,r),this.__listenEventIssueEntityFactoryByFrozen(e,t,r),this.__listenEventIssueEntityFactoryByDestroy(t,r),this.__listenEventIssueEntity(e,t,r),this.__listenEventIssueEntityMulti(e,t,r),this.__listenEventDestroyEntity(t,r),this.__listenEventFrozenEntity(t,r),this.__listenEventUnfrozenEntity(t,r),this.__listenEventChangeEntityPossessor(t,r),this.__listenEventMigrateCertificate(r),this.__listenEventPayTax(t,r),this.__listenEventIssueCertificate(t,r),this.__listenEventDestroyCertificate(t,r),this.__listenEventFrozenCertificate(t,r),this.__listenEventUnfrozenCertificate(t,r),this.__listenEventChangeCertificatePossessor(t,r),this.__listenEventStakeAsset(e,t,r),this.__listenEventUnstakeAsset(t,r)}async awaitEventResult(e,t){await this.transactionCore.getTransactionFactoryFromType(e.type).applyTransaction(e,t)}};u([Z(Lt),g("design:type",Lt)],as.prototype,"jsbiHelper",void 0);u([Z(ue),g("design:type",ue)],as.prototype,"configHelper",void 0);u([Z(wt),g("design:type",wt)],as.prototype,"blockHelper",void 0);u([Z(we),g("design:type",we)],as.prototype,"transactionHelper",void 0);u([Z(ji),g("design:type",ji)],as.prototype,"helperLogicVerifier",void 0);u([Z("bfchain-core:TransactionCore"),g("design:type",Object)],as.prototype,"transactionCore",void 0);u([Z("accountGetterHelper",{dynamics:!0}),g("design:type",Object)],as.prototype,"accountGetterHelper",void 0);as=u([ie()],as);let fc=class{constructor(){this.__cacheMap=new Map}getCache(e){return this.__cacheMap.get(e)}setCache(e,t){this.__cacheMap.set(e,t)}clearCache(){this.__cacheMap.clear()}};fc=u([ie()],fc);const{ConsensusException:It,NoFoundException:DN}=le("VERIFIER","TransactionLogicVerifier");class De{async logicVerify(t,r,n){if(t.version>this.configHelper.version)throw new It(c.PROP_SHOULD_LTE_FIELD,{prop:`version ${t.version}`,target:`transaction ${t.signature}`,field:`blockChain version ${this.configHelper.version}`});const{senderId:s,recipientId:i}=t,o=await this.helperLogicVerifier.getAccountForce(n,s,r);if(this.checkSenderAccountStatus(o),this.checkSecondPublicKey(o,t),this.checkApplyBlockHeight(t,r),this.checkEffectiveBlockHeight(t,r),await this.checkTransactionMagic(t),r>1&&this.checkTransactionTimestamp(t),await this.checkTransactionRange(t,r),i){const a=await this.helperLogicVerifier.getAccountForce(n,i,r);this.checkRecipientAccountStatus(a)}return this.checkTrsMaxBytes(t.getBytes().length),await this.checkDAppId(t,r),await this.checkLocationName(t,r),!0}checkSenderAccountStatus(t){if(!(t&&t.hasOwnProperty("accountStatus")))throw new It(c.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(t.accountStatus===16||t.accountStatus===17)throw new It(c.ACCOUNT_FROZEN,{address:t.address,errorId:He.TRANSACTION_SENDER_ASSET_FROZEN})}checkRecipientAccountStatus(t){if(!t.hasOwnProperty("accountStatus"))throw new It(c.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(t.accountStatus===1||t.accountStatus===17)throw new It(c.ACCOUNT_FROZEN,{address:t.address,errorId:He.TRANSACTION_RECIPIENT_ASSET_FROZEN})}checkSecondPublicKey(t,r){const{type:n,senderId:s,senderSecondPublicKey:i,applyBlockHeight:o,signature:a,signSignature:p}=r,l=t.secondPublicKey;if(l){if(!(i&&p))throw new It(c.TRANSACTION_SIGN_SIGNATURE_IS_REQUIRED,{signature:a,senderId:s,applyBlockHeight:o,type:n});if(l!==i)throw new It(c.TRANSACTION_SENDER_SECOND_PUBLICKEY_ALREADY_CHANGE,{signature:a,senderId:s,applyBlockHeight:o,type:n})}else{if(i)throw new It(c.TRANSACTION_SHOULD_NOT_HAVE_SENDER_SECOND_PUBLICKEY,{signature:a,senderId:s,applyBlockHeight:o,type:n});if(p)throw new It(c.TRANSACTION_SHOULD_NOT_HAVE_SIGN_SIGNATURE,{signature:a,senderId:s,applyBlockHeight:o,type:n})}}checkApplyBlockHeight(t,r){const n=t.applyBlockHeight;if(n>r)throw new It(c.INVALID_TRANSACTION_APPLY_BLOCK_HEIGHT,{signature:t.signature,reason:`applyBlockHeight ${n} must less than currntBlockHeight ${r}`},void 0,"minor")}checkEffectiveBlockHeight(t,r){const n=t.effectiveBlockHeight;if(n<r)throw new It(c.INVALID_TRANSACTION_EFFECTIVE_BLOCK_HEIGHT,{signature:t.signature,reason:`effectiveBlockHeight ${n} must greate than or equal to currntBlockHeight ${r}`})}async checkTransactionMagic(t){const r=t.fromMagic,n=t.toMagic,s=this.configHelper.magic;if(r===s){if(n===s)return;if(!await this.accountGetterHelper.getChain(n))throw new It(c.INVALID_TRANSACTION_TO_MAGIC,{reason:"Transaction toMagic chain not exists",signature:t.signature,senderId:t.senderId,applyBlockHeight:t.applyBlockHeight,type:t.type})}else{if(!await this.accountGetterHelper.getChain(r))throw new It(c.INVALID_TRANSACTION_FROM_MAGIC,{reason:"Transaction fromMagic chain not exists",signature:t.signature,senderId:t.senderId,applyBlockHeight:t.applyBlockHeight,type:t.type});if(n!==s)throw new It(c.INVALID_TRANSACTION_TO_MAGIC,{reason:"Transaction to magic must be local",signature:t.signature,senderId:t.senderId,applyBlockHeight:t.applyBlockHeight,type:t.type})}}checkTransactionTimestamp(t){const{timeHelper:r}=this,n=r.getTimestamp(),s=r.getSlotNumberByTimestamp(t.timestamp),i=r.getSlotNumberByTimestamp(n);if(s>i)throw new It(c.INVALID_TRANSACTION_TIMESTAMP,{reason:`Transaction timestamp in future. Transaction time is ahead of the time on the server, transaction timestamp ${t.timestamp}, transaction timestamp slot ${s}, blockChain now timestamp ${n}, blockChain now timestamp slot ${i}`,signature:t.signature,senderId:t.senderId,applyBlockHeight:t.applyBlockHeight,type:t.type})}async checkTransactionRange(t,r){const{accountGetterHelper:n}=this,{rangeType:s,range:i}=t,{magic:o}=this.configHelper;switch(s){case 0:break;case 1:break;case 2:for(const a of i)if(!await n.getDApp(o,a,r))throw new It(c.DAPPID_IS_NOT_EXIST,{dappid:a});break;case 4:for(const a of i)if(!await n.getLocationName(o,a,r))throw new It(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:a});break;default:throw new It(c.UNKNOWN_RANGE_TYPE,{rangeType:s})}}checkTrsMaxBytes(t){if(BigInt(t)>BigInt(this.configHelper.maxTransactionSize))throw new It(c.INVALID_TRANSACTION_BYTE_LENGTH,{reason:`The size of the transaction ${t} exceeds the limit`})}async checkDAppId(t,r){const{dappid:n,senderId:s}=t;if(!n)return;const{accountGetterHelper:i,transactionGetterHelper:o}=this,a=await i.getDApp(t.fromMagic,n,r);if(!a)throw new It(c.DAPPID_IS_NOT_EXIST,{dappid:n});const p=a.possessorAddress;if(!await i.getAccountInfo(p,r))throw new It(c.NOT_FOUND,{porp:`Dapp possessor ${p}`});if(a.type===0&&!await o.getPurchaseDApp(s,n))throw new It(c.NEED_PURCHASE_DAPPID_BEFORE_USE,{dappid:`${n} user ${s} possessor ${p}`})}async checkLocationName(t,r){const n=t.lns;if(n&&!await this.accountGetterHelper.getLocationName(this.configHelper.magic,n,r))throw new It(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:n,errorId:He.LOCATION_NAME_NOT_EXIST})}isFeeEnough(t,r,n){return BigInt(r)<BigInt(n)?{signature:t,isFeeEnough:!1,minFee:n}:{signature:t,isFeeEnough:!0,minFee:n}}checkTrsFeeAndWebFee(t,r){return this.isFeeEnough(t.signature,t.fee,(this.transactionHelper.calcTransactionMinFeeByBytes(t,r)+this.transactionHelper.calcTransactionBlobFee(t)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(t,r,n){return this.isFeeEnough(t.signature,t.fee,(this.transactionHelper.calcTransactionMinFeeByBytes(t,r,n)+this.transactionHelper.calcTransactionBlobFee(t,n)).toString())}checkTransactionBlobSize(t,r){const{maxBlockBlobSize:n}=this.configHelper,s=r===void 0||n<r?n:r,i=t.getBlobSize(!0);if(i>s)throw new It(c.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${i}`,target:"transaction",field:s})}async checkRepeatInUntreatedTransaction(t){const{senderId:r,signature:n}=t;if(await this.transactionGetterHelper.countTransactionInUntreatedBySignature(r,n)>0)throw new It(c.ALREADY_EXIST,{prop:`Transaction with signature ${n}`,target:"untreated transaction"})}async checkRepeatInBlockChainTransaction(t,r,n=0){const{signature:s,applyBlockHeight:i}=t;if(await this.transactionGetterHelper.countTransactionInBlockChainBySignature(s,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(i,r))>n)throw new It(c.ALREADY_EXIST,{prop:`Transaction with signature ${s}`,target:"blockChain"})}getLockData(t){return[]}clearCache(){this.memoryCache.clearCache()}}u([Z(ue),g("design:type",ue)],De.prototype,"configHelper",void 0);u([Z(Yt),g("design:type",Yt)],De.prototype,"timeHelper",void 0);u([Z(wt),g("design:type",wt)],De.prototype,"blockHelper",void 0);u([Z(we),g("design:type",we)],De.prototype,"transactionHelper",void 0);u([Z(Lt),g("design:type",Lt)],De.prototype,"jsbiHelper",void 0);u([Z(as,{dynamics:!0}),g("design:type",as)],De.prototype,"eventLogicVerifier",void 0);u([Z(ji),g("design:type",ji)],De.prototype,"helperLogicVerifier",void 0);u([Z("transactionGetterHelper",{dynamics:!0}),g("design:type",Object)],De.prototype,"transactionGetterHelper",void 0);u([Z("blockGetterHelper",{dynamics:!0}),g("design:type",Object)],De.prototype,"blockGetterHelper",void 0);u([Z("accountGetterHelper",{dynamics:!0}),g("design:type",Object)],De.prototype,"accountGetterHelper",void 0);u([Z(fc),g("design:type",fc)],De.prototype,"memoryCache",void 0);let id=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}};id=u([ie(),g("design:paramtypes",[])],id);let od=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.dapp.dappid]}};od=u([ie(),g("design:paramtypes",[])],od);const{ConsensusException:da}=le("VERIFIER","DAppPurchasingLogicVerifier");let ad=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.isDAppidMatch(e,t),await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}async isDAppidMatch(e,t){const{dappAsset:r}=e.asset.dappPurchasing,{sourceChainMagic:n,dappid:s}=r,i=await this.accountGetterHelper.getDApp(n,s,t);if(!i)throw new da(c.DAPPID_IS_NOT_EXIST,{dappid:s});if(e.recipientId!==i.possessorAddress)throw new da(c.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"DAppPurchasingTransaction",be_compare_prop:`dapp possessor ${i.possessorAddress}`});if(r.sourceChainName!==i.sourceChainName||r.type!==i.type)throw new da(c.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(r.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:r.sourceChainMagic,sourceChainName:i.sourceChainName,dappid:s,type:i.type})}`,to_target:"DAppPurchasingTransaction.asset.dappPurchasing",be_target:"blockChain dapp"});if(i.purchaseAsset){if(!r.purchaseAsset)throw new da(c.PROP_IS_REQUIRE,{prop:"purchaseAsset",target:"DAppPurchasingTransaction.asset.dappPurchasing.dappAsset"});if(r.purchaseAsset!==i.purchaseAsset)throw new da(c.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(r.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:r.sourceChainMagic,sourceChainName:i.sourceChainName,dappid:s,type:i.type,purchaseAsset:i.purchaseAsset})}`,to_target:"DAppPurchasingTransaction.asset.dappPurchasing",be_target:"blockChain dapp"})}else if(r.purchaseAsset)throw new da(c.SHOULD_NOT_EXIST,{prop:"purchaseAsset",target:"DAppPurchasingTransaction.asset.dappPurchasing.dappAsset"})}};ad=u([ie(),g("design:paramtypes",[])],ad);const{ConsensusException:Mc}=le("VERIFIER","MarkLogicVerifier");let cd=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.isDAppidMatch(e,t),await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}async isDAppidMatch(e,t){const{dapp:r}=e.asset.mark,{sourceChainMagic:n,dappid:s}=r,i=await this.accountGetterHelper.getDApp(n,s,t);if(!i)throw new Mc(c.DAPPID_IS_NOT_EXIST,{dappid:s});if(r.sourceChainName!==i.sourceChainName||r.type!==i.type)throw new Mc(c.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(r.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:r.sourceChainMagic,sourceChainName:i.sourceChainName,dappid:s,type:i.type})}`,to_target:"MarkTransaction.asset.mark",be_target:"blockChain dapp"});if(i.purchaseAsset){if(!r.purchaseAsset)throw new Mc(c.PROP_IS_REQUIRE,{prop:"purchaseAsset",target:"MarkTransaction.asset.mark.dapp"});if(r.purchaseAsset!==i.purchaseAsset)throw new Mc(c.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(r.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:r.sourceChainMagic,sourceChainName:i.sourceChainName,dappid:s,type:i.type,purchaseAsset:i.purchaseAsset})}`,to_target:"MarkTransaction.asset.mark",be_target:"blockChain dapp"})}else if(r.purchaseAsset)throw new Mc(c.SHOULD_NOT_EXIST,{prop:"purchaseAsset",target:"MarkTransaction.asset.mark.dapp"})}};cd=u([ie(),g("design:paramtypes",[])],cd);let pd=class extends De{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.type]}};pd=u([ie(),Ce(0,Z(Te)),Ce(1,Z(we)),g("design:paramtypes",[Te,we])],pd);const{ConsensusException:G_}=le("VERIFIER","TransactionLogicVerifier");let hd=class extends De{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:a}=e.asset.increaseAsset;await this.helperLogicVerifier.isAssetExist(a,i,o);const p=await this.helperLogicVerifier.getAccountForce(r,e.recipientId,t);this.checkRecipientStatus(o,p),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}checkRecipientStatus(e,t){if(!t.hasOwnProperty("accountStatus"))throw new G_(c.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(t.accountStatus===16&&e!==this.configHelper.assetType)throw new G_(c.PERMISSION_DENIED,{operationName:`Increase asset ${e} to ${t.address}, because ${t.address} was frozen`})}getLockData(e){return[e.asset.increaseAsset.applyAddress]}};hd=u([ie(),Ce(0,Z(Te)),Ce(1,Z(we)),g("design:paramtypes",[Te,we])],hd);const{ConsensusException:K_}=le("VERIFIER","TransactionLogicVerifier");let ld=class extends De{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:a}=e.asset.transferAsset;await this.helperLogicVerifier.isAssetExist(a,i,o);const p=await this.helperLogicVerifier.getAccountForce(r,e.recipientId,t);this.checkRecipientStatus(o,p),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}checkRecipientStatus(e,t){if(!t.hasOwnProperty("accountStatus"))throw new K_(c.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(t.accountStatus===16&&e!==this.configHelper.assetType)throw new K_(c.PERMISSION_DENIED,{operationName:`Transfer asset ${e} to ${t.address}, because ${t.address} was frozen`})}};ld=u([ie(),g("design:paramtypes",[])],ld);const{ConsensusException:j_}=le("VERIFIER","TransactionLogicVerifier");let ud=class extends De{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainName:i,sourceChainMagic:o,parentAssetType:a,assetType:p}=e.asset.transferAny;a===ne.ASSETS&&await this.helperLogicVerifier.isAssetExist(i,o,p);const l=await this.helperLogicVerifier.getAccountForce(r,e.recipientId,t);this.checkRecipientStatus(p,l),await this.logicVerify(e,t,r);const{eventLogicVerifier:h}=this;return n===!1&&h.listenEvent(r,t,s),await h.awaitEventResult(e,s),!0}checkRecipientStatus(e,t){if(!t.hasOwnProperty("accountStatus"))throw new j_(c.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(t.accountStatus===16&&e!==this.configHelper.assetType)throw new j_(c.PERMISSION_DENIED,{operationName:`Transfer asset ${e} to ${t.address}, because ${t.address} was frozen`})}getLockData(e){const{parentAssetType:t,assetType:r,taxInformation:n}=e.asset.transferAny,s=[];return(t===ne.DAPP||t===ne.LOCATION_NAME||t===ne.ENTITY)&&(s.push(r),n&&s.push(n.taxCollector)),s}};ud=u([ie(),g("design:paramtypes",[])],ud);const{ConsensusException:Iw}=le("VERIFIER","TransactionLogicVerifier");let gd=class extends De{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:a}=e.asset.destroyAsset,p=await this.helperLogicVerifier.isAssetExist(a,i,o);if(p.applyAddress!==e.recipientId)throw new Iw(c.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"transaction",be_compare_prop:`asset apply account address ${p.applyAddress}`});await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}};gd=u([ie(),g("design:paramtypes",[])],gd);let fd=class extends De{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:a,totalGrabableTimes:p}=e.asset.giftAsset;await this.helperLogicVerifier.isAssetExist(a,i,o),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}checkTrsFeeAndWebFee(e,t){const r=e.asset.giftAsset.totalGrabableTimes+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(r)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=e.asset.giftAsset.totalGrabableTimes+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(n,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}};fd=u([ie(),g("design:paramtypes",[])],fd);let dd=class extends De{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,parentAssetType:a,sourceChainName:p}=e.asset.giftAny;a===ne.ASSETS&&await this.helperLogicVerifier.isAssetExist(p,i,o),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}checkTrsFeeAndWebFee(e,t){const r=e.asset.giftAny.totalGrabableTimes+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(r)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=e.asset.giftAny.totalGrabableTimes+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(n,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{parentAssetType:t,assetType:r}=e.asset.giftAny,n=[];return(t===ne.DAPP||t===ne.LOCATION_NAME||t===ne.ENTITY)&&n.push(r),n}};dd=u([ie(),g("design:paramtypes",[])],dd);const{ConsensusException:fr,NoFoundException:Tw}=le("VERIFIER","GrabAssetLogicVerifier");let Au=class extends De{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.grabAsset,{transactionSignature:o}=i,a=await this.transactionGetterHelper.getTransactionAndBlockSignatureBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!a)throw new Tw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"grabAsset"});const p=a.transaction,l=(await this.transactionCore.recombineTransaction(p)).as(mo,o);if(!l)throw new fr(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});this.isValidRecipientId(e,l),this.isBlockSignatureMatch(e,a.blockSignature),this.isDependentTransactionMatch(e,l),await this.isValidAmount(e),await this.logicVerify(e,t,r);const{eventLogicVerifier:h}=this;return n===!1&&h.listenEvent(r,t,s),await h.awaitEventResult(e,s),!0}async isValidAmount(e){const{senderId:t,recipientId:r,asset:n}=e,s=n.grabAsset,{giftAsset:i,blockSignatureBuffer:o,transactionSignatureBuffer:a}=s;let p;switch(i.giftDistributionRule){case 0:p=this.transactionHelper.calcGrabAverageGiftAssetNumber(i.amount,i.totalGrabableTimes);break;case 1:p=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,o,a,r,i.amount,i.totalGrabableTimes);break;case 2:p=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,o,a,r,i.amount,i.totalGrabableTimes);break}if(!p)throw new fr(c.PROP_IS_INVALID,{prop:`calculate amount ${p.toString()}`,target:"giftAsset"});if(p.toString()!==s.amount)throw new fr(c.SHOULD_BE,{to_compare_prop:`amount ${s.amount}`,to_target:"grabAsset",be_compare_prop:p.toString()})}isValidRecipientId(e,t){if(e.recipientId!==t.senderId)throw new fr(c.NOT_MATCH,{to_compare_prop:`GrabAssetTransaction.recipientId ${e.recipientId}`,be_compare_prop:`GiftAssetTransaction.senderId ${t.senderId}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"})}isBlockSignatureMatch(e,t){if(t!==e.asset.grabAsset.blockSignature)throw new fr(c.NOT_MATCH,{to_compare_prop:`blockSignature ${t}`,be_compare_prop:`blockSignature ${e.asset.grabAsset.blockSignature}`,to_target:"grabAsset",be_target:"blockChain"})}isDependentTransactionMatch(e,t){const r=e.asset.grabAsset,{giftAsset:n,ciphertextSignature:s}=r,{sourceChainMagic:i,sourceChainName:o,assetType:a,amount:p,giftDistributionRule:l,totalGrabableTimes:h,cipherPublicKeys:y,beginUnfrozenBlockHeight:A}=n,_=t.asset.giftAsset;if(_.sourceChainMagic!==i||_.sourceChainName!==o||_.assetType!==a||_.totalGrabableTimes!==h||_.amount!==p||_.giftDistributionRule!==l)throw new fr(c.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(_)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"});if(_.beginUnfrozenBlockHeight!==void 0){if(A===void 0)throw new fr(c.PROP_IS_REQUIRE,{prop:"beginUnfrozenBlockHeight",target:"grabAsset.giftAsset"});if(_.beginUnfrozenBlockHeight!==A)throw new fr(c.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(_)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"})}else if(A!==void 0)throw new fr(c.SHOULD_NOT_EXIST,{prop:"beginUnfrozenBlockHeight",target:"grabAsset.giftAsset"});if(_.cipherPublicKeys.length!==y.length)throw new fr(c.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(_)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"});for(const w of _.cipherPublicKeys)if(!y.includes(w))throw new fr(c.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(_)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"});if(y.length>0){if(!s)throw new fr(c.PROP_IS_REQUIRE,{prop:"ciphertextSignature",target:"grabAsset"});const{publicKey:w}=s;if(!y.includes(w))throw new fr(c.NOT_MATCH,{to_compare_prop:`publicKey ${w}`,be_compare_prop:"cipherPublicKeys",to_target:"grabAsset.ciphertextSignature",be_target:"giftAsset.cipherPublicKeys"})}else if(s)throw new fr(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"grabAsset"});const{rangeType:E,range:T}=t;if(E&1){if(!T.includes(e.senderId))throw new fr(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"grabAssetTransaction",be_compare_prop:"giftAssetTransaction.range"})}else if(E&2){if(!e.dappid||!T.includes(e.dappid))throw new fr(c.SHOULD_BE,{to_compare_prop:`dappid ${e.dappid}`,to_target:"grabAssetTransaction",be_compare_prop:"giftAssetTransaction.range"})}else if(E&4&&(!e.lns||!T.includes(e.lns)))throw new fr(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"grabAssetTransaction",be_compare_prop:"giftAssetTransaction.range"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e,r).toString())}async checkSecondaryTransaction(e,t){if(await this.transactionGetterHelper.checkSecondaryTransaction({senderId:e.senderId,storageValue:e.storageValue,heightRange:this.transactionHelper.calcTransactionQueryRange(t)}))throw new fr(c.CAN_NOT_SECONDARY_TRANSACTION,{reason:`Can not secondary grab asset, sender ${e.senderId} gift transaction signature ${e.storageValue}`})}getLockData(e){const{transactionSignature:t}=e.asset.grabAsset;return[t]}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Au.prototype,"transactionCore",void 0);Au=u([ie(),g("design:paramtypes",[])],Au);const{ConsensusException:Gt,NoFoundException:bw}=le("VERIFIER","GrabAnyLogicVerifier");let Eu=class extends De{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.grabAny,{transactionSignature:o,giftAny:a}=i,p=await this.transactionGetterHelper.getTransactionAndBlockSignatureBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!p)throw new bw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"grabAny"});const l=p.transaction,h=(await this.transactionCore.recombineTransaction(l)).as(Io,o);if(!h)throw new Gt(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});this.isValidRecipientId(e,h),this.isBlockSignatureMatch(e,p.blockSignature),this.isDependentTransactionMatch(e,h),await this.isValidAmount(e),await this.logicVerify(e,t,r);const{eventLogicVerifier:y}=this;return n===!1&&y.listenEvent(r,t,s),await y.awaitEventResult(e,s),!0}async isValidAmount(e){const{senderId:t,recipientId:r,asset:n}=e,s=n.grabAny,{giftAny:i,blockSignatureBuffer:o,transactionSignatureBuffer:a}=s,{giftDistributionRule:p,parentAssetType:l,totalGrabableTimes:h,amount:y}=i;if(l===ne.ASSETS){let A;switch(p){case 0:A=this.transactionHelper.calcGrabAverageGiftAssetNumber(y,h);break;case 1:A=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,o,a,r,y,h);break;case 2:A=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,o,a,r,y,h);break}if(!A)throw new Gt(c.PROP_IS_INVALID,{prop:"calculate amount",target:"giftAsset"});if(A.toString()!==s.amount)throw new Gt(c.SHOULD_BE,{to_compare_prop:`amount ${s.amount}`,to_target:"grabAny",be_compare_prop:A.toString()})}else if(s.amount!=="1")throw new Gt(c.SHOULD_BE,{to_compare_prop:`amount ${s.amount}`,to_target:"giftAny",be_compare_prop:"1"})}isValidRecipientId(e,t){if(e.recipientId!==t.senderId)throw new Gt(c.NOT_MATCH,{to_compare_prop:`GrabAnyTransaction.recipientId ${e.recipientId}`,be_compare_prop:`GiftAnyTransaction.senderId ${t.senderId}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"})}isBlockSignatureMatch(e,t){if(t!==e.asset.grabAny.blockSignature)throw new Gt(c.NOT_MATCH,{to_compare_prop:`blockSignature ${t}`,be_compare_prop:`blockSignature ${e.asset.grabAny.blockSignature}`,to_target:"grabAny",be_target:"blockChain"})}isDependentTransactionMatch(e,t){const{giftAny:r,ciphertextSignature:n}=e.asset.grabAny,{sourceChainMagic:s,sourceChainName:i,assetType:o,amount:a,giftDistributionRule:p,totalGrabableTimes:l,beginUnfrozenBlockHeight:h,taxInformation:y,cipherPublicKeys:A}=r,_=t.asset.giftAny;if(_.sourceChainMagic!==s||_.sourceChainName!==i||_.assetType!==o||_.amount!==a||_.giftDistributionRule!==p||_.totalGrabableTimes!==l)throw new Gt(c.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(_)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"});if(_.beginUnfrozenBlockHeight!==void 0){if(h===void 0)throw new Gt(c.PROP_IS_REQUIRE,{prop:"beginUnfrozenBlockHeight",target:"grabAny.giftAny"});if(_.beginUnfrozenBlockHeight!==h)throw new Gt(c.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(_)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"})}else if(h!==void 0)throw new Gt(c.SHOULD_NOT_EXIST,{prop:"beginUnfrozenBlockHeight",target:"grabAny.giftAny"});if(_.taxInformation){if(!y)throw new Gt(c.PROP_IS_REQUIRE,{prop:"taxInformation",target:"grabAny.giftAny"});if(_.taxInformation.taxAssetPrealnum!==y.taxAssetPrealnum||_.taxInformation.taxCollector!==y.taxCollector)throw new Gt(c.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(_)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"})}else if(y)throw new Gt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"grabAny.giftAny"});if(_.cipherPublicKeys.length!==A.length)throw new Gt(c.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(_)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"});for(const w of _.cipherPublicKeys)if(!A.includes(w))throw new Gt(c.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(_)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"});if(A.length>0){if(!n)throw new Gt(c.NOT_EXIST,{prop:"ciphertextSignature",target:"grabAny"});const{publicKey:w}=n;if(!A.includes(w))throw new Gt(c.NOT_MATCH,{to_compare_prop:`publicKey ${w}`,be_compare_prop:"cipherPublicKeys",to_target:"grabAny.ciphertextSignature",be_target:"giftAny.cipherPublicKeys"})}else if(n)throw new Gt(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"grabAny"});const{rangeType:E,range:T}=t;if(E&1){if(!T.includes(e.senderId))throw new Gt(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"grabAnyTransaction",be_compare_prop:"giftAnyTransaction.range"})}else if(E&2){if(!e.dappid||!T.includes(e.dappid))throw new Gt(c.SHOULD_BE,{to_compare_prop:`dappid ${e.dappid}`,to_target:"grabAnyTransaction",be_compare_prop:"giftAnyTransaction.range"})}else if(E&4&&(!e.lns||!T.includes(e.lns)))throw new Gt(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"grabAnyTransaction",be_compare_prop:"giftAnyTransaction.range"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e,r).toString())}async checkSecondaryTransaction(e,t){if(await this.transactionGetterHelper.checkSecondaryTransaction({senderId:e.senderId,storageValue:e.storageValue,heightRange:this.transactionHelper.calcTransactionQueryRange(t)}))throw new Gt(c.CAN_NOT_SECONDARY_TRANSACTION,{reason:`Can not secondary grab asset, sender ${e.senderId} gift transaction signature ${e.storageValue}`})}getLockData(e){const{transactionSignature:t,giftAny:r}=e.asset.grabAny,{parentAssetType:n,assetType:s,taxInformation:i}=r,o=[t];return(n===ne.DAPP||n===ne.LOCATION_NAME||n===ne.ENTITY)&&(o.push(s),i&&o.push(i.taxCollector)),o}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Eu.prototype,"transactionCore",void 0);Eu=u([ie(),g("design:paramtypes",[])],Eu);const{ConsensusException:z_}=le("VERIFIER","TrustAssetLogicVerifier");let yd=class extends De{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:a,numberOfSignFor:p}=e.asset.trustAsset;if(!(i===this.configHelper.magic&&o===this.configHelper.assetType))throw new z_(c.TRUST_MAIN_ASSET_ONLY,{assetType:o,mainAsset:this.configHelper.assetType,errorId:He.TRUST_MAIN_ASSET_ONLY});await this.isTrusteesFrozen(e.asset.trustAsset.trustees,t),await this.helperLogicVerifier.isAssetExist(a,i,o),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}async isTrusteesFrozen(e,t){for(const r of e){const n=await this.accountGetterHelper.getAccountInfo(r,t);if(n&&n.accountStatus!==0)throw new z_(c.ACCOUNT_FROZEN,{address:n.address,errorId:He.TRANSACTION_SENDER_ASSET_FROZEN})}}checkTrsFeeAndWebFee(e,t){const r=e.asset.trustAsset.numberOfSignFor+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(r)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=e.asset.trustAsset.numberOfSignFor+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(n,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}};yd=u([ie(),g("design:paramtypes",[])],yd);const{ConsensusException:ro}=le("VERIFIER","SignForAssetLogicVerifier");let Iu=class extends De{constructor(e){super(),this.accountBaseHelper=e}async verify(e,t,r,n,s){const{transactionSignature:i}=e.asset.signForAsset,o=await this.transactionGetterHelper.getTransactionBySignature(i,this.transactionHelper.calcTransactionQueryRange(t));if(!o)throw new ro(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${i}`,target:"blockChain"});const a=(await this.transactionCore.recombineTransaction(o)).as(Ha,i);if(!a)throw new ro(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${i}`});await this.isDependentTransactionMatch(e,a),await this.logicVerify(e,t,r);const{eventLogicVerifier:p}=this;return n===!1&&p.listenEvent(r,t,s),await p.awaitEventResult(e,s),!0}async isDependentTransactionMatch(e,t){const{trustAsset:r,trustSenderId:n,trustRecipientId:s}=e.asset.signForAsset,i=t.asset.trustAsset;if(n!==t.senderId)throw new ro(c.SHOULD_BE,{to_compare_prop:`trustSenderId ${n}`,be_compare_prop:`trustSenderId ${t.senderId}`,to_target:"SignForAssetTransaction.asset.signForAsset",be_target:"TrustAssetTransaction"});if(s!==t.recipientId)throw new ro(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`recipientId ${t.recipientId}`,to_target:"SignForAssetTransaction",be_target:"TrustAssetTransaction"});if(i.sourceChainMagic!==r.sourceChainMagic||i.sourceChainName!==r.sourceChainName||i.assetType!==r.assetType||i.amount!==r.amount||i.numberOfSignFor!==r.numberOfSignFor||i.trustees.length!==r.trustees.length)throw new ro(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(i)}`,be_compare_prop:`trustAsset: ${JSON.stringify(r.toJSON())}`,to_target:"SignForAssetTransaction.asset.signForAsset",be_target:"TrustAssetTransaction.asset.trustAsset"});const o=[...i.trustees],a=[...r.trustees];for(const p of o)if(!a.includes(p))throw new ro(c.NOT_MATCH,{to_compare_prop:`trustees: ${JSON.stringify(a)}`,be_compare_prop:`address: ${p}`,to_target:"SignForAssetTransaction.asset.signForAsset.trustAsset",be_target:"TrustAssetTransaction.asset.trustAsset"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e,r).toString())}async checkSecondaryTransaction(e,t){if(await this.transactionGetterHelper.checkSecondaryTransaction({senderId:e.senderId,storageValue:e.storageValue,heightRange:this.transactionHelper.calcTransactionQueryRange(t)}))throw new ro(c.CAN_NOT_SECONDARY_TRANSACTION,{reason:`Can not secondary sign for asset, sender ${e.senderId} trust transaction signature ${e.storageValue}`})}getLockData(e){return[e.asset.signForAsset.transactionSignature]}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Iu.prototype,"transactionCore",void 0);Iu=u([ie(),Ce(0,Z(Te)),g("design:paramtypes",[Te])],Iu);let md=class extends De{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.toExchangeAsset;await this.isExchangeAssetAlreadyExist(i),await this.logicVerify(e,t,r);const{eventLogicVerifier:o}=this;return n===!1&&o.listenEvent(r,t,s),await o.awaitEventResult(e,s),!0}async isExchangeAssetAlreadyExist(e){const{toExchangeSource:t,toExchangeChainName:r,toExchangeAsset:n,beExchangeSource:s,beExchangeChainName:i,beExchangeAsset:o}=e;await this.helperLogicVerifier.isAssetExist(r,t,n),await this.helperLogicVerifier.isAssetExist(i,s,o)}};md=u([ie(),g("design:paramtypes",[])],md);const{ConsensusException:dr,NoFoundException:ww}=le("VERIFIER","TransactionLogicVerifier");let Tu=class extends De{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){const i=e.asset.beExchangeAsset,{transactionSignature:o}=i,a=await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!a)throw new ww(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});const p=(await this.transactionCore.recombineTransaction(a)).as(Ma,o);if(!p)throw new dr(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});this.isValidRecipientId(e,p),this.isDependentTransactionMatch(e,p),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}isValidRecipientId(e,t){if(e.recipientId!==t.senderId)throw new dr(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${t.senderId}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"})}isDependentTransactionMatch(e,t){const r=e.asset.beExchangeAsset,{exchangeAsset:n,ciphertextSignature:s,toExchangeNumber:i,beExchangeNumber:o}=r,{cipherPublicKeys:a,exchangeRate:p}=n,l=t.asset.toExchangeAsset;if(l.toExchangeSource!==n.toExchangeSource||l.beExchangeSource!==n.beExchangeSource||l.toExchangeChainName!==n.toExchangeChainName||l.beExchangeChainName!==n.beExchangeChainName||l.toExchangeAsset!==n.toExchangeAsset||l.beExchangeAsset!==n.beExchangeAsset||l.toExchangeNumber!==n.toExchangeNumber)throw new dr(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});if(l.exchangeRate){if(!p)throw new dr(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});if(l.exchangeRate.prevWeight!==p.prevWeight||l.exchangeRate.nextWeight!==p.nextWeight)throw new dr(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"})}else if(p)throw new dr(c.SHOULD_NOT_EXIST,{prop:"exchangeRate",target:"BeExchangeAssetTransaction.beExchangeAsset.exchangeAsset"});if(e.senderId===e.recipientId){if(i==="0")throw new dr(c.PROP_SHOULD_GT_FIELD,{prop:`toExchangeNumber ${i}`,field:"0",target:"BeExchangeAssetTransaction.beExchangeAsset"});if(o!=="0")throw new dr(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeNumber ${o}`,field:"0",target:"BeExchangeAssetTransaction.beExchangeAsset"})}else{if(i==="0"&&o==="0")throw new dr(c.PROP_SHOULD_GT_FIELD,{prop:`beExchangeNumber ${o}`,field:"0",target:"beExchangeAsset"});const A=this.jsbiHelper.multiplyRoundFraction(i,{numerator:n.exchangeRate.nextWeight,denominator:n.exchangeRate.prevWeight});if(A>BigInt(o))throw new dr(c.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeNumber ${o}`,field:A.toString(),target:"BeExchangeAssetTransaction.beExchangeAsset"})}if(l.cipherPublicKeys.length!==a.length)throw new dr(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});for(const A of l.cipherPublicKeys)if(!a.includes(A))throw new dr(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});if(a.length>0){if(!s)throw new dr(c.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAsset"});const{publicKey:A}=s;if(!a.includes(A))throw new dr(c.NOT_MATCH,{to_compare_prop:`publicKey ${A}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAsset.ciphertextSignature",be_target:"toExchangeAsset.cipherPublicKeys"})}else if(s)throw new dr(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAsset"});const{rangeType:h,range:y}=t;if(h&1){if(!y.includes(e.senderId))throw new dr(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAssetTransaction",be_compare_prop:"toExchangeAssetTransaction.range"})}else if(h&2){if(!e.dappid||!y.includes(e.dappid))throw new dr(c.SHOULD_BE,{to_compare_prop:`dappid ${e.dappid}`,to_target:"beExchangeAssetTransaction",be_compare_prop:"toExchangeAssetTransaction.range"})}else if(h&4&&(!e.lns||!y.includes(e.lns)))throw new dr(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAssetTransaction",be_compare_prop:"toExchangeAssetTransaction.range"})}getLockData(e){return[e.asset.beExchangeAsset.transactionSignature]}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Tu.prototype,"transactionCore",void 0);Tu=u([ie(),g("design:paramtypes",[Lt])],Tu);const{ConsensusException:$n}=le("VERIFIER","EmigrateAssetLogicVerifier");let _d=class extends De{constructor(e,t,r){super(),this.accountBaseHelper=e,this.configMap=t,this.migrateCertificateHelper=r}async verify(e,t,r,n,s){const{accountGetterHelper:i}=this,{senderId:o,toMagic:a}=e,p=await this.helperLogicVerifier.getAccountForce(r,o,t);if(await i.isFrozenAsset(o))throw new $n(c.POSSESS_FROZEN_ASSET);await this.helperLogicVerifier.isPossessAssetExceptChainAsset(o,p.assets),await this.helperLogicVerifier.isDAppPossessor(o,this.configHelper),await this.helperLogicVerifier.isLnsPossessorOrManager(o,this.configHelper),await this.helperLogicVerifier.isEntityFactoryPossessor(o,this.configHelper),await this.helperLogicVerifier.isEntityPossessor(o,this.configHelper);let l;try{l=JSON.parse(e.asset.emigrateAsset.migrateCertificate)}catch{throw new $n(c.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const h=this.migrateCertificateHelper.getMigrateCertificateConverter(l),y=l.body,A=h.assetId.decode(y.assetId,!0),_=h.fromChainId.decode(y.fromChainId,!0).magic;if(!(_===this.configHelper.magic&&A.assetType===this.configHelper.assetType))throw new $n(c.MIGRATE_MAIN_ASSET_ONLY,{assetType:A.assetType,mainAsset:this.configHelper.assetType,errorId:He.MIGRATE_MAIN_ASSET_ONLY});const E=await i.getChain(a);if(!E)throw new $n(c.NOT_EXIST,{prop:`Chain with magic ${a}`,target:"blockChain"});const T=E.genesisBlock,w=h.toChainId.decode(y.toChainId,!0);await this.migrateCertificateHelper.checkChainInfo("toChain",w,{chainName:T.chainName,magic:T.magic,generatorPublicKey:T.genesisAccount.publicKey,genesisBlockSignature:T.genesisBlockSignature,genesisGenerators:T.genesisGenerators.map(G=>G.address)});const{publicKey:C,secondPublicKey:N,signSignature:L}=h.fromAuthSignature.decode(l.fromAuthSignature,!0),B=await this.accountBaseHelper.getAddressFromPublicKeyString(C),$=await i.getAccountInfo(B,t);if(!$)throw new $n(c.NOT_EXIST,{prop:`Account with address ${B}`,target:"blockChain"});if($.secondPublicKey){if(!N)throw new $n(c.PROP_IS_REQUIRE,{prop:"secondPublicKey",target:"genesisGeneratorsignature"});if(!L)throw new $n(c.PROP_IS_REQUIRE,{prop:"signSignature",target:"genesisGeneratorsignature"});if($.secondPublicKey!==N)throw new $n(c.NOT_MATCH,{to_compare_prop:`secondPublicKey ${$.secondPublicKey}`,be_compare_prop:`secondPublicKey ${N}`,to_target:"transaction",be_target:"generator"})}else{if(N)throw new $n(c.CAN_NOT_CARRY_SECOND_PUBLICKEY);if(L)throw new $n(c.CAN_NOT_CARRY_SECOND_SIGNATURE,{signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type})}if(A.parentAssetType===ne.ASSETS){const G=A.assetType===this.configHelper.assetType?BigInt(e.fee)+BigInt(y.assetPrealnum):BigInt(y.assetPrealnum);if(p.assets[_][A.assetType].assetNumber!==G)throw new $n(c.NEED_EMIGRATE_TOTAL_ASSET,{address:o})}await this.logicVerify(e,t,r);const{eventLogicVerifier:V}=this;return n===!1&&V.listenEvent(r,t,s),await V.awaitEventResult(e,s),!0}};_d=u([ie(),Ce(0,Z(Te)),g("design:paramtypes",[Te,Dr,si])],_d);const{ConsensusException:Ai,NoFoundException:FN}=le("VERIFIER","ImmigrateAssetLogicVerifier");let Ad=class extends De{constructor(e,t,r,n){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.configMap=r,this.migrateCertificateHelper=n}async verify(e,t,r,n,s){const i=this.accountGetterHelper;let o;try{o=JSON.parse(e.asset.immigrateAsset.migrateCertificate)}catch{throw new Ai(c.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const a=this.migrateCertificateHelper.getMigrateCertificateConverter(o),p=a.fromChainId.decode(o.body.fromChainId,!0),l=e.fromMagic,h=await i.getChain(l);if(!h)throw new Ai(c.NOT_EXIST,{prop:`Chain with magic ${p.magic}`,target:"blockChain"});const y=h.genesisBlock;await this.migrateCertificateHelper.checkChainInfo("fromChain",p,{chainName:y.chainName,magic:y.magic,generatorPublicKey:y.genesisAccount.publicKey,genesisBlockSignature:y.genesisBlockSignature,genesisGenerators:y.genesisGenerators.map(N=>N.address)});const{publicKey:A,secondPublicKey:_,signSignature:E}=a.toAuthSignature.decode(o.toAuthSignature,!0),T=await this.accountBaseHelper.getAddressFromPublicKeyString(A),w=await i.getAccountInfo(T,t);if(!w)throw new Ai(c.NOT_EXIST,{prop:`Account with address ${T}`,target:"blockChain"});if(w.secondPublicKey){if(!_)throw new Ai(c.PROP_IS_REQUIRE,{prop:"secondPublicKey",target:"genesisGeneratorsignature"});if(!E)throw new Ai(c.PROP_IS_REQUIRE,{prop:"signSignature",target:"genesisGeneratorsignature"});if(w.secondPublicKey!==_)throw new Ai(c.NOT_MATCH,{to_compare_prop:`secondPublicKey ${w.secondPublicKey}`,be_compare_prop:`secondPublicKey ${_}`,to_target:"transaction",be_target:"generator"})}else{if(_)throw new Ai(c.CAN_NOT_CARRY_SECOND_PUBLICKEY);if(E)throw new Ai(c.CAN_NOT_CARRY_SECOND_SIGNATURE)}await this.logicVerify(e,t,r);const{eventLogicVerifier:C}=this;return n===!1&&C.listenEvent(r,t,s),await C.awaitEventResult(e,s),!0}};Ad=u([ie(),Ce(0,Z(Te)),Ce(1,Z(we)),g("design:paramtypes",[Te,we,Dr,si])],Ad);let Ed=class extends De{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:a}=e.asset.stakeAsset;await this.helperLogicVerifier.isAssetExist(a,i,o),await this.logicVerify(e,t,r);const{eventLogicVerifier:p}=this;return n===!1&&p.listenEvent(r,t,s),await p.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.stakeAsset.stakeId]}};Ed=u([ie(),g("design:paramtypes",[])],Ed);const{ConsensusException:Sw}=le("VERIFIER","UnstakeAssetLogicVerifier");let bu=class extends De{constructor(e){super(),this.accountBaseHelper=e}async verify(e,t,r,n,s){const{stakeId:i,sourceChainMagic:o,sourceChainName:a,assetType:p}=e.asset.unstakeAsset,l=await this.helperLogicVerifier.getStakeAssetForce(e.senderId,i);if(l.sourceChainMagic!==o||l.sourceChainName!==a||l.assetType!==p)throw new Sw(c.NOT_MATCH,{to_compare_prop:`stakeAsset: ${JSON.stringify({sourceChainMagic:l.sourceChainMagic,sourceChainName:l.sourceChainName,assetType:l.assetType})}`,be_compare_prop:`unstakeAsset: ${JSON.stringify({sourceChainMagic:o,sourceChainName:a,assetType:p})}`,to_target:"UnstakeAssetTransaction.asset.unstakeAsset",be_target:"StakeAssetTransaction.asset.stakeAsset"});await this.logicVerify(e,t,r);const{eventLogicVerifier:h}=this;return n===!1&&h.listenEvent(r,t,s),await h.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.unstakeAsset.stakeId]}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],bu.prototype,"transactionCore",void 0);bu=u([ie(),Ce(0,Z(Te)),g("design:paramtypes",[Te])],bu);let Id=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.locationName.name]}};Id=u([ie(),g("design:paramtypes",[])],Id);let Td=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.lnsManager.name]}};Td=u([ie(),g("design:paramtypes",[])],Td);let bd=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.lnsRecordValue.name]}};bd=u([ie(),g("design:paramtypes",[])],bd);let wd=class extends De{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.type]}};wd=u([ie(),Ce(0,Z(Te)),Ce(1,Z(we)),g("design:paramtypes",[Te,we])],wd);let Sd=class extends De{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.type]}};Sd=u([ie(),Ce(0,Z(Te)),Ce(1,Z(we)),g("design:paramtypes",[Te,we])],Sd);let Nd=class extends De{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await this.eventLogicVerifier.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.issueEntity.entityFactoryPossessor]}};Nd=u([ie(),Ce(0,Z(Te)),Ce(1,Z(we)),g("design:paramtypes",[Te,we])],Nd);const{ConsensusException:bl,NoFoundException:Nw}=le("VERIFIER","DestroyEntityLogicVerifier");let wu=class extends De{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.destroyEntity,{transactionSignature:o}=i,a=await this.transactionGetterHelper.getTransactionAndBlockSignatureBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!a)throw new Nw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"destroyEntity"});let p="";const l=a.transaction,h=await this.transactionCore.recombineTransaction(l),y=h.as(Ao,o);if(y){const _=y.asset.issueEntity;if(_.entityId!==i.entityId)throw new bl(c.NOT_MATCH,{to_compare_prop:`entityId ${i.entityId}`,be_compare_prop:`entityId ${_.entityId}`,to_target:"transaction",be_target:"issueEntityTransaction"});p=y.senderId}else{const _=h.as(Eo,o);if(!_)throw new bl(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});const E=_.asset.issueEntityMulti.entityStructList.map(T=>T.entityId);if(!E.includes(i.entityId))throw new bl(c.NOT_MATCH,{to_compare_prop:`entityId ${i.entityId}`,be_compare_prop:`entityId [${E.slice(0,3).join(",")}...]`,to_target:"transaction",be_target:"issueEntityMultiTransaction"});p=_.senderId}if(e.recipientId!==p)throw new bl(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`entityApplicant ${p}`,to_target:"transaction",be_target:"issueEntityTransaction"});await this.logicVerify(e,t,r);const{eventLogicVerifier:A}=this;return n===!1&&A.listenEvent(r,t,s),await A.awaitEventResult(e,s),!0}getLockData(e){const{entityFactoryApplicant:t,entityFactoryPossessor:r,entityId:n}=e.asset.destroyEntity;return[t,r,n]}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],wu.prototype,"transactionCore",void 0);wu=u([ie(),g("design:paramtypes",[])],wu);const{ConsensusException:Ow}=le("CONTROLLER","IssueEntityMultiLogicVerifier");let Od=class extends De{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){this.__checkTrsFee(e),await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await this.eventLogicVerifier.awaitEventResult(e,s),!0}__checkTrsFee(e){const t=this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length);if(BigInt(e.fee)<BigInt(t))throw new Ow(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:He.TRANSACTION_FEE_NOT_ENOUGH,minFee:t,target:"transaction"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){return[e.asset.issueEntityMulti.entityFactoryPossessor]}};Od=u([ie(),Ce(0,Z(Te)),Ce(1,Z(we)),g("design:paramtypes",[Te,we])],Od);const{ConsensusException:ya}=le("VERIFIER","ToExchangeAnyLogicVerifier");let Cd=class extends De{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.toExchangeAny,{beExchangeSource:o,beExchangeChainName:a,beExchangeParentAssetType:p,beExchangeAssetType:l}=i,h=this.accountGetterHelper;if(p===ne.ASSETS)await this.helperLogicVerifier.isAssetExist(a,o,l);else if(p===ne.DAPP){if(!await h.getDApp(o,l,t))throw new ya(c.DAPPID_IS_NOT_EXIST,{dappid:l})}else if(p===ne.LOCATION_NAME){if(l.split(",").length>2)throw new ya(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(!await h.getLocationName(o,l,t))throw new ya(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:l,errorId:He.LOCATION_NAME_NOT_EXIST})}else if(p===ne.ENTITY){const A=await h.getEntity(o,l,t);if(!A)throw new ya(c.ENTITY_IS_NOT_EXIST,{entityId:l,errorId:He.ENTITY_NOT_EXIST});if(A.status===255)throw new ya(c.ENTITY_ALREADY_DESTROY,{entityId:l,reason:"Entity already be destroy"})}else throw new ya(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${p}`,target:"transaction.asset.toExchangeAny"});await this.logicVerify(e,t,r);const{eventLogicVerifier:y}=this;return n===!1&&y.listenEvent(r,t,s),await y.awaitEventResult(e,s),!0}getLockData(e){const{toExchangeParentAssetType:t,toExchangeAssetType:r}=e.asset.toExchangeAny,n=[];return(t===ne.DAPP||t===ne.LOCATION_NAME||t===ne.ENTITY)&&n.push(r),n}};Cd=u([ie(),g("design:paramtypes",[])],Cd);const{ConsensusException:_t,NoFoundException:Cw}=le("VERIFIER","BeExchangeAnyLogicVerifier");let Su=class extends De{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){const i=e.asset.beExchangeAny,{transactionSignature:o}=i,a=await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!a)throw new Cw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});const p=(await this.transactionCore.recombineTransaction(a)).as(La,o);if(!p)throw new _t(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});if(e.recipientId!==p.senderId)throw new _t(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${p.senderId}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});this.isDependentTransactionMatch(e,p),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}isDependentTransactionMatch(e,t){const r=e.asset.beExchangeAny,{exchangeAny:n,ciphertextSignature:s}=r,{cipherPublicKeys:i,assetExchangeWeightRatio:o,taxInformation:a}=n,p=t.asset.toExchangeAny;if(p.toExchangeSource!==n.toExchangeSource||p.beExchangeSource!==n.beExchangeSource||p.toExchangeParentAssetType!==n.toExchangeParentAssetType||p.beExchangeParentAssetType!==n.beExchangeParentAssetType||p.toExchangeAssetType!==n.toExchangeAssetType||p.beExchangeAssetType!==n.beExchangeAssetType||p.toExchangeAssetPrealnum!==n.toExchangeAssetPrealnum)throw new _t(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(p)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(p.beExchangeAssetPrealnum){if(!n.beExchangeAssetPrealnum)throw new _t(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(p)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(p.beExchangeAssetPrealnum!==n.beExchangeAssetPrealnum)throw new _t(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(p)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"})}else if(n.beExchangeAssetPrealnum)throw new _t(c.SHOULD_NOT_EXIST,{prop:"beExchangeAssetPrealnum",target:"BeExchangeAnyTransaction.beExchangeAny.exchangeAny"});if(p.assetExchangeWeightRatio){if(!o)throw new _t(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(p)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(p.assetExchangeWeightRatio.toExchangeAssetWeight!==o.toExchangeAssetWeight||p.assetExchangeWeightRatio.beExchangeAssetWeight!==o.beExchangeAssetWeight)throw new _t(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(p)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"})}else if(o)throw new _t(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",target:"BeExchangeAnyTransaction.beExchangeAny.exchangeAny"});if(p.taxInformation){if(!a)throw new _t(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(p)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(p.taxInformation.taxCollector!==a.taxCollector||p.taxInformation.taxAssetPrealnum!==a.taxAssetPrealnum)throw new _t(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(p)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"})}else if(a)throw new _t(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"BeExchangeAnyTransaction.beExchangeAny.exchangeAny"});if(p.cipherPublicKeys.length!==i.length)throw new _t(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(p)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});for(const _ of p.cipherPublicKeys)if(!i.includes(_))throw new _t(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(p)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(i.length>0){if(!s)throw new _t(c.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAny"});const{publicKey:_}=s;if(!i.includes(_))throw new _t(c.NOT_MATCH,{to_compare_prop:`publicKey ${_}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAny.ciphertextSignature",be_target:"toExchangeAny.cipherPublicKeys"})}else if(s)throw new _t(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAny"});const{toExchangeAssetPrealnum:l,beExchangeAssetPrealnum:h}=r;if(e.senderId===e.recipientId){if(n.toExchangeParentAssetType===ne.ASSETS){if(l==="0")throw new _t(c.PROP_SHOULD_GT_FIELD,{prop:`toExchangeAssetPrealnum ${l}`,field:"0",target:"beExchangeAny"})}else if(l!=="1")throw new _t(c.PROP_SHOULD_EQ_FIELD,{prop:`toExchangeAssetPrealnum ${l}`,field:"1",target:"beExchangeAny"});if(h!=="0")throw new _t(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${h}`,field:"0",target:"beExchangeAny"})}else{if(l==="0"&&h==="0")throw new _t(c.PROP_SHOULD_GT_FIELD,{prop:`beExchangeAssetPrealnum ${h}`,field:"0",target:"beExchangeAny"});if(o){const _=this.jsbiHelper.multiplyRoundFraction(l,{numerator:o.beExchangeAssetWeight,denominator:o.toExchangeAssetWeight});if(_>BigInt(h))throw new _t(c.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAssetPrealnum ${h}`,field:_.toString(),target:"beExchangeAny"})}else if(n.beExchangeParentAssetType===ne.ASSETS){if(BigInt(h)<BigInt(n.beExchangeAssetPrealnum))throw new _t(c.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAssetPrealnum ${h}`,field:n.beExchangeAssetPrealnum,target:"beExchangeAny"})}else if(h!=="1")throw new _t(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${h}`,field:"1",target:"beExchangeAny"})}const{rangeType:y,range:A}=t;if(y&1){if(!A.includes(e.senderId))throw new _t(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAnyTransaction",be_compare_prop:"beExchangeAnyTransaction.range"})}else if(y&2){if(!e.dappid||!A.includes(e.dappid))throw new _t(c.SHOULD_BE,{to_compare_prop:`dappid ${e.senderId}`,to_target:"beExchangeAnyTransaction",be_compare_prop:"beExchangeAnyTransaction.range"})}else if(y&4&&(!e.lns||!A.includes(e.lns)))throw new _t(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAnyTransaction",be_compare_prop:"beExchangeAnyTransaction.range"})}getLockData(e){const{transactionSignature:t,exchangeAny:r,taxInformation:n}=e.asset.beExchangeAny,{toExchangeParentAssetType:s,beExchangeParentAssetType:i}=r,o=[t];return(s===ne.DAPP||s===ne.LOCATION_NAME||s===ne.ENTITY)&&(o.push(r.toExchangeAssetType),r.taxInformation&&o.push(r.taxInformation.taxCollector)),(i===ne.DAPP||i===ne.LOCATION_NAME||i===ne.ENTITY)&&(o.push(r.beExchangeAssetType),n&&o.push(n.taxCollector)),o}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Su.prototype,"transactionCore",void 0);Su=u([ie(),g("design:paramtypes",[Lt])],Su);const{ConsensusException:no}=le("VERIFIER","ToExchangeAnyMultiLogicVerifier");let xd=class extends De{constructor(){super()}async verify(e,t,r,n,s){this.__checkTrsFee(e);const i=e.asset.toExchangeAnyMulti,{beExchangeAsset:o}=i,{beExchangeSource:a,beExchangeChainName:p,beExchangeParentAssetType:l,beExchangeAssetType:h}=o,y=this.accountGetterHelper;if(l===ne.ASSETS)await this.helperLogicVerifier.isAssetExist(p,a,h);else if(l===ne.DAPP){if(!await y.getDApp(a,h,t))throw new no(c.DAPPID_IS_NOT_EXIST,{dappid:h})}else if(l===ne.LOCATION_NAME){if(h.split(",").length>2)throw new no(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(!await y.getLocationName(a,h,t))throw new no(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:h,errorId:He.LOCATION_NAME_NOT_EXIST})}else if(l===ne.ENTITY){const _=await y.getEntity(a,h,t);if(!_)throw new no(c.ENTITY_IS_NOT_EXIST,{entityId:h,errorId:He.ENTITY_NOT_EXIST});if(_.status===255)throw new no(c.ENTITY_ALREADY_DESTROY,{entityId:h,reason:"Entity already be destroy"})}else throw new no(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${l}`,target:"transaction.asset.toExchangeAnyMulti"});await this.logicVerify(e,t,r);const{eventLogicVerifier:A}=this;return n===!1&&A.listenEvent(r,t,s),await A.awaitEventResult(e,s),!0}__checkTrsFee(e){const t=this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length);if(BigInt(e.fee)<BigInt(t))throw new no(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:He.TRANSACTION_FEE_NOT_ENOUGH,minFee:t,target:"transaction"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{toExchangeAssets:t}=e.asset.toExchangeAnyMulti,r=[];for(const n of t){const{toExchangeParentAssetType:s,toExchangeAssetType:i}=n;(s===ne.DAPP||s===ne.LOCATION_NAME||s===ne.ENTITY)&&r.push(i)}return r}};xd=u([ie(),g("design:paramtypes",[])],xd);const{ConsensusException:Tt,NoFoundException:xw}=le("VERIFIER","BeExchangeAnyMultiLogicVerifier");let Nu=class extends De{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){this.__checkTrsFee(e);const i=e.asset.beExchangeAnyMulti,{transactionSignature:o}=i,a=await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!a)throw new xw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});const p=(await this.transactionCore.recombineTransaction(a)).as(Da,o);if(!p)throw new Tt(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});if(e.recipientId!==p.senderId)throw new Tt(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${p.senderId}`,to_target:"BeExchangeAnyMultiTransaction",be_target:"ToExchangeAnyMultiTransaction"});this.isDependentTransactionMatch(e,p),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}isDependentTransactionMatch(e,t){const{toExchangeAssets:r,beExchangeAsset:n,cipherPublicKeys:s}=t.asset.toExchangeAnyMulti,{toExchangeAssets:i,beExchangeAsset:o,ciphertextSignature:a}=e.asset.beExchangeAnyMulti,p={};for(const E of r){const{toExchangeSource:T,toExchangeChainName:w,toExchangeParentAssetType:C,toExchangeAssetType:N,toExchangeAssetPrealnum:L,assetExchangeWeightRatio:B,taxInformation:$}=E;p[`${T}${N}`]={toExchangeChainName:w,toExchangeParentAssetType:C,toExchangeAssetPrealnum:L,assetExchangeWeightRatio:B,taxInformation:$}}for(const E of i){const{toExchangeSource:T,toExchangeChainName:w,toExchangeParentAssetType:C,toExchangeAssetType:N,toExchangeAssetPrealnum:L,assetExchangeWeightRatio:B,taxInformation:$}=E,V=`${T}${N}`,G=p[V];if(!G)throw new Tt(c.SHOULD_NOT_INCLUDE,{prop:"toExchangeAssets",target:"toExchangeAnyMulti",value:`toExchangeChainName ${w} toExchangeSource ${T} toExchangeAssetType ${N}`});if(G.toExchangeChainName!==w||G.toExchangeParentAssetType!==C)throw new Tt(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:G.toExchangeChainName,toExchangeParentAssetType:G.toExchangeParentAssetType,toExchangeAssetType:N})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(E.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"});if(BigInt(L)>BigInt(G.toExchangeAssetPrealnum))throw new Tt(c.PROP_SHOULD_LTE_FIELD,{prop:`toExchangeAssets.toExchangeAsset.toExchangeAssetPrealnum ${L}`,target:"beExchangeAnyMulti",field:G.toExchangeAssetPrealnum});if(G.assetExchangeWeightRatio){if(!B)throw new Tt(c.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",target:"beExchangeAnyMulti.beExchangeAsset"});if(G.assetExchangeWeightRatio.toExchangeAssetWeight!==B.toExchangeAssetWeight||G.assetExchangeWeightRatio.beExchangeAssetWeight!==B.beExchangeAssetWeight)throw new Tt(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:w,toExchangeAssetType:N})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(E.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"})}else if(B)throw new Tt(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",target:"beExchangeAnyMulti.beExchangeAsset"});if(G.taxInformation){if(!$)throw new Tt(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:w,toExchangeAssetType:N})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(E.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"});if(G.taxInformation.taxCollector!==$.taxCollector||G.taxInformation.taxAssetPrealnum!==$.taxAssetPrealnum)throw new Tt(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:w,toExchangeAssetType:N})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(E.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"})}else if($)throw new Tt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.toExchangeAsset"})}if(n.beExchangeSource!==o.beExchangeSource||n.beExchangeChainName!==o.beExchangeChainName||n.beExchangeParentAssetType!==o.beExchangeParentAssetType||n.beExchangeAssetType!==o.beExchangeAssetType)throw new Tt(c.NOT_MATCH,{to_compare_prop:`beExchangeAsset: ${JSON.stringify(n)}`,be_compare_prop:`beExchangeAsset: ${JSON.stringify(o.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"});const{beExchangeAssetPrealnum:l,beExchangeParentAssetType:h}=o,y=BigInt(l);if(e.senderId===e.recipientId){for(const E of i){const{toExchangeParentAssetType:T,toExchangeAssetPrealnum:w}=E;if(T===ne.ASSETS){if(w==="0")throw new Tt(c.PROP_SHOULD_GT_FIELD,{prop:`toExchangeAssetPrealnum ${w}`,field:"0",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.toExchangeAssets"})}else if(w!=="1")throw new Tt(c.PROP_SHOULD_EQ_FIELD,{prop:`toExchangeAssetPrealnum ${w}`,field:"1",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.toExchangeAssets"})}if(l!=="0")throw new Tt(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${l}`,field:"0",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"})}else if(h===ne.ASSETS){let E=!1;for(const T of i){const{toExchangeParentAssetType:w,toExchangeAssetPrealnum:C,assetExchangeWeightRatio:N}=T;if(w!==ne.ASSETS&&(E=!0),N){const L=this.jsbiHelper.multiplyRoundFraction(C,{numerator:N.beExchangeAssetWeight,denominator:N.toExchangeAssetWeight});if(L>y)throw new Tt(c.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAssetPrealnum ${l}`,field:L.toString(),target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"})}if(C==="0"&&l==="0")throw new Tt(c.PROP_SHOULD_GT_FIELD,{prop:`beExchangeAssetPrealnum ${l}`,field:"0",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"})}if(E&&n.beExchangeAssetPrealnum&&o.beExchangeAssetPrealnum&&BigInt(o.beExchangeAssetPrealnum)<BigInt(n.beExchangeAssetPrealnum))throw new Tt(c.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAsset.beExchangeAssetPrealnum ${o.beExchangeAssetPrealnum}`,target:"beExchangeAnyMulti",field:n.beExchangeAssetPrealnum})}else if(l!=="1")throw new Tt(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${l}`,field:"1",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"});if(s.length>0){if(!a)throw new Tt(c.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMulti"});const{publicKey:E}=a;if(!s.includes(E))throw new Tt(c.NOT_MATCH,{to_compare_prop:`publicKey ${E}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAnyMulti.ciphertextSignature",be_target:"toExchangeAnyMulti.cipherPublicKeys"})}else if(a)throw new Tt(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMulti"});const{rangeType:A,range:_}=t;if(A&1){if(!_.includes(e.senderId))throw new Tt(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAnyMultiTransaction",be_compare_prop:"beExchangeAnyMultiTransaction.range"})}else if(A&2){if(!e.dappid||!_.includes(e.dappid))throw new Tt(c.SHOULD_BE,{to_compare_prop:`dappid ${e.senderId}`,to_target:"beExchangeAnyMultiTransaction",be_compare_prop:"beExchangeAnyMultiTransaction.range"})}else if(A&4&&(!e.lns||!_.includes(e.lns)))throw new Tt(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAnyMultiTransaction",be_compare_prop:"beExchangeAnyMultiTransaction.range"})}__checkTrsFee(e){const t=this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length);if(BigInt(e.fee)<BigInt(t))throw new Tt(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:He.TRANSACTION_FEE_NOT_ENOUGH,minFee:t,target:"transaction"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{transactionSignature:t,toExchangeAssets:r,beExchangeAsset:n}=e.asset.beExchangeAnyMulti,s=[t],{beExchangeParentAssetType:i,beExchangeAssetType:o}=n;for(const a of r){const{toExchangeParentAssetType:p,toExchangeAssetType:l,taxInformation:h}=a;(p===ne.DAPP||p===ne.LOCATION_NAME||p===ne.ENTITY)&&(s.push(l),h&&s.push(h.taxCollector))}return(i===ne.DAPP||i===ne.LOCATION_NAME||i===ne.ENTITY)&&(s.push(o),s.push(o),n.taxInformation&&s.push(n.taxInformation.taxCollector)),s}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Nu.prototype,"transactionCore",void 0);Nu=u([ie(),g("design:paramtypes",[Lt])],Nu);const{ConsensusException:so}=le("VERIFIER","ToExchangeAnyMultiAllLogicVerifier");let Rd=class extends De{constructor(){super()}async verify(e,t,r,n,s){this.__checkTrsFee(e);const i=e.asset.toExchangeAnyMultiAll,{beExchangeAssets:o}=i,a=this.accountGetterHelper;for(const l of o){const{beExchangeSource:h,beExchangeChainName:y,beExchangeParentAssetType:A,beExchangeAssetType:_}=l;if(A===ne.ASSETS)await this.helperLogicVerifier.isAssetExist(y,h,_);else if(A===ne.DAPP){if(!await a.getDApp(h,_,t))throw new so(c.DAPPID_IS_NOT_EXIST,{dappid:_})}else if(A===ne.LOCATION_NAME){if(_.split(",").length>2)throw new so(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(!await a.getLocationName(h,_,t))throw new so(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:_,errorId:He.LOCATION_NAME_NOT_EXIST})}else if(A===ne.ENTITY){const E=await a.getEntity(h,_,t);if(!E)throw new so(c.ENTITY_IS_NOT_EXIST,{entityId:_,errorId:He.ENTITY_NOT_EXIST});if(E.status===255)throw new so(c.ENTITY_ALREADY_DESTROY,{entityId:_,reason:"Entity already be destroy"})}else throw new so(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${A}`,target:"transaction.asset.toExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}await this.logicVerify(e,t,r);const{eventLogicVerifier:p}=this;return n===!1&&p.listenEvent(r,t,s),await p.awaitEventResult(e,s),!0}__checkTrsFee(e){const{toExchangeAssets:t,beExchangeAssets:r}=e.asset.toExchangeAnyMultiAll,n=this.transactionHelper.calcTransactionMinFeeByMulti(e,t.length+r.length);if(BigInt(e.fee)<BigInt(n))throw new so(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:He.TRANSACTION_FEE_NOT_ENOUGH,minFee:n,target:"transaction"})}checkTrsFeeAndWebFee(e,t){const{toExchangeAssets:r,beExchangeAssets:n}=e.asset.toExchangeAnyMultiAll;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,r.length+n.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const{toExchangeAssets:n,beExchangeAssets:s}=e.asset.toExchangeAnyMultiAll;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,n.length+s.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{toExchangeAssets:t}=e.asset.toExchangeAnyMultiAll,r=[];for(const n of t){const{toExchangeParentAssetType:s,toExchangeAssetType:i}=n;(s===ne.DAPP||s===ne.LOCATION_NAME||s===ne.ENTITY)&&r.push(i)}return r}};Rd=u([ie(),g("design:paramtypes",[])],Rd);const{ConsensusException:Rt,NoFoundException:Rw}=le("VERIFIER","BeExchangeAnyMultiAllLogicVerifier");let Ou=class extends De{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){this.__checkTrsFee(e);const i=e.asset.beExchangeAnyMultiAll,{transactionSignature:o}=i,a=await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!a)throw new Rw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});const p=(await this.transactionCore.recombineTransaction(a)).as(Fa,o);if(!p)throw new Rt(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});if(e.recipientId!==p.senderId)throw new Rt(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${p.senderId}`,to_target:"BeExchangeAnyMultiAllTransaction",be_target:"ToExchangeAnyMultiAllTransaction"});this.isDependentTransactionMatch(e,p),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}isDependentTransactionMatch(e,t){const{toExchangeAssets:r,beExchangeAssets:n,cipherPublicKeys:s}=t.asset.toExchangeAnyMultiAll,{toExchangeAssets:i,beExchangeAssets:o,ciphertextSignature:a}=e.asset.beExchangeAnyMultiAll;if(r.length!==i.length)throw new Rt(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.length: ${r.length}`,be_compare_prop:`toExchangeAssets.length: ${i.length}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(n.length!==o.length)throw new Rt(c.NOT_MATCH,{to_compare_prop:`beExchangeAssets.length: ${n.length}`,be_compare_prop:`beExchangeAssets.length: ${o.length}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});const p={};for(const A of r){const{toExchangeSource:_,toExchangeChainName:E,toExchangeParentAssetType:T,toExchangeAssetType:w,toExchangeAssetPrealnum:C,taxInformation:N}=A;p[`${_}${w}`]={toExchangeChainName:E,toExchangeParentAssetType:T,toExchangeAssetPrealnum:C,taxInformation:N}}const l={};for(const A of n){const{beExchangeSource:_,beExchangeChainName:E,beExchangeParentAssetType:T,beExchangeAssetType:w,beExchangeAssetPrealnum:C,taxInformation:N}=A;l[`${_}${w}`]={beExchangeChainName:E,beExchangeParentAssetType:T,beExchangeAssetPrealnum:C,taxInformation:N}}for(const A of i){const{toExchangeSource:_,toExchangeChainName:E,toExchangeParentAssetType:T,toExchangeAssetType:w,toExchangeAssetPrealnum:C,taxInformation:N}=A,L=`${_}${w}`,B=p[L];if(!B)throw new Rt(c.SHOULD_NOT_INCLUDE,{prop:"toExchangeAssets",target:"toExchangeAnyMultiAll",value:`toExchangeChainName ${E} toExchangeSource ${_} toExchangeAssetType ${w}`});const $={toExchangeSource:_,toExchangeChainName:B.toExchangeChainName,toExchangeParentAssetType:B.toExchangeParentAssetType,toExchangeAssetType:w};if(B.toExchangeChainName!==E||B.toExchangeParentAssetType!==T)throw new Rt(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify($)}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(A.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(C!==B.toExchangeAssetPrealnum)throw new Rt(c.PROP_SHOULD_EQ_FIELD,{prop:`toExchangeAssets.toExchangeAsset.toExchangeAssetPrealnum ${C}`,target:"beExchangeAnyMultiAll",field:B.toExchangeAssetPrealnum});if(B.taxInformation){if(!N)throw new Rt(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify($)}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(A.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(B.taxInformation.taxCollector!==N.taxCollector||B.taxInformation.taxAssetPrealnum!==N.taxAssetPrealnum)throw new Rt(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({...$,taxInformation:{taxCollector:N.taxCollector,taxAssetPrealnum:N.taxAssetPrealnum}})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(A.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"})}else if(N)throw new Rt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"beExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}for(const A of o){const{beExchangeSource:_,beExchangeChainName:E,beExchangeParentAssetType:T,beExchangeAssetType:w,beExchangeAssetPrealnum:C,taxInformation:N}=A,L=`${_}${w}`,B=l[L];if(!B)throw new Rt(c.SHOULD_NOT_INCLUDE,{prop:"beExchangeAssets",target:"beExchangeAnyMultiAll",value:`beExchangeChainName ${E} beExchangeSource ${_} beExchangeAssetType ${w}`});const $={beExchangeSource:_,beExchangeChainName:B.beExchangeChainName,beExchangeParentAssetType:B.beExchangeParentAssetType,beExchangeAssetType:w};if(E!==B.beExchangeChainName||T!==B.beExchangeParentAssetType)throw new Rt(c.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify($)}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(A.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(e.senderId===e.recipientId){if(C!=="0")throw new Rt(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${C}`,field:"0",target:"beExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}else if(C!==B.beExchangeAssetPrealnum)throw new Rt(c.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify($)}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(A.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(B.taxInformation){if(!N)throw new Rt(c.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify($)}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(A.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(B.taxInformation.taxCollector!==N.taxCollector||B.taxInformation.taxAssetPrealnum!==N.taxAssetPrealnum)throw new Rt(c.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify({...$,taxInformation:{taxCollector:N.taxCollector,taxAssetPrealnum:N.taxAssetPrealnum}})}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(A.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"})}else if(N)throw new Rt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"beExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}if(s.length>0){if(!a)throw new Rt(c.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMultiAll"});const{publicKey:A}=a;if(!s.includes(A))throw new Rt(c.NOT_MATCH,{to_compare_prop:`publicKey ${A}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAnyMultiAll.ciphertextSignature",be_target:"toExchangeAnyMultiAll.cipherPublicKeys"})}else if(a)throw new Rt(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMultiAll"});const{rangeType:h,range:y}=t;if(h&1){if(!y.includes(e.senderId))throw new Rt(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAnyMultiAllTransaction",be_compare_prop:"beExchangeAnyMultiAllTransaction.range"})}else if(h&2){if(!e.dappid||!y.includes(e.dappid))throw new Rt(c.SHOULD_BE,{to_compare_prop:`dappid ${e.senderId}`,to_target:"beExchangeAnyMultiAllTransaction",be_compare_prop:"beExchangeAnyMultiAllTransaction.range"})}else if(h&4&&(!e.lns||!y.includes(e.lns)))throw new Rt(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAnyMultiAllTransaction",be_compare_prop:"beExchangeAnyMultiAllTransaction.range"})}__checkTrsFee(e){const{toExchangeAssets:t,beExchangeAssets:r}=e.asset.beExchangeAnyMultiAll,n=this.transactionHelper.calcTransactionMinFeeByMulti(e,t.length+r.length);if(BigInt(e.fee)<BigInt(n))throw new Rt(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:He.TRANSACTION_FEE_NOT_ENOUGH,minFee:n,target:"transaction"})}checkTrsFeeAndWebFee(e,t){const{toExchangeAssets:r,beExchangeAssets:n}=e.asset.beExchangeAnyMultiAll;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,r.length+n.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const{toExchangeAssets:n,beExchangeAssets:s}=e.asset.beExchangeAnyMultiAll;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,n.length+s.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{transactionSignature:t,toExchangeAssets:r,beExchangeAssets:n}=e.asset.beExchangeAnyMultiAll,s=[t];for(const i of r){const{toExchangeParentAssetType:o,toExchangeAssetType:a,taxInformation:p}=i;(o===ne.DAPP||o===ne.LOCATION_NAME||o===ne.ENTITY)&&(s.push(a),p&&s.push(p.taxCollector))}for(const i of n){const{beExchangeParentAssetType:o,beExchangeAssetType:a,taxInformation:p}=i;(o===ne.DAPP||o===ne.LOCATION_NAME||o===ne.ENTITY)&&(s.push(a),s.push(a),p&&s.push(p.taxCollector))}return s}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Ou.prototype,"transactionCore",void 0);Ou=u([ie(),g("design:paramtypes",[Lt])],Ou);const{ConsensusException:J_,NoFoundException:UN}=le("VERIFIER","IssueCertificateLogicVerifier");let vd=class extends De{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}checkCertificateOnChainHeight(e,t){const r=e.asset.issueCertificate.certificateId,n=Number(r.split(":")[0]);if(n<t)throw new J_(c.PROP_SHOULD_GTE_FIELD,{prop:`CertificateId on chain height ${n}`,target:"issueCertificate",field:t})}isCertificateOnChainHeight(e,t){const r=e.asset.issueCertificate.certificateId,n=Number(r.split(":")[0]);if(n!==t)throw new J_(c.SHOULD_BE,{to_compare_prop:`CertificateId on chain height ${n}`,to_target:"issueCertificate",be_compare_prop:t})}getLockData(e){return[e.type]}};vd=u([ie(),Ce(0,Z(Te)),Ce(1,Z(we)),g("design:paramtypes",[Te,we])],vd);const{ConsensusException:Y_}=le("VERIFIER","TransactionLogicVerifier");let Bd=class extends De{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,sourceChainName:o,certificateId:a,type:p}=e.asset.destroyCertificate,l=await this.helperLogicVerifier.isCertificateExist(o,i,a,t);if(l.applyAddress!==e.recipientId)throw new Y_(c.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"transaction",be_compare_prop:`certificate apply account address ${l.applyAddress}`});if(l.type!==p)throw new Y_(c.NOT_MATCH,{to_compare_prop:`type ${p}`,be_compare_prop:`type ${l.type}`,to_target:"transaction",be_target:"issueCertificateTransaction"});await this.logicVerify(e,t,r);const{eventLogicVerifier:h}=this;return n===!1&&h.listenEvent(r,t,s),await h.awaitEventResult(e,s),!0}};Bd=u([ie(),g("design:paramtypes",[])],Bd);const{ArgumentFormatException:vw}=le("CONTROLLER","TransactionLogicVerifierCore");let ii=class{constructor(e,t,r,n,s,i,o){this.transactionHelper=e,this.accountBaseHelper=t,this.asymmetricHelper=r,this.keypairHelper=n,this.Buffer=s,this.config=i,this.moduleMap=o,this._txLogicVerifierCache=new Map}getTransactionLogicVerifier(e){let t=this._txLogicVerifierCache.get(e);return t||(t=Ht(e,this.moduleMap),this._txLogicVerifierCache.set(e,t)),t}getTransactionLogicVerifierFromType(e){const{baseType:t}=this.transactionHelper.parseType(e);return this.getTransactionLogicVerifierFromBaseType(t)}getTransactionLogicVerifierFromBaseType(e){const t=En.KLV.get(e);if(!t)throw new vw(c.INVALID_BASE_TYPE,{base_type:e});return this.getTransactionLogicVerifier(t)}};ii=u([ie("bfchain-core:TransactionLogicVerifierCore"),Ce(3,Z("keypairHelper")),Ce(4,Z("Buffer")),g("design:paramtypes",[we,Te,Fr,Object,Object,ue,et])],ii);const En=(()=>{const e=new Map,t=new Map;return[[W.SIGNATURE,id],[W.DAPP,od],[W.DAPP_PURCHASING,ad],[W.MARK,cd],[W.ISSUE_ASSET,pd],[W.INCREASE_ASSET,hd],[W.DESTROY_ASSET,gd],[W.TRANSFER_ASSET,ld],[W.TO_EXCHANGE_ASSET,md],[W.BE_EXCHANGE_ASSET,Tu],[W.GIFT_ASSET,fd],[W.GRAB_ASSET,Au],[W.TRUST_ASSET,yd],[W.SIGN_FOR_ASSET,Iu],[W.EMIGRATE_ASSET,_d],[W.IMMIGRATE_ASSET,Ad],[W.STAKE_ASSET,Ed],[W.UNSTAKE_ASSET,bu],[W.LOCATION_NAME,Id],[W.SET_LNS_RECORD_VALUE,bd],[W.SET_LNS_MANAGER,Td],[W.ISSUE_ENTITY_FACTORY,wd],[W.ISSUE_ENTITY_FACTORY_V1,Sd],[W.ISSUE_ENTITY,Nd],[W.DESTROY_ENTITY,wu],[W.ISSUE_ENTITY_MULTI,Od],[W.TRANSFER_ANY,ud],[W.GIFT_ANY,dd],[W.GRAB_ANY,Eu],[W.TO_EXCHANGE_ANY,Cd],[W.BE_EXCHANGE_ANY,Su],[W.TO_EXCHANGE_ANY_MULTI,xd],[W.BE_EXCHANGE_ANY_MULTI,Nu],[W.TO_EXCHANGE_ANY_MULTI_ALL,Rd],[W.BE_EXCHANGE_ANY_MULTI_ALL,Ou],[W.ISSUE_CERTIFICATE,vd],[W.DESTROY_CERTIFICATE,Bd]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{KLV:e,LVK:t,trsTypeToV(r){const n=r.indexOf("-",r.indexOf("-")+1);return r.substr(n+1)}}})();let Cu=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.type]}};Cu=u([ie(),g("design:paramtypes",[])],Cu);const{NoFoundException:Q_}=le("VERIFIER","LogicHelper");let Ur=class{async getMacroCallTransaction(e){const{macroId:t,inputs:r}=e.asset.call,n=`${t}_${e.signature}`;let s=this.memoryCache.getCache(n);if(s===void 0){const i=await this.transactionGetterHelper.getMacroCallTransaction(t,r);if(!i)throw new Q_(c.NOT_EXIST,{prop:`Macro call transaction with macroId ${t}`,target:"blockChain"});s=await this.transactionCore.recombineTransaction(i),this.memoryCache.setCache(n,s)}return s}async getPromiseTransaction(e){let t=this.memoryCache.getCache(e);if(t===void 0){const r=await this.transactionGetterHelper.getPromiseTransaction(e);if(!r)throw new Q_(c.NOT_EXIST,{prop:`Promise transaction ${e}`,target:"blockChain"});t=await this.transactionCore.recombineTransaction(r),this.memoryCache.setCache(e,t)}return t}async getCheckRepeatInfo(e,t=!1){let r=0,n=e.applyBlockHeight;const s=[],i=async o=>{switch(o.type){case this.transactionHelper.MULTIPLE:{const a=o.asset.multiple.transactions;for(const p of a)await i(p);break}case this.transactionHelper.MACRO_CALL:{const a=await this.getMacroCallTransaction(o);await i(a);break}case this.transactionHelper.PROMISE:{if(t===!1){const a=o.asset.promise.transaction;await i(a)}break}case this.transactionHelper.PROMISE_RESOLVE:{const a=await this.getPromiseTransaction(o.asset.resolve.promiseId);await i(a);break}}n>o.applyBlockHeight&&(n=o.applyBlockHeight),r+=1,s.push(o.signature)};return await i(e),{minHeight:n,count:r,ids:s}}};u([Z(fc),g("design:type",fc)],Ur.prototype,"memoryCache",void 0);u([Z(we),g("design:type",we)],Ur.prototype,"transactionHelper",void 0);u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Ur.prototype,"transactionCore",void 0);u([Z("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),g("design:type",ii)],Ur.prototype,"transactionLogicVerifierCore",void 0);u([Z("transactionGetterHelper",{dynamics:!0}),g("design:type",Object)],Ur.prototype,"transactionGetterHelper",void 0);Ur=u([ie()],Ur);const{ConsensusException:X_}=le("VERIFIER","MultipleLogicVerifier");let dc=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s);const{transactions:o}=e.asset.multiple;for(const a of o)await this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(a.type).verify(a,t,r,!0,s);return!0}checkTrsFeeAndWebFee(e,t){const r=super.checkTrsFeeAndWebFee(e,t);if(r.isFeeEnough===!1)return r;let n;const{transactions:s}=e.asset.multiple;for(const i of s)if(n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(i.type).checkTrsFeeAndWebFee(i,i.getBytes().length),n.isFeeEnough===!1)return n;return r}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=super.checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r);if(n.isFeeEnough===!1)return n;let s;const{transactions:i}=e.asset.multiple;for(const o of i)if(s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(o.type).checkTrsFeeAndMiningMachineFeeAndWebFee(o,o.getBytes().length,r),s.isFeeEnough===!1)return s;return n}checkTransactionBlobSize(e,t){const{maxBlockBlobSize:r}=this.configHelper,n=t===void 0||r<t?r:t,s=e.getBlobSize(!0);if(s>n)throw new X_(c.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${s}`,target:"transaction",field:n});const{transactions:i}=e.asset.multiple;for(const o of i)this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(o.type).checkTransactionBlobSize(o,t)}async checkRepeatInBlockChainTransaction(e,t,r=0){const{minHeight:n,count:s,ids:i}=await this.complexTransactionLogicHelper.getCheckRepeatInfo(e,r!==0);if(await this.transactionGetterHelper.countTransactionsInBlockChainBySignature(i,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(n,t))>(r===0?0:s))throw new X_(c.ALREADY_EXIST,{prop:`One of transactions with signatures [${i.slice(0,3).join(",")}${i.length>3?"...":""}]`,target:"blockChain"})}async checkSecondaryTransaction(e,t){const{transactions:r}=e.asset.multiple;for(const n of r){const s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type);s.checkSecondaryTransaction&&await s.checkSecondaryTransaction(n,t)}}checkCertificateOnChainHeight(e,t){const{transactions:r}=e.asset.multiple;for(const n of r){const s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type);s.checkCertificateOnChainHeight&&s.checkCertificateOnChainHeight(n,t)}}isCertificateOnChainHeight(e,t){const{transactions:r}=e.asset.multiple;for(const n of r){const s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type);s.isCertificateOnChainHeight&&s.isCertificateOnChainHeight(n,t)}}getLockData(e){const{transactions:t}=e.asset.multiple,r=[];for(const n of t){const s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type).getLockData(n);r.push(...s)}return[...new Set(r)]}};u([Z(Ur),g("design:type",Ur)],dc.prototype,"complexTransactionLogicHelper",void 0);u([Z("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),g("design:type",ii)],dc.prototype,"transactionLogicVerifierCore",void 0);dc=u([ie(),g("design:paramtypes",[])],dc);const{ConsensusException:Ug}=le("VERIFIER","PromiseLogicVerifier");let yc=class extends De{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.promise.transaction,{signature:o}=i;if(await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t)))throw new Ug(c.ALREADY_EXIST,{prop:`promiseTransaction ${o}`,target:"blockChain",errorId:He.TRANSACTION_IN_TRS});await this.logicVerify(e,t,r);const{eventLogicVerifier:a}=this;return n===!1&&a.listenEvent(r,t,s),await a.awaitEventResult(e,s),await this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(i.type).verify(i,t,r,!0,s),!0}checkTrsFeeAndWebFee(e,t){const r=super.checkTrsFeeAndWebFee(e,t);if(r.isFeeEnough===!1)return r;const n=e.asset.promise.transaction,s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type).checkTrsFeeAndWebFee(n,n.getBytes().length);return s.isFeeEnough===!1?s:r}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=super.checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r);if(n.isFeeEnough===!1)return n;const s=e.asset.promise.transaction,i=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(s.type).checkTrsFeeAndMiningMachineFeeAndWebFee(s,s.getBytes().length,r);return i.isFeeEnough===!1?i:n}checkTransactionBlobSize(e,t){const{maxBlockBlobSize:r}=this.configHelper,n=t===void 0||r<t?r:t,s=e.getBlobSize(!0);if(s>n)throw new Ug(c.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${s}`,target:"transaction",field:n});const i=e.asset.promise.transaction;this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(i.type).checkTransactionBlobSize(i,t)}async checkRepeatInBlockChainTransaction(e,t,r=0){const{minHeight:n,count:s,ids:i}=await this.complexTransactionLogicHelper.getCheckRepeatInfo(e,r!==0);if(await this.transactionGetterHelper.countTransactionsInBlockChainBySignature(i,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(n,t))>(r===0?0:s))throw new Ug(c.ALREADY_EXIST,{prop:`One of transactions with signatures [${i.slice(0,3).join(",")}${i.length>3?"...":""}]`,target:"blockChain"})}};u([Z(Ur),g("design:type",Ur)],yc.prototype,"complexTransactionLogicHelper",void 0);u([Z("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),g("design:type",ii)],yc.prototype,"transactionLogicVerifierCore",void 0);yc=u([ie(),g("design:paramtypes",[])],yc);const{ConsensusException:Ei,NoFoundException:Bw}=le("VERIFIER","PromiseResolveLogicVerifier");let Fo=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s);const{promiseId:o,transaction:a}=e.asset.resolve,p=await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!p)throw new Bw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});const l=(await this.transactionCore.recombineTransaction(p)).as(Ro,o);if(!l)throw new Ei(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});if(e.senderId!==l.recipientId)throw new Ei(c.NOT_MATCH,{to_compare_prop:`senderId ${e.senderId}`,be_compare_prop:`recipientId ${l.recipientId}`,to_target:"promiseResolveTransaction",be_target:"doPromiseTransaction"});if(e.recipientId!==l.senderId)throw new Ei(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${l.senderId}`,to_target:"promiseResolveTransaction",be_target:"doPromiseTransaction"});const h=await this.complexTransactionLogicHelper.getPromiseTransaction(o);if(Pe(a.getBytes())!==Pe(h.getBytes()))throw new Ei(c.NOT_MATCH,{to_compare_prop:`transaction with promiseId ${o}`,be_compare_prop:`transaction with promiseId ${o}`,to_target:"promiseResolveTransaction",be_target:"blockChain"});const y=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(a.type);if(a.applyBlockHeight>t)throw new Ei(c.NOT_BEGIN_RESOLVE_YET,{promiseId:o});if(a.effectiveBlockHeight<t)throw new Ei(c.ALREADY_EXPIRED,{prop:`promise transaction ${o}`,target:"blockChain"});return await y.verify(a,t,r,!0,s),!0}checkTrsFeeAndWebFee(e,t){const r=super.checkTrsFeeAndWebFee(e,t);if(r.isFeeEnough===!1)return r;const n=e.asset.resolve.transaction,s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type).checkTrsFeeAndWebFee(n,n.getBytes().length);return s.isFeeEnough===!1?s:r}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=super.checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r);if(n.isFeeEnough===!1)return n;const s=e.asset.resolve.transaction,i=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(s.type).checkTrsFeeAndMiningMachineFeeAndWebFee(s,s.getBytes().length,r);return i.isFeeEnough===!1?i:n}checkTransactionBlobSize(e,t){const{maxBlockBlobSize:r}=this.configHelper,n=t===void 0||r<t?r:t,s=e.getBlobSize(!0);if(s>n)throw new Ei(c.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${s}`,target:"transaction",field:n});const i=e.asset.resolve.transaction;this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(i.type).checkTransactionBlobSize(i,t)}async checkRepeatInBlockChainTransaction(e,t,r=0){const{minHeight:n,count:s,ids:i}=await this.complexTransactionLogicHelper.getCheckRepeatInfo(e,r!==0);if(await this.transactionGetterHelper.countTransactionsInBlockChainBySignature(i,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(n,t))>(r===0?0:s))throw new Ei(c.ALREADY_EXIST,{prop:`One of transactions with signatures [${i.slice(0,3).join(",")}${i.length>3?"...":""}]`,target:"blockChain"})}async checkSecondaryTransaction(e,t){const r=e.asset.resolve.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.checkSecondaryTransaction&&await n.checkSecondaryTransaction(r,t)}checkCertificateOnChainHeight(e,t){const r=e.asset.resolve.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.checkCertificateOnChainHeight&&n.checkCertificateOnChainHeight(r,t)}isCertificateOnChainHeight(e,t){const r=e.asset.resolve.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.isCertificateOnChainHeight&&n.isCertificateOnChainHeight(r,t)}getLockData(e){const{transaction:t,promiseId:r}=e.asset.resolve,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(t.type).getLockData(t);return n.push(r),[...new Set(n)]}};u([Z(Ur),g("design:type",Ur)],Fo.prototype,"complexTransactionLogicHelper",void 0);u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Fo.prototype,"transactionCore",void 0);u([Z("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),g("design:type",ii)],Fo.prototype,"transactionLogicVerifierCore",void 0);Fo=u([ie(),g("design:paramtypes",[])],Fo);let jh=class extends De{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}};u([Z("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),g("design:type",ii)],jh.prototype,"transactionLogicVerifierCore",void 0);jh=u([ie(),g("design:paramtypes",[])],jh);const{ConsensusException:Lc,NoFoundException:Pw}=le("VERIFIER","MacroCallLogicVerifier");let Uo=class extends De{constructor(){super()}async verify(e,t,r,n,s){const{macroId:i,inputs:o}=e.asset.call,a=await this.transactionGetterHelper.getTransactionBySignature(i,this.transactionHelper.calcTransactionQueryRange(t));if(!a)throw new Pw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${i}`,target:"blockChain"});const p=(await this.transactionCore.recombineTransaction(a)).as(Po,i);if(!p)throw new Lc(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${i}`});this.isInputMatch(o,p.asset.macro.inputs);const l=await this.isTransactionMatch(i,e);await this.logicVerify(e,t,r);const{eventLogicVerifier:h}=this;return n===!1&&h.listenEvent(r,t,s),await h.awaitEventResult(e,s),await this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(l.type).verify(l,t,r,!0,s),!0}isInputMatch(e,t){const r=t.map(n=>n.name);for(const n in e)if(r.includes(n)===!1)throw new Lc(c.SHOULD_NOT_EXIST,{prop:`input ${n}`,target:"inputs"})}async isTransactionMatch(e,t){const r=await this.complexTransactionLogicHelper.getMacroCallTransaction(t),n=t.asset.call.transaction;if(Pe(n.getBytes())!==Pe(r.getBytes()))throw new Lc(c.NOT_MATCH,{to_compare_prop:`transaction with macroId ${e}`,be_compare_prop:`transaction with macroId ${e}`,to_target:"MacroCallTransaction",be_target:"blockChain"});return n}checkTrsFeeAndWebFee(e,t){const r=super.checkTrsFeeAndWebFee(e,t);if(r.isFeeEnough===!1)return r;const n=e.asset.call.transaction,s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type).checkTrsFeeAndWebFee(n,n.getBytes().length);return s.isFeeEnough===!1?s:r}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=super.checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r);if(n.isFeeEnough===!1)return n;const s=e.asset.call.transaction,i=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(s.type).checkTrsFeeAndMiningMachineFeeAndWebFee(s,s.getBytes().length,r);return i.isFeeEnough===!1?i:n}checkTransactionBlobSize(e,t){const{maxBlockBlobSize:r}=this.configHelper,n=t===void 0||r<t?r:t,s=e.getBlobSize(!0);if(s>n)throw new Lc(c.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${s}`,target:"transaction",field:n});const i=e.asset.call.transaction;this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(i.type).checkTransactionBlobSize(i,t)}async checkRepeatInBlockChainTransaction(e,t,r=0){const{minHeight:n,count:s,ids:i}=await this.complexTransactionLogicHelper.getCheckRepeatInfo(e,r!==0);if(await this.transactionGetterHelper.countTransactionsInBlockChainBySignature(i,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(n,t))>(r===0?0:s))throw new Lc(c.ALREADY_EXIST,{prop:`One of transactions with signatures [${i.slice(0,3).join(",")}${i.length>3?"...":""}]`,target:"blockChain"})}async checkSecondaryTransaction(e,t){const r=e.asset.call.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.checkSecondaryTransaction&&await n.checkSecondaryTransaction(r,t)}checkCertificateOnChainHeight(e,t){const r=e.asset.call.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.checkCertificateOnChainHeight&&n.checkCertificateOnChainHeight(r,t)}isCertificateOnChainHeight(e,t){const r=e.asset.call.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.isCertificateOnChainHeight&&n.isCertificateOnChainHeight(r,t)}getLockData(e){const{transaction:t,macroId:r}=e.asset.call,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(t.type).getLockData(t);return n.push(r),[...new Set(n)]}};u([Z(Ur),g("design:type",Ur)],Uo.prototype,"complexTransactionLogicHelper",void 0);u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Uo.prototype,"transactionCore",void 0);u([Z("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),g("design:type",ii)],Uo.prototype,"transactionLogicVerifierCore",void 0);Uo=u([ie(),g("design:paramtypes",[])],Uo);En.KLV.set(W.REGISTER_CHAIN,Cu);En.LVK.set(Cu,W.REGISTER_CHAIN);En.KLV.set(W.MULTIPLE,dc);En.LVK.set(dc,W.MULTIPLE);En.KLV.set(W.PROMISE,yc);En.LVK.set(yc,W.PROMISE);En.KLV.set(W.PROMISE_RESOLVE,Fo);En.LVK.set(Fo,W.PROMISE_RESOLVE);En.KLV.set(W.MACRO,jh);En.LVK.set(jh,W.MACRO);En.KLV.set(W.MACRO_CALL,Uo);En.LVK.set(Uo,W.MACRO_CALL);const{ArgumentIllegalException:Dc,NoFoundException:kw,ConsensusException:Hw,info:W_}=le("CONTROLLER","_blockbase"),q_=vh("generateBlock");class wm{transactionInBlockFromJSON(t){return ar.fromObject(t)}async generateBlock(t,r,n,s,i,o,a,p=this.config){q_&&W_("begin generateBlock"),await this.generateBlockCore.generateBlockBefore(t,r,n,o);const l=this._generateBlock(t,r);return await this.generateBlockCore.generateBlockAfter(l,n,s,i,o,a,p),q_&&W_("finish generateBlock"),l}async replayBlock(t,r,n,s={},i=this.config){return await this.replayBlockCore.replayBlock(t,r,n,s,i)}async checkAssetChangeHash(t,r,n={}){let s=n.accountGetterHelper;if(!s&&(s=this.moduleMap.get("accountGetterHelper"),!s))throw new kw(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});const i=await s.getAccountsAssetsChange(t),o=await this.blockHelper.calcAssetChangeHash(i);if(o!==r)throw new Hw(c.NOT_MATCH,{to_compare_prop:`assetChangeHash ${r}`,be_compare_prop:`assetChangeHash ${o}`,to_target:"block",be_target:"calculate"})}verifyKeypair(t){if(!t)throw new Dc(c.PARAM_LOST,{param:"keypair"});const r={target:"keypair"},{baseHelper:n}=this,{publicKey:s,secretKey:i}=t;if(!s)throw new Dc(c.PROP_IS_REQUIRE,{prop:"publicKey",...r});if(!n.isValidPublicKey(s))throw new Dc(c.PROP_IS_INVALID,{prop:`publicKey ${s}`,...r});if(!i)throw new Dc(c.PROP_IS_REQUIRE,{param:"secretKey",...r});if(!n.isValidSecretKey(i))throw new Dc(c.PROP_IS_INVALID,{prop:`secretKey ${i}`,...r})}async verifyBlockBody(t,r,n=this.config){this.commonBlockVerify.verifyBlockBody(t,r)}async verify(t,r=this.config){await this.verifyBlockCore.verify(t,r)}async generateSignature(t){return await this.blockHelper.generateSignature(t)}async isBlockAlreadyExist(t,r,n){await this.commonBlockVerify.isBlockAlreadyExist(t,r,n)}}const{NoFoundException:$N,ArgumentException:Mw}=le("Core","BlockGeneratorCalculator");let Hn=class{constructor(e,t,r,n){this.config=e,this.timeHelper=t,this.blockHelper=r,this.accountBaseHelper=n,this.getAddressSeedMap=s=>new kt(i=>{let o=0;for(let a=1;a<i.length;a++)o+=i.charCodeAt(a);return o*s%256})}async fastCalcGenerateBlockGenerator(e,t={}){let r;if("toTimestamp"in t)r=t.toTimestamp;else{const{nowTimestamp:n=this.timeHelper.getTimestamp()}=t;r=this.timeHelper.getTimestampBySlotNumber(this.timeHelper.getSlotNumberByTimestamp(n)+1)}if(e.timestamp>=r)throw new Mw(`lastblock timestamp(${e.timestamp}) should not be greater than toTimestamp(${r})`);for await(const n of this.calcGenerateBlockGeneratorIterator(e,{toTimestamp:r,blockGetterHelper:t.blockGetterHelper,ignoreOfflineGeneraters:!0}))if(n.timestamp===r)return{address:n.address,timestamp:n.timestamp};throw new Error}async calcGenerateBlockGenerator(e,t){for await(const r of this.calcGenerateBlockGeneratorIterator(e,t))if(r.timestamp===t.toTimestamp)return r;throw new Error}async*calcGenerateBlockGeneratorIterator(e,t={}){const{toTimestamp:r=1/0,blockGetterHelper:n=this.blockHelper.blockGetterHelper,ignoreOfflineGeneraters:s,yieldSkip:i=1}=t,o=e.timestamp+this.config.forgeInterval;let a=o;const p=new kt(()=>[]),l=[],h=e.height%this.config.blockPerRound,y=t.blockCache||{};for(let Y=0;Y<h;Y++){const X=e.height-Y;l.push(y[X]||await this.blockHelper.forceGetBlockByHeight(X,n))}const A=Math.max(1,this.blockHelper.calcRoundEndHeight(this.blockHelper.calcRoundByHeight(e.height+1)-1)),_=y[A]||await this.blockHelper.forceGetBlockByHeight(A,n),E=this.blockHelper.calcRoundByHeight(_.height+1),T=Y=>{const X=(Y-_.timestamp)/this.config.forgeInterval/this.config.blockPerRound;return X%1===0&&X>0?X-1:Math.floor(X)},w=Y=>(Y*this.config.blockPerRound+1)*this.config.forgeInterval+_.timestamp,C=y[e.height]||await this.blockHelper.forceGetBlockByHeight(e.height,n);if(s){if(!Number.isSafeInteger(r))throw new RangeError("toTimestamp must be an integer, when you ignore Offline Generaters.");const Y=T(o),X=T(r);X>Y&&(a=w(X))}const N=_.height===1?_.asset.genesisAsset.nextRoundGenerators:_.asset.roundLastAsset.nextRoundGenerators,L=async Y=>{const X=new Set;if(Y===0)for(const P of N)X.add(P.address);else if(E-Y<=1)for(const P of this.config.genesisBlock.asset.genesisAsset.nextRoundGenerators)X.add(P.address);else for(const P of N)X.add(P.address);const U=new Set;for(const P of l)T(P.timestamp)===Y&&U.add(await this.accountBaseHelper.getAddressFromPublicKey(P.generatorPublicKeyBuffer));const v=[];for(const P of X)U.has(P)||v.push(P);return v},B=C.signatureBuffer.reduce((Y,X)=>Y+X,0),$=Y=>Y.slice().sort((X,U)=>{const v=this.getAddressSeedMap(B).forceGet(X)-this.getAddressSeedMap(B).forceGet(U);return v===0?Y.indexOf(X)-Y.indexOf(U):v}),V=Y=>({address:Y,timestamp:this.timeHelper.getTimestampBySlotNumber(this.timeHelper.getSlotNumberByTimestamp(a))});let G=0;for(;a<=r;){const Y=T(a),X=await L(Y),U=(w(Y+1)-a)/this.config.forgeInterval;X.length>U&&(X.length=U);const v=$(X);let P;do{const x=v.shift();if(!x)break;i>1?(++G===i||a===r)&&(G=0,yield V(x)):yield V(x),(P||(P=p.forceGet(Y))).push(x),a+=this.config.forgeInterval}while(v.length)}}async calcNextBlockGenerator(e){const t=e.timestamp+this.config.forgeInterval;for await(const r of this.calcGenerateBlockGeneratorIterator({timestamp:e.timestamp,height:e.height},{toTimestamp:t,blockCache:{[e.height]:e}}))if(r.timestamp===t)return r;throw new Error}};Hn=u([ie(),g("design:paramtypes",[ue,Yt,wt,Te])],Hn);const{ArgumentIllegalException:on,ConsensusException:Z_}=le("CONTROLLER","_blockbase");let vs=class{constructor(e,t,r,n){this.config=e,this.blockHelper=t,this.baseHelper=r,this.chainAssetInfoHelper=n}verifyBlockBody(e,t){const{baseHelper:r}=this;if(!e)throw new on(c.PARAM_LOST,{param:"body"});if(!t)throw new on(c.PARAM_LOST,{param:"asset"});const n={target:"body"};if(!r.isPositiveInteger(e.version))throw new on(c.PROP_IS_INVALID,{prop:`version ${e.version}`,type:"positive integer",...n});const s=e.height;if(!r.isPositiveInteger(s))throw new on(c.PROP_IS_INVALID,{prop:`height ${s}`,type:"positive integer",...n});if(s>1&&!e.previousBlockSignature)throw new on(c.PROP_IS_REQUIRE,{prop:"previousBlockSignature",...n});if(!r.isNaturalNumber(e.timestamp))throw new on(c.PROP_IS_INVALID,{prop:`timestamp ${e.timestamp}`,type:"positive integer or 0",...n});const i=e.remark;if(!i)throw new on(c.PROP_IS_REQUIRE,{prop:"remark",...n});if(r.getVariableType(i)!=="[object Object]")throw new on(c.PROP_IS_INVALID,{prop:"remark",...n});for(const o in i)if(!r.isString(i[o]))throw new on(c.PROP_IS_INVALID,{prop:"remark",...n});if(!i&&r.getVariableType(i)!=="[object Object]")throw new on(c.PARAM_LOST,{param:"remark",...n})}verifyBlockSize(e,t){const r=this.calcBlockSize(e,t);if(e.blockSize!==r)throw new on(c.NOT_MATCH,{to_compare_prop:`blockSize ${e.blockSize}`,be_compare_prop:`blockSize ${r}`,to_target:"block",be_target:"calculate"});const{maxBlockSize:n}=this.config;if(r>n)throw new on(c.PROP_SHOULD_LTE_FIELD,{prop:`block size ${r}`,target:"block",field:n})}verifyBlockBlobSize(e){const{maxBlockBlobSize:t}=this.config;if(e.blobSize>t)throw new on(c.PROP_SHOULD_LTE_FIELD,{prop:`block blob size ${e.blobSize}`,target:"block",field:t})}verifySignature(e){return this.blockHelper.verifyBlockSignature(e)}get canInsertTransaction(){return this.transactionCore.canCreateTransaction.bind(this.transactionCore)}calcBlockSize(e,t){const r=Mt.$type.fields.blockSize.id,n=o=>({value:o,size:o===0?0:new Wn().uint32(r).uint32(o).finish().length}),s=e.blockSize;let i=s;if(i=e.getBytes(!1,!1,t).length+(e.signatureBuffer.length?0:66),e.generatorPublicKeyBuffer){const o=e.signSignatureBuffer&&e.signSignatureBuffer.length||0;i+=o?0:66}if(s!==i){let o=n(s);do{const a=n(i);if(a.size===o.size)break;i+=a.size-o.size,o=a}while(!0)}return i}async isBlockAlreadyExist(e,t,r){if(typeof r.getCountBlock!="function")throw new Z_(c.PROP_IS_INVALID,{prop:"getCountBlock",target:"blockGetterHelper"});if(await r.getCountBlock({signature:e})>0)throw new Z_(c.ALREADY_EXIST,{prop:`Block with signature ${e}`,target:"blockChain",errorId:`Block already exists: ${e} height: ${t}`})}};u([Z("bfchain-core:TransactionCore"),g("design:type",Object)],vs.prototype,"transactionCore",void 0);u([ge,g("design:type",Object),g("design:paramtypes",[])],vs.prototype,"canInsertTransaction",null);vs=u([ie(),g("design:paramtypes",[ue,wt,Le,Ge])],vs);const{ArgumentIllegalException:Ls,ArgumentFormatException:VN,ConsensusException:GN}=le("CONTROLLER","_blockbase");let mc=class{constructor(e,t,r,n,s,i,o,a,p){this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.asymmetricHelper=s,this.chainAssetInfoHelper=i,this.commonBlockVerify=o,this.accountBaseHelper=a,this.cryptoHelper=p}async verify(e,t=this.config){this.commonBlockVerify.verifyBlockBody(e,e.remark),await this.verifyBlockDerivativeInfo(e,t),await this.commonBlockVerify.verifySignature(e)}async verifyBlockDerivativeInfo(e,t=this.config){const r={target:"block"},{baseHelper:n}=this;if(e.height!==1&&!e.previousBlockSignature&&n.isValidBlockSignature(e.previousBlockSignature))throw new Ls(c.PROP_IS_INVALID,{prop:`previousBlockSignature ${e.previousBlockSignature}`,...r});if(!n.isNaturalNumber(e.numberOfTransactions))throw new Ls(c.PROP_IS_INVALID,{prop:`numberOfTransactions ${e.numberOfTransactions}`,type:"natural number",...r});if(!e.payloadHash)throw new Ls(c.PROP_IS_REQUIRE,{prop:`payloadHash ${e.payloadHash}`,...r});if(!n.isNaturalNumber(e.payloadLength))throw new Ls(c.PROP_IS_INVALID,{prop:`payloadLength ${e.payloadLength}`,type:"natural number",...r});if(e.magic!==t.magic)throw new Ls(c.NOT_MATCH,{to_compare_prop:`block.magic ${e.magic}`,be_compare_prop:`genesisBlock.magic ${t.magic}`,to_target:"block_body",be_target:"genesis_block",...r});if(!e.generatorPublicKey)throw new Ls(c.PROP_IS_REQUIRE,{prop:"generatorPublicKey",...r});if(!n.isValidPublicKey(e.generatorPublicKey))throw new Ls(c.PROP_IS_INVALID,{prop:`generatorPublicKey ${e.generatorPublicKey}`,type:"account publicKey",...r});if(!e.signature)throw new Ls(c.PROP_IS_REQUIRE,{prop:"signature",...r});if(!n.isValidSignature(e.signature))throw new Ls(c.PROP_IS_INVALID,{prop:`signature ${e.signature}`,type:"signature",...r});this.commonBlockVerify.verifyBlockSize(e),this.commonBlockVerify.verifyBlockBlobSize(e)}};u([Z("bfchain-core:TransactionCore"),g("design:type",Object)],mc.prototype,"transactionCore",void 0);mc=u([ie(),Ce(8,Z("cryptoHelper")),g("design:paramtypes",[wt,Le,ue,ni,Fr,Ge,vs,Te,Object])],mc);const{ConsensusException:eA}=le("CONTROLLER","_blockbase");let zh=class{async applyTransaction(e,t,r){const n=r.type,s=this.transactionCore,i=s.transactionHelper;if(await s.getTransactionFactoryFromType(n).applyTransaction(r,e),n===i.MULTIPLE){const{transactions:o}=r.asset.multiple;for(const a of o)await this.applyTransaction(e,t,a)}else if(n===i.PROMISE_RESOLVE){const{promiseId:o}=r.asset.resolve,a=await t.getPromiseTransaction(o);if(!a)throw new eA(c.NOT_EXIST,{prop:`promise transaction ${o}`,target:"blockChain"});const p=await s.recombineTransaction(a),l=p.type;l===i.MULTIPLE||l===i.PROMISE_RESOLVE||l===i.MACRO_CALL?await this.applyTransaction(e,t,p):await s.getTransactionFactoryFromType(p.type).applyTransaction(p,e)}else if(n===i.MACRO_CALL){const{macroId:o,inputs:a}=r.asset.call,p=await t.getMacroCallTransaction(o,a);if(!p)throw new eA(c.NOT_EXIST,{prop:`macro transaction ${o}`,target:"blockChain"});const l=await s.recombineTransaction(p),h=l.type;h===i.MULTIPLE||h===i.PROMISE_RESOLVE||h===i.MACRO_CALL?await this.applyTransaction(e,t,l):await s.getTransactionFactoryFromType(l.type).applyTransaction(l,e)}}};u([Z("bfchain-core:TransactionCore"),g("design:type",Object)],zh.prototype,"transactionCore",void 0);zh=u([ie()],zh);const{ArgumentIllegalException:Fc,ArgumentFormatException:KN,NoFoundException:$g,log:wl,info:tA,warn:rA,ConsensusException:nA}=le("CONTROLLER","_blockbase"),ma=vh("generateBlock");let _c=class{constructor(e,t,r,n,s,i,o,a,p,l){this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.asymmetricHelper=s,this.blockGeneratorCalculator=i,this.commonBlockVerify=o,this.blockUtils=a,this.cryptoHelper=p,this.moduleMap=l}async generateBlockBefore(e,t,r,n){if(!e)throw new Fc(c.PARAM_LOST,{param:"body"});if(!t)throw new Fc(c.PARAM_LOST,{param:"asset"});if(!r)throw new Fc(c.PARAM_LOST,{param:"transactions"});ma&&wl("before generateBlock"),n&&await this._wrapBlockError(n.emit("beforeGenerateBlock",e),n,"beforeGenerateBlock",e)}async _wrapBlockError(e,t,r,n){if(e)try{return await e}catch(s){await t.emit("blockError",{type:`generateBlock/${r}`,error:s,blockBody:n})}}async generateBlockAfter(e,t,r,n,s,i,o=this.config){return e.magic=o.magic,await this.insertTransactions(e,t,r,n,s,i),ma&&wl("before signatureBlock"),s&&await this._wrapBlockError(s.emit("beforeSignatureBlock",e),s,"beforeSignatureBlock",e),e.blockSize=this.commonBlockVerify.calcBlockSize(e),e.signatureBuffer=await this.asymmetricHelper.detachedSign(e.getBytes(!0,!0,!0),r.secretKey),n&&(e.signSignatureBuffer=await this.asymmetricHelper.detachedSign(e.getBytes(!1,!0,!0),n.secretKey)),ma&&wl("before generatedBlock"),s&&await this._wrapBlockError(s.emit("generatedBlock",e),s,"generatedBlock",e),e}async insertTransactions(e,t,r,n,s=new Ni,i){if(!i&&(i=this.moduleMap.get("transactionGetterHelper"),!i))throw new $g(c.NOT_EXIST,{prop:"transactionGetterHelper",target:"moduleStroge"});if(!s.blockRewardsGetter)throw new $g(c.NOT_EXIST,{prop:"blockRewardsGetter",target:"eventEmitter"});const{transactionCore:o,blockUtils:a}=this,p=o.abortForbiddenTransaction,{height:l,generatorPublicKey:h,statisticInfo:y}=e,{maxBlockSize:A}=this.config;let _=this.config.maxBlockBlobSize;if(s.customMaxBlobSizeGetter){const B=s.customMaxBlobSizeGetter();_=B<_?B:_}const E=this.cryptoHelper.sha256();let T=0,w=0;const C=this.statisticsHelper.forceGetStatisticsInfoByBlock(s.taskname||`core-generate-${l}`,h,y),N=[],L=new Set;try{this.statisticsHelper.bindApplyTransactionEventEmiter(s,C);const B=new kt(G=>0);ma&&tA("begin insertTransactions");for await(const G of t){s.tIndexGetter&&(G.tIndex=await s.tIndexGetter(G)),ma&&wl("insert transaction: %d / %d",G.tIndex,e.numberOfTransactions);try{const Y=G.transaction,{type:X,senderId:U,signature:v}=Y;if(L.has(v))throw new nA(c.SHOULD_NOT_DUPLICATE,{prop:`transaction with signature ${v}`,target:`block with height ${e.height}`});if(L.add(v),!this.commonBlockVerify.canInsertTransaction(X)){const M=Me.VK.get(Me.trsTypeToV(X)),q=new nA(c.DISABLED_INSERT_TRANSACTION,{trsName:M});if(p)throw q;rA(q)}N.push(G),G.height=e.height;const P=o.getTransactionFactoryFromType(X);await P.beginDealTransaction(Y,s),await a.applyTransaction(s,i,Y),s.assetPrealnumGetter&&(G.assetPrealnum=await s.assetPrealnumGetter(G));const x=G.assetPrealnum;if(x){const M=`height ${G.height} tIndex ${G.tIndex} type ${X} senderId ${U} ${Y.recipientId?" recipientId "+Y.recipientId:" "} signature ${G.transaction.signature}`,{remainAssetPrealnum:q,frozenMainAssetPrealnum:K}=x;if(BigInt(q)<BigInt(0))throw new Fc(c.PROP_IS_INVALID,{prop:`remainAssetPrealnum ${q}`,target:"assetPrealnum",detail:M});if(BigInt(K)<BigInt(0))throw new Fc(c.PROP_IS_INVALID,{prop:`frozenMainAssetPrealnum ${K}`,target:"assetPrealnum",detail:M})}G.signatureBuffer=await this.asymmetricHelper.detachedSign(G.getBytes(!0,!0),r.secretKey),n&&(G.signSignatureBuffer=await this.asymmetricHelper.detachedSign(G.getBytes(!1,!0),n.secretKey)),Object.freeze(G);const k=G.getBytes();E.update(k),T+=k.length,T>A*.95&&await s.emit("nearMaxPayloadLength",{payloadLength:T}),w+=G.transaction.getBlobSize(),w>_*.95&&await s.emit("nearMaxBlobSize",{blobSize:w}),await P.endDealTransaction(G,s)}catch(Y){const X=await s.emit("error",{error:Y,type:"genesisBlock",transactionInBlock:G});if(X&&X.continue)continue;throw Y}}ma&&tA("finish insertTransactions"),e.reward=await s.blockRewardsGetter(l);const $=N.length;if(e.transactionInfo.offset=$,$>0)e.transactionInfo.startTindex=N[0].tIndex;else{if(!s.startTindexGetter)throw new $g(c.NOT_EXIST,{prop:"startTindexGetter",target:"eventEmitter"});e.transactionInfo.startTindex=await s.startTindexGetter()}e.transactionInfo.statisticInfo=C.toModel(),e.transactionInfo.payloadHashBuffer=await E.digest(),e.transactionInfo.payloadLength=T,e.transactionInfo.blobSize=w,e.transactionInfo.transactionInBlocks=N;const V=e.transactionInfo.statisticInfo.numberOfTransactions;e.transactionInfo.numberOfTransactions=V,s.has("finishedDealTransactions")&&(rA("@deprecated",'logic "finishedDealTransactions" '),await s.emit("finishedDealTransactions",e))}finally{C.unref(h)}return e}};u([Z("bfchain-core:TransactionCore"),g("design:type",Object)],_c.prototype,"transactionCore",void 0);_c=u([ie(),Ce(8,Z("cryptoHelper")),g("design:paramtypes",[wt,Le,ue,ni,Fr,Hn,vs,zh,Object,et])],_c);const{ArgumentIllegalException:Gr,OutOfRangeException:Lw,ArgumentFormatException:Vg,NoFoundException:_a,log:Sl,info:Nl,warn:sA,ConsensusException:Uc}=le("CONTROLLER","_blockbase"),Ii=vh("generateBlock");let Ac=class{constructor(e,t,r,n,s,i,o,a,p,l,h,y,A,_){this.blockHelper=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.config=s,this.statisticsHelper=i,this.asymmetricHelper=o,this.chainAssetInfoHelper=a,this.chainTimeHelper=p,this.blockGeneratorCalculator=l,this.moduleMap=h,this.commonBlockVerify=y,this.blockUtils=A,this.cryptoHelper=_}async _wrapBlockError(e,t,r,n){if(e)try{return await e}catch(s){t.emit("blockError",{type:`replayBlock/${r}`,error:s,blockBody:n})}}async replayBlock(e,t,r,n={},s=this.config){Ii&&Nl("begin replayBlock");const{verifySignature:i,recordForkBlock:o}=n;if(!t)throw new Gr(c.PARAM_LOST,{param:"transactions"});if(Ii&&Sl("before replayBlock"),r&&await this._wrapBlockError(r.emit("beforeGenerateBlock",e),r,"beforeGenerateBlock",e),this.blockHelper.verifyBlockVersion(e,s),e.height>1){const p=await this.blockHelper.forceGetBlockByHeight(e.height-1);if(e.previousBlockSignature!==p.signature){if(o){let E=n.blockGetterHelper;if(!E&&(E=this.moduleMap.get("blockGetterHelper"),!E))throw new _a(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});await E.chainBlockFork(e,Gl.DIFFERENT_PRE_BLOCK_SIGNATURE)}throw new Gr(c.NOT_MATCH,{to_compare_prop:`previousBlockSignature ${e.previousBlockSignature}`,be_compare_prop:`blockSignature ${e.signature}`,to_target:"block",be_target:"blockChain lastBlock"})}const l=this.chainTimeHelper,h=l.getSlotNumberByTimestamp(e.timestamp),y=l.getNextSlotNumberByTimestamp(p.timestamp);if(h<y)throw new Uc(c.PROP_SHOULD_GT_FIELD,{prop:`timestamp ${e.timestamp}`,target:"block",field:`lastBlock timestamp ${p.timestamp}`});const{address:A}=await this.blockGeneratorCalculator.calcGenerateBlockGenerator(p,{toTimestamp:e.timestamp}),_=await this.accountBaseHelper.getAddressFromPublicKeyString(e.generatorPublicKey);if(A!==_){const E=l.getSlotNumberByTimestamp(e.timestamp);throw new Uc(c.INVALID_BLOCK_GENERATOR,{reason:`lastBlock.timestamp: ${p.timestamp} lastBlock.height: ${p.height}, block.timestamp: ${e.timestamp} curTime: ${l.getTimeByTimestamp(e.timestamp)} signature${e.signature} height: ${e.height} slot ${E} ${A}  ${_} `})}}const a=await this.insertTransactionsForReplay(e,t,r,n,s);return Ii&&Sl("before signatureBlock"),r&&await this._wrapBlockError(r.emit("beforeSignatureBlock",e),r,"beforeSignatureBlock",e),this.commonBlockVerify.verifyBlockSize(e,a),this.commonBlockVerify.verifyBlockBlobSize(e),i&&await this.commonBlockVerify.verifySignature(e),Ii&&Sl("before generatedBlock"),r&&await this._wrapBlockError(r.emit("generatedBlock",e),r,"generatedBlock",e),Ii&&Nl("finish replayBlock"),e}async insertTransactionsForReplay(e,t,r=new Ni,n,s=this.config){let i=n.transactionGetterHelper;if(!i&&(i=this.moduleMap.get("transactionGetterHelper"),!i))throw new _a(c.NOT_EXIST,{prop:"transactionGetterHelper",target:"moduleStroge"});const{verifySignature:o,skipVerifyStatisticInfo:a,skipVerifyParticipation:p}=n,{height:l,signature:h,generatorPublicKeyBuffer:y,statisticInfo:A}=e,_=this.cryptoHelper.sha256();let E=0,T=0;const w=this.statisticsHelper.forceGetStatisticsInfoByBlock(r.taskname||`core-replay-${l}`,h),C=[],{transactionCore:N,asymmetricHelper:L,transactionHelper:B,baseHelper:$,blockUtils:V}=this,{GRAB_ASSET:G,SIGN_FOR_ASSET:Y}=B,X=N.abortForbiddenTransaction,U=new Set;if(!r.startTindexGetter)throw new _a(c.NOT_EXIST,{prop:"startTindexGetter",target:"eventEmitter"});if(!r.tIndexGetter)throw new _a(c.NOT_EXIST,{prop:"tIndexGetter",target:"eventEmitter"});if(!r.assetPrealnumGetter)throw new _a(c.NOT_EXIST,{prop:"assetPrealnumGetter",target:"eventEmitter"});if(!r.blockRewardsGetter)throw new _a(c.NOT_EXIST,{prop:"blockRewardsGetter",target:"eventEmitter"});const v=await r.startTindexGetter();if(e.startTindex!==v)throw new Gr(c.NOT_MATCH,{to_compare_prop:`startTindex ${e.startTindex}`,be_compare_prop:`startTindex ${v}`,to_target:"block",be_target:"calculate"});const P=new Map;try{this.statisticsHelper.bindApplyTransactionEventEmiter(r,w),Ii&&Nl("begin insertTransactionsForReplay");for await(const F of t){const J=r.tIndexGetter(F);Ii&&Sl("insert transaction: %d / %d",F.tIndex+1,e.numberOfTransactions);try{if(F.tIndex!==J)throw new Lw(c.NOT_MATCH,{to_compare_prop:`tIndex ${F.tIndex}`,be_compare_prop:`tIndex ${J}`,to_target:"transactionInBlock",be_target:"calculate"});const S=F.transaction,{type:D,senderId:Q,storageValue:fe,signature:ce}=S;if(U.has(ce))throw new Uc(c.SHOULD_NOT_DUPLICATE,{prop:`transaction with signature ${ce}`,target:`block with height ${e.height}`});if(U.add(ce),!this.commonBlockVerify.canInsertTransaction(D)){const ee=Me.VK.get(Me.trsTypeToV(D)),R=new Uc(c.DISABLED_INSERT_TRANSACTION,{trsName:ee});if(X)throw R;sA(R)}if(C.push(F.getBytes()),fe&&(D===G||D===Y)){const ee=P.get(fe);if(ee){for(const R of ee)if(R.senderId===Q)throw new Uc(c.SHOULD_NOT_INCLUDE,{prop:"Transactions",target:`block with height ${l}`,value:`transaction with storageValue ${fe}`});ee.push(S)}else P.set(fe,[S])}const re=N.getTransactionFactoryFromType(D);if(await re.beginDealTransaction(S,r),await V.applyTransaction(r,i,S),!a){const ee=F.assetPrealnum;if(ee){const R=await r.assetPrealnumGetter(F);if(!R)throw new Gr(c.NOT_FOUND,{prop:`transaction assetPrealnum ${ce}`,target:"blockChain"});if(R.remainAssetPrealnum!==ee.remainAssetPrealnum)throw new Gr(c.NOT_MATCH,{to_compare_prop:`assetPrealnum.remainAssetPrealnum ${JSON.stringify(ee.remainAssetPrealnum)}`,be_compare_prop:`assetPrealnum.remainAssetPrealnum ${JSON.stringify(R.remainAssetPrealnum)}`,to_target:`transactionInBlock ${Q} ${ce}`,be_target:"calculate"});if(R.frozenMainAssetPrealnum!==ee.frozenMainAssetPrealnum)throw new Gr(c.NOT_MATCH,{to_compare_prop:`assetPrealnum.frozenMainAssetPrealnum ${JSON.stringify(ee.frozenMainAssetPrealnum)}`,be_compare_prop:`assetPrealnum.frozenMainAssetPrealnum ${JSON.stringify(R.frozenMainAssetPrealnum)}`,to_target:`transactionInBlock ${Q} ${ce}`,be_target:"calculate"})}}if(o){if(!await L.detachedVeriy(F.getBytes(!0,!0),F.signatureBuffer,y))throw new Vg("Invalid transactionInBlock signature: %O",F.toJSON());if(e.generatorSecondPublicKeyBuffer){if(!F.signSignatureBuffer)throw new Vg(c.PROP_IS_REQUIRE,{prop:"signSignature",target:"transactionInBlock"});if(!await L.detachedVeriy(F.getBytes(!1,!0),F.signSignatureBuffer,e.generatorSecondPublicKeyBuffer))throw new Vg("Invalid transactionInBlock signSignature: %O",F.toJSON())}}Object.freeze(F);const se=F.getBytes();_.update(se),E+=se.length,T+=F.transaction.getBlobSize(),await re.endDealTransaction(F,r)}catch(S){const D=await r.emit("error",{error:S,type:"replayBlock",transactionInBlock:F});if(D&&D.continue)continue;throw S}}Ii&&Nl("finish insertTransactionsForReplay");const x=await r.blockRewardsGetter(l);if(e.reward!==x)throw new Gr(c.NOT_MATCH,{to_compare_prop:`blockReward ${e.reward}`,be_compare_prop:`expectedReward ${x}`,to_target:"block",be_target:"calculate"});const k=C.length;if(e.offset!==k)throw new Gr(c.NOT_MATCH,{to_compare_prop:`offset ${e.offset}`,be_compare_prop:`offset ${k}`,to_target:"block",be_target:"calculate"});if(e.payloadLength!==E)throw new Gr(c.NOT_MATCH,{to_compare_prop:`payloadLength ${e.payloadLength}`,be_compare_prop:`payloadLength ${E}`,to_target:"block",be_target:"calculate"});if(e.blobSize!==T)throw new Gr(c.NOT_MATCH,{to_compare_prop:`blobSize ${e.blobSize}`,be_compare_prop:`blobSize ${T}`,to_target:"block",be_target:"calculate"});const M=await _.digest("hex");if(e.payloadHash!==M)throw new Gr(c.NOT_MATCH,{to_compare_prop:`payloadHashHex ${e.payloadHash}`,be_compare_prop:`payloadHashHex ${M}`,to_target:"block",be_target:"calculate"});const q=w.toModel(),K=q.numberOfTransactions;if(e.numberOfTransactions!==K)throw new Gr(c.NOT_MATCH,{to_compare_prop:`numberOfTransactions ${e.numberOfTransactions}`,be_compare_prop:`numberOfTransactions ${K}`,to_target:"block",be_target:"calculate"});if(!a){if(!this.baseHelper.isArrayEqual(A.getBytes(),q.getBytes()))throw new Gr(c.NOT_MATCH,{to_compare_prop:`statisticsInfo ${JSON.stringify(A.toJSON())}`,be_compare_prop:`statisticsInfo ${JSON.stringify(q.toJSON())}`,to_target:"block",be_target:"calculate"});const F=w.totalAsset,J=w.totalFee;if(BigInt(e.totalAmount)!==F)throw new Gr(c.NOT_MATCH,{to_compare_prop:`totalAmount ${e.totalAmount}`,be_compare_prop:`totalAmount ${F.toString()}`,to_target:"block",be_target:"calculate"});if(BigInt(e.totalFee)!==J)throw new Gr(c.NOT_MATCH,{to_compare_prop:`totalFee ${e.totalFee}`,be_compare_prop:`totalFee ${J.toString()}`,to_target:"block",be_target:"calculate"});e.transactionInfo.transactionInBlockBufferList=C}r.has("finishedDealTransactions")&&(sA("@deprecated",'logic "finishedDealTransactions" '),await r.emit("finishedDealTransactions",e))}finally{w.unref(e.signature)}return C}};u([Z("bfchain-core:TransactionCore"),g("design:type",Object)],Ac.prototype,"transactionCore",void 0);Ac=u([ie(),Ce(13,Z("cryptoHelper")),g("design:paramtypes",[wt,Te,we,Le,ue,ni,Fr,Ge,Yt,Hn,et,vs,zh,Object])],Ac);let xu=class extends wm{constructor(e,t,r,n,s,i,o,a,p,l,h,y){super(),this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.asymmetricHelper=s,this.cryptoHelper=i,this.blockGeneratorCalculator=o,this.commonBlockVerify=a,this.verifyBlockCore=p,this.generateBlockCore=l,this.replayBlockCore=h,this.moduleMap=y}async fromJSON(e,t){const r=ja.fromObject(e);return t&&t.verify&&await this.verify(r,t.config),r}async verifyBlockBody(e,t,r=this.config){await super.verifyBlockBody(e,t,r)}_generateBlock(e,t){const r=ja.fromObject({...e,asset:t});return r.reward=this.config.basicRewards,r}async replayBlock(e,t,r,n={},s=this.config){return await super.replayBlock(e,t,r,n,s),n.verifyAsset&&await this.checkAssetChangeHash(e.height,e.asset.commonAsset.assetChangeHash,n),e}};u([Z("bfchain-core:TransactionCore"),g("design:type",Object)],xu.prototype,"transactionCore",void 0);xu=u([ie(),Ce(5,Z("cryptoHelper")),g("design:paramtypes",[wt,Le,ue,ni,Fr,Object,Hn,vs,mc,_c,Ac,et])],xu);const{ArgumentIllegalException:Fe}=le("CONTROLLER","GenesisBlockFactory");let Ru=class extends wm{constructor(e,t,r,n,s,i,o,a,p,l,h,y,A){super(),this.blockHelper=e,this.accountBaseHelper=t,this.baseHelper=r,this.config=n,this.statisticsHelper=s,this.asymmetricHelper=i,this.cryptoHelper=o,this.blockGeneratorCalculator=a,this.commonBlockVerify=p,this.verifyBlockCore=l,this.generateBlockCore=h,this.replayBlockCore=y,this.moduleMap=A}async fromJSON(e,t){const r=xo.fromObject(e);return t&&t.verify&&await this.verify(r,t.config),r}async verifyBlockBody(e,t,r=this.config){await super.verifyBlockBody(e,t);const{baseHelper:n}=this,s=t.genesisAsset;if(!s)throw new Fe(c.PARAM_LOST,{param:"genesisBlock"});const i={target:"genesisBlock"},o=s.assetType;if(!o)throw new Fe(c.PROP_IS_REQUIRE,{prop:"assetType",...i});if(!n.isValidAssetType(o))throw new Fe(c.PROP_IS_INVALID,{prop:`assetType ${s.assetType}`,...i});const a=s.chainName;if(!a)throw new Fe(c.PROP_IS_REQUIRE,{prop:"chainName",...i});if(!n.isValidChainName(a))throw new Fe(c.PROP_IS_INVALID,{prop:`chainName ${s.chainName}`,...i});const p=s.magic;if(!p)throw new Fe(c.PROP_IS_REQUIRE,{prop:"magic",...i});if(!n.isValidChainMagic(p))throw new Fe(c.PROP_IS_INVALID,{prop:`magic ${s.magic}`,...i});const l=s.bnid;if(!l)throw new Fe(c.PROP_IS_REQUIRE,{prop:"bnid",...i});if(l!==$l.TESTNET&&l!==$l.MAINNET)throw new Fe(c.SHOULD_BE,{to_compare_prop:`bnid ${l}`,to_target:"remark",be_compare_prop:"BNID_TYPE",...i});if(!n.isPositiveInteger(s.beginEpochTime))throw new Fe(c.PROP_IS_INVALID,{prop:`beginEpochTime ${s.beginEpochTime}`,...i});const h=s.genesisLocationName;if(!h)throw new Fe(c.PROP_IS_REQUIRE,{prop:"genesisLocationName",...i});if(!n.isValidLocationName(h,r.chainName))throw new Fe(c.PROP_IS_INVALID,{prop:`genesisLocationName ${s.genesisLocationName}`,...i});if(!s.genesisAmount)throw new Fe(c.PROP_IS_REQUIRE,{prop:"genesisAmount",...i});if(!n.isValidAssetNumber(s.genesisAmount))throw new Fe(c.PROP_IS_INVALID,{prop:`genesisAmount ${s.genesisAmount}`,...i});if(!s.maxSupply)throw new Fe(c.PROP_IS_REQUIRE,{prop:"maxSupply",...i});if(!n.isValidAssetNumber(s.maxSupply))throw new Fe(c.PROP_IS_INVALID,{prop:`maxSupply ${s.maxSupply}`,...i});if(BigInt(s.maxSupply)<BigInt(s.genesisAmount))throw new Fe(c.PROP_SHOULD_GTE_FIELD,{prop:"maxSupply",...i,field:s.genesisAmount});if(!n.isPositiveFloatContainZero(s.minTransactionFeePerByte))throw new Fe(c.PROP_IS_INVALID,{prop:`minTransactionFeePerByte ${s.minTransactionFeePerByte}`,...i});if(!n.isPositiveInteger(s.maxTPSPerBlock))throw new Fe(c.PROP_IS_INVALID,{prop:`maxTPSPerBlock ${s.maxTPSPerBlock}`,...i});if(!n.isPositiveInteger(s.maxTransactionSize))throw new Fe(c.PROP_IS_INVALID,{prop:`maxTransactionSize ${s.maxTransactionSize}`,...i});if(s.maxTransactionBlobSize===void 0)throw new Fe(c.PROP_IS_REQUIRE,{prop:`maxTransactionBlobSize ${s.maxTransactionBlobSize}`,...i});if(!n.isNaturalNumber(s.maxTransactionBlobSize))throw new Fe(c.PROP_IS_INVALID,{prop:`maxTransactionBlobSize ${s.maxTransactionBlobSize}`,...i});if(!n.isPositiveInteger(s.maxBlockSize))throw new Fe(c.PROP_IS_INVALID,{prop:`maxBlockSize ${s.maxBlockSize}`,...i});if(s.maxBlockBlobSize===void 0)throw new Fe(c.PROP_IS_REQUIRE,{prop:`maxBlockBlobSize ${s.maxBlockBlobSize}`,...i});if(!n.isNaturalNumber(s.maxBlockBlobSize))throw new Fe(c.PROP_IS_INVALID,{prop:`maxBlockBlobSize ${s.maxBlockBlobSize}`,...i});if(!n.isNaturalNumber(s.consessusBeforeSyncBlockDiff))throw new Fe(c.PROP_IS_INVALID,{prop:`consessusBeforeSyncBlockDiff ${s.consessusBeforeSyncBlockDiff}`,...i});if(!n.isPositiveInteger(s.maxGrabTimesOfGiftAsset))throw new Fe(c.PROP_IS_INVALID,{prop:`maxGrabTimesOfGiftAsset ${s.maxGrabTimesOfGiftAsset}`,...i});if(!s.issueAssetMinChainAsset)throw new Fe(c.PROP_IS_REQUIRE,{prop:"issueAssetMinChainAsset",...i});if(!n.isValidAssetNumber(s.issueAssetMinChainAsset))throw new Fe(c.PROP_IS_INVALID,{prop:`issueAssetMinChainAsset ${s.issueAssetMinChainAsset}`,...i});if(!s.maxMultipleOfAssetAndMainAsset)throw new Fe(c.PROP_IS_REQUIRE,{prop:"maxMultipleOfAssetAndMainAsset",...i});if(!n.isPositiveBigFloatNotContainZero(s.maxMultipleOfAssetAndMainAsset))throw new Fe(c.PROP_IS_INVALID,{prop:`maxMultipleOfAssetAndMainAsset ${s.maxMultipleOfAssetAndMainAsset}`,...i});if(!s.issueEntityFactoryMinChainAsset)throw new Fe(c.PROP_IS_REQUIRE,{prop:"issueEntityFactoryMinChainAsset",...i});if(!n.isValidAssetNumber(s.issueEntityFactoryMinChainAsset))throw new Fe(c.PROP_IS_INVALID,{prop:`issueEntityFactoryMinChainAsset ${s.issueEntityFactoryMinChainAsset}`,...i});if(!s.maxMultipleOfEntityAndMainAsset)throw new Fe(c.PROP_IS_REQUIRE,{prop:"maxMultipleOfEntityAndMainAsset",...i});if(!n.isPositiveBigFloatNotContainZero(s.maxMultipleOfEntityAndMainAsset))throw new Fe(c.PROP_IS_INVALID,{prop:`maxMultipleOfEntityAndMainAsset ${s.maxMultipleOfEntityAndMainAsset}`,...i});if(!s.registerChainMinChainAsset)throw new Fe(c.PROP_IS_REQUIRE,{prop:`registerChainMinChainAsset ${s.registerChainMinChainAsset}`,...i});if(!n.isValidAssetNumber(s.registerChainMinChainAsset))throw new Fe(c.PROP_IS_INVALID,{prop:`registerChainMinChainAsset ${s.registerChainMinChainAsset}`,...i});if(!n.isPositiveInteger(s.maxApplyAndConfirmedBlockHeightDiff))throw new Fe(c.PROP_IS_INVALID,{prop:`maxApplyAndConfirmedBlockHeightDiff ${s.maxApplyAndConfirmedBlockHeightDiff}`,...i});const{blockPerRound:y,forgeInterval:A,basicRewards:_,whetherToAllowGeneratorContinusElections:E}=s;if(!n.isPositiveInteger(y))throw new Fe(c.PROP_IS_INVALID,{prop:`blockPerRound ${y}`,...i});if(!_)throw new Fe(c.PROP_IS_REQUIRE,{prop:"maxSupply",...i});if(!n.isValidAssetNumber(_))throw new Fe(c.PROP_IS_INVALID,{prop:`basicRewards ${_}`,...i});if(!n.isBoolean(E))throw new Fe(c.PROP_IS_INVALID,{prop:`whetherToAllowGeneratorContinusElections ${E}`,...i});if(!n.isPositiveInteger(A))throw new Fe(c.PROP_IS_INVALID,{prop:`forgeInterval ${A}`,...i});if(A<5)throw new Fe(c.PROP_SHOULD_GTE_FIELD,{prop:`forgeInterval ${A}`,field:5,...i});if(!s.ports)throw new Fe(c.PROP_IS_REQUIRE,{prop:"ports",...i});if(!n.isValidChainPorts(s.ports))throw new Fe(c.PROP_IS_INVALID,{prop:`ports ${s.ports}`,...i});if(!s.assetChangeHash)throw new Fe(c.PROP_IS_REQUIRE,{prop:"assetChangeHash",...i});if(!n.isValidAssetChangeHash(s.assetChangeHash))throw new Fe(c.PROP_IS_INVALID,{prop:`assetChangeHash ${s.assetChangeHash}`,...i});const{nextRoundGenerators:T}=s;if(!T)throw new Fe(c.PROP_IS_REQUIRE,{prop:"nextRoundGenerators",...i});if(!n.isArray(T))throw new Fe(c.SHOULD_BE,{to_compare_prop:"nextRoundGenerators",to_target:"genesisBlock",be_compare_prop:"array",...i});if(T.length!==s.blockPerRound)throw new Fe(c.NOT_MATCH,{to_compare_prop:`nextRoundGenerators's length ${T.length}`,to_target:"genesisBlock",be_compare_prop:`blockPerRound: ${r.blockPerRound}`,be_target:"genesisBlock"});for(let w=0;w<T.length;w++){const C=T[w];if(!await this.accountBaseHelper.isAddress(C.address))throw new Fe(c.NOT_EXIST,{prop:`genesisBlock.nextRoundGenerators[${w}].address ${C.address}`,target:"genesisBlock.newGenerators"});if(!this.baseHelper.isNaturalNumber(C.numberOfForgeEntities))throw new Fe(c.PROP_IS_INVALID,{prop:`nextRoundGenerators[${w}].numberOfForgeEntities ${C.numberOfForgeEntities}`,target:"genesisBlock.nextRoundGenerators"})}}_generateBlock(e,t){const r=xo.fromObject({...e,asset:t});return r.generatorPublicKey=e.generatorPublicKey,r.reward="0",r}async replayBlock(e,t,r,n={},s=this.config){return await super.replayBlock(e,t,r,n,s),n.verifyAsset&&await this.checkAssetChangeHash(e.height,e.asset.genesisAsset.assetChangeHash,n),e}};u([Z("bfchain-core:TransactionCore"),g("design:type",Object)],Ru.prototype,"transactionCore",void 0);Ru=u([ie(),Ce(6,Z("cryptoHelper")),g("design:paramtypes",[wt,Te,Le,ue,ni,Fr,Object,Hn,vs,mc,_c,Ac,et])],Ru);const{ArgumentIllegalException:iA,ConsensusException:Ol,NoFoundException:oA}=le("CONTROLLER","RoundLastBlockFactory");let vu=class extends wm{constructor(e,t,r,n,s,i,o,a,p,l,h,y){super(),this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.asymmetricHelper=s,this.cryptoHelper=i,this.blockGeneratorCalculator=o,this.commonBlockVerify=a,this.verifyBlockCore=p,this.generateBlockCore=l,this.replayBlockCore=h,this.moduleMap=y}async fromJSON(e,t){const r=za.fromObject(e);return t&&t.verify&&await this.verify(r,t.config),r}async verifyBlockBody(e,t,r=this.config){await super.verifyBlockBody(e,t,r);const n=t.roundLastAsset,s={target:"roundLastBlockAsset"},{baseHelper:i}=this;if(!n.nextRoundGenerators)throw new iA(c.PROP_IS_REQUIRE,{prop:"nextRoundGenerators",...s});if(!i.isValidChainOnChainHash(n.chainOnChainHash))throw new iA(c.PROP_IS_INVALID,{prop:`chainOnChainHash ${n.chainOnChainHash}`,type:"chainOnChainHash",...s})}_generateBlock(e,t){const r=za.fromObject({...e,asset:t});return r.reward=this.config.basicRewards,r}async replayBlock(e,t,r,n={},s=this.config){if(await super.replayBlock(e,t,r,n,s),n.verifyAsset){const{height:i,asset:o}=e;let a=n.transactionGetterHelper;if(!a&&(a=this.moduleMap.get("transactionGetterHelper"),!a))throw new oA(c.NOT_EXIST,{prop:"transactionGetterHelper",target:"moduleStroge"});const p=o.roundLastAsset;let l=n.blockGetterHelper;if(!l&&(l=this.moduleMap.get("blockGetterHelper"),!l))throw new oA(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});await this.checkAssetChangeHash(i,p.assetChangeHash,n),await this.__checkChainOnChainHash(i,p.chainOnChainHash,l),await this.__checkNextRoundGenerators(e,l)}return e}async __checkChainOnChainHash(e,t,r){const n=await this.blockHelper.calcChainOnChainHash(e,r);if(n!==t)throw new Ol(c.NOT_MATCH,{to_compare_prop:`chainOnChainHash ${t}`,be_compare_prop:`chainOnChainHash ${n}`,to_target:"block",be_target:"calculate"})}async __checkNextRoundGenerators(e,t){const r=await t.getNextRoundGenerators(await t.getLastBlock(),e.generatorPublicKey),n=e.asset.roundLastAsset.nextRoundGenerators,s=r.length;if(s!==n.length)throw new Ol(c.NOT_MATCH,{to_compare_prop:`nextRoundGenerators length ${n.length}`,be_compare_prop:`nextRoundGenerators length ${r.length}`,to_target:"block remark",be_target:"calculate"});for(let i=0;i<s;i++){const{address:o,numberOfForgeEntities:a}=r[i],p=n[i];if(p.address!==o)throw new Ol(c.NOT_MATCH,{to_compare_prop:`nextRoundGenerators index ${i} address ${p.address}`,be_compare_prop:`nextRoundGenerators index ${i} address ${o}`,to_target:"block remark",be_target:"calculate"});if(p.numberOfForgeEntities!==a)throw new Ol(c.NOT_MATCH,{to_compare_prop:`nextRoundGenerators index ${i} address ${p.address} numberOfForgeEntities ${p.numberOfForgeEntities}`,be_compare_prop:`nextRoundGenerators index ${i} address ${o} numberOfForgeEntities ${a}`,to_target:"block remark",be_target:"calculate"})}}};u([Z("bfchain-core:TransactionCore"),g("design:type",Object)],vu.prototype,"transactionCore",void 0);vu=u([ie(),Ce(5,Z("cryptoHelper")),g("design:paramtypes",[wt,Le,ue,ni,Fr,Object,Hn,vs,mc,_c,Ac,et])],vu);const{NoFoundException:Er}=le("helper-account","accountHelper");let Bu=class{getAccounts(e,t,r=this.accountGetterHelper){if(!r)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAccounts(e,t)}getNextRoundGenerators(e=this.accountGetterHelper){if(!e&&!e)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return e.getNextRoundGenerators()}getAccountInfo(e,t,r=this.accountGetterHelper){if(!r)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAccountInfo(e,t)}getAccountTxCountInBlock(e,t=this.accountGetterHelper){if(!t)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getAccountTxCountInBlock(e)}getDApp(e,t,r,n=this.accountGetterHelper){if(!n)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return n.getDApp(e,t,r)}isDAppPossessor(e,t,r=this.accountGetterHelper){if(!r)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.isDAppPossessor(e,t)}getLocationName(e,t,r,n=this.accountGetterHelper){if(!n)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return n.getLocationName(e,t,r)}isLocationNamePossessor(e,t,r=this.accountGetterHelper){if(!r)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.isLocationNamePossessor(e,t)}isSubLocationNameExist(e,t,r=this.accountGetterHelper){if(!r)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.isSubLocationNameExist(e,t)}isLocationNameForbidden(e,t=this.accountGetterHelper){if(!t)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.isLocationNameForbidden(e)}getFrozenAsset(e,t,r,n=this.accountGetterHelper){if(!n)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return n.getFrozenAsset(e,t,r)}getAsset(e,t,r=this.accountGetterHelper){if(!r)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAsset(e,t)}getCurrency(e,t=this.accountGetterHelper){if(!t)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getCurrency(e)}isCurrencyForbidden(e,t=this.accountGetterHelper){if(!t)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.isCurrencyForbidden(e)}getMagic(e,t=this.accountGetterHelper){if(!t)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getMagic(e)}getChain(e,t=this.accountGetterHelper){if(!t)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getChain(e)}getMigrateCertificate(e,t=this.accountGetterHelper){if(!t)throw new Er(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getMigrateCertificate(e)}};u([Z("accountGetterHelper",{optional:!0}),g("design:type",Object)],Bu.prototype,"accountGetterHelper",void 0);Bu=u([ie()],Bu);let aA=class{constructor(e,t,r,n){this.config=e,this.blockHelper=t,this.accountHelper=r,this.transactionHelper=n}async getNextRoundGenerators(e,t){const r=this.blockHelper.calcRoundByHeight(e);return await this.calcForgingGenerators(r,t)}async calcForgingGenerators(e,t){let r=await this.accountHelper.getNextRoundGenerators(t);const n=r.length<this.config.blockPerRound;let s=r.map(o=>o.address),i=e-1;for(;r.length<this.config.blockPerRound&&i!==0;){const o=await this.__getAlternateGenerators(i,r,s,t);r=o.results,s=o.pickAddressArr,i--}return n&&(r=this.blockHelper.sortInRankAccountInfoList(r)),r}async __getAlternateGenerators(e,t,r,n){const s=await this.blockHelper.forceGetBlockGeneratorAddressByRound(e),i=[];for(const a of s)r.includes(a)||(r[r.length]=a,i[i.length]=a);let o=await this.accountHelper.getAccounts(i,e,n);return o=this.__sortByProducedblocks(o),t.push.apply(t,o.slice(0,this.config.blockPerRound-t.length)),{results:t,pickAddressArr:r}}__sortByProducedblocks(e){if(e.length<=1)return e;const t=[...e],r=Math.floor(t.length/2),n=t.splice(r,1)[0],s=[],i=[];for(let o=0;o<t.length;o++)t[o].producedblocks>n.producedblocks?s[s.length]=t[o]:i[i.length]=t[o];return this.__sortByProducedblocks(s).concat([n],this.__sortByProducedblocks(i))}};aA=u([ie(),g("design:paramtypes",[ue,wt,Bu,we])],aA);const{warn:cA,ConsensusException:Gg,log:Dw}=le("Core","blockForkCheck");var st;(function(e){e[e.KEEP=1]="KEEP",e[e.MERGE=2]="MERGE",e[e.FORK=3]="FORK"})(st||(st={}));var Pu;(function(e){e[e.PUZZLED=11]="PUZZLED"})(Pu||(Pu={}));let pA=class{constructor(e,t,r){this.blockHelper=e,this.timeHelper=t,this.config=r}async checkNewBlockFromChainChannel(e,t,r=this.blockHelper.blockGetterHelper){const n=await this.checkNewBlock(e,t.toBlockGetterHelper({maxHeight:e.height}),r);if(n.plot===st.MERGE){const s=await this.blockHelper.getCurrentReplayingBlockInfo(r),i=s&&s.chainChannelGroup;i&&i.addChainChannels(t)}return n}checkSameHeightBlockPlot_(e,t){if(e.timestamp>t.timestamp)return st.FORK;if(e.timestamp<t.timestamp)return st.KEEP;if(e.previousBlockSignature===t.previousBlockSignature&&e.timestamp===t.timestamp){if(e.numberOfTransactions>t.numberOfTransactions||e.totalFee>t.totalFee)return st.KEEP;if(e.totalFee===t.totalFee){if(e.signature>t.signature)return st.KEEP;if(e.signature===t.signature)return st.MERGE}}return st.FORK}checkSameHeightBlockListPlot_(e,t){return this.checkSameHeightBlockPlot_(this.blockHelper.parseBlockPlotCheckerListToPlotChecker(e),this.blockHelper.parseBlockPlotCheckerListToPlotChecker(t))}async getBlockPlotCheckerEnd_(e,t){const r={pc:t,blockGetterHelper:e},n=await this.blockHelper.getCurrentReplayingBlockInfo(e);n&&(r.blockGetterHelper=n.blockGetterHelper,r.pc=this.blockHelper.parseBlockToPlotChecker(await n.blockGetterHelper.getLastBlock()));const s=await this.blockHelper.getCurrentGenerateBlock(e);return s&&(r.pc=this.blockHelper.parseNewBlockToPlotChecker(s)),r}async checkBlockGetterPlot(e,t,r,n){const[s,i]=await Promise.all([this.getBlockPlotCheckerEnd_(t,e),this.getBlockPlotCheckerEnd_(n,r)]);if(s.pc.height<=i.pc.height){const a=await this.checkBlockGetterPlotEnd(s.pc,i.pc,i.blockGetterHelper);return a.plot===st.KEEP?{plot:st.KEEP,height:e.height,blockPlotChecker:e}:a.plot===st.MERGE?{plot:st.MERGE,height:r.height,blockPlotChecker:r}:a.plot===st.FORK&&typeof a.height=="number"&&a.height<=e.height?{plot:a.plot,height:a.height}:a}const o=await this.checkBlockGetterPlotEnd(i.pc,s.pc,s.blockGetterHelper);return o.plot===st.MERGE?{plot:st.MERGE,height:r.height,blockPlotChecker:r}:o.plot===st.FORK?{plot:st.KEEP,height:e.height,blockPlotChecker:e}:(cA(`should not happen: the pc5.height is large then pc6.height, Why plot is ${st[o.plot]}?`),o)}async checkBlockGetterPlotEnd(e,t,r){const n={plot:st.MERGE,height:t.height,blockPlotChecker:t},s={plot:st.KEEP,height:e.height,blockPlotChecker:e},i=a=>({plot:st.FORK,height:a}),o=()=>({plot:Pu.PUZZLED});if(e.height<t.height)return(e.height===t.height-1?t.previousBlockSignature:await this.blockHelper.forceGetBlockSignatureByHeight(e.height,r))===e.signature?n:i();if(e.height===t.height){if(e.signature===t.signature)return n;if(e.previousBlockSignature===t.previousBlockSignature){const a=this.checkSameHeightBlockPlot_(e,t);return a===st.FORK?i(e.height-1):a===st.KEEP?s:n}return o()}return s}async checkNewBlock(e,t,r=this.blockHelper.blockGetterHelper){const n=await this.blockHelper.getLastBlock(r),s=this.blockHelper.parseBlockToPlotChecker(await this.blockHelper.getLastBlock(r));let i;e instanceof Mt?i=this.blockHelper.parseBlockToPlotChecker(e):i=e;const o=await this.checkBlockGetterPlot(s,r,i,t),a={plot:st.MERGE,height:i.height,block:this.blockHelper.getBlockFromPlotChecker(i)},p={plot:st.KEEP,height:s.height,block:n},l=(h,y)=>({plot:st.FORK,height:h,block:y});if(o.plot===Pu.PUZZLED){const h=await this.findNearestSameBlock(s.height-1,r,t),y=(await this.blockHelper.forceGetBlockListByHeightRange(h.height+1,s.height,r)).map(E=>this.blockHelper.parseBlockToPlotChecker(E)),A=(await this.blockHelper.forceGetBlockListByHeightRange(h.height+1,i.height,t)).map(E=>this.blockHelper.parseBlockToPlotChecker(E)),_=this.checkSameHeightBlockListPlot_(y,A);if(_===st.FORK)return l(h.height,h);if(_===st.KEEP)return p;if(_===st.MERGE)return cA("should not happen. pc1 and pc2 are puzzled. should not 'MERGE'!"),a;throw new Error("should not happen in PUZZLED")}if(o.plot===st.FORK){if(typeof o.height=="number")return l(o.height,o.height===s.height?n:void 0);const h=await this.findNearestSameBlock(s.height-1,r,t);return l(h.height,h)}if(o.plot===st.MERGE)return a;if(o.plot===st.KEEP)return p;throw new Error("should not happen in checkResult")}async findNearestSameBlock(e,t,r){if(e<1)throw new Gg(c.GENESIS_BLOCK_MAYBE_NO_EQUAL);const n=this.blockHelper.calcRoundByHeight(e)-1,s=this.blockHelper.calcRoundEndHeight(n),i=await this.findNearestSameBlockInOneRound(e,s,t,r);if(i)return i;let o=s;do{const l=await this.blockHelper.forceGetBlockByHeight(o,t);if((await this.blockHelper.forceGetBlockByHeight(o,r)).asset.roundLastAsset.chainOnChainHash===l.asset.roundLastAsset.chainOnChainHash)break;o-=this.config.blockPerRound}while(o>1);const a=o+this.config.blockPerRound;Dw(` ${a} 58 ()`);const p=await this.findNearestSameBlockInOneRound(a,a-this.config.blockPerRound,t,r);if(!p)throw new Gg(c.FAILED_TO_FIND_NEAREST_SAME_BLOCK_IN_ONE_ROUND);return p}async findNearestSameBlockInOneRound(e,t,r,n){for(let s=e;s>=t-1;s--){const i=await this.blockHelper.forceGetBlockByHeight(s,n),o=await this.blockHelper.forceGetBlockByHeight(s,r);if(i.signature===o.signature)return o;if(s===1)throw new Gg(c.GENESIS_BLOCK_NOT_MATCH)}}};pA=u([ie(),g("design:paramtypes",[wt,Yt,ue])],pA);const{ArgumentFormatException:hA,log:jN,warn:Fw}=le("Core","Block");let Jh=class{constructor(e,t,r,n,s,i,o){this.blockHelper=e,this.asymmetricHelper=t,this.blockGeneratorCalculator=r,this.keypairHelper=n,this.cryptoHelper=s,this.Buffer=i,this.moduleMap=o,this._blockFactoryCache=new Map,this.fromJSON=this.recombineBlock}getBlockFactory(e){let t=this._blockFactoryCache.get(e);return t||(t=Ht(e,this.moduleMap),this._blockFactoryCache.set(e,t)),t}getBlockFactoryFromHeight(e){const t=this.blockHelper.parseTypeByHeight(e);return this.getBlockFactoryFromBaseType(t)}getBlockFactoryFromBaseType(e){const t=Uw.KF.get(e);if(!t)throw new hA(c.INVALID_BASE_TYPE,{base_type:e});return this.getBlockFactory(t)}async generateBlock(e,t,r,n,s,i,o,a){const p=this.getBlockFactory(e);return p.verifyKeypair(s),i&&(p.verifyKeypair(i),t.generatorSecondPublicKey=Pe(i.publicKey)),t.remark=t.remark||{},await p.verifyBlockBody(t,r),await p.generateBlock(t,r,n,s,i,o,a)}async replayBlock(e,t,r,n={}){const s=this.getBlockFactoryFromHeight(e.height);return await s.verifyBlockBody(e,e.asset),await s.replayBlock(e,t,r,n)}async recombineBlock(e){return await this.getBlockFactoryFromHeight(e.height).fromJSON(e)}parseBytesToBlock(e){return Mt.decode(e)}parseBytesToSomeBlock(e,t){if(typeof t!="number"){const r=new pn(e);r.uint32(),r.uint32(),r.uint32(),t=r.uint32()}return this.getBlockModelConstructorFromHeight(t).decode(e)}getBlockModelConstructorFromHeight(e){return this.getBlockModelConstructorFromBaseType(e)}getBlockModelConstructorFromBaseType(e){const t=this.blockHelper.parseTypeByHeight(e),r=Pl.KM.get(t);if(!r)throw new hA(c.INVALID_BASE_TYPE,{base_type:t});return r}getRoundLastBlockRemarkHash(...e){return Fw("@deprecated","blockHelper.getRoundLastBlockRemarkHash"),this.blockHelper.calcChainOnChainHash(...e)}};Jh=u([ie("bfchain-core:BlockCore"),Ce(3,Z("keypairHelper")),Ce(4,Z("cryptoHelper")),Ce(5,Z("Buffer")),g("design:paramtypes",[wt,Fr,Hn,Object,Object,Object,et])],Jh);const Uw=(()=>{const e=new Map,t=new Map;return[[er.GENESIS,Ru],[er.COMMON,xu],[er.ROUNDEND,vu]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{KF:e,FK:t}})(),{ConsensusException:bn,NoFoundException:$w}=le("VERIFIER","BlockLogicVerifier");var ku;(function(e){e[e.SYNC=1]="SYNC",e[e.REBUILD=2]="REBUILD",e[e.GENERATEBLOCK=3]="GENERATEBLOCK"})(ku||(ku={}));class In{async verifyBlockBase(t,r,n){this.blockHelper.verifyBlockVersion(t,this.configHelper),r!==ku.REBUILD&&await this.isBlockAlreadyExist(t.signature,t.height),this.checkBlockTimestamp(t),t.height!==1&&await this.checkPreviousBlock(t),await this.checkSecondPublicKey(t,n)}async checkSecondPublicKey(t,r){const{height:n,generatorPublicKey:s,generatorSecondPublicKey:i,signature:o,signSignature:a}=t,p=await this.accountBaseHelper.getAddressFromPublicKeyString(s);if(!r)throw new $w(c.NOT_EXIST,{prop:`generator with address ${p}`,target:"blockChain"});if(r.secondPublicKey){if(!(i&&a))throw new bn(c.BLOCK_SIGN_SIGNATURE_IS_REQUIRED,{signature:o,generatorAddress:p,height:n});if(r.secondPublicKey!==i)throw new bn(c.BLOCK_GENERATOR_SECOND_PUBLICKEY_ALREADY_CHANGE,{signature:o,generatorAddress:p,height:n})}else{if(i)throw new bn(c.BLOCK_SHOULD_NOT_HAVE_GENERATOR_SECOND_PUBLICKEY,{signature:o,generatorAddress:p,height:n});if(a)throw new bn(c.BLOCK_SHOULD_NOT_HAVE_SIGN_SIGNATURE,{signature:o,generatorAddress:p,height:n})}}checkBlockTimestamp(t){const{timeHelper:r}=this,n=r.getTimestamp(),s=r.getSlotNumberByTimestamp(t.timestamp),i=r.getSlotNumberByTimestamp(n);s>i&&console.debug(`Block timestamp in future. Block time is ahead of the time on the server, block timestamp ${t.timestamp}, block timestamp slot ${s}, blockChain now timestamp ${n}, blockChain now timestamp slot ${i}`)}async isBlockAlreadyExist(t,r){const n=this.blockGetterHelper;if(typeof n.getCountBlock!="function")throw new bn(c.PROP_IS_INVALID,{prop:"getCountBlock",target:"blockGetterHelper"});if(await n.getCountBlock({signature:t})>0)throw new bn(c.ALREADY_EXIST,{prop:`Block with signature ${t}`,target:"blockChain",errorId:`Block already exists: ${t} height: ${r}`})}async verifyBlockWithTransactions(t,r){r!==ku.GENERATEBLOCK&&await this.blockCore.getBlockFactoryFromHeight(t.height).verify(t)}async checkPreviousBlock(t){const r=this.blockGetterHelper;if(typeof r.chainBlockFork!="function")throw new bn(c.PROP_IS_INVALID,{prop:"chainBlockFork",target:"blockGetterHelper"});const{height:n,previousBlockSignature:s,timestamp:i}=t,o=await r.getBlockByHeight(n-1);if(!o)throw new bn(c.NOT_EXIST,{prop:`Block with height ${n-1}`,target:"blockChain"});const a=o.signature;if(s!==a)throw await r.chainBlockFork(t,Gl.DIFFERENT_PRE_BLOCK_SIGNATURE),new bn(c.NOT_MATCH,{to_compare_prop:`previousBlockSignature: ${s}`,be_compare_prop:`__signature: ${a}`,to_target:`block ${n}`,be_target:`lastBlock ${o.height}`});const{timeHelper:p}=this,l=p.getSlotNumberByTimestamp(i),h=p.getNextSlotNumberByTimestamp(o.timestamp);if(l<h)throw new bn(c.PROP_SHOULD_GT_FIELD,{prop:`timestamp ${i}`,target:"block",field:`lastBlock timestamp ${o.timestamp}`})}async isValidBlockSlot(t){const{timeHelper:r,blockGeneratorCalculator:n,blockGetterHelper:s}=this,i=await this.accountBaseHelper.getAddressFromPublicKeyString(t.generatorPublicKey),o=r.getSlotNumberByTimestamp(t.timestamp),a=await s.getLastBlock(),p=await n.calcGenerateBlockGenerator({timestamp:a.timestamp,height:a.height},{toTimestamp:t.timestamp,blockGetterHelper:s});if(p.address!==i)throw new bn(c.INVALID_BLOCK_GENERATOR,{reason:`lastBlock.timestamp: ${a.timestamp} lastBlock.height: ${a.height}, block.timestamp: ${t.timestamp} curTime: ${r.getTimeByTimestamp(t.timestamp)} signature${t.signature} height: ${t.height} slot${o}${p.address}${i}`})}async checkAssetChangeHash(t,r){const n=await this.accountGetterHelper.getAccountsAssetsChange(t),s=await this.blockHelper.calcAssetChangeHash(n);if(s!==r)throw new bn(c.NOT_MATCH,{to_compare_prop:`assetChangeHash ${r}`,be_compare_prop:`assetChangeHash ${s}`,to_target:"block",be_target:"calculate"})}}u([Z(wt),g("design:type",wt)],In.prototype,"blockHelper",void 0);u([Z(Te),g("design:type",Te)],In.prototype,"accountBaseHelper",void 0);u([Z(ue),g("design:type",ue)],In.prototype,"configHelper",void 0);u([Z(Yt),g("design:type",Yt)],In.prototype,"timeHelper",void 0);u([Z(Ge),g("design:type",Ge)],In.prototype,"chainAssetInfoHelper",void 0);u([Z("bfchain-core:BlockCore"),g("design:type",Object)],In.prototype,"blockCore",void 0);u([Z(Hn),g("design:type",Hn)],In.prototype,"blockGeneratorCalculator",void 0);u([Z("transactionGetterHelper",{dynamics:!0}),g("design:type",Object)],In.prototype,"transactionGetterHelper",void 0);u([Z("blockGetterHelper",{dynamics:!0}),g("design:type",Object)],In.prototype,"blockGetterHelper",void 0);u([Z("accountGetterHelper",{dynamics:!0}),g("design:type",Object)],In.prototype,"accountGetterHelper",void 0);class Vw extends In{async verify(t,r,n){return await this.verifyBlockBase(t,r,n),!0}async verifyBlockAsset(t){await this.checkAssetChangeHash(t.height,t.asset.genesisAsset.assetChangeHash)}}class Gw extends In{async verify(t,r,n){return await this.verifyBlockBase(t,r,n),await this.checkPreviousBlock(t),await this.isValidBlockSlot(t),!0}async verifyBlockAsset(t){await this.checkAssetChangeHash(t.height,t.asset.commonAsset.assetChangeHash)}}const{ConsensusException:$c,NoFoundException:zN}=le("VERIFIER","BlockLogicVerifier");class Kw extends In{async verify(t,r,n){return await this.verifyBlockBase(t,r,n),await this.checkPreviousBlock(t),await this.isValidBlockSlot(t),!0}async verifyBlockAsset(t){const{height:r,asset:n}=t,{assetChangeHash:s,chainOnChainHash:i}=n.roundLastAsset;await this.checkAssetChangeHash(r,s),await this.checkChainOnChainHash(r,i),await this.checkNextRoundGenerators(t)}async checkChainOnChainHash(t,r){const n=await this.blockHelper.calcChainOnChainHash(t,this.blockGetterHelper);if(n!==r)throw new $c(c.NOT_MATCH,{to_compare_prop:`hashString ${n}`,be_compare_prop:`hash ${r}`,to_target:"block",be_target:"calculate"})}async checkNextRoundGenerators(t){const r=this.blockGetterHelper;if(typeof r.getNextRoundGenerators!="function")throw new $c(c.PROP_IS_INVALID,{prop:"checkNextRoundGenerators",target:"blockGetterHelper"});const n=await r.getNextRoundGenerators(await r.getLastBlock(),t.generatorPublicKey),s=t.asset.roundLastAsset.nextRoundGenerators;if(n.length!==s.length)throw new $c(c.NOT_MATCH,{to_compare_prop:`generators length ${n.length}`,be_compare_prop:`generators length ${s.length}`,to_target:"block asset",be_target:"calculate"});for(let i=0;i<n.length;i++){const o=n[i].address,a=s[i];if(a.address!==o)throw new $c(c.NOT_MATCH,{to_compare_prop:`nextRoundGenerators index ${i} address ${a.address}`,be_compare_prop:`nextRoundGenerators index ${i} address ${o}`,to_target:"block asset",be_target:"calculate"});const p=n[i].numberOfForgeEntities;if(a.numberOfForgeEntities!==p)throw new $c(c.NOT_MATCH,{to_compare_prop:`nextRoundGenerators index ${i} address ${a.address} numberOfForgeEntities ${a.numberOfForgeEntities}`,be_compare_prop:`nextRoundGenerators index ${i} address ${o} numberOfForgeEntities ${p}`,to_target:"block asset",be_target:"calculate"})}}}const{ArgumentFormatException:jw}=le("Core","BlockLogicVerifierCore");let Pd=class{constructor(e,t){this.blockHelper=e,this.moduleMap=t,this._blockLogicVerifierCache=new Map}getBlockLogicVerifier(e){let t=this._blockLogicVerifierCache.get(e);return t||(t=Ht(e,this.moduleMap),this._blockLogicVerifierCache.set(e,t)),t}getBlockLogicVerifierFromHeight(e){const t=this.blockHelper.parseTypeByHeight(e);return this.getBlockLogicVerifierFromBaseType(t)}getBlockLogicVerifierFromBaseType(e){const t=zw.KLV.get(e);if(!t)throw new jw(c.INVALID_BASE_TYPE,{base_type:e});return this.getBlockLogicVerifier(t)}};Pd=u([ie("bfchain-core:BlockLogicVerifierCore"),g("design:paramtypes",[wt,et])],Pd);const zw=(()=>{const e=new Map,t=new Map;return[[er.GENESIS,Vw],[er.COMMON,Gw],[er.ROUNDEND,Kw]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{KLV:e,LVK:t}})(),{ConsensusException:JN,NoFoundException:Aa}=le("TICKER","BlockLogicTicker");let Zr=class{async tickBlockBase(e,t=this.accountGetterHelper,r=this.blockTickGetterHelper){const n=await this.__calcForginAndHoldingRewards(e,t);await this.__updateForgingAndHoldingAccount(e,n,r)}async __getShareEntityHolders(e=this.accountGetterHelper){if(!e)throw new Aa(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});const t=await e.getShareEntityHolders();let r=0;for(const n of t)r+=n.numberOfShareEntities;return{holders:t,totalEntities:r}}async __calcForginAndHoldingRewards(e,t=this.accountGetterHelper,r=this.blockGetterHelper){if(!t)throw new Aa(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});if(!r)throw new Aa(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const{blockHelper:n}=this;let s=0,i=[],o=BigInt(0);if(n.isRoundLastBlock(e.height)&&e.reward!=="0"){const a=await this.__getShareEntityHolders(t);if(s=a.totalEntities,i=a.holders,!r.getBlocksByRange)throw new Aa(c.NOT_EXIST,{prop:"blockGetterHelper.getBlocksByRange",target:"moduleStroge"});const p=this.blockHelper.calcRoundStartHeightByHeight(e.height),l=await r.getBlocksByRange(p,e.height);for(const A of l)o+=BigInt(A.totalFee);const h=await t.getAsset(this.configHelper.magic,this.configHelper.assetType);if(!h)throw new Aa(c.NOT_EXIST,{prop:`asset(${this.configHelper.magic}-${this.configHelper.assetType})`,target:"blockChain"});const y=h.issuedAssetPrealnum-h.circulatedAssetPrealnum-BigInt(e.reward);y<o&&(o=y)}return this.blockHelper.calcForginAndHoldingRewards(e,o,s,i)}async __updateForgingAndHoldingAccount(e,t,r=this.blockTickGetterHelper){if(!r)throw new Aa(c.NOT_EXIST,{prop:"blockTickGetterHelper",target:"moduleStroge"});const{forgingRewards:n,holdingRewardsList:s,circulations:i}=t;s.length>0&&await r.updateHoldingAccount(e,s),await r.updateForgingAccount(e,n),i>BigInt(0)&&await r.accumulateCirculations(e,this.configHelper.magic,this.configHelper.assetType,i)}};u([Z(wt),g("design:type",wt)],Zr.prototype,"blockHelper",void 0);u([Z(ue),g("design:type",ue)],Zr.prototype,"configHelper",void 0);u([Z(Yt),g("design:type",Yt)],Zr.prototype,"timeHelper",void 0);u([Z(Te),g("design:type",Te)],Zr.prototype,"accountBaseHelper",void 0);u([Z(Lt),g("design:type",Lt)],Zr.prototype,"jsbiHelper",void 0);u([Z(Hn),g("design:type",Hn)],Zr.prototype,"blockGeneratorCalculator",void 0);u([Z("accountGetterHelper",{optional:!0,dynamics:!0}),g("design:type",Object)],Zr.prototype,"accountGetterHelper",void 0);u([Z("blockGetterHelper",{optional:!0,dynamics:!0}),g("design:type",Object)],Zr.prototype,"blockGetterHelper",void 0);u([Z("blockTickGetterHelper",{optional:!0,dynamics:!0}),g("design:type",Object)],Zr.prototype,"blockTickGetterHelper",void 0);Zr=u([ie()],Zr);le("CONTROLLER","BlockLogicVerifier");let kd=class extends Zr{async tick(e,t=this.accountGetterHelper,r=this.blockTickGetterHelper){await this.tickBlockBase(e,t,r)}};kd=u([ie()],kd);let Hd=class extends Zr{async tick(e,t=this.accountGetterHelper,r=this.blockTickGetterHelper){await this.tickBlockBase(e,t,r)}};Hd=u([ie()],Hd);le("TICKER","BlockLogicTicker");let Md=class extends Zr{async tick(e,t=this.accountGetterHelper,r=this.blockTickGetterHelper){await this.tickBlockBase(e,t,r)}async roundEnd(e,t,r=this.accountGetterHelper,n=this.blockTickGetterHelper){}};Md=u([ie()],Md);const{ArgumentFormatException:Jw,log:YN,warn:QN}=le("Core","BlockTicker");let Ld=class{constructor(e,t){this.blockHelper=e,this.moduleMap=t,this._blockTickerCache=new Map}getBlockTicker(e){let t=this._blockTickerCache.get(e);return t||(t=Ht(e,this.moduleMap),this._blockTickerCache.set(e,t)),t}getBlockTickerFromHeight(e){const t=this.blockHelper.parseTypeByHeight(e);return this.getBlockTickerFromBaseType(t)}getBlockTickerFromBaseType(e){const t=Yw.KT.get(e);if(!t)throw new Jw(c.INVALID_BASE_TYPE,{base_type:e});return this.getBlockTicker(t)}};Ld=u([ie("bfchain-core:BlockTickerCore"),g("design:paramtypes",[wt,et])],Ld);const Yw=(()=>{const e=new Map,t=new Map;return[[er.GENESIS,kd],[er.COMMON,Hd],[er.ROUNDEND,Md]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{KT:e,TK:t}})(),{ArgumentIllegalException:wn}=le("CONTROLLER","RegisterChainTransactionFactory");let Hu=class extends Ze{constructor(e,t,r,n,s,i,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.registerChainCertificateHelper=i,this.configMap=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new wn(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new wn(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"chain magic",...n});if(e.toMagic!==r.magic)throw new wn(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"chain magic",...n});if(!e.storage)throw new wn(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="magic")throw new wn(c.SHOULD_BE,{to_compare_prop:`key ${s.key}`,to_target:"storage",be_compare_prop:"magic",...n});const i=t.registerChain;if(!i)throw new wn(c.PARAM_LOST,{param:"registerChain"});const o={...n,target:"registerChainAsset"},a=i.genesisBlock;if(!a)throw new wn(c.PROP_IS_REQUIRE,{prop:"genesisBlock",...o});if(!this.baseHelper.isString(a))throw new wn(c.PROP_IS_INVALID,{prop:"genesisBlock",...o});const p=this.registerChainCertificateHelper.decode(a);await this.registerChainCertificateHelper.verifyRegisterChainCertificate(p);const{bnid:l,magic:h,assetType:y,chainName:A}=p.body.genesisBlockInfo;if(h===r.magic)throw new wn(c.SHOULD_NOT_BE,{to_compare_prop:`magic ${h}`,to_target:"genesisBlockJson.asset.genesisAsset",be_compare_prop:r.magic,...o});if(y===r.assetType)throw new wn(c.SHOULD_NOT_BE,{to_compare_prop:`assetType ${y}`,to_target:"genesisBlockJson.asset.genesisAsset",be_compare_prop:r.assetType,...o});if(A===r.chainName)throw new wn(c.SHOULD_NOT_BE,{to_compare_prop:`chainName ${A}`,to_target:"genesisBlockJson.asset.genesisAsset",be_compare_prop:r.chainName,...o});if(r.initials!==l)throw new wn(c.NOT_MATCH,{to_compare_prop:`initials ${r.initials}`,be_compare_prop:`bnid ${l}`,to_target:"config",be_target:"genesisBlockJson.asset.genesisBlock",...n})}init(e,t){return Ja.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){const n=new yI;n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i}=e,o=e.asset.registerChain.genesisBlock,a=this.registerChainCertificateHelper.decode(o);return n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,accountStatus:16}}),n.next=t.emit("registerChain",{type:"registerChain",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,genesisBlock:a.body.genesisBlockInfo}}),n.toPromise()}};Hu=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,eu,Dr])],Hu);const{ArgumentIllegalException:Vn}=le("CONTROLLER","MultipleTransactionFactory");let Yh=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new Vn(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Vn(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Vn(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new Vn(c.SHOULD_NOT_EXIST,{prop:"storage",...n});const s=t.multiple;if(!s)throw new Vn(c.PARAM_LOST,{param:"multiple"});const i={...n,target:"multiple"},{transactions:o}=s;if(!o)throw new Vn(c.PROP_IS_REQUIRE,{prop:"transactions",...i});if(o.length===0)throw new Vn(c.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"transactions",field:0,...i});const a=new Set,p=new Set,l=new Set,{GRAB_ANY:h,GRAB_ASSET:y,SIGN_FOR_ASSET:A,MULTIPLE:_,PROMISE_RESOLVE:E,MACRO_CALL:T}=this.transactionHelper,w=C=>{if(a.has(C.signature))throw new Vn(c.SHOULD_NOT_DUPLICATE,{prop:`transactions ${C.signature}`,...i});switch(C.type){case y:{const N=`${C.senderId}-${C.storageValue}`;if(p.has(N))throw new Vn(c.SHOULD_NOT_DUPLICATE,{prop:`transactions ${N}`,...i});p.add(N);break}case h:{const N=`${C.senderId}-${C.storageValue}`;if(p.has(N))throw new Vn(c.SHOULD_NOT_DUPLICATE,{prop:`transactions ${N}`,...i});p.add(N);break}case A:{const N=`${C.senderId}-${C.storageValue}`;if(l.has(N))throw new Vn(c.SHOULD_NOT_DUPLICATE,{prop:`transactions ${N}`,...i});l.add(N);break}case _:{const N=C.asset.multiple.transactions;for(const L of N)w(L);break}case E:{w(C.asset.resolve.transaction);break}case T:{w(C.asset.call.transaction);break}}a.add(C.signature)};for(const C of o){w(C);const N=this.transactionCore.getTransactionFactoryFromType(C.type),L=await N.fromJSON(C);await N.verify(L)}}init(e,t){return Qa.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r)})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Yh.prototype,"transactionCore",void 0);Yh=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],Yh);const{ArgumentIllegalException:Ea}=le("CONTROLLER","PromiseTransactionFactory");let Qh=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new Ea(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Ea(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Ea(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new Ea(c.SHOULD_NOT_EXIST,{prop:"storage",...n});const s=t.promise;if(!s)throw new Ea(c.PARAM_LOST,{param:"promise"});const i={...n,target:"promise"},{transaction:o}=s;if(!o)throw new Ea(c.PROP_IS_REQUIRE,{prop:"transaction",...i});const a=this.transactionCore.getTransactionFactoryFromType(o.type),p=await a.fromJSON(o);await a.verify(p)}init(e,t){return Ro.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r)})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Qh.prototype,"transactionCore",void 0);Qh=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],Qh);const{ArgumentIllegalException:ys}=le("CONTROLLER","PromiseResolveTransactionFactory");let Xh=class extends Ze{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new ys(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ys(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ys(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new ys(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="promiseId")throw new ys(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"promiseId",...n});const i=t.resolve;if(!i)throw new ys(c.PARAM_LOST,{param:"resolve"});const o={...n,target:"resolve"},{promiseId:a,transaction:p}=i;if(!a)throw new ys(c.PROP_IS_REQUIRE,{prop:"promiseId",...o});if(this.baseHelper.isValidSignature(a)===!1)throw new ys(c.PROP_IS_INVALID,{prop:`promiseId ${a}`,...o});if(!p)throw new ys(c.PROP_IS_REQUIRE,{prop:"transaction",...o});const l=await this.transactionCore.recombineTransaction(p);if(await this.transactionCore.getTransactionFactoryFromType(l.type).verify(l),s.value!==a)throw new ys(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`promiseId ${a}`,to_target:"storage",be_target:"resolve",...n})}init(e,t){return Wa.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r),n.next=t.emit("promiseResolve",{type:"promiseResolve",transaction:e,applyInfo:{promiseId:e.asset.resolve.promiseId,recipientId:e.recipientId}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Xh.prototype,"transactionCore",void 0);Xh=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge])],Xh);const{ArgumentIllegalException:At}=le("CONTROLLER","MacrotionFactory");let Wh=class extends Ze{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new At(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new At(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new At(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new At(c.SHOULD_NOT_EXIST,{prop:"storage",...n});const s=t.macro;if(!s)throw new At(c.PARAM_LOST,{param:"macro"});const i={...n,target:"macro"},{inputs:o,template:a}=s,p=a instanceof rt?a.toJSON():a;if(!o)throw new At(c.PROP_IS_REQUIRE,{prop:"inputs",...i});if(!p)throw new At(c.PROP_IS_REQUIRE,{prop:"template",...i});const l=this.transactionCore.getTransactionFactoryFromType(p.type),h=await l.fromJSON(p);await l.verify(h);const y=this.baseHelper,A=new Set,_=new Set;for(const E of o){const{type:T,name:w,keyPath:C,pattern:N}=E;if(!w)throw new At(c.PROP_IS_REQUIRE,{prop:"name",target:`macro.inputs.input ${JSON.stringify(E)}`});if(N)try{new RegExp(N)}catch{throw new At(c.PROP_IS_INVALID,{prop:"pattern",target:`macro.inputs.input ${JSON.stringify(E)}`})}if(y.isValidMacroInputName(w)===!1)throw new At(c.PROP_IS_REQUIRE,{prop:"name",target:`macro.inputs.input ${JSON.stringify(E)}`});if(A.has(w))throw new At(c.SHOULD_NOT_DUPLICATE,{prop:`name ${w}`,target:`macro.inputs.input ${JSON.stringify(E)}`});if(A.add(w),!C)throw new At(c.PROP_IS_REQUIRE,{prop:"keyPath",target:`macro.inputs.input ${JSON.stringify(E)}`});if(_.has(C))throw new At(c.SHOULD_NOT_DUPLICATE,{prop:`keyPath ${C}`,target:`macro.inputs.input ${JSON.stringify(E)}`});if(_.add(C),!T)throw new At(c.PROP_IS_REQUIRE,{prop:"type",target:`macro.inputs.input ${JSON.stringify(E)}`});if(C.includes(".")){let L=p;const B=C.split("."),$=B.pop();for(const V of B){if(L.hasOwnProperty(V)===!1)throw new At(c.NOT_EXIST,{prop:`keyPath ${C}`,target:"macro.template"});L=L[V]}if(L.hasOwnProperty($)===!1)throw new At(c.NOT_EXIST,{prop:`keyPath ${C}`,target:"macro.template"})}else if(p.hasOwnProperty(C)===!1)throw new At(c.NOT_EXIST,{prop:`keyPath ${C}`,target:"macro.template"});if(T===zt.NUMBER||T===zt.CALC){const{base:L,min:B,max:$,step:V,format:G}=E;if(G===void 0)throw new At(c.PROP_IS_REQUIRE,{prop:"format",target:`macro.inputs.input ${JSON.stringify(E)}`});if(G!==qa.LITERAL&&G!==qa.STRING)throw new At(c.PROP_IS_INVALID,{prop:`format ${G}`,target:`macro.inputs.input ${JSON.stringify(E)}`});if(L&&y.isPositiveBigFloatContainZero(L)===!1)throw new At(c.PROP_IS_INVALID,{prop:"base",target:`macro.inputs.input ${JSON.stringify(E)}`});if(B&&y.isPositiveBigFloatContainZero(B)===!1)throw new At(c.PROP_IS_INVALID,{prop:"min",target:`macro.inputs.input ${JSON.stringify(E)}`});if($){if(y.isPositiveBigFloatContainZero($)===!1)throw new At(c.PROP_IS_INVALID,{prop:"max",target:`macro.inputs.input ${JSON.stringify(E)}`});if(L&&this.jsbiHelper.compareFraction($,L)===-1)throw new At(c.PROP_SHOULD_LTE_FIELD,{prop:"base",target:`macro.inputs.input ${JSON.stringify(E)}`,field:JSON.stringify($)})}if(V){if(y.isPositiveBigFloatContainZero(V)===!1)throw new At(c.PROP_IS_INVALID,{prop:"step",target:`macro.inputs.input ${JSON.stringify(E)}`});if(this.jsbiHelper.compareFraction(V,{numerator:"0",denominator:"1"})<1)throw new At(c.PROP_SHOULD_GT_FIELD,{prop:"step",target:`macro.inputs.input ${JSON.stringify(E)}`,field:"0"})}if(T===zt.CALC){const{calc:Y}=E;if(Y===void 0)throw new At(c.PROP_IS_REQUIRE,{prop:"calc",target:`macro.inputs.input ${JSON.stringify(E)}`})}}else if(!(T===zt.TEXT||T===zt.ADDRESS||T===zt.PUBLICKEY||T===zt.SIGNATURE))throw new At(c.PROP_IS_INVALID,{prop:`type ${T}`,target:`macro.inputs.input ${JSON.stringify(E)}`})}}init(e,t){return Po.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r)})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],Wh.prototype,"transactionCore",void 0);Wh=u([ie(),g("design:paramtypes",[Te,we,Le,ue,Ge,Lt])],Wh);const{ArgumentIllegalException:vt}=le("CONTROLLER","MacroCallTransactionFactory");let qh=class extends Ze{constructor(e,t,r,n,s,i,o){super(),this.accountBaseHelper=e,this.asymmetricHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=i,this.jsbiHelper=o}trySet(e,t,r){let n;if(t.includes(".")){const s=t.split(".");n=s.pop();for(const i of s){if(e.hasOwnProperty(i)===!1)return!1;e=e[i]}}else n=t;return e.hasOwnProperty(n)===!1?!1:(e[n]=r,!0)}parseToMacroCallInputs(e){return Object.fromEntries(Object.entries(e).map(t=>[t[0],JSON.stringify(t[1])]))}async generateTransactionWithJsonInput(e,t,r,n=!0){return await this.generateTransaction(e,t,this.parseToMacroCallInputs(r),n)}async generateTransaction(e,t,r,n=!0){const s=new LE(r),i=this.baseHelper,o=e.toJSON();for(const p of t){const{name:l,pattern:h,repeat:y}=p;let A=s.get(l);const _=async E=>{if(typeof E!="string")throw new vt(c.PROP_IS_INVALID,{prop:`${p.name} ${E}`,target:"inputs"});if(h&&new RegExp(h).test(E)===!1)throw new vt(c.NOT_MATCH,{to_compare_prop:`${l} ${E}`,to_target:"inputs",be_compare_prop:`pattern ${h}`,be_target:"defineInput"});switch(p.type){case zt.ADDRESS:if(await this.accountBaseHelper.isAddress(E)===!1)throw new vt(c.NOT_MATCH,{to_compare_prop:`${l} ${E}`,to_target:"inputs",be_compare_prop:"pattern chain address",be_target:"defineInput"});break;case zt.PUBLICKEY:if(this.baseHelper.isValidPublicKey(E)===!1)throw new vt(c.NOT_MATCH,{to_compare_prop:`${l} ${E}`,to_target:"inputs",be_compare_prop:"pattern chain publicKey",be_target:"defineInput"});break;case zt.SIGNATURE:if(this.transactionHelper.isValidTransactionSignature(E)===!1)throw new vt(c.NOT_MATCH,{to_compare_prop:`${l} ${E}`,to_target:"inputs",be_compare_prop:"pattern chain signature",be_target:"defineInput"});break;case zt.TEXT:break;case zt.CALC:E=hI(p.calc,s.toObject());case zt.NUMBER:{if(E.includes(".")){const L=E.split(".");if(BigInt(L[1])===BigInt(0))throw new vt(c.SHOULD_BE,{to_compare_prop:`name ${l}(${E})`,to_target:"inputs",be_compare_prop:L[0]})}const T=p.base||{numerator:"0",denominator:"1"};let w=this.jsbiHelper.toFraction(E);if(p.min&&this.jsbiHelper.compareFraction(p.min,w)===1)throw new vt(c.PROP_SHOULD_GTE_FIELD,{prop:`name ${l} ${E}`,target:"inputs",field:JSON.stringify(p.min)});if(p.max&&this.jsbiHelper.compareFraction(p.max,w)===-1)throw new vt(c.PROP_SHOULD_LTE_FIELD,{prop:`name ${l} ${E}`,target:"inputs",field:JSON.stringify(p.max)});w=this.jsbiHelper.minusFraction(w,T);const C=p.step||{numerator:"1",denominator:"1"},N=this.jsbiHelper.divisionFractionAndCeil(w,C);if(this.jsbiHelper.compareFraction(w,this.jsbiHelper.multiplyFraction({numerator:N,denominator:BigInt(1)},C))!==0)throw new vt(c.SHOULD_BE,{to_compare_prop:`name ${l}(${E})'s step`,to_target:"inputs",be_compare_prop:JSON.stringify(p.step)});p.format===qa.LITERAL&&(E=Number(E));break}}return E};if(y){if(i.isArray(A)===!1)throw new vt(c.PROP_IS_INVALID,{prop:`${p.name}(repeat ${y}) ${A}`,target:"inputs"});const E=[];for(const T of A)E.push(await _(T));if(this.trySet(o,p.keyPath,E)===!1)throw new vt(c.PROP_IS_INVALID,{prop:`name ${l}`,target:"inputs"})}else{const E=await _(A);if(this.trySet(o,p.keyPath,E)===!1)throw new vt(c.PROP_IS_INVALID,{prop:`name ${l}`,target:"inputs"})}}const a=await this.transactionCore.recombineTransaction(o);for(const p of t)if(p.type===zt.NUMBER){const l=p.keyPath.split(".");let h=o,y=a;for(const A of l)h=h[A],y=y[A];if(h.toString()!==y.toString())throw new vt(c.PROP_IS_INVALID,{prop:`${p.name} ${h}`,target:"inputs"})}return n===!1&&await this.transactionCore.getTransactionFactoryFromType(a.type).verify(a,this.configHelper),a}async signTransaction(e,t,r){const n=await this.transactionCore.recombineTransaction(e.toJSON()),{accountBaseHelper:s,asymmetricHelper:i}=this,o=await s.createSecretKeypair(t);n.signatureBuffer=await i.detachedSign(n.getBytes(!0,!0),o.secretKey);let a;return r&&(a=await s.createSecondSecretKeypair(t,r),n.signSignatureBuffer=await i.detachedSign(n.getBytes(!1,!0),a.secretKey),await this.transactionHelper.verifyTransactionSignature(n)),n}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new vt(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new vt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new vt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new vt(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="macroId")throw new vt(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"macroId",...n});const i=t.call;if(!i)throw new vt(c.PARAM_LOST,{param:"call"});const o={...n,target:"call"},{macroId:a,inputs:p,transaction:l}=i;if(!a)throw new vt(c.PROP_IS_REQUIRE,{prop:"macroId",...o});if(!this.baseHelper.isValidSignature(a))throw new vt(c.PROP_IS_INVALID,{prop:`macroId ${a}`,type:"transaction signature",...o});if(!p)throw new vt(c.PROP_IS_REQUIRE,{prop:"inputs",...o});if(!l)throw new vt(c.PROP_IS_REQUIRE,{prop:"transaction",...o});const h=await this.transactionCore.recombineTransaction(l);if(await this.transactionCore.getTransactionFactoryFromType(h.type).verify(h),s.value!==a)throw new vt(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`macroId ${a}`,to_target:"storage",be_target:"call",...n})}init(e,t){return ec.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Qe(n=>{n.next=super.applyTransaction(e,t,r);const{macroId:s,inputs:i}=e.asset.call;n.next=t.emit("macroCall",{type:"macroCall",transaction:e,applyInfo:{macroId:s,inputs:i}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};u([Z("bfchain-core:TransactionCore",{dynamics:!0}),g("design:type",Qt)],qh.prototype,"transactionCore",void 0);qh=u([ie(),g("design:paramtypes",[Te,Fr,we,Le,ue,Ge,Lt])],qh);Kr.VF.set(W.REGISTER_CHAIN,Hu);Kr.FV.set(Hu,W.REGISTER_CHAIN);Kr.VF.set(W.MULTIPLE,Yh);Kr.FV.set(Yh,W.MULTIPLE);Kr.VF.set(W.PROMISE,Qh);Kr.FV.set(Qh,W.PROMISE);Kr.VF.set(W.PROMISE_RESOLVE,Xh);Kr.FV.set(Xh,W.PROMISE_RESOLVE);Kr.VF.set(W.MACRO,Wh);Kr.FV.set(Wh,W.MACRO);Kr.VF.set(W.MACRO_CALL,qh);Kr.FV.set(qh,W.MACRO_CALL);class Kg extends nr{constructor(){super(),this._startTime=Date.now(),this._sleepTime=0,this.onFinished(()=>this.clearTimeout())}get sleepTime(){return this._sleepTime}get endTime(){return this._startTime+this._sleepTime}setTimeout(t,r){this.clearTimeout(),this._startTime=Date.now(),this._sleepTi=Ks(this._sleepTime=t,r)}clearTimeout(){this._sleepTi&&(dI(this._sleepTi),this._sleepTime=0,this._sleepTi=void 0)}}var Ti,lA,uA,gA;const{ArgumentIllegalException:Ae,ArgumentFormatException:Dt,TimeOutException:Qw}=le("channel","chainChannelHelper");let Ye=Ti=class{constructor(e,t,r,n,s){this.baseHelper=e,this.transctionHelper=t,this.blockHelper=r,this.timeHelper=n,this.accountBaseHelper=s}async boxQueryTransactionArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=ko.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(V){throw new Dt(c.INVALID_PARAMS,{error:V,params:e})}const r=this.baseHelper,{type:n,types:s,signature:i,senderId:o,recipientId:a,dappid:p,lns:l,storage:h,blockSignature:y,minHeight:A,maxHeight:_,trusteeId:E,purchaseDAppid:T,range:w,offset:C,limit:N,address:L}=t.query;let B=!1;if(n&&(B=!0,!r.isValidTransactionType(n)))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`type ${n}`});if(s){B=!0;for(const V of s)if(!r.isValidTransactionType(V))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`types.type ${V}`})}if(i&&(B=!0,i.length!==Ti.MAX_SIGNATURE_LENGTH))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`signature ${i}`});if(o&&(B=!0,o.length>Ti.MAX_ADDRESS_LENGTH))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`senderId ${o}`});if(a&&(B=!0,a.length>Ti.MAX_ADDRESS_LENGTH))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`recipientId ${a}`});if(L&&(B=!0,L.length>Ti.MAX_ADDRESS_LENGTH))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`address ${L}`});if(p&&(B=!0,!r.isValidDAppId(p)))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`dappid ${p}`});if(l&&(B=!0,!r.isValidLocationName(l)))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`lns ${l}`});if(h){if(B=!0,!(h.key&&h.key.length))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`storage.key ${h.key}`});if(!(h.value&&h.value.length))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`storage.value ${h.value}`})}if(y&&(B=!0,y.length!==Ti.MAX_SIGNATURE_LENGTH))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`blockSignature ${y}`});if(A!==void 0&&(B=!0,!r.isUint32(A)))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`minHeight ${A}`});if(_!==void 0&&(B=!0,!r.isUint32(_)))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`maxHeight ${_}`});if(E&&(B=!0,E.length>Ti.MAX_ADDRESS_LENGTH))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`trusteeId ${E}`});if(T&&(B=!0,!r.isValidDAppId(T)))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`purchaseDAppid ${T}`});if(w&&(B=!0,!r.isString(w)))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`range ${w}`});if(B===!1)throw new Ae("Invalid QueryTransaction query params, no query conditions");if(!r.isUint32(C))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`offset ${C}`});if(N&&!r.isUint32(N))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`limit ${N}`});const{tIndex:$}=t.sort;if($!==void 0&&$!==-1&&$!==1)throw new Ae(c.INVALID_PARAMS_FIELD,{field:`tIndex ${$}`});return t}async boxQueryTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=sc.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Dt(c.INVALID_PARAMS,{error:r,params:e})}if(t.status===ve.success){const{transactions:r}=t;for(const n of r)await this.transctionHelper.verifyTransactionSignature(n.transaction,{taskLabel:"QueryTransactionReturn"})}return t}get boxIndexTransactionArg(){return this.boxQueryTransactionArg}async boxIndexTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=ac.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Dt(c.INVALID_PARAMS,{error:r,params:e})}return t}async boxDownloadTransactionArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=Lh.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(s){throw s instanceof ot?s:new Dt(c.INVALID_PARAMS,{error:s,params:e})}const{tIndexes:r}=t;if(r.length===0)throw new Ae("Invalid Download transaction query params, no query conditions");const n=this.baseHelper;for(const s of r){const{height:i,tIndex:o,length:a}=s;if(!n.isPositiveInteger(i))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`height ${i}`});if(!n.isNaturalNumber(o))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`tIndex ${o}`});if(!n.isPositiveInteger(a))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`length ${a}`})}return t}async boxDownloadTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=cc.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Dt(c.INVALID_PARAMS,{error:r,params:e})}if(t.status===ve.success){const{transactions:r}=t;for(const n of r)await this.transctionHelper.verifyTransactionSignature(n.transaction,{taskLabel:"DownloadTransactionReturn"})}return t}async boxNewTransactionArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=Hh.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw n instanceof ot?n:new Dt(c.INVALID_PARAMS,{error:n,params:e})}const{transaction:r}=t;return await this.transctionHelper.verifyTransactionSignature(r,{taskLabel:"NewTransactionArg"}),t}boxNewTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=xs.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Dt(c.INVALID_PARAMS,{error:r,params:e})}if(t.status===ve.success&&(Number.isNaN(parseFloat(t.minFee))||BigInt(t.minFee)<BigInt(0)))throw new Ae(c.INVALID_PARAMS_FIELD,{field:"minFee"});return t}async boxOpenBlobArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=Vi.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw n instanceof ot?n:new Dt(c.INVALID_PARAMS,{error:n,params:e})}const{hash:r}=t;if(r===void 0||r.length!==64)throw new Ae("Invalid Open Blob query params, wrong sha256 value");return t}async boxOpenBlobReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=Gi.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Dt(c.INVALID_PARAMS,{error:r,params:e})}return t}async boxCloseBlobArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=pc.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw r instanceof ot?r:new Dt(c.INVALID_PARAMS,{error:r,params:e})}return t}async boxCloseBlobReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=Dh.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Dt(c.INVALID_PARAMS,{error:r,params:e})}return t}async boxReadBlobArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=ri.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(s){throw s instanceof ot?s:new Dt(c.INVALID_PARAMS,{error:s,params:e})}const{start:r,end:n}=t;if(r<0||r>=n)throw new Ae("Invalid Read Blob range");return t}async boxReadBlobReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=Mo.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Dt(c.INVALID_PARAMS,{error:r,params:e})}return t}boxQueryBlockArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=hc.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(o){throw new Dt(c.INVALID_PARAMS,{error:o,params:e})}const r=this.baseHelper,{height:n,signature:s}=t.query;let i=!1;if(n&&(i=!0,!r.isUint32(n)))throw new Ae(c.INVALID_PARAMS_FIELD,{field:"height"});if(s&&(i=!0,!r.isValidBlockSignature(s)))throw new Ae(c.INVALID_PARAMS_FIELD,{field:"signature"});if(i===!1)throw new Ae(c.INVALID_QUERYBLOCKARG_QUERY_PARAMS);return t}async boxQueryBlockReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=lc.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw new Dt(c.INVALID_PARAMS,{error:n,params:e})}const{someBlock:r}=t;return t.status===ve.success&&r&&await this.blockHelper.verifyBlockSignature(r.block,{taskLabel:"QueryBlockReturn"}),t}boxNewBlockArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});let t;try{t=qr.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw new Dt(c.INVALID_PARAMS,{error:n,params:e})}const r=this.baseHelper;if(!r.isUint32(t.height))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`height ${t.height}`});if(!r.isValidBlockSignature(t.signature))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`signature ${t.signature}`});if(!r.isValidBlockSignature(t.previousBlockSignature))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`previousBlockSignature ${t.previousBlockSignature}`});if(!r.isFiniteBigInt(t.totalFee))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`totalFee ${t.totalFee}`});if(!r.isUint32(t.numberOfTransactions))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`numberOfTransactions ${t.numberOfTransactions}`});if(!r.isUint32(t.timestamp))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`timestamp ${t.timestamp}`});if(!r.isValidPublicKey(t.generatorPublicKeyBuffer))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`generatorPublicKey ${t.generatorPublicKey}`});if(!r.isUint32(t.version))throw new Ae(c.INVALID_PARAMS_FIELD,{field:`version ${t.version}`});return t}boxNewBlockReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});try{return uc.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(t){throw new Dt(c.INVALID_PARAMS,{error:t,params:e})}}boxGetPeerInfoArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});try{return Fh.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(t){throw new Dt(c.INVALID_PARAMS,{error:t,params:e})}}boxGetPeerInfoReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{params:e});try{return gc.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(t){throw new Dt(c.INVALID_PARAMS,{error:t,params:e})}}async boxQueryTindexArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{function:"boxQueryTindexArg",params:e});let t;try{t=Ph.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch($){throw new Dt(c.INVALID_PARAMS,{function:"boxQueryTindexArg",error:$,params:e})}const r=this.baseHelper,{type:n,signature:s,senderId:i,recipientId:o,dappid:a,lns:p,storage:l,blockSignature:h,minHeight:y,maxHeight:A,trusteeId:_,purchaseDAppid:E,range:T,address:w,offset:C,limit:N}=t.query;let L=!1;if(n&&(L=!0,!r.isValidTransactionType(n)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg",field:`type ${n}`});if(s&&(L=!0,!r.isValidTransactionSignature(s)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`signature ${s}`});if(i&&(L=!0,!await this.accountBaseHelper.isAddress(i)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`senderId ${i}`});if(o&&(L=!0,!await this.accountBaseHelper.isAddress(o)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`recipientId ${o}`});if(a&&(L=!0,!r.isValidDAppId(a)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`dappid ${a}`});if(p&&(L=!0,!r.isValidLocationName(p)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`lns ${p}`});if(l){if(L=!0,!(l.key&&l.key.length))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`storage.key ${l.key}`});if(!(l.value&&l.value.length))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`storage.value ${l.value}`})}if(h&&(L=!0,!r.isValidBlockSignature(h)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`blockSignature ${h}`});if(y!==void 0&&(L=!0,!r.isUint32(y)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`minHeight ${y}`});if(A!==void 0&&(L=!0,!r.isUint32(A)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`maxHeight ${A}`});if(_&&(L=!0,!await this.accountBaseHelper.isAddress(_)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`trusteeId ${_}`});if(E&&(L=!0,!r.isValidDAppId(E)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`purchaseDAppid ${E}`});if(T&&(L=!0,!r.isString(T)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`range ${T}`});if(w&&(L=!0,!await this.accountBaseHelper.isAddress(w)))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`address ${w}`});if(L===!1)throw new Ae("Invalid QueryTransaction query params, no query conditions");if(!r.isUint32(C))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`offset ${C}`});if(N&&!r.isUint32(N))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`limit ${N}`});const{tIndex:B}=t.sort;if(B!==void 0&&B!==-1&&B!==1)throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.sort",field:`tIndex ${B}`});return t}async boxQueryTindexReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{function:"boxQueryTindexesReturn",params:e});let t;try{t=ic.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Dt(c.INVALID_PARAMS,{function:"boxQueryTindexesReturn",error:r,params:e})}if(t.status===ve.success){const r=t.tIndexes,n=this.baseHelper;for(const s of r)if(!n.isNaturalNumber(s))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexesReturn",field:`tIndexes ${s}`})}return t}async boxGetTransactionInBlockArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{function:"boxGetTransactionInBlockArg",params:e});let t;try{t=kh.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Dt(c.INVALID_PARAMS,{function:"boxGetTransactionInBlockArg",error:r,params:e})}if(!this.baseHelper.isValidTindexRanges(t.query.tIndexRanges))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"boxGetTransactionInBlockArg.query.tIndexRanges",field:`tIndexRanges ${t.query.tIndexRanges}`});return t}async boxGetTransactionInBlockReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new Ae(c.INVALID_PARAMS,{function:"boxGetTransactionInBlockReturn",params:e});let t;try{t=oc.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Dt(c.INVALID_PARAMS,{function:"boxGetTransactionInBlockReturn",error:r,params:e})}if(t.status===ve.success){const{transactionInBlocks:r}=t;r.forEach(async n=>{await this.transctionHelper.verifyTransactionSignature(n.transaction,{taskLabel:"GetTransactionInBlockReturn"})})}return t}parserAborterOptions(e,t){if(e.disabledAborterOptions)return;let r;e.aborter&&(r||(r=new Kg),this._bindRejectedToPromiseOut(e.aborter.abortedPromise,r));let n;if(e.timeout!==void 0&&(n=typeof e.timeout=="function"?e.timeout(t):e.timeout),e.deadlineTime!==void 0){const s=this.timeHelper.now(),i=e.deadlineTime-s;n?i<n&&(n=i):n=i}if(n!==void 0){const{reject:s}=r||(r=new Kg);r.setTimeout(n,()=>s(typeof e.timeoutException=="function"?e.timeoutException(t):e.timeoutException||new Qw))}return e.rejected&&(r||(r=new Kg),this._bindRejectedToPromiseOut(e.rejected,r)),r}_bindRejectedToPromiseOut(e,t){go(e,void 0,t.reject),t.onFinished(()=>Hl(e,void 0,t.reject))}wrapAborterOptions(e,t,r){const n=t&&this.parserAborterOptions(t,r);return n&&(e.then(n.resolve,n.reject),e=n.promise),e}wrapOutAborterOptions(e,t,r){const n=t&&this.parserAborterOptions(t,r);return n&&(go(e.promise,n.resolve,n.reject),go(n.promise,e.resolve,e.reject),e=n),e}getChainChannelTimeout(e,t=3e4){return Math.max(Number.isFinite(e.delay)?e.delay:1e3,2e3)+t}verifyDownloadBlobArgs(e){const{algorithm:t,hash:r,downloadSize:n}=e;if(!Number.isInteger(n))throw new Ae(c.INVALID_PARAMS_FIELD,{function:"openArg.downloadSize",field:`openArg.downloadSize ${n}`});if(n<=0)throw new Ae(c.INVALID_PARAMS_FIELD,{function:"openArg.downloadSize",field:`openArg.downloadSize ${n}`})}};Ye.MAX_ADDRESS_LENGTH=40;Ye.MAX_SIGNATURE_LENGTH=128;u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxQueryTransactionArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxQueryTransactionReturn",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],Ye.prototype,"boxIndexTransactionArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxIndexTransactionReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxDownloadTransactionReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxNewTransactionArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",void 0)],Ye.prototype,"boxNewTransactionReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxOpenBlobArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxOpenBlobReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxCloseBlobArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxCloseBlobReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxReadBlobArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxReadBlobReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",hc)],Ye.prototype,"boxQueryBlockArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxQueryBlockReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",qr)],Ye.prototype,"boxNewBlockArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",uc)],Ye.prototype,"boxNewBlockReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Fh)],Ye.prototype,"boxGetPeerInfoArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",gc)],Ye.prototype,"boxGetPeerInfoReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxQueryTindexArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxQueryTindexReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxGetTransactionInBlockArg",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",Promise)],Ye.prototype,"boxGetTransactionInBlockReturn",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object,typeof(lA=typeof ENV<"u"&&ENV)=="function"?lA:Object]),g("design:returntype",void 0)],Ye.prototype,"parserAborterOptions",null);u([Je,g("design:type",Function),g("design:paramtypes",[Promise,Object,typeof(uA=typeof ENV<"u"&&ENV)=="function"?uA:Object]),g("design:returntype",void 0)],Ye.prototype,"wrapAborterOptions",null);u([Je,g("design:type",Function),g("design:paramtypes",[nr,Object,typeof(gA=typeof ENV<"u"&&ENV)=="function"?gA:Object]),g("design:returntype",void 0)],Ye.prototype,"wrapOutAborterOptions",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object,Object]),g("design:returntype",void 0)],Ye.prototype,"getChainChannelTimeout",null);Ye=Ti=u([ie(),g("design:paramtypes",[Le,we,wt,Yt,Te])],Ye);const{RefuseException:Yr,ArgumentFormatException:fA,NoFoundException:wI,error:Xw,TimeOutException:Dd,success:dA,log:yA}=le("channel","chainChannel");class SI extends gI{toBlockGetterHelper(t){return this._blockGetterHelper||(this._blockGetterHelper={getBlockByHeight:r=>this.findBlock({height:r}),getBlockBySignature:r=>this.findBlock({signature:r}),maxHeight:1,lastBlock:xo.fromObject(this.config.genesisBlock),async getLastBlock(){if(this.lastBlock.height!==this.maxHeight){const r=await this.getBlockByHeight(this.maxHeight);if(!r)throw new wI;this.lastBlock=r}return this.lastBlock}}),t&&(this.baseHelper.isPositiveFloatNotContainZero(t.maxHeight)&&(this._blockGetterHelper.maxHeight=t.maxHeight),t.lastBlock&&(this._blockGetterHelper.lastBlock=t.lastBlock)),this._blockGetterHelper}}const $s=new Map,mA=new Uint32Array(1),Ww=()=>{const e=mA[0]++||mA[0]++,t=$s.get(e);return t&&(t.reject(new Dd(c.REQID_REUSE)),$s.delete(e)),e},Vc=new Map([[Se.QUERY_TRANSACTION,Se.QUERY_TRANSACTION_RETURN],[Se.INDEX_TRANSACTION,Se.INDEX_TRANSACTION_RETURN],[Se.DOWNLOAD_TRANSACTION,Se.DOWNLOAD_TRANSACTION_RETURN],[Se.NEW_TRANSACTION,Se.NEW_TRANSACTION_RETURN],[Se.QUERY_BLOCK,Se.QUERY_BLOCK_RETURN],[Se.NEW_BLOCK,Se.NEW_BLOCK_RETURN],[Se.GET_PEER_INFO,Se.GET_PEER_INFO_RETURN],[Se.OPEN_BLOB,Se.OPEN_BLOB_RETURN],[Se.READ_BLOB,Se.READ_BLOB_RETURN],[Se.CLOSE_BLOB,Se.CLOSE_BLOB_RETURN]]),qw=2;let oi=class extends SI{constructor(e,t=1e3){super(),this.endpoint=e,this.refuseTime=t,this._canQueryTindex=!1,this._canGetTransactionInBlock=!1,this._limitQT=100,this._limitIT=100,this._limitDT=100,this.MESSAGE_VERSION=2,this._closed=!1,this._maybeHeight=1,this._lastConsensusVersion=1,this._address="",this._delayHistroyList=new Float32Array(32),this._reqIdSet=new Set,this.reqresLimitInfoEM=kt.from({creater(r){return{preResponseTime:0,preRefuseTime:0,preResponseLimitConfig:{lockTimespan:0,refuseTimespan:1/0}}}}),this._msgPostQuene=kt.from({creater:r=>{const n={taskList:[],running:!1,looper:async()=>{if(!n.running){n.running=!0;do{const s=n.taskList.shift();if(s===void 0)break;const i=this.reqresLimitInfoEM.get(r);if(i!==void 0){const p=i.preResponseTime+i.preResponseLimitConfig.lockTimespan-this.timeHelper.now();p>0&&(yA("req chainChannel(%s) cmd:%d need wait %dms",this.address,s.cmd,p),await Ks(p))}if(s.sign.is_rejected)continue;const o=ln.fromObject({version:this.config.version,req_id:s.req_id,cmd:s.cmd,binary:s.binary,messageVersion:this.MESSAGE_VERSION});this.endpoint.postMessage(o.getBytes()),s.sign.resolve();const a=$s.get(s.req_id);a&&await new Promise(p=>a.onFinished(p))}while(n.taskList.length>0);this._msgPostQuene.delete(r)}}};return n}}),this._openedBlobs=new Set,this._busyNewTransaction=0,this.initOnMessage(),e.onClose(()=>{this._closed=!0;for(const r of this._reqIdSet){const n=$s.get(r);n&&(n.reject(new Dd(c.CHAINCHANNEL_CLOSED)),$s.delete(r))}this._reqIdSet.clear()})}get canQueryTransactions(){return!1}get canIndexTransactions(){return!1}get canDownloadTransactions(){return!0}get blobSupportAlgorithms(){return[]}get canQueryBlock(){return!0}get canBroadcastTransaction(){return!0}get canBroadcastBlock(){return!0}get canQueryTindex(){return this._canQueryTindex}get canGetTransactionInBlock(){return this._canGetTransactionInBlock}get limitQueryTransactions(){return this._limitQT}get limitIndexTransactions(){return this._limitIT}get limitDownloadTransactions(){return this._limitDT}get defaultReqOptions(){}get diffTime(){return 0}onClose(e,t){if(t){const r=this.endpoint.onClose(n=>{e(n),r()});return r}else return this.endpoint.onClose(e)}close(e){return this.endpoint.close(e)}get maybeHeight(){return this._maybeHeight}get lastConsensusVersion(){return this._lastConsensusVersion}get address(){return this._address}set address(e){this._address=e}get delay(){if(this._delayCache)return this._delayCache.value;const{_delayHistroyList:e}=this;let t=0,r=e.length;for(let s=0;s<e.length;s+=1){const i=e[s];i?t+=i:r-=1}const n=t/r||0;return this._delayCache={value:n},n}pushDelayHistroy(e){const{_delayHistroyList:t}=this,r=t.length;t.set(t.subarray(1,r),0),t[r-1]=e,this._delayCache=void 0}_request(e,t,r,n){return this._requestWithBinaryData(e,this._requestDataToBinary(t),r,n)}_requestDataToBinary(e){return new Uint8Array(e.constructor.encode(e).finish())}_sendWithBinaryData(e,t){return this.postChainChannelMessage(0,e,t)}async _requestWithBinaryData(e,t,r,n=this.defaultReqOptions){const s=Ww();this._reqIdSet.add(s),await this.postChainChannelMessage(s,e,t);let i=new nr;i.onFinished(()=>{$s.delete(s),this._reqIdSet.delete(s)}),$s.set(s,i),n&&(n.timeout||(n.timeout=1e3),n.timeoutException===void 0&&(n=Object.create(n,{timeoutException:{get(){return new Dd(c.CHAINCHANNEL_TIMEOUT,{endpoint:this.endpoint,cmd:Se[e]})}}})),i=this.chainChannelHelper.wrapOutAborterOptions(i,n,{chainChannel:this}));const o=await r(await i.promise);return await this.emit("afterRequestWithBinaryData",{cmd:e,query:t,res:o}),o}_getMaybeQueneTimeCache(){let e=this._maybeQueneTimeFastCache;return e===void 0&&(e=this._maybeQueneTimeFastCache={cache:new Map,releaser:queueMicrotask(()=>this._maybeQueneTimeFastCache=void 0)}),e.cache}getApiMaybeQueueTime(e){if(!(e&Se.RESPONSE))return 0;const t=this._getMaybeQueneTimeCache();let r=t.get(e);if(r===void 0){const n=this.reqresLimitInfoEM.get(e);if(n===void 0)r=0;else{const s=n.preResponseTime+n.preResponseLimitConfig.lockTimespan,i=Math.max(0,s-this.timeHelper.now()),o=this._msgPostQuene.get(e);o===void 0?r=i:r=o.taskList.length*n.preResponseLimitConfig.lockTimespan+i}t.set(e,r)}return r}async postChainChannelMessage(e,t,r){if(this._closed)return;let n=0,s=0;if(Vc.has(t)){if(this.reqresLimitInfoEM.get(t)!==void 0){const o=this._msgPostQuene.forceGet(t),a=new nr;return o.taskList.push({req_id:e,cmd:t,binary:r,sign:a}),o.looper(),a.promise}}else if(t&Se.RESPONSE&&this.has("onGetResponseLimitConfig")){let o=this.reqresLimitInfoEM.get(t);const a=this.timeHelper.now();if(o){const l=o.preResponseLimitConfig;(o.preResponseTime||a)+l.lockTimespan<a&&(o=void 0)}const p=await this.emit("onGetResponseLimitConfig",{cmd:t,requestLimitInfo:o});p!==void 0&&(o=o||this.reqresLimitInfoEM.forceGet(t),o.preResponseTime=a,o.preResponseLimitConfig=p,n=p.lockTimespan,s=p.refuseTimespan)}const i=ln.fromObject({version:this.config.version,req_id:e,cmd:t,binary:r,lockTimespan:n,refuseTimespan:s,messageVersion:this.MESSAGE_VERSION});return this.endpoint.postMessage(i.getBytes())}async queryTransactions(e,t,r){if(!this.canQueryTransactions)return sc.fromObject({status:ve.error,error:Pt.fromObject(new Yr(c.REFUSE_RESPONSE_QUERY_TRANSACTION))});const n=ko.fromObject({query:ut.fromObject(e),sort:hn.fromObject(t||{})}),s=await this._request(Se.QUERY_TRANSACTION,n,this.chainChannelHelper.boxQueryTransactionReturn,r);return await this._downloadBlobFromTibs(s.transactions),s}async indexTransactions(e,t,r){if(!this.canIndexTransactions)return ac.fromObject({status:ve.error,error:Pt.fromObject(new Yr(c.REFUSE_RESPONSE_INDEX_TRANSACTION))});const n=Mh.fromObject({query:ut.fromObject(e),sort:hn.fromObject(t||{})});return this._request(Se.INDEX_TRANSACTION,n,this.chainChannelHelper.boxIndexTransactionReturn,r)}async downloadTransactions(e,t){if(!this.canDownloadTransactions)return cc.fromObject({status:ve.error,error:Pt.fromObject(new Yr(c.REFUSE_RESPONSE_DOWNLOAD_TRANSACTION))});const r=Lh.fromObject({tIndexes:e.map(s=>Rs.fromObject(s))}),n=await this._request(Se.DOWNLOAD_TRANSACTION,r,this.chainChannelHelper.boxDownloadTransactionReturn,t);return await this._downloadBlobFromTibs(n.transactions),n}async openBlob(e,t){if(!this.blobSupportAlgorithms.includes(e.algorithm))return Gi.fromObject({status:ve.error,error:Pt.fromObject(new Yr(c.REFUSE_RESPONSE_OPEN_BLOB))});const r=Vi.fromObject(e),n=await this._request(Se.OPEN_BLOB,r,this.chainChannelHelper.boxOpenBlobReturn,t);return n.descriptor&&this._openedBlobs.add(n.descriptor),n}async readBlob(e,t){if(this._openedBlobs.has(e.descriptor)===!1)return Mo.fromObject({status:ve.error,error:Pt.fromObject(new Yr(c.REFUSE_RESPONSE_READ_BLOB))});const r=ri.fromObject(e);return this._request(Se.READ_BLOB,r,this.chainChannelHelper.boxReadBlobReturn,t)}async closeBlob(e,t){if(this._openedBlobs.has(e.descriptor)===!1)return Dh.fromObject({status:ve.error,error:Pt.fromObject(new Yr(c.REFUSE_RESPONSE_CLOSE_BLOB))});const r=pc.fromObject(e),n=await this._request(Se.CLOSE_BLOB,r,this.chainChannelHelper.boxCloseBlobReturn,t);return n.status===ve.success&&this._openedBlobs.delete(e.descriptor),n}async downloadBlob(e){this.chainChannelHelper.verifyDownloadBlobArgs(e);const t={totalSize:-1,totalCount:-1,currentCount:-1};if(await this.blobHelper.exists(e))return;let r;try{const n=await this.openBlob(e);if(n.status===ve.busy&&await Ks(5e3),n.status!==ve.success)throw n.error;r=n.descriptor;const s=e.downloadSize;let i=1024*1024;i=i<s?i:s;const o=await this.blobHelper.requestStorage(e,s,i,n.contentType,0),a=Math.ceil(s/i),p=s-(a-1)*i;t.totalSize=s,t.totalCount=a,t.currentCount=0;const l=[];for(let _=0;_<a;_++)l.push(async()=>{let E=0,T=!1,w=0;for(;E<3;)try{const C=i*_,N=await this.readBlob({descriptor:r,start:C,end:_===a-1?C+p:C+i});if(N.status===ve.busy||N.status!==ve.success)throw N;if(w=N.chunkBuffer.length,w===0)break;await this.blobHelper.saveChunk(o,_,N.chunkBuffer),T=!0;break}catch(C){if(E++,E>=3)throw C;await Ks(100)}return{isSuccess:T,bytesRead:w}});let h=0,y=!0,A=0;e:for(;;){const _=l.slice(h,h+3);if(_.length===0)break;const E=await Promise.all(_.map(T=>T()));for(const T of E){if(T.isSuccess===!1){y=!1;break e}A+=T.bytesRead}h+=_.length}if(!y)throw new Yr(c.FAIL_TO_DOWNLOAD_BLOB,{hash:e.hash,size:s});if(A!==s)throw new Yr(c.NOT_MATCH,{to_compare_prop:`downloadSize ${A}`,to_target:"real downloaded",be_compare_prop:`downloadSize ${s}`,be_target:"transaction blob"});await this.blobHelper.saveAsBlob(o)}finally{if(r!==void 0)try{await this.closeBlob({descriptor:r})}catch{}}}async _downloadBlobFromTibs(e){for(const t of e)await this.downloadBlobFromTrs(t.transaction)}async downloadBlobFromTrs(e){for(const[r,n,s,i]of e.blobMap.values())await this.downloadBlob({algorithm:r,hash:n,downloadSize:i});const t=this.transactionCore.transactionHelper;switch(e.type){case t.MACRO_CALL:{const{transaction:r}=e.asset.call;await this.downloadBlobFromTrs(r);break}case t.PROMISE_RESOLVE:{const{transaction:r}=e.asset.resolve;await this.downloadBlobFromTrs(r);break}case t.MULTIPLE:{const{transactions:r}=e.asset.multiple;for(const n of r)await this.downloadBlobFromTrs(n);break}}}async initBroadcastTransactionArg(e,t){const r=Hh.fromObject({transaction:e instanceof oe?e:await this.transactionCore.recombineTransaction(e),grabSecret:t?.grabSecret});return[Se.NEW_TRANSACTION,this._requestDataToBinary(r),this.chainChannelHelper.boxNewTransactionReturn,t]}calcDiffTimeToTargetTime(e){return this.timeHelper.now()+this.diffTime-e}async broadcastTransaction(e,t){if(!this.canBroadcastTransaction)return xs.fromObject({status:ve.error,error:Pt.fromObject(new Yr(c.REFUSE_RESPONSE_BROADCAST_TRANSACTION))});const r=await this.initBroadcastTransactionArg(e,t),n=-this.calcDiffTimeToTargetTime(this.timeHelper.getTimeByTimestamp(e.timestamp));n>0&&(yA("chainChannel(%s) seems in feature. need wait %dms then broadcast.",this.address,n),await Ks(n));const s=await this._requestWithBinaryData(...r);return dA("broadcasted Transaction(%s)",this.transactionCore.transactionHelper.getTypeName(e.type),e.asset),s}get isRefusePushNewTransaction(){return this.canBroadcastTransaction?this._busyNewTransaction>this.timeHelper.now()-this.refuseTime:!0}async fastBroadcastTransaction(e){if(this.isRefusePushNewTransaction)return 0;const t=await this.initBroadcastTransactionArg(e);return await this._sendWithBinaryData(t[0],t[1]),1}async queryBlock(e,t){if(!this.canQueryBlock)return lc.fromObject({status:ve.error,error:Pt.fromObject(new Yr(c.REFUSE_RESPONSE_QUERY_BLOCK))});const r=hc.fromObject({query:Lo.fromObject(e)});return this._request(Se.QUERY_BLOCK,r,this.chainChannelHelper.boxQueryBlockReturn,t)}async findBlock(e,t){const r=await this.queryBlock(e,t);return r.someBlock&&r.someBlock.block}initBroadcastBlockArg(e,t){const r=qr.fromObject(e);return r.generatorPublicKey=e.generatorPublicKey,[Se.NEW_BLOCK,this._requestDataToBinary(r),this.chainChannelHelper.boxNewBlockReturn,t]}async broadcastBlock(e,t){if(!this.canBroadcastBlock)return uc.fromObject({status:ve.error,error:Pt.fromObject(new Yr(c.REFUSE_RESPONSE_BROADCAST_BLOCK))});const r=await this._requestWithBinaryData(...this.initBroadcastBlockArg(e,t));return dA("broadcasted block:",e.height),r}async queryTindexes(e,t,r){if(!this.canQueryTindex)return ic.fromObject({status:ve.error,error:Pt.fromObject(new Yr("Refuse response query transaction index"))});const n=ko.fromObject({query:ut.fromObject(e),sort:hn.fromObject(t||{})});return this._request(Se.QUERY_TINDEX,n,this.chainChannelHelper.boxQueryTindexReturn,r)}async queryTransactionInBlocks(e,t){if(!this.canGetTransactionInBlock)return oc.fromObject({status:ve.error,error:Pt.fromObject(new Yr("Refuse response query transactionInBlock"))});const r=kh.fromObject({query:Ho.fromObject(e)});return this._request(Se.GET_TRANSACTIONINBLOCK,r,this.chainChannelHelper.boxGetTransactionInBlockReturn,t)}initOnMessage(){this.endpoint.onMessage(async e=>{try{let t,r,n,s,i;try{s=ln.decode(e),t=s.req_id,r=s.cmd,n=s.binary,i=s.messageVersion}catch{throw new fA(c.MESSAGE_TYPE_ERROR)}if(i<qw)return;let o,a;const p=(l,h)=>(l.status=ve.error,l.error=Pt.fromException(h),l);try{let l=!0;if(Vc.has(r)){const h=r|Se.RESPONSE,y=this.reqresLimitInfoEM.get(h),A=this.timeHelper.now();let _=0;if(y){const E=A-y.preResponseTime;E<y.preResponseLimitConfig.lockTimespan&&(y.preResponseLimitConfig.lockTimespan-E>y.preResponseLimitConfig.refuseTimespan?_=2:_=1)}if(this.has("onBreakRequestLimit")){const E=await this.emit("onBreakRequestLimit",{cmd:r,requestLimitStrategy:_,requestLimitInfo:y});E!==void 0&&(_=E.requestLimitStrategy)}if(_===2){y&&(y.preRefuseTime=A),await this.postChainChannelMessage(t,Se.REFUSE,new Uint8Array(0));return}_===1&&(l=!1)}else if(r&Se.RESPONSE){const h=r-Se.RESPONSE;let y=this.reqresLimitInfoEM.get(h);const{lockTimespan:A,refuseTimespan:_}=s,E=A!==0||_!==0;y===void 0?E&&(y=this.reqresLimitInfoEM.forceGet(h),y.preResponseTime=this.timeHelper.now(),y.preResponseLimitConfig={lockTimespan:A,refuseTimespan:_}):E===!1?this.reqresLimitInfoEM.delete(h):(y.preResponseTime=this.timeHelper.now(),y.preResponseLimitConfig={lockTimespan:A,refuseTimespan:_})}switch(r){case Se.QUERY_TRANSACTION:{if(l&&this.has("onQueryTransactionBinary")){a=await this.emit("onQueryTransactionBinary",await this.chainChannelHelper.boxQueryTransactionArg(n));break}const h=sc.fromObject({status:ve.busy}),y=l&&this.has("onQueryTransaction")?await this.emit("onQueryTransaction",await this.chainChannelHelper.boxQueryTransactionArg(n)):void 0;y&&(h.status=ve.success,h.transactions=y.transactions.map(A=>ar.fromObject(A))),o=h;break}case Se.INDEX_TRANSACTION:{if(l&&this.has("onIndexTransactionBinary")){a=await this.emit("onIndexTransactionBinary",await this.chainChannelHelper.boxIndexTransactionArg(n));break}const h=ac.fromObject({status:ve.busy}),y=l&&this.has("onQueryTransaction")?await this.emit("onIndexTransaction",await this.chainChannelHelper.boxIndexTransactionArg(n)):void 0;y&&(h.status=ve.success,h.tIndexes=y.tIndexes.map(A=>Rs.fromObject(A))),o=h;break}case Se.DOWNLOAD_TRANSACTION:{if(l&&this.has("onDownloadTransactionBinary")){a=await this.emit("onDownloadTransactionBinary",await this.chainChannelHelper.boxDownloadTransactionArg(n));break}const h=cc.fromObject({status:ve.busy}),y=l&&this.has("onDownloadTransaction")?await this.emit("onDownloadTransaction",await this.chainChannelHelper.boxDownloadTransactionArg(n)):void 0;y&&(h.status=ve.success,h.transactions=y.transactions.map(A=>ar.fromObject(A))),o=h;break}case Se.NEW_TRANSACTION:{const h=xs.fromObject({status:ve.busy}),y=this.has("onNewTransaction")?await this.emit("onNewTransaction",await this.chainChannelHelper.boxNewTransactionArg(n)):void 0;y&&(h.status=ve.success,h.minFee=y.minFee,h.newTrsStatus=y.newTrsStatus,h.refuseReason=y.refuseReason,h.errorCode=y.errorCode,h.errorMessage=y.errorMessage),o=h;break}case Se.OPEN_BLOB:{const h=Gi.fromObject({status:ve.busy}),y=await this.chainChannelHelper.boxOpenBlobArg(n),A=this.has("onOpenBlob")?await this.emit("onOpenBlob",y):await this.blobHelper.open(y);A&&(h.status=ve.success,h.descriptor=A.descriptor,h.contentType=A.contentType),o=h;break}case Se.READ_BLOB:{const h=Mo.fromObject({status:ve.busy}),y=await this.chainChannelHelper.boxReadBlobArg(n),A=this.has("onReadBlob")?await this.emit("onReadBlob",y):await this.blobHelper.read(y);A&&(h.status=ve.success,h.chunkBuffer=A.chunkBuffer),o=h;break}case Se.CLOSE_BLOB:{const h=Dh.fromObject({status:ve.busy}),y=await this.chainChannelHelper.boxCloseBlobArg(n);(this.has("onCloseBlob")?await this.emit("onCloseBlob",y):await this.blobHelper.close(y))&&(h.status=ve.success),o=h;break}case Se.QUERY_BLOCK:{if(l&&this.has("onQueryBlockBinary")){a=await this.emit("onQueryBlockBinary",this.chainChannelHelper.boxQueryBlockArg(n));break}const h=lc.fromObject({status:ve.busy}),y=l&&this.has("onQueryBlock")?await this.emit("onQueryBlock",this.chainChannelHelper.boxQueryBlockArg(n)):void 0;if(y&&y.block!==void 0){h.status=ve.success;const A=y.block;if(A){const _=new Proxy(Mt.fromObject(A),{get(E,T,w){return T==="transactions"||T==="transactionBufferList"?[]:Reflect.get(E,T,w)}});h.someBlock=Di.fromObject({block:_})}}o=h;break}case Se.NEW_BLOCK:{const h=uc.fromObject({status:ve.busy}),y=this.chainChannelHelper.boxNewBlockArg(n);this._maybeHeight=y.height,this.has("onNewBlock")&&await this.emit("onNewBlock",y)&&(h.status=ve.success),o=h;break}case Se.GET_PEER_INFO:{const h=gc.fromObject({status:ve.busy}),y=this.has("onGetPeerInfo")?await this.emit("onGetPeerInfo",this.chainChannelHelper.boxGetPeerInfoArg(n)):void 0;y&&y.peerInfo&&(h.status=ve.success,h.peerInfo=mn.fromObject(y.peerInfo)),o=h;break}case Se.QUERY_TINDEX:{const h=ic.fromObject({status:ve.busy}),y=this.has("onQueryTindexes")?await this.emit("onQueryTindexes",await this.chainChannelHelper.boxQueryTransactionArg(n)):void 0;y&&(h.status=ve.success,h.tIndexes=y.tIndexes),o=h;break}case Se.GET_TRANSACTIONINBLOCK:{const h=oc.fromObject({status:ve.busy}),y=this.has("onGetTransactionInBlocks")?await this.emit("onGetTransactionInBlocks",await this.chainChannelHelper.boxGetTransactionInBlockArg(n)):void 0;y&&(h.status=ve.success,h.transactionInBlocks=y.transactionInBlocks.map(A=>ar.fromObject(A))),o=h;break}case Se.QUERY_TRANSACTION_RETURN:case Se.INDEX_TRANSACTION_RETURN:case Se.DOWNLOAD_TRANSACTION_RETURN:case Se.NEW_TRANSACTION_RETURN:case Se.QUERY_BLOCK_RETURN:case Se.NEW_BLOCK_RETURN:case Se.GET_PEER_INFO_RETURN:case Se.OPEN_BLOB_RETURN:case Se.READ_BLOB_RETURN:case Se.CLOSE_BLOB_RETURN:case Se.QUERY_TINDEX_RETURN:case Se.GET_TRANSACTIONINBLOCK_RETURN:case Se.RESPONSE:{const h=$s.get(t);if(h===void 0){if(t!==0)Xw(new wI(c.ONMESSAGE_GET_INVALID_REQ_ID,{req_id:t}));else if(r===Se.NEW_TRANSACTION_RETURN){const{status:y}=this.chainChannelHelper.boxNewTransactionReturn(n);y===ve.busy&&(this._busyNewTransaction=this.timeHelper.now())}return}h.resolve(n);break}case Se.REFUSE:{const h=$s.get(t);if(h!==void 0){h.reject(new Yr(c.REQUEST_LIMIT));return}this.close("chain channel refuse accpet data.");return}default:throw new fA(c.INVALID_MESSAGE_CMD,{cmd:r})}}catch(l){const h=p(pr.fromObject({status:ve.error}),l);throw await this.postChainChannelMessage(t,Vc.get(r)||Se.RESPONSE,pr.encode(h).finish()),l}if(a){await this.postChainChannelMessage(t,Vc.get(r)||Se.RESPONSE,a);return}o&&await this.postChainChannelMessage(t,Vc.get(r)||Se.RESPONSE,o.constructor.encode(o).finish())}catch(t){this.emit("handleMessageError",{handleName:"onMessage",error:t})}})}};u([Z("bfchain-core:TransactionCore"),g("design:type",Object)],oi.prototype,"transactionCore",void 0);u([Z(ue),g("design:type",ue)],oi.prototype,"config",void 0);u([Z(Le),g("design:type",Le)],oi.prototype,"baseHelper",void 0);u([Z(Yt),g("design:type",Yt)],oi.prototype,"timeHelper",void 0);u([Z(Ye),g("design:type",Ye)],oi.prototype,"chainChannelHelper",void 0);u([Z(Ki),g("design:type",Ki)],oi.prototype,"blobHelper",void 0);oi=u([ea(),Ce(0,Z(Vl.ENDPOINT)),Ce(1,Z(Vl.REFUSETIME,{optional:!0})),g("design:paramtypes",[Object,Object])],oi);class Zw extends nr{constructor(t){super(),this.filter=t}match(t){return this.filter===void 0||this.filter(t)}}class eS{constructor(){this._queue=new Set}get size(){return this._queue.size}enqueue(t){const r=new Zw(t);return this._queue.add(r),r}dequeue(t){for(const r of this._queue)if(r.match(t))return r.resolve(t),this._queue.delete(r),r}}var Fd,Ud,$d,Vd,Gd;le("channel","chainChannelGroup");class ll{constructor(){this._inQueneTaskMap=new Map,this._generateQueneTask=(t,r)=>{const n=this._doRequest(t,r).then(s=>(n.resolved=n.finished=!0,this._inQueneTaskMap.has(t)&&this._retCCMap.set(s,t),s),s=>{throw n.rejected=n.finished=!0,this._inQueneTaskMap.has(t)&&this._retCCMap.set(s,t),s});return n},this._retCCMap=new Map}addChainChannel(t,r){return this._inQueneTaskMap.has(t)||this._inQueneTaskMap.set(t,this._generateQueneTask(t,r)),this.helper.wrapAborterOptions(fI(this._inQueneTaskMap.values()),r,{chainChannel:t})}removeChainChannel(t){return this._inQueneTaskMap.delete(t)}removeChainChannelByResult(t){const r=this._retCCMap.get(t);return r?this.removeChainChannel(r):!1}getChainChannelByResult(t){return this._retCCMap.get(t)}finish(){this._inQueneTaskMap.clear(),this._retCCMap.clear()}}const Mu={QUERY:Symbol("query"),SORT:Symbol("sort")};let Lu=Fd=class extends ll{constructor(e,t){super(),this.query=e,this.sort=t}_doRequest(e,t){return e.queryTransactions(this.query,this.sort,t)}static create(e,t,r){return Ht(Fd,new et([[Mu.QUERY,t],[Mu.SORT,r]],e))}};u([Z(Ye),g("design:type",Ye)],Lu.prototype,"helper",void 0);Lu=Fd=u([ea(),Ce(0,Z(Mu.QUERY)),Ce(1,Z(Mu.SORT,{optional:!0})),g("design:paramtypes",[Object,Object])],Lu);const Du={QUERY:Symbol("query"),SORT:Symbol("sort")};let Fu=Ud=class extends ll{constructor(e,t){super(),this.query=e,this.sort=t}_doRequest(e,t){return e.indexTransactions(this.query,this.sort,t)}static create(e,t,r){return Ht(Ud,new et([[Du.QUERY,t],[Du.SORT,r]],e))}};u([Z(Ye),g("design:type",Ye)],Fu.prototype,"helper",void 0);Fu=Ud=u([ea(),Ce(0,Z(Du.QUERY)),Ce(1,Z(Du.SORT,{optional:!0})),g("design:paramtypes",[Object,Object])],Fu);const NI={TINDEXES:Symbol("tIndexes")};let Uu=$d=class extends ll{constructor(e){super(),this.tIndexes=e}_doRequest(e,t){return e.downloadTransactions(this.tIndexes,t)}static create(e,t){return Ht($d,new et([[NI.TINDEXES,t]],e))}};u([Z(Ye),g("design:type",Ye)],Uu.prototype,"helper",void 0);Uu=$d=u([ea(),Ce(0,Z(NI.TINDEXES)),g("design:paramtypes",[Array])],Uu);const OI={QUERY:Symbol("query")};let $u=Vd=class extends ll{constructor(e){super(),this.query=e}_doRequest(e,t){return e.queryBlock(this.query,t)}getTimeoutExceptionInfo(){return["[TIMEOUT]: queryBlock({query}).",{query:this.query}]}_getFinishInfo(){return{message:"finish queryBlock from other chainChannel"}}static create(e,t,r){return Ht(Vd,new et([[OI.QUERY,t]],e))}};u([Z(Ye),g("design:type",Ye)],$u.prototype,"helper",void 0);$u=Vd=u([ea(),Ce(0,Z(OI.QUERY)),g("design:paramtypes",[Object])],$u);const CI={QUERY:Symbol("query")};let Kd=Gd=class extends ll{constructor(e){super(),this.query=e}_doRequest(e,t){return e.queryTransactionInBlocks(this.query,t)}getTimeoutExceptionInfo(){return["queryTransactionInBlocks({query} / {sort}) timeout.",{query:JSON.stringify(this.query)}]}_getFinishInfo(){return{message:"finish queryTransactionInBlocks from other chainChannel"}}static create(e,t,r){return Ht(Gd,new et([[CI.QUERY,t]],e))}};u([Z(Ye),g("design:type",Ye)],Kd.prototype,"helper",void 0);Kd=Gd=u([ea(),Ce(0,Z(CI.QUERY)),g("design:paramtypes",[Object])],Kd);const{error:jg}=le("channel","IntSet");class tS{constructor(t){this._src=t,this._end=1/0,this._maybeEnd=-1/0,this._srcIte=this._src[Symbol.iterator](),this._rl=[]}setEnd(t){this._end=t,this._maybeEnd=t}_previewSrcNext(){const t=this._cachedSrcNext||(this._cachedSrcNext=this._srcIte.next());if(t.done===!1)return this._maybeEnd=t.value;this._end=this._maybeEnd}_srcNext(){const t=this._previewSrcNext();return t!==void 0&&(this._cachedSrcNext=void 0),t}getSerialRangeSet(t){let r=-1/0,n=0;const s=this._rl[Symbol.iterator]();let i=s.next();if(i.done===!1){if(r=i.value,n=1,n>=t)return{start:r,length:n};delete this._rl[r];do{if(i=s.next(),i.done)break;const o=i.value;if(o-n===r){if(delete this._rl[o],++n,n>=t)return{start:r,length:n}}else return{start:r,length:n}}while(!0)}if(r===-1/0){const o=this._srcNext();if(o===void 0)return;if(r=o,n=1,n>=t)return{start:r,length:n}}do{const o=this._previewSrcNext();if(o===void 0)return{start:r,length:n};if(o-n===r){if(this._cachedSrcNext=void 0,++n,n>=t)break}else break}while(!0);return{start:r,length:n}}getRangeSet(t){let r=0;const n=[];do{const s=this.getSerialRangeSet(t);if(s===void 0||(n[n.length]=s,r+=s.length,r>=t))break}while(!0);return n}recycle(t){if(Number.isInteger(t)===!1){jg("num:%o is not an integer",t);return}const r=this._previewSrcNext();if(r!==void 0){if(t>r){jg("num:%d large then the next integer:%d",t,this._end);return}}else if(t>this._end){jg("num:%d large then the end:%d",t,this._end);return}this.recycleUnSafe(t)}recycleUnSafe(t){this._rl[t]=t}recycleManyUnsafe(t){for(const r of t)this._rl[r]=r}}const{AbortException:Cl,InterruptedException:rS,error:Ia,success:_A,info:nS,warn:Gc,log:AA,TimeOutException:qc,IdempotentException:Ta}=le("channel","chainChannelGroup"),ip={GROUP_NAME:Symbol("groupName"),CHANNEL_LIST:Symbol("channelList"),OPTIONS:Symbol("options")};let Xt=class extends SI{constructor(e,t="",r){super(),this.groupName=t,this._ccBlobSupportAlgorithms=kt.from({creater:n=>{const s=Cn.from({afterDelete:()=>{s.size===0&&this._ccBlobSupportAlgorithms.delete(n)}});return s}}),this._initBlobSupportAlgorithmsBinding=!1,this.chainChannelSet=new Set,this.options={},this._parallelTasksMap=new Map,this._workCountWM=new As(n=>0),this._DAWCLWM=new WeakMap,this._maybeHeight=1,this._lastConsensusVersion=1,r&&Object.assign(this.options,r);for(const n of e)this.addChainChannel_(n,this.options)}get canQueryTransactions(){for(const e of this.chainChannelSet)if(e.canQueryTransactions)return!0;return!1}get canIndexTransaction(){for(const e of this.chainChannelSet)if(e.canIndexTransactions)return!0;return!1}get canDownloadTransaction(){for(const e of this.chainChannelSet)if(e.canDownloadTransactions)return!0;return!1}get blobSupportAlgorithms(){var e;const t=this._ccBlobSupportAlgorithms;if(this._initBlobSupportAlgorithmsBinding===!1){this._initBlobSupportAlgorithmsBinding=!0;for(const r of this.chainChannelSet)for(const n of r.blobSupportAlgorithms)t.forceGet(n).add(r);this._chainChannelEvents.on("addChainChannel",r=>{for(const n of r.blobSupportAlgorithms)t.forceGet(n).add(r);this._blobSupportAlgorithms=void 0}),this._chainChannelEvents.on("removeChainChannel",r=>{for(const n of r.blobSupportAlgorithms)t.forceGet(n).delete(r);this._blobSupportAlgorithms=void 0})}return(e=this._blobSupportAlgorithms)!==null&&e!==void 0?e:this._blobSupportAlgorithms=[...t.keys()]}get canQueryBlock(){for(const e of this.chainChannelSet)if(e.canQueryBlock)return!0;return!1}get canBroadcastTransaction(){for(const e of this.chainChannelSet)if(e.canBroadcastTransaction)return!0;return!1}get canBroadcastBlock(){for(const e of this.chainChannelSet)if(e.canBroadcastBlock)return!0;return!1}get limitQueryTransactions(){let e=0;for(const t of this.chainChannelSet){const{limitQueryTransactions:r}=t;r>e&&(e=r)}return e}get limitIndexTransactions(){let e=0;for(const t of this.chainChannelSet){const{limitIndexTransactions:r}=t;r>e&&(e=r)}return e}get limitDownloadTransactions(){let e=0;for(const t of this.chainChannelSet){const{limitDownloadTransactions:r}=t;r>e&&(e=r)}return e}getApiMaybeQueueTime(e){let t=1/0;for(let r of this.chainChannelSet)if(t=Math.min(r.getApiMaybeQueueTime(e),t),t===0)break;return t}get canQueryTindex(){for(const e of this.chainChannelSet)if(e.canQueryTindex)return!0;return!1}get canGetTransactionInBlock(){for(const e of this.chainChannelSet)if(e.canGetTransactionInBlock)return!0;return!1}bfOnInit(){let e=this._maybeHeight;for(const t of this.chainChannelSet)e=Math.max(t.maybeHeight,e);this._tryChangeMaybeHeight(e)}bfAfterInit(){this._initMaybeHeightWatcher()}get size(){return this.chainChannelSet.size}forEach(e){let t=0;for(const r of this.chainChannelSet)e(r,t++)}include(e){return this.chainChannelSet.has(e)}[Symbol.iterator](){return this.chainChannelSet[Symbol.iterator]()}$requestParallelTask(e,t={}){let r=this._parallelTasksMap.get(e);if(r)return r;const{channelFirewall:n=()=>!0,abortWhenNoChainChannel:s}=t,i=this._workCountWM,{taskResponseCmd:o}=t,a=o!==void 0?(B,$)=>B.delay*i.forceGet(B)+B.getApiMaybeQueueTime(o)-($.delay*i.forceGet($)+$.getApiMaybeQueueTime(o)):(B,$)=>B.delay*i.forceGet(B)-$.delay*i.forceGet($),p=new Set([...this.chainChannelSet.values()].filter(n).sort(a)),l=new Set,h=new eS,y=new Set,A=()=>p.size>0,_=(B={})=>{if(s&&this.size===0)throw new Cl(c.TASK_ABORT,{task_id:e});const $=B?.filter;for(const G of p)if($===void 0||$(G))return G;const V=h.enqueue($);return C(),V.promise},E=B=>(i.set(B,i.forceGet(B)-1),l.delete(B)?(N(B),!0):!1),T=B=>(i.set(B,i.forceGet(B)+1),l.has(B)?!1:(l.add(B),p.delete(B),C(),!0)),w=async(B={},$)=>{const{autoFreeChainChannel:V=!0}=B,G=await _(B);T(G);const Y={chainChannel:G,autoFreeChainChannel:V};try{return await $(Y)}finally{Y.autoFreeChainChannel&&E(G)}},C=()=>{const B=5e3-Math.min(h.size/l.size,1)*4e3;if(l.size>y.size){const $=Ks(B,()=>{y.delete($);for(const V of p)if(h.dequeue(V)!==void 0)return;if(l.size!==0){let V=Math.floor(l.size*Math.random());for(const G of l)V--<=0&&E(G)}});y.add($)}},N=B=>{n(B)===!0&&h.dequeue(B)===void 0&&p.add(B)};this.onAddChainChannel(N);const L=B=>{l.delete(B),p.delete(B),i.delete(B),C()};return this.onRemoveChainChannel(L),r={freeChainChannels:p,busyChainChannels:l,chainChannelWaiterQueue:h,tiTasks:y,onDestroy:()=>{p.clear(),l.clear();for(const B of y)dI(B);y.clear(),this.offAddChainChannel(N),this.offRemoveChainChannel(L)},helpers:{hasFreeChainChannel:A,getFreeChainChannel:_,freeChainChannel:E,busyChainChannel:T,requestChainChannel:w},refs:new Set},this._parallelTasksMap.set(e,r),r}$startParallelTask(e,t={}){return this.$requestParallelTask(e,t).helpers}$releaseParallelTask(e){const t=this._parallelTasksMap.get(e);if(!t)return!1;this._parallelTasksMap.delete(e),t.onDestroy()}async wrapParallelTask(e,t="unknowParallelTask",r={}){const n=this.$requestParallelTask(t,r);n.refs.add(e);try{return await e(n.helpers)}finally{n.refs.delete(e),n.refs.size===0&&this.$releaseParallelTask(t)}}wrapCbParallelTask(e,t="unknowParallelTask",r={}){const n=this.$requestParallelTask(t,r);return n.refs.add(e),e(n.helpers,()=>{n.refs.delete(e),n.refs.size===0&&this.$releaseParallelTask(t)})}async*wrapAgParallelTask(e,t="unknowParallelTask",r={}){const n=this.$requestParallelTask(t,r);n.refs.add(e);try{return yield*e(n.helpers)}finally{n.refs.delete(e),n.refs.size===0&&this.$releaseParallelTask(t)}}queryTransactionsVerbose(e,t,r,n){const{offset:s,limit:i,...o}=e,a=o.signature?1:i||1/0,p=`Group(${this.groupName}) queryTransactions-${Date.now()+Math.random()}`,l=r?.channelFilter||(()=>!0),{requestChainChannel:h}=this.$startParallelTask(p,{channelFirewall:N=>N.canQueryTransactions&&l(N),abortWhenNoChainChannel:r?.abortWhenNoChainChannel,taskResponseCmd:Se.QUERY_TRANSACTION_RETURN});let y=()=>!0;{const N=e.maxHeight;typeof N=="number"&&(y=L=>L.maybeHeight>=N)}const A=r&&this.helper.parserAborterOptions(r,{channelGroup:this}),_=n||new kr,E=A&&A.promise;if(E){go(E,void 0,_.reject);const N=(L,B)=>(Hl(E,void 0,_.reject),B());_.on("done",N),_.on("error",N)}const T={timeout:(N,L)=>`peer(${L.address}) queryTransactions(<offset:${N.data.offset},limit:${N.data.limit}>) timeout.
[query:]${JSON.stringify(N.requester.query)}
[sort:]${JSON.stringify(N.requester.sort)}`},w=kt.from({transformKey:N=>`${N.offset}-${N.limit}`,creater:N=>{const L=Lu.create(this.moduleMap,{...o,...N},t);return{requester:L,options:new op(T,N,L,this.helper.getChainChannelTimeout,A)}}}),C=r?.queryUnitLength||(i?Math.ceil(i/(this.chainChannelSet.size||1)):100);return(async()=>{let N=Promise.resolve(),L=a+s;const B=P=>{L=P,V()};let $;const V=()=>{$&&($.resolve(),$=void 0)};let G=-1;_.on("requestAll",(P,x)=>(V(),G=1/0,x()));let Y=0;_.on("requestItem",(P,x)=>{const k=Y+s;return k>G&&(G=k,V()),x()});const X=(P,x)=>{let k=0;return N=N.then(async()=>{do if(await h({autoFreeChainChannel:!1,filter:y},async M=>{var q,K;_.push({type:"success",value:`(${M.chainChannel.address})`});const F=Math.min(M.chainChannel.limitQueryTransactions,x),{requester:J,options:S}=w.forceGet({offset:P,limit:F});U.resolve(F);try{const D=Date.now(),Q=await J.addChainChannel(M.chainChannel,S),fe=Date.now()-D;if(Q.status===ve.success)return _.push({type:"success",value:`(${M.chainChannel.address}) +${fe}ms`}),Q.transactions.forEach((ce,re)=>{const se=P-s+re;_.canPush(_.list.length-Y+se)&&(Y+=1,_.push({type:"result",value:ce}))}),Q.transactions.length<F?(B(P),M.autoFreeChainChannel=!0,!0):(J.finish(),M.autoFreeChainChannel=!0,!0);if(Q.status===ve.busy)return _.push({type:"info",value:`(${M.chainChannel.address}) +${fe}ms`}),J.removeChainChannelByResult(Q),k++,!1;if(Q.status===ve.error)throw _.push({type:"warn",value:`(${M.chainChannel.address}): ${(q=Q.error)===null||q===void 0?void 0:q.message} +${fe}ms`}),J.removeChainChannelByResult(Q),Q.error;if(Q.status===ve.idempotentError){_.push({type:"warn",value:`(${M.chainChannel.address}): ${(K=Q.error)===null||K===void 0?void 0:K.message} +${fe}ms`}),J.removeChainChannelByResult(Q);const ce=Q.error;throw new Ta(ce.message,ce.detail,ce.CODE)}Ng(Q.status)}catch(D){if(J.removeChainChannelByResult(D),Cl.is(D)||_.is_done)throw _.push({type:"info",value:""}),D;return qc.is(D)||(Ta.is(D)?Gc("",D.message):Ia(D,"[GROUP]:",this.groupName,"[QUERY]:",e,"[OFFSET]:",P,"[TIMES]:",k)),_.push({type:"info",value:`${k}`}),k++>100}}))break;while(!0)},M=>U.reject(M)),U.promise};let U;const v=Math.min(C,a);for(let P=0,x=v;P<a;P+=x){const k=P+s;for(;k>G&&!(k>=L);)$||($=new nr,await $.promise);if(k>=L||(U=new nr,x=await X(k,v),P+x>a&&(x=a-P,x<=0)))break}await N,await _.done()})().catch(_.reject).finally(()=>{this.$releaseParallelTask(p)}),_}queryTransactions(e,t,r,n=new kr){return kg(this.queryTransactionsVerbose(e,t,r),n,s=>s.type==="result"?{filter:!0,map:s.value}:{filter:!1}),n}indexTransactionsVerbose(e,t,r,n){const{offset:s,limit:i,...o}=e,a=o.signature?1:i||1/0,p=`Group(${this.groupName}) indexTransactions-${Date.now()+Math.random()}`,l=r?.channelFilter||(()=>!0),{requestChainChannel:h}=this.$startParallelTask(p,{channelFirewall:N=>N.canIndexTransactions&&l(N),abortWhenNoChainChannel:r?.abortWhenNoChainChannel,taskResponseCmd:Se.INDEX_TRANSACTION_RETURN});let y;{const N=e.maxHeight;typeof N=="number"&&(y=L=>L.maybeHeight>=N)}const A=r&&this.helper.parserAborterOptions(r,{channelGroup:this}),_=n||new kr,E=A&&A.promise;if(E){go(E,void 0,_.reject);const N=(L,B)=>(Hl(E,void 0,_.reject),B());_.on("done",N),_.on("error",N)}const T={timeout:(N,L)=>`peer(${L.address}) indexTransactions(<offset:${N.data.offset},limit:${N.data.limit}>) timeout.
[query:]${JSON.stringify(N.requester.query)}
[sort:]${JSON.stringify(N.requester.sort)}`},w=kt.from({transformKey:N=>`${N.offset}-${N.limit}`,creater:N=>{const L=Fu.create(this.moduleMap,{...o,...N},t);return{requester:L,options:new op(T,N,L,this.helper.getChainChannelTimeout,A)}}}),C=r?.queryUnitLength||(i?Math.ceil(i/(this.chainChannelSet.size||1)):100);return(async()=>{let N=Promise.resolve(),L=a+s;const B=P=>{L=P,V()};let $;const V=()=>{$&&($.resolve(),$=void 0)};let G=-1;_.on("requestAll",(P,x)=>(V(),G=1/0,x()));let Y=0;_.on("requestItem",(P,x)=>{const k=Y+s;return k>G&&(G=k,V()),x()});const X=(P,x)=>{let k=0;return N=N.then(async()=>{do if(await h({autoFreeChainChannel:!1,filter:y},async M=>{var q,K;_.push({type:"success",value:`(${M.chainChannel.address})`});const F=Math.min(M.chainChannel.limitQueryTransactions,x),{requester:J,options:S}=w.forceGet({offset:P,limit:F});U.resolve(F);try{const D=Date.now(),Q=await J.addChainChannel(M.chainChannel,S),fe=Date.now()-D;if(Q.status===ve.success)return _.push({type:"success",value:`(${M.chainChannel.address}) +${fe}ms`}),Q.tIndexes.forEach((ce,re)=>{const se=P-s+re;_.canPush(_.list.length-Y+se)&&(Y+=1,_.push({type:"result",value:ce}))}),Q.tIndexes.length<F?(B(P),M.autoFreeChainChannel=!0,!0):(J.finish(),M.autoFreeChainChannel=!0,!0);if(Q.status===ve.busy)return _.push({type:"info",value:`(${M.chainChannel.address}) +${fe}ms`}),J.removeChainChannelByResult(Q),k++,!1;if(Q.status===ve.error)throw _.push({type:"warn",value:`(${M.chainChannel.address}): ${(q=Q.error)===null||q===void 0?void 0:q.message} +${fe}ms`}),J.removeChainChannelByResult(Q),Q.error;if(Q.status===ve.idempotentError){_.push({type:"warn",value:`(${M.chainChannel.address}): ${(K=Q.error)===null||K===void 0?void 0:K.message} +${fe}ms`}),J.removeChainChannelByResult(Q);const ce=Q.error;throw new Ta(ce.message,ce.detail,ce.CODE)}Ng(Q.status)}catch(D){if(J.removeChainChannelByResult(D),Cl.is(D)||_.is_done)throw _.push({type:"info",value:""}),D;return qc.is(D)||(Ta.is(D)?Gc("",D.message):Ia(D,"[GROUP]:",this.groupName,"[QUERY]:",e,"[OFFSET]:",P,"[TIMES]:",k)),_.push({type:"info",value:`${k}`}),k++>100}}))break;while(!0)},M=>U.reject(M)),U.promise};let U;const v=Math.min(C,a);for(let P=0,x=v;P<a;P+=x){const k=P+s;for(;k>G&&!(k>=L);)$||($=new nr,await $.promise);if(k>=L||(U=new nr,x=await X(k,v),P+x>a&&(x=a-P,x<=0)))break}await N,await _.done()})().catch(_.reject).finally(()=>{this.$releaseParallelTask(p)}),_}indexTransactions(e,t,r,n=new kr){return kg(this.indexTransactionsVerbose(e,t,r),n,s=>s.type==="result"?{filter:!0,map:s.value}:{filter:!1}),n}_formatHiList(e){const t=[],r=new kt(a=>t.length+1);for(const a of e.slice().sort((p,l)=>p.height-l.height)){const p=r.forceGet(a.height)+a.tIndex;t[p]=p}const n=[];t.forEach(a=>n[n.length]=a);const s=new tS(n),i=[];for(const a of r)i[i.length]={height:a[0],baseIndex:a[1]};let o=0;return s.getRangeSet(1/0).map(a=>{const p=i.findIndex(_=>_.baseIndex>a.start,o);o=p===-1?i.length-1:p-1;const l=i[o],h=l.height,y=a.start-l.baseIndex,A=a.length;return{height:h,tIndex:y,length:A}})}downloadTransactionsVerbose(e,t,r){const n=Math.min(Math.ceil((this.limitDownloadTransactions||1)/Math.SQRT2),1),s=new Map,i=(T,w)=>{s.set(`${T}-${w}`,{height:T,tIndex:w})};for(const T of e)if(T.length>1)for(let w=0;w<T.length;++w)i(T.height,T.tIndex+w);else i(T.height,T.tIndex);const o=[...s.values()],a=o.length,p=t&&this.helper.parserAborterOptions(t,{channelGroup:this}),l=r||new kr,h=`Group(${this.groupName}) downloadTransactions-${Date.now()+Math.random()}`,y=t?.channelFilter||(()=>!0),{requestChainChannel:A}=this.$startParallelTask(h,{channelFirewall:T=>T.canDownloadTransactions&&y(T),abortWhenNoChainChannel:t?.abortWhenNoChainChannel,taskResponseCmd:Se.DOWNLOAD_TRANSACTION_RETURN}),_={timeout:(T,w)=>`peer(${w.address}) downloadTransactions(<${T.data.map(C=>`${C.height}/${C.tIndex}:${C.length}`).join(",")}) timeout.`},E=kt.from({transformKey:T=>T.map(w=>`${w.height}/${w.tIndex}:${w.length}`).join(","),creater:T=>{const w=Uu.create(this.moduleMap,T);return{requester:w,options:new op(_,T,w,this.helper.getChainChannelTimeout,p)}}});return(async()=>{let T;const w=()=>{T&&(T.resolve(),T=void 0)};let C=l.requestProcess;l.on("requestAll",(B,$)=>(w(),C=1/0,$())),l.on("requestItem",(B,$)=>(B>=C&&(C=B+1,w()),$()));let N=0;const L=async()=>{do{const B=o.slice(N,N+=n);if(B.length===0)break;const $=this._formatHiList(B),V=B.length,G=B[B.length-1].height;let Y=0;for(;!await A({filter:X=>X.maybeHeight>=G},async X=>{var U,v;l.push({type:"success",value:`(${X.chainChannel.address})`});const{requester:P,options:x}=E.forceGet($);try{const k=Date.now(),M=await P.addChainChannel(X.chainChannel,x),q=Date.now()-k;if(M.status===ve.success){if(l.push({type:"success",value:`(${X.chainChannel.address}) +${q}ms`}),M.transactions.length<V)return P.removeChainChannelByResult(M),Y++,!1;{const K=M.transactions.map(F=>({tib:F,hiIndex:o.findIndex(J=>J.height===F.height&&J.tIndex===F.tIndex)})).sort((F,J)=>F.hiIndex-J.hiIndex);for(const F of K)l.canPush(l.list.length)&&l.push({type:"result",value:F.tib});return!0}}else{if(M.status===ve.busy)return l.push({type:"info",value:`(${X.chainChannel.address}) +${q}ms`}),P.removeChainChannelByResult(M),Y++,!1;if(M.status===ve.error)throw l.push({type:"warn",value:`(${X.chainChannel.address}): ${(U=M.error)===null||U===void 0?void 0:U.message} +${q}ms`}),P.removeChainChannelByResult(M),M.error;if(M.status===ve.idempotentError){l.push({type:"warn",value:`(${X.chainChannel.address}): ${(v=M.error)===null||v===void 0?void 0:v.message} +${q}ms`}),P.removeChainChannelByResult(M);const K=M.error;throw new Ta(K.message,K.detail,K.CODE)}}Ng(M.status)}catch(k){if(P.removeChainChannelByResult(k),Cl.is(k)||l.is_done)throw l.push({type:"info",value:""}),k;return qc.is(k)||(Ta.is(k)?Gc("",k.message):Ia(k,"[GROUP]:",this.groupName,"[TINDEXES]:",B,"[TIMES]:",Y)),l.push({type:"info",value:`${Y}`}),Y++>100}}););}while(!0)};for(let B=0;B<a;B+=n){for(;B>=C;)T||(T=new nr),await T.promise;await L()}await l.done()})().finally(()=>{this.$releaseParallelTask(h)}),l}downloadTransactions(e,t,r=new kr){return kg(this.downloadTransactionsVerbose(e,t),r,n=>n.type==="result"?{filter:!0,map:n.value}:{filter:!1}),r}async broadcastTransaction(e,t,r){let n;const s=this.timeHelper.now(),i=[];let o;try{let l=[];if(t&&t.directAddress&&t.directAddress.size>0){const A=t.directAddress;for(const _ of this.chainChannelSet.values())A.has(_.address)&&l.push(_)}else l=[...this.chainChannelSet.values()];let h=r&&await r.emit("startBroadcasting",{chainChannelList:l});if(h&&h.break)return[];const y=new wb(t&&t.max_parallel_num);o=t&&this.helper.parserAborterOptions(t,{channelGroup:this});for(const A of l)y.addTaskExecutor(async()=>{const _=n||(n=await A.initBroadcastTransactionArg(e,{timeout:T=>this.helper.getChainChannelTimeout(T.chainChannel),rejected:o?.promise}));let E;try{const T=-A.calcDiffTimeToTargetTime(this.timeHelper.getTimeByTimestamp(e.timestamp));if(T>0){if(AA("chainChannel(%s) seems in feature. need wait %dms then broadcast.",A.address,T),o&&o.sleepTime>0&&T+A.delay/2>o.sleepTime){AA("chainChannel(%s) need wait too much time, so skip in resultList."),Ks(T,async()=>{try{E={error:!1,result:await A._requestWithBinaryData(..._),chainChannel:A}}catch(w){E={error:!0,result:w,chainChannel:A}}r&&await r.emit("broadcasted",E)});return}await Ks(T)}i.push(E={error:!1,result:await A._requestWithBinaryData(..._),chainChannel:A})}catch(T){i.push(E={error:!0,result:T,chainChannel:A})}r&&(h=await r.emit("broadcasted",E))});for await(const A of y.yieldResults({ignoreError:!0}))if(h&&h.break)break;o?.resolve(void 0)}catch(l){o?.reject(l)}finally{const l=this.timeHelper.now();r&&r.emit("endBroadcast",{duraction:l-s})}let a=0,p=0;return i.forEach(l=>{l.error?p+=1:a+=1}),(a===0&&p>0?Ia:_A)("chainChannelGroup(%s) broadcasted Transaction(%s), successed: %d, fail: %d",this.groupName,this.transactionHelper.getTypeName(e.type),a,p,e.asset),i}async fastBroadcastTransaction(e,t,r){let n,s=[];if(t&&t.directAddress&&t.directAddress.size>0){const l=t.directAddress;for(const h of this.chainChannelSet.values())l.has(h.address)&&s.push(h)}else for(const l of this.chainChannelSet.values())l.canBroadcastTransaction&&s.push(l);let i=r&&await r.emit("startBroadcasting",{chainChannelList:s}),o=0;if(i&&i.break)return o;const a=this.timeHelper.now();for(const l of s)if(!l.isRefusePushNewTransaction){n||(n=await l.initBroadcastTransactionArg(e));try{o++,await l._sendWithBinaryData(n[0],n[1])}catch{}}const p=this.timeHelper.now();return r&&r.emit("endBroadcast",{duraction:p-a}),o}async queryBlock(e,t,r){if(typeof e.height=="number"){const l=e.height;if(![...this.chainChannelSet.values()].find(h=>h.maybeHeight>=l))return}const n=`Group(${this.groupName}) queryBlock-${Date.now()+Math.random()}`,{requestChainChannel:s}=this.$startParallelTask(n,{channelFirewall:t?.channelFilter,abortWhenNoChainChannel:t?.abortWhenNoChainChannel,taskResponseCmd:Se.QUERY_BLOCK_RETURN}),i=t&&this.helper.parserAborterOptions(t,{channelGroup:this});let o=!1;const a=i?.promise;let p;if(a){const l=h=>{Gc(h),o=!0};go(a,void 0,l),p=()=>{Hl(a,void 0,l)}}try{const l=Math.min(Math.max(this.size,2),5),h=$u.create(this.moduleMap,e),y={rejected:a,timeout:T=>this.helper.getChainChannelTimeout(T.chainChannel)};{const T=new kt(w=>new qc(c.QUERY_BLOCK_FROM_PEER_TIMEOUT,{query:JSON.stringify(h.query),peerId:w.address}));y.timeoutException=w=>T.forceGet(w.chainChannel)}let A=0,_,E=()=>!0;{const T=e.height;typeof T=="number"&&(E=w=>w.maybeHeight>=T)}do{if(o)return;await s({autoFreeChainChannel:!1,filter:E},async T=>{var w,C;try{const N=await h.addChainChannel(T.chainChannel,y);if(N.status===ve.error)throw h.removeChainChannelByResult(N),N.error;if(N.status===ve.busy)throw h.removeChainChannelByResult(N),void 0;if(_=(w=N.someBlock)===null||w===void 0?void 0:w.block,!_){const L=(C=h.getChainChannelByResult(N))===null||C===void 0?void 0:C.maybeHeight;if(L&&L>=this.maybeHeight){o=!0;return}}h.finish()}catch(N){if(o)return;if(h.removeChainChannelByResult(N),N&&Gc(N),A+=1,A>=l){o=!0;return}}})}while(!_);return _}finally{this.$releaseParallelTask(n),p&&p()}}findBlock(e,t){return this.queryBlock(e,t)}async broadcastBlock(e,t){let r,n=[];if(t&&t.directAddress&&t.directAddress.size>0){const p=t.directAddress;for(const l of this.chainChannelSet.values())p.has(l.address)&&n.push(l)}else n=[...this.chainChannelSet.values()];const s=t&&this.helper.parserAborterOptions(t,{channelGroup:this}),i=await Promise.all(n.map(p=>(r||(r=p.initBroadcastBlockArg(e,{timeout:l=>this.helper.getChainChannelTimeout(l.chainChannel),rejected:s?.promise})),{chainChannel:p,result:p._requestWithBinaryData(...r)})));let o=0,a=0;return await Promise.all(i.map(async p=>{try{(await p.result).error?a+=1:o+=1}catch{a+=1}})),(o===0&&a>0?Ia:_A)("chainChannelGroup(%s) broadcasted Block(%d), successed: %d, fail: %d",this.groupName,e.height,o,a),i}async fastBroadcastBlock(e,t){let r,n=[];if(t&&t.directAddress&&t.directAddress.size>0){const i=t.directAddress;for(const o of this.chainChannelSet.values())i.has(o.address)&&n.push(o)}else for(const i of this.chainChannelSet.values())i.canBroadcastBlock&&n.push(i);let s=0;for(const i of n){r||(r=i.initBroadcastBlockArg(e));try{s++,await i._sendWithBinaryData(r[0],r[1])}catch{}}return s}addChainChannel(e,t=this.options){return this.chainChannelSet.has(e)?!1:(this.addChainChannel_(e,t),this._chainChannelEvents.emit("addChainChannel",e),!0)}addChainChannels(e){let t=0,r=0;const n="size"in e?e:[e];for(const s of n)this.addChainChannel(s)?t+=1:r+=1;return{ADD:t,FAIL:r}}removeChainChannel(e){e.offEmit(this._eventFollower);const t=this._DAWCLWM.get(e);return t&&(this._DAWCLWM.delete(e),t()),this.chainChannelSet.delete(e)?(this._chainChannelEvents.emit("removeChainChannel",e),!0):!1}get _chainChannelEvents(){return new Rn}get onAddChainChannel(){return this._chainChannelEvents.on.bind(this._chainChannelEvents,"addChainChannel")}get offAddChainChannel(){return this._chainChannelEvents.off.bind(this._chainChannelEvents,"addChainChannel")}get onRemoveChainChannel(){return this._chainChannelEvents.on.bind(this._chainChannelEvents,"removeChainChannel")}get offRemoveChainChannel(){return this._chainChannelEvents.off.bind(this._chainChannelEvents,"removeChainChannel")}_eventFollower(e){return this.emit(e.eventname,e.args)}addChainChannel_(e,t=this.options){if(this.chainChannelSet.add(e),!t.disableAutoRemove){const r=e.onClose(n=>{rS.is(n)?nS("channel auto removed in [%s], reason:",this.groupName,n.message):Ia("channel auto removed in [%s], reason:",this.groupName,n),this.removeChainChannel(e)});this._DAWCLWM.set(e,r)}e.onEmit(this._eventFollower)}destroy(){for(const e of this.chainChannelSet)this.removeChainChannel(e)}get maybeHeight(){return this._maybeHeight}get lastConsensusVersion(){return this._lastConsensusVersion}get onMaybeHeightChanged(){return this._chainChannelEvents.on.bind(this._chainChannelEvents,"maybeHeightChanged")}get offMaybeHeightChanged(){return this._chainChannelEvents.off.bind(this._chainChannelEvents,"maybeHeightChanged")}_tryChangeMaybeHeight(e,t){this._maybeHeight!==e&&(this._maybeHeight=e,this._chainChannelEvents.emit("maybeHeightChanged",e,t))}_tryChangeConsensusVersion(e){this._lastConsensusVersion!==e&&(this._lastConsensusVersion=e,this._chainChannelEvents.emit("consensusVersionChanged",e))}_initMaybeHeightWatcher(){const e=(r,n)=>(r.height>this._maybeHeight&&this._tryChangeMaybeHeight(r.height,r.version),n());let t=this._maybeHeight;for(const r of this.chainChannelSet)t=Math.max(r.maybeHeight,t);this._tryChangeMaybeHeight(t),this._chainChannelEvents.on("addChainChannel",r=>{this._maybeHeight<r.maybeHeight&&this._tryChangeMaybeHeight(r.maybeHeight),this._lastConsensusVersion<r.lastConsensusVersion&&this._tryChangeConsensusVersion(r.lastConsensusVersion),r.on("onNewBlock",e)}),this._chainChannelEvents.on("removeChainChannel",r=>{if(r.off("onNewBlock",e),r.maybeHeight<this._maybeHeight)return;let n=1;for(const s of this.chainChannelSet)if(n=Math.max(s.maybeHeight,n),n>=r.maybeHeight)return;this._tryChangeMaybeHeight(n)})}};u([Z(Le),g("design:type",Le)],Xt.prototype,"baseHelper",void 0);u([Z(ue),g("design:type",ue)],Xt.prototype,"config",void 0);u([Z(et),g("design:type",et)],Xt.prototype,"moduleMap",void 0);u([Z(Yt),g("design:type",Yt)],Xt.prototype,"timeHelper",void 0);u([Z(Ye),g("design:type",Ye)],Xt.prototype,"helper",void 0);u([Z(we),g("design:type",we)],Xt.prototype,"transactionHelper",void 0);u([Z(Ki),g("design:type",Ki)],Xt.prototype,"blobHelper",void 0);u([Je,g("design:type",Function),g("design:paramtypes",[Object,Object,Object,Object]),g("design:returntype",void 0)],Xt.prototype,"queryTransactions",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object,Object,Object,kr]),g("design:returntype",void 0)],Xt.prototype,"indexTransactionsVerbose",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object,Object,Object,Object]),g("design:returntype",void 0)],Xt.prototype,"indexTransactions",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object,Object,kr]),g("design:returntype",void 0)],Xt.prototype,"downloadTransactionsVerbose",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object,Object,Object]),g("design:returntype",void 0)],Xt.prototype,"downloadTransactions",null);u([ge,g("design:type",Object),g("design:paramtypes",[])],Xt.prototype,"_chainChannelEvents",null);u([ge,g("design:type",Function),g("design:paramtypes",[])],Xt.prototype,"onAddChainChannel",null);u([ge,g("design:type",Function),g("design:paramtypes",[])],Xt.prototype,"onRemoveChainChannel",null);u([ge,g("design:type",Function),g("design:paramtypes",[])],Xt.prototype,"offRemoveChainChannel",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",void 0)],Xt.prototype,"_eventFollower",null);u([ge,g("design:type",Function),g("design:paramtypes",[])],Xt.prototype,"onMaybeHeightChanged",null);u([ge,g("design:type",Function),g("design:paramtypes",[])],Xt.prototype,"offMaybeHeightChanged",null);Xt=u([ea(),Ce(0,Z(ip.CHANNEL_LIST)),Ce(1,Z(ip.GROUP_NAME,{optional:!0})),Ce(2,Z(ip.OPTIONS,{optional:!0})),g("design:paramtypes",[Object,Object,Object])],Xt);class op{constructor(t,r,n,s,i){this.exmBuilder=t,this.data=r,this.requester=n,this.getChainChannelTimeout=s,this.resultPo=i}get _exm(){return new kt(t=>new qc(this.exmBuilder.timeout(this,t)))}timeoutException(t){return this._exm.forceGet(t.chainChannel)}timeout(t){return this.getChainChannelTimeout(t.chainChannel)}get rejected(){var t;return(t=this.resultPo)===null||t===void 0?void 0:t.promise}}u([ge,g("design:type",Object),g("design:paramtypes",[])],op.prototype,"_exm",null);u([Je,g("design:type",Function),g("design:paramtypes",[Object]),g("design:returntype",void 0)],op.prototype,"timeoutException",null);let jd=class{constructor(e){this.moduleMap=e,this._groupNameAcc=1}registryChannel(e,t=oi,r=this.moduleMap,n=1e3){return Ht(t,new et([[Vl.ENDPOINT,e],[Vl.REFUSETIME,n]],r))}groupChannel(e,t=`G${this._groupNameAcc++}`,r=Xt){const{moduleMap:n}=this;return Ht(r,new et([[ip.CHANNEL_LIST,e],[ip.GROUP_NAME,t]],n))}};jd=u([ie(),g("design:paramtypes",[et])],jd);const tt=Uint8Array,zg=Uint16Array,Vu=Int32Array,ul=Float64Array;function Gu(e,t,r,n){const s=n[0]&255|(n[1]&255)<<8|(n[2]&255)<<16|(n[3]&255)<<24,i=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,o=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,a=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,p=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24,l=n[4]&255|(n[5]&255)<<8|(n[6]&255)<<16|(n[7]&255)<<24,h=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,y=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,A=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,_=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,E=n[8]&255|(n[9]&255)<<8|(n[10]&255)<<16|(n[11]&255)<<24,T=r[16]&255|(r[17]&255)<<8|(r[18]&255)<<16|(r[19]&255)<<24,w=r[20]&255|(r[21]&255)<<8|(r[22]&255)<<16|(r[23]&255)<<24,C=r[24]&255|(r[25]&255)<<8|(r[26]&255)<<16|(r[27]&255)<<24,N=r[28]&255|(r[29]&255)<<8|(r[30]&255)<<16|(r[31]&255)<<24,L=n[12]&255|(n[13]&255)<<8|(n[14]&255)<<16|(n[15]&255)<<24;let B=s,$=i,V=o,G=a,Y=p,X=l,U=h,v=y,P=A,x=_,k=E,M=T,q=w,K=C,F=N,J=L,S;for(let D=0;D<20;D+=2)S=B+q|0,Y^=S<<7|S>>>25,S=Y+B|0,P^=S<<9|S>>>23,S=P+Y|0,q^=S<<13|S>>>19,S=q+P|0,B^=S<<18|S>>>14,S=X+$|0,x^=S<<7|S>>>25,S=x+X|0,K^=S<<9|S>>>23,S=K+x|0,$^=S<<13|S>>>19,S=$+K|0,X^=S<<18|S>>>14,S=k+U|0,F^=S<<7|S>>>25,S=F+k|0,V^=S<<9|S>>>23,S=V+F|0,U^=S<<13|S>>>19,S=U+V|0,k^=S<<18|S>>>14,S=J+M|0,G^=S<<7|S>>>25,S=G+J|0,v^=S<<9|S>>>23,S=v+G|0,M^=S<<13|S>>>19,S=M+v|0,J^=S<<18|S>>>14,S=B+G|0,$^=S<<7|S>>>25,S=$+B|0,V^=S<<9|S>>>23,S=V+$|0,G^=S<<13|S>>>19,S=G+V|0,B^=S<<18|S>>>14,S=X+Y|0,U^=S<<7|S>>>25,S=U+X|0,v^=S<<9|S>>>23,S=v+U|0,Y^=S<<13|S>>>19,S=Y+v|0,X^=S<<18|S>>>14,S=k+x|0,M^=S<<7|S>>>25,S=M+k|0,P^=S<<9|S>>>23,S=P+M|0,x^=S<<13|S>>>19,S=x+P|0,k^=S<<18|S>>>14,S=J+F|0,q^=S<<7|S>>>25,S=q+J|0,K^=S<<9|S>>>23,S=K+q|0,F^=S<<13|S>>>19,S=F+K|0,J^=S<<18|S>>>14;B=B+s|0,$=$+i|0,V=V+o|0,G=G+a|0,Y=Y+p|0,X=X+l|0,U=U+h|0,v=v+y|0,P=P+A|0,x=x+_|0,k=k+E|0,M=M+T|0,q=q+w|0,K=K+C|0,F=F+N|0,J=J+L|0,e[0]=B>>>0&255,e[1]=B>>>8&255,e[2]=B>>>16&255,e[3]=B>>>24&255,e[4]=$>>>0&255,e[5]=$>>>8&255,e[6]=$>>>16&255,e[7]=$>>>24&255,e[8]=V>>>0&255,e[9]=V>>>8&255,e[10]=V>>>16&255,e[11]=V>>>24&255,e[12]=G>>>0&255,e[13]=G>>>8&255,e[14]=G>>>16&255,e[15]=G>>>24&255,e[16]=Y>>>0&255,e[17]=Y>>>8&255,e[18]=Y>>>16&255,e[19]=Y>>>24&255,e[20]=X>>>0&255,e[21]=X>>>8&255,e[22]=X>>>16&255,e[23]=X>>>24&255,e[24]=U>>>0&255,e[25]=U>>>8&255,e[26]=U>>>16&255,e[27]=U>>>24&255,e[28]=v>>>0&255,e[29]=v>>>8&255,e[30]=v>>>16&255,e[31]=v>>>24&255,e[32]=P>>>0&255,e[33]=P>>>8&255,e[34]=P>>>16&255,e[35]=P>>>24&255,e[36]=x>>>0&255,e[37]=x>>>8&255,e[38]=x>>>16&255,e[39]=x>>>24&255,e[40]=k>>>0&255,e[41]=k>>>8&255,e[42]=k>>>16&255,e[43]=k>>>24&255,e[44]=M>>>0&255,e[45]=M>>>8&255,e[46]=M>>>16&255,e[47]=M>>>24&255,e[48]=q>>>0&255,e[49]=q>>>8&255,e[50]=q>>>16&255,e[51]=q>>>24&255,e[52]=K>>>0&255,e[53]=K>>>8&255,e[54]=K>>>16&255,e[55]=K>>>24&255,e[56]=F>>>0&255,e[57]=F>>>8&255,e[58]=F>>>16&255,e[59]=F>>>24&255,e[60]=J>>>0&255,e[61]=J>>>8&255,e[62]=J>>>16&255,e[63]=J>>>24&255}function Sm(e,t,r,n){const s=n[0]&255|(n[1]&255)<<8|(n[2]&255)<<16|(n[3]&255)<<24,i=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,o=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,a=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,p=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24,l=n[4]&255|(n[5]&255)<<8|(n[6]&255)<<16|(n[7]&255)<<24,h=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,y=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,A=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,_=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,E=n[8]&255|(n[9]&255)<<8|(n[10]&255)<<16|(n[11]&255)<<24,T=r[16]&255|(r[17]&255)<<8|(r[18]&255)<<16|(r[19]&255)<<24,w=r[20]&255|(r[21]&255)<<8|(r[22]&255)<<16|(r[23]&255)<<24,C=r[24]&255|(r[25]&255)<<8|(r[26]&255)<<16|(r[27]&255)<<24,N=r[28]&255|(r[29]&255)<<8|(r[30]&255)<<16|(r[31]&255)<<24,L=n[12]&255|(n[13]&255)<<8|(n[14]&255)<<16|(n[15]&255)<<24;let B=s,$=i,V=o,G=a,Y=p,X=l,U=h,v=y,P=A,x=_,k=E,M=T,q=w,K=C,F=N,J=L,S;for(let D=0;D<20;D+=2)S=B+q|0,Y^=S<<7|S>>>25,S=Y+B|0,P^=S<<9|S>>>23,S=P+Y|0,q^=S<<13|S>>>19,S=q+P|0,B^=S<<18|S>>>14,S=X+$|0,x^=S<<7|S>>>25,S=x+X|0,K^=S<<9|S>>>23,S=K+x|0,$^=S<<13|S>>>19,S=$+K|0,X^=S<<18|S>>>14,S=k+U|0,F^=S<<7|S>>>25,S=F+k|0,V^=S<<9|S>>>23,S=V+F|0,U^=S<<13|S>>>19,S=U+V|0,k^=S<<18|S>>>14,S=J+M|0,G^=S<<7|S>>>25,S=G+J|0,v^=S<<9|S>>>23,S=v+G|0,M^=S<<13|S>>>19,S=M+v|0,J^=S<<18|S>>>14,S=B+G|0,$^=S<<7|S>>>25,S=$+B|0,V^=S<<9|S>>>23,S=V+$|0,G^=S<<13|S>>>19,S=G+V|0,B^=S<<18|S>>>14,S=X+Y|0,U^=S<<7|S>>>25,S=U+X|0,v^=S<<9|S>>>23,S=v+U|0,Y^=S<<13|S>>>19,S=Y+v|0,X^=S<<18|S>>>14,S=k+x|0,M^=S<<7|S>>>25,S=M+k|0,P^=S<<9|S>>>23,S=P+M|0,x^=S<<13|S>>>19,S=x+P|0,k^=S<<18|S>>>14,S=J+F|0,q^=S<<7|S>>>25,S=q+J|0,K^=S<<9|S>>>23,S=K+q|0,F^=S<<13|S>>>19,S=F+K|0,J^=S<<18|S>>>14;e[0]=B>>>0&255,e[1]=B>>>8&255,e[2]=B>>>16&255,e[3]=B>>>24&255,e[4]=X>>>0&255,e[5]=X>>>8&255,e[6]=X>>>16&255,e[7]=X>>>24&255,e[8]=k>>>0&255,e[9]=k>>>8&255,e[10]=k>>>16&255,e[11]=k>>>24&255,e[12]=J>>>0&255,e[13]=J>>>8&255,e[14]=J>>>16&255,e[15]=J>>>24&255,e[16]=U>>>0&255,e[17]=U>>>8&255,e[18]=U>>>16&255,e[19]=U>>>24&255,e[20]=v>>>0&255,e[21]=v>>>8&255,e[22]=v>>>16&255,e[23]=v>>>24&255,e[24]=P>>>0&255,e[25]=P>>>8&255,e[26]=P>>>16&255,e[27]=P>>>24&255,e[28]=x>>>0&255,e[29]=x>>>8&255,e[30]=x>>>16&255,e[31]=x>>>24&255}const $o=new tt([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function sS(e,t,r,n,s,i,o){const a=new tt(16),p=new tt(64);let l,h;for(h=0;h<16;h++)a[h]=0;for(h=0;h<8;h++)a[h]=i[h];for(;s>=64;){for(Gu(p,a,o,$o),h=0;h<64;h++)e[t+h]=r[n+h]^p[h];for(l=1,h=8;h<16;h++)l=l+(a[h]&255)|0,a[h]=l&255,l>>>=8;s-=64,t+=64,n+=64}if(s>0)for(Gu(p,a,o,$o),h=0;h<s;h++)e[t+h]=r[n+h]^p[h];return 0}function iS(e,t,r,n,s){const i=new tt(16),o=new tt(64);let a,p;for(p=0;p<16;p++)i[p]=0;for(p=0;p<8;p++)i[p]=n[p];for(;r>=64;){for(Gu(o,i,s,$o),p=0;p<64;p++)e[t+p]=o[p];for(a=1,p=8;p<16;p++)a=a+(i[p]&255)|0,i[p]=a&255,a>>>=8;r-=64,t+=64}if(r>0)for(Gu(o,i,s,$o),p=0;p<r;p++)e[t+p]=o[p];return 0}function oS(e,t,r,n,s){const i=new tt(32),o=new tt(8);Sm(i,n,s,$o);for(let a=0;a<8;a++)o[a]=n[a+16];return iS(e,t,r,o,i)}function xI(e,t,r,n,s,i,o){const a=new tt(32),p=new tt(8);Sm(a,i,o,$o);for(let l=0;l<8;l++)p[l]=i[l+16];return sS(e,t,r,n,s,p,a)}function aS(e){const t=new zg(10),r=new zg(8);let n,s,i,o,a,p,l,h;return n=e[0]&255|(e[1]&255)<<8,t[0]=n&8191,s=e[2]&255|(e[3]&255)<<8,t[1]=(n>>>13|s<<3)&8191,i=e[4]&255|(e[5]&255)<<8,t[2]=(s>>>10|i<<6)&7939,o=e[6]&255|(e[7]&255)<<8,t[3]=(i>>>7|o<<9)&8191,a=e[8]&255|(e[9]&255)<<8,t[4]=(o>>>4|a<<12)&255,t[5]=a>>>1&8190,p=e[10]&255|(e[11]&255)<<8,t[6]=(a>>>14|p<<2)&8191,l=e[12]&255|(e[13]&255)<<8,t[7]=(p>>>11|l<<5)&8065,h=e[14]&255|(e[15]&255)<<8,t[8]=(l>>>8|h<<8)&8191,t[9]=h>>>5&127,r[0]=e[16]&255|(e[17]&255)<<8,r[1]=e[18]&255|(e[19]&255)<<8,r[2]=e[20]&255|(e[21]&255)<<8,r[3]=e[22]&255|(e[23]&255)<<8,r[4]=e[24]&255|(e[25]&255)<<8,r[5]=e[26]&255|(e[27]&255)<<8,r[6]=e[28]&255|(e[29]&255)<<8,r[7]=e[30]&255|(e[31]&255)<<8,{buffer:new tt(16),r:t,h:new zg(10),pad:r,leftover:0,fin:0}}function zd(e,t,r,n){const s=e.fin?0:2048;let i,o,a,p,l,h,y,A,_,E,T,w,C,N,L,B,$,V,G;const{h:Y,r:X}=e;let U=Y[0],v=Y[1],P=Y[2],x=Y[3],k=Y[4],M=Y[5],q=Y[6],K=Y[7],F=Y[8],J=Y[9];const S=X[0],D=X[1],Q=X[2],fe=X[3],ce=X[4],re=X[5],se=X[6],ee=X[7],R=X[8],de=X[9];for(;n>=16;)i=t[r+0]&255|(t[r+1]&255)<<8,U+=i&8191,o=t[r+2]&255|(t[r+3]&255)<<8,v+=(i>>>13|o<<3)&8191,a=t[r+4]&255|(t[r+5]&255)<<8,P+=(o>>>10|a<<6)&8191,p=t[r+6]&255|(t[r+7]&255)<<8,x+=(a>>>7|p<<9)&8191,l=t[r+8]&255|(t[r+9]&255)<<8,k+=(p>>>4|l<<12)&8191,M+=l>>>1&8191,h=t[r+10]&255|(t[r+11]&255)<<8,q+=(l>>>14|h<<2)&8191,y=t[r+12]&255|(t[r+13]&255)<<8,K+=(h>>>11|y<<5)&8191,A=t[r+14]&255|(t[r+15]&255)<<8,F+=(y>>>8|A<<8)&8191,J+=A>>>5|s,_=0,E=_,E+=U*S,E+=v*(5*de),E+=P*(5*R),E+=x*(5*ee),E+=k*(5*se),_=E>>>13,E&=8191,E+=M*(5*re),E+=q*(5*ce),E+=K*(5*fe),E+=F*(5*Q),E+=J*(5*D),_+=E>>>13,E&=8191,T=_,T+=U*D,T+=v*S,T+=P*(5*de),T+=x*(5*R),T+=k*(5*ee),_=T>>>13,T&=8191,T+=M*(5*se),T+=q*(5*re),T+=K*(5*ce),T+=F*(5*fe),T+=J*(5*Q),_+=T>>>13,T&=8191,w=_,w+=U*Q,w+=v*D,w+=P*S,w+=x*(5*de),w+=k*(5*R),_=w>>>13,w&=8191,w+=M*(5*ee),w+=q*(5*se),w+=K*(5*re),w+=F*(5*ce),w+=J*(5*fe),_+=w>>>13,w&=8191,C=_,C+=U*fe,C+=v*Q,C+=P*D,C+=x*S,C+=k*(5*de),_=C>>>13,C&=8191,C+=M*(5*R),C+=q*(5*ee),C+=K*(5*se),C+=F*(5*re),C+=J*(5*ce),_+=C>>>13,C&=8191,N=_,N+=U*ce,N+=v*fe,N+=P*Q,N+=x*D,N+=k*S,_=N>>>13,N&=8191,N+=M*(5*de),N+=q*(5*R),N+=K*(5*ee),N+=F*(5*se),N+=J*(5*re),_+=N>>>13,N&=8191,L=_,L+=U*re,L+=v*ce,L+=P*fe,L+=x*Q,L+=k*D,_=L>>>13,L&=8191,L+=M*S,L+=q*(5*de),L+=K*(5*R),L+=F*(5*ee),L+=J*(5*se),_+=L>>>13,L&=8191,B=_,B+=U*se,B+=v*re,B+=P*ce,B+=x*fe,B+=k*Q,_=B>>>13,B&=8191,B+=M*D,B+=q*S,B+=K*(5*de),B+=F*(5*R),B+=J*(5*ee),_+=B>>>13,B&=8191,$=_,$+=U*ee,$+=v*se,$+=P*re,$+=x*ce,$+=k*fe,_=$>>>13,$&=8191,$+=M*Q,$+=q*D,$+=K*S,$+=F*(5*de),$+=J*(5*R),_+=$>>>13,$&=8191,V=_,V+=U*R,V+=v*ee,V+=P*se,V+=x*re,V+=k*ce,_=V>>>13,V&=8191,V+=M*fe,V+=q*Q,V+=K*D,V+=F*S,V+=J*(5*de),_+=V>>>13,V&=8191,G=_,G+=U*de,G+=v*R,G+=P*ee,G+=x*se,G+=k*re,_=G>>>13,G&=8191,G+=M*ce,G+=q*fe,G+=K*Q,G+=F*D,G+=J*S,_+=G>>>13,G&=8191,_=(_<<2)+_|0,_=_+E|0,E=_&8191,_=_>>>13,T+=_,U=E,v=T,P=w,x=C,k=N,M=L,q=B,K=$,F=V,J=G,r+=16,n-=16;Y[0]=U,Y[1]=v,Y[2]=P,Y[3]=x,Y[4]=k,Y[5]=M,Y[6]=q,Y[7]=K,Y[8]=F,Y[9]=J}function cS(e,t,r){const n=new tt(10);let s,i,o,a;const{buffer:p,h:l,pad:h,leftover:y}=e;if(y){for(a=y,p[a++]=1;a<16;a++)p[a]=0;e.fin=1,zd(e,p,0,16)}for(s=l[1]>>>13,l[1]&=8191,a=2;a<10;a++)l[a]+=s,s=l[a]>>>13,l[a]&=8191;for(l[0]+=s*5,s=l[0]>>>13,l[0]&=8191,l[1]+=s,s=l[1]>>>13,l[1]&=8191,l[2]+=s,n[0]=l[0]+5,s=n[0]>>>13,n[0]&=8191,a=1;a<10;a++)n[a]=l[a]+s,s=n[a]>>>13,n[a]&=8191;for(n[9]-=8192,i=(s^1)-1,a=0;a<10;a++)n[a]&=i;for(i=~i,a=0;a<10;a++)l[a]=l[a]&i|n[a];for(l[0]=(l[0]|l[1]<<13)&65535,l[1]=(l[1]>>>3|l[2]<<10)&65535,l[2]=(l[2]>>>6|l[3]<<7)&65535,l[3]=(l[3]>>>9|l[4]<<4)&65535,l[4]=(l[4]>>>12|l[5]<<1|l[6]<<14)&65535,l[5]=(l[6]>>>2|l[7]<<11)&65535,l[6]=(l[7]>>>5|l[8]<<8)&65535,l[7]=(l[8]>>>8|l[9]<<5)&65535,o=l[0]+h[0],l[0]=o&65535,a=1;a<8;a++)o=(l[a]+h[a]|0)+(o>>>16)|0,l[a]=o&65535;t[r+0]=l[0]>>>0&255,t[r+1]=l[0]>>>8&255,t[r+2]=l[1]>>>0&255,t[r+3]=l[1]>>>8&255,t[r+4]=l[2]>>>0&255,t[r+5]=l[2]>>>8&255,t[r+6]=l[3]>>>0&255,t[r+7]=l[3]>>>8&255,t[r+8]=l[4]>>>0&255,t[r+9]=l[4]>>>8&255,t[r+10]=l[5]>>>0&255,t[r+11]=l[5]>>>8&255,t[r+12]=l[6]>>>0&255,t[r+13]=l[6]>>>8&255,t[r+14]=l[7]>>>0&255,t[r+15]=l[7]>>>8&255}function pS(e,t,r,n){let s,i;const{buffer:o}=e;if(e.leftover){for(i=16-e.leftover,i>n&&(i=n),s=0;s<i;s++)o[e.leftover+s]=t[r+s];if(n-=i,r+=i,e.leftover+=i,e.leftover<16)return;zd(e,o,0,16),e.leftover=0}if(n>=16&&(i=n-n%16,zd(e,t,r,i),r+=i,n-=i),n){for(s=0;s<n;s++)o[e.leftover+s]=t[r+s];e.leftover+=n}}function hS(e,t,r){vc(e,t,r),kI(r,t);const n=new tt(32+e.length),s=new tt(n.length);for(let i=0;i<e.length;i++)n[i+32]=e[i];return uS(s,n,n.length,t,r),s.subarray(16)}function lS(e,t,r){vc(e,t,r),kI(r,t);const n=new tt(16+e.length),s=new tt(n.length);for(let i=0;i<e.length;i++)n[i+16]=e[i];if(!(n.length<32||gS(s,n,n.length,t,r)!==0))return s.subarray(32)}function uS(e,t,r,n,s){if(r<32)return-1;xI(e,0,t,0,r,n,s),RI(e,16,e,32,r-32,e);for(let i=0;i<16;i++)e[i]=0;return 0}function gS(e,t,r,n,s){const i=new tt(32);if(r<32||(oS(i,0,32,n,s),fS(t,16,t,32,r-32,i)!==0))return-1;xI(e,0,t,0,r,n,s);for(let o=0;o<32;o++)e[o]=0;return 0}function RI(e,t,r,n,s,i){const o=aS(i);return pS(o,r,n,s),cS(o,e,t),0}function fS(e,t,r,n,s,i){const o=new tt(16);return RI(o,0,r,n,s,i),NS(e,t,o,0)}function ke(e){const t=new ul(16);return e&&t.set(e),t}const dS=new tt(16),yS=new tt(32);yS[0]=9;const Jd=ke(),Ec=ke([1]),mS=ke([56129,1]),_S=ke([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),AS=ke([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),EA=ke([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),IA=ke([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),ES=ke([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function Yn(e,t,r){for(let n=0;n<16;n++)e[n]=t[n]+r[n]}function Xn(e,t,r){for(let n=0;n<16;n++)e[n]=t[n]-r[n]}function nt(e,t,r){let n,s,i=0,o=0,a=0,p=0,l=0,h=0,y=0,A=0,_=0,E=0,T=0,w=0,C=0,N=0,L=0,B=0,$=0,V=0,G=0,Y=0,X=0,U=0,v=0,P=0,x=0,k=0,M=0,q=0,K=0,F=0,J=0,S=r[0],D=r[1],Q=r[2],fe=r[3],ce=r[4],re=r[5],se=r[6],ee=r[7],R=r[8],de=r[9],Ee=r[10],Ie=r[11],xe=r[12],Re=r[13],Be=r[14],Ue=r[15];n=t[0],i+=n*S,o+=n*D,a+=n*Q,p+=n*fe,l+=n*ce,h+=n*re,y+=n*se,A+=n*ee,_+=n*R,E+=n*de,T+=n*Ee,w+=n*Ie,C+=n*xe,N+=n*Re,L+=n*Be,B+=n*Ue,n=t[1],o+=n*S,a+=n*D,p+=n*Q,l+=n*fe,h+=n*ce,y+=n*re,A+=n*se,_+=n*ee,E+=n*R,T+=n*de,w+=n*Ee,C+=n*Ie,N+=n*xe,L+=n*Re,B+=n*Be,$+=n*Ue,n=t[2],a+=n*S,p+=n*D,l+=n*Q,h+=n*fe,y+=n*ce,A+=n*re,_+=n*se,E+=n*ee,T+=n*R,w+=n*de,C+=n*Ee,N+=n*Ie,L+=n*xe,B+=n*Re,$+=n*Be,V+=n*Ue,n=t[3],p+=n*S,l+=n*D,h+=n*Q,y+=n*fe,A+=n*ce,_+=n*re,E+=n*se,T+=n*ee,w+=n*R,C+=n*de,N+=n*Ee,L+=n*Ie,B+=n*xe,$+=n*Re,V+=n*Be,G+=n*Ue,n=t[4],l+=n*S,h+=n*D,y+=n*Q,A+=n*fe,_+=n*ce,E+=n*re,T+=n*se,w+=n*ee,C+=n*R,N+=n*de,L+=n*Ee,B+=n*Ie,$+=n*xe,V+=n*Re,G+=n*Be,Y+=n*Ue,n=t[5],h+=n*S,y+=n*D,A+=n*Q,_+=n*fe,E+=n*ce,T+=n*re,w+=n*se,C+=n*ee,N+=n*R,L+=n*de,B+=n*Ee,$+=n*Ie,V+=n*xe,G+=n*Re,Y+=n*Be,X+=n*Ue,n=t[6],y+=n*S,A+=n*D,_+=n*Q,E+=n*fe,T+=n*ce,w+=n*re,C+=n*se,N+=n*ee,L+=n*R,B+=n*de,$+=n*Ee,V+=n*Ie,G+=n*xe,Y+=n*Re,X+=n*Be,U+=n*Ue,n=t[7],A+=n*S,_+=n*D,E+=n*Q,T+=n*fe,w+=n*ce,C+=n*re,N+=n*se,L+=n*ee,B+=n*R,$+=n*de,V+=n*Ee,G+=n*Ie,Y+=n*xe,X+=n*Re,U+=n*Be,v+=n*Ue,n=t[8],_+=n*S,E+=n*D,T+=n*Q,w+=n*fe,C+=n*ce,N+=n*re,L+=n*se,B+=n*ee,$+=n*R,V+=n*de,G+=n*Ee,Y+=n*Ie,X+=n*xe,U+=n*Re,v+=n*Be,P+=n*Ue,n=t[9],E+=n*S,T+=n*D,w+=n*Q,C+=n*fe,N+=n*ce,L+=n*re,B+=n*se,$+=n*ee,V+=n*R,G+=n*de,Y+=n*Ee,X+=n*Ie,U+=n*xe,v+=n*Re,P+=n*Be,x+=n*Ue,n=t[10],T+=n*S,w+=n*D,C+=n*Q,N+=n*fe,L+=n*ce,B+=n*re,$+=n*se,V+=n*ee,G+=n*R,Y+=n*de,X+=n*Ee,U+=n*Ie,v+=n*xe,P+=n*Re,x+=n*Be,k+=n*Ue,n=t[11],w+=n*S,C+=n*D,N+=n*Q,L+=n*fe,B+=n*ce,$+=n*re,V+=n*se,G+=n*ee,Y+=n*R,X+=n*de,U+=n*Ee,v+=n*Ie,P+=n*xe,x+=n*Re,k+=n*Be,M+=n*Ue,n=t[12],C+=n*S,N+=n*D,L+=n*Q,B+=n*fe,$+=n*ce,V+=n*re,G+=n*se,Y+=n*ee,X+=n*R,U+=n*de,v+=n*Ee,P+=n*Ie,x+=n*xe,k+=n*Re,M+=n*Be,q+=n*Ue,n=t[13],N+=n*S,L+=n*D,B+=n*Q,$+=n*fe,V+=n*ce,G+=n*re,Y+=n*se,X+=n*ee,U+=n*R,v+=n*de,P+=n*Ee,x+=n*Ie,k+=n*xe,M+=n*Re,q+=n*Be,K+=n*Ue,n=t[14],L+=n*S,B+=n*D,$+=n*Q,V+=n*fe,G+=n*ce,Y+=n*re,X+=n*se,U+=n*ee,v+=n*R,P+=n*de,x+=n*Ee,k+=n*Ie,M+=n*xe,q+=n*Re,K+=n*Be,F+=n*Ue,n=t[15],B+=n*S,$+=n*D,V+=n*Q,G+=n*fe,Y+=n*ce,X+=n*re,U+=n*se,v+=n*ee,P+=n*R,x+=n*de,k+=n*Ee,M+=n*Ie,q+=n*xe,K+=n*Re,F+=n*Be,J+=n*Ue,i+=38*$,o+=38*V,a+=38*G,p+=38*Y,l+=38*X,h+=38*U,y+=38*v,A+=38*P,_+=38*x,E+=38*k,T+=38*M,w+=38*q,C+=38*K,N+=38*F,L+=38*J,s=1,n=i+s+65535,s=Math.floor(n/65536),i=n-s*65536,n=o+s+65535,s=Math.floor(n/65536),o=n-s*65536,n=a+s+65535,s=Math.floor(n/65536),a=n-s*65536,n=p+s+65535,s=Math.floor(n/65536),p=n-s*65536,n=l+s+65535,s=Math.floor(n/65536),l=n-s*65536,n=h+s+65535,s=Math.floor(n/65536),h=n-s*65536,n=y+s+65535,s=Math.floor(n/65536),y=n-s*65536,n=A+s+65535,s=Math.floor(n/65536),A=n-s*65536,n=_+s+65535,s=Math.floor(n/65536),_=n-s*65536,n=E+s+65535,s=Math.floor(n/65536),E=n-s*65536,n=T+s+65535,s=Math.floor(n/65536),T=n-s*65536,n=w+s+65535,s=Math.floor(n/65536),w=n-s*65536,n=C+s+65535,s=Math.floor(n/65536),C=n-s*65536,n=N+s+65535,s=Math.floor(n/65536),N=n-s*65536,n=L+s+65535,s=Math.floor(n/65536),L=n-s*65536,n=B+s+65535,s=Math.floor(n/65536),B=n-s*65536,i+=s-1+37*(s-1),s=1,n=i+s+65535,s=Math.floor(n/65536),i=n-s*65536,n=o+s+65535,s=Math.floor(n/65536),o=n-s*65536,n=a+s+65535,s=Math.floor(n/65536),a=n-s*65536,n=p+s+65535,s=Math.floor(n/65536),p=n-s*65536,n=l+s+65535,s=Math.floor(n/65536),l=n-s*65536,n=h+s+65535,s=Math.floor(n/65536),h=n-s*65536,n=y+s+65535,s=Math.floor(n/65536),y=n-s*65536,n=A+s+65535,s=Math.floor(n/65536),A=n-s*65536,n=_+s+65535,s=Math.floor(n/65536),_=n-s*65536,n=E+s+65535,s=Math.floor(n/65536),E=n-s*65536,n=T+s+65535,s=Math.floor(n/65536),T=n-s*65536,n=w+s+65535,s=Math.floor(n/65536),w=n-s*65536,n=C+s+65535,s=Math.floor(n/65536),C=n-s*65536,n=N+s+65535,s=Math.floor(n/65536),N=n-s*65536,n=L+s+65535,s=Math.floor(n/65536),L=n-s*65536,n=B+s+65535,s=Math.floor(n/65536),B=n-s*65536,i+=s-1+37*(s-1),e[0]=i,e[1]=o,e[2]=a,e[3]=p,e[4]=l,e[5]=h,e[6]=y,e[7]=A,e[8]=_,e[9]=E,e[10]=T,e[11]=w,e[12]=C,e[13]=N,e[14]=L,e[15]=B}function Qn(e,t){nt(e,t,t)}function Oi(e,t){for(let r=0;r<16;r++)e[r]=t[r]|0}function Jg(e){let t,r,n=1;for(t=0;t<16;t++)r=e[t]+n+65535,n=Math.floor(r/65536),e[t]=r-n*65536;e[0]+=n-1+37*(n-1)}function Ca(e,t,r){let n,s=~(r-1);for(let i=0;i<16;i++)n=s&(e[i]^t[i]),e[i]^=n,t[i]^=n}function Ic(e,t){const r=ke(),n=ke();let s,i,o;for(s=0;s<16;s++)n[s]=t[s];for(Jg(n),Jg(n),Jg(n),i=0;i<2;i++){for(r[0]=n[0]-65517,s=1;s<15;s++)r[s]=n[s]-65535-(r[s-1]>>16&1),r[s-1]&=65535;r[15]=n[15]-32767-(r[14]>>16&1),o=r[15]>>16&1,r[14]&=65535,Ca(n,r,1-o)}for(s=0;s<16;s++)e[2*s]=n[s]&255,e[2*s+1]=n[s]>>8}function TA(e,t){const r=new tt(32),n=new tt(32);return Ic(r,e),Ic(n,t),MI(r,0,n,0)}function vI(e){const t=new tt(32);return Ic(t,e),t[0]&1}function BI(e,t){for(let r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}function Nm(e,t){const r=ke();let n;for(n=0;n<16;n++)r[n]=t[n];for(n=253;n>=0;n--)Qn(r,r),n!==2&&n!==4&&nt(r,r,t);for(n=0;n<16;n++)e[n]=r[n]}function IS(e,t,r){const n=new tt(32),s=new ul(80),i=ke(),o=ke(),a=ke(),p=ke(),l=ke(),h=ke();let y,A;for(A=0;A<31;A++)n[A]=t[A];for(n[31]=t[31]&127|64,n[0]&=248,BI(s,r),A=0;A<16;A++)o[A]=s[A],p[A]=i[A]=a[A]=0;for(i[0]=p[0]=1,A=254;A>=0;--A)y=n[A>>>3]>>>(A&7)&1,Ca(i,o,y),Ca(a,p,y),Yn(l,i,a),Xn(i,i,a),Yn(a,o,p),Xn(o,o,p),Qn(p,l),Qn(h,i),nt(i,a,i),nt(a,o,l),Yn(l,i,a),Xn(i,i,a),Qn(o,i),Xn(a,p,h),nt(i,a,mS),Yn(i,i,p),nt(a,a,i),nt(i,p,h),nt(p,o,s),Qn(o,l),Ca(i,o,y),Ca(a,p,y);for(A=0;A<16;A++)s[A+16]=i[A],s[A+32]=a[A],s[A+48]=o[A],s[A+64]=p[A];const _=s.subarray(32),E=s.subarray(16);return Nm(_,_),nt(E,E,_),Ic(e,E),0}function TS(e,t,r,n){const s=PI(r,n);return hS(e,t,s)}function PI(e,t){vc(e,t),SS(e,t);const r=new tt(32);return wS(r,e,t),r}function bS(e,t,r,n){const s=PI(r,n);return lS(e,t,s)}function wS(e,t,r){const n=new tt(32);return IS(n,r,t),Sm(e,dS,n,$o)}function kI(e,t){if(e.length!==32)throw new Error("bad key size");if(t.length!==24)throw new Error("bad nonce size")}function SS(e,t){if(e.length!==32)throw new Error("bad public key size");if(t.length!==32)throw new Error("bad secret key size")}function vc(...e){for(const t of e)if(!(t instanceof Uint8Array))throw new TypeError("unexpected type, use ByteArray")}function HI(e,t,r,n,s){let i,o=0;for(i=0;i<s;i++)o|=e[t+i]^r[n+i];return(1&o-1>>>8)-1}function NS(e,t,r,n){return HI(e,t,r,n,16)}function MI(e,t,r,n){return HI(e,t,r,n,32)}function xa(e,t,r){const n=new Vu(8),s=new Vu(8),i=new tt(256);let o,a=r;for(n[0]=1779033703,n[1]=3144134277,n[2]=1013904242,n[3]=2773480762,n[4]=1359893119,n[5]=2600822924,n[6]=528734635,n[7]=1541459225,s[0]=4089235720,s[1]=2227873595,s[2]=4271175723,s[3]=1595750129,s[4]=2917565137,s[5]=725511199,s[6]=4215389547,s[7]=327033209,wA(n,s,t,r),r%=128,o=0;o<r;o++)i[o]=t[a-r+o];for(i[r]=128,r=256-128*(r<112?1:0),i[r-9]=0,SA(i,r-8,a/536870912|0,a<<3),wA(n,s,i,r),o=0;o<8;o++)SA(e,8*o,n[o],s[o]);return 0}const bA=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function wA(e,t,r,n){const s=new Vu(16),i=new Vu(16);let o,a,p,l,h,y,A,_,E,T,w,C,N,L,B,$,V,G,Y,X,U,v,P,x,k,M,q=e[0],K=e[1],F=e[2],J=e[3],S=e[4],D=e[5],Q=e[6],fe=e[7],ce=t[0],re=t[1],se=t[2],ee=t[3],R=t[4],de=t[5],Ee=t[6],Ie=t[7],xe=0;for(;n>=128;){for(Y=0;Y<16;Y++)X=8*Y+xe,s[Y]=r[X+0]<<24|r[X+1]<<16|r[X+2]<<8|r[X+3],i[Y]=r[X+4]<<24|r[X+5]<<16|r[X+6]<<8|r[X+7];for(Y=0;Y<80;Y++)if(o=q,a=K,p=F,l=J,h=S,y=D,A=Q,_=fe,E=ce,T=re,w=se,C=ee,N=R,L=de,B=Ee,$=Ie,U=fe,v=Ie,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=(S>>>14|R<<18)^(S>>>18|R<<14)^(R>>>9|S<<23),v=(R>>>14|S<<18)^(R>>>18|S<<14)^(S>>>9|R<<23),P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,U=S&D^~S&Q,v=R&de^~R&Ee,P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,U=bA[Y*2],v=bA[Y*2+1],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,U=s[Y%16],v=i[Y%16],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,V=k&65535|M<<16,G=P&65535|x<<16,U=V,v=G,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=(q>>>28|ce<<4)^(ce>>>2|q<<30)^(ce>>>7|q<<25),v=(ce>>>28|q<<4)^(q>>>2|ce<<30)^(q>>>7|ce<<25),P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,U=q&K^q&F^K&F,v=ce&re^ce&se^re&se,P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,_=k&65535|M<<16,$=P&65535|x<<16,U=l,v=C,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=V,v=G,P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,l=k&65535|M<<16,C=P&65535|x<<16,K=o,F=a,J=p,S=l,D=h,Q=y,fe=A,q=_,re=E,se=T,ee=w,R=C,de=N,Ee=L,Ie=B,ce=$,Y%16===15)for(X=0;X<16;X++)U=s[X],v=i[X],P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=s[(X+9)%16],v=i[(X+9)%16],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,V=s[(X+1)%16],G=i[(X+1)%16],U=(V>>>1|G<<31)^(V>>>8|G<<24)^V>>>7,v=(G>>>1|V<<31)^(G>>>8|V<<24)^(G>>>7|V<<25),P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,V=s[(X+14)%16],G=i[(X+14)%16],U=(V>>>19|G<<13)^(G>>>29|V<<3)^V>>>6,v=(G>>>19|V<<13)^(V>>>29|G<<3)^(G>>>6|V<<26),P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,s[X]=k&65535|M<<16,i[X]=P&65535|x<<16;U=q,v=ce,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=e[0],v=t[0],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,e[0]=q=k&65535|M<<16,t[0]=ce=P&65535|x<<16,U=K,v=re,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=e[1],v=t[1],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,e[1]=K=k&65535|M<<16,t[1]=re=P&65535|x<<16,U=F,v=se,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=e[2],v=t[2],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,e[2]=F=k&65535|M<<16,t[2]=se=P&65535|x<<16,U=J,v=ee,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=e[3],v=t[3],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,e[3]=J=k&65535|M<<16,t[3]=ee=P&65535|x<<16,U=S,v=R,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=e[4],v=t[4],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,e[4]=S=k&65535|M<<16,t[4]=R=P&65535|x<<16,U=D,v=de,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=e[5],v=t[5],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,e[5]=D=k&65535|M<<16,t[5]=de=P&65535|x<<16,U=Q,v=Ee,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=e[6],v=t[6],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,e[6]=Q=k&65535|M<<16,t[6]=Ee=P&65535|x<<16,U=fe,v=Ie,P=v&65535,x=v>>>16,k=U&65535,M=U>>>16,U=e[7],v=t[7],P+=v&65535,x+=v>>>16,k+=U&65535,M+=U>>>16,x+=P>>>16,k+=x>>>16,M+=k>>>16,e[7]=fe=k&65535|M<<16,t[7]=Ie=P&65535|x<<16,xe+=128,n-=128}return n}function SA(e,t,r,n){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=r&255,e[t+4]=n>>24&255,e[t+5]=n>>16&255,e[t+6]=n>>8&255,e[t+7]=n&255}function OS(e,t){if(vc(e,t),t.length!==64)throw new Error("bad secret key size");const r=new tt(64+e.length);return BS(r,e,e.length,t),r}function CS(e,t){const r=OS(e,t),n=new tt(64);for(let s=0;s<n.length;s++)n[s]=r[s];return n}function xS(e,t,r){if(vc(e,t,r),t.length!==64)throw new Error("bad signature size");if(r.length!==32)throw new Error("bad public key size");const n=new tt(64+e.length),s=new tt(64+e.length);return n.set(t),n.set(e,64),PS(s,n,n.length,r)>=0}function RS(e){if(vc(e),e.length!==32)throw new Error("bad seed size");const t=new tt(32),r=new tt(64);for(let n=0;n<32;n++)r[n]=e[n];return vS(t,r),{publicKey:t,secretKey:r}}function vS(e,t,r){const n=new tt(64),s=[ke(),ke(),ke(),ke()];let i;for(xa(n,t,32),n[0]&=248,n[31]&=127,n[31]|=64,Om(s,n),Cm(e,s),i=0;i<32;i++)t[i+32]=e[i];return 0}function BS(e,t,r,n){const s=new tt(64),i=new tt(64),o=new tt(64),a=new ul(64),p=[ke(),ke(),ke(),ke()];let l,h;xa(s,n,32),s[0]&=248,s[31]&=127,s[31]|=64;const y=r+64;for(l=0;l<r;l++)e[64+l]=t[l];for(l=0;l<32;l++)e[32+l]=s[32+l];for(xa(o,e.subarray(32),r+32),Yd(o),Om(p,o),Cm(e,p),l=32;l<64;l++)e[l]=n[l];for(xa(i,e,r+64),Yd(i),l=0;l<64;l++)a[l]=0;for(l=0;l<32;l++)a[l]=o[l];for(l=0;l<32;l++)for(h=0;h<32;h++)a[l+h]+=i[l]*s[h];return FI(e.subarray(32),a),y}function PS(e,t,r,n){const s=new tt(32),i=new tt(64),o=[ke(),ke(),ke(),ke()],a=[ke(),ke(),ke(),ke()];let p,l;if(l=-1,r<64||DI(a,n))return-1;for(p=0;p<r;p++)e[p]=t[p];for(p=0;p<32;p++)e[p+32]=n[p];if(xa(i,e,r),Yd(i),LI(o,a,i),Om(a,t.subarray(32)),Qd(o,a),Cm(s,o),r-=64,MI(t,0,s,0)){for(p=0;p<r;p++)e[p]=0;return-1}for(p=0;p<r;p++)e[p]=t[p+64];return l=r,l}function Om(e,t){const r=[ke(),ke(),ke(),ke()];Oi(r[0],EA),Oi(r[1],IA),Oi(r[2],Ec),nt(r[3],EA,IA),LI(e,r,t)}function LI(e,t,r){let n,s;for(Oi(e[0],Jd),Oi(e[1],Ec),Oi(e[2],Ec),Oi(e[3],Jd),s=255;s>=0;--s)n=r[s/8|0]>>(s&7)&1,NA(e,t,n),Qd(t,e),Qd(e,e),NA(e,t,n)}function Cm(e,t){const r=ke(),n=ke(),s=ke();Nm(s,t[2]),nt(r,t[0],s),nt(n,t[1],s),Ic(e,n),e[31]^=vI(r)<<7}function DI(e,t){const r=ke(),n=ke(),s=ke(),i=ke(),o=ke(),a=ke(),p=ke();return Oi(e[2],Ec),BI(e[1],t),Qn(s,e[1]),nt(i,s,_S),Xn(s,s,e[2]),Yn(i,e[2],i),Qn(o,i),Qn(a,o),nt(p,a,o),nt(r,p,s),nt(r,r,i),kS(r,r),nt(r,r,s),nt(r,r,i),nt(r,r,i),nt(e[0],r,i),Qn(n,e[0]),nt(n,n,i),TA(n,s)&&nt(e[0],e[0],ES),Qn(n,e[0]),nt(n,n,i),TA(n,s)?-1:(vI(e[0])===t[31]>>7&&Xn(e[0],Jd,e[0]),nt(e[3],e[0],e[1]),0)}function Yd(e){const t=new ul(64);let r;for(r=0;r<64;r++)t[r]=e[r];for(r=0;r<64;r++)e[r]=0;FI(e,t)}const Yg=new ul([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function FI(e,t){let r,n,s,i;for(n=63;n>=32;--n){for(r=0,s=n-32,i=n-12;s<i;++s)t[s]+=r-16*t[n]*Yg[s-(n-32)],r=Math.floor((t[s]+128)/256),t[s]-=r*256;t[s]+=r,t[n]=0}for(r=0,s=0;s<32;s++)t[s]+=r-(t[31]>>4)*Yg[s],r=t[s]>>8,t[s]&=255;for(s=0;s<32;s++)t[s]-=r*Yg[s];for(n=0;n<32;n++)t[n+1]+=t[n]>>8,e[n]=t[n]&255}function Qd(e,t){const r=ke(),n=ke(),s=ke(),i=ke(),o=ke(),a=ke(),p=ke(),l=ke(),h=ke();Xn(r,e[1],e[0]),Xn(h,t[1],t[0]),nt(r,r,h),Yn(n,e[0],e[1]),Yn(h,t[0],t[1]),nt(n,n,h),nt(s,e[3],t[3]),nt(s,s,AS),nt(i,e[2],t[2]),Yn(i,i,i),Xn(o,n,r),Xn(a,i,s),Yn(p,i,s),Yn(l,n,r),nt(e[0],o,a),nt(e[1],l,p),nt(e[2],p,a),nt(e[3],o,l)}function NA(e,t,r){for(let n=0;n<4;n++)Ca(e[n],t[n],r)}function kS(e,t){const r=ke();let n;for(n=0;n<16;n++)r[n]=t[n];for(n=250;n>=0;n--)Qn(r,r),n!==1&&nt(r,r,t);for(n=0;n<16;n++)e[n]=r[n]}const HS={create(e){const t=RS(e);return{secretKey:Hr.from(t.secretKey),publicKey:Hr.from(t.publicKey)}},detached_sign(e,t){return Hr.from(CS(e,t))},detached_verify(e,t,r){return xS(e,t,r)},box(e,t,r,n=new Uint8Array(24)){return{encryptedMessage:TS(e,n,t,r),nonce:n}},open(e,t,r,n){return bS(e,t,r,n)||!1}};function MS(e){let t=new Uint8Array(32),r=[ke(),ke(),ke(),ke()],n=ke(),s=ke();if(DI(r,e))throw new TypeError("invalid public key");let i=r[1];return Yn(n,Ec,i),Xn(s,Ec,i),Nm(s,s),nt(n,n,s),Ic(t,n),t}function LS(e){let t=new Uint8Array(64),r=new Uint8Array(32),n;for(xa(t,e,32),t[0]&=248,t[31]&=127,t[31]|=64,n=0;n<32;n++)r[n]=t[n];for(n=0;n<64;n++)t[n]=0;return r}const DS={convertPublicKey:MS,convertSecretKey:LS};let OA=class{createRemark(e){return cp.fromObject({remark:e})}};OA=u([ie()],OA);const FS={CURRENT_HEIGHT:Symbol("currentHeight")};let Vo=class{constructor(e=0){this.currentHeight=e,this.emitter=new Rn,this.emitter.on("height",t=>{const r=this.currentHeight;this.currentHeight=t,this.emitter.emit("heightChanged",{oldHeight:r,newHeight:t})})}changeHeight(e){this.emitter.emit("height",e)}onHeightChanged(e){this.emitter.on("heightChanged",e)}planAfterHeight(e,t,r){let n=0;this.emitter.on("heightChanged",({newHeight:s,oldHeight:i})=>{s>i?s>=e&&n!==1&&(t(),n=1):s<e&&n!==0&&(r(),n=0)}),this.currentHeight>=e&&(t(),n=1)}get version(){return this._version}};u([Z(ue),g("design:type",ue)],Vo.prototype,"config",void 0);u([Z(Jh),g("design:type",Jh)],Vo.prototype,"block",void 0);u([Z("blockGetterHelper",{optional:!0,dynamics:!0}),g("design:type",Object)],Vo.prototype,"blockGetterHelper",void 0);Vo=u([ie({group:!0}),Ce(0,Z(FS.CURRENT_HEIGHT,{optional:!0})),g("design:paramtypes",[Number])],Vo);let Xd=class extends kl{constructor(e,t){super(),this.moduleMap=e,this.config=t,this._consensusVersionAndHeightMap=new Map,this._lastConsensusVersion=1,this._lastPatchEffectiveHeight=1,this._patchVersionMap=new kt(()=>0)}bfAfterInit(){this._isPatchReady=this._installPatchs().then(()=>{this._isPatchReady=void 0})}get lastConsensusVersion(){return this._lastConsensusVersion}get lastPatchEffectiveHeight(){return this._lastPatchEffectiveHeight}_installPatch(e){Ht(e,this.moduleMap)}async getPatchEffectiveAfterHeightByVersion(e){let t=0;if(e<=1)return 0;await this._isPatchReady;for(const[r,n]of this._consensusVersionAndHeightMap.entries()){if(e===r)return n;t=n}return t}async changeHeight(e){await this._isPatchReady;const t=this.moduleMap.groupGet(Vo);for(const r of t)r.changeHeight(e)}async _installPatchs(){const e=[...this.moduleMap.groupGet(Vo)];e.sort((n,s)=>n.version-s.version);const t=new kt(n=>e.filter(s=>s.name===n).sort((s,i)=>i.version-s.version)[0].version),r=new Rn;this.config.version;try{for(const n of e){r.emit("progress",n);const s=this._patchVersionMap.forceGet(n.name);if(s<n.version){this._consensusVersionAndHeightMap.set(n.consensusVersion,n.patchEffectiveAfterHeight);const i=t.forceGet(n.name);await n.upgradeHandler(s,i),this._patchVersionMap.set(n.name,n.version),this._lastConsensusVersion<n.consensusVersion&&(this._lastConsensusVersion=n.consensusVersion),this._lastPatchEffectiveHeight<n.patchEffectiveAfterHeight&&(this._lastPatchEffectiveHeight=n.patchEffectiveAfterHeight)}}r.emit("done")}catch(n){this.emit("error",n),r.emit("error",n)}this.config.version}};Xd=u([ie(),g("design:paramtypes",[et,ue])],Xd);let Zh=class{constructor(e,t,r,n,s,i,o,a,p,l,h,y,A,_,E,T,w,C,N,L,B,$,V,G,Y,X,U,v){this.config=e,this.cryptoHelper=t,this.keypairHelper=r,this.ed2curveHelper=n,this.Buffer=s,this.base58Helper=i,this.jsbiHelper=o,this.asymmetricHelper=a,this.accountBaseHelper=p,this.transactionHelper=l,this.blockHelper=h,this.parityBitHelper=y,this.baseHelper=A,this.chainAssetInfoHelper=_,this.migrateCertificateHelper=E,this.registerChainCertificateHelper=T,this.complexTransactionLogicHelper=w,this.configMap=C,this.block=N,this.blockLogicVerifier=L,this.blockTicker=B,this.transaction=$,this.transactionLogicVerifier=V,this.channel=G,this.time=Y,this.moduleMap=X,this.patchInstaller=U,this.i18N=v,this.i18N.addErrorCodeList("BFCHAIN-CORE",c,H0)}};Zh=u([ie(),Ce(1,Z("cryptoHelper")),Ce(2,Z("keypairHelper")),Ce(3,Z("ed2curveHelper")),Ce(4,Z("Buffer")),g("design:paramtypes",[ue,Object,Object,Object,Object,ql,Lt,Fr,Te,we,wt,Wl,Le,Ge,si,eu,Ur,Dr,Jh,Pd,Ld,Qt,ii,jd,Yt,et,Xd,ff])],Zh);function UI(e,t=new et,r){["config","Buffer","cryptoHelper","keypairHelper","ed2curveHelper","blockGetterHelper","blobSha256Reader","blobSha256Writer","TIME_SPEED"].forEach(s=>{t.has(s)||t.set(s,e[s])});let n=t.get("configMap");return n||(n=new Dr,t.set("configMap",n)),n.set(e.config.magic,e.config),r&&r.forEach(s=>{Ht(s,t)}),t.set("BFChainCoreFactory",UI),Ht(Zh,t)}let _n=class{constructor(){this.defaultDiffHeight=20}async _createSomeTransaction(e,t,r,n,s){const{transactionCore:i,timeHelper:o,config:a,accountBaseHelper:p}=this,l=await p.createSecretKeypair(t.mainSecret);let h;t.paySecret&&(h=await this.accountBaseHelper.createSecondSecretKeypair(t.mainSecret,t.paySecret));const y=await this.transactionCore.getTransactionTypeFromTransactionFactoryConstructor(e),A=await p.getAddressFromPublicKey(l.publicKey),_=l.publicKey.toString("hex"),E=r.applyBlockHeight||1,T=h&&h.publicKey.toString("hex"),w=r.fromMagic||a.magic,C=r.toMagic||a.magic,N={...this.customTrsRemark,...r.remark||{}};let L,B=0;const $=[];r.recipientId&&(typeof r.recipientId=="string"?L=r.recipientId:(B=r.recipientId.type,$.push(...r.recipientId.range)));let V;r.effectiveBlockHeight?V=await this.checkEffectiveBlockHeight(r.effectiveBlockHeight,E):V=await this.calcEffectiveBlockHeight(E);const G=(X,U=!0)=>i.createTransaction(e,{version:this.config.version,type:y,senderId:A,senderPublicKey:_,senderSecondPublicKey:T,recipientId:L||void 0,range:$,rangeType:B,fee:X,timestamp:r.timestamp||(r.timestamp=o.getTimestamp()),dappid:r.dappid||void 0,lns:r.lns||void 0,sourceIP:r.sourceIP||void 0,fromMagic:w,toMagic:C,applyBlockHeight:E,effectiveBlockHeight:V,remark:N,storage:s},n,l,h,this.config);let Y=r.fee;if(Y.startsWith("AUTO")){const X=[];(r.fee.startsWith("AUTO:")?r.fee.slice(5).split(","):[]).forEach(x=>{const k=x[0];k==="*"?X.push({type:"mul",rate:parseFloat(x.slice(1))||1}):k===">"&&X.push({type:"max",value:BigInt(x.slice(1))})});let U="1";const{maxTransactionSize:v,minTransactionFeePerByte:P}=this.config;if(y===this.transactionHelper.GIFT_ASSET){const{totalGrabableTimes:x}=n.giftAsset;U=this.jsbiHelper.multiplyCeilFraction(v*(x+1),P).toString()}else if(y===this.transactionHelper.TRUST_ASSET){const{numberOfSignFor:x}=n.trustAsset;U=this.jsbiHelper.multiplyCeilFraction(v*(x+1),P).toString()}else if(y===this.transactionHelper.GIFT_ANY){const{totalGrabableTimes:x}=n.giftAny;U=this.jsbiHelper.multiplyCeilFraction(v*(x+1),P).toString()}Y=this.calcTransactionFee(await G(U,!0),{modes:X})}return await G(Y)}createSignatureTransaction(e,t,r){return this._createSomeTransaction(tu,e,t,r)}createTransferAssetTransaction(e,t,r){return this._createSomeTransaction(nu,e,t,r,{key:"assetType",value:r.transferAsset.assetType})}createTransferAnyTransaction(e,t,r,n=!1){return this._createSomeTransaction(su,e,t,r,n?void 0:{key:"assetType",value:r.transferAny.assetType})}createIssueEntityFactoryTransaction(e,t,r){return this._createSomeTransaction(uu,e,t,r,{key:"factoryId",value:r.issueEntityFactory.factoryId})}createIssueEntityTransaction(e,t,r){return this._createSomeTransaction(gu,e,t,r,{key:"entityId",value:r.issueEntity.entityId})}createIssueEntityMultiTransaction(e,t,r){return this._createSomeTransaction(du,e,t,r,{key:"factoryId",value:r.issueEntityMulti.entityFactory.factoryId})}createToExchangeAnyTransaction(e,t,r){return this._createSomeTransaction(Kh,e,t,r)}createBeExchangeAnyTransaction(e,t,r){return this._createSomeTransaction(fu,e,t,r,{key:"transactionSignature",value:r.beExchangeAny.transactionSignature})}createToExchangeAnyMultiTransaction(e,t,r){return this._createSomeTransaction(yu,e,t,r)}createBeExchangeAnyMultiTransaction(e,t,r){return this._createSomeTransaction(mu,e,t,r,{key:"transactionSignature",value:r.beExchangeAnyMulti.transactionSignature})}createGiftAnyTransaction(e,t,r){return this._createSomeTransaction(Gh,e,t,r,{key:"assetType",value:r.giftAny.assetType})}createGrabAnyTransaction(e,t,r){return this._createSomeTransaction(pu,e,t,r,{key:"transactionSignature",value:r.grabAny.transactionSignature})}createDestoryAssetTransaction(e,t,r){return this._createSomeTransaction(iu,e,t,r,{key:"assetType",value:r.destroyAsset.assetType})}calcTransactionFee(e,t={}){const{minTransactionFeePerByte:r=this.config.minTransactionFeePerByte,modes:n}=t;let s=e.getBytes().length,i=e.fee;do{const o=this.jsbiHelper.multiplyCeilFraction(s,r),a=o.toString();if(a.length<=i.length){let p=o;if(n)for(const h of n)h.type==="mul"?p=this.jsbiHelper.multiplyCeil(p,h.rate):h.type==="max"&&h.value>p&&(p=h.value);const l=BigInt(e.fee);return(l>p?l>o?l:o:p).toString()}s+=a.length-i.length,i=a}while(!0)}calcEffectiveBlockHeight(e){return this.checkEffectiveBlockHeight(e+this.defaultDiffHeight,e)}checkEffectiveBlockHeight(e,t){const r=t+this.config.maxApplyAndConfirmedBlockHeightDiff,n=t+this.config.blockPerRound*2;return e<n&&(e=n),e>r?r:e}};u([Z("customTrsRemark",{optional:!0,dynamics:!0}),g("design:type",Object)],_n.prototype,"customTrsRemark",void 0);u([Z(Qt),g("design:type",Qt)],_n.prototype,"transactionCore",void 0);u([Z(we),g("design:type",we)],_n.prototype,"transactionHelper",void 0);u([Z(Yt),g("design:type",Yt)],_n.prototype,"timeHelper",void 0);u([Z(ue),g("design:type",ue)],_n.prototype,"config",void 0);u([Z(si),g("design:type",si)],_n.prototype,"migrateCertificateHelper",void 0);u([Z(Lt),g("design:type",Lt)],_n.prototype,"jsbiHelper",void 0);u([Z(zl),g("design:type",zl)],_n.prototype,"flagsHelper",void 0);u([Z(Te),g("design:type",Te)],_n.prototype,"accountBaseHelper",void 0);_n=u([ie()],_n);let Ku=class extends _n{async createTransferTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createTransferAssetTransaction(t,s,{transferAsset:{sourceChainName:n.sourceChainName||this.config.chainName,sourceChainMagic:n.sourceChainMagic,assetType:n.assetType,amount:n.amount}})).toJSON()}async getTransferTransactionMinFee(e){const{transaction:t,assetInfo:r}=e,n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:await this.accountBaseHelper.getAddressFromSecret(`secrets:${Date.now()}-getRecipientId`),remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight},i=await this.createTransferAssetTransaction(n,s,{transferAsset:{sourceChainName:r.sourceChainName||this.config.chainName,sourceChainMagic:r.sourceChainMagic,assetType:r.assetType,amount:r.amount}}),o=(this.transactionHelper.calcTransactionMinFeeByBytes(i,i.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(2))}async createSignatureTransactionJSON(e,t){const r=await this.accountBaseHelper.getPublicKeyStringFromSecondSecret(e.mainSecret,t.newPaySecret);return(await this.createSignatureTransaction(e,{fee:t.fee,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight},{signature:{publicKey:r}})).toJSON()}async getSignatureTransactionMinFee(e){const t={mainSecret:`secrets:${Date.now()}`,paySecret:"1"+e.newPaySecret},r=await this.accountBaseHelper.getPublicKeyStringFromSecondSecret(t.mainSecret,e.newPaySecret),n=await this.createSignatureTransaction(t,{fee:"1",applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},{signature:{publicKey:r}}),s=(this.transactionHelper.calcTransactionMinFeeByBytes(n,n.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(n)).toString();return String(BigInt(s)*BigInt(2))}async createCertificateTransferTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createTransferAnyTransaction(t,s,{transferAny:{...n,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,parentAssetType:ne.CERTIFICATE}})).toJSON()}async createEntityTransferTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createTransferAnyTransaction(t,s,{transferAny:{...n,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,parentAssetType:ne.ENTITY}})).toJSON()}async createEntityTransferTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"1",recipientId:await this.accountBaseHelper.getAddressFromSecret(`secrets:${Date.now()}-getRecipientId`),remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},s=await this.createTransferAnyTransaction(r,n,{transferAny:{...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,parentAssetType:ne.ENTITY}}),i=(this.transactionHelper.calcTransactionMinFeeByBytes(s,s.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(s)).toString();return String(BigInt(i)*BigInt(12)/BigInt(10))}async createDestoryAssetTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createDestoryAssetTransaction(t,s,{destroyAsset:{sourceChainName:n.sourceChainName||this.config.chainName,sourceChainMagic:n.sourceChainMagic,assetType:n.assetType,amount:n.amount}})).toJSON()}async getDestoryAssetTransactionMinFee(e){const{transaction:t,assetInfo:r}=e,n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:await this.accountBaseHelper.getAddressFromSecret(`secrets:${Date.now()}-getRecipientId`),remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight},i=await this.createDestoryAssetTransaction(n,s,{destroyAsset:{sourceChainName:r.sourceChainName||this.config.chainName,sourceChainMagic:r.sourceChainMagic,assetType:r.assetType,amount:r.amount}}),o=(this.transactionHelper.calcTransactionMinFeeByBytes(i,i.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(2))}};Ku=u([ie()],Ku);let ju=class extends _n{async createIssueEntityFactoryTransactionJSON(e,t,r){const n={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight,recipientId:t.recipientId},s={...r,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName};return(await this.createIssueEntityFactoryTransaction(e,n,{issueEntityFactory:s})).toJSON()}async getCreateIssueEntityFactoryTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight,recipientId:e.recipientId},s={...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},i=await this.createIssueEntityFactoryTransaction(r,n,{issueEntityFactory:s}),o=(this.transactionHelper.calcTransactionMinFeeByBytes(i,i.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(105)/BigInt(100))}async createIssueEntityTransactionJSON(e,t,r){const n={...r.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...r,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},i={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight,recipientId:t.recipientId};return(await this.createIssueEntityTransaction(e,i,{issueEntity:s})).toJSON()}async getCreateIssueEntityTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={...t.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},i={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight,recipientId:e.recipientId},o=await this.createIssueEntityTransaction(r,i,{issueEntity:s}),a=(this.transactionHelper.calcTransactionMinFeeByBytes(o,o.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(o)).toString();return String(BigInt(a)*BigInt(105)/BigInt(100))}async createIssueEntityMultiTransactionJSON(e,t,r){const n={...r.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...r,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},i={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight,recipientId:t.recipientId};return(await this.createIssueEntityMultiTransaction(e,i,{issueEntityMulti:s})).toJSON()}async getCreateIssueEntityMultiTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={...t.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},i={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight,recipientId:e.recipientId},o=await this.createIssueEntityMultiTransaction(r,i,{issueEntityMulti:s}),a=(this.transactionHelper.calcTransactionMinFeeByMulti(o,o.asset.issueEntityMulti.entityStructList.length)+this.transactionHelper.calcTransactionBlobFee(o)).toString();return String(BigInt(a)*BigInt(105)/BigInt(100))}async createToExchangeAnyTransactionJSON(e,t,r){const n={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createToExchangeAnyTransaction(e,n,{toExchangeAny:{...r,cipherPublicKeys:[]}})).toJSON()}async getCreateToExchangeAnyTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},s=await this.createToExchangeAnyTransaction(r,n,{toExchangeAny:{...t,cipherPublicKeys:[]}}),i=(this.transactionHelper.calcTransactionMinFeeByBytes(s,s.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(s)).toString();return String(BigInt(i)*BigInt(105)/BigInt(100))}async createBeExchangeAnyTransactionJSON(e,t,r,n){const s={fee:t.fee,recipientId:t.recipientId,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createBeExchangeAnyTransaction(e,s,{beExchangeAny:{...r,exchangeAny:{...n,cipherPublicKeys:[]}}})).toJSON()}async getCreateBeExchangeAnyTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:e.recipientId,remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},i=await this.createBeExchangeAnyTransaction(n,s,{beExchangeAny:{...t,exchangeAny:{...r,cipherPublicKeys:[]}}}),o=(this.transactionHelper.calcTransactionMinFeeByBytes(i,i.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(105)/BigInt(100))}async createToExchangeAnyMultiTransactionJSON(e,t,r,n){const s={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createToExchangeAnyMultiTransaction(e,s,{toExchangeAnyMulti:{cipherPublicKeys:[],toExchangeAssets:r,beExchangeAsset:n}})).toJSON()}async getCreateToExchangeAnyMultiTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},i=await this.createToExchangeAnyMultiTransaction(n,s,{toExchangeAnyMulti:{cipherPublicKeys:[],toExchangeAssets:t,beExchangeAsset:r}}),o=(this.transactionHelper.calcTransactionMinFeeByMulti(i,i.asset.toExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(105)/BigInt(100))}async createBeExchangeAnyMultiTransactionJSON(e,t,r,n){const s={fee:t.fee,recipientId:t.recipientId,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createBeExchangeAnyMultiTransaction(e,s,{beExchangeAnyMulti:{transactionSignature:t.transactionSignature,toExchangeAssets:r,beExchangeAsset:n}})).toJSON()}async getCreateBeExchangeAnyMultiTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:e.recipientId,remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},i=await this.createBeExchangeAnyMultiTransaction(n,s,{beExchangeAnyMulti:{transactionSignature:e.transactionSignature,toExchangeAssets:t,beExchangeAsset:r}}),o=(this.transactionHelper.calcTransactionMinFeeByMulti(i,i.asset.beExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(105)/BigInt(100))}async createGiftAnyTransactionJSON(e,t,r){const n={recipientId:{type:1,range:[t.recipientId]},fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createGiftAnyTransaction(e,n,{giftAny:{...r,cipherPublicKeys:[]}})).toJSON()}async getCreateGiftAnyTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"AUTO",recipientId:{type:1,range:[e.recipientId]},remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},s=await this.createGiftAnyTransaction(r,n,{giftAny:{...t,cipherPublicKeys:[]}});let i=this.transactionHelper.calcTransactionMinFeeByBytes(s,s.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(s);const o=BigInt(s.fee);return o>i&&(i=o),String(i*BigInt(105)/BigInt(100))}async createGrabAnyTransactionJSON(e,t,r,n){const s={fee:t.fee,recipientId:t.recipientId,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createGrabAnyTransaction(e,s,{grabAny:{...r,giftAny:{...n,cipherPublicKeys:[]}}})).toJSON()}async getCreateGrabAnyTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"AUTO",recipientId:e.recipientId,remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},i=await this.createGrabAnyTransaction(n,s,{grabAny:{...t,giftAny:{...r,cipherPublicKeys:[]}}});let o=this.transactionHelper.calcTransactionMinFeeByBytes(i,i.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(i);const a=BigInt(i.fee);return a>o&&(o=a),String(o*BigInt(105)/BigInt(100))}};ju=u([ie()],ju);const US="BTGMetaBundleCore";let Tc=class extends Rn{constructor(e){super(),this.moduleMap=e,this._init_task=new nr}accountBaseHelper(){return this.bfchainCore.accountBaseHelper}keypairHelper(){return this.bfchainCore.keypairHelper}config(){return this.bfchainCore.config}getMagic(){return this.bfchainCore.config.magic}getAssetType(){return this.bfchainCore.config.assetType}getChainName(){return this.bfchainCore.config.chainName}afterInit(){return this._init_task.promise}async bfOnInit(){try{this._init_task.resolve()}catch(e){this._init_task.reject(e)}}};u([Z(Zh),g("design:type",Zh)],Tc.prototype,"bfchainCore",void 0);u([Z(Ku),g("design:type",Ku)],Tc.prototype,"transactionController",void 0);u([Z(ju),g("design:type",ju)],Tc.prototype,"exchangeTransactionCtrl",void 0);Tc=u([ie(US),g("design:paramtypes",[et])],Tc);var $I={};const ui=mT(yT);var CA={},Kc={},xA={},jc={},io={},RA;function $S(){if(RA)return io;RA=1,Object.defineProperty(io,"__esModule",{value:!0}),io.base58=io.Base58=void 0;class e{constructor(){this.ALPHABET="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",this.BASE=this.ALPHABET.length,this.LEADER=this.ALPHABET.charAt(0),this.ALPHABET_MAP={};for(let r=0;r<this.ALPHABET.length;r++){const n=this.ALPHABET.charAt(r);if(this.ALPHABET_MAP[n]!==void 0)throw new TypeError(n+" is ambiguous");this.ALPHABET_MAP[n]=r}}encode(r){if(r.length===0)return"";const n=[0];for(let i=0;i<r.length;++i){let o=r[i];for(let a=0;a<n.length;++a)o+=n[a]<<8,n[a]=o%this.BASE,o=o/this.BASE|0;for(;o>0;)n.push(o%this.BASE),o=o/this.BASE|0}let s="";for(let i=0;r[i]===0&&i<r.length-1;++i)s+=this.ALPHABET[0];for(let i=n.length-1;i>=0;--i)s+=this.ALPHABET[n[i]];return s}decodeUnsafe(r){if(r.length===0)return new Uint8Array;const n=[0];for(let s=0;s<r.length;s++){let i=this.ALPHABET_MAP[r[s]];if(i===void 0)return;let o=i;for(let a=0;a<n.length;++a)o+=n[a]*this.BASE,n[a]=o&255,o>>=8;for(;o>0;)n.push(o&255),o>>=8}for(let s=0;r[s]===this.LEADER&&s<r.length-1;++s)n.push(0);return new Uint8Array(n).reverse()}decode(r){const n=this.decodeUnsafe(r);if(n)return n;throw new Error("Non-base"+this.BASE+" character")}}return io.Base58=e,io.base58=new e,io}var vA;function VS(){if(vA)return jc;vA=1,Object.defineProperty(jc,"__esModule",{value:!0}),jc.Base58Helper=void 0;const e=$S();class t{constructor(n,s){this.bs58=e.base58,this.__buffer=s,this.__cryptoHelper=n}async sha256x2(n){const s=await this.__cryptoHelper.sha256(n);return await this.__cryptoHelper.sha256(s)}async encode(n){return this.bs58.encode(this.__buffer.concat([n,await this.sha256x2(n)],n.length+4))}async decodeRaw(n){let s=n.slice(0,-4),i=n.slice(-4),o=await this.sha256x2(s);if(!(i[0]^o[0]|i[1]^o[1]|i[2]^o[2]|i[3]^o[3]))return this.__buffer.from(s)}decodeUnsafe(n){let s=this.bs58.decodeUnsafe(n);if(s)return this.decodeRaw(s)}decode(n){let s=this.bs58.decode(n),i=this.decodeRaw(s);if(!i)throw new Error("Invalid checksum");return i}}return jc.Base58Helper=t,jc}var BA;function GS(){return BA||(BA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),ui.__exportStar(VS(),e)})(xA)),xA}var PA={},oo={},kA={},Ot={},Sn={},HA;function Hs(){return HA||(HA=1,Object.defineProperty(Sn,"__esModule",{value:!0}),Sn.NumArray=Sn.IntArray=Sn.WordArray=Sn.HalfArray=Sn.ByteArray=void 0,Sn.ByteArray=Uint8Array,Sn.HalfArray=Uint16Array,Sn.WordArray=Uint32Array,Sn.IntArray=Int32Array,Sn.NumArray=Float64Array),Sn}var Ds={},Fs={},Us={},MA={},LA;function VI(){return LA||(LA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._stream_xor=e._stream=e._sigma=e._hsalsa20=e._salsa20=void 0;const t=Hs();function r(p,l,h,y){const A=y[0]&255|(y[1]&255)<<8|(y[2]&255)<<16|(y[3]&255)<<24,_=h[0]&255|(h[1]&255)<<8|(h[2]&255)<<16|(h[3]&255)<<24,E=h[4]&255|(h[5]&255)<<8|(h[6]&255)<<16|(h[7]&255)<<24,T=h[8]&255|(h[9]&255)<<8|(h[10]&255)<<16|(h[11]&255)<<24,w=h[12]&255|(h[13]&255)<<8|(h[14]&255)<<16|(h[15]&255)<<24,C=y[4]&255|(y[5]&255)<<8|(y[6]&255)<<16|(y[7]&255)<<24,N=l[0]&255|(l[1]&255)<<8|(l[2]&255)<<16|(l[3]&255)<<24,L=l[4]&255|(l[5]&255)<<8|(l[6]&255)<<16|(l[7]&255)<<24,B=l[8]&255|(l[9]&255)<<8|(l[10]&255)<<16|(l[11]&255)<<24,$=l[12]&255|(l[13]&255)<<8|(l[14]&255)<<16|(l[15]&255)<<24,V=y[8]&255|(y[9]&255)<<8|(y[10]&255)<<16|(y[11]&255)<<24,G=h[16]&255|(h[17]&255)<<8|(h[18]&255)<<16|(h[19]&255)<<24,Y=h[20]&255|(h[21]&255)<<8|(h[22]&255)<<16|(h[23]&255)<<24,X=h[24]&255|(h[25]&255)<<8|(h[26]&255)<<16|(h[27]&255)<<24,U=h[28]&255|(h[29]&255)<<8|(h[30]&255)<<16|(h[31]&255)<<24,v=y[12]&255|(y[13]&255)<<8|(y[14]&255)<<16|(y[15]&255)<<24;let P=A,x=_,k=E,M=T,q=w,K=C,F=N,J=L,S=B,D=$,Q=V,fe=G,ce=Y,re=X,se=U,ee=v,R;for(let de=0;de<20;de+=2)R=P+ce|0,q^=R<<7|R>>>25,R=q+P|0,S^=R<<9|R>>>23,R=S+q|0,ce^=R<<13|R>>>19,R=ce+S|0,P^=R<<18|R>>>14,R=K+x|0,D^=R<<7|R>>>25,R=D+K|0,re^=R<<9|R>>>23,R=re+D|0,x^=R<<13|R>>>19,R=x+re|0,K^=R<<18|R>>>14,R=Q+F|0,se^=R<<7|R>>>25,R=se+Q|0,k^=R<<9|R>>>23,R=k+se|0,F^=R<<13|R>>>19,R=F+k|0,Q^=R<<18|R>>>14,R=ee+fe|0,M^=R<<7|R>>>25,R=M+ee|0,J^=R<<9|R>>>23,R=J+M|0,fe^=R<<13|R>>>19,R=fe+J|0,ee^=R<<18|R>>>14,R=P+M|0,x^=R<<7|R>>>25,R=x+P|0,k^=R<<9|R>>>23,R=k+x|0,M^=R<<13|R>>>19,R=M+k|0,P^=R<<18|R>>>14,R=K+q|0,F^=R<<7|R>>>25,R=F+K|0,J^=R<<9|R>>>23,R=J+F|0,q^=R<<13|R>>>19,R=q+J|0,K^=R<<18|R>>>14,R=Q+D|0,fe^=R<<7|R>>>25,R=fe+Q|0,S^=R<<9|R>>>23,R=S+fe|0,D^=R<<13|R>>>19,R=D+S|0,Q^=R<<18|R>>>14,R=ee+se|0,ce^=R<<7|R>>>25,R=ce+ee|0,re^=R<<9|R>>>23,R=re+ce|0,se^=R<<13|R>>>19,R=se+re|0,ee^=R<<18|R>>>14;P=P+A|0,x=x+_|0,k=k+E|0,M=M+T|0,q=q+w|0,K=K+C|0,F=F+N|0,J=J+L|0,S=S+B|0,D=D+$|0,Q=Q+V|0,fe=fe+G|0,ce=ce+Y|0,re=re+X|0,se=se+U|0,ee=ee+v|0,p[0]=P>>>0&255,p[1]=P>>>8&255,p[2]=P>>>16&255,p[3]=P>>>24&255,p[4]=x>>>0&255,p[5]=x>>>8&255,p[6]=x>>>16&255,p[7]=x>>>24&255,p[8]=k>>>0&255,p[9]=k>>>8&255,p[10]=k>>>16&255,p[11]=k>>>24&255,p[12]=M>>>0&255,p[13]=M>>>8&255,p[14]=M>>>16&255,p[15]=M>>>24&255,p[16]=q>>>0&255,p[17]=q>>>8&255,p[18]=q>>>16&255,p[19]=q>>>24&255,p[20]=K>>>0&255,p[21]=K>>>8&255,p[22]=K>>>16&255,p[23]=K>>>24&255,p[24]=F>>>0&255,p[25]=F>>>8&255,p[26]=F>>>16&255,p[27]=F>>>24&255,p[28]=J>>>0&255,p[29]=J>>>8&255,p[30]=J>>>16&255,p[31]=J>>>24&255,p[32]=S>>>0&255,p[33]=S>>>8&255,p[34]=S>>>16&255,p[35]=S>>>24&255,p[36]=D>>>0&255,p[37]=D>>>8&255,p[38]=D>>>16&255,p[39]=D>>>24&255,p[40]=Q>>>0&255,p[41]=Q>>>8&255,p[42]=Q>>>16&255,p[43]=Q>>>24&255,p[44]=fe>>>0&255,p[45]=fe>>>8&255,p[46]=fe>>>16&255,p[47]=fe>>>24&255,p[48]=ce>>>0&255,p[49]=ce>>>8&255,p[50]=ce>>>16&255,p[51]=ce>>>24&255,p[52]=re>>>0&255,p[53]=re>>>8&255,p[54]=re>>>16&255,p[55]=re>>>24&255,p[56]=se>>>0&255,p[57]=se>>>8&255,p[58]=se>>>16&255,p[59]=se>>>24&255,p[60]=ee>>>0&255,p[61]=ee>>>8&255,p[62]=ee>>>16&255,p[63]=ee>>>24&255}e._salsa20=r;function n(p,l,h,y){const A=y[0]&255|(y[1]&255)<<8|(y[2]&255)<<16|(y[3]&255)<<24,_=h[0]&255|(h[1]&255)<<8|(h[2]&255)<<16|(h[3]&255)<<24,E=h[4]&255|(h[5]&255)<<8|(h[6]&255)<<16|(h[7]&255)<<24,T=h[8]&255|(h[9]&255)<<8|(h[10]&255)<<16|(h[11]&255)<<24,w=h[12]&255|(h[13]&255)<<8|(h[14]&255)<<16|(h[15]&255)<<24,C=y[4]&255|(y[5]&255)<<8|(y[6]&255)<<16|(y[7]&255)<<24,N=l[0]&255|(l[1]&255)<<8|(l[2]&255)<<16|(l[3]&255)<<24,L=l[4]&255|(l[5]&255)<<8|(l[6]&255)<<16|(l[7]&255)<<24,B=l[8]&255|(l[9]&255)<<8|(l[10]&255)<<16|(l[11]&255)<<24,$=l[12]&255|(l[13]&255)<<8|(l[14]&255)<<16|(l[15]&255)<<24,V=y[8]&255|(y[9]&255)<<8|(y[10]&255)<<16|(y[11]&255)<<24,G=h[16]&255|(h[17]&255)<<8|(h[18]&255)<<16|(h[19]&255)<<24,Y=h[20]&255|(h[21]&255)<<8|(h[22]&255)<<16|(h[23]&255)<<24,X=h[24]&255|(h[25]&255)<<8|(h[26]&255)<<16|(h[27]&255)<<24,U=h[28]&255|(h[29]&255)<<8|(h[30]&255)<<16|(h[31]&255)<<24,v=y[12]&255|(y[13]&255)<<8|(y[14]&255)<<16|(y[15]&255)<<24;let P=A,x=_,k=E,M=T,q=w,K=C,F=N,J=L,S=B,D=$,Q=V,fe=G,ce=Y,re=X,se=U,ee=v,R;for(let de=0;de<20;de+=2)R=P+ce|0,q^=R<<7|R>>>25,R=q+P|0,S^=R<<9|R>>>23,R=S+q|0,ce^=R<<13|R>>>19,R=ce+S|0,P^=R<<18|R>>>14,R=K+x|0,D^=R<<7|R>>>25,R=D+K|0,re^=R<<9|R>>>23,R=re+D|0,x^=R<<13|R>>>19,R=x+re|0,K^=R<<18|R>>>14,R=Q+F|0,se^=R<<7|R>>>25,R=se+Q|0,k^=R<<9|R>>>23,R=k+se|0,F^=R<<13|R>>>19,R=F+k|0,Q^=R<<18|R>>>14,R=ee+fe|0,M^=R<<7|R>>>25,R=M+ee|0,J^=R<<9|R>>>23,R=J+M|0,fe^=R<<13|R>>>19,R=fe+J|0,ee^=R<<18|R>>>14,R=P+M|0,x^=R<<7|R>>>25,R=x+P|0,k^=R<<9|R>>>23,R=k+x|0,M^=R<<13|R>>>19,R=M+k|0,P^=R<<18|R>>>14,R=K+q|0,F^=R<<7|R>>>25,R=F+K|0,J^=R<<9|R>>>23,R=J+F|0,q^=R<<13|R>>>19,R=q+J|0,K^=R<<18|R>>>14,R=Q+D|0,fe^=R<<7|R>>>25,R=fe+Q|0,S^=R<<9|R>>>23,R=S+fe|0,D^=R<<13|R>>>19,R=D+S|0,Q^=R<<18|R>>>14,R=ee+se|0,ce^=R<<7|R>>>25,R=ce+ee|0,re^=R<<9|R>>>23,R=re+ce|0,se^=R<<13|R>>>19,R=se+re|0,ee^=R<<18|R>>>14;p[0]=P>>>0&255,p[1]=P>>>8&255,p[2]=P>>>16&255,p[3]=P>>>24&255,p[4]=K>>>0&255,p[5]=K>>>8&255,p[6]=K>>>16&255,p[7]=K>>>24&255,p[8]=Q>>>0&255,p[9]=Q>>>8&255,p[10]=Q>>>16&255,p[11]=Q>>>24&255,p[12]=ee>>>0&255,p[13]=ee>>>8&255,p[14]=ee>>>16&255,p[15]=ee>>>24&255,p[16]=F>>>0&255,p[17]=F>>>8&255,p[18]=F>>>16&255,p[19]=F>>>24&255,p[20]=J>>>0&255,p[21]=J>>>8&255,p[22]=J>>>16&255,p[23]=J>>>24&255,p[24]=S>>>0&255,p[25]=S>>>8&255,p[26]=S>>>16&255,p[27]=S>>>24&255,p[28]=D>>>0&255,p[29]=D>>>8&255,p[30]=D>>>16&255,p[31]=D>>>24&255}e._hsalsa20=n,e._sigma=new t.ByteArray([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function s(p,l,h,y,A,_,E){const T=new t.ByteArray(16),w=new t.ByteArray(64);let C,N;for(N=0;N<16;N++)T[N]=0;for(N=0;N<8;N++)T[N]=_[N];for(;A>=64;){for(r(w,T,E,e._sigma),N=0;N<64;N++)p[l+N]=h[y+N]^w[N];for(C=1,N=8;N<16;N++)C=C+(T[N]&255)|0,T[N]=C&255,C>>>=8;A-=64,l+=64,y+=64}if(A>0)for(r(w,T,E,e._sigma),N=0;N<A;N++)p[l+N]=h[y+N]^w[N];return 0}function i(p,l,h,y,A){const _=new t.ByteArray(16),E=new t.ByteArray(64);let T,w;for(w=0;w<16;w++)_[w]=0;for(w=0;w<8;w++)_[w]=y[w];for(;h>=64;){for(r(E,_,A,e._sigma),w=0;w<64;w++)p[l+w]=E[w];for(T=1,w=8;w<16;w++)T=T+(_[w]&255)|0,_[w]=T&255,T>>>=8;h-=64,l+=64}if(h>0)for(r(E,_,A,e._sigma),w=0;w<h;w++)p[l+w]=E[w];return 0}function o(p,l,h,y,A){const _=new t.ByteArray(32),E=new t.ByteArray(8);n(_,y,A,e._sigma);for(let T=0;T<8;T++)E[T]=y[T+16];return i(p,l,h,E,_)}e._stream=o;function a(p,l,h,y,A,_,E){const T=new t.ByteArray(32),w=new t.ByteArray(8);n(T,_,E,e._sigma);for(let C=0;C<8;C++)w[C]=_[C+16];return s(p,l,h,y,A,w,T)}e._stream_xor=a})(MA)),MA}var Gn={},DA;function KS(){if(DA)return Gn;DA=1,Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.poly1305_update=Gn.poly1305_finish=Gn.poly1305_blocks=Gn.poly1305_init=void 0;const e=Hs();function t(i){const o=new e.HalfArray(10),a=new e.HalfArray(8);let p,l,h,y,A,_,E,T;return p=i[0]&255|(i[1]&255)<<8,o[0]=p&8191,l=i[2]&255|(i[3]&255)<<8,o[1]=(p>>>13|l<<3)&8191,h=i[4]&255|(i[5]&255)<<8,o[2]=(l>>>10|h<<6)&7939,y=i[6]&255|(i[7]&255)<<8,o[3]=(h>>>7|y<<9)&8191,A=i[8]&255|(i[9]&255)<<8,o[4]=(y>>>4|A<<12)&255,o[5]=A>>>1&8190,_=i[10]&255|(i[11]&255)<<8,o[6]=(A>>>14|_<<2)&8191,E=i[12]&255|(i[13]&255)<<8,o[7]=(_>>>11|E<<5)&8065,T=i[14]&255|(i[15]&255)<<8,o[8]=(E>>>8|T<<8)&8191,o[9]=T>>>5&127,a[0]=i[16]&255|(i[17]&255)<<8,a[1]=i[18]&255|(i[19]&255)<<8,a[2]=i[20]&255|(i[21]&255)<<8,a[3]=i[22]&255|(i[23]&255)<<8,a[4]=i[24]&255|(i[25]&255)<<8,a[5]=i[26]&255|(i[27]&255)<<8,a[6]=i[28]&255|(i[29]&255)<<8,a[7]=i[30]&255|(i[31]&255)<<8,{buffer:new e.ByteArray(16),r:o,h:new e.HalfArray(10),pad:a,leftover:0,fin:0}}Gn.poly1305_init=t;function r(i,o,a,p){const l=i.fin?0:2048;let h,y,A,_,E,T,w,C,N,L,B,$,V,G,Y,X,U,v,P;const{h:x,r:k}=i;let M=x[0],q=x[1],K=x[2],F=x[3],J=x[4],S=x[5],D=x[6],Q=x[7],fe=x[8],ce=x[9];const re=k[0],se=k[1],ee=k[2],R=k[3],de=k[4],Ee=k[5],Ie=k[6],xe=k[7],Re=k[8],Be=k[9];for(;p>=16;)h=o[a+0]&255|(o[a+1]&255)<<8,M+=h&8191,y=o[a+2]&255|(o[a+3]&255)<<8,q+=(h>>>13|y<<3)&8191,A=o[a+4]&255|(o[a+5]&255)<<8,K+=(y>>>10|A<<6)&8191,_=o[a+6]&255|(o[a+7]&255)<<8,F+=(A>>>7|_<<9)&8191,E=o[a+8]&255|(o[a+9]&255)<<8,J+=(_>>>4|E<<12)&8191,S+=E>>>1&8191,T=o[a+10]&255|(o[a+11]&255)<<8,D+=(E>>>14|T<<2)&8191,w=o[a+12]&255|(o[a+13]&255)<<8,Q+=(T>>>11|w<<5)&8191,C=o[a+14]&255|(o[a+15]&255)<<8,fe+=(w>>>8|C<<8)&8191,ce+=C>>>5|l,N=0,L=N,L+=M*re,L+=q*(5*Be),L+=K*(5*Re),L+=F*(5*xe),L+=J*(5*Ie),N=L>>>13,L&=8191,L+=S*(5*Ee),L+=D*(5*de),L+=Q*(5*R),L+=fe*(5*ee),L+=ce*(5*se),N+=L>>>13,L&=8191,B=N,B+=M*se,B+=q*re,B+=K*(5*Be),B+=F*(5*Re),B+=J*(5*xe),N=B>>>13,B&=8191,B+=S*(5*Ie),B+=D*(5*Ee),B+=Q*(5*de),B+=fe*(5*R),B+=ce*(5*ee),N+=B>>>13,B&=8191,$=N,$+=M*ee,$+=q*se,$+=K*re,$+=F*(5*Be),$+=J*(5*Re),N=$>>>13,$&=8191,$+=S*(5*xe),$+=D*(5*Ie),$+=Q*(5*Ee),$+=fe*(5*de),$+=ce*(5*R),N+=$>>>13,$&=8191,V=N,V+=M*R,V+=q*ee,V+=K*se,V+=F*re,V+=J*(5*Be),N=V>>>13,V&=8191,V+=S*(5*Re),V+=D*(5*xe),V+=Q*(5*Ie),V+=fe*(5*Ee),V+=ce*(5*de),N+=V>>>13,V&=8191,G=N,G+=M*de,G+=q*R,G+=K*ee,G+=F*se,G+=J*re,N=G>>>13,G&=8191,G+=S*(5*Be),G+=D*(5*Re),G+=Q*(5*xe),G+=fe*(5*Ie),G+=ce*(5*Ee),N+=G>>>13,G&=8191,Y=N,Y+=M*Ee,Y+=q*de,Y+=K*R,Y+=F*ee,Y+=J*se,N=Y>>>13,Y&=8191,Y+=S*re,Y+=D*(5*Be),Y+=Q*(5*Re),Y+=fe*(5*xe),Y+=ce*(5*Ie),N+=Y>>>13,Y&=8191,X=N,X+=M*Ie,X+=q*Ee,X+=K*de,X+=F*R,X+=J*ee,N=X>>>13,X&=8191,X+=S*se,X+=D*re,X+=Q*(5*Be),X+=fe*(5*Re),X+=ce*(5*xe),N+=X>>>13,X&=8191,U=N,U+=M*xe,U+=q*Ie,U+=K*Ee,U+=F*de,U+=J*R,N=U>>>13,U&=8191,U+=S*ee,U+=D*se,U+=Q*re,U+=fe*(5*Be),U+=ce*(5*Re),N+=U>>>13,U&=8191,v=N,v+=M*Re,v+=q*xe,v+=K*Ie,v+=F*Ee,v+=J*de,N=v>>>13,v&=8191,v+=S*R,v+=D*ee,v+=Q*se,v+=fe*re,v+=ce*(5*Be),N+=v>>>13,v&=8191,P=N,P+=M*Be,P+=q*Re,P+=K*xe,P+=F*Ie,P+=J*Ee,N=P>>>13,P&=8191,P+=S*de,P+=D*R,P+=Q*ee,P+=fe*se,P+=ce*re,N+=P>>>13,P&=8191,N=(N<<2)+N|0,N=N+L|0,L=N&8191,N=N>>>13,B+=N,M=L,q=B,K=$,F=V,J=G,S=Y,D=X,Q=U,fe=v,ce=P,a+=16,p-=16;x[0]=M,x[1]=q,x[2]=K,x[3]=F,x[4]=J,x[5]=S,x[6]=D,x[7]=Q,x[8]=fe,x[9]=ce}Gn.poly1305_blocks=r;function n(i,o,a){const p=new e.ByteArray(10);let l,h,y,A;const{buffer:_,h:E,pad:T,leftover:w}=i;if(w){for(A=w,_[A++]=1;A<16;A++)_[A]=0;i.fin=1,r(i,_,0,16)}for(l=E[1]>>>13,E[1]&=8191,A=2;A<10;A++)E[A]+=l,l=E[A]>>>13,E[A]&=8191;for(E[0]+=l*5,l=E[0]>>>13,E[0]&=8191,E[1]+=l,l=E[1]>>>13,E[1]&=8191,E[2]+=l,p[0]=E[0]+5,l=p[0]>>>13,p[0]&=8191,A=1;A<10;A++)p[A]=E[A]+l,l=p[A]>>>13,p[A]&=8191;for(p[9]-=8192,h=(l^1)-1,A=0;A<10;A++)p[A]&=h;for(h=~h,A=0;A<10;A++)E[A]=E[A]&h|p[A];for(E[0]=(E[0]|E[1]<<13)&65535,E[1]=(E[1]>>>3|E[2]<<10)&65535,E[2]=(E[2]>>>6|E[3]<<7)&65535,E[3]=(E[3]>>>9|E[4]<<4)&65535,E[4]=(E[4]>>>12|E[5]<<1|E[6]<<14)&65535,E[5]=(E[6]>>>2|E[7]<<11)&65535,E[6]=(E[7]>>>5|E[8]<<8)&65535,E[7]=(E[8]>>>8|E[9]<<5)&65535,y=E[0]+T[0],E[0]=y&65535,A=1;A<8;A++)y=(E[A]+T[A]|0)+(y>>>16)|0,E[A]=y&65535;o[a+0]=E[0]>>>0&255,o[a+1]=E[0]>>>8&255,o[a+2]=E[1]>>>0&255,o[a+3]=E[1]>>>8&255,o[a+4]=E[2]>>>0&255,o[a+5]=E[2]>>>8&255,o[a+6]=E[3]>>>0&255,o[a+7]=E[3]>>>8&255,o[a+8]=E[4]>>>0&255,o[a+9]=E[4]>>>8&255,o[a+10]=E[5]>>>0&255,o[a+11]=E[5]>>>8&255,o[a+12]=E[6]>>>0&255,o[a+13]=E[6]>>>8&255,o[a+14]=E[7]>>>0&255,o[a+15]=E[7]>>>8&255}Gn.poly1305_finish=n;function s(i,o,a,p){let l,h;const{buffer:y}=i;if(i.leftover){for(h=16-i.leftover,h>p&&(h=p),l=0;l<h;l++)y[i.leftover+l]=o[a+l];if(p-=h,a+=h,i.leftover+=h,i.leftover<16)return;r(i,y,0,16),i.leftover=0}if(p>=16&&(h=p-p%16,r(i,o,a,h),a+=h,p-=h),p){for(l=0;l<p;l++)y[i.leftover+l]=o[a+l];i.leftover+=p}}return Gn.poly1305_update=s,Gn}var FA;function GI(){if(FA)return Us;FA=1,Object.defineProperty(Us,"__esModule",{value:!0}),Us._onetimeauth=Us.secretbox_open=Us.secretbox=void 0;const e=Hs(),t=Rm(),r=VI(),n=KS(),s=Bc();function i(y,A,_){(0,s.checkArrayTypes)(y,A,_),(0,s.checkLengths)(_,A);const E=new e.ByteArray(32+y.length),T=new e.ByteArray(E.length);for(let w=0;w<y.length;w++)E[w+32]=y[w];return a(T,E,E.length,A,_),T.subarray(16)}Us.secretbox=i;function o(y,A,_){(0,s.checkArrayTypes)(y,A,_),(0,s.checkLengths)(_,A);const E=new e.ByteArray(16+y.length),T=new e.ByteArray(E.length);for(let w=0;w<y.length;w++)E[w+16]=y[w];if(!(E.length<32||p(T,E,E.length,A,_)!==0))return T.subarray(32)}Us.secretbox_open=o;function a(y,A,_,E,T){if(_<32)return-1;(0,r._stream_xor)(y,0,A,0,_,E,T),l(y,16,y,32,_-32,y);for(let w=0;w<16;w++)y[w]=0;return 0}function p(y,A,_,E,T){const w=new e.ByteArray(32);if(_<32||((0,r._stream)(w,0,32,E,T),h(A,16,A,32,_-32,w)!==0))return-1;(0,r._stream_xor)(y,0,A,0,_,E,T);for(let C=0;C<32;C++)y[C]=0;return 0}function l(y,A,_,E,T,w){const C=(0,n.poly1305_init)(w);return(0,n.poly1305_update)(C,_,E,T),(0,n.poly1305_finish)(C,y,A),0}Us._onetimeauth=l;function h(y,A,_,E,T,w){const C=new e.ByteArray(16);return l(C,0,_,E,T,w),(0,t._verify_16)(y,A,C,0)}return Us}var Ir={},UA={},$A;function gl(){return $A||($A=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.squaring=e.multiplication=e.subtraction=e.addition=e.I=e.Y=e.X=e.D2=e.D=e._121665=e.gf1=e.gf0=e._9=e._0=e.gf=void 0;const t=Hs();function r(a){const p=new t.NumArray(16);return a&&p.set(a),p}e.gf=r,e._0=new t.ByteArray(16),e._9=new t.ByteArray(32),e._9[0]=9,e.gf0=r(),e.gf1=r([1]),e._121665=r([56129,1]),e.D=r([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),e.D2=r([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),e.X=r([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),e.Y=r([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),e.I=r([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function n(a,p,l){for(let h=0;h<16;h++)a[h]=p[h]+l[h]}e.addition=n;function s(a,p,l){for(let h=0;h<16;h++)a[h]=p[h]-l[h]}e.subtraction=s;function i(a,p,l){let h,y,A=0,_=0,E=0,T=0,w=0,C=0,N=0,L=0,B=0,$=0,V=0,G=0,Y=0,X=0,U=0,v=0,P=0,x=0,k=0,M=0,q=0,K=0,F=0,J=0,S=0,D=0,Q=0,fe=0,ce=0,re=0,se=0,ee=l[0],R=l[1],de=l[2],Ee=l[3],Ie=l[4],xe=l[5],Re=l[6],Be=l[7],Ue=l[8],gt=l[9],ct=l[10],ft=l[11],mt=l[12],Ct=l[13],dt=l[14],qe=l[15];h=p[0],A+=h*ee,_+=h*R,E+=h*de,T+=h*Ee,w+=h*Ie,C+=h*xe,N+=h*Re,L+=h*Be,B+=h*Ue,$+=h*gt,V+=h*ct,G+=h*ft,Y+=h*mt,X+=h*Ct,U+=h*dt,v+=h*qe,h=p[1],_+=h*ee,E+=h*R,T+=h*de,w+=h*Ee,C+=h*Ie,N+=h*xe,L+=h*Re,B+=h*Be,$+=h*Ue,V+=h*gt,G+=h*ct,Y+=h*ft,X+=h*mt,U+=h*Ct,v+=h*dt,P+=h*qe,h=p[2],E+=h*ee,T+=h*R,w+=h*de,C+=h*Ee,N+=h*Ie,L+=h*xe,B+=h*Re,$+=h*Be,V+=h*Ue,G+=h*gt,Y+=h*ct,X+=h*ft,U+=h*mt,v+=h*Ct,P+=h*dt,x+=h*qe,h=p[3],T+=h*ee,w+=h*R,C+=h*de,N+=h*Ee,L+=h*Ie,B+=h*xe,$+=h*Re,V+=h*Be,G+=h*Ue,Y+=h*gt,X+=h*ct,U+=h*ft,v+=h*mt,P+=h*Ct,x+=h*dt,k+=h*qe,h=p[4],w+=h*ee,C+=h*R,N+=h*de,L+=h*Ee,B+=h*Ie,$+=h*xe,V+=h*Re,G+=h*Be,Y+=h*Ue,X+=h*gt,U+=h*ct,v+=h*ft,P+=h*mt,x+=h*Ct,k+=h*dt,M+=h*qe,h=p[5],C+=h*ee,N+=h*R,L+=h*de,B+=h*Ee,$+=h*Ie,V+=h*xe,G+=h*Re,Y+=h*Be,X+=h*Ue,U+=h*gt,v+=h*ct,P+=h*ft,x+=h*mt,k+=h*Ct,M+=h*dt,q+=h*qe,h=p[6],N+=h*ee,L+=h*R,B+=h*de,$+=h*Ee,V+=h*Ie,G+=h*xe,Y+=h*Re,X+=h*Be,U+=h*Ue,v+=h*gt,P+=h*ct,x+=h*ft,k+=h*mt,M+=h*Ct,q+=h*dt,K+=h*qe,h=p[7],L+=h*ee,B+=h*R,$+=h*de,V+=h*Ee,G+=h*Ie,Y+=h*xe,X+=h*Re,U+=h*Be,v+=h*Ue,P+=h*gt,x+=h*ct,k+=h*ft,M+=h*mt,q+=h*Ct,K+=h*dt,F+=h*qe,h=p[8],B+=h*ee,$+=h*R,V+=h*de,G+=h*Ee,Y+=h*Ie,X+=h*xe,U+=h*Re,v+=h*Be,P+=h*Ue,x+=h*gt,k+=h*ct,M+=h*ft,q+=h*mt,K+=h*Ct,F+=h*dt,J+=h*qe,h=p[9],$+=h*ee,V+=h*R,G+=h*de,Y+=h*Ee,X+=h*Ie,U+=h*xe,v+=h*Re,P+=h*Be,x+=h*Ue,k+=h*gt,M+=h*ct,q+=h*ft,K+=h*mt,F+=h*Ct,J+=h*dt,S+=h*qe,h=p[10],V+=h*ee,G+=h*R,Y+=h*de,X+=h*Ee,U+=h*Ie,v+=h*xe,P+=h*Re,x+=h*Be,k+=h*Ue,M+=h*gt,q+=h*ct,K+=h*ft,F+=h*mt,J+=h*Ct,S+=h*dt,D+=h*qe,h=p[11],G+=h*ee,Y+=h*R,X+=h*de,U+=h*Ee,v+=h*Ie,P+=h*xe,x+=h*Re,k+=h*Be,M+=h*Ue,q+=h*gt,K+=h*ct,F+=h*ft,J+=h*mt,S+=h*Ct,D+=h*dt,Q+=h*qe,h=p[12],Y+=h*ee,X+=h*R,U+=h*de,v+=h*Ee,P+=h*Ie,x+=h*xe,k+=h*Re,M+=h*Be,q+=h*Ue,K+=h*gt,F+=h*ct,J+=h*ft,S+=h*mt,D+=h*Ct,Q+=h*dt,fe+=h*qe,h=p[13],X+=h*ee,U+=h*R,v+=h*de,P+=h*Ee,x+=h*Ie,k+=h*xe,M+=h*Re,q+=h*Be,K+=h*Ue,F+=h*gt,J+=h*ct,S+=h*ft,D+=h*mt,Q+=h*Ct,fe+=h*dt,ce+=h*qe,h=p[14],U+=h*ee,v+=h*R,P+=h*de,x+=h*Ee,k+=h*Ie,M+=h*xe,q+=h*Re,K+=h*Be,F+=h*Ue,J+=h*gt,S+=h*ct,D+=h*ft,Q+=h*mt,fe+=h*Ct,ce+=h*dt,re+=h*qe,h=p[15],v+=h*ee,P+=h*R,x+=h*de,k+=h*Ee,M+=h*Ie,q+=h*xe,K+=h*Re,F+=h*Be,J+=h*Ue,S+=h*gt,D+=h*ct,Q+=h*ft,fe+=h*mt,ce+=h*Ct,re+=h*dt,se+=h*qe,A+=38*P,_+=38*x,E+=38*k,T+=38*M,w+=38*q,C+=38*K,N+=38*F,L+=38*J,B+=38*S,$+=38*D,V+=38*Q,G+=38*fe,Y+=38*ce,X+=38*re,U+=38*se,y=1,h=A+y+65535,y=Math.floor(h/65536),A=h-y*65536,h=_+y+65535,y=Math.floor(h/65536),_=h-y*65536,h=E+y+65535,y=Math.floor(h/65536),E=h-y*65536,h=T+y+65535,y=Math.floor(h/65536),T=h-y*65536,h=w+y+65535,y=Math.floor(h/65536),w=h-y*65536,h=C+y+65535,y=Math.floor(h/65536),C=h-y*65536,h=N+y+65535,y=Math.floor(h/65536),N=h-y*65536,h=L+y+65535,y=Math.floor(h/65536),L=h-y*65536,h=B+y+65535,y=Math.floor(h/65536),B=h-y*65536,h=$+y+65535,y=Math.floor(h/65536),$=h-y*65536,h=V+y+65535,y=Math.floor(h/65536),V=h-y*65536,h=G+y+65535,y=Math.floor(h/65536),G=h-y*65536,h=Y+y+65535,y=Math.floor(h/65536),Y=h-y*65536,h=X+y+65535,y=Math.floor(h/65536),X=h-y*65536,h=U+y+65535,y=Math.floor(h/65536),U=h-y*65536,h=v+y+65535,y=Math.floor(h/65536),v=h-y*65536,A+=y-1+37*(y-1),y=1,h=A+y+65535,y=Math.floor(h/65536),A=h-y*65536,h=_+y+65535,y=Math.floor(h/65536),_=h-y*65536,h=E+y+65535,y=Math.floor(h/65536),E=h-y*65536,h=T+y+65535,y=Math.floor(h/65536),T=h-y*65536,h=w+y+65535,y=Math.floor(h/65536),w=h-y*65536,h=C+y+65535,y=Math.floor(h/65536),C=h-y*65536,h=N+y+65535,y=Math.floor(h/65536),N=h-y*65536,h=L+y+65535,y=Math.floor(h/65536),L=h-y*65536,h=B+y+65535,y=Math.floor(h/65536),B=h-y*65536,h=$+y+65535,y=Math.floor(h/65536),$=h-y*65536,h=V+y+65535,y=Math.floor(h/65536),V=h-y*65536,h=G+y+65535,y=Math.floor(h/65536),G=h-y*65536,h=Y+y+65535,y=Math.floor(h/65536),Y=h-y*65536,h=X+y+65535,y=Math.floor(h/65536),X=h-y*65536,h=U+y+65535,y=Math.floor(h/65536),U=h-y*65536,h=v+y+65535,y=Math.floor(h/65536),v=h-y*65536,A+=y-1+37*(y-1),a[0]=A,a[1]=_,a[2]=E,a[3]=T,a[4]=w,a[5]=C,a[6]=N,a[7]=L,a[8]=B,a[9]=$,a[10]=V,a[11]=G,a[12]=Y,a[13]=X,a[14]=U,a[15]=v}e.multiplication=i;function o(a,p){i(a,p,p)}e.squaring=o})(UA)),UA}var ao={},VA;function KI(){if(VA)return ao;VA=1,Object.defineProperty(ao,"__esModule",{value:!0}),ao._randomBytes=ao.randomBytes=void 0;const e=Hs();function t(s){const i=new e.ByteArray(s);return n(i,s),i}ao.randomBytes=t;const r=65536;function n(s,i){for(let o=0;o<i;o+=r)crypto.getRandomValues(s.subarray(o,o+Math.min(i-o,r)))}return ao._randomBytes=n,ao}var Kn={},Tr={},GA;function xm(){if(GA)return Tr;GA=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.inv25519=Tr.unpack25519=Tr.par25519=Tr.neq25519=Tr.pack25519=Tr.sel25519=Tr.set25519=void 0;const e=Hs(),t=Rm(),r=gl();function n(y,A){for(let _=0;_<16;_++)y[_]=A[_]|0}Tr.set25519=n;function s(y){let A,_,E=1;for(A=0;A<16;A++)_=y[A]+E+65535,E=Math.floor(_/65536),y[A]=_-E*65536;y[0]+=E-1+37*(E-1)}function i(y,A,_){let E,T=~(_-1);for(let w=0;w<16;w++)E=T&(y[w]^A[w]),y[w]^=E,A[w]^=E}Tr.sel25519=i;function o(y,A){const _=(0,r.gf)(),E=(0,r.gf)();let T,w,C;for(T=0;T<16;T++)E[T]=A[T];for(s(E),s(E),s(E),w=0;w<2;w++){for(_[0]=E[0]-65517,T=1;T<15;T++)_[T]=E[T]-65535-(_[T-1]>>16&1),_[T-1]&=65535;_[15]=E[15]-32767-(_[14]>>16&1),C=_[15]>>16&1,_[14]&=65535,i(E,_,1-C)}for(T=0;T<16;T++)y[2*T]=E[T]&255,y[2*T+1]=E[T]>>8}Tr.pack25519=o;function a(y,A){const _=new e.ByteArray(32),E=new e.ByteArray(32);return o(_,y),o(E,A),(0,t._verify_32)(_,0,E,0)}Tr.neq25519=a;function p(y){const A=new e.ByteArray(32);return o(A,y),A[0]&1}Tr.par25519=p;function l(y,A){for(let _=0;_<16;_++)y[_]=A[2*_]+(A[2*_+1]<<8);y[15]&=32767}Tr.unpack25519=l;function h(y,A){const _=(0,r.gf)();let E;for(E=0;E<16;E++)_[E]=A[E];for(E=253;E>=0;E--)(0,r.squaring)(_,_),E!==2&&E!==4&&(0,r.multiplication)(_,_,A);for(E=0;E<16;E++)y[E]=_[E]}return Tr.inv25519=h,Tr}var KA;function jS(){if(KA)return Kn;KA=1,Object.defineProperty(Kn,"__esModule",{value:!0}),Kn._scalarMult_base=Kn._scalarMult=Kn.scalarMult_base=Kn.scalarMult=void 0;const e=Hs(),t=gl(),r=xm(),n=Bc();function s(p,l){if((0,n.checkArrayTypes)(p,l),p.length!==32)throw new Error("bad n size");if(l.length!==32)throw new Error("bad p size");const h=new e.ByteArray(32);return o(h,p,l),h}Kn.scalarMult=s;function i(p){if((0,n.checkArrayTypes)(p),p.length!==32)throw new Error("bad n size");const l=new e.ByteArray(32);return a(l,p),l}Kn.scalarMult_base=i;function o(p,l,h){const y=new e.ByteArray(32),A=new e.NumArray(80),_=(0,t.gf)(),E=(0,t.gf)(),T=(0,t.gf)(),w=(0,t.gf)(),C=(0,t.gf)(),N=(0,t.gf)();let L,B;for(B=0;B<31;B++)y[B]=l[B];for(y[31]=l[31]&127|64,y[0]&=248,(0,r.unpack25519)(A,h),B=0;B<16;B++)E[B]=A[B],w[B]=_[B]=T[B]=0;for(_[0]=w[0]=1,B=254;B>=0;--B)L=y[B>>>3]>>>(B&7)&1,(0,r.sel25519)(_,E,L),(0,r.sel25519)(T,w,L),(0,t.addition)(C,_,T),(0,t.subtraction)(_,_,T),(0,t.addition)(T,E,w),(0,t.subtraction)(E,E,w),(0,t.squaring)(w,C),(0,t.squaring)(N,_),(0,t.multiplication)(_,T,_),(0,t.multiplication)(T,E,C),(0,t.addition)(C,_,T),(0,t.subtraction)(_,_,T),(0,t.squaring)(E,_),(0,t.subtraction)(T,w,N),(0,t.multiplication)(_,T,t._121665),(0,t.addition)(_,_,w),(0,t.multiplication)(T,T,_),(0,t.multiplication)(_,w,N),(0,t.multiplication)(w,E,A),(0,t.squaring)(E,C),(0,r.sel25519)(_,E,L),(0,r.sel25519)(T,w,L);for(B=0;B<16;B++)A[B+16]=_[B],A[B+32]=T[B],A[B+48]=E[B],A[B+64]=w[B];const $=A.subarray(32),V=A.subarray(16);return(0,r.inv25519)($,$),(0,t.multiplication)(V,V,$),(0,r.pack25519)(p,V),0}Kn._scalarMult=o;function a(p,l){return o(p,l,t._9)}return Kn._scalarMult_base=a,Kn}var jA;function Wd(){if(jA)return Ir;jA=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.box_keyPair_fromSecretKey=Ir.box_keyPair=Ir.box_open_after=Ir.box_open=Ir.box_after=Ir.box_before=Ir.box=void 0;const e=Hs(),t=gl(),r=KI(),n=VI(),s=jS(),i=GI(),o=Bc();function a(E,T,w,C){const N=p(w,C);return(0,i.secretbox)(E,T,N)}Ir.box=a;function p(E,T){(0,o.checkArrayTypes)(E,T),(0,o.checkBoxLengths)(E,T);const w=new e.ByteArray(32);return _(w,E,T),w}Ir.box_before=p,Ir.box_after=i.secretbox;function l(E,T,w,C){const N=p(w,C);return(0,i.secretbox_open)(E,T,N)}Ir.box_open=l,Ir.box_open_after=i.secretbox_open;function h(){const E=new e.ByteArray(32),T=new e.ByteArray(32);return A(E,T),{publicKey:E,secretKey:T}}Ir.box_keyPair=h;function y(E){if((0,o.checkArrayTypes)(E),E.length!==32)throw new Error("bad secret key size");const T=new e.ByteArray(32);return(0,s._scalarMult_base)(T,E),{publicKey:T,secretKey:new e.ByteArray(E)}}Ir.box_keyPair_fromSecretKey=y;function A(E,T){return(0,r._randomBytes)(T,32),(0,s._scalarMult_base)(E,T)}function _(E,T,w){const C=new e.ByteArray(32);return(0,s._scalarMult)(C,w,T),(0,n._hsalsa20)(E,t._0,C,n._sigma)}return Ir}var zA;function Bc(){if(zA)return Fs;zA=1,Object.defineProperty(Fs,"__esModule",{value:!0}),Fs.checkArrayTypes=Fs.checkBoxLengths=Fs.checkLengths=void 0,GI(),Wd();function e(n,s){if(n.length!==32)throw new Error("bad key size");if(s.length!==24)throw new Error("bad nonce size")}Fs.checkLengths=e;function t(n,s){if(n.length!==32)throw new Error("bad public key size");if(s.length!==32)throw new Error("bad secret key size")}Fs.checkBoxLengths=t;function r(...n){for(const s of n)if(!(s instanceof Uint8Array))throw new TypeError("unexpected type, use ByteArray")}return Fs.checkArrayTypes=r,Fs}var JA;function Rm(){if(JA)return Ds;JA=1,Object.defineProperty(Ds,"__esModule",{value:!0}),Ds.verify=Ds._verify_32=Ds._verify_16=void 0;const e=Bc();function t(i,o,a,p,l){let h,y=0;for(h=0;h<l;h++)y|=i[o+h]^a[p+h];return(1&y-1>>>8)-1}function r(i,o,a,p){return t(i,o,a,p,16)}Ds._verify_16=r;function n(i,o,a,p){return t(i,o,a,p,32)}Ds._verify_32=n;function s(i,o){return(0,e.checkArrayTypes)(i,o),i.length>0&&o.length>0&&i.length===o.length&&t(i,0,o,0,i.length)===0}return Ds.verify=s,Ds}var co={},YA;function jI(){if(YA)return co;YA=1,Object.defineProperty(co,"__esModule",{value:!0}),co._hash=co.hash=void 0;const e=Hs(),t=Bc();function r(a){(0,t.checkArrayTypes)(a);const p=new e.ByteArray(64);return n(p,a,a.length),p}co.hash=r;function n(a,p,l){const h=new e.IntArray(8),y=new e.IntArray(8),A=new e.ByteArray(256);let _,E=l;for(h[0]=1779033703,h[1]=3144134277,h[2]=1013904242,h[3]=2773480762,h[4]=1359893119,h[5]=2600822924,h[6]=528734635,h[7]=1541459225,y[0]=4089235720,y[1]=2227873595,y[2]=4271175723,y[3]=1595750129,y[4]=2917565137,y[5]=725511199,y[6]=4215389547,y[7]=327033209,i(h,y,p,l),l%=128,_=0;_<l;_++)A[_]=p[E-l+_];for(A[l]=128,l=256-128*(l<112?1:0),A[l-9]=0,o(A,l-8,E/536870912|0,E<<3),i(h,y,A,l),_=0;_<8;_++)o(a,8*_,h[_],y[_]);return 0}co._hash=n;const s=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function i(a,p,l,h){const y=new e.IntArray(16),A=new e.IntArray(16);let _,E,T,w,C,N,L,B,$,V,G,Y,X,U,v,P,x,k,M,q,K,F,J,S,D,Q,fe=a[0],ce=a[1],re=a[2],se=a[3],ee=a[4],R=a[5],de=a[6],Ee=a[7],Ie=p[0],xe=p[1],Re=p[2],Be=p[3],Ue=p[4],gt=p[5],ct=p[6],ft=p[7],mt=0;for(;h>=128;){for(M=0;M<16;M++)q=8*M+mt,y[M]=l[q+0]<<24|l[q+1]<<16|l[q+2]<<8|l[q+3],A[M]=l[q+4]<<24|l[q+5]<<16|l[q+6]<<8|l[q+7];for(M=0;M<80;M++)if(_=fe,E=ce,T=re,w=se,C=ee,N=R,L=de,B=Ee,$=Ie,V=xe,G=Re,Y=Be,X=Ue,U=gt,v=ct,P=ft,K=Ee,F=ft,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=(ee>>>14|Ue<<18)^(ee>>>18|Ue<<14)^(Ue>>>9|ee<<23),F=(Ue>>>14|ee<<18)^(Ue>>>18|ee<<14)^(ee>>>9|Ue<<23),J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,K=ee&R^~ee&de,F=Ue&gt^~Ue&ct,J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,K=s[M*2],F=s[M*2+1],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,K=y[M%16],F=A[M%16],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,x=D&65535|Q<<16,k=J&65535|S<<16,K=x,F=k,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=(fe>>>28|Ie<<4)^(Ie>>>2|fe<<30)^(Ie>>>7|fe<<25),F=(Ie>>>28|fe<<4)^(fe>>>2|Ie<<30)^(fe>>>7|Ie<<25),J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,K=fe&ce^fe&re^ce&re,F=Ie&xe^Ie&Re^xe&Re,J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,B=D&65535|Q<<16,P=J&65535|S<<16,K=w,F=Y,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=x,F=k,J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,w=D&65535|Q<<16,Y=J&65535|S<<16,ce=_,re=E,se=T,ee=w,R=C,de=N,Ee=L,fe=B,xe=$,Re=V,Be=G,Ue=Y,gt=X,ct=U,ft=v,Ie=P,M%16===15)for(q=0;q<16;q++)K=y[q],F=A[q],J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=y[(q+9)%16],F=A[(q+9)%16],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,x=y[(q+1)%16],k=A[(q+1)%16],K=(x>>>1|k<<31)^(x>>>8|k<<24)^x>>>7,F=(k>>>1|x<<31)^(k>>>8|x<<24)^(k>>>7|x<<25),J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,x=y[(q+14)%16],k=A[(q+14)%16],K=(x>>>19|k<<13)^(k>>>29|x<<3)^x>>>6,F=(k>>>19|x<<13)^(x>>>29|k<<3)^(k>>>6|x<<26),J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,y[q]=D&65535|Q<<16,A[q]=J&65535|S<<16;K=fe,F=Ie,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=a[0],F=p[0],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,a[0]=fe=D&65535|Q<<16,p[0]=Ie=J&65535|S<<16,K=ce,F=xe,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=a[1],F=p[1],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,a[1]=ce=D&65535|Q<<16,p[1]=xe=J&65535|S<<16,K=re,F=Re,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=a[2],F=p[2],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,a[2]=re=D&65535|Q<<16,p[2]=Re=J&65535|S<<16,K=se,F=Be,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=a[3],F=p[3],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,a[3]=se=D&65535|Q<<16,p[3]=Be=J&65535|S<<16,K=ee,F=Ue,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=a[4],F=p[4],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,a[4]=ee=D&65535|Q<<16,p[4]=Ue=J&65535|S<<16,K=R,F=gt,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=a[5],F=p[5],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,a[5]=R=D&65535|Q<<16,p[5]=gt=J&65535|S<<16,K=de,F=ct,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=a[6],F=p[6],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,a[6]=de=D&65535|Q<<16,p[6]=ct=J&65535|S<<16,K=Ee,F=ft,J=F&65535,S=F>>>16,D=K&65535,Q=K>>>16,K=a[7],F=p[7],J+=F&65535,S+=F>>>16,D+=K&65535,Q+=K>>>16,S+=J>>>16,D+=S>>>16,Q+=D>>>16,a[7]=Ee=D&65535|Q<<16,p[7]=ft=J&65535|S<<16,mt+=128,h-=128}return h}function o(a,p,l,h){a[p]=l>>24&255,a[p+1]=l>>16&255,a[p+2]=l>>8&255,a[p+3]=l&255,a[p+4]=h>>24&255,a[p+5]=h>>16&255,a[p+6]=h>>8&255,a[p+7]=h&255}return co}var QA;function XA(){if(QA)return Ot;QA=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.unpackneg=Ot.pack=Ot.scalarmult=Ot.scalarbase=Ot.sign_keyPair_fromSeed=Ot.sign_keyPair_fromSecretKey=Ot.sign_keyPair=Ot.sign_detached_verify=Ot.sign_detached=Ot.sign_open=Ot.sign=void 0;const e=Hs(),t=Rm(),r=gl(),n=KI(),s=xm(),i=jI(),o=Bc();function a(v,P){if((0,o.checkArrayTypes)(v,P),P.length!==64)throw new Error("bad secret key size");const x=new e.ByteArray(64+v.length);return T(x,v,v.length,P),x}Ot.sign=a;function p(v,P){if((0,o.checkArrayTypes)(v,P),P.length!==32)throw new Error("bad public key size");const x=new e.ByteArray(v.length),k=w(x,v,v.length,P);if(k<0)return;const M=new e.ByteArray(k);for(let q=0;q<M.length;q++)M[q]=x[q];return M}Ot.sign_open=p;function l(v,P){const x=a(v,P),k=new e.ByteArray(64);for(let M=0;M<k.length;M++)k[M]=x[M];return k}Ot.sign_detached=l;function h(v,P,x){if((0,o.checkArrayTypes)(v,P,x),P.length!==64)throw new Error("bad signature size");if(x.length!==32)throw new Error("bad public key size");const k=new e.ByteArray(64+v.length),M=new e.ByteArray(64+v.length);return k.set(P),k.set(v,64),w(M,k,k.length,x)>=0}Ot.sign_detached_verify=h;function y(){const v=new e.ByteArray(32),P=new e.ByteArray(64);return E(v,P,!1),{publicKey:v,secretKey:P}}Ot.sign_keyPair=y;function A(v){if((0,o.checkArrayTypes)(v),v.length!==64)throw new Error("bad secret key size");const P=new e.ByteArray(32);for(let x=0;x<P.length;x++)P[x]=v[32+x];return{publicKey:P,secretKey:new e.ByteArray(v)}}Ot.sign_keyPair_fromSecretKey=A;function _(v){if((0,o.checkArrayTypes)(v),v.length!==32)throw new Error("bad seed size");const P=new e.ByteArray(32),x=new e.ByteArray(64);for(let k=0;k<32;k++)x[k]=v[k];return E(P,x,!0),{publicKey:P,secretKey:x}}Ot.sign_keyPair_fromSeed=_;function E(v,P,x){const k=new e.ByteArray(64),M=[(0,r.gf)(),(0,r.gf)(),(0,r.gf)(),(0,r.gf)()];let q;for(x||(0,n._randomBytes)(P,32),(0,i._hash)(k,P,32),k[0]&=248,k[31]&=127,k[31]|=64,C(M,k),L(v,M),q=0;q<32;q++)P[q+32]=v[q];return 0}function T(v,P,x,k){const M=new e.ByteArray(64),q=new e.ByteArray(64),K=new e.ByteArray(64),F=new e.NumArray(64),J=[(0,r.gf)(),(0,r.gf)(),(0,r.gf)(),(0,r.gf)()];let S,D;(0,i._hash)(M,k,32),M[0]&=248,M[31]&=127,M[31]|=64;const Q=x+64;for(S=0;S<x;S++)v[64+S]=P[S];for(S=0;S<32;S++)v[32+S]=M[32+S];for((0,i._hash)(K,v.subarray(32),x+32),$(K),C(J,K),L(v,J),S=32;S<64;S++)v[S]=k[S];for((0,i._hash)(q,v,x+64),$(q),S=0;S<64;S++)F[S]=0;for(S=0;S<32;S++)F[S]=K[S];for(S=0;S<32;S++)for(D=0;D<32;D++)F[S+D]+=q[S]*M[D];return G(v.subarray(32),F),Q}function w(v,P,x,k){const M=new e.ByteArray(32),q=new e.ByteArray(64),K=[(0,r.gf)(),(0,r.gf)(),(0,r.gf)(),(0,r.gf)()],F=[(0,r.gf)(),(0,r.gf)(),(0,r.gf)(),(0,r.gf)()];let J,S;if(S=-1,x<64||B(F,k))return-1;for(J=0;J<x;J++)v[J]=P[J];for(J=0;J<32;J++)v[J+32]=k[J];if((0,i._hash)(q,v,x),$(q),N(K,F,q),C(F,P.subarray(32)),Y(K,F),L(M,K),x-=64,(0,t._verify_32)(P,0,M,0)){for(J=0;J<x;J++)v[J]=0;return-1}for(J=0;J<x;J++)v[J]=P[J+64];return S=x,S}function C(v,P){const x=[(0,r.gf)(),(0,r.gf)(),(0,r.gf)(),(0,r.gf)()];(0,s.set25519)(x[0],r.X),(0,s.set25519)(x[1],r.Y),(0,s.set25519)(x[2],r.gf1),(0,r.multiplication)(x[3],r.X,r.Y),N(v,x,P)}Ot.scalarbase=C;function N(v,P,x){let k,M;for((0,s.set25519)(v[0],r.gf0),(0,s.set25519)(v[1],r.gf1),(0,s.set25519)(v[2],r.gf1),(0,s.set25519)(v[3],r.gf0),M=255;M>=0;--M)k=x[M/8|0]>>(M&7)&1,X(v,P,k),Y(P,v),Y(v,v),X(v,P,k)}Ot.scalarmult=N;function L(v,P){const x=(0,r.gf)(),k=(0,r.gf)(),M=(0,r.gf)();(0,s.inv25519)(M,P[2]),(0,r.multiplication)(x,P[0],M),(0,r.multiplication)(k,P[1],M),(0,s.pack25519)(v,k),v[31]^=(0,s.par25519)(x)<<7}Ot.pack=L;function B(v,P){const x=(0,r.gf)(),k=(0,r.gf)(),M=(0,r.gf)(),q=(0,r.gf)(),K=(0,r.gf)(),F=(0,r.gf)(),J=(0,r.gf)();return(0,s.set25519)(v[2],r.gf1),(0,s.unpack25519)(v[1],P),(0,r.squaring)(M,v[1]),(0,r.multiplication)(q,M,r.D),(0,r.subtraction)(M,M,v[2]),(0,r.addition)(q,v[2],q),(0,r.squaring)(K,q),(0,r.squaring)(F,K),(0,r.multiplication)(J,F,K),(0,r.multiplication)(x,J,M),(0,r.multiplication)(x,x,q),U(x,x),(0,r.multiplication)(x,x,M),(0,r.multiplication)(x,x,q),(0,r.multiplication)(x,x,q),(0,r.multiplication)(v[0],x,q),(0,r.squaring)(k,v[0]),(0,r.multiplication)(k,k,q),(0,s.neq25519)(k,M)&&(0,r.multiplication)(v[0],v[0],r.I),(0,r.squaring)(k,v[0]),(0,r.multiplication)(k,k,q),(0,s.neq25519)(k,M)?-1:((0,s.par25519)(v[0])===P[31]>>7&&(0,r.subtraction)(v[0],r.gf0,v[0]),(0,r.multiplication)(v[3],v[0],v[1]),0)}Ot.unpackneg=B;function $(v){const P=new e.NumArray(64);let x;for(x=0;x<64;x++)P[x]=v[x];for(x=0;x<64;x++)v[x]=0;G(v,P)}const V=new e.NumArray([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function G(v,P){let x,k,M,q;for(k=63;k>=32;--k){for(x=0,M=k-32,q=k-12;M<q;++M)P[M]+=x-16*P[k]*V[M-(k-32)],x=Math.floor((P[M]+128)/256),P[M]-=x*256;P[M]+=x,P[k]=0}for(x=0,M=0;M<32;M++)P[M]+=x-(P[31]>>4)*V[M],x=P[M]>>8,P[M]&=255;for(M=0;M<32;M++)P[M]-=x*V[M];for(k=0;k<32;k++)P[k+1]+=P[k]>>8,v[k]=P[k]&255}function Y(v,P){const x=(0,r.gf)(),k=(0,r.gf)(),M=(0,r.gf)(),q=(0,r.gf)(),K=(0,r.gf)(),F=(0,r.gf)(),J=(0,r.gf)(),S=(0,r.gf)(),D=(0,r.gf)();(0,r.subtraction)(x,v[1],v[0]),(0,r.subtraction)(D,P[1],P[0]),(0,r.multiplication)(x,x,D),(0,r.addition)(k,v[0],v[1]),(0,r.addition)(D,P[0],P[1]),(0,r.multiplication)(k,k,D),(0,r.multiplication)(M,v[3],P[3]),(0,r.multiplication)(M,M,r.D2),(0,r.multiplication)(q,v[2],P[2]),(0,r.addition)(q,q,q),(0,r.subtraction)(K,k,x),(0,r.subtraction)(F,q,M),(0,r.addition)(J,q,M),(0,r.addition)(S,k,x),(0,r.multiplication)(v[0],K,F),(0,r.multiplication)(v[1],S,J),(0,r.multiplication)(v[2],J,F),(0,r.multiplication)(v[3],K,S)}function X(v,P,x){for(let k=0;k<4;k++)(0,s.sel25519)(v[k],P[k],x)}function U(v,P){const x=(0,r.gf)();let k;for(k=0;k<16;k++)x[k]=P[k];for(k=250;k>=0;k--)(0,r.squaring)(x,x),k!==1&&(0,r.multiplication)(x,x,P);for(k=0;k<16;k++)v[k]=x[k]}return Ot}var WA;function zI(){return WA||(WA=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.KeypairHelper=void 0;const t=ui;t.__exportStar(XA(),e),t.__exportStar(Wd(),e),t.__exportStar(gl(),e),t.__exportStar(jI(),e),t.__exportStar(xm(),e);const r=XA(),n=Wd();class s{constructor(o){this.__buffer=o}create(o){const a=(0,r.sign_keyPair_fromSeed)(o);return{secretKey:this.__buffer.from(a.secretKey),publicKey:this.__buffer.from(a.publicKey)}}createBySecretKey(o){const a=(0,r.sign_keyPair_fromSecretKey)(o);return{secretKey:this.__buffer.from(a.secretKey),publicKey:this.__buffer.from(a.publicKey)}}detached_sign(o,a){return this.__buffer.from((0,r.sign_detached)(o,a))}detached_verify(o,a,p){return(0,r.sign_detached_verify)(o,a,p)}box(o,a,p,l=new Uint8Array(24)){return{encryptedMessage:(0,n.box)(o,l,a,p),nonce:l}}open(o,a,p,l){return(0,n.box_open)(o,a,p,l)||!1}}e.KeypairHelper=s})(kA)),kA}var qA;function ZA(){if(qA)return oo;qA=1,Object.defineProperty(oo,"__esModule",{value:!0}),oo.convertSecretKey=oo.convertPublicKey=void 0;const e=zI();function t(n){let s=new Uint8Array(32),i=[(0,e.gf)(),(0,e.gf)(),(0,e.gf)(),(0,e.gf)()],o=(0,e.gf)(),a=(0,e.gf)();if((0,e.unpackneg)(i,n))throw new TypeError("invalid public key");let p=i[1];return(0,e.addition)(o,e.gf1,p),(0,e.subtraction)(a,e.gf1,p),(0,e.inv25519)(a,a),(0,e.multiplication)(o,o,a),(0,e.pack25519)(s,o),s}oo.convertPublicKey=t;function r(n){let s=new Uint8Array(64),i=new Uint8Array(32),o;for((0,e._hash)(s,n,32),s[0]&=248,s[31]&=127,s[31]|=64,o=0;o<32;o++)i[o]=s[o];for(o=0;o<64;o++)s[o]=0;return i}return oo.convertSecretKey=r,oo}var eE;function zS(){return eE||(eE=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ed2curveHelper=void 0,ui.__exportStar(ZA(),e);const t=ZA();e.ed2curveHelper={convertPublicKey:t.convertPublicKey,convertSecretKey:t.convertSecretKey}})(PA)),PA}var po={},xl={},tE={},rE={},ba={},nE;function JI(){return nE||(nE=1,Object.defineProperty(ba,"__esModule",{value:!0}),ba.isWindows=ba.isNodejs=void 0,ba.isNodejs=!!(typeof process<"u"&&process&&process.versions&&process.versions.node),ba.isWindows=typeof process<"u"&&(process.platform==="win32"||/^(msys|cygwin)$/.test(process.env&&process.env.OSTYPE))),ba}var sE;function JS(){return sE||(sE=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.platformInfo=e.isWebWorker=e.isWebMainThread=e.isIOS=e.isAndroid=e.isWebView=e.isCordova=void 0;const t=JI(),r=(n,s)=>{try{return new Function(`return typeof ${n} === "${s}"`)()}catch{return!1}};e.isCordova=r("cordova","object"),e.isWebView=r("navigator","object"),e.isAndroid=e.isWebView&&/Android/i.test(navigator.userAgent),e.isIOS=e.isWebView&&/iPhone|iPod|iPad/i.test(navigator.userAgent),e.isWebMainThread=e.isWebView&&r("document","object"),e.isWebWorker=e.isWebView&&!e.isWebMainThread,e.platformInfo={getGlobalFlag(n,s=""){const i=this.global();return i[n]||i.process&&i.process.env&&i.process.env[n]||i.location&&i.location.href&&new URL(i.location.href).searchParams.get(n)||i.localStorage&&i.localStorage.getItem(n)||s},global(){const n=typeof globalThis=="object"?globalThis:typeof self=="object"?self.globalThis=self:typeof Zc=="object"?Zc.globalThis=Zc:Function("return this")();return this.global=()=>n,n},platformName(){if(t.isNodejs)return"Nodejs";const n=e.isAndroid?"Android":e.isIOS?"IOS":"unknown";return e.isCordova?"Cordova-"+n:e.isWebMainThread?"WebMaster-"+n:e.isWebWorker?"WebWorker-"+n:"UNKNOWN"},getChannel(){return"UNKNOWN"},getBusiness(){return"UNKNOWN"}}})(rE)),rE}var iE;function YS(){return iE||(iE=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0});const t=ui;t.__exportStar(JS(),e),t.__exportStar(JI(),e)})(tE)),tE}var Qg={},oE;function QS(){return oE||(oE=1,Object.defineProperty(Qg,"__esModule",{value:!0}),Qg.default=()=>({TextDecoder,TextEncoder})),Qg}var Xg={},aE;function XS(){return aE||(aE=1,Object.defineProperty(Xg,"__esModule",{value:!0}),Xg.default=()=>({TextDecoder,TextEncoder})),Xg}var cE;function WS(){if(cE)return xl;cE=1,Object.defineProperty(xl,"__esModule",{value:!0});const e=ui,t=YS(),r=e.__importDefault(QS()),n=e.__importDefault(XS());let s;return t.isNodejs?s=r.default:s=n.default,xl.default=s,xl}var pE;function qS(){if(pE)return po;pE=1,Object.defineProperty(po,"__esModule",{value:!0}),po.encodeUTF8ToBinary=po.decodeBinaryToUTF8=void 0;const e=ui,t=new WeakMap,r=e.__importDefault(WS()),{TextEncoder:n,TextDecoder:s}=(0,r.default)(),i=new n,o=new s("utf-8");function a(y){if(!y||!y.length)return"";let A=t.get(y);return typeof A=="string"||(A=o.decode(y),t.set(y,A)),A}po.decodeBinaryToUTF8=a;const p=new Uint8Array;function l(y){if(!y)return p;const A=y.length<=128?h(y):i.encode(y);return t.set(A,y),A}po.encodeUTF8ToBinary=l;function h(y){const A=[];let _,E;for(let T=0;T<y.length;++T)_=y.charCodeAt(T),_<128?A[A.length]=_:_<2048?(A[A.length]=_>>6|192,A[A.length]=_&63|128):(_&64512)===55296&&((E=y.charCodeAt(T+1))&64512)===56320?(_=65536+((_&1023)<<10)+(E&1023),++T,A[A.length]=_>>18|240,A[A.length]=_>>12&63|128,A[A.length]=_>>6&63|128,A[A.length]=_&63|128):(A[A.length]=_>>12|224,A[A.length]=_>>6&63|128,A[A.length]=_&63|128);return new Uint8Array(A)}return po}var hE={},zc={},lE;function ZS(){if(lE)return zc;lE=1,Object.defineProperty(zc,"__esModule",{value:!0}),zc.utf8Slice=void 0;function e(n,s,i){i=Math.min(n.length,i);for(var o=[],a=s;a<i;){var p=n[a],l=null,h=p>239?4:p>223?3:p>191?2:1;if(a+h<=i){var y,A,_,E;switch(h){case 1:p<128&&(l=p);break;case 2:y=n[a+1],(y&192)===128&&(E=(p&31)<<6|y&63,E>127&&(l=E));break;case 3:y=n[a+1],A=n[a+2],(y&192)===128&&(A&192)===128&&(E=(p&15)<<12|(y&63)<<6|A&63,E>2047&&(E<55296||E>57343)&&(l=E));break;case 4:y=n[a+1],A=n[a+2],_=n[a+3],(y&192)===128&&(A&192)===128&&(_&192)===128&&(E=(p&15)<<18|(y&63)<<12|(A&63)<<6|_&63,E>65535&&E<1114112&&(l=E))}}l===null?(l=65533,h=1):l>65535&&(l-=65536,o.push(l>>>10&1023|55296),l=56320|l&1023),o.push(l),a+=h}return r(o)}zc.utf8Slice=e;var t=4096;function r(n){var s=n.length;if(s<=t)return String.fromCharCode.apply(String,n);for(var i="",o=0;o<s;)i+=String.fromCharCode.apply(String,n.slice(o,o+=t));return i}return zc}var uE;function eN(){return uE||(uE=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),ui.__exportStar(ZS(),e)})(hE)),hE}var gE;function tN(){if(gE)return Kc;gE=1,Object.defineProperty(Kc,"__esModule",{value:!0}),Kc.BFMetaSignUtil=void 0;const e=GS(),t=zS(),r=zI(),n=qS(),s=eN(),i=new WeakMap;class o{constructor(p,l,h){this.__prefix="b",this.__prefix=p,this.__buffer=l,this.__cryptoHelper=h,this.__keypairHelper=new r.KeypairHelper(l),this.__base58Helper=new e.Base58Helper(h,l)}async isAddress(p){return typeof p!="string"||/^[0-9]{1,20}$/g.test(p)?!1:!(p[0]!==this.__prefix||!await this.__base58Helper.decodeUnsafe(p.slice(1)))}async createKeypair(p){return this.__keypairHelper.create(await this.__cryptoHelper.sha256(p))}createKeypairBySecretKey(p){return this.__keypairHelper.createBySecretKey(p)}createKeypairBySecretKeyString(p){return this.__keypairHelper.createBySecretKey(this.__buffer.from(p,"hex"))}async getPublicKeyFromSecret(p){return(await this.createKeypair(p)).publicKey.toString("hex")}async getBinaryAddressFromPublicKey(p){const l=i.get(p);if(l)return l;const h=await this.__cryptoHelper.sha256(p),y=await this.__cryptoHelper.ripemd160(h);return i.set(p,y),y}async getAddressFromPublicKey(p,l=this.__prefix){return l+await this.__base58Helper.encode(await this.getBinaryAddressFromPublicKey(p))}async getAddressFromPublicKeyString(p,l=this.__prefix){return l+await this.__base58Helper.encode(await this.getBinaryAddressFromPublicKey(this.__buffer.from(p,"hex")))}async getAddressFromSecret(p){const l=await this.createKeypair(p);return await this.getAddressFromPublicKey(l.publicKey)}async createSecondKeypair(p,l){return this.createKeypair(`${p}-${l}`)}async getSecondPublicKeyFromSecretAndSecondSecret(p,l){return(await this.createSecondKeypair(p,l)).publicKey}async getSecondPublicKeyStringFromSecretAndSecondSecret(p,l,h="hex"){return(await this.getSecondPublicKeyFromSecretAndSecondSecret(p,l)).toString(h)}async checkSecondSecret(p,l,h){return await this.getSecondPublicKeyStringFromSecretAndSecondSecret(p,l)===h}createSecondKeypairV2(p,l){return this.createKeypair(`v2:${p}-${l}`)}async getSecondPublicKeyFromSecretAndSecondSecretV2(p,l){return(await this.createSecondKeypairV2(p,l)).publicKey}async getSecondPublicKeyStringFromSecretAndSecondSecretV2(p,l,h="hex"){return(await this.getSecondPublicKeyFromSecretAndSecondSecretV2(p,l)).toString(h)}async checkSecondSecretV2(p,l,h){return await this.getSecondPublicKeyStringFromSecretAndSecondSecretV2(p,l)===h}async createSecondKeypairDeprecated(p,l){const h=`${p}-${(await this.__cryptoHelper.md5((0,n.encodeUTF8ToBinary)(l))).toString("hex")}`,y=await this.__cryptoHelper.sha256((0,n.encodeUTF8ToBinary)(h));return this.createKeypair((0,s.utf8Slice)(y,0,y.length))}async getSecondPublicKeyFromSecretAndSecondSecretDeprecated(p,l){return(await this.createSecondKeypairDeprecated(p,l)).publicKey}async getSecondPublicKeyStringFromSecretAndSecondSecretDeprecated(p,l,h="hex"){return(await this.getSecondPublicKeyFromSecretAndSecondSecretDeprecated(p,l)).toString(h)}async checkSecondSecretDeprecated(p,l,h){return await this.getSecondPublicKeyStringFromSecretAndSecondSecretDeprecated(p,l)===h}async detachedSign(p,l){const h=await this.__cryptoHelper.sha256(p);return await this.__keypairHelper.detached_sign(h,l)}async detachedVerify(p,l,h){const y=await this.__cryptoHelper.sha256(p);return this.__keypairHelper.detached_verify(y,l,h)}get detachedVeriy(){return this.detachedVerify}async signToString(p,l){return(await this.detachedSign(p,l)).toString("hex")}asymmetricEncrypt(p,l,h){const y=t.ed2curveHelper.convertPublicKey(l);if(!y)throw new Error("decryptPK convertPublicKey fail");const A=t.ed2curveHelper.convertSecretKey(h);return this.__keypairHelper.box(p,y,A)}asymmetricDecrypt(p,l,h,y=new Uint8Array(24)){const A=t.ed2curveHelper.convertPublicKey(l);if(!A)throw new Error("decryptPK convertPublicKey fail");const _=t.ed2curveHelper.convertSecretKey(h);return this.__keypairHelper.open(p,y,A,_)}}return Kc.BFMetaSignUtil=o,Kc}var fE;function rN(){return fE||(fE=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),ui.__exportStar(tN(),e)})(CA)),CA}(function(e){Object.defineProperty(e,"__esModule",{value:!0}),ui.__exportStar(rN(),e)})($I);let dE=new Map,Wg;const nN=async(e,t,r={})=>{const n=e.magic;let s=dE.get(n);if(s)return s;const i=new et,o=UI({config:new ue(e,"bfchain-bundle"),Buffer:Jn.Buffer,cryptoHelper:t,keypairHelper:HS,ed2curveHelper:DS},i);return i.set("Buffer",Jn.Buffer),i.set("customTrsRemark",r),dE.set(n,s=Ht(Tc,o.moduleMap)),Wg||(Wg=new $I.BFMetaSignUtil(e.asset.genesisAsset.bnid,Jn.Buffer,t)),{bioforestChain:s,bioforestChainSignUtil:Wg}},sN={wasmBaseUrl:"./assets",wasmLoader:e=>fetch(e).then(t=>t.arrayBuffer())};async function iN(e){Object.assign(sN,e)}const gi=e=>{let t;return(...r)=>t??(t=e(...r))},oN=gi(async()=>{const{prepareBitcoinLib:e}=await qt(async()=>{const{prepareBitcoinLib:a}=await import("./_setup-C2ViQuRv.js");return{prepareBitcoinLib:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));await e();const t=await qt(()=>import("./address-B2LfIEKg.js").then(a=>a.i),__vite__mapDeps([10,11,12,13,4,5,6,7,14,15,2,3,16,8,9])),r=await qt(()=>import("./index-D4djhYCF.js"),__vite__mapDeps([17,11,12,13,4,5,6,7,14,10,15,2,3,16,8,9,18])),n=await qt(()=>import("./psbt-CHSpNG6y.js"),__vite__mapDeps([19,5,6,10,11,12,13,4,7,14,15,2,3,16,8,9,18])),s=await qt(()=>import("./script-DijuLAta.js").then(a=>a.q),__vite__mapDeps([12,13,4,5,6,7,14])),i=await qt(()=>import("./crypto-B0d8PDDp.js"),__vite__mapDeps([16,8,3,4,5,6,7,9,2])),{OPS:o}=await qt(async()=>{const{OPS:a}=await import("./ops-CO93g0rg.js");return{OPS:a}},[]);return{address:t,payments:r,psbt:n,script:s,crypto:i,OPS:o}}),vm=gi(async()=>{const{prepareTinySecp256k1:e}=await qt(async()=>{const{prepareTinySecp256k1:t}=await import("./_setup-zqfuA-N7.js");return{prepareTinySecp256k1:t}},__vite__mapDeps([20,21,4,5,6,7]));return await e(),await qt(()=>import("./index-B_g-nPjg.js").then(t=>t.a),[])}),aN=gi(async()=>{const{prepareBip39:e}=await qt(async()=>{const{prepareBip39:n}=await import("./_setup-B6z42WBz.js");return{prepareBip39:n}},__vite__mapDeps([22,2,3,4,5,6,7,23]));await e();const t=await qt(()=>import("./wordlists-CYL0orSr.js"),__vite__mapDeps([24,5,6])),r=await qt(()=>import("./index-CtgQB5yp.js"),__vite__mapDeps([25,26,27,3,4,5,6,7,2,23,24]));return{wordlists:t,bip39:r}}),cN=gi(async()=>{const[e,{prepareBip32:t}]=await Promise.all([vm(),qt(()=>import("./_setup-CC-nphxM.js"),__vite__mapDeps([28,8,3,4,5,6,7,2,23]))]);await t();const{BIP32Factory:r}=await qt(async()=>{const{BIP32Factory:n}=await import("./bip32-ieQFI03k.js");return{BIP32Factory:n}},__vite__mapDeps([29,23,3,4,5,6,7,27,16,8,9,2,15,14,30]));return r(e)}),pN=gi(async()=>{const[e,{prepareEcpair:t}]=await Promise.all([vm(),qt(()=>import("./_setup-DEVovPQB.js"),__vite__mapDeps([31,1,2,3,4,5,6,7]))]);await t();const{ECPairFactory:r}=await qt(async()=>{const{ECPairFactory:n}=await import("./ecpair-C_48lQHW.js");return{ECPairFactory:n}},__vite__mapDeps([32,30,15,5,6,2,3,4,7,14]));return r(e)}),hN=gi(()=>qt(()=>import("./index-xdEahPYM.js"),__vite__mapDeps([33,11]))),lN=gi(async()=>{const{prepareEthereumUtil:e}=await qt(async()=>{const{prepareEthereumUtil:t}=await import("./_setup-C1uiVZaq.js");return{prepareEthereumUtil:t}},__vite__mapDeps([34,20,21,4,5,6,7,35,3]));return await e(),await qt(()=>import("./index-DSbz8f8f.js"),__vite__mapDeps([36,37,35,3,4,5,6,7,21]))}),ag=gi(async()=>await qt(()=>import("./index-D6oW2-lj.js"),__vite__mapDeps([38,3,4,5,6,7,27,37,35,26,8,2,9,23]))),uN=Object.freeze(Object.defineProperty({__proto__:null,getBip32:cN,getBip39:aN,getBitcoin:oN,getEcpair:pN,getEthereumUtil:lN,getHashWasm:ag,getNetworks:hN,getTinySecp256k1:vm},Symbol.toStringTag,{value:"Module"}));var qg={},Jc={},yE;function gN(){if(yE)return Jc;yE=1,Jc.byteLength=a,Jc.toByteArray=l,Jc.fromByteArray=A;for(var e=[],t=[],r=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,i=n.length;s<i;++s)e[s]=n[s],t[n.charCodeAt(s)]=s;t[45]=62,t[95]=63;function o(_){var E=_.length;if(E%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var T=_.indexOf("=");T===-1&&(T=E);var w=T===E?0:4-T%4;return[T,w]}function a(_){var E=o(_),T=E[0],w=E[1];return(T+w)*3/4-w}function p(_,E,T){return(E+T)*3/4-T}function l(_){var E,T=o(_),w=T[0],C=T[1],N=new r(p(_,w,C)),L=0,B=C>0?w-4:w,$;for($=0;$<B;$+=4)E=t[_.charCodeAt($)]<<18|t[_.charCodeAt($+1)]<<12|t[_.charCodeAt($+2)]<<6|t[_.charCodeAt($+3)],N[L++]=E>>16&255,N[L++]=E>>8&255,N[L++]=E&255;return C===2&&(E=t[_.charCodeAt($)]<<2|t[_.charCodeAt($+1)]>>4,N[L++]=E&255),C===1&&(E=t[_.charCodeAt($)]<<10|t[_.charCodeAt($+1)]<<4|t[_.charCodeAt($+2)]>>2,N[L++]=E>>8&255,N[L++]=E&255),N}function h(_){return e[_>>18&63]+e[_>>12&63]+e[_>>6&63]+e[_&63]}function y(_,E,T){for(var w,C=[],N=E;N<T;N+=3)w=(_[N]<<16&16711680)+(_[N+1]<<8&65280)+(_[N+2]&255),C.push(h(w));return C.join("")}function A(_){for(var E,T=_.length,w=T%3,C=[],N=16383,L=0,B=T-w;L<B;L+=N)C.push(y(_,L,L+N>B?B:L+N));return w===1?(E=_[T-1],C.push(e[E>>2]+e[E<<4&63]+"==")):w===2&&(E=(_[T-2]<<8)+_[T-1],C.push(e[E>>10]+e[E>>4&63]+e[E<<2&63]+"=")),C.join("")}return Jc}var Rl={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var mE;function fN(){return mE||(mE=1,Rl.read=function(e,t,r,n,s){var i,o,a=s*8-n-1,p=(1<<a)-1,l=p>>1,h=-7,y=r?s-1:0,A=r?-1:1,_=e[t+y];for(y+=A,i=_&(1<<-h)-1,_>>=-h,h+=a;h>0;i=i*256+e[t+y],y+=A,h-=8);for(o=i&(1<<-h)-1,i>>=-h,h+=n;h>0;o=o*256+e[t+y],y+=A,h-=8);if(i===0)i=1-l;else{if(i===p)return o?NaN:(_?-1:1)*(1/0);o=o+Math.pow(2,n),i=i-l}return(_?-1:1)*o*Math.pow(2,i-n)},Rl.write=function(e,t,r,n,s,i){var o,a,p,l=i*8-s-1,h=(1<<l)-1,y=h>>1,A=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=n?0:i-1,E=n?1:-1,T=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(p=Math.pow(2,-o))<1&&(o--,p*=2),o+y>=1?t+=A/p:t+=A*Math.pow(2,1-y),t*p>=2&&(o++,p/=2),o+y>=h?(a=0,o=h):o+y>=1?(a=(t*p-1)*Math.pow(2,s),o=o+y):(a=t*Math.pow(2,y-1)*Math.pow(2,s),o=0));s>=8;e[r+_]=a&255,_+=E,a/=256,s-=8);for(o=o<<s|a,l+=s;l>0;e[r+_]=o&255,_+=E,o/=256,l-=8);e[r+_-E]|=T*128}),Rl}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var _E;function dN(){return _E||(_E=1,(function(e){const t=gN(),r=fN(),n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=a,e.SlowBuffer=N,e.INSPECT_MAX_BYTES=50;const s=2147483647;e.kMaxLength=s,a.TYPED_ARRAY_SUPPORT=i(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{const d=new Uint8Array(1),f={foo:function(){return 42}};return Object.setPrototypeOf(f,Uint8Array.prototype),Object.setPrototypeOf(d,f),d.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(d){if(d>s)throw new RangeError('The value "'+d+'" is invalid for option "size"');const f=new Uint8Array(d);return Object.setPrototypeOf(f,a.prototype),f}function a(d,f,m){if(typeof d=="number"){if(typeof f=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(d)}return p(d,f,m)}a.poolSize=8192;function p(d,f,m){if(typeof d=="string")return A(d,f);if(ArrayBuffer.isView(d))return E(d);if(d==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d);if(qe(d,ArrayBuffer)||d&&qe(d.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(qe(d,SharedArrayBuffer)||d&&qe(d.buffer,SharedArrayBuffer)))return T(d,f,m);if(typeof d=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const b=d.valueOf&&d.valueOf();if(b!=null&&b!==d)return a.from(b,f,m);const O=w(d);if(O)return O;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof d[Symbol.toPrimitive]=="function")return a.from(d[Symbol.toPrimitive]("string"),f,m);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof d)}a.from=function(d,f,m){return p(d,f,m)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l(d){if(typeof d!="number")throw new TypeError('"size" argument must be of type number');if(d<0)throw new RangeError('The value "'+d+'" is invalid for option "size"')}function h(d,f,m){return l(d),d<=0?o(d):f!==void 0?typeof m=="string"?o(d).fill(f,m):o(d).fill(f):o(d)}a.alloc=function(d,f,m){return h(d,f,m)};function y(d){return l(d),o(d<0?0:C(d)|0)}a.allocUnsafe=function(d){return y(d)},a.allocUnsafeSlow=function(d){return y(d)};function A(d,f){if((typeof f!="string"||f==="")&&(f="utf8"),!a.isEncoding(f))throw new TypeError("Unknown encoding: "+f);const m=L(d,f)|0;let b=o(m);const O=b.write(d,f);return O!==m&&(b=b.slice(0,O)),b}function _(d){const f=d.length<0?0:C(d.length)|0,m=o(f);for(let b=0;b<f;b+=1)m[b]=d[b]&255;return m}function E(d){if(qe(d,Uint8Array)){const f=new Uint8Array(d);return T(f.buffer,f.byteOffset,f.byteLength)}return _(d)}function T(d,f,m){if(f<0||d.byteLength<f)throw new RangeError('"offset" is outside of buffer bounds');if(d.byteLength<f+(m||0))throw new RangeError('"length" is outside of buffer bounds');let b;return f===void 0&&m===void 0?b=new Uint8Array(d):m===void 0?b=new Uint8Array(d,f):b=new Uint8Array(d,f,m),Object.setPrototypeOf(b,a.prototype),b}function w(d){if(a.isBuffer(d)){const f=C(d.length)|0,m=o(f);return m.length===0||d.copy(m,0,0,f),m}if(d.length!==void 0)return typeof d.length!="number"||Dn(d.length)?o(0):_(d);if(d.type==="Buffer"&&Array.isArray(d.data))return _(d.data)}function C(d){if(d>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return d|0}function N(d){return+d!=d&&(d=0),a.alloc(+d)}a.isBuffer=function(f){return f!=null&&f._isBuffer===!0&&f!==a.prototype},a.compare=function(f,m){if(qe(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),qe(m,Uint8Array)&&(m=a.from(m,m.offset,m.byteLength)),!a.isBuffer(f)||!a.isBuffer(m))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(f===m)return 0;let b=f.length,O=m.length;for(let H=0,z=Math.min(b,O);H<z;++H)if(f[H]!==m[H]){b=f[H],O=m[H];break}return b<O?-1:O<b?1:0},a.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(f,m){if(!Array.isArray(f))throw new TypeError('"list" argument must be an Array of Buffers');if(f.length===0)return a.alloc(0);let b;if(m===void 0)for(m=0,b=0;b<f.length;++b)m+=f[b].length;const O=a.allocUnsafe(m);let H=0;for(b=0;b<f.length;++b){let z=f[b];if(qe(z,Uint8Array))H+z.length>O.length?(a.isBuffer(z)||(z=a.from(z)),z.copy(O,H)):Uint8Array.prototype.set.call(O,z,H);else if(a.isBuffer(z))z.copy(O,H);else throw new TypeError('"list" argument must be an Array of Buffers');H+=z.length}return O};function L(d,f){if(a.isBuffer(d))return d.length;if(ArrayBuffer.isView(d)||qe(d,ArrayBuffer))return d.byteLength;if(typeof d!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof d);const m=d.length,b=arguments.length>2&&arguments[2]===!0;if(!b&&m===0)return 0;let O=!1;for(;;)switch(f){case"ascii":case"latin1":case"binary":return m;case"utf8":case"utf-8":return ct(d).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m*2;case"hex":return m>>>1;case"base64":return Ct(d).length;default:if(O)return b?-1:ct(d).length;f=(""+f).toLowerCase(),O=!0}}a.byteLength=L;function B(d,f,m){let b=!1;if((f===void 0||f<0)&&(f=0),f>this.length||((m===void 0||m>this.length)&&(m=this.length),m<=0)||(m>>>=0,f>>>=0,m<=f))return"";for(d||(d="utf8");;)switch(d){case"hex":return J(this,f,m);case"utf8":case"utf-8":return k(this,f,m);case"ascii":return K(this,f,m);case"latin1":case"binary":return F(this,f,m);case"base64":return x(this,f,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,f,m);default:if(b)throw new TypeError("Unknown encoding: "+d);d=(d+"").toLowerCase(),b=!0}}a.prototype._isBuffer=!0;function $(d,f,m){const b=d[f];d[f]=d[m],d[m]=b}a.prototype.swap16=function(){const f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let m=0;m<f;m+=2)$(this,m,m+1);return this},a.prototype.swap32=function(){const f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let m=0;m<f;m+=4)$(this,m,m+3),$(this,m+1,m+2);return this},a.prototype.swap64=function(){const f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let m=0;m<f;m+=8)$(this,m,m+7),$(this,m+1,m+6),$(this,m+2,m+5),$(this,m+3,m+4);return this},a.prototype.toString=function(){const f=this.length;return f===0?"":arguments.length===0?k(this,0,f):B.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(f){if(!a.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:a.compare(this,f)===0},a.prototype.inspect=function(){let f="";const m=e.INSPECT_MAX_BYTES;return f=this.toString("hex",0,m).replace(/(.{2})/g,"$1 ").trim(),this.length>m&&(f+=" ... "),"<Buffer "+f+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(f,m,b,O,H){if(qe(f,Uint8Array)&&(f=a.from(f,f.offset,f.byteLength)),!a.isBuffer(f))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof f);if(m===void 0&&(m=0),b===void 0&&(b=f?f.length:0),O===void 0&&(O=0),H===void 0&&(H=this.length),m<0||b>f.length||O<0||H>this.length)throw new RangeError("out of range index");if(O>=H&&m>=b)return 0;if(O>=H)return-1;if(m>=b)return 1;if(m>>>=0,b>>>=0,O>>>=0,H>>>=0,this===f)return 0;let z=H-O,ye=b-m;const Ke=Math.min(z,ye),$e=this.slice(O,H),je=f.slice(m,b);for(let ze=0;ze<Ke;++ze)if($e[ze]!==je[ze]){z=$e[ze],ye=je[ze];break}return z<ye?-1:ye<z?1:0};function V(d,f,m,b,O){if(d.length===0)return-1;if(typeof m=="string"?(b=m,m=0):m>2147483647?m=2147483647:m<-2147483648&&(m=-2147483648),m=+m,Dn(m)&&(m=O?0:d.length-1),m<0&&(m=d.length+m),m>=d.length){if(O)return-1;m=d.length-1}else if(m<0)if(O)m=0;else return-1;if(typeof f=="string"&&(f=a.from(f,b)),a.isBuffer(f))return f.length===0?-1:G(d,f,m,b,O);if(typeof f=="number")return f=f&255,typeof Uint8Array.prototype.indexOf=="function"?O?Uint8Array.prototype.indexOf.call(d,f,m):Uint8Array.prototype.lastIndexOf.call(d,f,m):G(d,[f],m,b,O);throw new TypeError("val must be string, number or Buffer")}function G(d,f,m,b,O){let H=1,z=d.length,ye=f.length;if(b!==void 0&&(b=String(b).toLowerCase(),b==="ucs2"||b==="ucs-2"||b==="utf16le"||b==="utf-16le")){if(d.length<2||f.length<2)return-1;H=2,z/=2,ye/=2,m/=2}function Ke(je,ze){return H===1?je[ze]:je.readUInt16BE(ze*H)}let $e;if(O){let je=-1;for($e=m;$e<z;$e++)if(Ke(d,$e)===Ke(f,je===-1?0:$e-je)){if(je===-1&&(je=$e),$e-je+1===ye)return je*H}else je!==-1&&($e-=$e-je),je=-1}else for(m+ye>z&&(m=z-ye),$e=m;$e>=0;$e--){let je=!0;for(let ze=0;ze<ye;ze++)if(Ke(d,$e+ze)!==Ke(f,ze)){je=!1;break}if(je)return $e}return-1}a.prototype.includes=function(f,m,b){return this.indexOf(f,m,b)!==-1},a.prototype.indexOf=function(f,m,b){return V(this,f,m,b,!0)},a.prototype.lastIndexOf=function(f,m,b){return V(this,f,m,b,!1)};function Y(d,f,m,b){m=Number(m)||0;const O=d.length-m;b?(b=Number(b),b>O&&(b=O)):b=O;const H=f.length;b>H/2&&(b=H/2);let z;for(z=0;z<b;++z){const ye=parseInt(f.substr(z*2,2),16);if(Dn(ye))return z;d[m+z]=ye}return z}function X(d,f,m,b){return dt(ct(f,d.length-m),d,m,b)}function U(d,f,m,b){return dt(ft(f),d,m,b)}function v(d,f,m,b){return dt(Ct(f),d,m,b)}function P(d,f,m,b){return dt(mt(f,d.length-m),d,m,b)}a.prototype.write=function(f,m,b,O){if(m===void 0)O="utf8",b=this.length,m=0;else if(b===void 0&&typeof m=="string")O=m,b=this.length,m=0;else if(isFinite(m))m=m>>>0,isFinite(b)?(b=b>>>0,O===void 0&&(O="utf8")):(O=b,b=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const H=this.length-m;if((b===void 0||b>H)&&(b=H),f.length>0&&(b<0||m<0)||m>this.length)throw new RangeError("Attempt to write outside buffer bounds");O||(O="utf8");let z=!1;for(;;)switch(O){case"hex":return Y(this,f,m,b);case"utf8":case"utf-8":return X(this,f,m,b);case"ascii":case"latin1":case"binary":return U(this,f,m,b);case"base64":return v(this,f,m,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,f,m,b);default:if(z)throw new TypeError("Unknown encoding: "+O);O=(""+O).toLowerCase(),z=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function x(d,f,m){return f===0&&m===d.length?t.fromByteArray(d):t.fromByteArray(d.slice(f,m))}function k(d,f,m){m=Math.min(d.length,m);const b=[];let O=f;for(;O<m;){const H=d[O];let z=null,ye=H>239?4:H>223?3:H>191?2:1;if(O+ye<=m){let Ke,$e,je,ze;switch(ye){case 1:H<128&&(z=H);break;case 2:Ke=d[O+1],(Ke&192)===128&&(ze=(H&31)<<6|Ke&63,ze>127&&(z=ze));break;case 3:Ke=d[O+1],$e=d[O+2],(Ke&192)===128&&($e&192)===128&&(ze=(H&15)<<12|(Ke&63)<<6|$e&63,ze>2047&&(ze<55296||ze>57343)&&(z=ze));break;case 4:Ke=d[O+1],$e=d[O+2],je=d[O+3],(Ke&192)===128&&($e&192)===128&&(je&192)===128&&(ze=(H&15)<<18|(Ke&63)<<12|($e&63)<<6|je&63,ze>65535&&ze<1114112&&(z=ze))}}z===null?(z=65533,ye=1):z>65535&&(z-=65536,b.push(z>>>10&1023|55296),z=56320|z&1023),b.push(z),O+=ye}return q(b)}const M=4096;function q(d){const f=d.length;if(f<=M)return String.fromCharCode.apply(String,d);let m="",b=0;for(;b<f;)m+=String.fromCharCode.apply(String,d.slice(b,b+=M));return m}function K(d,f,m){let b="";m=Math.min(d.length,m);for(let O=f;O<m;++O)b+=String.fromCharCode(d[O]&127);return b}function F(d,f,m){let b="";m=Math.min(d.length,m);for(let O=f;O<m;++O)b+=String.fromCharCode(d[O]);return b}function J(d,f,m){const b=d.length;(!f||f<0)&&(f=0),(!m||m<0||m>b)&&(m=b);let O="";for(let H=f;H<m;++H)O+=ae[d[H]];return O}function S(d,f,m){const b=d.slice(f,m);let O="";for(let H=0;H<b.length-1;H+=2)O+=String.fromCharCode(b[H]+b[H+1]*256);return O}a.prototype.slice=function(f,m){const b=this.length;f=~~f,m=m===void 0?b:~~m,f<0?(f+=b,f<0&&(f=0)):f>b&&(f=b),m<0?(m+=b,m<0&&(m=0)):m>b&&(m=b),m<f&&(m=f);const O=this.subarray(f,m);return Object.setPrototypeOf(O,a.prototype),O};function D(d,f,m){if(d%1!==0||d<0)throw new RangeError("offset is not uint");if(d+f>m)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(f,m,b){f=f>>>0,m=m>>>0,b||D(f,m,this.length);let O=this[f],H=1,z=0;for(;++z<m&&(H*=256);)O+=this[f+z]*H;return O},a.prototype.readUintBE=a.prototype.readUIntBE=function(f,m,b){f=f>>>0,m=m>>>0,b||D(f,m,this.length);let O=this[f+--m],H=1;for(;m>0&&(H*=256);)O+=this[f+--m]*H;return O},a.prototype.readUint8=a.prototype.readUInt8=function(f,m){return f=f>>>0,m||D(f,1,this.length),this[f]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(f,m){return f=f>>>0,m||D(f,2,this.length),this[f]|this[f+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(f,m){return f=f>>>0,m||D(f,2,this.length),this[f]<<8|this[f+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(f,m){return f=f>>>0,m||D(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(f,m){return f=f>>>0,m||D(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},a.prototype.readBigUInt64LE=pe(function(f){f=f>>>0,Re(f,"offset");const m=this[f],b=this[f+7];(m===void 0||b===void 0)&&Be(f,this.length-8);const O=m+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24,H=this[++f]+this[++f]*2**8+this[++f]*2**16+b*2**24;return BigInt(O)+(BigInt(H)<<BigInt(32))}),a.prototype.readBigUInt64BE=pe(function(f){f=f>>>0,Re(f,"offset");const m=this[f],b=this[f+7];(m===void 0||b===void 0)&&Be(f,this.length-8);const O=m*2**24+this[++f]*2**16+this[++f]*2**8+this[++f],H=this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+b;return(BigInt(O)<<BigInt(32))+BigInt(H)}),a.prototype.readIntLE=function(f,m,b){f=f>>>0,m=m>>>0,b||D(f,m,this.length);let O=this[f],H=1,z=0;for(;++z<m&&(H*=256);)O+=this[f+z]*H;return H*=128,O>=H&&(O-=Math.pow(2,8*m)),O},a.prototype.readIntBE=function(f,m,b){f=f>>>0,m=m>>>0,b||D(f,m,this.length);let O=m,H=1,z=this[f+--O];for(;O>0&&(H*=256);)z+=this[f+--O]*H;return H*=128,z>=H&&(z-=Math.pow(2,8*m)),z},a.prototype.readInt8=function(f,m){return f=f>>>0,m||D(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},a.prototype.readInt16LE=function(f,m){f=f>>>0,m||D(f,2,this.length);const b=this[f]|this[f+1]<<8;return b&32768?b|4294901760:b},a.prototype.readInt16BE=function(f,m){f=f>>>0,m||D(f,2,this.length);const b=this[f+1]|this[f]<<8;return b&32768?b|4294901760:b},a.prototype.readInt32LE=function(f,m){return f=f>>>0,m||D(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},a.prototype.readInt32BE=function(f,m){return f=f>>>0,m||D(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},a.prototype.readBigInt64LE=pe(function(f){f=f>>>0,Re(f,"offset");const m=this[f],b=this[f+7];(m===void 0||b===void 0)&&Be(f,this.length-8);const O=this[f+4]+this[f+5]*2**8+this[f+6]*2**16+(b<<24);return(BigInt(O)<<BigInt(32))+BigInt(m+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24)}),a.prototype.readBigInt64BE=pe(function(f){f=f>>>0,Re(f,"offset");const m=this[f],b=this[f+7];(m===void 0||b===void 0)&&Be(f,this.length-8);const O=(m<<24)+this[++f]*2**16+this[++f]*2**8+this[++f];return(BigInt(O)<<BigInt(32))+BigInt(this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+b)}),a.prototype.readFloatLE=function(f,m){return f=f>>>0,m||D(f,4,this.length),r.read(this,f,!0,23,4)},a.prototype.readFloatBE=function(f,m){return f=f>>>0,m||D(f,4,this.length),r.read(this,f,!1,23,4)},a.prototype.readDoubleLE=function(f,m){return f=f>>>0,m||D(f,8,this.length),r.read(this,f,!0,52,8)},a.prototype.readDoubleBE=function(f,m){return f=f>>>0,m||D(f,8,this.length),r.read(this,f,!1,52,8)};function Q(d,f,m,b,O,H){if(!a.isBuffer(d))throw new TypeError('"buffer" argument must be a Buffer instance');if(f>O||f<H)throw new RangeError('"value" argument is out of bounds');if(m+b>d.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(f,m,b,O){if(f=+f,m=m>>>0,b=b>>>0,!O){const ye=Math.pow(2,8*b)-1;Q(this,f,m,b,ye,0)}let H=1,z=0;for(this[m]=f&255;++z<b&&(H*=256);)this[m+z]=f/H&255;return m+b},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(f,m,b,O){if(f=+f,m=m>>>0,b=b>>>0,!O){const ye=Math.pow(2,8*b)-1;Q(this,f,m,b,ye,0)}let H=b-1,z=1;for(this[m+H]=f&255;--H>=0&&(z*=256);)this[m+H]=f/z&255;return m+b},a.prototype.writeUint8=a.prototype.writeUInt8=function(f,m,b){return f=+f,m=m>>>0,b||Q(this,f,m,1,255,0),this[m]=f&255,m+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(f,m,b){return f=+f,m=m>>>0,b||Q(this,f,m,2,65535,0),this[m]=f&255,this[m+1]=f>>>8,m+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(f,m,b){return f=+f,m=m>>>0,b||Q(this,f,m,2,65535,0),this[m]=f>>>8,this[m+1]=f&255,m+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(f,m,b){return f=+f,m=m>>>0,b||Q(this,f,m,4,4294967295,0),this[m+3]=f>>>24,this[m+2]=f>>>16,this[m+1]=f>>>8,this[m]=f&255,m+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(f,m,b){return f=+f,m=m>>>0,b||Q(this,f,m,4,4294967295,0),this[m]=f>>>24,this[m+1]=f>>>16,this[m+2]=f>>>8,this[m+3]=f&255,m+4};function fe(d,f,m,b,O){xe(f,b,O,d,m,7);let H=Number(f&BigInt(4294967295));d[m++]=H,H=H>>8,d[m++]=H,H=H>>8,d[m++]=H,H=H>>8,d[m++]=H;let z=Number(f>>BigInt(32)&BigInt(4294967295));return d[m++]=z,z=z>>8,d[m++]=z,z=z>>8,d[m++]=z,z=z>>8,d[m++]=z,m}function ce(d,f,m,b,O){xe(f,b,O,d,m,7);let H=Number(f&BigInt(4294967295));d[m+7]=H,H=H>>8,d[m+6]=H,H=H>>8,d[m+5]=H,H=H>>8,d[m+4]=H;let z=Number(f>>BigInt(32)&BigInt(4294967295));return d[m+3]=z,z=z>>8,d[m+2]=z,z=z>>8,d[m+1]=z,z=z>>8,d[m]=z,m+8}a.prototype.writeBigUInt64LE=pe(function(f,m=0){return fe(this,f,m,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=pe(function(f,m=0){return ce(this,f,m,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(f,m,b,O){if(f=+f,m=m>>>0,!O){const Ke=Math.pow(2,8*b-1);Q(this,f,m,b,Ke-1,-Ke)}let H=0,z=1,ye=0;for(this[m]=f&255;++H<b&&(z*=256);)f<0&&ye===0&&this[m+H-1]!==0&&(ye=1),this[m+H]=(f/z>>0)-ye&255;return m+b},a.prototype.writeIntBE=function(f,m,b,O){if(f=+f,m=m>>>0,!O){const Ke=Math.pow(2,8*b-1);Q(this,f,m,b,Ke-1,-Ke)}let H=b-1,z=1,ye=0;for(this[m+H]=f&255;--H>=0&&(z*=256);)f<0&&ye===0&&this[m+H+1]!==0&&(ye=1),this[m+H]=(f/z>>0)-ye&255;return m+b},a.prototype.writeInt8=function(f,m,b){return f=+f,m=m>>>0,b||Q(this,f,m,1,127,-128),f<0&&(f=255+f+1),this[m]=f&255,m+1},a.prototype.writeInt16LE=function(f,m,b){return f=+f,m=m>>>0,b||Q(this,f,m,2,32767,-32768),this[m]=f&255,this[m+1]=f>>>8,m+2},a.prototype.writeInt16BE=function(f,m,b){return f=+f,m=m>>>0,b||Q(this,f,m,2,32767,-32768),this[m]=f>>>8,this[m+1]=f&255,m+2},a.prototype.writeInt32LE=function(f,m,b){return f=+f,m=m>>>0,b||Q(this,f,m,4,2147483647,-2147483648),this[m]=f&255,this[m+1]=f>>>8,this[m+2]=f>>>16,this[m+3]=f>>>24,m+4},a.prototype.writeInt32BE=function(f,m,b){return f=+f,m=m>>>0,b||Q(this,f,m,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[m]=f>>>24,this[m+1]=f>>>16,this[m+2]=f>>>8,this[m+3]=f&255,m+4},a.prototype.writeBigInt64LE=pe(function(f,m=0){return fe(this,f,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=pe(function(f,m=0){return ce(this,f,m,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function re(d,f,m,b,O,H){if(m+b>d.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("Index out of range")}function se(d,f,m,b,O){return f=+f,m=m>>>0,O||re(d,f,m,4),r.write(d,f,m,b,23,4),m+4}a.prototype.writeFloatLE=function(f,m,b){return se(this,f,m,!0,b)},a.prototype.writeFloatBE=function(f,m,b){return se(this,f,m,!1,b)};function ee(d,f,m,b,O){return f=+f,m=m>>>0,O||re(d,f,m,8),r.write(d,f,m,b,52,8),m+8}a.prototype.writeDoubleLE=function(f,m,b){return ee(this,f,m,!0,b)},a.prototype.writeDoubleBE=function(f,m,b){return ee(this,f,m,!1,b)},a.prototype.copy=function(f,m,b,O){if(!a.isBuffer(f))throw new TypeError("argument should be a Buffer");if(b||(b=0),!O&&O!==0&&(O=this.length),m>=f.length&&(m=f.length),m||(m=0),O>0&&O<b&&(O=b),O===b||f.length===0||this.length===0)return 0;if(m<0)throw new RangeError("targetStart out of bounds");if(b<0||b>=this.length)throw new RangeError("Index out of range");if(O<0)throw new RangeError("sourceEnd out of bounds");O>this.length&&(O=this.length),f.length-m<O-b&&(O=f.length-m+b);const H=O-b;return this===f&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(m,b,O):Uint8Array.prototype.set.call(f,this.subarray(b,O),m),H},a.prototype.fill=function(f,m,b,O){if(typeof f=="string"){if(typeof m=="string"?(O=m,m=0,b=this.length):typeof b=="string"&&(O=b,b=this.length),O!==void 0&&typeof O!="string")throw new TypeError("encoding must be a string");if(typeof O=="string"&&!a.isEncoding(O))throw new TypeError("Unknown encoding: "+O);if(f.length===1){const z=f.charCodeAt(0);(O==="utf8"&&z<128||O==="latin1")&&(f=z)}}else typeof f=="number"?f=f&255:typeof f=="boolean"&&(f=Number(f));if(m<0||this.length<m||this.length<b)throw new RangeError("Out of range index");if(b<=m)return this;m=m>>>0,b=b===void 0?this.length:b>>>0,f||(f=0);let H;if(typeof f=="number")for(H=m;H<b;++H)this[H]=f;else{const z=a.isBuffer(f)?f:a.from(f,O),ye=z.length;if(ye===0)throw new TypeError('The value "'+f+'" is invalid for argument "value"');for(H=0;H<b-m;++H)this[H+m]=z[H%ye]}return this};const R={};function de(d,f,m){R[d]=class extends m{constructor(){super(),Object.defineProperty(this,"message",{value:f.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${d}]`,this.stack,delete this.name}get code(){return d}set code(O){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:O,writable:!0})}toString(){return`${this.name} [${d}]: ${this.message}`}}}de("ERR_BUFFER_OUT_OF_BOUNDS",function(d){return d?`${d} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),de("ERR_INVALID_ARG_TYPE",function(d,f){return`The "${d}" argument must be of type number. Received type ${typeof f}`},TypeError),de("ERR_OUT_OF_RANGE",function(d,f,m){let b=`The value of "${d}" is out of range.`,O=m;return Number.isInteger(m)&&Math.abs(m)>2**32?O=Ee(String(m)):typeof m=="bigint"&&(O=String(m),(m>BigInt(2)**BigInt(32)||m<-(BigInt(2)**BigInt(32)))&&(O=Ee(O)),O+="n"),b+=` It must be ${f}. Received ${O}`,b},RangeError);function Ee(d){let f="",m=d.length;const b=d[0]==="-"?1:0;for(;m>=b+4;m-=3)f=`_${d.slice(m-3,m)}${f}`;return`${d.slice(0,m)}${f}`}function Ie(d,f,m){Re(f,"offset"),(d[f]===void 0||d[f+m]===void 0)&&Be(f,d.length-(m+1))}function xe(d,f,m,b,O,H){if(d>m||d<f){const z=typeof f=="bigint"?"n":"";let ye;throw f===0||f===BigInt(0)?ye=`>= 0${z} and < 2${z} ** ${(H+1)*8}${z}`:ye=`>= -(2${z} ** ${(H+1)*8-1}${z}) and < 2 ** ${(H+1)*8-1}${z}`,new R.ERR_OUT_OF_RANGE("value",ye,d)}Ie(b,O,H)}function Re(d,f){if(typeof d!="number")throw new R.ERR_INVALID_ARG_TYPE(f,"number",d)}function Be(d,f,m){throw Math.floor(d)!==d?(Re(d,m),new R.ERR_OUT_OF_RANGE("offset","an integer",d)):f<0?new R.ERR_BUFFER_OUT_OF_BOUNDS:new R.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${f}`,d)}const Ue=/[^+/0-9A-Za-z-_]/g;function gt(d){if(d=d.split("=")[0],d=d.trim().replace(Ue,""),d.length<2)return"";for(;d.length%4!==0;)d=d+"=";return d}function ct(d,f){f=f||1/0;let m;const b=d.length;let O=null;const H=[];for(let z=0;z<b;++z){if(m=d.charCodeAt(z),m>55295&&m<57344){if(!O){if(m>56319){(f-=3)>-1&&H.push(239,191,189);continue}else if(z+1===b){(f-=3)>-1&&H.push(239,191,189);continue}O=m;continue}if(m<56320){(f-=3)>-1&&H.push(239,191,189),O=m;continue}m=(O-55296<<10|m-56320)+65536}else O&&(f-=3)>-1&&H.push(239,191,189);if(O=null,m<128){if((f-=1)<0)break;H.push(m)}else if(m<2048){if((f-=2)<0)break;H.push(m>>6|192,m&63|128)}else if(m<65536){if((f-=3)<0)break;H.push(m>>12|224,m>>6&63|128,m&63|128)}else if(m<1114112){if((f-=4)<0)break;H.push(m>>18|240,m>>12&63|128,m>>6&63|128,m&63|128)}else throw new Error("Invalid code point")}return H}function ft(d){const f=[];for(let m=0;m<d.length;++m)f.push(d.charCodeAt(m)&255);return f}function mt(d,f){let m,b,O;const H=[];for(let z=0;z<d.length&&!((f-=2)<0);++z)m=d.charCodeAt(z),b=m>>8,O=m%256,H.push(O),H.push(b);return H}function Ct(d){return t.toByteArray(gt(d))}function dt(d,f,m,b){let O;for(O=0;O<b&&!(O+m>=f.length||O>=d.length);++O)f[O+m]=d[O];return O}function qe(d,f){return d instanceof f||d!=null&&d.constructor!=null&&d.constructor.name!=null&&d.constructor.name===f.name}function Dn(d){return d!==d}const ae=(function(){const d="0123456789abcdef",f=new Array(256);for(let m=0;m<16;++m){const b=m*16;for(let O=0;O<16;++O)f[b+O]=d[m]+d[O]}return f})();function pe(d){return typeof BigInt>"u"?me:d}function me(){throw new Error("BigInt not supported")}})(qg)),qg}var yN=dN();const mN=IE(yN),Zg=mN.Buffer;var ef={},AE;function _N(){return AE||(AE=1,ef.randomBytes=crypto.randomBytes??function(t=32){return crypto.getRandomValues(new Uint8Array(t))}),ef}var AN=_N();const EN=IE(AN),WN=EN.randomBytes;var EE;(function(e){e.NATIVE_SEGWIT_P2WPKH="Native Segwit P2WPKH",e.NESTED_SEGWIT_P2SH_P2PKH="Nested Segwit P2SH_P2PKH",e.TAPROOT_P2TR="Taproot P2TR",e.LEGACY_P2PKH="Legacy P2PKH"})(EE||(EE={}));const IN=gi(async(e={})=>{if(await iN(e),e.preload&&typeof requestIdleCallback=="function"){const t=()=>new Promise(n=>requestIdleCallback(n)),r=await qt(()=>Promise.resolve().then(()=>uN),void 0);for(const[n,s]of Object.entries(r))typeof s=="function"&&n.startsWith("get")&&(await t(),await s())}});IN({wasmBaseUrl:"./wallet-util/assets"});const TN=qd(async()=>{const{createSHA256Sync:e,prepareSHA256:t}=await ag();return await t(),e}),bN=qd(async()=>{const{createMD5Sync:e,prepareMD5:t}=await ag();return await t(),e}),wN=qd(async()=>{const{createRIPEMD160Sync:e,prepareRIPEMD160:t}=await ag();return await t(),e});class SN{async sha256(t){const n=(await TN())();return Zg.from(n.update(t).digest())}async md5(t){const n=(await bN())();return Zg.from(n.update(t).digest())}async ripemd160(t){const n=(await wN())();return Zg.from(n.update(t).digest())}}const NN=new SN,ON=async e=>{const{bioforestChain:t,bioforestChainSignUtil:r}=await nN(e,NN);return{bioforestChain:t,bioforestChainSignUtil:r}},qN=Object.freeze(Object.defineProperty({__proto__:null,bioforestChainSetup:ON},Symbol.toStringTag,{value:"Module"}));export{Zg as B,WN as a,gi as b,sN as c,qN as d,dN as r};
