import{r as s,j as e,u as z,L as re}from"./iframe-Cdc63axx.js";import{c as d}from"./utils-CDN07tui.js";import{a as se,I as oe,b as ie}from"./IconTrash-B5y_mVMQ.js";import{I as le}from"./IconSparkles-CUJ4IiFn.js";import{I as ce}from"./IconSearch-C38tKWUX.js";import{f as de,h as ue,d as _,b as U,g as me,i as pe,j as fe,k as ge}from"./index-CaegeGsA.js";import{I as he}from"./IconDownload-DsZxfMH9.js";import{m as A}from"./proxy-GkmkOLXm.js";import{c as xe}from"./createReactComponent-Byz9u14m.js";import{I as be}from"./IconInfoCircle-i82YKtep.js";const ve=[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]],ye=xe("outline","player-play","PlayerPlay",ve),we={xs:{size:32,radius:7},sm:{size:40,radius:9},md:{size:48,radius:10},lg:{size:60,radius:13},xl:{size:80,radius:18},"2xl":{size:120,radius:27}},G=s.forwardRef(function({src:a,name:f="App",size:h="md",customSize:i,badge:c="none",shadow:o=!1,border:b=!0,glass:r=!1,loading:x=!1,disabled:l=!1,className:v,onClick:y},C){const[T,q]=s.useState(!1),[w,B]=s.useState(!1),R=we[h],u=i??R.size,j=i?Math.round(i*.22):R.radius,P=o===!0||o==="md"?"shadow-lg shadow-black/10 dark:shadow-black/30":o==="sm"?"shadow-md shadow-black/5 dark:shadow-black/20":o==="lg"?"shadow-xl shadow-black/15 dark:shadow-black/40":"",k=!a||T,L=Math.max(16,u*.3),m=-L*.2;return e.jsxs("div",{ref:C,className:d("relative inline-flex shrink-0",y&&"cursor-pointer",l&&"pointer-events-none opacity-50",v),style:{width:u,height:u},onClick:y,role:y?"button":void 0,tabIndex:y?0:void 0,children:[e.jsxs("div",{className:d("relative size-full overflow-hidden",b&&!r&&"ring-1 ring-black/5 dark:ring-white/10",P,r&&"bg-white/20 backdrop-blur-md",!r&&!k&&"bg-muted",k&&"from-muted to-muted/60 bg-gradient-to-br"),style:{borderRadius:j,...r?{boxShadow:`
                inset 0 1px 1px rgba(255,255,255,0.6),
                inset 0 -1px 1px rgba(0,0,0,0.1),
                0 0 0 1.5px rgba(255,255,255,0.4),
                0 4px 12px rgba(0,0,0,0.15)
              `}:{}},children:[x&&e.jsx("div",{className:"bg-muted/80 absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"border-primary animate-spin rounded-full border-2 border-t-transparent",style:{width:u*.4,height:u*.4}})}),a&&!T&&e.jsx("img",{src:a,alt:f,className:d("size-full object-cover transition-opacity duration-200",!w&&"opacity-0"),onLoad:()=>B(!0),onError:()=>q(!0),draggable:!1}),r&&e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{borderRadius:j,background:"linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.1) 40%, transparent 60%)"}}),k&&!x&&e.jsx("div",{className:"flex size-full items-center justify-center",children:e.jsx(se,{className:"text-muted-foreground/60",style:{width:u*.5,height:u*.5},stroke:1.5})})]}),c!=="none"&&e.jsx(je,{type:c,size:L,offset:m})]})});function je({type:n,size:a,offset:f}){const i={beta:{label:"β",bg:"bg-amber-500",color:"text-white"},new:{icon:le,bg:"bg-blue-500",color:"text-white"},update:{label:"!",bg:"bg-red-500",color:"text-white"}}[n];return e.jsx("div",{className:d("absolute flex items-center justify-center rounded-full","ring-background ring-2",i.bg,i.color),style:{width:a,height:a,top:f,right:f,fontSize:a*.6,fontWeight:700},children:"icon"in i?e.jsx(i.icon,{style:{width:a*.65,height:a*.65},stroke:2}):i.label})}G.__docgenInfo={description:"",methods:[],displayName:"MiniappIcon",props:{src:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:"图标 URL"},name:{required:!1,tsType:{name:"string"},description:"应用名称（用于 alt 和占位符）",defaultValue:{value:"'App'",computed:!1}},size:{required:!1,tsType:{name:"union",raw:"keyof typeof MINIAPP_ICON_SIZES",elements:[{name:"literal",value:"xs"},{name:"literal",value:"sm"},{name:"literal",value:"md"},{name:"literal",value:"lg"},{name:"literal",value:"xl"},{name:"literal",value:"'2xl'"}]},description:"图标尺寸",defaultValue:{value:"'md'",computed:!1}},customSize:{required:!1,tsType:{name:"number"},description:"自定义尺寸（覆盖 size）"},badge:{required:!1,tsType:{name:"union",raw:"'beta' | 'new' | 'update' | 'none'",elements:[{name:"literal",value:"'beta'"},{name:"literal",value:"'new'"},{name:"literal",value:"'update'"},{name:"literal",value:"'none'"}]},description:"徽章类型",defaultValue:{value:"'none'",computed:!1}},shadow:{required:!1,tsType:{name:"union",raw:"boolean | 'sm' | 'md' | 'lg'",elements:[{name:"boolean"},{name:"literal",value:"'sm'"},{name:"literal",value:"'md'"},{name:"literal",value:"'lg'"}]},description:"是否显示阴影",defaultValue:{value:"false",computed:!1}},border:{required:!1,tsType:{name:"boolean"},description:"是否显示边框",defaultValue:{value:"true",computed:!1}},glass:{required:!1,tsType:{name:"boolean"},description:"是否为玻璃态背景（用于深色/渐变背景上）",defaultValue:{value:"false",computed:!1}},loading:{required:!1,tsType:{name:"boolean"},description:"加载状态",defaultValue:{value:"false",computed:!1}},disabled:{required:!1,tsType:{name:"boolean"},description:"禁用状态",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"自定义类名"},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"点击事件"}}};const ke={sm:{icon:24,lock:14},md:{icon:32,lock:18},lg:{icon:40,lock:22}},Z=s.forwardRef(function({src:a,name:f="Source",size:h="md",className:i},c){const{icon:o,lock:b}=ke[h],r=Math.round(o*.22);return a?e.jsx("div",{ref:c,className:d("bg-muted shrink-0 overflow-hidden","ring-border/50 ring-1",i),style:{width:o,height:o,borderRadius:r},children:e.jsx("img",{src:a,alt:f,className:"size-full object-cover",draggable:!1})}):e.jsx("div",{ref:c,className:d("flex shrink-0 items-center justify-center","bg-emerald-500/10 text-emerald-600 dark:text-emerald-400","ring-1 ring-emerald-500/20",i),style:{width:o,height:o,borderRadius:r},children:e.jsx(oe,{size:b,stroke:2})})});Z.__docgenInfo={description:"",methods:[],displayName:"SourceIcon",props:{src:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:"图标 URL"},name:{required:!1,tsType:{name:"string"},description:"订阅源名称",defaultValue:{value:"'Source'",computed:!1}},size:{required:!1,tsType:{name:"union",raw:"'sm' | 'md' | 'lg'",elements:[{name:"literal",value:"'sm'"},{name:"literal",value:"'md'"},{name:"literal",value:"'lg'"}]},description:"尺寸",defaultValue:{value:"'md'",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"自定义类名"}}};function H({onClick:n,className:a}){return e.jsxs("button",{onClick:n,className:d("flex items-center justify-center gap-2","bg-muted/50 backdrop-blur-sm","h-9 w-full max-w-[200px] rounded-full","text-muted-foreground text-sm font-medium","transition-all duration-200","active:scale-95 active:bg-muted/70",a),children:[e.jsx(ce,{className:"size-4",stroke:2}),e.jsx("span",{children:"搜索"})]})}H.__docgenInfo={description:"",methods:[],displayName:"IOSSearchCapsule",props:{onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};const $e={closed:"closed",opening:"open",splash:"open",opened:"open",backgrounding:"open",backgrounded:"closed",foregrounding:"open",closing:"open"},Fe={closed:"gone",opening:"top",splash:"top",opened:"bottom",backgrounding:"bottom",backgrounded:"gone",foregrounding:"bottom",closing:"bottom"},Ue={closed:"gone",opening:"bottom",splash:"bottom",opened:"top",backgrounding:"top",backgrounded:"gone",foregrounding:"top",closing:"top"},Ge={closed:"gone",opening:"top",splash:"top",opened:"gone",backgrounding:"gone",backgrounded:"gone",foregrounding:"gone",closing:"top"},Ze={closed:"hide",opening:"show",splash:"show",opened:"show",backgrounding:"show",backgrounded:"hide",foregrounding:"show",closing:"show"},Ie={closed:"show",opening:"hide",splash:"hide",opened:"hide",backgrounding:"hide",backgrounded:"show",foregrounding:"hide",closing:"hide"},He={closed:!1,opening:!0,splash:!1,opened:!1,backgrounding:!1,backgrounded:!1,foregrounding:!1,closing:!0};function Ne(n){return!n||n==="preparing"?"closed":n==="launching"?"opening":n==="splash"?"splash":n==="active"?"opened":n==="background"?"backgrounded":"closing"}const Se="_iconWrapper_1j22y_7",Te="_iconPopover_1j22y_12",Re="_iconButton_1j22y_56",Me="_backdropClickArea_1j22y_78",ze="_contextMenu_1j22y_83",S={iconWrapper:Se,iconPopover:Te,iconButton:Re,backdropClickArea:Me,contextMenu:ze};function _e({app:n,onTap:a,onOpen:f,onDetail:h,onRemove:i}){const c=s.useRef(null),o=s.useRef(null),b=s.useRef(null),r=s.useRef(null),x=s.useRef(!1),[l,v]=s.useState(!1),[y,C]=s.useState({top:0,left:0}),T=z(_,t=>t.apps.get(n.id)?.state??null),q=z(_,U.getVisualConfig),w=me(q),R=z(_,U.getFocusedAppId)===n.id,u=z(_,t=>t.presentations.get(n.id)?.state??null),j=Ne(T),P=R&&(j==="opening"||j==="splash")?"elevated":"normal",k=Ie[j],m=u===null||u==="presenting"||u==="dismissing"?{container:`miniapp:${n.id}:container`,logo:`miniapp:${n.id}:logo`,inner:`miniapp:${n.id}:inner`}:null,K={normal:{zIndex:0,pointerEvents:"auto"},elevated:{zIndex:50,pointerEvents:"none"}},J={show:{opacity:1,scale:1},hide:{opacity:0,scale:.6}};s.useEffect(()=>(c.current&&pe(n.id,c.current),o.current&&fe(n.id,o.current),()=>{ge(n.id)}),[n.id]);const E=s.useRef(null),I=s.useRef(null),M=s.useRef(null),D=()=>{const t=c.current,g=o.current;if(!t||!g)return;const p=t.getBoundingClientRect(),V=224,ae=180,$=16;let O=p.top-ae-$,N=p.left+p.width/2-V/2;N<16&&(N=16),N+V>window.innerWidth-16&&(N=window.innerWidth-V-16),O<16&&(O=p.bottom+$),C({top:O,left:N}),E.current=t.animate([{position:"fixed",top:`${p.top}px`,left:`${p.left}px`,margin:"0",inset:"auto",zIndex:"50"}],{duration:0,fill:"forwards"}),I.current=g.animate([{transform:"scale(1) translateY(0)",filter:"drop-shadow(0 0 0 transparent)"},{transform:"scale(1.08) translateY(-4px)",filter:"drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3))"}],{duration:200,easing:"cubic-bezier(0.34, 1.56, 0.64, 1)",fill:"forwards"}),t.showPopover(),v(!0),requestAnimationFrame(()=>{const F=b.current;F&&(M.current=F.animate([{opacity:0,transform:"scale(0.85) translateY(8px)"},{opacity:1,transform:"scale(1) translateY(0)"}],{duration:250,easing:"cubic-bezier(0.34, 1.56, 0.64, 1)",fill:"forwards"}))})},W=()=>{const t=c.current,g=o.current,p=b.current;t&&(g&&(I.current?.cancel(),I.current=g.animate([{transform:"scale(1.08) translateY(-4px)",filter:"drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3))"},{transform:"scale(1) translateY(0)",filter:"drop-shadow(0 0 0 transparent)"}],{duration:150,easing:"ease-out",fill:"forwards"})),p&&(M.current=p.animate([{opacity:1,transform:"scale(1) translateY(0)"},{opacity:0,transform:"scale(0.9) translateY(4px)"}],{duration:150,easing:"ease-out",fill:"forwards"})),setTimeout(()=>{t.hidePopover(),v(!1),E.current?.cancel(),I.current?.cancel(),M.current?.cancel(),E.current=null,I.current=null,M.current=null},150))};s.useEffect(()=>{const t=c.current;if(!t)return;const g=p=>{v(p.newState==="open")};return t.addEventListener("toggle",g),()=>t.removeEventListener("toggle",g)},[]);const Q=()=>{x.current=!1,r.current=setTimeout(()=>{x.current=!0,D()},500)},X=()=>{r.current&&(clearTimeout(r.current),r.current=null)},ee=t=>{r.current&&(clearTimeout(r.current),r.current=null),x.current||(t.preventDefault(),a())},ne=t=>{t.preventDefault(),D()},te=t=>{W(),t()},Y=[{icon:ye,label:"打开",action:f},{icon:be,label:"详情",action:h},{icon:ie,label:"移除",action:i,destructive:!0}];return e.jsxs("div",{className:d(S.iconWrapper,"flex flex-col items-center gap-1.5 p-2"),children:[e.jsxs("div",{ref:c,popover:"manual",className:S.iconPopover,children:[l&&e.jsx("div",{className:d("fixed inset-0",S.backdropClickArea),style:{zIndex:-1},onClick:W}),e.jsx("button",{className:d(S.iconButton,"touch-manipulation select-none","transition-all duration-200 ease-out","active:scale-95"),onClick:a,onTouchStart:Q,onTouchMove:X,onTouchEnd:ee,onContextMenu:ne,"data-testid":`ios-app-icon-${n.id}`,children:e.jsx(re,{inherit:"id",children:e.jsxs(A.div,{...m?{layoutId:m.container,"data-layoutid":m.container}:{},transition:w.sharedLayout,variants:K,initial:!1,animate:P,className:"relative",style:{width:68,height:68,borderRadius:16},children:[e.jsx(A.div,{...m?{layoutId:m.inner,"data-layoutid":m.inner}:{},transition:w.sharedLayout,className:"absolute inset-0 flex items-center justify-center"}),e.jsx(A.div,{ref:o,...m?{layoutId:m.logo,"data-layoutid":m.logo}:{},transition:w.sharedLayout,className:"absolute inset-0 flex size-15 items-center justify-center",children:e.jsx(G,{src:n.icon,name:n.name,size:"lg",shadow:!0})}),e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(A.div,{variants:J,initial:!1,animate:k,transition:w.uiFast,style:{transformOrigin:"100% 0%"},children:e.jsx(Z,{src:n.sourceIcon,name:n.sourceName,size:"sm"})})})]})})}),l&&e.jsx("div",{ref:b,className:d(S.contextMenu,"fixed w-56"),style:{top:y.top,left:y.left},"data-testid":`context-menu-${n.id}`,children:e.jsxs("div",{className:"bg-popover/95 overflow-hidden rounded-2xl border border-white/10 shadow-2xl shadow-black/40 backdrop-blur-xl",children:[e.jsxs("div",{className:"border-b border-white/10 px-4 py-3",children:[e.jsx("h3",{className:"truncate text-sm font-semibold",children:n.name}),e.jsx("p",{className:"text-muted-foreground mt-0.5 truncate text-xs",children:n.description})]}),e.jsx("div",{className:"py-1",children:Y.map((t,g)=>e.jsxs("button",{onClick:()=>te(t.action),className:d("flex w-full items-center gap-3 px-4 py-2.5","text-sm font-medium","transition-colors duration-100","active:bg-white/10",t.destructive?"text-red-500 dark:text-red-400":"text-foreground",g===Y.length-1&&"mt-1 border-t border-white/10 pt-2.5"),children:[e.jsx(t.icon,{className:"size-5",stroke:1.5}),e.jsx("span",{children:t.label})]},t.label))})]})})]}),e.jsx("span",{className:"text-foreground/90 line-clamp-2 max-w-[72px] text-center text-[11px] leading-tight font-medium",children:n.name})]})}function Ae(){return e.jsxs("div",{className:"flex flex-col items-center justify-center px-5 py-20 text-center",children:[e.jsx("div",{className:"bg-muted/50 mb-4 flex size-20 items-center justify-center rounded-full",children:e.jsx(he,{className:"text-muted-foreground size-10",stroke:1.5})}),e.jsx("h2",{className:"mb-1 text-lg font-semibold",children:"还没有使用过的应用"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"去「发现」页面探索吧"})]})}function Ce({apps:n,showSearch:a=!0,onSearchClick:f,onAppOpen:h,onAppDetail:i,onAppRemove:c}){const r=Math.ceil(n.length/24),x=s.useRef(null);return s.useEffect(()=>{const l=x.current;if(l)return de("mine",l),()=>ue("mine")},[]),e.jsx("div",{ref:x,className:"my-apps-page h-full",children:e.jsxs("div",{className:"relative z-10 h-full overflow-y-auto",children:[a?e.jsx("div",{className:"flex justify-center px-5 pt-14 pb-6",children:e.jsx(H,{onClick:f})}):e.jsx("div",{className:"pt-14"}),n.length===0?e.jsx(Ae,{}):e.jsxs("div",{className:"px-4 pb-8",children:[e.jsx("div",{className:"grid justify-items-center gap-y-4",style:{gridTemplateColumns:"repeat(4, minmax(0, 1fr))"},children:n.map(({app:l})=>e.jsx(_e,{app:l,onTap:()=>h(l),onOpen:()=>h(l),onDetail:()=>i(l),onRemove:()=>c(l.id)},l.id))}),r>1&&e.jsx("div",{className:"mt-6 flex justify-center gap-1.5",children:Array.from({length:r}).map((l,v)=>e.jsx("div",{className:d("size-2 rounded-full transition-colors",v===0?"bg-foreground/80":"bg-foreground/20")},v))})]}),e.jsx("div",{className:"h-[var(--tab-bar-height)]"})]})})}Ce.__docgenInfo={description:"",methods:[],displayName:"MyAppsPage",props:{apps:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ app: MiniappManifest; lastUsed: number }",signature:{properties:[{key:"app",value:{name:"MiniappManifest",required:!0}},{key:"lastUsed",value:{name:"number",required:!0}}]}}],raw:"Array<{ app: MiniappManifest; lastUsed: number }>"},description:""},showSearch:{required:!1,tsType:{name:"boolean"},description:"是否显示搜索框（默认 true，关闭发现页时应设为 false）",defaultValue:{value:"true",computed:!1}},onSearchClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onAppOpen:{required:!0,tsType:{name:"signature",type:"function",raw:"(app: MiniappManifest) => void",signature:{arguments:[{type:{name:"MiniappManifest"},name:"app"}],return:{name:"void"}}},description:""},onAppDetail:{required:!0,tsType:{name:"signature",type:"function",raw:"(app: MiniappManifest) => void",signature:{arguments:[{type:{name:"MiniappManifest"},name:"app"}],return:{name:"void"}}},description:""},onAppRemove:{required:!0,tsType:{name:"signature",type:"function",raw:"(appId: string) => void",signature:{arguments:[{type:{name:"string"},name:"appId"}],return:{name:"void"}}},description:""}}};export{Ce as M,G as a,Fe as b,Ue as c,Ge as d,Ze as e,$e as f,He as g};
