import{r as s,j as e,u as z,L as ie}from"./iframe-BUkuBLc8.js";import{c}from"./utils-4perknFd.js";import{i as le}from"./config-HmZ3kn8E.js";import"./window-stack-BtL-ozcQ.js";import{I as ce}from"./IconApps-Cse4dmTc.js";import{I as de}from"./IconSparkles-DOv04vHs.js";import{I as ue}from"./IconLock-CcHMnMtU.js";import{u as B}from"./useTranslation-CTIURYhP.js";import{I as me}from"./IconSearch-CuKO4L7A.js";import{i as pe,j as fe,d as q,b as Z,g as ge,k as he,n as be,p as xe}from"./index-C_tS4OCq.js";import{I as ve}from"./IconDownload-BhQPpB8f.js";import{c as H}from"./createReactComponent-Dw1Y0MQa.js";import{I as ye}from"./IconTrash-Cbn749Sn.js";import{m as C}from"./proxy-441tBhi0.js";const we=[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]],je=H("outline","info-circle","InfoCircle",we);const ke=[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]],Ie=H("outline","player-play","PlayerPlay",ke),Ne={xs:{size:32,radius:7},sm:{size:40,radius:9},md:{size:48,radius:10},lg:{size:60,radius:13},xl:{size:80,radius:18},"2xl":{size:120,radius:27}},K=s.forwardRef(function({src:o,name:m="App",size:h="md",customSize:i,badge:p="none",shadow:a=!1,border:f=!0,glass:l=!1,loading:d=!1,disabled:r=!1,className:v,onClick:y},M){const[R,P]=s.useState(!1),[L,w]=s.useState(!1),E=Ne[h],b=i??E.size,j=i?Math.round(i*.22):E.radius,I=a===!0||a==="md"?"shadow-lg shadow-black/10 dark:shadow-black/30":a==="sm"?"shadow-md shadow-black/5 dark:shadow-black/20":a==="lg"?"shadow-xl shadow-black/15 dark:shadow-black/40":"",N=!o||R,_=Math.max(16,b*.3),D=-_*.2;return e.jsxs("div",{ref:M,className:c("relative inline-flex shrink-0",y&&"cursor-pointer",r&&"pointer-events-none opacity-50",v),style:{width:b,height:b},onClick:y,role:y?"button":void 0,tabIndex:y?0:void 0,children:[e.jsxs("div",{className:c("relative size-full overflow-hidden",f&&!l&&"ring-1 ring-black/5 dark:ring-white/10",I,l&&"bg-white/20 backdrop-blur-md",!l&&!N&&"bg-muted",N&&"from-muted to-muted/60 bg-gradient-to-br"),style:{borderRadius:j,...l?{boxShadow:`
                inset 0 1px 1px rgba(255,255,255,0.6),
                inset 0 -1px 1px rgba(0,0,0,0.1),
                0 0 0 1.5px rgba(255,255,255,0.4),
                0 4px 12px rgba(0,0,0,0.15)
              `}:{}},children:[d&&e.jsx("div",{className:"bg-muted/80 absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"border-primary animate-spin rounded-full border-2 border-t-transparent",style:{width:b*.4,height:b*.4}})}),o&&!R&&e.jsx("img",{src:o,alt:m,className:c("size-full object-cover transition-opacity duration-200",!L&&"opacity-0"),onLoad:()=>w(!0),onError:()=>P(!0),draggable:!1}),l&&e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{borderRadius:j,background:"linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.1) 40%, transparent 60%)"}}),N&&!d&&e.jsx("div",{className:"flex size-full items-center justify-center",children:e.jsx(ce,{className:"text-muted-foreground/60",style:{width:b*.5,height:b*.5},stroke:1.5})})]}),p!=="none"&&e.jsx(Te,{type:p,size:_,offset:D})]})});function Te({type:t,size:o,offset:m}){const i={beta:{label:"β",bg:"bg-amber-500",color:"text-white"},new:{icon:de,bg:"bg-blue-500",color:"text-white"},update:{label:"!",bg:"bg-red-500",color:"text-white"}}[t];return e.jsx("div",{className:c("absolute flex items-center justify-center rounded-full","ring-background ring-2",i.bg,i.color),style:{width:o,height:o,top:m,right:m,fontSize:o*.6,fontWeight:700},children:"icon"in i?e.jsx(i.icon,{style:{width:o*.65,height:o*.65},stroke:2}):i.label})}K.__docgenInfo={description:"",methods:[],displayName:"MiniappIcon",props:{src:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:"图标 URL"},name:{required:!1,tsType:{name:"string"},description:"应用名称（用于 alt 和占位符）",defaultValue:{value:"'App'",computed:!1}},size:{required:!1,tsType:{name:"union",raw:"keyof typeof MINIAPP_ICON_SIZES",elements:[{name:"literal",value:"xs"},{name:"literal",value:"sm"},{name:"literal",value:"md"},{name:"literal",value:"lg"},{name:"literal",value:"xl"},{name:"literal",value:"'2xl'"}]},description:"图标尺寸",defaultValue:{value:"'md'",computed:!1}},customSize:{required:!1,tsType:{name:"number"},description:"自定义尺寸（覆盖 size）"},badge:{required:!1,tsType:{name:"union",raw:"'beta' | 'new' | 'update' | 'none'",elements:[{name:"literal",value:"'beta'"},{name:"literal",value:"'new'"},{name:"literal",value:"'update'"},{name:"literal",value:"'none'"}]},description:"徽章类型",defaultValue:{value:"'none'",computed:!1}},shadow:{required:!1,tsType:{name:"union",raw:"boolean | 'sm' | 'md' | 'lg'",elements:[{name:"boolean"},{name:"literal",value:"'sm'"},{name:"literal",value:"'md'"},{name:"literal",value:"'lg'"}]},description:"是否显示阴影",defaultValue:{value:"false",computed:!1}},border:{required:!1,tsType:{name:"boolean"},description:"是否显示边框",defaultValue:{value:"true",computed:!1}},glass:{required:!1,tsType:{name:"boolean"},description:"是否为玻璃态背景（用于深色/渐变背景上）",defaultValue:{value:"false",computed:!1}},loading:{required:!1,tsType:{name:"boolean"},description:"加载状态",defaultValue:{value:"false",computed:!1}},disabled:{required:!1,tsType:{name:"boolean"},description:"禁用状态",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"自定义类名"},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"点击事件"}}};const Se={sm:{icon:16,lock:14},md:{icon:24,lock:18},lg:{icon:32,lock:22}},J=s.forwardRef(function({src:o,name:m="Source",size:h="md",className:i},p){const{icon:a,lock:f}=Se[h],l=Math.round(a*.22);return o?e.jsx("div",{ref:p,className:c("bg-muted shrink-0 overflow-hidden","ring-border/50 ring-1",i),style:{width:a,height:a,borderRadius:l},children:e.jsx("img",{src:o,alt:m,className:"size-full object-cover",draggable:!1})}):e.jsx("div",{ref:p,className:c("flex shrink-0 items-center justify-center","bg-emerald-500/10 text-emerald-600 dark:text-emerald-400","ring-1 ring-emerald-500/20",i),style:{width:a,height:a,borderRadius:l},children:e.jsx(ue,{size:f,stroke:2})})});J.__docgenInfo={description:"",methods:[],displayName:"SourceIcon",props:{src:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:"图标 URL"},name:{required:!1,tsType:{name:"string"},description:"订阅源名称",defaultValue:{value:"'Source'",computed:!1}},size:{required:!1,tsType:{name:"union",raw:"'sm' | 'md' | 'lg'",elements:[{name:"literal",value:"'sm'"},{name:"literal",value:"'md'"},{name:"literal",value:"'lg'"}]},description:"尺寸",defaultValue:{value:"'md'",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"自定义类名"}}};function Q({onClick:t,className:o}){const{t:m}=B("common");return e.jsxs("button",{onClick:t,className:c("flex items-center justify-center gap-2","bg-muted/50 backdrop-blur-sm","h-9 w-full max-w-[200px] rounded-full","text-muted-foreground text-sm font-medium","transition-all duration-200","active:scale-95 active:bg-muted/70",o),children:[e.jsx(me,{className:"size-4",stroke:2}),e.jsx("span",{children:m("search")})]})}Q.__docgenInfo={description:"",methods:[],displayName:"IOSSearchCapsule",props:{onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};const Xe={closed:"closed",opening:"open",splash:"open",opened:"open",backgrounding:"open",backgrounded:"closed",foregrounding:"open",closing:"open"},et={closed:"bottom",opening:"top",splash:"top",opened:"bottom",backgrounding:"bottom",backgrounded:"bottom",foregrounding:"bottom",closing:"bottom"},tt={closed:"bottom",opening:"bottom",splash:"bottom",opened:"top",backgrounding:"top",backgrounded:"bottom",foregrounding:"top",closing:"top"},nt={closed:"bottom",opening:"top",splash:"top",opened:"bottom",backgrounding:"bottom",backgrounded:"bottom",foregrounding:"bottom",closing:"top"},ot={closed:"hide",opening:"show",splash:"show",opened:"show",backgrounding:"show",backgrounded:"hide",foregrounding:"show",closing:"show"},Me={closed:"show",opening:"hide",splash:"hide",opened:"hide",backgrounding:"hide",backgrounded:"show",foregrounding:"hide",closing:"hide"},at={closed:!1,opening:!0,splash:!1,opened:!1,backgrounding:!1,backgrounded:!1,foregrounding:!1,closing:!0};function Re(t){return!t||t==="preparing"?"closed":t==="launching"?"opening":t==="splash"?"splash":t==="active"?"opened":t==="background"?"backgrounded":"closing"}const _e="_iconWrapper_he0dq_7",Ae="_iconPopover_he0dq_12",ze="_iconButton_he0dq_56",qe="_backdropClickArea_he0dq_78",Ce="_contextMenu_he0dq_83",Pe="_betaAppName_he0dq_108",k={iconWrapper:_e,iconPopover:Ae,iconButton:ze,backdropClickArea:qe,contextMenu:Ce,betaAppName:Pe};function Le({app:t,onTap:o,onOpen:m,onDetail:h,onRemove:i}){const{t:p}=B("common"),a=s.useRef(null),f=s.useRef(null),l=s.useRef(null),d=s.useRef(null),r=s.useRef(!1),[v,y]=s.useState(!1),[M,R]=s.useState({top:0,left:0}),P=z(q,n=>n.apps.get(t.id)?.state??null),L=z(q,Z.getVisualConfig),w=ge(L),b=z(q,Z.getFocusedAppId)===t.id,j=z(q,n=>n.presentations.get(t.id)?.state??null),I=Re(P),N=b&&(I==="opening"||I==="splash")?"elevated":"normal",_=Me[I],x=(j===null||j==="presenting"||j==="dismissing")&&le("sharedLayout")?{container:`miniapp:${t.id}:container`,logo:`miniapp:${t.id}:logo`,inner:`miniapp:${t.id}:inner`}:null,X={normal:{zIndex:0,pointerEvents:"auto"},elevated:{zIndex:50,pointerEvents:"none"}},ee={show:{opacity:1,scale:1},hide:{opacity:0,scale:.6}};s.useEffect(()=>(a.current&&he(t.id,a.current),f.current&&be(t.id,f.current),()=>{xe(t.id)}),[t.id]);const V=s.useRef(null),T=s.useRef(null),A=s.useRef(null),W=()=>{const n=a.current,g=f.current;if(!n||!g)return;const u=n.getBoundingClientRect(),O=224,re=180,U=16;let $=u.top-re-U,S=u.left+u.width/2-O/2;S<16&&(S=16),S+O>window.innerWidth-16&&(S=window.innerWidth-O-16),$<16&&($=u.bottom+U),R({top:$,left:S}),n.style.setProperty("--popover-top",`${u.top}px`),n.style.setProperty("--popover-left",`${u.left}px`),V.current=n.animate([{position:"fixed",top:`${u.top}px`,left:`${u.left}px`,margin:"0",inset:"auto",zIndex:"50"}],{duration:0,fill:"forwards"}),T.current=g.animate([{transform:"scale(1) translateY(0)",filter:"drop-shadow(0 0 0 transparent)"},{transform:"scale(1.08) translateY(-4px)",filter:"drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3))"}],{duration:200,easing:"cubic-bezier(0.34, 1.56, 0.64, 1)",fill:"forwards"}),n.showPopover(),y(!0),requestAnimationFrame(()=>{const G=l.current;G&&(A.current=G.animate([{opacity:0,transform:"scale(0.85) translateY(8px)"},{opacity:1,transform:"scale(1) translateY(0)"}],{duration:250,easing:"cubic-bezier(0.34, 1.56, 0.64, 1)",fill:"forwards"}))})},Y=()=>{const n=a.current,g=f.current,u=l.current;n&&(g&&(T.current?.cancel(),T.current=g.animate([{transform:"scale(1.08) translateY(-4px)",filter:"drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3))"},{transform:"scale(1) translateY(0)",filter:"drop-shadow(0 0 0 transparent)"}],{duration:150,easing:"ease-out",fill:"forwards"})),u&&(A.current=u.animate([{opacity:1,transform:"scale(1) translateY(0)"},{opacity:0,transform:"scale(0.9) translateY(4px)"}],{duration:150,easing:"ease-out",fill:"forwards"})),setTimeout(()=>{n.hidePopover(),y(!1),V.current?.cancel(),T.current?.cancel(),A.current?.cancel(),V.current=null,T.current=null,A.current=null},150))};s.useEffect(()=>{const n=a.current;if(!n)return;const g=u=>{y(u.newState==="open")};return n.addEventListener("toggle",g),()=>n.removeEventListener("toggle",g)},[]);const te=()=>{r.current=!1,d.current=setTimeout(()=>{r.current=!0,W()},500)},ne=()=>{d.current&&(clearTimeout(d.current),d.current=null)},oe=n=>{d.current&&(clearTimeout(d.current),d.current=null),r.current||(n.preventDefault(),o())},ae=n=>{n.preventDefault(),!(v||r.current)&&W()},se=n=>{Y(),n()},F=[{icon:Ie,label:p("ecosystem.menu.open"),action:m},{icon:je,label:p("ecosystem.menu.detail"),action:h},{icon:ye,label:p("ecosystem.menu.remove"),action:i,destructive:!0}];return e.jsxs("div",{className:c(k.iconWrapper,"flex flex-col items-center gap-1.5 p-2"),children:[e.jsxs("div",{ref:a,popover:"manual",className:k.iconPopover,children:[v&&e.jsx("div",{className:c("fixed inset-0",k.backdropClickArea),style:{zIndex:-1},onClick:Y}),e.jsx("button",{className:c(k.iconButton,"touch-manipulation select-none","transition-all duration-200 ease-out","active:scale-95"),onClick:o,onTouchStart:te,onTouchMove:ne,onTouchEnd:oe,onContextMenu:ae,"data-testid":`ios-app-icon-${t.id}`,children:e.jsx(ie,{inherit:"id",children:e.jsxs(C.div,{...x?{layoutId:x.container,"data-layoutid":x.container}:{},transition:w.sharedLayout,variants:X,initial:!1,animate:N,className:"relative",style:{width:68,height:68,borderRadius:16},children:[e.jsx(C.div,{...x?{layoutId:x.inner,"data-layoutid":x.inner}:{},transition:w.sharedLayout,className:"absolute inset-0 flex items-center justify-center"}),e.jsx(C.div,{ref:f,...x?{layoutId:x.logo,"data-layoutid":x.logo}:{},transition:w.sharedLayout,className:"absolute inset-0 m-auto flex size-15 items-center justify-center",children:e.jsx(K,{src:t.icon,name:t.name,size:"lg",shadow:!0})}),e.jsx("div",{className:"absolute -top-0 -right-0",children:e.jsx(C.div,{variants:ee,initial:!1,animate:_,transition:w.uiFast,style:{transformOrigin:"100% 0%"},children:e.jsx(J,{src:t.sourceIcon,name:t.sourceName,size:"sm"})})})]})})}),v&&e.jsx("div",{ref:l,className:c(k.contextMenu,"fixed w-56"),style:{top:M.top,left:M.left},"data-testid":`context-menu-${t.id}`,children:e.jsxs("div",{className:"bg-popover/95 overflow-hidden rounded-2xl border border-white/10 shadow-2xl shadow-black/40 backdrop-blur-xl",children:[e.jsxs("div",{className:"border-b border-white/10 px-4 py-3",children:[e.jsx("h3",{className:"truncate text-sm font-semibold",children:t.name}),e.jsx("p",{className:"text-muted-foreground mt-0.5 truncate text-xs",children:t.description})]}),e.jsx("div",{className:"py-1",children:F.map((n,g)=>e.jsxs("button",{onClick:()=>se(n.action),className:c("flex w-full items-center gap-3 px-4 py-2.5","text-sm font-medium","transition-colors duration-100","active:bg-white/10",n.destructive?"text-red-500 dark:text-red-400":"text-foreground",g===F.length-1&&"mt-1 border-t border-white/10 pt-2.5"),children:[e.jsx(n.icon,{className:"size-5",stroke:1.5}),e.jsx("span",{children:n.label})]},n.label))})]})})]}),e.jsx("span",{className:c(t.beta?k.betaAppName:"text-foreground/90","line-clamp-2 max-w-[72px] text-center text-[11px] leading-tight font-medium"),children:t.name})]})}function Ee(){const{t}=B("common");return e.jsxs("div",{className:"flex flex-col items-center justify-center px-5 py-20 text-center",children:[e.jsx("div",{className:"bg-muted/50 mb-4 flex size-20 items-center justify-center rounded-full",children:e.jsx(ve,{className:"text-muted-foreground size-10",stroke:1.5})}),e.jsx("h2",{className:"mb-1 text-lg font-semibold",children:t("ecosystem.noAppsUsed")}),e.jsx("p",{className:"text-muted-foreground text-sm",children:t("ecosystem.goToDiscover")})]})}function Ve({apps:t,showSearch:o=!0,onSearchClick:m,onAppOpen:h,onAppDetail:i,onAppRemove:p}){const l=Math.ceil(t.length/24),d=s.useRef(null);return s.useEffect(()=>{const r=d.current;if(r)return pe("mine",r),()=>fe("mine")},[]),e.jsx("div",{ref:d,className:"my-apps-page h-full",children:e.jsxs("div",{className:"relative z-10 h-full overflow-y-auto",children:[o?e.jsx("div",{className:"flex justify-center px-5 pt-14 pb-6",children:e.jsx(Q,{onClick:m})}):e.jsx("div",{className:"pt-14"}),t.length===0?e.jsx(Ee,{}):e.jsxs("div",{className:"px-4 pb-8",children:[e.jsx("div",{className:"grid justify-items-center gap-y-4",style:{gridTemplateColumns:"repeat(4, minmax(0, 1fr))"},children:t.map(({app:r})=>e.jsx(Le,{app:r,onTap:()=>h(r),onOpen:()=>h(r),onDetail:()=>i(r),onRemove:()=>p(r.id)},r.id))}),l>1&&e.jsx("div",{className:"mt-6 flex justify-center gap-1.5",children:Array.from({length:l}).map((r,v)=>e.jsx("div",{className:c("size-2 rounded-full transition-colors",v===0?"bg-foreground/80":"bg-foreground/20")},v))})]}),e.jsx("div",{className:"h-[var(--tab-bar-height)]"})]})})}Ve.__docgenInfo={description:"",methods:[],displayName:"MyAppsPage",props:{apps:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ app: MiniappManifest; lastUsed: number }",signature:{properties:[{key:"app",value:{name:"MiniappManifest",required:!0}},{key:"lastUsed",value:{name:"number",required:!0}}]}}],raw:"Array<{ app: MiniappManifest; lastUsed: number }>"},description:""},showSearch:{required:!1,tsType:{name:"boolean"},description:"是否显示搜索框（默认 true，关闭发现页时应设为 false）",defaultValue:{value:"true",computed:!1}},onSearchClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onAppOpen:{required:!0,tsType:{name:"signature",type:"function",raw:"(app: MiniappManifest) => void",signature:{arguments:[{type:{name:"MiniappManifest"},name:"app"}],return:{name:"void"}}},description:""},onAppDetail:{required:!0,tsType:{name:"signature",type:"function",raw:"(app: MiniappManifest) => void",signature:{arguments:[{type:{name:"MiniappManifest"},name:"app"}],return:{name:"void"}}},description:""},onAppRemove:{required:!0,tsType:{name:"signature",type:"function",raw:"(appId: string) => void",signature:{arguments:[{type:{name:"string"},name:"appId"}],return:{name:"void"}}},description:""}}};export{je as I,Ve as M,K as a,et as b,tt as c,nt as d,ot as e,Xe as f,at as g};
