const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./jsQR-BwVyjlWT.js","./iframe-Cdc63axx.js","./preload-helper-PPVm8Dsz.js","./iframe-D2OUpJUL.css"])))=>i.map(i=>d[i]);
import{_ as h}from"./preload-helper-PPVm8Dsz.js";const d={scanInterval:100,useWorker:!0,workerCount:1};let c=0;class l{worker=null;config;pendingRequests=new Map;batchPendingRequests=new Map;_ready=!1;readyPromise;readyResolve=null;constructor(e={}){this.config={...d,...e},this.readyPromise=new Promise(t=>{this.readyResolve=t}),this.config.useWorker&&typeof Worker<"u"?this.initWorker():(this._ready=!0,this.readyResolve?.())}initWorker(){this.worker=new Worker(new URL(""+new URL("worker-DaHVRnkv.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const t=e.data;switch(t.type){case"ready":this._ready=!0,this.readyResolve?.();break;case"result":{const r=this.pendingRequests.get(t.id);r&&(this.pendingRequests.delete(t.id),t.error?r.reject(new Error(t.error)):r.resolve(t.result));break}case"batchResult":{const r=this.batchPendingRequests.get(t.id);r&&(this.batchPendingRequests.delete(t.id),t.error?r.reject(new Error(t.error)):r.resolve(t.results));break}}},this.worker.onerror=e=>{console.error("[QRScanner] Worker error:",e),this.worker?.terminate(),this.worker=null,this._ready=!0,this.readyResolve?.()}}get isReady(){return this._ready}async waitReady(){return this.readyPromise}async scan(e){return await this.readyPromise,this.worker?this.scanWithWorker(e):this.scanMainThread(e)}scanWithWorker(e){return new Promise((t,r)=>{const s=++c;this.pendingRequests.set(s,{resolve:t,reject:r});const n={type:"scan",id:s,imageData:e};this.worker.postMessage(n,[e.data.buffer])})}async scanMainThread(e){const{default:t}=await h(async()=>{const{default:n}=await import("./jsQR-BwVyjlWT.js").then(o=>o.j);return{default:n}},__vite__mapDeps([0,1,2,3]),import.meta.url),r=performance.now(),s=t(e.data,e.width,e.height,{inversionAttempts:"dontInvert"});return s?{content:s.data,duration:performance.now()-r,location:{topLeftCorner:s.location.topLeftCorner,topRightCorner:s.location.topRightCorner,bottomLeftCorner:s.location.bottomLeftCorner,bottomRightCorner:s.location.bottomRightCorner}}:null}async scanBatch(e){return await this.readyPromise,this.worker&&e.length>0?this.scanBatchWithWorker(e):Promise.all(e.map(t=>this.scanMainThread(t)))}scanBatchWithWorker(e){return new Promise((t,r)=>{const s=++c;this.batchPendingRequests.set(s,{resolve:t,reject:r});const n={type:"scanBatch",id:s,frames:e},o=e.map(i=>i.data.buffer);this.worker.postMessage(n,o)})}async scanFromVideo(e,t){const r=e.videoWidth,s=e.videoHeight;if(r===0||s===0)return null;const n=t??document.createElement("canvas");n.width=r,n.height=s;const o=n.getContext("2d",{willReadFrequently:!0});if(!o)return null;o.drawImage(e,0,0,r,s);const i=o.getImageData(0,0,r,s);return this.scan(i)}async scanFromCanvas(e){const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return null;const r=t.getImageData(0,0,e.width,e.height);return this.scan(r)}destroy(){if(this.worker){const e={type:"terminate"};this.worker.postMessage(e),this.worker.terminate(),this.worker=null}this.pendingRequests.clear(),this.batchPendingRequests.clear()}}function w(a){return new l(a)}export{w as c};
