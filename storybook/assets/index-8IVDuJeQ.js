import{g as m,b as w,e as c,f as d,B as y,h as C,j as b}from"./index-BVzIq5_8.js";import{k as $,c as x,a as N}from"./index-BVzIq5_8.js";import"./chain-config-DW44byg9.js";import{A as h}from"./amount-BQsqQYGO.js";import"./index-D0E7N0oa.js";import"./schemas-BX8BzOgD.js";import"./bioforest-D91I-84E.js";import"./preload-helper-PPVm8Dsz.js";import"./iframe-g2b0m8DI.js";import"./address-format-Bt4Tl7ZW.js";async function j(l){const{mnemonic:e,chainConfigs:t,selectedChainIds:n,accountIndex:s=0}=l,o=new Map(t.map(i=>[i.id,i])),a=new TextEncoder().encode(e),r=[];for(const i of n){const f=o.get(i);if(!f){console.warn(`[deriveWalletChainAddresses] Chain config not found: ${i}`);continue}const u=m(i);if(!u.supportsDeriveAddress)throw new Error(`Chain "${i}" (${f.chainKind}) does not support address derivation`);const g=u.deriveAddress;if(!g)throw new Error(`Chain "${i}" deriveAddress method not available`);const p=await g(a,s);r.push({chainId:i,address:p})}return r}class v{chainId;config=null;baseUrl="";constructor(e){this.chainId=e}getConfig(){if(!this.config){const e=w.getConfig(this.chainId);if(!e)throw new c(d.CHAIN_NOT_FOUND,`Chain config not found: ${this.chainId}`);this.config=e,this.baseUrl=w.getBiowalletApi(e.id)??""}return this.config}getChainInfo(){const e=this.getConfig(),t={chainId:e.id,name:e.name,symbol:e.symbol,decimals:e.decimals,blockTime:10,confirmations:1};return e.explorer?.url&&(t.explorerUrl=e.explorer.url),t}async getBlockHeight(){if(this.getConfig(),!this.baseUrl)return 0n;try{const e=await fetch(`${this.baseUrl}/lastblock`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new c(d.NETWORK_ERROR,`Failed to fetch block height: ${e.status}`);const t=await e.json();if(!t.success)throw new c(d.NETWORK_ERROR,"API returned success=false");return BigInt(t.result.height)}catch(e){throw e instanceof c?e:new c(d.NETWORK_ERROR,"Failed to fetch block height",void 0,e instanceof Error?e:void 0)}}async getGasPrice(){const e=this.getConfig(),{decimals:t,symbol:n}=e;if(!this.baseUrl){const s=h.fromRaw("1000",t,n);return{slow:s,standard:s.mul(2),fast:s.mul(5),lastUpdated:Date.now()}}try{const s=await fetch(`${this.baseUrl}/blockAveFee`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new c(d.NETWORK_ERROR,`Failed to fetch fee info: ${s.status}`);const o=await s.json();if(!o.success){const i=h.fromRaw("1000",t,n);return{slow:i,standard:i.mul(2),fast:i.mul(5),lastUpdated:Date.now()}}const a=h.fromRaw(o.result.minFee,t,n),r=h.fromRaw(o.result.avgFee,t,n);return{slow:a,standard:r.gt(a)?r:a,fast:r.mul(2).gt(a)?r.mul(2):a.mul(2),lastUpdated:Date.now()}}catch(s){if(s instanceof c)throw s;const o=h.fromRaw("1000",t,n);return{slow:o,standard:o.mul(2),fast:o.mul(5),lastUpdated:Date.now()}}}async healthCheck(){if(this.getConfig(),!this.baseUrl)return{isHealthy:!1,latency:0,blockHeight:0n,isSyncing:!1,lastUpdated:Date.now()};const e=Date.now();try{const t=await fetch(`${this.baseUrl}/lastblock`,{method:"GET",headers:{"Content-Type":"application/json"}}),n=Date.now()-e;if(!t.ok)return{isHealthy:!1,latency:n,blockHeight:0n,isSyncing:!1,lastUpdated:Date.now()};const s=await t.json();return{isHealthy:s.success,latency:n,blockHeight:s.success?BigInt(s.result.height):0n,isSyncing:!1,lastUpdated:Date.now()}}catch{return{isHealthy:!1,latency:Date.now()-e,blockHeight:0n,isSyncing:!1,lastUpdated:Date.now()}}}}class R{chainId;chainType="bioforest";identity;asset;transaction;chain;staking=null;initialized=!1;constructor(e){this.chainId=e,this.identity=new y(e),this.asset=new C(e),this.transaction=new b(e),this.chain=new v(e)}async initialize(){this.initialized||(this.initialized=!0)}dispose(){this.initialized=!1}}function H(l){return new R(l)}export{R as BioforestAdapter,d as ChainErrorCodes,$ as ChainProvider,c as ChainServiceError,x as clearProviderCache,H as createBioforestAdapter,N as createChainProvider,j as deriveWalletChainAddresses,m as getChainProvider};
