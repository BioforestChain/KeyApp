var Uy={};const Jb=Object.getOwnPropertyNames,Yb=(pn,p)=>function(){return p||(0,pn[Jb(pn)[0]])((p={exports:{}}).exports,p),p.exports},Xb=Yb({"src/services/bioforest-sdk/bioforest-chain-bundle.cjs"(pn){Object.defineProperty(pn,Symbol.toStringTag,{value:"Module"});function p(e,t,r,n){var s=arguments.length,i=s<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}function Se(e,t){return function(r,n){t(r,n,e)}}function h(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}var Ky=new WeakMap;function As(e,t,r){if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @cacheBytesGetter. <${t}> is not a method!`);const n=r.value,s=function(...i){if(Object.isFrozen(this)){const o=JSON.stringify(i);let c=Ky.get(this);c||(c=new Map,Ky.set(this,c));let l=c.get(o);return l||(l=n.apply(this,i),c.set(o,l)),l}return n.apply(this,i)};return r.value=s,r}var jy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function Ri(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var zy={};(function(e){var t=e;t.length=function(o){var c=o.length;if(!c)return 0;for(var l=0;--c%4>1&&o.charAt(c)==="=";)++l;return Math.ceil(o.length*3)/4-l};for(var r=new Array(64),n=new Array(123),s=0;s<64;)n[r[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;t.encode=function(o,c,l){for(var u=null,g=[],y=0,m=0,d;c<l;){var I=o[c++];switch(m){case 0:g[y++]=r[I>>2],d=(I&3)<<4,m=1;break;case 1:g[y++]=r[d|I>>4],d=(I&15)<<2,m=2;break;case 2:g[y++]=r[d|I>>6],g[y++]=r[I&63],m=0;break}y>8191&&((u||(u=[])).push(String.fromCharCode.apply(String,g)),y=0)}return m&&(g[y++]=r[d],g[y++]=61,m===1&&(g[y++]=61)),u?(y&&u.push(String.fromCharCode.apply(String,g.slice(0,y))),u.join("")):String.fromCharCode.apply(String,g.slice(0,y))};var i="invalid encoding";t.decode=function(o,c,l){for(var u=l,g=0,y,m=0;m<o.length;){var d=o.charCodeAt(m++);if(d===61&&g>1)break;if((d=n[d])===void 0)throw Error(i);switch(g){case 0:y=d,g=1;break;case 1:c[l++]=y<<2|(d&48)>>4,y=d,g=2;break;case 2:c[l++]=(y&15)<<4|(d&60)>>2,y=d,g=3;break;case 3:c[l++]=(y&3)<<6|d,g=0;break}}if(g===1)throw Error(i);return l-u},t.test=function(o){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(o)}})(zy);var Pu=Ri(zy),hn;try{if(typeof WebAssembly=="object"){const e="AGFzbQEAAAABDQJgAAF/YAR/f39/AX8DBwYAAQEBAQEGBgF/AUEACwcyBgNtdWwAAQVkaXZfcwACBWRpdl91AAMFcmVtX3MABAVyZW1fdQAFCGdldF9oaWdoAAAKvwEGBAAjAAskAQF+IACtIAGtQiCGhCACrSADrUIghoR+IgRCIIenJAAgBKcLJAEBfiAArSABrUIghoQgAq0gA61CIIaEfyIEQiCHpyQAIASnCyQBAX4gAK0gAa1CIIaEIAKtIAOtQiCGhIAiBEIgh6ckACAEpwskAQF+IACtIAGtQiCGhCACrSADrUIghoSBIgRCIIenJAAgBKcLJAEBfiAArSABrUIghoQgAq0gA61CIIaEgiIEQiCHpyQAIASnCw==",t=new Uint8Array(Pu.length(e));Pu.decode(e,t,0),hn=new WebAssembly.Instance(new WebAssembly.Module(t),{}).exports}}catch{}var Dt=class ue{constructor(t,r,n){this.__isLong__=!0,this.low=t|0,this.high=r|0,this.unsigned=!!n}static isLong(t){return(t&&t.__isLong__)===!0}static fromInt(t,r){var n,s,i;return r?(t>>>=0,(i=0<=t&&t<256)&&(s=this._UINT_CACHE[t],s)?s:(n=this.fromBits(t,(t|0)<0?-1:0,!0),i&&(this._UINT_CACHE[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(s=this._INT_CACHE[t],s)?s:(n=this.fromBits(t,t<0?-1:0,!1),i&&(this._INT_CACHE[t]=n),n))}static fromNumber(t,r){if(isNaN(t))return r?ue.UZERO:ue.ZERO;if(r){if(t<0)return ue.UZERO;if(t>=Yy)return ue.MAX_UNSIGNED_VALUE}else{if(t<=-Xy)return ue.MIN_VALUE;if(t+1>=Xy)return ue.MAX_VALUE}return t<0?this.fromNumber(-t,r).neg():this.fromBits(t%Ba|0,t/Ba|0,r)}static fromBits(t,r,n){return new ue(t,r,n)}static fromString(t,r,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return ue.ZERO;if(typeof r=="number"?(n=r,r=!1):r=!!r,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return this.fromString(t.substring(1),r,n).neg();for(var i=this.fromNumber(Mh(n,8)),o=ue.ZERO,c=0;c<t.length;c+=8){var l=Math.min(8,t.length-c),u=parseInt(t.substring(c,c+l),n);if(l<8){var g=this.fromNumber(Mh(n,l));o=o.mul(g).add(this.fromNumber(u))}else o=o.mul(i),o=o.add(this.fromNumber(u))}return o.unsigned=r,o}static fromValue(t,r){return typeof t=="number"?this.fromNumber(t,r):typeof t=="string"?this.fromString(t,r):this.fromBits(t.low,t.high,typeof r=="boolean"?r:t.unsigned)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){return this.unsigned?(this.high>>>0)*Ba+(this.low>>>0):this.high*Ba+(this.low>>>0)}toString(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ue.MIN_VALUE)){var r=ue.fromNumber(t),n=this.div(r),s=n.mul(r).sub(this);return n.toString(t)+s.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var i=ue.fromNumber(Mh(t,6),this.unsigned),o=this,c="";;){var l=o.div(i),u=o.sub(l.mul(i)).toInt()>>>0,g=u.toString(t);if(o=l,o.isZero())return g+c;for(;g.length<6;)g="0"+g;c=""+g+c}}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){if(this.isNegative())return this.eq(ue.MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,r=31;r>0&&!(t&1<<r);r--);return this.high!=0?r+33:r+1}isZero(){return this.high===0&&this.low===0}isNegative(){return!this.unsigned&&this.high<0}isPositive(){return this.unsigned||this.high>=0}isOdd(){return(this.low&1)===1}isEven(){return(this.low&1)===0}equals(t){return ue.isLong(t)||(t=ue.fromValue(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low}notEquals(t){return!this.eq(t)}lessThan(t){return this.comp(t)<0}lessThanOrEqual(t){return this.comp(t)<=0}greaterThan(t){return this.comp(t)>0}greaterThanOrEqual(t){return this.comp(t)>=0}compare(t){if(ue.isLong(t)||(t=ue.fromValue(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1}negate(){return!this.unsigned&&this.eq(ue.MIN_VALUE)?ue.MIN_VALUE:this.not().add(ue.ONE)}add(t){ue.isLong(t)||(t=ue.fromValue(t));var r=this.high>>>16,n=this.high&65535,s=this.low>>>16,i=this.low&65535,o=t.high>>>16,c=t.high&65535,l=t.low>>>16,u=t.low&65535,g=0,y=0,m=0,d=0;return d+=i+u,m+=d>>>16,d&=65535,m+=s+l,y+=m>>>16,m&=65535,y+=n+c,g+=y>>>16,y&=65535,g+=r+o,g&=65535,ue.fromBits(m<<16|d,g<<16|y,this.unsigned)}subtract(t){return ue.isLong(t)||(t=ue.fromValue(t)),this.add(t.neg())}multiply(t){if(this.isZero())return ue.ZERO;if(ue.isLong(t)||(t=ue.fromValue(t)),hn){var r=hn.mul(this.low,this.high,t.low,t.high);return ue.fromBits(r,hn.get_high(),this.unsigned)}if(t.isZero())return ue.ZERO;if(this.eq(ue.MIN_VALUE))return t.isOdd()?ue.MIN_VALUE:ue.ZERO;if(t.eq(ue.MIN_VALUE))return this.isOdd()?ue.MIN_VALUE:ue.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Qy)&&t.lt(Qy))return ue.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,c=t.high>>>16,l=t.high&65535,u=t.low>>>16,g=t.low&65535,y=0,m=0,d=0,I=0;return I+=o*g,d+=I>>>16,I&=65535,d+=i*g,m+=d>>>16,d&=65535,d+=o*u,m+=d>>>16,d&=65535,m+=s*g,y+=m>>>16,m&=65535,m+=i*u,y+=m>>>16,m&=65535,m+=o*l,y+=m>>>16,m&=65535,y+=n*g+s*u+i*l+o*c,y&=65535,ue.fromBits(d<<16|I,y<<16|m,this.unsigned)}divide(t){if(ue.isLong(t)||(t=ue.fromValue(t)),t.isZero())throw Error("division by zero");if(hn){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var r=(this.unsigned?hn.div_u:hn.div_s)(this.low,this.high,t.low,t.high);return ue.fromBits(r,hn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ue.UZERO:ue.ZERO;var n,s,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return ue.UZERO;if(t.gt(this.shru(1)))return ue.UONE;i=ue.UZERO}else{if(this.eq(ue.MIN_VALUE)){if(t.eq(ue.ONE)||t.eq(ue.NEG_ONE))return ue.MIN_VALUE;if(t.eq(ue.MIN_VALUE))return ue.ONE;var o=this.shr(1);return n=o.div(t).shl(1),n.eq(ue.ZERO)?t.isNegative()?ue.ONE:ue.NEG_ONE:(s=this.sub(t.mul(n)),i=n.add(s.div(t)),i)}else if(t.eq(ue.MIN_VALUE))return this.unsigned?ue.UZERO:ue.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=ue.ZERO}for(s=this;s.gte(t);){n=Math.max(1,Math.floor(s.toNumber()/t.toNumber()));for(var c=Math.ceil(Math.log(n)/Math.LN2),l=c<=48?1:Mh(2,c-48),u=ue.fromNumber(n),g=u.mul(t);g.isNegative()||g.gt(s);)n-=l,u=ue.fromNumber(n,this.unsigned),g=u.mul(t);u.isZero()&&(u=ue.ONE),i=i.add(u),s=s.sub(g)}return i}modulo(t){if(ue.isLong(t)||(t=ue.fromValue(t)),hn){var r=(this.unsigned?hn.rem_u:hn.rem_s)(this.low,this.high,t.low,t.high);return ue.fromBits(r,hn.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))}not(){return ue.fromBits(~this.low,~this.high,this.unsigned)}and(t){return ue.isLong(t)||(t=ue.fromValue(t)),ue.fromBits(this.low&t.low,this.high&t.high,this.unsigned)}or(t){return ue.isLong(t)||(t=ue.fromValue(t)),ue.fromBits(this.low|t.low,this.high|t.high,this.unsigned)}xor(t){return ue.isLong(t)||(t=ue.fromValue(t)),ue.fromBits(this.low^t.low,this.high^t.high,this.unsigned)}shiftLeft(t){return ue.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?ue.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):ue.fromBits(0,this.low<<t-32,this.unsigned)}shiftRight(t){return ue.isLong(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?ue.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):ue.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)}shiftRightUnsigned(t){if(ue.isLong(t)&&(t=t.toInt()),t&=63,t===0)return this;var r=this.high;if(t<32){var n=this.low;return ue.fromBits(n>>>t|r<<32-t,r>>>t,this.unsigned)}else return t===32?ue.fromBits(r,0,this.unsigned):ue.fromBits(r>>>t-32,0,this.unsigned)}toSigned(){return this.unsigned?ue.fromBits(this.low,this.high,!1):this}toUnsigned(){return this.unsigned?this:ue.fromBits(this.low,this.high,!0)}toBytes(t){return t?this.toBytesLE():this.toBytesBE()}toBytesLE(){var t=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]}toBytesBE(){var t=this.high,r=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,r>>>24,r>>>16&255,r>>>8&255,r&255]}static fromBytes(t,r,n){return n?ue.fromBytesLE(t,r):this.fromBytesBE(t,r)}static fromBytesLE(t,r){return new ue(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)}static fromBytesBE(t,r){return new ue(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)}};Dt._INT_CACHE=Object.create(null),Dt._UINT_CACHE=Object.create(null),Dt.ZERO=Dt.fromInt(0),Dt.UZERO=Dt.fromInt(0,!0),Dt.ONE=Dt.fromInt(1),Dt.UONE=Dt.fromInt(1,!0),Dt.NEG_ONE=Dt.fromInt(-1),Dt.MAX_VALUE=Dt.fromBits(-1,2147483647,!1),Dt.MAX_UNSIGNED_VALUE=Dt.fromBits(-1,-1,!0),Dt.MIN_VALUE=Dt.fromBits(0,-2147483648,!1);var Mh=Math.pow,Jy=65536,EI=1<<24,Ba=Jy*Jy,Yy=Ba*Ba,Xy=Yy/2,Qy=Dt.fromInt(EI),$e=Dt.prototype;$e.eqz=$e.isZero,$e.eq=$e.equals,$e.neq=$e.notEquals,$e.ne=$e.notEquals,$e.lt=$e.lessThan,$e.lte=$e.lessThanOrEqual,$e.le=$e.lessThanOrEqual,$e.gt=$e.greaterThan,$e.gte=$e.greaterThanOrEqual,$e.ge=$e.greaterThanOrEqual,$e.comp=$e.compare,$e.neg=$e.negate,$e.sub=$e.subtract,$e.mul=$e.multiply,$e.div=$e.divide,$e.mod=$e.modulo,$e.rem=$e.modulo,$e.shl=$e.shiftLeft,$e.shr=$e.shiftRight,$e.shru=$e.shiftRightUnsigned,$e.shr_u=$e.shiftRightUnsigned;var Jn={},Dh={};Dh.byteLength=SI,Dh.toByteArray=wI,Dh.fromByteArray=vI;var Yn=[],ln=[],TI=typeof Uint8Array<"u"?Uint8Array:Array,xu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Pi=0,qy=xu.length;Pi<qy;++Pi)Yn[Pi]=xu[Pi],ln[xu.charCodeAt(Pi)]=Pi;var Pi,qy;ln[45]=62,ln[95]=63;function Wy(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function SI(e){var t=Wy(e),r=t[0],n=t[1];return(r+n)*3/4-n}function bI(e,t,r){return(t+r)*3/4-r}function wI(e){var t,r=Wy(e),n=r[0],s=r[1],i=new TI(bI(e,n,s)),o=0,c=s>0?n-4:n,l;for(l=0;l<c;l+=4)t=ln[e.charCodeAt(l)]<<18|ln[e.charCodeAt(l+1)]<<12|ln[e.charCodeAt(l+2)]<<6|ln[e.charCodeAt(l+3)],i[o++]=t>>16&255,i[o++]=t>>8&255,i[o++]=t&255;return s===2&&(t=ln[e.charCodeAt(l)]<<2|ln[e.charCodeAt(l+1)]>>4,i[o++]=t&255),s===1&&(t=ln[e.charCodeAt(l)]<<10|ln[e.charCodeAt(l+1)]<<4|ln[e.charCodeAt(l+2)]>>2,i[o++]=t>>8&255,i[o++]=t&255),i}function NI(e){return Yn[e>>18&63]+Yn[e>>12&63]+Yn[e>>6&63]+Yn[e&63]}function OI(e,t,r){for(var n,s=[],i=t;i<r;i+=3)n=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(e[i+2]&255),s.push(NI(n));return s.join("")}function vI(e){for(var t,r=e.length,n=r%3,s=[],i=16383,o=0,c=r-n;o<c;o+=i)s.push(OI(e,o,o+i>c?c:o+i));return n===1?(t=e[r-1],s.push(Yn[t>>2]+Yn[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],s.push(Yn[t>>10]+Yn[t>>4&63]+Yn[t<<2&63]+"=")),s.join("")}var Bu={};Bu.read=function(e,t,r,n,s){var i,o,c=s*8-n-1,l=(1<<c)-1,u=l>>1,g=-7,y=r?s-1:0,m=r?-1:1,d=e[t+y];for(y+=m,i=d&(1<<-g)-1,d>>=-g,g+=c;g>0;i=i*256+e[t+y],y+=m,g-=8);for(o=i&(1<<-g)-1,i>>=-g,g+=n;g>0;o=o*256+e[t+y],y+=m,g-=8);if(i===0)i=1-u;else{if(i===l)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,n),i=i-u}return(d?-1:1)*o*Math.pow(2,i-n)},Bu.write=function(e,t,r,n,s,i){var o,c,l,u=i*8-s-1,g=(1<<u)-1,y=g>>1,m=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:i-1,I=n?1:-1,T=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(c=isNaN(t)?1:0,o=g):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+y>=1?t+=m/l:t+=m*Math.pow(2,1-y),t*l>=2&&(o++,l/=2),o+y>=g?(c=0,o=g):o+y>=1?(c=(t*l-1)*Math.pow(2,s),o=o+y):(c=t*Math.pow(2,y-1)*Math.pow(2,s),o=0));s>=8;e[r+d]=c&255,d+=I,c/=256,s-=8);for(o=o<<s|c,u+=s;u>0;e[r+d]=o&255,d+=I,o/=256,u-=8);e[r+d-I]|=T*128},(function(e){const t=Dh,r=Bu,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=c,e.SlowBuffer=b,e.INSPECT_MAX_BYTES=50;const s=2147483647;e.kMaxLength=s,c.TYPED_ARRAY_SUPPORT=i(),!c.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function i(){try{const f=new Uint8Array(1),A={foo:function(){return 42}};return Object.setPrototypeOf(A,Uint8Array.prototype),Object.setPrototypeOf(f,A),f.foo()===42}catch{return!1}}Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}});function o(f){if(f>s)throw new RangeError('The value "'+f+'" is invalid for option "size"');const A=new Uint8Array(f);return Object.setPrototypeOf(A,c.prototype),A}function c(f,A,E){if(typeof f=="number"){if(typeof A=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(f)}return l(f,A,E)}c.poolSize=8192;function l(f,A,E){if(typeof f=="string")return m(f,A);if(ArrayBuffer.isView(f))return I(f);if(f==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof f);if(Sn(f,ArrayBuffer)||f&&Sn(f.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Sn(f,SharedArrayBuffer)||f&&Sn(f.buffer,SharedArrayBuffer)))return T(f,A,E);if(typeof f=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const O=f.valueOf&&f.valueOf();if(O!=null&&O!==f)return c.from(O,A,E);const P=S(f);if(P)return P;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof f[Symbol.toPrimitive]=="function")return c.from(f[Symbol.toPrimitive]("string"),A,E);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof f)}c.from=function(f,A,E){return l(f,A,E)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array);function u(f){if(typeof f!="number")throw new TypeError('"size" argument must be of type number');if(f<0)throw new RangeError('The value "'+f+'" is invalid for option "size"')}function g(f,A,E){return u(f),f<=0?o(f):A!==void 0?typeof E=="string"?o(f).fill(A,E):o(f).fill(A):o(f)}c.alloc=function(f,A,E){return g(f,A,E)};function y(f){return u(f),o(f<0?0:w(f)|0)}c.allocUnsafe=function(f){return y(f)},c.allocUnsafeSlow=function(f){return y(f)};function m(f,A){if((typeof A!="string"||A==="")&&(A="utf8"),!c.isEncoding(A))throw new TypeError("Unknown encoding: "+A);const E=R(f,A)|0;let O=o(E);const P=O.write(f,A);return P!==E&&(O=O.slice(0,P)),O}function d(f){const A=f.length<0?0:w(f.length)|0,E=o(A);for(let O=0;O<A;O+=1)E[O]=f[O]&255;return E}function I(f){if(Sn(f,Uint8Array)){const A=new Uint8Array(f);return T(A.buffer,A.byteOffset,A.byteLength)}return d(f)}function T(f,A,E){if(A<0||f.byteLength<A)throw new RangeError('"offset" is outside of buffer bounds');if(f.byteLength<A+(E||0))throw new RangeError('"length" is outside of buffer bounds');let O;return A===void 0&&E===void 0?O=new Uint8Array(f):E===void 0?O=new Uint8Array(f,A):O=new Uint8Array(f,A,E),Object.setPrototypeOf(O,c.prototype),O}function S(f){if(c.isBuffer(f)){const A=w(f.length)|0,E=o(A);return E.length===0||f.copy(E,0,0,A),E}if(f.length!==void 0)return typeof f.length!="number"||Pa(f.length)?o(0):d(f);if(f.type==="Buffer"&&Array.isArray(f.data))return d(f.data)}function w(f){if(f>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return f|0}function b(f){return+f!=f&&(f=0),c.alloc(+f)}c.isBuffer=function(f){return f!=null&&f._isBuffer===!0&&f!==c.prototype},c.compare=function(f,A){if(Sn(f,Uint8Array)&&(f=c.from(f,f.offset,f.byteLength)),Sn(A,Uint8Array)&&(A=c.from(A,A.offset,A.byteLength)),!c.isBuffer(f)||!c.isBuffer(A))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(f===A)return 0;let E=f.length,O=A.length;for(let P=0,V=Math.min(E,O);P<V;++P)if(f[P]!==A[P]){E=f[P],O=A[P];break}return E<O?-1:O<E?1:0},c.isEncoding=function(f){switch(String(f).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(f,A){if(!Array.isArray(f))throw new TypeError('"list" argument must be an Array of Buffers');if(f.length===0)return c.alloc(0);let E;if(A===void 0)for(A=0,E=0;E<f.length;++E)A+=f[E].length;const O=c.allocUnsafe(A);let P=0;for(E=0;E<f.length;++E){let V=f[E];if(Sn(V,Uint8Array))P+V.length>O.length?(c.isBuffer(V)||(V=c.from(V)),V.copy(O,P)):Uint8Array.prototype.set.call(O,V,P);else if(c.isBuffer(V))V.copy(O,P);else throw new TypeError('"list" argument must be an Array of Buffers');P+=V.length}return O};function R(f,A){if(c.isBuffer(f))return f.length;if(ArrayBuffer.isView(f)||Sn(f,ArrayBuffer))return f.byteLength;if(typeof f!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof f);const E=f.length,O=arguments.length>2&&arguments[2]===!0;if(!O&&E===0)return 0;let P=!1;for(;;)switch(A){case"ascii":case"latin1":case"binary":return E;case"utf8":case"utf-8":return kh(f).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E*2;case"hex":return E>>>1;case"base64":return Ou(f).length;default:if(P)return O?-1:kh(f).length;A=(""+A).toLowerCase(),P=!0}}c.byteLength=R;function v(f,A,E){let O=!1;if((A===void 0||A<0)&&(A=0),A>this.length||((E===void 0||E>this.length)&&(E=this.length),E<=0)||(E>>>=0,A>>>=0,E<=A))return"";for(f||(f="utf8");;)switch(f){case"hex":return ge(this,A,E);case"utf8":case"utf-8":return K(this,A,E);case"ascii":return Te(this,A,E);case"latin1":case"binary":return le(this,A,E);case"base64":return F(this,A,E);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,A,E);default:if(O)throw new TypeError("Unknown encoding: "+f);f=(f+"").toLowerCase(),O=!0}}c.prototype._isBuffer=!0;function $(f,A,E){const O=f[A];f[A]=f[E],f[E]=O}c.prototype.swap16=function(){const f=this.length;if(f%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let A=0;A<f;A+=2)$(this,A,A+1);return this},c.prototype.swap32=function(){const f=this.length;if(f%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let A=0;A<f;A+=4)$(this,A,A+3),$(this,A+1,A+2);return this},c.prototype.swap64=function(){const f=this.length;if(f%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let A=0;A<f;A+=8)$(this,A,A+7),$(this,A+1,A+6),$(this,A+2,A+5),$(this,A+3,A+4);return this},c.prototype.toString=function(){const f=this.length;return f===0?"":arguments.length===0?K(this,0,f):v.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(f){if(!c.isBuffer(f))throw new TypeError("Argument must be a Buffer");return this===f?!0:c.compare(this,f)===0},c.prototype.inspect=function(){let f="";const A=e.INSPECT_MAX_BYTES;return f=this.toString("hex",0,A).replace(/(.{2})/g,"$1 ").trim(),this.length>A&&(f+=" ... "),"<Buffer "+f+">"},n&&(c.prototype[n]=c.prototype.inspect),c.prototype.compare=function(f,A,E,O,P){if(Sn(f,Uint8Array)&&(f=c.from(f,f.offset,f.byteLength)),!c.isBuffer(f))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof f);if(A===void 0&&(A=0),E===void 0&&(E=f?f.length:0),O===void 0&&(O=0),P===void 0&&(P=this.length),A<0||E>f.length||O<0||P>this.length)throw new RangeError("out of range index");if(O>=P&&A>=E)return 0;if(O>=P)return-1;if(A>=E)return 1;if(A>>>=0,E>>>=0,O>>>=0,P>>>=0,this===f)return 0;let V=P-O,ne=E-A;const Pe=Math.min(V,ne),gt=this.slice(O,P),ct=f.slice(A,E);for(let ft=0;ft<Pe;++ft)if(gt[ft]!==ct[ft]){V=gt[ft],ne=ct[ft];break}return V<ne?-1:ne<V?1:0};function D(f,A,E,O,P){if(f.length===0)return-1;if(typeof E=="string"?(O=E,E=0):E>2147483647?E=2147483647:E<-2147483648&&(E=-2147483648),E=+E,Pa(E)&&(E=P?0:f.length-1),E<0&&(E=f.length+E),E>=f.length){if(P)return-1;E=f.length-1}else if(E<0)if(P)E=0;else return-1;if(typeof A=="string"&&(A=c.from(A,O)),c.isBuffer(A))return A.length===0?-1:L(f,A,E,O,P);if(typeof A=="number")return A=A&255,typeof Uint8Array.prototype.indexOf=="function"?P?Uint8Array.prototype.indexOf.call(f,A,E):Uint8Array.prototype.lastIndexOf.call(f,A,E):L(f,[A],E,O,P);throw new TypeError("val must be string, number or Buffer")}function L(f,A,E,O,P){let V=1,ne=f.length,Pe=A.length;if(O!==void 0&&(O=String(O).toLowerCase(),O==="ucs2"||O==="ucs-2"||O==="utf16le"||O==="utf-16le")){if(f.length<2||A.length<2)return-1;V=2,ne/=2,Pe/=2,E/=2}function gt(ft,Jt){return V===1?ft[Jt]:ft.readUInt16BE(Jt*V)}let ct;if(P){let ft=-1;for(ct=E;ct<ne;ct++)if(gt(f,ct)===gt(A,ft===-1?0:ct-ft)){if(ft===-1&&(ft=ct),ct-ft+1===Pe)return ft*V}else ft!==-1&&(ct-=ct-ft),ft=-1}else for(E+Pe>ne&&(E=ne-Pe),ct=E;ct>=0;ct--){let ft=!0;for(let Jt=0;Jt<Pe;Jt++)if(gt(f,ct+Jt)!==gt(A,Jt)){ft=!1;break}if(ft)return ct}return-1}c.prototype.includes=function(f,A,E){return this.indexOf(f,A,E)!==-1},c.prototype.indexOf=function(f,A,E){return D(this,f,A,E,!0)},c.prototype.lastIndexOf=function(f,A,E){return D(this,f,A,E,!1)};function z(f,A,E,O){E=Number(E)||0;const P=f.length-E;O?(O=Number(O),O>P&&(O=P)):O=P;const V=A.length;O>V/2&&(O=V/2);let ne;for(ne=0;ne<O;++ne){const Pe=parseInt(A.substr(ne*2,2),16);if(Pa(Pe))return ne;f[E+ne]=Pe}return ne}function Y(f,A,E,O){return oc(kh(A,f.length-E),f,E,O)}function x(f,A,E,O){return oc(Fy(A),f,E,O)}function H(f,A,E,O){return oc(Ou(A),f,E,O)}function M(f,A,E,O){return oc(Lh(A,f.length-E),f,E,O)}c.prototype.write=function(f,A,E,O){if(A===void 0)O="utf8",E=this.length,A=0;else if(E===void 0&&typeof A=="string")O=A,E=this.length,A=0;else if(isFinite(A))A=A>>>0,isFinite(E)?(E=E>>>0,O===void 0&&(O="utf8")):(O=E,E=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const P=this.length-A;if((E===void 0||E>P)&&(E=P),f.length>0&&(E<0||A<0)||A>this.length)throw new RangeError("Attempt to write outside buffer bounds");O||(O="utf8");let V=!1;for(;;)switch(O){case"hex":return z(this,f,A,E);case"utf8":case"utf-8":return Y(this,f,A,E);case"ascii":case"latin1":case"binary":return x(this,f,A,E);case"base64":return H(this,f,A,E);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,f,A,E);default:if(V)throw new TypeError("Unknown encoding: "+O);O=(""+O).toLowerCase(),V=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function F(f,A,E){return A===0&&E===f.length?t.fromByteArray(f):t.fromByteArray(f.slice(A,E))}function K(f,A,E){E=Math.min(f.length,E);const O=[];let P=A;for(;P<E;){const V=f[P];let ne=null,Pe=V>239?4:V>223?3:V>191?2:1;if(P+Pe<=E){let gt,ct,ft,Jt;switch(Pe){case 1:V<128&&(ne=V);break;case 2:gt=f[P+1],(gt&192)===128&&(Jt=(V&31)<<6|gt&63,Jt>127&&(ne=Jt));break;case 3:gt=f[P+1],ct=f[P+2],(gt&192)===128&&(ct&192)===128&&(Jt=(V&15)<<12|(gt&63)<<6|ct&63,Jt>2047&&(Jt<55296||Jt>57343)&&(ne=Jt));break;case 4:gt=f[P+1],ct=f[P+2],ft=f[P+3],(gt&192)===128&&(ct&192)===128&&(ft&192)===128&&(Jt=(V&15)<<18|(gt&63)<<12|(ct&63)<<6|ft&63,Jt>65535&&Jt<1114112&&(ne=Jt))}}ne===null?(ne=65533,Pe=1):ne>65535&&(ne-=65536,O.push(ne>>>10&1023|55296),ne=56320|ne&1023),O.push(ne),P+=Pe}return ye(O)}const X=4096;function ye(f){const A=f.length;if(A<=X)return String.fromCharCode.apply(String,f);let E="",O=0;for(;O<A;)E+=String.fromCharCode.apply(String,f.slice(O,O+=X));return E}function Te(f,A,E){let O="";E=Math.min(f.length,E);for(let P=A;P<E;++P)O+=String.fromCharCode(f[P]&127);return O}function le(f,A,E){let O="";E=Math.min(f.length,E);for(let P=A;P<E;++P)O+=String.fromCharCode(f[P]);return O}function ge(f,A,E){const O=f.length;(!A||A<0)&&(A=0),(!E||E<0||E>O)&&(E=O);let P="";for(let V=A;V<E;++V)P+=Q[f[V]];return P}function N(f,A,E){const O=f.slice(A,E);let P="";for(let V=0;V<O.length-1;V+=2)P+=String.fromCharCode(O[V]+O[V+1]*256);return P}c.prototype.slice=function(f,A){const E=this.length;f=~~f,A=A===void 0?E:~~A,f<0?(f+=E,f<0&&(f=0)):f>E&&(f=E),A<0?(A+=E,A<0&&(A=0)):A>E&&(A=E),A<f&&(A=f);const O=this.subarray(f,A);return Object.setPrototypeOf(O,c.prototype),O};function oe(f,A,E){if(f%1!==0||f<0)throw new RangeError("offset is not uint");if(f+A>E)throw new RangeError("Trying to access beyond buffer length")}c.prototype.readUintLE=c.prototype.readUIntLE=function(f,A,E){f=f>>>0,A=A>>>0,E||oe(f,A,this.length);let O=this[f],P=1,V=0;for(;++V<A&&(P*=256);)O+=this[f+V]*P;return O},c.prototype.readUintBE=c.prototype.readUIntBE=function(f,A,E){f=f>>>0,A=A>>>0,E||oe(f,A,this.length);let O=this[f+--A],P=1;for(;A>0&&(P*=256);)O+=this[f+--A]*P;return O},c.prototype.readUint8=c.prototype.readUInt8=function(f,A){return f=f>>>0,A||oe(f,1,this.length),this[f]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(f,A){return f=f>>>0,A||oe(f,2,this.length),this[f]|this[f+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(f,A){return f=f>>>0,A||oe(f,2,this.length),this[f]<<8|this[f+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(f,A){return f=f>>>0,A||oe(f,4,this.length),(this[f]|this[f+1]<<8|this[f+2]<<16)+this[f+3]*16777216},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(f,A){return f=f>>>0,A||oe(f,4,this.length),this[f]*16777216+(this[f+1]<<16|this[f+2]<<8|this[f+3])},c.prototype.readBigUInt64LE=te(function(f){f=f>>>0,mt(f,"offset");const A=this[f],E=this[f+7];(A===void 0||E===void 0)&&_t(f,this.length-8);const O=A+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24,P=this[++f]+this[++f]*2**8+this[++f]*2**16+E*2**24;return BigInt(O)+(BigInt(P)<<BigInt(32))}),c.prototype.readBigUInt64BE=te(function(f){f=f>>>0,mt(f,"offset");const A=this[f],E=this[f+7];(A===void 0||E===void 0)&&_t(f,this.length-8);const O=A*2**24+this[++f]*2**16+this[++f]*2**8+this[++f],P=this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+E;return(BigInt(O)<<BigInt(32))+BigInt(P)}),c.prototype.readIntLE=function(f,A,E){f=f>>>0,A=A>>>0,E||oe(f,A,this.length);let O=this[f],P=1,V=0;for(;++V<A&&(P*=256);)O+=this[f+V]*P;return P*=128,O>=P&&(O-=Math.pow(2,8*A)),O},c.prototype.readIntBE=function(f,A,E){f=f>>>0,A=A>>>0,E||oe(f,A,this.length);let O=A,P=1,V=this[f+--O];for(;O>0&&(P*=256);)V+=this[f+--O]*P;return P*=128,V>=P&&(V-=Math.pow(2,8*A)),V},c.prototype.readInt8=function(f,A){return f=f>>>0,A||oe(f,1,this.length),this[f]&128?(255-this[f]+1)*-1:this[f]},c.prototype.readInt16LE=function(f,A){f=f>>>0,A||oe(f,2,this.length);const E=this[f]|this[f+1]<<8;return E&32768?E|4294901760:E},c.prototype.readInt16BE=function(f,A){f=f>>>0,A||oe(f,2,this.length);const E=this[f+1]|this[f]<<8;return E&32768?E|4294901760:E},c.prototype.readInt32LE=function(f,A){return f=f>>>0,A||oe(f,4,this.length),this[f]|this[f+1]<<8|this[f+2]<<16|this[f+3]<<24},c.prototype.readInt32BE=function(f,A){return f=f>>>0,A||oe(f,4,this.length),this[f]<<24|this[f+1]<<16|this[f+2]<<8|this[f+3]},c.prototype.readBigInt64LE=te(function(f){f=f>>>0,mt(f,"offset");const A=this[f],E=this[f+7];(A===void 0||E===void 0)&&_t(f,this.length-8);const O=this[f+4]+this[f+5]*2**8+this[f+6]*2**16+(E<<24);return(BigInt(O)<<BigInt(32))+BigInt(A+this[++f]*2**8+this[++f]*2**16+this[++f]*2**24)}),c.prototype.readBigInt64BE=te(function(f){f=f>>>0,mt(f,"offset");const A=this[f],E=this[f+7];(A===void 0||E===void 0)&&_t(f,this.length-8);const O=(A<<24)+this[++f]*2**16+this[++f]*2**8+this[++f];return(BigInt(O)<<BigInt(32))+BigInt(this[++f]*2**24+this[++f]*2**16+this[++f]*2**8+E)}),c.prototype.readFloatLE=function(f,A){return f=f>>>0,A||oe(f,4,this.length),r.read(this,f,!0,23,4)},c.prototype.readFloatBE=function(f,A){return f=f>>>0,A||oe(f,4,this.length),r.read(this,f,!1,23,4)},c.prototype.readDoubleLE=function(f,A){return f=f>>>0,A||oe(f,8,this.length),r.read(this,f,!0,52,8)},c.prototype.readDoubleBE=function(f,A){return f=f>>>0,A||oe(f,8,this.length),r.read(this,f,!1,52,8)};function pe(f,A,E,O,P,V){if(!c.isBuffer(f))throw new TypeError('"buffer" argument must be a Buffer instance');if(A>P||A<V)throw new RangeError('"value" argument is out of bounds');if(E+O>f.length)throw new RangeError("Index out of range")}c.prototype.writeUintLE=c.prototype.writeUIntLE=function(f,A,E,O){if(f=+f,A=A>>>0,E=E>>>0,!O){const ne=Math.pow(2,8*E)-1;pe(this,f,A,E,ne,0)}let P=1,V=0;for(this[A]=f&255;++V<E&&(P*=256);)this[A+V]=f/P&255;return A+E},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(f,A,E,O){if(f=+f,A=A>>>0,E=E>>>0,!O){const ne=Math.pow(2,8*E)-1;pe(this,f,A,E,ne,0)}let P=E-1,V=1;for(this[A+P]=f&255;--P>=0&&(V*=256);)this[A+P]=f/V&255;return A+E},c.prototype.writeUint8=c.prototype.writeUInt8=function(f,A,E){return f=+f,A=A>>>0,E||pe(this,f,A,1,255,0),this[A]=f&255,A+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(f,A,E){return f=+f,A=A>>>0,E||pe(this,f,A,2,65535,0),this[A]=f&255,this[A+1]=f>>>8,A+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(f,A,E){return f=+f,A=A>>>0,E||pe(this,f,A,2,65535,0),this[A]=f>>>8,this[A+1]=f&255,A+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(f,A,E){return f=+f,A=A>>>0,E||pe(this,f,A,4,4294967295,0),this[A+3]=f>>>24,this[A+2]=f>>>16,this[A+1]=f>>>8,this[A]=f&255,A+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(f,A,E){return f=+f,A=A>>>0,E||pe(this,f,A,4,4294967295,0),this[A]=f>>>24,this[A+1]=f>>>16,this[A+2]=f>>>8,this[A+3]=f&255,A+4};function xe(f,A,E,O,P){et(A,O,P,f,E,7);let V=Number(A&BigInt(4294967295));f[E++]=V,V=V>>8,f[E++]=V,V=V>>8,f[E++]=V,V=V>>8,f[E++]=V;let ne=Number(A>>BigInt(32)&BigInt(4294967295));return f[E++]=ne,ne=ne>>8,f[E++]=ne,ne=ne>>8,f[E++]=ne,ne=ne>>8,f[E++]=ne,E}function ce(f,A,E,O,P){et(A,O,P,f,E,7);let V=Number(A&BigInt(4294967295));f[E+7]=V,V=V>>8,f[E+6]=V,V=V>>8,f[E+5]=V,V=V>>8,f[E+4]=V;let ne=Number(A>>BigInt(32)&BigInt(4294967295));return f[E+3]=ne,ne=ne>>8,f[E+2]=ne,ne=ne>>8,f[E+1]=ne,ne=ne>>8,f[E]=ne,E+8}c.prototype.writeBigUInt64LE=te(function(f,A=0){return xe(this,f,A,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=te(function(f,A=0){return ce(this,f,A,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(f,A,E,O){if(f=+f,A=A>>>0,!O){const Pe=Math.pow(2,8*E-1);pe(this,f,A,E,Pe-1,-Pe)}let P=0,V=1,ne=0;for(this[A]=f&255;++P<E&&(V*=256);)f<0&&ne===0&&this[A+P-1]!==0&&(ne=1),this[A+P]=(f/V>>0)-ne&255;return A+E},c.prototype.writeIntBE=function(f,A,E,O){if(f=+f,A=A>>>0,!O){const Pe=Math.pow(2,8*E-1);pe(this,f,A,E,Pe-1,-Pe)}let P=E-1,V=1,ne=0;for(this[A+P]=f&255;--P>=0&&(V*=256);)f<0&&ne===0&&this[A+P+1]!==0&&(ne=1),this[A+P]=(f/V>>0)-ne&255;return A+E},c.prototype.writeInt8=function(f,A,E){return f=+f,A=A>>>0,E||pe(this,f,A,1,127,-128),f<0&&(f=255+f+1),this[A]=f&255,A+1},c.prototype.writeInt16LE=function(f,A,E){return f=+f,A=A>>>0,E||pe(this,f,A,2,32767,-32768),this[A]=f&255,this[A+1]=f>>>8,A+2},c.prototype.writeInt16BE=function(f,A,E){return f=+f,A=A>>>0,E||pe(this,f,A,2,32767,-32768),this[A]=f>>>8,this[A+1]=f&255,A+2},c.prototype.writeInt32LE=function(f,A,E){return f=+f,A=A>>>0,E||pe(this,f,A,4,2147483647,-2147483648),this[A]=f&255,this[A+1]=f>>>8,this[A+2]=f>>>16,this[A+3]=f>>>24,A+4},c.prototype.writeInt32BE=function(f,A,E){return f=+f,A=A>>>0,E||pe(this,f,A,4,2147483647,-2147483648),f<0&&(f=4294967295+f+1),this[A]=f>>>24,this[A+1]=f>>>16,this[A+2]=f>>>8,this[A+3]=f&255,A+4},c.prototype.writeBigInt64LE=te(function(f,A=0){return xe(this,f,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=te(function(f,A=0){return ce(this,f,A,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function q(f,A,E,O,P,V){if(E+O>f.length)throw new RangeError("Index out of range");if(E<0)throw new RangeError("Index out of range")}function ee(f,A,E,O,P){return A=+A,E=E>>>0,P||q(f,A,E,4),r.write(f,A,E,O,23,4),E+4}c.prototype.writeFloatLE=function(f,A,E){return ee(this,f,A,!0,E)},c.prototype.writeFloatBE=function(f,A,E){return ee(this,f,A,!1,E)};function ae(f,A,E,O,P){return A=+A,E=E>>>0,P||q(f,A,E,8),r.write(f,A,E,O,52,8),E+8}c.prototype.writeDoubleLE=function(f,A,E){return ae(this,f,A,!0,E)},c.prototype.writeDoubleBE=function(f,A,E){return ae(this,f,A,!1,E)},c.prototype.copy=function(f,A,E,O){if(!c.isBuffer(f))throw new TypeError("argument should be a Buffer");if(E||(E=0),!O&&O!==0&&(O=this.length),A>=f.length&&(A=f.length),A||(A=0),O>0&&O<E&&(O=E),O===E||f.length===0||this.length===0)return 0;if(A<0)throw new RangeError("targetStart out of bounds");if(E<0||E>=this.length)throw new RangeError("Index out of range");if(O<0)throw new RangeError("sourceEnd out of bounds");O>this.length&&(O=this.length),f.length-A<O-E&&(O=f.length-A+E);const P=O-E;return this===f&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(A,E,O):Uint8Array.prototype.set.call(f,this.subarray(E,O),A),P},c.prototype.fill=function(f,A,E,O){if(typeof f=="string"){if(typeof A=="string"?(O=A,A=0,E=this.length):typeof E=="string"&&(O=E,E=this.length),O!==void 0&&typeof O!="string")throw new TypeError("encoding must be a string");if(typeof O=="string"&&!c.isEncoding(O))throw new TypeError("Unknown encoding: "+O);if(f.length===1){const V=f.charCodeAt(0);(O==="utf8"&&V<128||O==="latin1")&&(f=V)}}else typeof f=="number"?f=f&255:typeof f=="boolean"&&(f=Number(f));if(A<0||this.length<A||this.length<E)throw new RangeError("Out of range index");if(E<=A)return this;A=A>>>0,E=E===void 0?this.length:E>>>0,f||(f=0);let P;if(typeof f=="number")for(P=A;P<E;++P)this[P]=f;else{const V=c.isBuffer(f)?f:c.from(f,O),ne=V.length;if(ne===0)throw new TypeError('The value "'+f+'" is invalid for argument "value"');for(P=0;P<E-A;++P)this[P+A]=V[P%ne]}return this};const se={};function we(f,A,E){se[f]=class extends E{constructor(){super(),Object.defineProperty(this,"message",{value:A.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${f}]`,this.stack,delete this.name}get code(){return f}set code(O){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:O,writable:!0})}toString(){return`${this.name} [${f}]: ${this.message}`}}}we("ERR_BUFFER_OUT_OF_BOUNDS",function(f){return f?`${f} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),we("ERR_INVALID_ARG_TYPE",function(f,A){return`The "${f}" argument must be of type number. Received type ${typeof A}`},TypeError),we("ERR_OUT_OF_RANGE",function(f,A,E){let O=`The value of "${f}" is out of range.`,P=E;return Number.isInteger(E)&&Math.abs(E)>2**32?P=De(String(E)):typeof E=="bigint"&&(P=String(E),(E>BigInt(2)**BigInt(32)||E<-(BigInt(2)**BigInt(32)))&&(P=De(P)),P+="n"),O+=` It must be ${A}. Received ${P}`,O},RangeError);function De(f){let A="",E=f.length;const O=f[0]==="-"?1:0;for(;E>=O+4;E-=3)A=`_${f.slice(E-3,E)}${A}`;return`${f.slice(0,E)}${A}`}function Ke(f,A,E){mt(A,"offset"),(f[A]===void 0||f[A+E]===void 0)&&_t(A,f.length-(E+1))}function et(f,A,E,O,P,V){if(f>E||f<A){const ne=typeof A=="bigint"?"n":"";let Pe;throw A===0||A===BigInt(0)?Pe=`>= 0${ne} and < 2${ne} ** ${(V+1)*8}${ne}`:Pe=`>= -(2${ne} ** ${(V+1)*8-1}${ne}) and < 2 ** ${(V+1)*8-1}${ne}`,new se.ERR_OUT_OF_RANGE("value",Pe,f)}Ke(O,P,V)}function mt(f,A){if(typeof f!="number")throw new se.ERR_INVALID_ARG_TYPE(A,"number",f)}function _t(f,A,E){throw Math.floor(f)!==f?(mt(f,E),new se.ERR_OUT_OF_RANGE("offset","an integer",f)):A<0?new se.ERR_BUFFER_OUT_OF_BOUNDS:new se.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${A}`,f)}const zt=/[^+/0-9A-Za-z-_]/g;function Dy(f){if(f=f.split("=")[0],f=f.trim().replace(zt,""),f.length<2)return"";for(;f.length%4!==0;)f=f+"=";return f}function kh(f,A){A=A||1/0;let E;const O=f.length;let P=null;const V=[];for(let ne=0;ne<O;++ne){if(E=f.charCodeAt(ne),E>55295&&E<57344){if(!P){if(E>56319){(A-=3)>-1&&V.push(239,191,189);continue}else if(ne+1===O){(A-=3)>-1&&V.push(239,191,189);continue}P=E;continue}if(E<56320){(A-=3)>-1&&V.push(239,191,189),P=E;continue}E=(P-55296<<10|E-56320)+65536}else P&&(A-=3)>-1&&V.push(239,191,189);if(P=null,E<128){if((A-=1)<0)break;V.push(E)}else if(E<2048){if((A-=2)<0)break;V.push(E>>6|192,E&63|128)}else if(E<65536){if((A-=3)<0)break;V.push(E>>12|224,E>>6&63|128,E&63|128)}else if(E<1114112){if((A-=4)<0)break;V.push(E>>18|240,E>>12&63|128,E>>6&63|128,E&63|128)}else throw new Error("Invalid code point")}return V}function Fy(f){const A=[];for(let E=0;E<f.length;++E)A.push(f.charCodeAt(E)&255);return A}function Lh(f,A){let E,O,P;const V=[];for(let ne=0;ne<f.length&&!((A-=2)<0);++ne)E=f.charCodeAt(ne),O=E>>8,P=E%256,V.push(P),V.push(O);return V}function Ou(f){return t.toByteArray(Dy(f))}function oc(f,A,E,O){let P;for(P=0;P<O&&!(P+E>=A.length||P>=f.length);++P)A[P+E]=f[P];return P}function Sn(f,A){return f instanceof A||f!=null&&f.constructor!=null&&f.constructor.name!=null&&f.constructor.name===A.name}function Pa(f){return f!==f}const Q=(function(){const f="0123456789abcdef",A=new Array(256);for(let E=0;E<16;++E){const O=E*16;for(let P=0;P<16;++P)A[O+P]=f[E]+f[P]}return A})();function te(f){return typeof BigInt>"u"?he:f}function he(){throw new Error("BigInt not supported")}})(Jn);var CI=RI;function RI(e,t){for(var r=new Array(arguments.length-1),n=0,s=2,i=!0;s<arguments.length;)r[n++]=arguments[s++];return new Promise(function(o,c){r[n]=function(l){if(i)if(i=!1,l)c(l);else{for(var u=new Array(arguments.length-1),g=0;g<u.length;)u[g++]=arguments[g];o.apply(null,u)}};try{e.apply(t||null,r)}catch(l){i&&(i=!1,c(l))}})}var PI=Ri(CI),xI=Fh;function Fh(){this._listeners={}}Fh.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},Fh.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},Fh.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};var BI=Ri(xI),HI=Zy(Zy);function Zy(e){return typeof Float32Array<"u"?(function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=r[3]===128;function s(l,u,g){t[0]=l,u[g]=r[0],u[g+1]=r[1],u[g+2]=r[2],u[g+3]=r[3]}function i(l,u,g){t[0]=l,u[g]=r[3],u[g+1]=r[2],u[g+2]=r[1],u[g+3]=r[0]}e.writeFloatLE=n?s:i,e.writeFloatBE=n?i:s;function o(l,u){return r[0]=l[u],r[1]=l[u+1],r[2]=l[u+2],r[3]=l[u+3],t[0]}function c(l,u){return r[3]=l[u],r[2]=l[u+1],r[1]=l[u+2],r[0]=l[u+3],t[0]}e.readFloatLE=n?o:c,e.readFloatBE=n?c:o})():(function(){function t(n,s,i,o){var c=s<0?1:0;if(c&&(s=-s),s===0)n(1/s>0?0:2147483648,i,o);else if(isNaN(s))n(2143289344,i,o);else if(s>34028234663852886e22)n((c<<31|2139095040)>>>0,i,o);else if(s<11754943508222875e-54)n((c<<31|Math.round(s/1401298464324817e-60))>>>0,i,o);else{var l=Math.floor(Math.log(s)/Math.LN2),u=Math.round(s*Math.pow(2,-l)*8388608)&8388607;n((c<<31|l+127<<23|u)>>>0,i,o)}}e.writeFloatLE=t.bind(null,em),e.writeFloatBE=t.bind(null,tm);function r(n,s,i){var o=n(s,i),c=(o>>31)*2+1,l=o>>>23&255,u=o&8388607;return l===255?u?NaN:c*(1/0):l===0?c*1401298464324817e-60*u:c*Math.pow(2,l-150)*(u+8388608)}e.readFloatLE=r.bind(null,rm),e.readFloatBE=r.bind(null,nm)})(),typeof Float64Array<"u"?(function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=r[7]===128;function s(l,u,g){t[0]=l,u[g]=r[0],u[g+1]=r[1],u[g+2]=r[2],u[g+3]=r[3],u[g+4]=r[4],u[g+5]=r[5],u[g+6]=r[6],u[g+7]=r[7]}function i(l,u,g){t[0]=l,u[g]=r[7],u[g+1]=r[6],u[g+2]=r[5],u[g+3]=r[4],u[g+4]=r[3],u[g+5]=r[2],u[g+6]=r[1],u[g+7]=r[0]}e.writeDoubleLE=n?s:i,e.writeDoubleBE=n?i:s;function o(l,u){return r[0]=l[u],r[1]=l[u+1],r[2]=l[u+2],r[3]=l[u+3],r[4]=l[u+4],r[5]=l[u+5],r[6]=l[u+6],r[7]=l[u+7],t[0]}function c(l,u){return r[7]=l[u],r[6]=l[u+1],r[5]=l[u+2],r[4]=l[u+3],r[3]=l[u+4],r[2]=l[u+5],r[1]=l[u+6],r[0]=l[u+7],t[0]}e.readDoubleLE=n?o:c,e.readDoubleBE=n?c:o})():(function(){function t(n,s,i,o,c,l){var u=o<0?1:0;if(u&&(o=-o),o===0)n(0,c,l+s),n(1/o>0?0:2147483648,c,l+i);else if(isNaN(o))n(0,c,l+s),n(2146959360,c,l+i);else if(o>17976931348623157e292)n(0,c,l+s),n((u<<31|2146435072)>>>0,c,l+i);else{var g;if(o<22250738585072014e-324)g=o/5e-324,n(g>>>0,c,l+s),n((u<<31|g/4294967296)>>>0,c,l+i);else{var y=Math.floor(Math.log(o)/Math.LN2);y===1024&&(y=1023),g=o*Math.pow(2,-y),n(g*4503599627370496>>>0,c,l+s),n((u<<31|y+1023<<20|g*1048576&1048575)>>>0,c,l+i)}}}e.writeDoubleLE=t.bind(null,em,0,4),e.writeDoubleBE=t.bind(null,tm,4,0);function r(n,s,i,o,c){var l=n(o,c+s),u=n(o,c+i),g=(u>>31)*2+1,y=u>>>20&2047,m=4294967296*(u&1048575)+l;return y===2047?m?NaN:g*(1/0):y===0?g*5e-324*m:g*Math.pow(2,y-1075)*(m+4503599627370496)}e.readDoubleLE=r.bind(null,rm,0,4),e.readDoubleBE=r.bind(null,nm,4,0)})(),e}function em(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function tm(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=e&255}function rm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function nm(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var kI=Ri(HI),sm={};(function(e){var t=e;t.length=function(r){for(var n=0,s=0,i=0;i<r.length;++i)s=r.charCodeAt(i),s<128?n+=1:s<2048?n+=2:(s&64512)===55296&&(r.charCodeAt(i+1)&64512)===56320?(++i,n+=4):n+=3;return n},t.read=function(r,n,s){var i=s-n;if(i<1)return"";for(var o=null,c=[],l=0,u;n<s;)u=r[n++],u<128?c[l++]=u:u>191&&u<224?c[l++]=(u&31)<<6|r[n++]&63:u>239&&u<365?(u=((u&7)<<18|(r[n++]&63)<<12|(r[n++]&63)<<6|r[n++]&63)-65536,c[l++]=55296+(u>>10),c[l++]=56320+(u&1023)):c[l++]=(u&15)<<12|(r[n++]&63)<<6|r[n++]&63,l>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,c)),l=0);return o?(l&&o.push(String.fromCharCode.apply(String,c.slice(0,l))),o.join("")):String.fromCharCode.apply(String,c.slice(0,l))},t.write=function(r,n,s){for(var i=s,o,c,l=0;l<r.length;++l)o=r.charCodeAt(l),o<128?n[s++]=o:o<2048?(n[s++]=o>>6|192,n[s++]=o&63|128):(o&64512)===55296&&((c=r.charCodeAt(l+1))&64512)===56320?(o=65536+((o&1023)<<10)+(c&1023),++l,n[s++]=o>>18|240,n[s++]=o>>12&63|128,n[s++]=o>>6&63|128,n[s++]=o&63|128):(n[s++]=o>>12|224,n[s++]=o>>6&63|128,n[s++]=o&63|128);return s-i}})(sm);var LI=Ri(sm),MI=DI;function DI(e,t,r){var n=r||8192,s=n>>>1,i=null,o=n;return function(c){if(c<1||c>s)return e(c);o+c>n&&(i=e(n),o=0);var l=t.call(i,o,o+=c);return o&7&&(o=(o|7)+1),l}}var FI=Ri(MI);function im(e,t,r=!1){for(let n=Object.keys(t),s=0;s<n.length;++s)(e[n[s]]===void 0||!r)&&(e[n[s]]=t[n[s]]);return e}function am(e){function t(r,n){if(!(this instanceof t))return new t(r,n);Object.defineProperty(this,"message",{get:function(){return r}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&im(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}var ke={asPromise:PI,base64:Pu,EventEmitter:BI,float:kI,utf8:LI,pool:FI,emptyArray:Object.freeze?Object.freeze([]):[],emptyBytes:new Uint8Array,emptyObject:Object.freeze?Object.freeze({}):{},isInteger:Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e},isString:function(e){return typeof e=="string"||e instanceof String},isObject:function(e){return e&&typeof e=="object"},get isset(){return this.isSet},isSet(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1},Buffer:(function(){return Jn.Buffer.prototype.utf8Write?Jn.Buffer:null})(),newBuffer:function(e){return typeof e=="number"?ke.Buffer?ke._Buffer_allocUnsafe(e):new ke.Array(e):ke.Buffer?ke._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)},Array:typeof Uint8Array<"u"?Uint8Array:Array,Long:Dt,key2Re:/^true|false|0|1$/,key32Re:/^-?(?:0|[1-9][0-9]*)$/,key64Re:/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,merge:im,lcFirst(e){return e.charAt(0).toLowerCase()+e.substring(1)},newError:am,ProtocolError:am("ProtocolError"),oneOfGetter:function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var n=Object.keys(this),s=n.length-1;s>-1;--s)if(t[n[s]]===1&&this[n[s]]!==void 0&&this[n[s]]!==null)return n[s]}},oneOfSetter:function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},toJSONOptions:{longs:String,enums:String,bytes:String,json:!0},_Buffer_from:null,_Buffer_allocUnsafe:null,_configure2:function(){var e=ke.Buffer;if(!e){ke._Buffer_from=ke._Buffer_allocUnsafe=null;return}ke._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},ke._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}},isReservedId:function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},isReservedName:function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1}},Uh,xi=class aI{constructor(t,r){if(this.name=t,this.options=r,this.resolved=!1,this.comment=null,this.filename=null,!ke.isString(t))throw TypeError("name must be a string");if(r&&!ke.isObject(r))throw TypeError("options must be an object");this.options=r,this.name=t,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}static _configure(t,r,n,s){Uh=t}get root(){let t=this;for(;;)if(t&&t.parent)t=t.parent;else return t}get fullName(){for(var t=[this.name],r=this.parent;r;)t.unshift(r.name),r=r.parent;return t.join(".")}onAdd(t){this.parent&&this.parent!==t&&this.parent.remove(this),this.parent=t,this.resolved=!1;var r=t.root;r instanceof Uh&&r._handleAdd(this)}onRemove(t){var r=t.root;r instanceof Uh&&r._handleRemove(this),this.parent=null,this.resolved=!1}resolve(){return this.resolved?this:(this.root instanceof Uh&&(this.resolved=!0),this)}getOption(t){if(this.options)return this.options[t]}setOption(t,r,n=!1){return(!n||!this.options||this.options[t]===void 0)&&((this.options||(this.options={}))[t]=r),this}setOptions(t,r=!1){if(t)for(let n=Object.keys(t),s=0;s<n.length;++s)this.setOption(n[s],t[n[s]],r);return this}toString(){const t=aI.className,r=this.fullName;return r.length?t+" "+r:t}};xi.className="ReflectionObject";var UI=Hu;function Hu(e,t){typeof e=="string"&&(t=e,e=void 0);var r=[];function n(i){if(typeof i!="string"){var o=s();if(Hu.verbose&&console.log("codegen: "+o),o="return "+o,i){for(var c=Object.keys(i),l=new Array(c.length+1),u=new Array(c.length),g=0;g<c.length;)l[g]=c[g],u[g]=i[c[g++]];return l[g]=o,Function.apply(null,l).apply(null,u)}return Function(o)()}for(var y=new Array(arguments.length-1),m=0;m<y.length;)y[m]=arguments[++m];if(m=0,i=i.replace(/%([%dfijs])/g,function(d,I){var T=y[m++];switch(I){case"d":case"f":return String(Number(T));case"i":return String(Math.floor(T));case"j":return JSON.stringify(T);case"s":return String(T)}return"%"}),m!==y.length)throw Error("parameter count mismatch");return r.push(i),n}function s(i){return"function "+(i||t||"")+"("+(e&&e.join(",")||"")+`){
  `+r.join(`
  `)+`
}`}return n.toString=s,n}Hu.verbose=!1;var $I=Ri(UI),Hr=class xa{constructor(t,r){this.lo=t>>>0,this.hi=r>>>0}static fromNumber(t){if(t===0)return Bi;var r=t<0;r&&(t=-t);var n=t>>>0,s=(t-n)/4294967296>>>0;return r&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new xa(n,s)}static from(t){if(typeof t=="number")return xa.fromNumber(t);if(ke.isString(t))if(ke.Long)t=ke.Long.fromString(t);else return xa.fromNumber(parseInt(t,10));const r=t;return r.low||r.high?new xa(r.low>>>0,r.high>>>0):Bi}toNumber(t=!1){if(!t&&this.hi>>>31){var r=~this.lo+1>>>0,n=~this.hi>>>0;return r||(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toLong(t=!1){return ke.Long?new ke.Long(this.lo|0,this.hi|0,!!t):{low:this.lo|0,high:this.hi|0,unsigned:!!t}}static fromHash(t){if(t===xa.zeroHash)return Bi;const r=String.prototype.charCodeAt;return new xa((r.call(t,0)|r.call(t,1)<<8|r.call(t,2)<<16|r.call(t,3)<<24)>>>0,(r.call(t,4)|r.call(t,5)<<8|r.call(t,6)<<16|r.call(t,7)<<24)>>>0)}toHash(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)}zzEncode(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){var t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){var t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}};Hr.zeroHash="\0\0\0\0\0\0\0\0";var Bi=Hr.zero=new Hr(0,0);Bi.toNumber=function(){return 0},Bi.zzEncode=Bi.zzDecode=function(){return this},Bi.length=function(){return 1},Hr.zeroHash;var om={},cm,pm,hm,VI=0,Ha={_configure:function(e,t,r){cm=e,pm=t,hm=r},decorateType:function(e,t){const r=t||e.name;if(e.hasOwnProperty("$type")||e.$type&&e.$type.name===r)return t&&e.$type.name!==t&&(this.decorateRoot.remove(e.$type),e.$type.name=t,this.decorateRoot.add(e.$type)),e.$type;const n=e.$type,s=new hm(r);return this.decorateRoot.add(s),n&&(Object.setPrototypeOf(s.fields,n.fields),s.oneofs={},n.oneofs||(n.oneofs={}),Object.setPrototypeOf(s.oneofs,n.oneofs)),s.ctor=e,Object.defineProperty(e,"$type",{value:s,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:s,enumerable:!1}),s},decorateEnum:function(e){if(e.$type)return e.$type;const t=new cm("Enum"+VI++,e);return this.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},get decorateRoot(){return om.decorated||(om.decorated=new pm)}},GI=/\\/g,KI=/"/g,jI=/_([a-z])/g,Ee=Object.assign(Ha,ke,{codegen:$I,LongBits:Hr,longToHash(e){return e?Hr.from(e).toHash():Hr.zeroHash},longFromHash(e,t=!1){var r=Hr.fromHash(e);return ke.Long?ke.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},compareFieldsById(e,t){return e.id-t.id},toArray(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},toObject(e){const t={};let r=0;for(;r<e.length;){var n=e[r++],s=e[r++];s!==void 0&&(t[n]=s)}return t},isReserved(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},safeProp(e){return!/^[$\w_]+$/.test(e)||this.isReserved(e)?'["'+e.replace(GI,"\\\\").replace(KI,'\\"')+'"]':"."+e},ucFirst(e){return e.charAt(0).toUpperCase()+e.substring(1)},camelCase(e){return e.substring(0,1)+e.substring(1).replace(jI,function(t,r){return r.toUpperCase()})}}),ur=class oI extends xi{constructor(t,r,n,s,i){if(super(t,n),r&&typeof r!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.keys=[],this.comment=s,this.comments=i||{},this.reserved=void 0,r)for(var o=Object.keys(r),c=0;c<o.length;++c){var l=o[c],u=r[l];typeof u=="number"&&(this.values[l]=u,this.valuesById[u]=l,this.keys.push(l))}}lookupType(t){throw new Error("Method not implemented.")}lookup(){throw new Error("Method not implemented.")}get(){throw new Error("Method not implemented.")}static fromJSON(t,r){const n=new oI(t,r.values,r.options,r.comment,r.comments);return n.reserved=r.reserved,n}toJSON(t){const r=t?!!t.keepComments:!1;return Ee.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",r?this.comment:void 0,"comments",r?this.comments:void 0])}add(t,r,n){if(!Ee.isString(t))throw TypeError("name must be a string");if(!Ee.isInteger(r))throw TypeError("id must be an integer");if(this.values[t]!==void 0)throw Error("duplicate name '"+t+"' in "+this);if(this.isReservedId(r))throw Error("id "+r+" is reserved in "+this);if(this.isReservedName(t))throw Error("name '"+t+"' is reserved in "+this);if(this.valuesById[r]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+r+" in "+this);this.values[t]=r}else this.valuesById[this.values[t]=r]=t,this.keys.push(t);return this.comments[t]=n,this}remove(t){if(!Ee.isString(t))throw TypeError("name must be a string");var r=this.values[t];if(r==null)throw Error("name '"+t+"' does not exist in "+this);return delete this.valuesById[r],delete this.values[t],delete this.comments[t],this}isReservedId(t){return Ee.isReservedId(this.reserved,t)}isReservedName(t){return Ee.isReservedName(this.reserved,t)}};ur.className="Enum";var zI=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function cc(e,t=0){let r=0;const n={};for(t|=0;r<e.length;)n[zI[r+t]]=e[r++];return n}var ka=cc([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),JI=cc([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",ke.emptyBytes,null]),lm=cc([0,0,0,1,1],7),ku=cc([0,0,0,5,5,0,0,0,1,1,0,2],2),Lu=cc([1,5,0,0,0,5,5,0,0,0,1,1,0]),YI=/^required|optional|repeated$/,Mu,Xn=class extends xi{constructor(e,t,r,n,s,i,o){if(Ee.isObject(n)?(o=s,i=n,n=s=void 0):Ee.isObject(s)&&(o=i,i=s,s=void 0),super(e,i),!Ee.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!Ee.isString(r))throw TypeError("type must be a string");if(n!==void 0&&!YI.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(s!==void 0&&!Ee.isString(s))throw TypeError("extend must be a string");this.rule=n&&n!=="optional"?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.optional=n==="optional",this.required=n==="required"||!this.optional,this.repeated=n==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Ee.Long?lm[r]!==void 0:!1,this.bytes=r==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}add(e,t,r){throw new Error("Method not implemented.")}lookupType(e,t,r){throw new Error("Method not implemented.")}lookup(e,t,r){throw new Error("Method not implemented.")}get(e,t,r){throw new Error("Method not implemented.")}static fromJSON(e,t){return new _(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)}get packed(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}setOption(e,t,r=!1){return e==="packed"&&(this._packed=null),super.setOption(e,t,r)}toJSON(e){const t=e?!!e.keepComments:!1;return Ee.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])}resolve(){if(this.resolved)return this;(this.typeDefault=JI[this.type])===void 0&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof Mu?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]);const e=this.options&&this.options.default!=null;if(e&&(this.typeDefault=this.options.default,this.resolvedType instanceof ur&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof ur))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Ee.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){let t;Ee.base64.test(this.typeDefault)?Ee.base64.decode(this.typeDefault,t=Ee.newBuffer(Ee.base64.length(this.typeDefault)),0):Ee.utf8.write(this.typeDefault,t=Ee.newBuffer(Ee.utf8.length(this.typeDefault)),0),this.typeDefault=t}return this.map?this.defaultValue=Ee.emptyObject:this.repeated?this.defaultValue=Ee.emptyArray:!e&&this.optional?this.defaultValue=void 0:this.defaultValue==null&&(this.defaultValue=this.typeDefault),this.parent instanceof Mu&&(this.parent.ctor.prototype[this.name]=this.defaultValue),super.resolve()}static _configure(e){Mu=e}};Xn.className="Field";var _=class cI extends Xn{static d(t,r,n,s){let i;typeof r=="function"?i=Ha.decorateType(r).name:typeof r=="object"?i=Ha.decorateEnum(r).name:i=r;const o=Symbol.for("field");return function(c,l){const u=c.constructor;(u[o]||(u[o]=[])).push(new cI(l,t,i,n,{default:s}))}}},La,Ma,um,Qn=class bn extends xi{constructor(t,r){super(t,r),this._nestedArray=null}static fromJSON(t,r){return new bn(t,r.options).addJSON(r.nested)}static arrayToJSON(t,r){if(!(t&&t.length))return;const n={};for(let s=0;s<t.length;++s)n[t[s].name]=t[s].toJSON(r);return n}static isReservedId(t,r){return Ee.isReservedId(t,r)}static isReservedName(t,r){return Ee.isReservedName(t,r)}get nestedArray(){return this._nestedArray||(this._nestedArray=Ee.toArray(this.nested))}toJSON(t){return Ee.toObject(["options",this.options,"nested",bn.arrayToJSON(this.nestedArray,t)])}addJSON(t){if(t)for(let r=Object.keys(t),n=0,s;n<r.length;++n)s=t[r[n]],this.add((s.fields!==void 0?La.fromJSON:s.values!==void 0?Ma.fromJSON:s.id!==void 0?um.fromJSON:bn.fromJSON)(r[n],s));return this}get(t){return this.nested&&this.nested[t]||null}getEnum(t){if(this.nested&&this.nested[t]instanceof Ma)return this.nested[t].values;throw Error("no such enum: "+t)}add(t){if(!(t instanceof Xn&&t.extend!==void 0||t instanceof La||t instanceof Ma||t instanceof bn))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{const r=this.get(t.name);if(r)if(r instanceof bn&&t instanceof bn&&!(r instanceof La)){const n=r.nestedArray;for(let s=0;s<n.length;++s)t.add(n[s]);this.remove(r),this.nested||(this.nested={}),t.setOptions(r.options,!0)}else throw Error("duplicate name '"+t.name+"' in "+this)}return this.nested[t.name]=t,t.onAdd(this),this._nestedArray=null,this}remove(t){if(!(t instanceof xi))throw TypeError("object must be a ReflectionObject");if(t.parent!==this)throw Error(t+" is not a member of "+this);return this.nested&&(delete this.nested[t.name],Object.keys(this.nested).length||(this.nested=void 0)),t.onRemove(this),this._nestedArray=null,this}define(t,r){if(typeof t=="string")t=t.split(".");else if(!Array.isArray(t))throw TypeError("illegal path");if(t&&t.length&&t[0]==="")throw Error("path must be relative");let n=this;for(;t.length>0;){let s=t.shift();if(n.nested&&n.nested[s]){if(n=n.nested[s],!(n instanceof bn))throw Error("path conflicts with non-namespace objects")}else n.add(n=new bn(s))}return r&&n.addJSON(r),n}resolveAll(){for(var t=this.nestedArray,r=0;r<t.length;)t[r]instanceof bn?t[r++].resolveAll():t[r++].resolve();return this.resolve()}lookup(t,r,n=!1){if(typeof r=="boolean"?(n=r,r=void 0):r&&!Array.isArray(r)&&(r=[r]),Ee.isString(t)&&t.length){if(t===".")return this.root;t=t.split(".")}else if(!t.length)return this;if(t[0]==="")return this.root.lookup(t.slice(1),r);let s=this.get(t[0]);if(s){if(t.length===1){if(!r||r.indexOf(s.constructor)>-1)return s}else if(s instanceof bn&&(s=s.lookup(t.slice(1),r,!0)))return s}else for(let i=0;i<this.nestedArray.length;++i)if(this._nestedArray[i]instanceof bn&&(s=this._nestedArray[i].lookup(t,r,!0)))return s;return this.parent===null||n?null:this.parent.lookup(t,r)}lookupType(t){var r=this.lookup(t,[La]);if(!r)throw Error("no such type: "+t);return r}lookupEnum(t){var r=this.lookup(t,[Ma]);if(!r)throw Error("no such Enum '"+t+"' in "+this);return r}lookupTypeOrEnum(t){const r=this.lookup(t,[La,Ma]);if(!r)throw Error("no such Type or Enum '"+t+"' in "+this);return r}static _configure(t,r,n){La=t,Ma=r,um=n}};Qn.className="Namespace";var Da=class $y extends xi{constructor(t,r,n,s){if(Array.isArray(r)||(n=r,r=void 0),super(t,n),!(r===void 0||Array.isArray(r)))throw TypeError("fieldNames must be an Array");this.oneof=r||[],this.fieldsArray=[],this.comment=s}lookup(t,r,n){throw new Error("Method not implemented.")}lookupType(t,r,n){throw new Error("Method not implemented.")}get(t){throw new Error("Method not implemented.")}static fromJSON(t,r){return new $y(t,r.oneof,r.options,r.comment)}toJSON(t){var r=t?!!t.keepComments:!1;return Ee.toObject(["options",this.options,"oneof",this.oneof,"comment",r?this.comment:void 0])}add(t){const r=this;if(!(t instanceof Xn))throw TypeError("field must be a Field");return t.parent&&t.parent!==this.parent&&t.parent.remove(t),this.oneof.push(t.name),this.fieldsArray.push(t),t.partOf=r,gm(r),this}remove(t){if(!(t instanceof Xn))throw TypeError("field must be a Field");var r=this.fieldsArray.indexOf(t);if(r<0)throw Error(t+" is not a member of "+this);return this.fieldsArray.splice(r,1),r=this.oneof.indexOf(t.name),r>-1&&this.oneof.splice(r,1),t.partOf=null,this}onAdd(t){super.onAdd(t);for(var r=0;r<this.oneof.length;++r){var n=t.get(this.oneof[r]);n&&!n.partOf&&(n.partOf=this,this.fieldsArray.push(n))}gm(this)}onRemove(t){for(var r=0,n;r<this.fieldsArray.length;++r)(n=this.fieldsArray[r]).parent&&n.parent.remove(n);super.onRemove(t)}static d(...t){let r=new Array(arguments.length),n=0;for(;n<arguments.length;)r[n]=arguments[n++];const s=Symbol.for("field");return function(i,o){const c=i.constructor;(c[s]||(c[s]=[])).push(new $y(o,r)),Object.defineProperty(i,o,{get:Ee.oneOfGetter(r),set:Ee.oneOfSetter(r)})}}};Da.className="OneOf";function gm(e){if(e.parent)for(let t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}var $h=/^[A-Z]/,fm,Fa=class pI extends Qn{constructor(t){super("",t),this.deferred=[],this.files=[]}static fromJSON(t,r){return r||(r=new pI),t.options&&r.setOptions(t.options),r.addJSON(t.nested)}resolveAll(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(t){return"'extend "+t.extend+"' in "+t.parent.fullName}).join(", "));return super.resolveAll()}_handleAdd(t){const r=t;if(t instanceof Xn)t.extend!==void 0&&!t.extensionField&&(dm(this,t)||this.deferred.push(t));else if(t instanceof ur)$h.test(t.name)&&(r.parent[t.name]=t.values);else if(!(t instanceof Da)){if(t instanceof fm)for(var n=0;n<this.deferred.length;)dm(this,this.deferred[n])?this.deferred.splice(n,1):++n;for(var s=0;s<r.nestedArray.length;++s)this._handleAdd(r._nestedArray[s]);$h.test(t.name)&&(r.parent[t.name]=t)}}_handleRemove(t){const r=t;if(t instanceof Xn){if(t.extend!==void 0)if(t.extensionField)r.extensionField.parent.remove(t.extensionField),t.extensionField=null;else{var n=this.deferred.indexOf(t);n>-1&&this.deferred.splice(n,1)}}else if(t instanceof ur)$h.test(t.name)&&delete r.parent[t.name];else if(t instanceof Qn){const i=t;for(var s=0;s<t.nestedArray.length;++s)this._handleRemove(i._nestedArray[s]);$h.test(t.name)&&delete i.parent[t.name]}}static _configure(t){fm=t}};Fa.className="Root";function dm(e,t){const r=t.parent.lookup(t.extend);if(r){const n=new _(t.fullName,t.id,t.type,t.rule,void 0,t.options);return n.declaringField=t,t.extensionField=n,r.add(n),!0}return!1}var kr=class Vy extends Xn{constructor(t,r,n,s,i,o){if(super(t,r,s,void 0,void 0,i,o),this.map=!0,!Ee.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}static fromJSON(t,r){return new Vy(t,r.id,r.keyType,r.type,r.options,r.comment)}toJSON(t){const r=t?!!t.keepComments:!1;return Ee.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",r?this.comment:void 0])}resolve(){if(this.resolved)return this;if(ku[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return super.resolve()}static d(t,r,n){let s;typeof n=="function"?s=Ha.decorateType(n).name:typeof n=="object"?s=Ha.decorateEnum(n).name:s=n;var i=Symbol.for("field");return function(o,c){const l=o.constructor;var u=l[i]||(l[i]=[]);u.push(new Vy(c,t,r,s))}}};kr.className="MapField";var J=class{constructor(e){if(e){const t=Object.keys(e);for(const r of t)this[r]=e[r]}}getBytes(){return this.$type.encode(this).finish()}static create(e){return this.$type.create(e)}static encode(e,t){return this.$type.encode(e,t)}static encodeDelimited(e,t){return this.$type.encodeDelimited(e,t)}static decode(e){return this.$type.decode(e)}static decodeDelimited(e){return this.$type.decodeDelimited(e)}static verify(e){return this.$type.verify(e)}static fromObject(e){return this.$type.fromObject(e)}static toObject(e,t=ke.toJSONOptions){return this.$type.toObject(e,t)}toObject(){return this.$type.toObject(this,ke.toJSONOptions)}toJSON(){return this.$type.toObject(this,{defaults:!0})}clone(){return this.$type.decode(this.$type.encode(this).finish())}},ym,XI=ke.utf8;function wn(e,t){return new RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}var mm=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Nn(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Nn(e);throw Error("illegal buffer")},Nn=class hI{constructor(t){this.pos=0,this.uint32=(function(){let r=4294967295;return function(){if(r=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(r=(r|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(r=(r|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(r=(r|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(r=(r|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return r;if((this.pos+=5)>this.len)throw this.pos=this.len,wn(this,10);return r}})(),this._slice=ke.Array.prototype.subarray||ke.Array.prototype.slice,this.buf=t,this.len=t.length}int32(){return this.uint32()|0}sint32(){const t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw wn(this,4);return Vh(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw wn(this,4);return Vh(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw wn(this,4);var t=ke.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw wn(this,4);var t=ke.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t}bytes(){const t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw wn(this,t);if(this.pos+=t,Array.isArray(this.buf))return this.buf.slice(r,n);if(r===n){const s=this.buf.constructor;return new s(0)}return this._slice.call(this.buf,r,n)}string(){const t=this.bytes();return XI.read(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw wn(this,t);this.pos+=t}else do if(this.pos>=this.len)throw wn(this);while(this.buf[this.pos++]&128);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this}static _configure(t){ym=t;const r=ke.Long?"toLong":"toNumber";ke.merge(hI.prototype,{int64:function(){return Du.call(this)[r](!1)},uint64:function(){return Du.call(this)[r](!0)},sint64:function(){return Du.call(this).zzDecode()[r](!1)},fixed64:function(){return _m.call(this)[r](!0)},sfixed64:function(){return _m.call(this)[r](!1)}})}};Nn.create=ke.Buffer?function(e){return(Nn.create=function(t){return ke.Buffer.isBuffer(t)?new ym(t):mm(t)})(e)}:mm;function Vh(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Du(){var e=new Hr(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw wn(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw wn(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function _m(){if(this.pos+8>this.len)throw wn(this,8);return new Hr(Vh(this.buf,this.pos+=4),Vh(this.buf,this.pos+=4))}var Am,pc=class{constructor(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}fn(e,t,r){}};function Fu(){}var QI=class{constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}},Is=class lI{constructor(){this.len=0,this.head=new pc(Fu,0,0),this.tail=this.head,this.states=null}static alloc(t){return new ke.Array(t)}_push(t,r,n){return this.tail=this.tail.next=new pc(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new qI((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push($u,10,Hr.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){var r=Hr.from(t);return this._push($u,r.length(),r)}int64(t){return this.uint64(t)}sint64(t){var r=Hr.from(t).zzEncode();return this._push($u,r.length(),r)}bool(t){return this._push(Uu,1,t?1:0)}fixed32(t){return this._push(Vu,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){var r=Hr.from(t);return this._push(Vu,4,r.lo)._push(Vu,4,r.hi)}sfixed64(t){return this.fixed64(t)}float(t){return this._push(ke.float.writeFloatLE,4,t)}double(t){return this._push(ke.float.writeDoubleLE,8,t)}bytes(t){var r=t.length>>>0;if(!r)return this._push(Uu,1,0);if(ke.isString(t)){var n=lI.alloc(r=ke.base64.length(t));ke.base64.decode(t,n,0),t=n}return this.uint32(r)._push(WI,r,t)}string(t){var r=ke.utf8.length(t);return r?this.uint32(r)._push(ke.utf8.write,r,t):this._push(Uu,1,0)}fork(){return this.states=new QI(this),this.head=this.tail=new pc(Fu,0,0),this.len=0,this}reset(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new pc(Fu,0,0),this.len=0),this}ldelim(){var t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){for(var t=this.head.next,r=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}static _configure(t){Am=t}};Is.create=ke.Buffer?function(){return(Is.create=function(){return new Am})()}:function(){return new Is},ke.Array!==Array&&(Is.alloc=ke.pool(Is.alloc,ke.Array.prototype.subarray));function Uu(e,t,r){t[r]=e&255}function Im(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var qI=class extends pc{constructor(e,t){super(Im,e,t),this.len=e,this.next=void 0,this.val=t}fn(e,t,r){return Im(e,t,r)}};function $u(e,t,r){for(;e.hi;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function Vu(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function WI(e,t,r){t.set(e,r)}function Em(e,t,r,n){return t.resolvedType.group?e("%s&&types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("%s&&types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,r,n,(t.id<<3|2)>>>0)}function ZI(e){var t=Ee.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),r,n=e.fieldsArray.slice().sort(Ee.compareFieldsById);if(e._fieldsArray instanceof Array)for(let s=0;s<n.length;++s){const i=n[s].resolve(),o=e._fieldsArray.indexOf(i),c=i.resolvedType instanceof ur?"int32":i.type,l=ka[c];if(r="m"+Ee.safeProp(i.name),i.map)t("if(%s!=null){",r)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(i.id<<3|2)>>>0,8|ku[i.keyType],i.keyType),l===void 0?t("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):t(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,c,r),t("}")("}");else if(i.repeated)t("if(%s!=null&&%s.length){",r,r),i.packed&&Lu[c]!==void 0?t("w.uint32(%i).fork()",(i.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",c,r)("w.ldelim()"):(t("for(var i=0;i<%s.length;++i)",r),l===void 0?Em(t,i,o,r+"[i]"):t("w.uint32(%i).%s(%s[i])",(i.id<<3|l)>>>0,c,r)),t("}");else if(c==="bytes")t("if(%s!=null&&%s.length)",r,r),t("w.uint32(%i).%s(%s)",(i.id<<3|l)>>>0,c,r);else{if(c.endsWith("64"))if(i.defaultValue){const{unsigned:u,high:g,low:y}=i.defaultValue;t(`if(${r}!=null && 
                   (  ${u}!==${r}.unsigned
                   || ${g}!==${r}.high
                   || ${y}!==${r}.low
                   )
                 )`)}else t(`if(${r}!=null)`);else t("if(%s!=null&&%s!==%j)",r,r,i.defaultValue);l===void 0?Em(t,i,o,r):t("w.uint32(%i).%s(%s)",(i.id<<3|l)>>>0,c,r)}}return t("return w")}function eE(e){return"missing required '"+e.name+"'"}function tE(e){var t=Ee.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(c){return c.map}).length?",k":"")),r=0;if(e._fieldsArray instanceof Array){for(;r<e.fieldsArray.length;++r){var n=e._fieldsArray[r].resolve();n.repeated?t("%s=[]","m"+Ee.safeProp(n.name)):n.map&&t("%s={}","m"+Ee.safeProp(n.name))}for(t("while(r.pos<c){")("var t=r.uint32()"),e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){var n=e._fieldsArray[r].resolve(),s=n.resolvedType instanceof ur?"int32":n.type,i="m"+Ee.safeProp(n.name);t("case %i:",n.id);const l=n.resolvedType;n.map?(t("r.skip().pos++")("k=r.%s()",n.keyType)("r.pos++"),lm[n.keyType]!==void 0?ka[s]===void 0?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',i,r):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',i,s):ka[s]===void 0?t("%s[k]=types[%i].decode(r,r.uint32())",i,r):t("%s[k]=r.%s()",i,s)):n.repeated?(Lu[s]!==void 0&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",i,s)("}else"),ka[s]===void 0?t(l.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",i,r):t("%s.push(r.%s())",i,s)):ka[s]===void 0?t(l.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",i,r):t("%s=r.%s()",i,s),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var o=e._fieldsArray[r];o.required&&t("if(m.%s==null)",o.name)("throw util.ProtocolError(%j,{instance:m})",eE(o))}}return t("return m")}function un(e,t){return e.name+": "+t+(e.repeated&&t!=="array"?"[]":e.map&&t!=="object"?"{k:"+e.keyType+"}":"")+" expected"}function Gu(e,t,r,n){if(t.resolvedType)if(t.resolvedType instanceof ur){e("switch(%s){",n)("default:")("return%j",un(t,"enum value"));for(var s=Object.keys(t.resolvedType.values),i=0;i<s.length;++i)e("case %i:",t.resolvedType.values[s[i]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,n)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",n)("return%j",un(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",n,n,n,n)("return%j",un(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',n)("return%j",un(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',n)("return%j",un(t,"boolean"));break;case"string":e("if(!util.isString(%s))",n)("return%j",un(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',n,n,n)("return%j",un(t,"buffer"));break}return e}function rE(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",un(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",un(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",un(t,"boolean key"));break}return e}function nE(e){var t=Ee.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};if(r.length&&t("var p={}"),e._fieldsArray instanceof Array)for(var s=0;s<e.fieldsArray.length;++s){var i=e._fieldsArray[s].resolve(),o="m"+Ee.safeProp(i.name);if(i.optional&&t("if(%s!=null){",o),i.map)t("if(!util.isObject(%s))",o)("return%j",un(i,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),rE(t,i,"k[i]"),Gu(t,i,s,o+"[k[i]]")("}");else if(i.repeated)t("if(!Array.isArray(%s))",o)("return%j",un(i,"array"))("for(var i=0;i<%s.length;++i){",o),Gu(t,i,s,o+"[i]")("}");else{if(i.partOf){var c=Ee.safeProp(i.partOf.name);n[i.partOf.name]===1&&t("if(p%s===1)",c)("return%j",i.partOf.name+": multiple values"),n[i.partOf.name]=1,t("p%s=1",c)}Gu(t,i,s,o)}i.optional&&t("}")}return t("return null")}function Gh(e,t,r,n){if(t.resolvedType)if(t.resolvedType instanceof ur){e("switch(d%s){",n);let s=t.resolvedType.values,i=t.resolvedType.keys,o=0;for(;o<i.length;++o)t.repeated&&s[i[o]]===t.typeDefault&&e("default:"),e("case%j:",i[o])("case %i:",s[i[o]])("m%s=%j",n,s[i[o]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i]._ctor.fromObject(d%s)",n,r,n);else{let s=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,s)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,s?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n);break}}return e}function Ku(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof ur?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{let s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n);break}}return e}var Tm={fromObject(e){const t=e.fieldsArray,r=Ee.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(let n=0;n<t.length;++n){const s=t[n].resolve(),i=Ee.safeProp(s.name);s.map?(r("m%s={}",i)("if(d%s){",i)('if(typeof d%s!=="object")',i)("throw TypeError(%j)",s.fullName+": object expected")("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",i),Gh(r,s,n,i+"[ks[i]]")("}")("}")):s.repeated?(r("m%s=[]",i)("if(d%s){",i)("if(!Array.isArray(d%s))",i)("throw TypeError(%j)",s.fullName+": array expected")("for(var i=0;i<d%s.length;++i){",i),Gh(r,s,n,i+"[i]")("}")("}")):s.resolvedType instanceof ur?Gh(r,s,n,i):(s.resolvedType&&s.required&&(r("if(d%s==null)",i),r("d%s={}",i)),r("if(d%s!=null){",i),Gh(r,s,n,i),r("}"))}return r("return m")},toObject(e){const t=e.fieldsArray.slice().sort(Ee.compareFieldsById);if(!t.length)return Ee.codegen()("return {}");const r=Ee.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],s=[],i=[];let o=0;for(;o<t.length;++o)t[o].partOf||(t[o].resolve().repeated?n:t[o].map?s:i).push(t[o]);if(n.length){for(r("if(o.arrays||o.defaults){"),o=0;o<n.length;++o)r("d%s=[]",Ee.safeProp(n[o].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),o=0;o<s.length;++o)r("d%s={}",Ee.safeProp(s[o].name));r("}")}if(i.length){for(r("if(o.defaults){"),o=0;o<i.length;++o){const l=i[o],u=Ee.safeProp(l.name);if(l.resolvedType instanceof ur)r("d%s=o.enums===String?%j:%j",u,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",u)("}else")("d%s=o.longs===String?%j:%i",u,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){const g="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",u,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",u,g)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",u,u)("}")}else r("d%s=%j",u,l.typeDefault)}r("}")}let c=!1;for(o=0;o<t.length;++o){let l=t[o],u=e._fieldsArray.indexOf(l),g=Ee.safeProp(l.name);l.map?(c||(c=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",g,g)("d%s={}",g)("for(var j=0;j<ks2.length;++j){"),Ku(r,l,u,g+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",g,g)("d%s=[]",g)("for(var j=0;j<m%s.length;++j){",g),Ku(r,l,u,g+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",g,l.name),Ku(r,l,u,g),l.partOf&&r("if(o.oneofs)")("d%s=%j",Ee.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}},Sm=Symbol("bindThisProps");function Me(e,t,r){if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${t}> is not a method!`);return{configurable:!0,get(){let n=this[Sm];if(n&&n.has(t))return r.value;const s=r.value.bind(this);return Object.defineProperty(this,t,{value:s,configurable:!0,writable:!0}),n||(n=this[Sm]=new Set),n.add(t),s}}}var bm=Symbol("CACHE_GETTER_KEYS_STORE");function wm(e){let t=Reflect.get(e,bm);return t||(t=new Map,Reflect.set(e,bm,t)),t}function sE(e,t){const r=wm(e);let n=r.get(t);return n||(n=Symbol(`[${typeof t}]${String(t)}`),r.set(t,n)),n}function ie(e,t,r){if(typeof r.get!="function")throw new TypeError(`property ${String(t)} must has an getter function.`);const n=r.get,s=sE(e,t),i=function(){if(s in this)return this[s].value;{const o=n.call(this),c={target:this,value:o,sourceFun:n};if(this[s]=c,r.set===void 0)try{Object.defineProperty(this,t,{value:o,writable:!1,configurable:!0,enumerable:r.enumerable})}catch(l){console.error(l)}return o}};return Reflect.set(i,"source_fun",n),r.get=i,r}function iE(e){const t=wm(e);for(const[r,n]of t)aE(e,r,n)}function aE(e,t,r){const n=Reflect.get(e,r);return n===void 0||Reflect.deleteProperty(n.target,r)!==!1&&(Reflect.deleteProperty(n.target,t),!0)}var ju=class{constructor(e=Math.random().toString(36).slice(2)){this.pid=e,this.CLASS_PROTO_ARRAYDATA_POOL=new Map,this.PA_ID_VALUE=0,this.PA_ID_KEY=Symbol(`@PAID:${e}`)}get(e,t){const r=new Set,n=this.CLASS_PROTO_ARRAYDATA_POOL.get(t);if(n)do if(e.hasOwnProperty(this.PA_ID_KEY)){const s=n.get(e[this.PA_ID_KEY]);if(s)for(const i of s)r.add(i)}while(e=Object.getPrototypeOf(e));return r}add(e,t,r){let n=this.CLASS_PROTO_ARRAYDATA_POOL.get(t);n||(n=new Map,this.CLASS_PROTO_ARRAYDATA_POOL.set(t,n));const s=e.hasOwnProperty(this.PA_ID_KEY)?e[this.PA_ID_KEY]:e[this.PA_ID_KEY]=Symbol(`@PAID:${this.pid}#${this.PA_ID_VALUE++}`);let i=n.get(s);i?i.push(r):(i=[r],n.set(s,i))}remove(e,t,r){const n=this.CLASS_PROTO_ARRAYDATA_POOL.get(t);if(n)do{if(!e.hasOwnProperty(this.PA_ID_KEY))break;const s=e[this.PA_ID_KEY],i=n.get(s);if(!i)return;const o=i.indexOf(r);if(o!==-1)return void i.splice(o,1)}while(e=Object.getPrototypeOf(e))}};p([Me,h("design:type",Function),h("design:paramtypes",[Object,Object]),h("design:returntype",void 0)],ju.prototype,"get",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object,Object,Object]),h("design:returntype",void 0)],ju.prototype,"add",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object,Object,Object]),h("design:returntype",void 0)],ju.prototype,"remove",null);var zu=e=>{},oE=(e=>(e[e.WAIT_RESULT_RETURN=0]="WAIT_RESULT_RETURN",e[e.NO_WAIT_EXEC_TIME=1]="NO_WAIT_EXEC_TIME",e))(oE||{}),C=class vu extends Qn{constructor(t,r){super(t,r),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}get fieldsById(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var t=Object.keys(this.fields),r=0;r<t.length;++r){var n=this.fields[t[r]],s=n.id;if(this._fieldsById[s])throw Error("duplicate id "+s+" in "+this);this._fieldsById[s]=n}return this._fieldsById}get fieldsArray(){var t=this._fieldsArray;if(!t){t=[];for(var r in this.fields)t.push(this.fields[r]);this._fieldsArray=t}return t}get oneofsArray(){var t=this._oneofsArray;if(!t){t=[];for(var r in this.oneofs)t.push(this.oneofs[r]);this._oneofsArray=t}return t}get ctor(){return this._ctor||(this.ctor=vu.generateConstructor(this)())}set ctor(t){const r=t.prototype;r instanceof J||((t.prototype=new J).constructor=t,Ee.merge(t.prototype,r)),t.$type=this,Ee.merge(t,J,!0),this._ctor=t;let n=0;if(this._fieldsArray)for(;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();const s={};if(this._oneofsArray)for(n=0;n<this.oneofsArray.length;++n)s[this._oneofsArray[n].resolve().name]={get:Ee.oneOfGetter(this._oneofsArray[n].oneof),set:Ee.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(t.prototype,s)}static generateConstructor(t){for(var r=Ee.codegen(["p"],t.name),n=0,s;n<t.fieldsArray.length;++n)(s=t._fieldsArray[n]).map?r("this%s={}",Ee.safeProp(s.name)):s.repeated&&r("this%s=[]",Ee.safeProp(s.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")}static fromJSON(t,r){const n=new vu(t,r.options);n.extensions=r.extensions,n.reserved=r.reserved;let s=Object.keys(r.fields),i=0;for(;i<s.length;++i)n.add((typeof r.fields[s[i]].keyType<"u"?kr.fromJSON:_.fromJSON)(s[i],r.fields[s[i]]));if(r.oneofs)for(s=Object.keys(r.oneofs),i=0;i<s.length;++i)n.add(Da.fromJSON(s[i],r.oneofs[s[i]]));if(r.nested)for(s=Object.keys(r.nested),i=0;i<s.length;++i){const o=r.nested[s[i]];n.add((o.id!==void 0?_.fromJSON:o.fields!==void 0?vu.fromJSON:o.values!==void 0?ur.fromJSON:Qn.fromJSON)(s[i],o))}return r.extensions&&r.extensions.length&&(n.extensions=r.extensions),r.reserved&&r.reserved.length&&(n.reserved=r.reserved),r.group&&(n.group=!0),r.comment&&(n.comment=r.comment),n}toJSON(t){const r=super.toJSON(t),n=t?!!t.keepComments:!1;return Ee.toObject(["options",r&&r.options||void 0,"oneofs",Qn.arrayToJSON(this.oneofsArray,t),"fields",Qn.arrayToJSON(this.fieldsArray.filter(function(s){return!s.declaringField}),t)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",r&&r.nested||void 0,"comment",n?this.comment:void 0])}resolveAll(){for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();var n=this.oneofsArray;for(r=0;r<n.length;)n[r++].resolve();return super.resolveAll()}get(t){return this.fields[t]||this.oneofs&&this.oneofs[t]||this.nested&&this.nested[t]||null}add(t){const r=this;if(this.get(t.name))throw Error("duplicate name '"+t.name+"' in "+this);if(t instanceof Xn&&t.extend===void 0){if(this._fieldsById?this._fieldsById[t.id]:this.fieldsById[t.id])throw Error("duplicate id "+t.id+" in "+this);if(this.isReservedId(t.id))throw Error("id "+t.id+" is reserved in "+this);if(this.isReservedName(t.name))throw Error("name '"+t.name+"' is reserved in "+this);return t.parent&&t.parent.remove(t),this.fields[t.name]=t,t.message=r,t.onAdd(r),Kh(this)}return t instanceof Da?(this.oneofs||(this.oneofs={}),this.oneofs[t.name]=t,t.onAdd(r),Kh(this)):super.add(t)}remove(t){const r=this;if(t instanceof Xn&&t.extend===void 0){if(!this.fields||this.fields[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.fields[t.name],t.parent=null,t.onRemove(r),Kh(this)}if(t instanceof Da){if(!this.oneofs||this.oneofs[t.name]!==t)throw Error(t+" is not a member of "+this);return delete this.oneofs[t.name],t.parent=null,t.onRemove(r),Kh(this)}return super.remove(t)}isReservedId(t){return Qn.isReservedId(this.reserved,t)}isReservedName(t){return Qn.isReservedName(this.reserved,t)}create(t){return new this.ctor(t)}get _types(){if(!this._fieldsArray)throw new ReferenceError;const t=[];for(const r of this._fieldsArray)t.push(r.resolve().resolvedType);return t}setup(){const t=this;this.fullName;for(var r=[],n=0;n<this.fieldsArray.length;++n){const i=this._fieldsArray;r.push(i[n].resolve().resolvedType)}const s=ZI;return this.encode=s(t)({Writer:Is,types:r,util:Ee}),this.decode=tE(t)({Reader:Nn,types:r,util:Ee}),this.verify=nE(t)({types:r,util:Ee}),this.fromObject=Tm.fromObject(t)({types:r,util:Ee}),this}encode(t,r){return this.setup().encode(t,r)}encodeDelimited(t,r){return this.encode(t,r&&r.len?r.fork():r).ldelim()}decode(t,r){return this.setup().decode(t,r)}decodeDelimited(t){return t instanceof Nn||(t=Nn.create(t)),this.decode(t,t.uint32())}verify(t){return this.setup().verify(t)}fromObject(t){return this.setup().fromObject(t)}get toObject(){return Tm.toObject(this)({types:this._types,util:Ee})}static d(t){const r=Symbol.for("field");return function(n){const s=Ha.decorateType(n,t),i=n[r];if(i)for(let o=0,c;c=i[o];o+=1)s.add(c);delete n[r]}}};C.className="Type",p([ie,h("design:type",Object),h("design:paramtypes",[])],C.prototype,"toObject",null);function Kh(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,Reflect.deleteProperty(e,"encode"),Reflect.deleteProperty(e,"decode"),Reflect.deleteProperty(e,"verify"),e}var Nm=class extends Nn{constructor(e){super(e)}string(){const e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}};ke.Buffer&&(Nm.prototype._slice=ke.Buffer.prototype.slice);var jh=ke.Buffer,cE=class uI extends Is{constructor(){super()}static alloc(t){return(uI.alloc=ke._Buffer_allocUnsafe)(t)}bytes(t){ke.isString(t)&&(t=ke._Buffer_from(t,"base64"));var r=t.length>>>0;return this.uint32(r),r&&this._push(pE,r,t),this}string(t){var r=jh.byteLength(t);return this.uint32(r),r&&this._push(hE,r,t),this}},pE=jh&&jh.prototype instanceof Uint8Array&&jh.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]};function hE(e,t,r){e.length<40?ke.utf8.write(e,t,r):t.utf8Write(e,r)}var Ju=/[\s{}=;:[\],'"()<>]/g,lE=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,uE=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,gE=/^ *[*/]+ */,fE=/^\s*\*?\/*/,dE=/\n/g,yE=/\s/,mE=/\\(.?)/g,_E={0:"\0",r:"\r",n:`
`,t:"	"};function Om(e){return e.replace(mE,function(t,r){switch(r){case"\\":case"":return r;default:return _E[r]||""}})}vm.unescape=Om;function vm(e,t){e=e.toString();var r=0,n=e.length,s=1,i=null,o=null,c=0,l=!1,u=[],g=null;function y(D){return Error("illegal "+D+" (line "+s+")")}function m(){var D=g==="'"?uE:lE;D.lastIndex=r-1;var L=D.exec(e);if(!L)throw y("string");return r=D.lastIndex,b(g),g=null,Om(L[1])}function d(D){return e.charAt(D)}function I(D,L){i=e.charAt(D++),c=s,l=!1;var z;t?z=2:z=3;var Y=D-z,x;do if(--Y<0||(x=e.charAt(Y))===`
`){l=!0;break}while(x===" "||x==="	");for(var H=e.substring(D,L).split(dE),M=0;M<H.length;++M)H[M]=H[M].replace(t?fE:gE,"").trim();o=H.join(`
`).trim()}function T(D){var L=S(D),z=e.substring(D,L),Y=/^\s*\/{1,2}/.test(z);return Y}function S(D){for(var L=D;L<n&&d(L)!==`
`;)L++;return L}function w(){if(u.length>0)return u.shift();if(g)return m();var D,L,z,Y,x;do{if(r===n)return null;for(D=!1;yE.test(z=d(r));)if(z===`
`&&++s,++r===n)return null;if(d(r)==="/"){if(++r===n)throw y("comment");if(d(r)==="/")if(t){if(Y=r,x=!1,T(r)){x=!0;do{if(r=S(r),r===n)break;r++}while(T(r))}else r=Math.min(n,S(r)+1);x&&I(Y,r),s++,D=!0}else{for(x=d(Y=r+1)==="/";d(++r)!==`
`;)if(r===n)return null;++r,x&&I(Y,r-1),++s,D=!0}else if((z=d(r))==="*"){Y=r+1,x=t||d(Y)==="*";do{if(z===`
`&&++s,++r===n)throw y("comment");L=z,z=d(r)}while(L!=="*"||z!=="/");++r,x&&I(Y,r-2),D=!0}else return"/"}}while(D);var H=r;Ju.lastIndex=0;var M=Ju.test(d(H++));if(!M)for(;H<n&&!Ju.test(d(H));)++H;var F=e.substring(r,r=H);return(F==='"'||F==="'")&&(g=F),F}function b(D){u.push(D)}function R(){if(!u.length){var D=w();if(D===null)return null;b(D)}return u[0]}function v(D,L=!1){var z=R(),Y=z===D;if(Y)return w(),!0;if(!L)throw y("token '"+z+"', '"+D+"' expected");return!1}function $(D){var L=null;return D===void 0?c===s-1&&(t||i==="*"||l)&&(L=o):(c<D&&R(),c===D&&!l&&(t||i==="/")&&(L=o)),L}return Object.defineProperty({next:w,peek:R,push:b,skip:v,cmnt:$},"line",{get:function(){return s}})}Object.defineProperty(Js,"filename",{value:null}),Js.defaults={keepCase:!1};var AE=/^[1-9][0-9]*$/,IE=/^-?[1-9][0-9]*$/,EE=/^0[x][0-9a-fA-F]+$/,TE=/^-?0[x][0-9a-fA-F]+$/,SE=/^0[0-7]+$/,bE=/^-?0[0-7]+$/,wE=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,js=/^[a-zA-Z_][a-zA-Z_0-9]*$/,zs=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,NE=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Js(e,t,r){t instanceof Fa||(r=t,t=new Fa),r||(r=Js.defaults);var n=vm(e,r.alternateCommentMode||!1),s=n.next,i=n.push,o=n.peek,c=n.skip,l=n.cmnt,u=!0,g,y,m,d,I=!1,T=t,S=r.keepCase?function(q){return q}:Ee.camelCase;function w(q,ee,ae){var se=Object.getOwnPropertyDescriptor(Js,"filename");return ae||Object.defineProperty(Js,"filename",{value:null}),Error("illegal "+(ee||"token")+" '"+q+"' ("+(se?se+", ":"")+"line "+n.line+")")}function b(){var q=[],ee;do{if((ee=s())!=='"'&&ee!=="'")throw w(ee);q.push(s()),c(ee),ee=o()}while(ee==='"'||ee==="'");return q.join("")}function R(q){var ee=s();switch(ee){case"'":case'"':return i(ee),b();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return $(ee,!0)}catch{if(zs.test(ee))return ee;throw w(ee,"value")}}function v(q,ee){var ae,se;do ee&&((ae=o())==='"'||ae==="'")?q.push(b()):q.push([se=D(s()),c("to",!0)?D(s()):se]);while(c(",",!0));c(";")}function $(q,ee){var ae=1;switch(q.charAt(0)==="-"&&(ae=-1,q=q.substring(1)),q){case"inf":case"INF":case"Inf":return ae*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(AE.test(q))return ae*parseInt(q,10);if(EE.test(q))return ae*parseInt(q,16);if(SE.test(q))return ae*parseInt(q,8);if(wE.test(q))return ae*parseFloat(q);throw w(q,"number",ee)}function D(q,ee){switch(q){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!ee&&q.charAt(0)==="-")throw w(q,"id");if(IE.test(q))return parseInt(q,10);if(TE.test(q))return parseInt(q,16);if(bE.test(q))return parseInt(q,8);throw w(q,"id")}function L(){if(g!==void 0)throw w("package");if(g=s(),!zs.test(g))throw w(g,"name");T=T.define(g),c(";")}function z(){var q=o(),ee;switch(q){case"weak":ee=m||(m=[]),s();break;case"public":s();default:ee=y||(y=[]);break}q=b(),c(";"),ee.push(q)}function Y(){if(c("="),d=b(),I=d==="proto3",!I&&d!=="proto2")throw w(d,"syntax");c(";")}function x(q,ee){switch(ee){case"option":return ge(q,ee),c(";"),!0;case"message":return M(q,ee),!0;case"enum":return Te(q,ee),!0;case"extend":return xe(q,ee),!0}return!1}function H(q,ee,ae){var se=n.line;if(q&&(q.comment=l(),q.filename=Object.getOwnPropertyDescriptor(Js,"filename")),c("{",!0)){for(var we;(we=s())!=="}";)ee(we);c(";",!0)}else ae&&ae(),c(";"),q&&typeof q.comment!="string"&&(q.comment=l(se))}function M(q,ee){if(!js.test(ee=s()))throw w(ee,"type name");var ae=new C(ee);H(ae,function(se){if(!x(ae,se))switch(se){case"map":X(ae);break;case"required":case"optional":case"repeated":F(ae,se);break;case"oneof":ye(ae,se);break;case"extensions":v(ae.extensions||(ae.extensions=[]));break;case"reserved":v(ae.reserved||(ae.reserved=[]),!0);break;default:if(!I||!zs.test(se))throw w(se);i(se),F(ae,"optional");break}}),q.add(ae)}function F(q,ee,ae){var se=s();if(se==="group"){K(q,ee);return}if(!zs.test(se))throw w(se,"type");var we=s();if(!js.test(we))throw w(we,"name");we=S(we),c("=");var De=new _(we,D(s()),se,ee,ae);H(De,function(Ke){if(Ke==="option")ge(De,Ke),c(";");else throw w(Ke)},function(){pe(De)}),q.add(De),!I&&De.repeated&&(Lu[se]!==void 0||ka[se]===void 0)&&De.setOption("packed",!1,!0)}function K(q,ee){var ae=s();if(!js.test(ae))throw w(ae,"name");var se=Ee.lcFirst(ae);ae===se&&(ae=Ee.ucFirst(ae)),c("=");var we=D(s()),De=new C(ae);De.group=!0;var Ke=new _(se,we,ae,ee);Ke.filename=Object.getOwnPropertyDescriptor(Js,"filename"),H(De,function(et){switch(et){case"option":ge(De,et),c(";");break;case"required":case"optional":case"repeated":F(De,et);break;default:throw w(et)}}),q.add(De).add(Ke)}function X(q,ee){c("<");var ae=s();if(ku[ae]===void 0)throw w(ae,"type");c(",");var se=s();if(!zs.test(se))throw w(se,"type");c(">");var we=s();if(!js.test(we))throw w(we,"name");c("=");var De=new kr(S(we),D(s()),ae,se);H(De,function(Ke){if(Ke==="option")ge(De,Ke),c(";");else throw w(Ke)},function(){pe(De)}),q.add(De)}function ye(q,ee){if(!js.test(ee=s()))throw w(ee,"name");var ae=new Da(S(ee));H(ae,function(se){se==="option"?(ge(ae,se),c(";")):(i(se),F(ae,"optional"))}),q.add(ae)}function Te(q,ee){if(!js.test(ee=s()))throw w(ee,"name");var ae=new ur(ee);H(ae,function(se){switch(se){case"option":ge(ae,se),c(";");break;case"reserved":v(ae.reserved||(ae.reserved=[]),!0);break;default:le(ae,se)}}),q.add(ae)}function le(q,ee){if(!js.test(ee))throw w(ee,"name");c("=");var ae=D(s(),!0),se={};H(se,function(we){if(we==="option")ge(se,we),c(";");else throw w(we)},function(){pe(se)}),q.add(ee,ae,se.comment)}function ge(q,ee){var ae=c("(",!0);if(!zs.test(ee=s()))throw w(ee,"name");var se=ee;ae&&(c(")"),se="("+se+")",ee=o(),NE.test(ee)&&(se+=ee,s())),c("="),N(q,se)}function N(q,ee){if(c("{",!0))do{if(!js.test(ce=s()))throw w(ce,"name");o()==="{"?N(q,ee+"."+ce):(c(":"),o()==="{"?N(q,ee+"."+ce):oe(q,ee+"."+ce,R())),c(",",!0)}while(!c("}",!0));else oe(q,ee,R())}function oe(q,ee,ae){q.setOption&&q.setOption(ee,ae)}function pe(q){if(c("[",!0)){do ge(q,"option");while(c(",",!0));c("]")}return q}function xe(q,ee){if(!zs.test(ee=s()))throw w(ee,"reference");var ae=ee;H(null,function(se){switch(se){case"required":case"repeated":case"optional":F(q,se,ae);break;default:if(!I||!zs.test(se))throw w(se);i(se),F(q,"optional",ae);break}})}for(var ce;(ce=s())!==null;)switch(ce){case"package":if(!u)throw w(ce);L();break;case"import":if(!u)throw w(ce);z();break;case"syntax":if(!u)throw w(ce);Y();break;case"option":if(!u)throw w(ce);ge(T,ce),c(";");break;default:if(x(T,ce)){u=!1;continue}throw w(ce)}return Object.defineProperty(Js,"filename",{value:null}),{package:g,imports:y,weakImports:m,syntax:d,root:t}}Ee._configure(ur,Fa,C),Ee._configure2(),xi._configure(Fa),Qn._configure(C,ur,_),Fa._configure(C),_._configure(C),Nn._configure(Nm),Is._configure(cE);var hc=Ee.Long,qn=class extends J{toJSON(){return{numerator:this.numerator,denominator:this.denominator}}};p([_.d(1,"int32"),h("design:type",Number)],qn.prototype,"numerator",void 0),p([_.d(2,"int32"),h("design:type",Number)],qn.prototype,"denominator",void 0),qn=p([C.d("Fraction")],qn);var gr=class extends J{toJSON(){return{numerator:this.numerator,denominator:this.denominator}}};p([_.d(1,"string"),h("design:type",String)],gr.prototype,"numerator",void 0),p([_.d(2,"string"),h("design:type",String)],gr.prototype,"denominator",void 0),gr=p([C.d("FractionBigIntModel")],gr);var Ua=class extends J{toJSON(){return{start:this.start,end:this.end}}};p([_.d(1,"uint32"),h("design:type",Number)],Ua.prototype,"start",void 0),p([_.d(2,"uint32"),h("design:type",Number)],Ua.prototype,"end",void 0),Ua=p([C.d("Range")],Ua);var $a=class extends J{toJSON(){return{prevWeight:this.prevWeight,nextWeight:this.nextWeight}}};p([_.d(1,"string"),h("design:type",String)],$a.prototype,"prevWeight",void 0),p([_.d(2,"string"),h("design:type",String)],$a.prototype,"nextWeight",void 0),$a=p([C.d("RateModel")],$a);var Ys=class{constructor(e,t){this._raw=e,this.valueCode=t,this._m=new Map;for(const[r,n]of Object.entries(this._raw))this._m.set(r,t.decode(n,r))}set(e,t){return this._m.set(e,t),this._raw[e]=this.valueCode.encode(t,e),this}delete(e){return this._m.delete(e)?(delete this._raw[e],!0):!1}clear(){for(const e in this._raw)delete this._raw[e];return this._m.clear()}toObject(){const e={};for(const[t,r]of this._m)e[t[0]]=r;return e}toJSON(){const e={};for(const t of this._m.entries()){const r=t[1];e[t[0]]=r&&typeof r.toJSON=="function"?r.toJSON():r}return e}get has(){return this._m.has.bind(this._m)}get get(){return this._m.get.bind(this._m)}get size(){return this._m.size}get[Symbol.iterator](){return this._m[Symbol.iterator].bind(this._m)}get entries(){return this._m.entries.bind(this._m)}get keys(){return this._m.keys.bind(this._m)}get values(){return this._m.values.bind(this._m)}get[Symbol.toStringTag](){return"TypedMap"}};p([ie,h("design:type",Object),h("design:paramtypes",[])],Ys.prototype,"has",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ys.prototype,"get",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ys.prototype,Symbol.iterator,null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ys.prototype,"entries",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ys.prototype,"keys",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ys.prototype,"values",null);var Xs=class extends Ys{constructor(e){super(e,{decode:t=>t,encode:t=>t})}},Cm=class extends Ys{constructor(e){super(e,{decode:t=>JSON.parse(t),encode:t=>JSON.stringify(t)})}},lc=class{constructor(e){this._l=e,this._s=new Set(e)}add(e){return this._s.has(e)||(this._l.push(e),this._s.add(e)),this}delete(e){if(this._s.delete(e)){const t=this._l.indexOf(e);return this._l.splice(t,1),!0}return!1}clear(){this._s.clear(),this._l.length=0}get has(){return this._s.has.bind(this._s)}get size(){return this._s.size}get[Symbol.iterator](){return this._s[Symbol.iterator].bind(this._s)}get entries(){return this._s.entries.bind(this._s)}get keys(){return this._s.keys.bind(this._s)}get values(){return this._s.values.bind(this._s)}get[Symbol.toStringTag](){return"TypedSet"}};p([ie,h("design:type",Object),h("design:paramtypes",[])],lc.prototype,"has",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],lc.prototype,Symbol.iterator,null),p([ie,h("design:type",Object),h("design:paramtypes",[])],lc.prototype,"entries",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],lc.prototype,"keys",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],lc.prototype,"values",null);var uc=class extends J{get remarkMap(){return this._remarkMap||(this._remarkMap=new Xs(this.remark)),this._remarkMap}toJSON(){return{remark:this.remark}}getBytes(){return this.$type.encode(this).finish()}};p([kr.d(1,"string","string"),h("design:type",Object)],uc.prototype,"remark",void 0),p([As,h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],uc.prototype,"getBytes",null),uc=p([C.d("TemplateRemark")],uc);var Yu=new WeakMap,OE=new Uint8Array,zh=[],Jh=Object.create({});for(let e=0;e<256;e++){const t=e.toString(16).padStart(2,"0");zh[e]=t,Jh[t]=e,Jh[t.toUpperCase()]=e}var Xu=[];{const e=new Uint16Array(1),t=new Uint8Array(e.buffer);for(const r of zh)for(const n of zh)t[0]=Jh[r],t[1]=Jh[n],Xu[e[0]]=r+n}var gc=new Uint8Array(40),Rm=new Uint16Array(gc.buffer);function vE(e){const t=e.length>>1;let r="";if(gc.length>=e.length){gc.set(e,0);for(let n=0;n<t;n++)r+=Xu[Rm[n]]}else{let n=0;do{const s=Math.min(gc.length,e.length-n);for(let o=0;o<s;++o)gc[o]=e[o+n];const i=s>>1;for(let o=0;o<i;o++)r+=Xu[Rm[o]];n+=s}while(n<e.length)}return t<<1!==e.length&&(r+=zh[e[e.length-1]]),r}function Pm(e){const t=new Uint8Array(e.length>>1);let r=0,n=0;for(;n<t.length;){let s=e.charCodeAt(r++);s<=57?s=s-48<<4:s<=70?s=s-55<<4:s<=102&&(s=s-87<<4);let i=e.charCodeAt(r++);i<=57?i-=48:i<=70?i-=55:i<=102&&(i-=87),t[n++]=s+i}return t}function Qu(e){if(!e)return"";let t;return e.length===e.byteLength&&(t=Yu.get(e),typeof t=="string")||(t=vE(e),Yu.set(e,t)),t}var Ne=Qu;function xm(e){if(!e)return OE;const t=Pm(e);return Yu.set(t,e),t}var me=xm,Va,pt=Va=class extends J{get publicKey(){return Ne(this.publicKeyBuffer)}set publicKey(e){this.publicKeyBuffer=me(e)}get signature(){return Ne(this.signatureBuffer)}set signature(e){this.signatureBuffer=me(e)}get secondPublicKey(){return this.secondPublicKeyBuffer&&Ne(this.secondPublicKeyBuffer)||void 0}set secondPublicKey(e){this.secondPublicKeyBuffer=me(e)}get signSignature(){return this.signSignatureBuffer&&Ne(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=me(e)}toJSON(){const e={publicKey:this.publicKey,signature:this.signature};return this.secondPublicKey&&(e.secondPublicKey=this.secondPublicKey),this.signSignature&&(e.signSignature=this.signSignature),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.publicKey&&(t.publicKey=e.publicKey),e.signature&&(t.signature=e.signature),e.secondPublicKey&&(t.secondPublicKey=e.secondPublicKey),e.signSignature&&(t.signSignature=e.signSignature)),t}};pt.INC=1,p([_.d(Va.INC++,"bytes"),h("design:type",Uint8Array)],pt.prototype,"publicKeyBuffer",void 0),p([_.d(Va.INC++,"bytes"),h("design:type",Uint8Array)],pt.prototype,"signatureBuffer",void 0),p([_.d(Va.INC++,"bytes"),h("design:type",Uint8Array)],pt.prototype,"secondPublicKeyBuffer",void 0),p([_.d(Va.INC++,"bytes"),h("design:type",Uint8Array)],pt.prototype,"signSignatureBuffer",void 0),pt=Va=p([C.d("AccountSignatureModel")],pt);var Vt=class extends J{toJSON(){return{taxCollector:this.taxCollector,taxAssetPrealnum:this.taxAssetPrealnum}}};p([_.d(1,"string"),h("design:type",String)],Vt.prototype,"taxCollector",void 0),p([_.d(2,"string"),h("design:type",String)],Vt.prototype,"taxAssetPrealnum",void 0),Vt=p([C.d("TaxInformationModel")],Vt);var Yh;(function(e){e.TESTNET="c",e.MAINNET="b"})(Yh||(Yh={}));var Bm="100000000",Hm;(function(e){e[e.CHAIN=2]="CHAIN",e[e.DAPP=4]="DAPP",e[e.LNS=8]="LNS"})(Hm||(Hm={}));var Xh={ENDPOINT:Symbol("endpoint"),REFUSETIME:Symbol("refuseTime")},G;(function(e){e[e.DAPP=1]="DAPP",e[e.LOCATION_NAME=2]="LOCATION_NAME",e[e.ENTITY=3]="ENTITY",e[e.ASSETS=5]="ASSETS",e[e.CERTIFICATE=6]="CERTIFICATE"})(G||(G={}));var it;(function(e){e[e.GIFT=0]="GIFT",e[e.EXCHANGE=1]="EXCHANGE",e[e.TRUST=2]="TRUST",e[e.ENTITY=3]="ENTITY"})(it||(it={}));var Hi;(function(e){e[e.P_0=0]="P_0",e[e.P_1=1]="P_1",e[e.P_2=2]="P_2",e[e.P_3=3]="P_3",e[e.P_4=4]="P_4",e[e.P_5=5]="P_5",e[e.P_6=6]="P_6",e[e.P_7=7]="P_7",e[e.P_8=8]="P_8",e[e.P_9=9]="P_9",e.P_10="A",e.P_11="B",e.P_12="C",e.P_13="D",e.P_14="E",e.P_15="F",e.P_16="G",e.P_17="H",e.P_18="I",e.P_19="J",e.P_20="K",e.P_21="L",e.P_22="M",e.P_23="N",e.P_24="O",e.P_25="P",e.P_26="Q",e.P_27="R",e.P_28="S",e.P_29="T",e.P_30="U",e.P_31="V",e.P_32="W",e.P_33="X",e.P_34="Y",e.P_35="Z"})(Hi||(Hi={}));var Qh;(function(e){e.DIFFERENT_PRE_BLOCK_SIGNATURE="the previous block signature is inconsistent",e.GENERATE_BLOCK_FAIL="generate block fail",e.REPLY_BLOCK_FAIL="reply block fail"})(Qh||(Qh={}));var B;(function(e){e.SIGNATURE="BSE-01",e.DAPP="WOD-00",e.DAPP_PURCHASING="WOD-01",e.REGISTER_CHAIN="WOD-02",e.MARK="EXT-00",e.ISSUE_ASSET="AST-00",e.INCREASE_ASSET="AST-01",e.TRANSFER_ASSET="AST-02",e.DESTROY_ASSET="AST-03",e.GIFT_ASSET="AST-04",e.GRAB_ASSET="AST-05",e.TRUST_ASSET="AST-06",e.SIGN_FOR_ASSET="AST-07",e.EMIGRATE_ASSET="AST-08",e.IMMIGRATE_ASSET="AST-09",e.TO_EXCHANGE_ASSET="AST-10",e.BE_EXCHANGE_ASSET="AST-11",e.STAKE_ASSET="AST-12",e.UNSTAKE_ASSET="AST-13",e.LOCATION_NAME="LNS-00",e.SET_LNS_RECORD_VALUE="LNS-01",e.SET_LNS_MANAGER="LNS-02",e.ISSUE_ENTITY_FACTORY="ETY-00",e.ISSUE_ENTITY_FACTORY_V1="ETY-01",e.ISSUE_ENTITY="ETY-02",e.DESTROY_ENTITY="ETY-03",e.ISSUE_ENTITY_MULTI="ETY-04",e.TRANSFER_ANY="ANY-00",e.GIFT_ANY="ANY-01",e.GRAB_ANY="ANY-02",e.TO_EXCHANGE_ANY="ANY-03",e.BE_EXCHANGE_ANY="ANY-04",e.TO_EXCHANGE_ANY_MULTI="ANY-05",e.BE_EXCHANGE_ANY_MULTI="ANY-06",e.TO_EXCHANGE_ANY_MULTI_ALL="ANY-07",e.BE_EXCHANGE_ANY_MULTI_ALL="ANY-08",e.ISSUE_CERTIFICATE="CRT-00",e.DESTROY_CERTIFICATE="CRT-01",e.MULTIPLE="MTP-00",e.PROMISE="PMS-00",e.PROMISE_RESOLVE="PMS-01",e.MACRO="MAC-00",e.MACRO_CALL="MAC-01"})(B||(B={}));var ve={VK:new Map,KV:new Map,VM:new Map,MV:new Map,trsTypeToV(e){const t=e.indexOf("-",e.indexOf("-")+1);return e.substr(t+1)}},Gt=class Cu extends Map{constructor(t,r,n=i=>i,s){super(r),this.creater=t,this.transformKey=n,this._afterDelete=s}static from(t){return new Cu(t.creater,t.entries,t.transformKey,t.afterDelete)}forceGet(t,r=this.creater){const n=this.transformKey(t);if(super.has(n))return super.get(n);const s=r(t,n);return super.set(n,s),s}tryGet(t){return this.get(this.transformKey(t))}trySet(t,r){return this.set(this.transformKey(t),r)}tryDelete(t){return this.delete(this.transformKey(t))}tryHas(t){return this.has(this.transformKey(t))}delete(t){const r=super.delete(t);return r&&this._afterDelete&&this._afterDelete(t),r}get[Symbol.toStringTag](){return"EasyMap"}static call(t,r,n,s,i){if(!(t instanceof Cu))throw new TypeError("please use new keyword to create EasyMap instance.");const o=new Cu(r,n,s,i),c=Object.getPrototypeOf(o),l=Object.getPrototypeOf(c),u=Object.getOwnPropertyDescriptors(l);for(const m in u)if(m!=="constructor"){const d=u[m];typeof d.value=="function"?d.value=d.value.bind(o):(typeof d.get=="function"&&(d.get=d.get.bind(o)),typeof d.set=="function"&&(d.set=d.set.bind(o))),Object.defineProperty(t,m,d)}const g=Object.getOwnPropertyDescriptors(c);for(const m in g)if(m!=="constructor"){const d=g[m];typeof d.value=="function"?d.value=d.value.bind(o):(typeof d.get=="function"&&(d.get=d.get.bind(o)),typeof d.set=="function"&&(d.set=d.set.bind(o))),Object.defineProperty(t,m,d)}const y=Object.getOwnPropertyDescriptors(o);for(const m in y)m!=="constructor"&&Object.defineProperty(t,m,{enumerable:!0,configurable:!0,get:()=>Reflect.get(o,m),set(d){Reflect.set(o,m,d)}});return t}},Ga=class Ru extends WeakMap{constructor(t,r,n=i=>i,s){super(r),this.creater=t,this.transformKey=n,this._afterDelete=s}static from(t){return new Ru(t.creater,t.entries,t.transformKey,t.afterDelete)}forceGet(t,r=this.creater){const n=this.transformKey(t);if(this.has(n))return this.get(n);const s=r(t,n);return this.set(n,s),s}tryGet(t){return this.get(this.transformKey(t))}trySet(t,r){return this.set(this.transformKey(t),r)}tryDelete(t){return this.delete(this.transformKey(t))}tryHas(t){return this.has(this.transformKey(t))}delete(t){const r=super.delete(t);return r&&this._afterDelete&&this._afterDelete(t),r}get[Symbol.toStringTag](){return"EasyWeakMap"}static call(t,r,n,s,i){if(!(t instanceof Ru))throw new TypeError("please use new keyword to create EasyWeakMap instance.");const o=new Ru(r,n,s,i),c=Object.getPrototypeOf(o),l=Object.getPrototypeOf(c),u=Object.getOwnPropertyDescriptors(l);for(const m in u)if(m!=="constructor"){const d=u[m];typeof d.value=="function"?d.value=d.value.bind(o):(typeof d.get=="function"&&(d.get=d.get.bind(o)),typeof d.set=="function"&&(d.set=d.set.bind(o))),Object.defineProperty(t,m,d)}const g=Object.getOwnPropertyDescriptors(c);for(const m in g)if(m!=="constructor"){const d=g[m];typeof d.value=="function"?d.value=d.value.bind(o):(typeof d.get=="function"&&(d.get=d.get.bind(o)),typeof d.set=="function"&&(d.set=d.set.bind(o))),Object.defineProperty(t,m,d)}const y=Object.getOwnPropertyDescriptors(o);for(const m in y)m!=="constructor"&&Object.defineProperty(t,m,{enumerable:!0,configurable:!0,get:()=>Reflect.get(o,m),set(d){Reflect.set(o,m,d)}});return t}},qh,Ot,CE=new Ga(e=>new Xs(e.remark)),RE=new Ga(e=>{const t={},r="blob+sha256+hex://";for(const n in e.remark){const s=e.remark[n];if(s.startsWith(r)){const i=s.slice(r.length).split("?");if(i.length!==2)continue;try{const o=Pm(i[0]);if(o.length===32){const c=i[1].split("=");if(c.length!==2||c[0]!=="size")continue;const l=Number(c[1]);if(Number.isNaN(l))continue;t[n]=["SHA256",i[0],o,l]}}catch{}}}return new Xs(t)}),Wn=qh=class extends J{toJSON(){return{key:this.key,value:this.value}}};Wn.INC=1,p([_.d(qh.INC++,"string"),h("design:type",String)],Wn.prototype,"key",void 0),p([_.d(qh.INC++,"string"),h("design:type",String)],Wn.prototype,"value",void 0),Wn=qh=p([C.d("TransactionBaseStorageModel")],Wn);var Je=Ot=class extends J{get senderPublicKey(){return Ne(this.senderPublicKeyBuffer)}set senderPublicKey(e){this.senderPublicKeyBuffer=me(e)}get senderSecondPublicKey(){return this.senderSecondPublicKeyBuffer&&Ne(this.senderSecondPublicKeyBuffer)||void 0}set senderSecondPublicKey(e){this.senderSecondPublicKeyBuffer=me(e)}get signature(){return Ne(this.signatureBuffer)}set signature(e){this.signatureBuffer=me(e)}get storageKey(){return this.storage&&this.storage.key}get storageValue(){return this.storage&&this.storage.value}get signSignature(){return this.signSignatureBuffer&&Ne(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=me(e)}get remarkMap(){return CE.forceGet(this)}get blobMap(){return RE.forceGet(this)}getBlobSize(e=!1){let t=0;const r=this.blobMap.values();for(const n of r)t+=n[3];return t}getBytes(e,t){const r={};e&&(r.signatureBuffer={value:null}),t&&(r.signSignatureBuffer={value:null});const n=Object.create(this,r);return this.$type.encode(n).finish()}toJSON(){const e={version:this.version,type:this.type,senderId:this.senderId,senderPublicKey:this.senderPublicKey,rangeType:this.rangeType,range:this.range,fee:this.fee,timestamp:this.timestamp,fromMagic:this.fromMagic,toMagic:this.toMagic,applyBlockHeight:this.applyBlockHeight,effectiveBlockHeight:this.effectiveBlockHeight,signature:this.signature,remark:this.remark,asset:this.asset.toJSON()};return this.recipientId&&(e.recipientId=this.recipientId),this.dappid&&(e.dappid=this.dappid),this.lns&&(e.lns=this.lns),this.sourceIP&&(e.sourceIP=this.sourceIP),this.senderSecondPublicKey&&(e.senderSecondPublicKey=this.senderSecondPublicKey),this.signSignature&&(e.signSignature=this.signSignature),this.storageKey&&(e.storageKey=this.storageKey),this.storageValue&&(e.storageValue=this.storageValue),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.senderPublicKey&&(t.senderPublicKey=e.senderPublicKey),e.senderSecondPublicKey&&(t.senderSecondPublicKey=e.senderSecondPublicKey),e.signature&&(t.signature=e.signature),e.signSignature&&(t.signSignature=e.signSignature),!t.storage&&typeof e.storageKey=="string"&&typeof e.storageValue=="string"&&(t.storage=new Wn({key:e.storageKey,value:e.storageValue}))),t}as(e,t){}};Je.INC=1,p([_.d(Ot.INC++,"uint32"),h("design:type",Number)],Je.prototype,"version",void 0),p([_.d(Ot.INC++,"string"),h("design:type",String)],Je.prototype,"type",void 0),p([_.d(Ot.INC++,"string"),h("design:type",String)],Je.prototype,"senderId",void 0),p([_.d(Ot.INC++,"bytes"),h("design:type",Uint8Array)],Je.prototype,"senderPublicKeyBuffer",void 0),p([_.d(Ot.INC++,"bytes","optional"),h("design:type",Uint8Array)],Je.prototype,"senderSecondPublicKeyBuffer",void 0),p([_.d(Ot.INC++,"string","optional"),h("design:type",String)],Je.prototype,"recipientId",void 0),p([_.d(Ot.INC++,"uint32"),h("design:type",Number)],Je.prototype,"rangeType",void 0),p([_.d(Ot.INC++,"string","repeated"),h("design:type",Array)],Je.prototype,"range",void 0),p([_.d(Ot.INC++,"string"),h("design:type",String)],Je.prototype,"fee",void 0),p([_.d(Ot.INC++,"uint32"),h("design:type",Number)],Je.prototype,"timestamp",void 0),p([_.d(Ot.INC++,"string","optional"),h("design:type",String)],Je.prototype,"dappid",void 0),p([_.d(Ot.INC++,"string","optional"),h("design:type",String)],Je.prototype,"lns",void 0),p([_.d(Ot.INC++,"string","optional"),h("design:type",String)],Je.prototype,"sourceIP",void 0),p([_.d(Ot.INC++,"string"),h("design:type",String)],Je.prototype,"fromMagic",void 0),p([_.d(Ot.INC++,"string"),h("design:type",String)],Je.prototype,"toMagic",void 0),p([_.d(Ot.INC++,"uint32"),h("design:type",Number)],Je.prototype,"applyBlockHeight",void 0),p([_.d(Ot.INC++,"uint32"),h("design:type",Number)],Je.prototype,"effectiveBlockHeight",void 0),p([_.d(Ot.INC++,"bytes"),h("design:type",Uint8Array)],Je.prototype,"signatureBuffer",void 0),p([_.d(Ot.INC++,Wn,"optional"),h("design:type",Wn)],Je.prototype,"storage",void 0),p([_.d(Ot.INC++,"bytes","optional"),h("design:type",Uint8Array)],Je.prototype,"signSignatureBuffer",void 0),p([kr.d(Ot.INC++,"string","string"),h("design:type",Object)],Je.prototype,"remark",void 0),p([As,h("design:type",Function),h("design:paramtypes",[Boolean,Boolean]),h("design:returntype",void 0)],Je.prototype,"getBytes",null),Je=Ot=p([C.d("Transaction")],Je);var Ve=class extends Je{as(e,t){const r=ve.MV.get(e),n=ve.trsTypeToV(this.type);if(r===n)if(t){if(this.signature===t)return this}else return this}};Ve=p([C.d("AbstractTransaction")],Ve);var fc=class extends J{get publicKey(){return Ne(this.publicKeyBuffer)}set publicKey(e){this.publicKeyBuffer=me(e)}toJSON(){return{publicKey:this.publicKey}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.publicKey&&(t.publicKey=e.publicKey),t}};p([_.d(1,"bytes"),h("design:type",Uint8Array)],fc.prototype,"publicKeyBuffer",void 0),fc=p([C.d("SignatureModel")],fc);var dc=class extends J{toJSON(){return{signature:this.signature.toJSON()}}};p([_.d(1,fc),h("design:type",fc)],dc.prototype,"signature",void 0),dc=p([C.d("SignatureAssetModel")],dc);var ki,Lr=ki=class extends J{toJSON(){const e={sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,dappid:this.dappid,type:this.type};return this.purchaseAsset&&(e.purchaseAsset=this.purchaseAsset),e}};Lr.INC=1,p([_.d(ki.INC++,"string"),h("design:type",String)],Lr.prototype,"sourceChainName",void 0),p([_.d(ki.INC++,"string"),h("design:type",String)],Lr.prototype,"sourceChainMagic",void 0),p([_.d(ki.INC++,"string"),h("design:type",String)],Lr.prototype,"dappid",void 0),p([_.d(ki.INC++,"uint32"),h("design:type",Number)],Lr.prototype,"type",void 0),p([_.d(ki.INC++,"string","optional"),h("design:type",String)],Lr.prototype,"purchaseAsset",void 0),Lr=ki=p([C.d("DAppModel")],Lr);var yc=class extends J{toJSON(){return{dapp:this.dapp.toJSON()}}};p([_.d(1,Lr),h("design:type",Lr)],yc.prototype,"dapp",void 0),yc=p([C.d("DAppAssetModel")],yc);var qu,Ka=qu=class extends J{toJSON(){return{dappAsset:this.dappAsset.toJSON()}}};Ka.INC=1,p([_.d(qu.INC++,Lr),h("design:type",Lr)],Ka.prototype,"dappAsset",void 0),Ka=qu=p([C.d("DAppPurchasingModel")],Ka);var mc=class extends J{toJSON(){return{dappPurchasing:this.dappPurchasing.toJSON()}}};p([_.d(1,Ka),h("design:type",Ka)],mc.prototype,"dappPurchasing",void 0),mc=p([C.d("DAppPurchasingAssetModel")],mc);var _c,Qs=_c=class extends J{toJSON(){return{content:this.content,action:this.action,dapp:this.dapp.toJSON()}}};Qs.INC=1,p([_.d(_c.INC++,"string"),h("design:type",String)],Qs.prototype,"content",void 0),p([_.d(_c.INC++,"string"),h("design:type",String)],Qs.prototype,"action",void 0),p([_.d(_c.INC++,Lr),h("design:type",Lr)],Qs.prototype,"dapp",void 0),Qs=_c=p([C.d("MarkModel")],Qs);var Ac=class extends J{toJSON(){return{mark:this.mark.toJSON()}}};p([_.d(1,Qs),h("design:type",Qs)],Ac.prototype,"mark",void 0),Ac=p([C.d("MarkAssetModel")],Ac);var qs=class extends J{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,expectedIssuedAssets:this.expectedIssuedAssets}}};p([_.d(1,"string"),h("design:type",String)],qs.prototype,"sourceChainName",void 0),p([_.d(2,"string"),h("design:type",String)],qs.prototype,"sourceChainMagic",void 0),p([_.d(3,"string"),h("design:type",String)],qs.prototype,"assetType",void 0),p([_.d(4,"string"),h("design:type",String)],qs.prototype,"expectedIssuedAssets",void 0),qs=p([C.d("IssueAssetModel")],qs);var Ic=class extends J{toJSON(){return{issueAsset:this.issueAsset.toJSON()}}};p([_.d(1,qs),h("design:type",qs)],Ic.prototype,"issueAsset",void 0),Ic=p([C.d("IssueAssetAssetModel")],Ic);var Zn=class extends J{toJSON(){return{applyAddress:this.applyAddress,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,increasedAssetPrealnum:this.increasedAssetPrealnum,frozenMainAssetPrealnum:this.frozenMainAssetPrealnum}}};p([_.d(1,"string"),h("design:type",String)],Zn.prototype,"applyAddress",void 0),p([_.d(2,"string"),h("design:type",String)],Zn.prototype,"sourceChainName",void 0),p([_.d(3,"string"),h("design:type",String)],Zn.prototype,"sourceChainMagic",void 0),p([_.d(4,"string"),h("design:type",String)],Zn.prototype,"assetType",void 0),p([_.d(5,"string"),h("design:type",String)],Zn.prototype,"increasedAssetPrealnum",void 0),p([_.d(6,"string"),h("design:type",String)],Zn.prototype,"frozenMainAssetPrealnum",void 0),Zn=p([C.d("IncreaseAssetModel")],Zn);var Ec=class extends J{toJSON(){return{increaseAsset:this.increaseAsset.toJSON()}}};p([_.d(1,Zn),h("design:type",Zn)],Ec.prototype,"increaseAsset",void 0),Ec=p([C.d("IncreaseAssetAssetModel")],Ec);var Ws=class extends J{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,amount:this.amount}}};p([_.d(1,"string"),h("design:type",String)],Ws.prototype,"sourceChainName",void 0),p([_.d(2,"string"),h("design:type",String)],Ws.prototype,"sourceChainMagic",void 0),p([_.d(3,"string"),h("design:type",String)],Ws.prototype,"assetType",void 0),p([_.d(4,"string"),h("design:type",String)],Ws.prototype,"amount",void 0),Ws=p([C.d("TransferAssetModel")],Ws);var Tc=class extends J{toJSON(){return{transferAsset:this.transferAsset.toJSON()}}};p([_.d(1,Ws),h("design:type",Ws)],Tc.prototype,"transferAsset",void 0),Tc=p([C.d("TransferAssetAssetModel")],Tc);var Zs=class extends J{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,amount:this.amount}}};p([_.d(1,"string"),h("design:type",String)],Zs.prototype,"sourceChainName",void 0),p([_.d(2,"string"),h("design:type",String)],Zs.prototype,"sourceChainMagic",void 0),p([_.d(3,"string"),h("design:type",String)],Zs.prototype,"assetType",void 0),p([_.d(4,"string"),h("design:type",String)],Zs.prototype,"amount",void 0),Zs=p([C.d("DestroyAssetModel")],Zs);var Sc=class extends J{toJSON(){return{destroyAsset:this.destroyAsset.toJSON()}}};p([_.d(1,Zs),h("design:type",Zs)],Sc.prototype,"destroyAsset",void 0),Sc=p([C.d("DestroyAssetAssetModel")],Sc);var es,km=new WeakMap,Or=es=class extends J{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=km.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Ne(r))),t}set cipherPublicKeys(e){const t=e.map(r=>me(r));km.set(t,e),this.cipherPublicKeysBuffer=t}toJSON(){const e={cipherPublicKeys:this.cipherPublicKeys,sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,assetType:this.assetType,amount:this.amount,totalGrabableTimes:this.totalGrabableTimes,giftDistributionRule:this.giftDistributionRule};return this.beginUnfrozenBlockHeight&&(e.beginUnfrozenBlockHeight=this.beginUnfrozenBlockHeight),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Or.INC=1,p([_.d(es.INC++,"bytes","repeated"),h("design:type",Array)],Or.prototype,"cipherPublicKeysBuffer",void 0),p([_.d(es.INC++,"string"),h("design:type",String)],Or.prototype,"sourceChainMagic",void 0),p([_.d(es.INC++,"string"),h("design:type",String)],Or.prototype,"sourceChainName",void 0),p([_.d(es.INC++,"string"),h("design:type",String)],Or.prototype,"assetType",void 0),p([_.d(es.INC++,"string"),h("design:type",String)],Or.prototype,"amount",void 0),p([_.d(es.INC++,"uint32"),h("design:type",Number)],Or.prototype,"totalGrabableTimes",void 0),p([_.d(es.INC++,"uint32","optional"),h("design:type",Number)],Or.prototype,"beginUnfrozenBlockHeight",void 0),p([_.d(es.INC++,"uint32"),h("design:type",Number)],Or.prototype,"giftDistributionRule",void 0),Or=es=p([C.d("GiftAssetModel")],Or);var bc=class extends J{toJSON(){return{giftAsset:this.giftAsset.toJSON()}}};p([_.d(1,Or),h("design:type",Or)],bc.prototype,"giftAsset",void 0),bc=p([C.d("GiftAssetAssetModel")],bc);var Li,Wu=new WeakMap,On=Li=class extends J{get blockSignature(){return Ne(this.blockSignatureBuffer)}set blockSignature(e){this.blockSignatureBuffer=me(e)}get transactionSignature(){return Ne(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=me(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=pt.decode(e);return Wu.set(t,e),t}set ciphertextSignature(e){if(e){let t=Wu.get(e);t||(t=pt.encode(e).finish(),Wu.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={blockSignature:this.blockSignature,transactionSignature:this.transactionSignature,amount:this.amount,giftAsset:this.giftAsset.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.blockSignature&&(t.blockSignature=e.blockSignature),e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=pt.fromObject(e.ciphertextSignature))),t}};On.INC=1,p([_.d(Li.INC++,"bytes"),h("design:type",Uint8Array)],On.prototype,"blockSignatureBuffer",void 0),p([_.d(Li.INC++,"bytes"),h("design:type",Uint8Array)],On.prototype,"transactionSignatureBuffer",void 0),p([_.d(Li.INC++,"string"),h("design:type",String)],On.prototype,"amount",void 0),p([_.d(Li.INC++,"bytes","optional"),h("design:type",Uint8Array)],On.prototype,"ciphertextSignatureBuffer",void 0),p([_.d(Li.INC++,Or),h("design:type",Or)],On.prototype,"giftAsset",void 0),On=Li=p([C.d("GrabAssetModel")],On);var wc=class extends J{toJSON(){return{grabAsset:this.grabAsset.toJSON()}}};p([_.d(1,On),h("design:type",On)],wc.prototype,"grabAsset",void 0),wc=p([C.d("GrabAssetAssetModel")],wc);var ei,Vr=ei=class extends J{toJSON(){return{trustees:this.trustees,numberOfSignFor:this.numberOfSignFor,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,amount:this.amount}}};Vr.INC=1,p([_.d(ei.INC++,"string","repeated"),h("design:type",Array)],Vr.prototype,"trustees",void 0),p([_.d(ei.INC++,"uint32"),h("design:type",Number)],Vr.prototype,"numberOfSignFor",void 0),p([_.d(ei.INC++,"string"),h("design:type",String)],Vr.prototype,"sourceChainName",void 0),p([_.d(ei.INC++,"string"),h("design:type",String)],Vr.prototype,"sourceChainMagic",void 0),p([_.d(ei.INC++,"string"),h("design:type",String)],Vr.prototype,"assetType",void 0),p([_.d(ei.INC++,"string"),h("design:type",String)],Vr.prototype,"amount",void 0),Vr=ei=p([C.d("TrustAssetModel")],Vr);var Nc=class extends J{toJSON(){return{trustAsset:this.trustAsset.toJSON()}}};p([_.d(1,Vr),h("design:type",Vr)],Nc.prototype,"trustAsset",void 0),Nc=p([C.d("TrustAssetAssetModel")],Nc);var ja,ts=ja=class extends J{get transactionSignature(){return Ne(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=me(e)}getBytes(){const e=Object.create(this,{signatureBufferList:{value:null}});return this.$type.encode(e).finish()}toJSON(){return{transactionSignature:this.transactionSignature,trustSenderId:this.trustSenderId,trustRecipientId:this.trustRecipientId,trustAsset:this.trustAsset.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.transactionSignature&&(t.transactionSignature=e.transactionSignature),t}};ts.INC=1,p([_.d(ja.INC++,"bytes"),h("design:type",Uint8Array)],ts.prototype,"transactionSignatureBuffer",void 0),p([_.d(ja.INC++,"string"),h("design:type",String)],ts.prototype,"trustSenderId",void 0),p([_.d(ja.INC++,"string"),h("design:type",String)],ts.prototype,"trustRecipientId",void 0),p([_.d(ja.INC++,Vr),h("design:type",Vr)],ts.prototype,"trustAsset",void 0),p([As,h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],ts.prototype,"getBytes",null),ts=ja=p([C.d("SignForAssetModel")],ts);var Oc=class extends J{toJSON(){return{signForAsset:this.signForAsset.toJSON()}}};p([_.d(1,ts),h("design:type",ts)],Oc.prototype,"signForAsset",void 0),Oc=p([C.d("SignForAssetAssetModel")],Oc);var vc=class extends J{toJSON(){return{migrateCertificate:this.migrateCertificate}}};p([_.d(1,"string"),h("design:type",String)],vc.prototype,"migrateCertificate",void 0),vc=p([C.d("EmigrateAssetModel")],vc);var Cc=class extends J{toJSON(){return{emigrateAsset:this.emigrateAsset.toJSON()}}};p([_.d(1,vc),h("design:type",vc)],Cc.prototype,"emigrateAsset",void 0),Cc=p([C.d("EmigrateAssetAssetModel")],Cc);var Rc=class extends J{toJSON(){return{migrateCertificate:this.migrateCertificate}}};p([_.d(1,"string"),h("design:type",String)],Rc.prototype,"migrateCertificate",void 0),Rc=p([C.d("ImmigrateAssetModel")],Rc);var Pc=class extends J{toJSON(){return{immigrateAsset:this.immigrateAsset.toJSON()}}};p([_.d(1,Rc),h("design:type",Rc)],Pc.prototype,"immigrateAsset",void 0),Pc=p([C.d("ImmigrateAssetAssetModel")],Pc);var vn,Zu=new WeakMap,er=vn=class extends J{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=Zu.get(e);return t||(t=Object.freeze(e.map(r=>Ne(r))),Zu.set(e,t)),t}set cipherPublicKeys(e){const t=[];for(const r of e)t.push(me(r));Object.isFrozen(e)&&Zu.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return{magic:this.toExchangeSource,chainName:this.toExchangeChainName,assetType:this.toExchangeAsset,amount:this.toExchangeNumber}}get be(){return{magic:this.beExchangeSource,chainName:this.beExchangeChainName,assetType:this.beExchangeAsset}}toJSON(){return{cipherPublicKeys:this.cipherPublicKeys,toExchangeSource:this.toExchangeSource,beExchangeSource:this.beExchangeSource,toExchangeChainName:this.toExchangeChainName,beExchangeChainName:this.beExchangeChainName,toExchangeAsset:this.toExchangeAsset,beExchangeAsset:this.beExchangeAsset,toExchangeNumber:this.toExchangeNumber,exchangeRate:this.exchangeRate.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};er.INC=1,p([_.d(vn.INC++,"bytes","repeated"),h("design:type",Array)],er.prototype,"cipherPublicKeysBuffer",void 0),p([_.d(vn.INC++,"string"),h("design:type",String)],er.prototype,"toExchangeSource",void 0),p([_.d(vn.INC++,"string"),h("design:type",String)],er.prototype,"beExchangeSource",void 0),p([_.d(vn.INC++,"string"),h("design:type",String)],er.prototype,"toExchangeChainName",void 0),p([_.d(vn.INC++,"string"),h("design:type",String)],er.prototype,"beExchangeChainName",void 0),p([_.d(vn.INC++,"string"),h("design:type",String)],er.prototype,"toExchangeAsset",void 0),p([_.d(vn.INC++,"string"),h("design:type",String)],er.prototype,"beExchangeAsset",void 0),p([_.d(vn.INC++,"string"),h("design:type",String)],er.prototype,"toExchangeNumber",void 0),p([_.d(vn.INC++,$a),h("design:type",$a)],er.prototype,"exchangeRate",void 0),p([ie,h("design:type",Object),h("design:paramtypes",[])],er.prototype,"to",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],er.prototype,"be",null),er=vn=p([C.d("ToExchangeAssetModel")],er);var xc=class extends J{toJSON(){return{toExchangeAsset:this.toExchangeAsset.toJSON()}}};p([_.d(1,er),h("design:type",er)],xc.prototype,"toExchangeAsset",void 0),xc=p([C.d("ToExchangeAssetAssetModel")],xc);var Mi,eg=new WeakMap,Cn=Mi=class extends J{get transactionSignature(){return Ne(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=me(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=pt.decode(e);return eg.set(t,e),t}set ciphertextSignature(e){if(e){let t=eg.get(e);t||(t=pt.encode(e).finish(),eg.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}get to(){return{magic:this.exchangeAsset.toExchangeSource,chainName:this.exchangeAsset.toExchangeChainName,assetType:this.exchangeAsset.toExchangeAsset,amount:this.toExchangeNumber}}get be(){return{magic:this.exchangeAsset.beExchangeSource,chainName:this.exchangeAsset.beExchangeChainName,assetType:this.exchangeAsset.beExchangeAsset,amount:this.beExchangeNumber}}get exchangeRate(){return this.exchangeAsset.exchangeRate}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeNumber:this.toExchangeNumber,beExchangeNumber:this.beExchangeNumber,exchangeAsset:this.exchangeAsset.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=pt.fromObject(e.ciphertextSignature))),t}};Cn.INC=1,p([_.d(Mi.INC++,"bytes"),h("design:type",Uint8Array)],Cn.prototype,"transactionSignatureBuffer",void 0),p([_.d(Mi.INC++,"bytes","optional"),h("design:type",Uint8Array)],Cn.prototype,"ciphertextSignatureBuffer",void 0),p([_.d(Mi.INC++,"string"),h("design:type",String)],Cn.prototype,"toExchangeNumber",void 0),p([_.d(Mi.INC++,"string"),h("design:type",String)],Cn.prototype,"beExchangeNumber",void 0),p([_.d(Mi.INC++,er),h("design:type",er)],Cn.prototype,"exchangeAsset",void 0),p([ie,h("design:type",Object),h("design:paramtypes",[])],Cn.prototype,"to",null),Cn=Mi=p([C.d("BeExchangeAssetModel")],Cn);var Bc=class extends J{toJSON(){return{beExchangeAsset:this.beExchangeAsset.toJSON()}}};p([_.d(1,Cn),h("design:type",Cn)],Bc.prototype,"beExchangeAsset",void 0),Bc=p([C.d("BeExchangeAssetAssetModel")],Bc);var ti,Rn=ti=class extends J{toJSON(){return{stakeId:this.stakeId,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,assetPrealnum:this.assetPrealnum,beginUnstakeHeight:this.beginUnstakeHeight}}};Rn.INC=1,p([_.d(ti.INC++,"string"),h("design:type",String)],Rn.prototype,"stakeId",void 0),p([_.d(ti.INC++,"string"),h("design:type",String)],Rn.prototype,"sourceChainName",void 0),p([_.d(ti.INC++,"string"),h("design:type",String)],Rn.prototype,"sourceChainMagic",void 0),p([_.d(ti.INC++,"string"),h("design:type",String)],Rn.prototype,"assetType",void 0),p([_.d(ti.INC++,"string"),h("design:type",String)],Rn.prototype,"assetPrealnum",void 0),p([_.d(ti.INC++,"uint32"),h("design:type",Number)],Rn.prototype,"beginUnstakeHeight",void 0),Rn=ti=p([C.d("StakeAssetModel")],Rn);var Hc=class extends J{toJSON(){return{stakeAsset:this.stakeAsset.toJSON()}}};p([_.d(1,Rn),h("design:type",Rn)],Hc.prototype,"stakeAsset",void 0),Hc=p([C.d("StakeAssetAssetModel")],Hc);var Di,rs=Di=class extends J{toJSON(){return{stakeId:this.stakeId,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,assetPrealnum:this.assetPrealnum}}};rs.INC=1,p([_.d(Di.INC++,"string"),h("design:type",String)],rs.prototype,"stakeId",void 0),p([_.d(Di.INC++,"string"),h("design:type",String)],rs.prototype,"sourceChainName",void 0),p([_.d(Di.INC++,"string"),h("design:type",String)],rs.prototype,"sourceChainMagic",void 0),p([_.d(Di.INC++,"string"),h("design:type",String)],rs.prototype,"assetType",void 0),p([_.d(Di.INC++,"string"),h("design:type",String)],rs.prototype,"assetPrealnum",void 0),rs=Di=p([C.d("UnstakeAssetModel")],rs);var kc=class extends J{toJSON(){return{unstakeAsset:this.unstakeAsset.toJSON()}}};p([_.d(1,rs),h("design:type",rs)],kc.prototype,"unstakeAsset",void 0),kc=p([C.d("UnstakeAssetAssetModel")],kc);var ri=class extends J{toJSON(){return{name:this.name,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,operationType:this.operationType}}};p([_.d(1,"string"),h("design:type",String)],ri.prototype,"name",void 0),p([_.d(2,"string"),h("design:type",String)],ri.prototype,"sourceChainName",void 0),p([_.d(3,"string"),h("design:type",String)],ri.prototype,"sourceChainMagic",void 0),p([_.d(4,"uint32"),h("design:type",Number)],ri.prototype,"operationType",void 0),ri=p([C.d("LocationNameInfo")],ri);var Lc=class extends J{toJSON(){return{locationName:this.locationName.toJSON()}}};p([_.d(1,ri),h("design:type",ri)],Lc.prototype,"locationName",void 0),Lc=p([C.d("LocationNameAssetModel")],Lc);var Fi=class extends J{toJSON(){return{name:this.name,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic}}};p([_.d(1,"string"),h("design:type",String)],Fi.prototype,"name",void 0),p([_.d(2,"string"),h("design:type",String)],Fi.prototype,"sourceChainName",void 0),p([_.d(3,"string"),h("design:type",String)],Fi.prototype,"sourceChainMagic",void 0),Fi=p([C.d("SetLnsManagerModel")],Fi);var Mc=class extends J{toJSON(){return{lnsManager:this.lnsManager.toJSON()}}};p([_.d(1,Fi),h("design:type",Fi)],Mc.prototype,"lnsManager",void 0),Mc=p([C.d("SetLnsManagerAssetModel")],Mc);var ni=class extends J{toJSON(){return{recordType:this.recordType,recordValue:this.recordValue}}};p([_.d(1,"int32"),h("design:type",Number)],ni.prototype,"recordType",void 0),p([_.d(2,"string"),h("design:type",String)],ni.prototype,"recordValue",void 0),ni=p([C.d("LocationNameRecordInfo")],ni);var si,Pn=si=class extends J{toJSON(){const e={name:this.name,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,operationType:this.operationType};return this.addRecord&&(e.addRecord=this.addRecord.toJSON()),this.deleteRecord&&(e.deleteRecord=this.deleteRecord.toJSON()),e}};Pn.INC=1,p([_.d(si.INC++,"string"),h("design:type",String)],Pn.prototype,"name",void 0),p([_.d(si.INC++,"string"),h("design:type",String)],Pn.prototype,"sourceChainName",void 0),p([_.d(si.INC++,"string"),h("design:type",String)],Pn.prototype,"sourceChainMagic",void 0),p([_.d(si.INC++,"uint32"),h("design:type",Number)],Pn.prototype,"operationType",void 0),p([_.d(si.INC++,ni,"optional"),h("design:type",ni)],Pn.prototype,"addRecord",void 0),p([_.d(si.INC++,ni,"optional"),h("design:type",ni)],Pn.prototype,"deleteRecord",void 0),Pn=si=p([C.d("SetLnsRecordValueModel")],Pn);var Dc=class extends J{toJSON(){return{lnsRecordValue:this.lnsRecordValue.toJSON()}}};p([_.d(1,Pn),h("design:type",Pn)],Dc.prototype,"lnsRecordValue",void 0),Dc=p([C.d("SetLnsRecordValueAssetModel")],Dc);var Wh=class extends J{toJSON(){return{senderPaidFeeRate:this.senderPaidFeeRate.toJSON(),recipientPaidFeeRate:this.recipientPaidFeeRate.toJSON()}}};p([_.d(1,qn),h("design:type",qn)],Wh.prototype,"senderPaidFeeRate",void 0),p([_.d(2,qn),h("design:type",qn)],Wh.prototype,"recipientPaidFeeRate",void 0),Wh=p([C.d("FeeRateModel")],Wh);var ii,Yt=ii=class extends J{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,factoryId:this.factoryId,entityPrealnum:this.entityPrealnum,entityFrozenAssetPrealnum:this.entityFrozenAssetPrealnum,purchaseAssetPrealnum:this.purchaseAssetPrealnum}}};Yt.INC=1,p([_.d(ii.INC++,"string"),h("design:type",String)],Yt.prototype,"sourceChainName",void 0),p([_.d(ii.INC++,"string"),h("design:type",String)],Yt.prototype,"sourceChainMagic",void 0),p([_.d(ii.INC++,"string"),h("design:type",String)],Yt.prototype,"factoryId",void 0),p([_.d(ii.INC++,"string"),h("design:type",String)],Yt.prototype,"entityPrealnum",void 0),p([_.d(ii.INC++,"string"),h("design:type",String)],Yt.prototype,"entityFrozenAssetPrealnum",void 0),p([_.d(ii.INC++,"string"),h("design:type",String)],Yt.prototype,"purchaseAssetPrealnum",void 0),Yt=ii=p([C.d("IssueEntityFactoryModel")],Yt);var Ui=class extends J{toJSON(){return{issueEntityFactory:this.issueEntityFactory.toJSON()}}};p([_.d(1,Yt),h("design:type",Yt)],Ui.prototype,"issueEntityFactory",void 0),Ui=p([C.d("IssueEntityFactoryAssetModel")],Ui);var $i,gn=$i=class extends J{toJSON(){const e={sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,entityId:this.entityId,taxAssetPrealnum:this.taxAssetPrealnum,entityFactoryPossessor:this.entityFactoryPossessor,entityFactory:this.entityFactory.toJSON()};return this.taxAssetRecipientId&&(e.taxAssetRecipientId=this.taxAssetRecipientId),e}};gn.INC=1,p([_.d($i.INC++,"string"),h("design:type",String)],gn.prototype,"sourceChainName",void 0),p([_.d($i.INC++,"string"),h("design:type",String)],gn.prototype,"sourceChainMagic",void 0),p([_.d($i.INC++,"string"),h("design:type",String)],gn.prototype,"entityId",void 0),p([_.d(Yt.INC++,"string"),h("design:type",String)],gn.prototype,"taxAssetPrealnum",void 0),p([_.d($i.INC++,"string"),h("design:type",String)],gn.prototype,"entityFactoryPossessor",void 0),p([_.d($i.INC++,Yt),h("design:type",Yt)],gn.prototype,"entityFactory",void 0),p([_.d(Yt.INC++,"string","optional"),h("design:type",String)],gn.prototype,"taxAssetRecipientId",void 0),gn=$i=p([C.d("IssueEntityModel")],gn);var Fc=class extends J{toJSON(){return{issueEntity:this.issueEntity.toJSON()}}};p([_.d(1,gn),h("design:type",gn)],Fc.prototype,"issueEntity",void 0),Fc=p([C.d("IssueEntityAssetModel")],Fc);var Es,fn=Es=class extends J{get transactionSignature(){return Ne(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=me(e)}toJSON(){return{transactionSignature:this.transactionSignature,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,entityId:this.entityId,entityFactoryApplicant:this.entityFactoryApplicant,entityFactoryPossessor:this.entityFactoryPossessor,entityFactory:this.entityFactory.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.transactionSignature&&(t.transactionSignature=e.transactionSignature),t}};fn.INC=1,p([_.d(Es.INC++,"bytes"),h("design:type",Uint8Array)],fn.prototype,"transactionSignatureBuffer",void 0),p([_.d(Es.INC++,"string"),h("design:type",String)],fn.prototype,"sourceChainName",void 0),p([_.d(Es.INC++,"string"),h("design:type",String)],fn.prototype,"sourceChainMagic",void 0),p([_.d(Es.INC++,"string"),h("design:type",String)],fn.prototype,"entityId",void 0),p([_.d(Es.INC++,"string"),h("design:type",String)],fn.prototype,"entityFactoryApplicant",void 0),p([_.d(Es.INC++,"string"),h("design:type",String)],fn.prototype,"entityFactoryPossessor",void 0),p([_.d(Es.INC++,Yt),h("design:type",Yt)],fn.prototype,"entityFactory",void 0),fn=Es=p([C.d("DestroyEntityModel")],fn);var Uc=class extends J{toJSON(){return{destroyEntity:this.destroyEntity.toJSON()}}};p([_.d(1,fn),h("design:type",fn)],Uc.prototype,"destroyEntity",void 0),Uc=p([C.d("DestroyEntityAssetModel")],Uc);var Vi,za=class extends J{toJSON(){const e={entityId:this.entityId,taxAssetPrealnum:this.taxAssetPrealnum};return this.taxAssetRecipientId&&(e.taxAssetRecipientId=this.taxAssetRecipientId),e}};p([_.d(1,"string"),h("design:type",String)],za.prototype,"entityId",void 0),p([_.d(2,"string"),h("design:type",String)],za.prototype,"taxAssetPrealnum",void 0),p([_.d(3,"string","optional"),h("design:type",String)],za.prototype,"taxAssetRecipientId",void 0),za=p([C.d("EntityStructModel")],za);var ns=Vi=class extends J{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,entityStructList:this.entityStructList.map(e=>e.toJSON()),entityFactoryPossessor:this.entityFactoryPossessor,entityFactory:this.entityFactory.toJSON()}}};ns.INC=1,p([_.d(Vi.INC++,"string"),h("design:type",String)],ns.prototype,"sourceChainName",void 0),p([_.d(Vi.INC++,"string"),h("design:type",String)],ns.prototype,"sourceChainMagic",void 0),p([_.d(Vi.INC++,za,"repeated"),h("design:type",Array)],ns.prototype,"entityStructList",void 0),p([_.d(Vi.INC++,"string"),h("design:type",String)],ns.prototype,"entityFactoryPossessor",void 0),p([_.d(Vi.INC++,Yt),h("design:type",Yt)],ns.prototype,"entityFactory",void 0),ns=Vi=p([C.d("IssueEntityMultiModel")],ns);var $c=class extends J{toJSON(){return{issueEntityMulti:this.issueEntityMulti.toJSON()}}};p([_.d(1,ns),h("design:type",ns)],$c.prototype,"issueEntityMulti",void 0),$c=p([C.d("IssueEntityMultiAssetModel")],$c);var ss=class extends J{toJSON(){const e={sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,parentAssetType:this.parentAssetType,assetType:this.assetType,amount:this.amount};return this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};p([_.d(1,"string"),h("design:type",String)],ss.prototype,"sourceChainName",void 0),p([_.d(2,"string"),h("design:type",String)],ss.prototype,"sourceChainMagic",void 0),p([_.d(3,G),h("design:type",Number)],ss.prototype,"parentAssetType",void 0),p([_.d(4,"string"),h("design:type",String)],ss.prototype,"assetType",void 0),p([_.d(5,"string"),h("design:type",String)],ss.prototype,"amount",void 0),p([_.d(6,Vt,"optional"),h("design:type",Vt)],ss.prototype,"taxInformation",void 0),ss=p([C.d("TransferAnyModel")],ss);var Vc=class extends J{toJSON(){return{transferAny:this.transferAny.toJSON()}}};p([_.d(1,ss),h("design:type",ss)],Vc.prototype,"transferAny",void 0),Vc=p([C.d("TransferAnyAssetModel")],Vc);var dn,Lm=new WeakMap,ar=dn=class extends J{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=Lm.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Ne(r))),t}set cipherPublicKeys(e){const t=e.map(r=>me(r));Lm.set(t,e),this.cipherPublicKeysBuffer=t}toJSON(){const e={cipherPublicKeys:this.cipherPublicKeys,sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,parentAssetType:this.parentAssetType,assetType:this.assetType,amount:this.amount,totalGrabableTimes:this.totalGrabableTimes};return this.giftDistributionRule!==void 0&&(e.giftDistributionRule=this.giftDistributionRule),this.beginUnfrozenBlockHeight&&(e.beginUnfrozenBlockHeight=this.beginUnfrozenBlockHeight),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};ar.INC=1,p([_.d(dn.INC++,"bytes","repeated"),h("design:type",Array)],ar.prototype,"cipherPublicKeysBuffer",void 0),p([_.d(dn.INC++,"string"),h("design:type",String)],ar.prototype,"sourceChainMagic",void 0),p([_.d(dn.INC++,"string"),h("design:type",String)],ar.prototype,"sourceChainName",void 0),p([_.d(dn.INC++,G),h("design:type",Number)],ar.prototype,"parentAssetType",void 0),p([_.d(dn.INC++,"string"),h("design:type",String)],ar.prototype,"assetType",void 0),p([_.d(dn.INC++,"string"),h("design:type",String)],ar.prototype,"amount",void 0),p([_.d(dn.INC++,"uint32"),h("design:type",Number)],ar.prototype,"totalGrabableTimes",void 0),p([_.d(dn.INC++,"uint32","optional"),h("design:type",Number)],ar.prototype,"beginUnfrozenBlockHeight",void 0),p([_.d(dn.INC++,"uint32","optional"),h("design:type",Number)],ar.prototype,"giftDistributionRule",void 0),p([_.d(dn.INC++,Vt,"optional"),h("design:type",Vt)],ar.prototype,"taxInformation",void 0),ar=dn=p([C.d("GiftAnyModel")],ar);var Gc=class extends J{toJSON(){return{giftAny:this.giftAny.toJSON()}}};p([_.d(1,ar),h("design:type",ar)],Gc.prototype,"giftAny",void 0),Gc=p([C.d("GiftAnyAssetModel")],Gc);var Gi,tg=new WeakMap,is=Gi=class extends J{get blockSignature(){return Ne(this.blockSignatureBuffer)}set blockSignature(e){this.blockSignatureBuffer=me(e)}get transactionSignature(){return Ne(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=me(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=pt.decode(e);return tg.set(t,e),t}set ciphertextSignature(e){if(e){let t=tg.get(e);t||(t=pt.encode(e).finish(),tg.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={blockSignature:this.blockSignature,transactionSignature:this.transactionSignature,amount:this.amount,giftAny:this.giftAny.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.blockSignature&&(t.blockSignature=e.blockSignature),e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=pt.fromObject(e.ciphertextSignature))),t}};is.INC=1,p([_.d(Gi.INC++,"bytes"),h("design:type",Uint8Array)],is.prototype,"blockSignatureBuffer",void 0),p([_.d(Gi.INC++,"bytes"),h("design:type",Uint8Array)],is.prototype,"transactionSignatureBuffer",void 0),p([_.d(Gi.INC++,"string"),h("design:type",String)],is.prototype,"amount",void 0),p([_.d(Gi.INC++,"bytes","optional"),h("design:type",Uint8Array)],is.prototype,"ciphertextSignatureBuffer",void 0),p([_.d(Gi.INC++,ar),h("design:type",ar)],is.prototype,"giftAny",void 0),is=Gi=p([C.d("GrabAnyModel")],is);var Kc=class extends J{toJSON(){return{grabAny:this.grabAny.toJSON()}}};p([_.d(1,is),h("design:type",is)],Kc.prototype,"grabAny",void 0),Kc=p([C.d("GrabAnyAssetModel")],Kc);var vr,Mm=new WeakMap,ai=class extends J{toJSON(){return{toExchangeAssetWeight:this.toExchangeAssetWeight,beExchangeAssetWeight:this.beExchangeAssetWeight}}};p([_.d(1,"string"),h("design:type",String)],ai.prototype,"toExchangeAssetWeight",void 0),p([_.d(2,"string"),h("design:type",String)],ai.prototype,"beExchangeAssetWeight",void 0),ai=p([C.d("AssetExchangeWeightRatioModel")],ai);var Ct=vr=class extends J{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=Mm.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Ne(r))),t}set cipherPublicKeys(e){const t=e.map(r=>me(r));Mm.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return{magic:this.toExchangeSource,chainName:this.toExchangeChainName,toExchangeAssetType:this.toExchangeAssetType,toExchangeParentAssetType:this.toExchangeParentAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum}}get be(){return{magic:this.beExchangeSource,chainName:this.beExchangeChainName,beExchangeAssetType:this.beExchangeAssetType,beExchangeParentAssetType:this.beExchangeParentAssetType,beExchangeAssetPrealnum:this.beExchangeAssetPrealnum||"1"}}toJSON(){const e={cipherPublicKeys:this.cipherPublicKeys,toExchangeSource:this.toExchangeSource,beExchangeSource:this.beExchangeSource,toExchangeChainName:this.toExchangeChainName,beExchangeChainName:this.beExchangeChainName,toExchangeAssetType:this.toExchangeAssetType,beExchangeAssetType:this.beExchangeAssetType,toExchangeParentAssetType:this.toExchangeParentAssetType,beExchangeParentAssetType:this.beExchangeParentAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum};return this.beExchangeAssetPrealnum&&(e.beExchangeAssetPrealnum=this.beExchangeAssetPrealnum),this.assetExchangeWeightRatio&&(e.assetExchangeWeightRatio=this.assetExchangeWeightRatio.toJSON()),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Ct.INC=1,p([_.d(vr.INC++,"bytes","repeated"),h("design:type",Array)],Ct.prototype,"cipherPublicKeysBuffer",void 0),p([_.d(vr.INC++,"string"),h("design:type",String)],Ct.prototype,"toExchangeSource",void 0),p([_.d(vr.INC++,"string"),h("design:type",String)],Ct.prototype,"beExchangeSource",void 0),p([_.d(vr.INC++,"string"),h("design:type",String)],Ct.prototype,"toExchangeChainName",void 0),p([_.d(vr.INC++,"string"),h("design:type",String)],Ct.prototype,"beExchangeChainName",void 0),p([_.d(vr.INC++,G),h("design:type",Number)],Ct.prototype,"toExchangeParentAssetType",void 0),p([_.d(vr.INC++,G),h("design:type",Number)],Ct.prototype,"beExchangeParentAssetType",void 0),p([_.d(vr.INC++,"string"),h("design:type",String)],Ct.prototype,"toExchangeAssetType",void 0),p([_.d(vr.INC++,"string"),h("design:type",String)],Ct.prototype,"beExchangeAssetType",void 0),p([_.d(vr.INC++,"string"),h("design:type",String)],Ct.prototype,"toExchangeAssetPrealnum",void 0),p([_.d(vr.INC++,"string","optional"),h("design:type",String)],Ct.prototype,"beExchangeAssetPrealnum",void 0),p([_.d(vr.INC++,ai,"optional"),h("design:type",ai)],Ct.prototype,"assetExchangeWeightRatio",void 0),p([_.d(vr.INC++,Vt,"optional"),h("design:type",Vt)],Ct.prototype,"taxInformation",void 0),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ct.prototype,"to",null),Ct=vr=p([C.d("ToExchangeAnyModel")],Ct);var jc=class extends J{toJSON(){return{toExchangeAny:this.toExchangeAny.toJSON()}}};p([_.d(1,Ct),h("design:type",Ct)],jc.prototype,"toExchangeAny",void 0),jc=p([C.d("ToExchangeAnyAssetModel")],jc);var Ki,rg=new WeakMap,xn=Ki=class extends J{get transactionSignature(){return Ne(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=me(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=pt.decode(e);return rg.set(t,e),t}set ciphertextSignature(e){if(e){let t=rg.get(e);t||(t=pt.encode(e).finish(),rg.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum,beExchangeAssetPrealnum:this.beExchangeAssetPrealnum,exchangeAny:this.exchangeAny.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=pt.fromObject(e.ciphertextSignature))),t}};xn.INC=1,p([_.d(Ki.INC++,"bytes"),h("design:type",Uint8Array)],xn.prototype,"transactionSignatureBuffer",void 0),p([_.d(Ki.INC++,"bytes","optional"),h("design:type",Uint8Array)],xn.prototype,"ciphertextSignatureBuffer",void 0),p([_.d(Ki.INC++,"string"),h("design:type",String)],xn.prototype,"toExchangeAssetPrealnum",void 0),p([_.d(Ki.INC++,"string"),h("design:type",String)],xn.prototype,"beExchangeAssetPrealnum",void 0),p([_.d(Ki.INC++,Ct),h("design:type",Ct)],xn.prototype,"exchangeAny",void 0),p([_.d(Ct.INC++,Vt,"optional"),h("design:type",Vt)],xn.prototype,"taxInformation",void 0),xn=Ki=p([C.d("BeExchangeAnyModel")],xn);var zc=class extends J{toJSON(){return{beExchangeAny:this.beExchangeAny.toJSON()}}};p([_.d(1,xn),h("design:type",xn)],zc.prototype,"beExchangeAny",void 0),zc=p([C.d("BeExchangeAnyAssetModel")],zc);var Ts,ji,Jc,Dm=new WeakMap,Gr=Ts=class extends J{toJSON(){const e={toExchangeSource:this.toExchangeSource,toExchangeChainName:this.toExchangeChainName,toExchangeParentAssetType:this.toExchangeParentAssetType,toExchangeAssetType:this.toExchangeAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum};return this.assetExchangeWeightRatio&&(e.assetExchangeWeightRatio=this.assetExchangeWeightRatio.toJSON()),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};Gr.INC=1,p([_.d(Ts.INC++,"string"),h("design:type",String)],Gr.prototype,"toExchangeSource",void 0),p([_.d(Ts.INC++,"string"),h("design:type",String)],Gr.prototype,"toExchangeChainName",void 0),p([_.d(Ts.INC++,G),h("design:type",Number)],Gr.prototype,"toExchangeParentAssetType",void 0),p([_.d(Ts.INC++,"string"),h("design:type",String)],Gr.prototype,"toExchangeAssetType",void 0),p([_.d(Ts.INC++,"string"),h("design:type",String)],Gr.prototype,"toExchangeAssetPrealnum",void 0),p([_.d(Ts.INC++,ai,"optional"),h("design:type",ai)],Gr.prototype,"assetExchangeWeightRatio",void 0),p([_.d(Ts.INC++,Vt,"optional"),h("design:type",Vt)],Gr.prototype,"taxInformation",void 0),Gr=Ts=p([C.d("ToExchangeAssetV1Model")],Gr);var Kr=ji=class extends J{toJSON(){const e={beExchangeSource:this.beExchangeSource,beExchangeChainName:this.beExchangeChainName,beExchangeParentAssetType:this.beExchangeParentAssetType,beExchangeAssetType:this.beExchangeAssetType};return this.beExchangeAssetPrealnum&&(e.beExchangeAssetPrealnum=this.beExchangeAssetPrealnum),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};Kr.INC=1,p([_.d(ji.INC++,"string"),h("design:type",String)],Kr.prototype,"beExchangeSource",void 0),p([_.d(ji.INC++,"string"),h("design:type",String)],Kr.prototype,"beExchangeChainName",void 0),p([_.d(ji.INC++,G),h("design:type",Number)],Kr.prototype,"beExchangeParentAssetType",void 0),p([_.d(ji.INC++,"string"),h("design:type",String)],Kr.prototype,"beExchangeAssetType",void 0),p([_.d(ji.INC++,"string","optional"),h("design:type",String)],Kr.prototype,"beExchangeAssetPrealnum",void 0),p([_.d(Gr.INC++,Vt,"optional"),h("design:type",Vt)],Kr.prototype,"taxInformation",void 0),Kr=ji=p([C.d("BeExchangeAssetV1Model")],Kr);var Ss=Jc=class extends J{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=Dm.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Ne(r))),t}set cipherPublicKeys(e){const t=e.map(r=>me(r));Dm.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return this.toExchangeAssets.map(e=>e.toJSON())}get be(){return this.beExchangeAsset.toJSON()}toJSON(){return{cipherPublicKeys:this.cipherPublicKeys,toExchangeAssets:this.toExchangeAssets.map(e=>e.toJSON()),beExchangeAsset:this.beExchangeAsset.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Ss.INC=1,p([_.d(Jc.INC++,"bytes","repeated"),h("design:type",Array)],Ss.prototype,"cipherPublicKeysBuffer",void 0),p([_.d(Jc.INC++,Gr,"repeated"),h("design:type",Array)],Ss.prototype,"toExchangeAssets",void 0),p([_.d(Jc.INC++,Kr),h("design:type",Kr)],Ss.prototype,"beExchangeAsset",void 0),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ss.prototype,"to",null),Ss=Jc=p([C.d("ToExchangeAnyMultiModel")],Ss);var Yc=class extends J{toJSON(){return{toExchangeAnyMulti:this.toExchangeAnyMulti.toJSON()}}};p([_.d(1,Ss),h("design:type",Ss)],Yc.prototype,"toExchangeAnyMulti",void 0),Yc=p([C.d("ToExchangeAnyMultiAssetModel")],Yc);var Ja,ng=new WeakMap,bs=Ja=class extends J{get transactionSignature(){return Ne(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=me(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=pt.decode(e);return ng.set(t,e),t}set ciphertextSignature(e){if(e){let t=ng.get(e);t||(t=pt.encode(e).finish(),ng.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeAssets:this.toExchangeAssets.map(t=>t.toJSON()),beExchangeAsset:this.beExchangeAsset.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=pt.fromObject(e.ciphertextSignature))),t}};bs.INC=1,p([_.d(Ja.INC++,"bytes"),h("design:type",Uint8Array)],bs.prototype,"transactionSignatureBuffer",void 0),p([_.d(Ja.INC++,"bytes","optional"),h("design:type",Uint8Array)],bs.prototype,"ciphertextSignatureBuffer",void 0),p([_.d(Ja.INC++,Gr,"repeated"),h("design:type",Array)],bs.prototype,"toExchangeAssets",void 0),p([_.d(Ja.INC++,Kr),h("design:type",Kr)],bs.prototype,"beExchangeAsset",void 0),bs=Ja=p([C.d("BeExchangeAnyMultiModel")],bs);var Xc=class extends J{toJSON(){return{beExchangeAnyMulti:this.beExchangeAnyMulti.toJSON()}}};p([_.d(1,bs),h("design:type",bs)],Xc.prototype,"beExchangeAnyMulti",void 0),Xc=p([C.d("BeExchangeAnyMultiAssetModel")],Xc);var oi,zi,Qc,Fm=new WeakMap,yn=oi=class extends J{toJSON(){const e={toExchangeSource:this.toExchangeSource,toExchangeChainName:this.toExchangeChainName,toExchangeParentAssetType:this.toExchangeParentAssetType,toExchangeAssetType:this.toExchangeAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum};return this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};yn.INC=1,p([_.d(oi.INC++,"string"),h("design:type",String)],yn.prototype,"toExchangeSource",void 0),p([_.d(oi.INC++,"string"),h("design:type",String)],yn.prototype,"toExchangeChainName",void 0),p([_.d(oi.INC++,G),h("design:type",Number)],yn.prototype,"toExchangeParentAssetType",void 0),p([_.d(oi.INC++,"string"),h("design:type",String)],yn.prototype,"toExchangeAssetType",void 0),p([_.d(oi.INC++,"string"),h("design:type",String)],yn.prototype,"toExchangeAssetPrealnum",void 0),p([_.d(oi.INC++,Vt,"optional"),h("design:type",Vt)],yn.prototype,"taxInformation",void 0),yn=oi=p([C.d("ToExchangeAssetV2Model")],yn);var Bn=zi=class extends J{toJSON(){const e={beExchangeSource:this.beExchangeSource,beExchangeChainName:this.beExchangeChainName,beExchangeParentAssetType:this.beExchangeParentAssetType,beExchangeAssetType:this.beExchangeAssetType,beExchangeAssetPrealnum:this.beExchangeAssetPrealnum};return this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};Bn.INC=1,p([_.d(zi.INC++,"string"),h("design:type",String)],Bn.prototype,"beExchangeSource",void 0),p([_.d(zi.INC++,"string"),h("design:type",String)],Bn.prototype,"beExchangeChainName",void 0),p([_.d(zi.INC++,G),h("design:type",Number)],Bn.prototype,"beExchangeParentAssetType",void 0),p([_.d(zi.INC++,"string"),h("design:type",String)],Bn.prototype,"beExchangeAssetType",void 0),p([_.d(zi.INC++,"string"),h("design:type",String)],Bn.prototype,"beExchangeAssetPrealnum",void 0),p([_.d(yn.INC++,Vt,"optional"),h("design:type",Vt)],Bn.prototype,"taxInformation",void 0),Bn=zi=p([C.d("BeExchangeAssetV2Model")],Bn);var ws=Qc=class extends J{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=Fm.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Ne(r))),t}set cipherPublicKeys(e){const t=e.map(r=>me(r));Fm.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return this.toExchangeAssets.map(e=>e.toJSON())}get be(){return this.beExchangeAssets.map(e=>e.toJSON())}toJSON(){return{cipherPublicKeys:this.cipherPublicKeys,toExchangeAssets:this.toExchangeAssets.map(e=>e.toJSON()),beExchangeAssets:this.beExchangeAssets.map(e=>e.toJSON())}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};ws.INC=1,p([_.d(Qc.INC++,"bytes","repeated"),h("design:type",Array)],ws.prototype,"cipherPublicKeysBuffer",void 0),p([_.d(Qc.INC++,yn,"repeated"),h("design:type",Array)],ws.prototype,"toExchangeAssets",void 0),p([_.d(Qc.INC++,Bn,"repeated"),h("design:type",Array)],ws.prototype,"beExchangeAssets",void 0),p([ie,h("design:type",Object),h("design:paramtypes",[])],ws.prototype,"to",null),ws=Qc=p([C.d("ToExchangeAnyMultiAllModel")],ws);var qc=class extends J{toJSON(){return{toExchangeAnyMultiAll:this.toExchangeAnyMultiAll.toJSON()}}};p([_.d(1,ws),h("design:type",ws)],qc.prototype,"toExchangeAnyMultiAll",void 0),qc=p([C.d("ToExchangeAnyMultiAllAssetModel")],qc);var Ya,sg=new WeakMap,Ns=Ya=class extends J{get transactionSignature(){return Ne(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=me(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=pt.decode(e);return sg.set(t,e),t}set ciphertextSignature(e){if(e){let t=sg.get(e);t||(t=pt.encode(e).finish(),sg.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeAssets:this.toExchangeAssets.map(t=>t.toJSON()),beExchangeAssets:this.beExchangeAssets.map(t=>t.toJSON())};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=pt.fromObject(e.ciphertextSignature))),t}};Ns.INC=1,p([_.d(Ya.INC++,"bytes"),h("design:type",Uint8Array)],Ns.prototype,"transactionSignatureBuffer",void 0),p([_.d(Ya.INC++,"bytes","optional"),h("design:type",Uint8Array)],Ns.prototype,"ciphertextSignatureBuffer",void 0),p([_.d(Ya.INC++,yn,"repeated"),h("design:type",Array)],Ns.prototype,"toExchangeAssets",void 0),p([_.d(Ya.INC++,Bn,"repeated"),h("design:type",Array)],Ns.prototype,"beExchangeAssets",void 0),Ns=Ya=p([C.d("BeExchangeAnyMultiAllModel")],Ns);var Wc=class extends J{toJSON(){return{beExchangeAnyMultiAll:this.beExchangeAnyMultiAll.toJSON()}}};p([_.d(1,Ns),h("design:type",Ns)],Wc.prototype,"beExchangeAnyMultiAll",void 0),Wc=p([C.d("BeExchangeAnyMultiAllAssetModel")],Wc);var Xa,Os=Xa=class extends J{toJSON(){return{sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,certificateId:this.certificateId,type:this.type}}};Os.INC=1,p([_.d(Xa.INC++,"string"),h("design:type",String)],Os.prototype,"sourceChainName",void 0),p([_.d(Xa.INC++,"string"),h("design:type",String)],Os.prototype,"sourceChainMagic",void 0),p([_.d(Xa.INC++,"string"),h("design:type",String)],Os.prototype,"certificateId",void 0),p([_.d(Xa.INC++,"uint32"),h("design:type",Number)],Os.prototype,"type",void 0),Os=Xa=p([C.d("IssueCertificateModel")],Os);var Zc=class extends J{toJSON(){return{issueCertificate:this.issueCertificate.toJSON()}}};p([_.d(1,Os),h("design:type",Os)],Zc.prototype,"issueCertificate",void 0),Zc=p([C.d("IssueCertificateAssetModel")],Zc);var Qa,vs=Qa=class extends J{toJSON(){return{sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,certificateId:this.certificateId,type:this.type}}};vs.INC=1,p([_.d(Qa.INC++,"string"),h("design:type",String)],vs.prototype,"sourceChainName",void 0),p([_.d(Qa.INC++,"string"),h("design:type",String)],vs.prototype,"sourceChainMagic",void 0),p([_.d(Qa.INC++,"string"),h("design:type",String)],vs.prototype,"certificateId",void 0),p([_.d(Qa.INC++,"uint32"),h("design:type",Number)],vs.prototype,"type",void 0),vs=Qa=p([C.d("DestroyCertificateModel")],vs);var ep=class extends J{toJSON(){return{destroyCertificate:this.destroyCertificate.toJSON()}}};p([_.d(1,vs),h("design:type",vs)],ep.prototype,"destroyCertificate",void 0),ep=p([C.d("DestroyCertificateAssetModel")],ep);var ig,tp=ig=class extends Ve{};p([_.d(ig.INC++,dc),h("design:type",dc)],tp.prototype,"asset",void 0),tp=ig=p([C.d("SignatureTransaction")],tp);var ag,rp=ag=class extends Ve{};p([_.d(ag.INC++,yc),h("design:type",yc)],rp.prototype,"asset",void 0),rp=ag=p([C.d("DAppTransaction")],rp);var og,np=og=class extends Ve{};p([_.d(og.INC++,mc),h("design:type",mc)],np.prototype,"asset",void 0),np=og=p([C.d("DAppPurchasingTransaction")],np);var cg,sp=cg=class extends Ve{};p([_.d(cg.INC++,Ac),h("design:type",Ac)],sp.prototype,"asset",void 0),sp=cg=p([C.d("MarkTransaction")],sp);var pg,ip=pg=class extends Ve{};p([_.d(pg.INC++,Ic),h("design:type",Ic)],ip.prototype,"asset",void 0),ip=pg=p([C.d("IssueAssetTransaction")],ip);var hg,ap=hg=class extends Ve{};p([_.d(hg.INC++,Ec),h("design:type",Ec)],ap.prototype,"asset",void 0),ap=hg=p([C.d("IncreaseAssetTransaction")],ap);var lg,op=lg=class extends Ve{};p([_.d(lg.INC++,Tc),h("design:type",Tc)],op.prototype,"asset",void 0),op=lg=p([C.d("TransferAssetTransaction")],op);var ug,cp=ug=class extends Ve{};p([_.d(ug.INC++,Sc),h("design:type",Sc)],cp.prototype,"asset",void 0),cp=ug=p([C.d("DestroyAssetTransaction")],cp);var gg,Ji=gg=class extends Ve{};p([_.d(gg.INC++,bc),h("design:type",bc)],Ji.prototype,"asset",void 0),Ji=gg=p([C.d("GiftAssetTransaction")],Ji);var fg,pp=fg=class extends Ve{};p([_.d(fg.INC++,wc),h("design:type",wc)],pp.prototype,"asset",void 0),pp=fg=p([C.d("GrabAssetTransaction")],pp);var dg,qa=dg=class extends Ve{};p([_.d(dg.INC++,Nc),h("design:type",Nc)],qa.prototype,"asset",void 0),qa=dg=p([C.d("TrustAssetTransaction")],qa);var yg,hp=yg=class extends Ve{};p([_.d(yg.INC++,Oc),h("design:type",Oc)],hp.prototype,"asset",void 0),hp=yg=p([C.d("SignForAssetTransaction")],hp);var mg,lp=mg=class extends Ve{};p([_.d(mg.INC++,Cc),h("design:type",Cc)],lp.prototype,"asset",void 0),lp=mg=p([C.d("EmigrateAssetTransaction")],lp);var _g,up=_g=class extends Ve{};p([_.d(_g.INC++,Pc),h("design:type",Pc)],up.prototype,"asset",void 0),up=_g=p([C.d("ImmigrateAssetTransaction")],up);var Ag,Wa=Ag=class extends Ve{};p([_.d(Ag.INC++,xc),h("design:type",xc)],Wa.prototype,"asset",void 0),Wa=Ag=p([C.d("ToExchangeAssetTransaction")],Wa);var Ig,gp=Ig=class extends Ve{};p([_.d(Ig.INC++,Bc),h("design:type",Bc)],gp.prototype,"asset",void 0),gp=Ig=p([C.d("BeExchangeAssetTransaction")],gp);var Eg,Yi=Eg=class extends Ve{};p([_.d(Eg.INC++,Hc),h("design:type",Hc)],Yi.prototype,"asset",void 0),Yi=Eg=p([C.d("StakeAssetTransaction")],Yi);var Tg,fp=Tg=class extends Ve{};p([_.d(Tg.INC++,kc),h("design:type",kc)],fp.prototype,"asset",void 0),fp=Tg=p([C.d("UnstakeAssetTransaction")],fp);var Sg,dp=Sg=class extends Ve{};p([_.d(Sg.INC++,Lc),h("design:type",Lc)],dp.prototype,"asset",void 0),dp=Sg=p([C.d("LocationNameTransaction")],dp);var bg,yp=bg=class extends Ve{};p([_.d(bg.INC++,Mc),h("design:type",Mc)],yp.prototype,"asset",void 0),yp=bg=p([C.d("SetLnsManagerTransaction")],yp);var wg,mp=wg=class extends Ve{};p([_.d(wg.INC++,Dc),h("design:type",Dc)],mp.prototype,"asset",void 0),mp=wg=p([C.d("SetLnsRecordValueTransaction")],mp);var Ng,_p=Ng=class extends Ve{};p([_.d(Ng.INC++,Ui),h("design:type",Ui)],_p.prototype,"asset",void 0),_p=Ng=p([C.d("IssueEntityFactoryTransaction")],_p);var Og,Ap=Og=class extends Ve{};p([_.d(Og.INC++,Ui),h("design:type",Ui)],Ap.prototype,"asset",void 0),Ap=Og=p([C.d("IssueEntityFactoryTransactionV1")],Ap);var vg,Xi=vg=class extends Ve{};p([_.d(vg.INC++,Fc),h("design:type",Fc)],Xi.prototype,"asset",void 0),Xi=vg=p([C.d("IssueEntityTransaction")],Xi);var Cg,Ip=Cg=class extends Ve{};p([_.d(Cg.INC++,Uc),h("design:type",Uc)],Ip.prototype,"asset",void 0),Ip=Cg=p([C.d("DestroyEntityTransaction")],Ip);var Rg,Qi=Rg=class extends Ve{};p([_.d(Rg.INC++,$c),h("design:type",$c)],Qi.prototype,"asset",void 0),Qi=Rg=p([C.d("IssueEntityMultiTransaction")],Qi);var Pg,Ep=Pg=class extends Ve{};p([_.d(Pg.INC++,Vc),h("design:type",Vc)],Ep.prototype,"asset",void 0),Ep=Pg=p([C.d("TransferAnyTransaction")],Ep);var xg,qi=xg=class extends Ve{};p([_.d(xg.INC++,Gc),h("design:type",Gc)],qi.prototype,"asset",void 0),qi=xg=p([C.d("GiftAnyTransaction")],qi);var Bg,Tp=Bg=class extends Ve{};p([_.d(Bg.INC++,Kc),h("design:type",Kc)],Tp.prototype,"asset",void 0),Tp=Bg=p([C.d("GrabAnyTransaction")],Tp);var Hg,Za=Hg=class extends Ve{};p([_.d(Hg.INC++,jc),h("design:type",jc)],Za.prototype,"asset",void 0),Za=Hg=p([C.d("ToExchangeAnyTransaction")],Za);var kg,Sp=kg=class extends Ve{};p([_.d(kg.INC++,zc),h("design:type",zc)],Sp.prototype,"asset",void 0),Sp=kg=p([C.d("BeExchangeAnyTransaction")],Sp);var Lg,eo=Lg=class extends Ve{};p([_.d(Lg.INC++,Yc),h("design:type",Yc)],eo.prototype,"asset",void 0),eo=Lg=p([C.d("ToExchangeAnyMultiTransaction")],eo);var Mg,bp=Mg=class extends Ve{};p([_.d(Mg.INC++,Xc),h("design:type",Xc)],bp.prototype,"asset",void 0),bp=Mg=p([C.d("BeExchangeAnyMultiTransaction")],bp);var Dg,to=Dg=class extends Ve{};p([_.d(Dg.INC++,qc),h("design:type",qc)],to.prototype,"asset",void 0),to=Dg=p([C.d("ToExchangeAnyMultiAllTransaction")],to);var Fg,wp=Fg=class extends Ve{};p([_.d(Fg.INC++,Wc),h("design:type",Wc)],wp.prototype,"asset",void 0),wp=Fg=p([C.d("BeExchangeAnyMultiAllTransaction")],wp);var Ug,Np=Ug=class extends Ve{};p([_.d(Ug.INC++,Zc),h("design:type",Zc)],Np.prototype,"asset",void 0),Np=Ug=p([C.d("IssueCertificateTransaction")],Np);var $g,Op=$g=class extends Ve{};p([_.d($g.INC++,ep),h("design:type",ep)],Op.prototype,"asset",void 0),Op=$g=p([C.d("DestroyCertificateTransaction")],Op);var U=class{constructor(e,t){this.__code=e,this.__message=t}get code(){return this.__code}get message(){return this.__message}set message(e){this.__message=e}build(e){return e?this.__message.replace(/\{([^\\]+?)\}/g,(t,r)=>e[r]??t):this.__message}},Vg=Symbol("InjectionToken"),Gg=Symbol("SingletonToken"),Um=Symbol("GroupToken"),Kg=new WeakMap,$m=new WeakMap,Zh=[];function PE(e){return $m.get(e)||Zh[Zh.length-1]}var Vm="injectProps:afertInit",Gm="injectProps:onInit";function Km(e){return e[Vg]}function jm(e){const t=new Set;let r=e;for(;;){const n=r[Um];if(!n)break;for(const s of n)t.add(s);if(r=Object.getPrototypeOf(r),!r)break}return t}var zm;(function(e){(function(t){var r=typeof jy=="object"?jy:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=s(e);typeof r.Reflect>"u"?r.Reflect=e:n=s(r.Reflect,n),t(n);function s(i,o){return function(c,l){typeof i[c]!="function"&&Object.defineProperty(i,c,{configurable:!0,writable:!0,value:l}),o&&o(c,l)}}})(function(t){var r=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",s=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",i=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",c={__proto__:[]}instanceof Array,l=!o&&!c,u={create:o?function(){return Pa(Object.create(null))}:c?function(){return Pa({__proto__:null})}:function(){return Pa({})},has:l?function(Q,te){return r.call(Q,te)}:function(Q,te){return te in Q},get:l?function(Q,te){return r.call(Q,te)?Q[te]:void 0}:function(Q,te){return Q[te]}},g=Object.getPrototypeOf(Function),y=typeof process=="object"&&Uy&&Uy.REFLECT_METADATA_USE_MAP_POLYFILL==="true",m=!y&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ou(),d=!y&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:oc(),I=!y&&typeof WeakMap=="function"?WeakMap:Sn(),T=new I;function S(Q,te,he,f){if(oe(he)){if(!De(Q))throw new TypeError;if(!et(te))throw new TypeError;return x(Q,te)}else{if(!De(Q))throw new TypeError;if(!ce(te))throw new TypeError;if(!ce(f)&&!oe(f)&&!pe(f))throw new TypeError;return pe(f)&&(f=void 0),he=we(he),H(Q,te,he,f)}}t("decorate",S);function w(Q,te){function he(f,A){if(!ce(f))throw new TypeError;if(!oe(A)&&!mt(A))throw new TypeError;Te(Q,te,f,A)}return he}t("metadata",w);function b(Q,te,he,f){if(!ce(he))throw new TypeError;return oe(f)||(f=we(f)),Te(Q,te,he,f)}t("defineMetadata",b);function R(Q,te,he){if(!ce(te))throw new TypeError;return oe(he)||(he=we(he)),F(Q,te,he)}t("hasMetadata",R);function v(Q,te,he){if(!ce(te))throw new TypeError;return oe(he)||(he=we(he)),K(Q,te,he)}t("hasOwnMetadata",v);function $(Q,te,he){if(!ce(te))throw new TypeError;return oe(he)||(he=we(he)),X(Q,te,he)}t("getMetadata",$);function D(Q,te,he){if(!ce(te))throw new TypeError;return oe(he)||(he=we(he)),ye(Q,te,he)}t("getOwnMetadata",D);function L(Q,te){if(!ce(Q))throw new TypeError;return oe(te)||(te=we(te)),le(Q,te)}t("getMetadataKeys",L);function z(Q,te){if(!ce(Q))throw new TypeError;return oe(te)||(te=we(te)),ge(Q,te)}t("getOwnMetadataKeys",z);function Y(Q,te,he){if(!ce(te))throw new TypeError;oe(he)||(he=we(he));var f=M(te,he,!1);if(oe(f)||!f.delete(Q))return!1;if(f.size>0)return!0;var A=T.get(te);return A.delete(he),A.size>0||T.delete(te),!0}t("deleteMetadata",Y);function x(Q,te){for(var he=Q.length-1;he>=0;--he){var f=Q[he],A=f(te);if(!oe(A)&&!pe(A)){if(!et(A))throw new TypeError;te=A}}return te}function H(Q,te,he,f){for(var A=Q.length-1;A>=0;--A){var E=Q[A],O=E(te,he,f);if(!oe(O)&&!pe(O)){if(!ce(O))throw new TypeError;f=O}}return f}function M(Q,te,he){var f=T.get(Q);if(oe(f)){if(!he)return;f=new m,T.set(Q,f)}var A=f.get(te);if(oe(A)){if(!he)return;A=new m,f.set(te,A)}return A}function F(Q,te,he){var f=K(Q,te,he);if(f)return!0;var A=Lh(te);return pe(A)?!1:F(Q,A,he)}function K(Q,te,he){var f=M(te,he,!1);return oe(f)?!1:ae(f.has(Q))}function X(Q,te,he){var f=K(Q,te,he);if(f)return ye(Q,te,he);var A=Lh(te);if(!pe(A))return X(Q,A,he)}function ye(Q,te,he){var f=M(te,he,!1);if(!oe(f))return f.get(Q)}function Te(Q,te,he,f){var A=M(he,f,!0);A.set(Q,te)}function le(Q,te){var he=ge(Q,te),f=Lh(Q);if(f===null)return he;var A=le(f,te);if(A.length<=0)return he;if(he.length<=0)return A;for(var E=new d,O=[],P=0,V=he;P<V.length;P++){var ne=V[P],Pe=E.has(ne);Pe||(E.add(ne),O.push(ne))}for(var gt=0,ct=A;gt<ct.length;gt++){var ne=ct[gt],Pe=E.has(ne);Pe||(E.add(ne),O.push(ne))}return O}function ge(Q,te){var he=[],f=M(Q,te,!1);if(oe(f))return he;for(var A=f.keys(),E=zt(A),O=0;;){var P=kh(E);if(!P)return he.length=O,he;var V=Dy(P);try{he[O]=V}catch(ne){try{Fy(E)}finally{throw ne}}O++}}function N(Q){if(Q===null)return 1;switch(typeof Q){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Q===null?1:6;default:return 6}}function oe(Q){return Q===void 0}function pe(Q){return Q===null}function xe(Q){return typeof Q=="symbol"}function ce(Q){return typeof Q=="object"?Q!==null:typeof Q=="function"}function q(Q,te){switch(N(Q)){case 0:return Q;case 1:return Q;case 2:return Q;case 3:return Q;case 4:return Q;case 5:return Q}var he="string",f=_t(Q,s);if(f!==void 0){var A=f.call(Q,he);if(ce(A))throw new TypeError;return A}return ee(Q)}function ee(Q,te){var he,f,A;{var E=Q.toString;if(Ke(E)){var f=E.call(Q);if(!ce(f))return f}var he=Q.valueOf;if(Ke(he)){var f=he.call(Q);if(!ce(f))return f}}throw new TypeError}function ae(Q){return!!Q}function se(Q){return""+Q}function we(Q){var te=q(Q);return xe(te)?te:se(te)}function De(Q){return Array.isArray?Array.isArray(Q):Q instanceof Object?Q instanceof Array:Object.prototype.toString.call(Q)==="[object Array]"}function Ke(Q){return typeof Q=="function"}function et(Q){return typeof Q=="function"}function mt(Q){switch(N(Q)){case 3:return!0;case 4:return!0;default:return!1}}function _t(Q,te){var he=Q[te];if(he!=null){if(!Ke(he))throw new TypeError;return he}}function zt(Q){var te=_t(Q,i);if(!Ke(te))throw new TypeError;var he=te.call(Q);if(!ce(he))throw new TypeError;return he}function Dy(Q){return Q.value}function kh(Q){var te=Q.next();return te.done?!1:te}function Fy(Q){var te=Q.return;te&&te.call(Q)}function Lh(Q){var te=Object.getPrototypeOf(Q);if(typeof Q!="function"||Q===g||te!==g)return te;var he=Q.prototype,f=he&&Object.getPrototypeOf(he);if(f==null||f===Object.prototype)return te;var A=f.constructor;return typeof A!="function"||A===Q?te:A}function Ou(){var Q={},te=[],he=(function(){function O(P,V,ne){this._index=0,this._keys=P,this._values=V,this._selector=ne}return O.prototype["@@iterator"]=function(){return this},O.prototype[i]=function(){return this},O.prototype.next=function(){var P=this._index;if(P>=0&&P<this._keys.length){var V=this._selector(this._keys[P],this._values[P]);return P+1>=this._keys.length?(this._index=-1,this._keys=te,this._values=te):this._index++,{value:V,done:!1}}return{value:void 0,done:!0}},O.prototype.throw=function(P){throw this._index>=0&&(this._index=-1,this._keys=te,this._values=te),P},O.prototype.return=function(P){return this._index>=0&&(this._index=-1,this._keys=te,this._values=te),{value:P,done:!0}},O})();return(function(){function O(){this._keys=[],this._values=[],this._cacheKey=Q,this._cacheIndex=-2}return Object.defineProperty(O.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),O.prototype.has=function(P){return this._find(P,!1)>=0},O.prototype.get=function(P){var V=this._find(P,!1);return V>=0?this._values[V]:void 0},O.prototype.set=function(P,V){var ne=this._find(P,!0);return this._values[ne]=V,this},O.prototype.delete=function(P){var V=this._find(P,!1);if(V>=0){for(var ne=this._keys.length,Pe=V+1;Pe<ne;Pe++)this._keys[Pe-1]=this._keys[Pe],this._values[Pe-1]=this._values[Pe];return this._keys.length--,this._values.length--,P===this._cacheKey&&(this._cacheKey=Q,this._cacheIndex=-2),!0}return!1},O.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Q,this._cacheIndex=-2},O.prototype.keys=function(){return new he(this._keys,this._values,f)},O.prototype.values=function(){return new he(this._keys,this._values,A)},O.prototype.entries=function(){return new he(this._keys,this._values,E)},O.prototype["@@iterator"]=function(){return this.entries()},O.prototype[i]=function(){return this.entries()},O.prototype._find=function(P,V){return this._cacheKey!==P&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=P)),this._cacheIndex<0&&V&&(this._cacheIndex=this._keys.length,this._keys.push(P),this._values.push(void 0)),this._cacheIndex},O})();function f(O,P){return O}function A(O,P){return P}function E(O,P){return[O,P]}}function oc(){return(function(){function Q(){this._map=new m}return Object.defineProperty(Q.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Q.prototype.has=function(te){return this._map.has(te)},Q.prototype.add=function(te){return this._map.set(te,te),this},Q.prototype.delete=function(te){return this._map.delete(te)},Q.prototype.clear=function(){this._map.clear()},Q.prototype.keys=function(){return this._map.keys()},Q.prototype.values=function(){return this._map.values()},Q.prototype.entries=function(){return this._map.entries()},Q.prototype["@@iterator"]=function(){return this.keys()},Q.prototype[i]=function(){return this.keys()},Q})()}function Sn(){var Q=16,te=u.create(),he=f();return(function(){function V(){this._key=f()}return V.prototype.has=function(ne){var Pe=A(ne,!1);return Pe!==void 0?u.has(Pe,this._key):!1},V.prototype.get=function(ne){var Pe=A(ne,!1);return Pe!==void 0?u.get(Pe,this._key):void 0},V.prototype.set=function(ne,Pe){var gt=A(ne,!0);return gt[this._key]=Pe,this},V.prototype.delete=function(ne){var Pe=A(ne,!1);return Pe!==void 0?delete Pe[this._key]:!1},V.prototype.clear=function(){this._key=f()},V})();function f(){var V;do V="@@WeakMap@@"+P();while(u.has(te,V));return te[V]=!0,V}function A(V,ne){if(!r.call(V,he)){if(!ne)return;Object.defineProperty(V,he,{value:u.create()})}return V[he]}function E(V,ne){for(var Pe=0;Pe<ne;++Pe)V[Pe]=Math.random()*255|0;return V}function O(V){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(V)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(V)):E(new Uint8Array(V),V):E(new Array(V),V)}function P(){var V=O(Q);V[6]=V[6]&79|64,V[8]=V[8]&191|128;for(var ne="",Pe=0;Pe<Q;++Pe){var gt=V[Pe];(Pe===4||Pe===6||Pe===8)&&(ne+="-"),gt<16&&(ne+="0"),ne+=gt.toString(16).toLowerCase()}return ne}}function Pa(Q){return Q.__=void 0,delete Q.__,Q}})})(zm||(zm={}));function j(e,t){return r=>{let n,s,i;typeof e=="object"?(n=e.module_name,t=e,s=e.singleton):n=e,n===void 0&&(n=Symbol(r.name)),t&&(t.singleton!==void 0&&(s=t.singleton),t.group!==void 0&&(typeof t.group=="boolean"?t.group===!0&&(i=[n]):i=t.group instanceof Array?t.group:[t.group])),r[Vg]=n,r[Gg]=!!s,i&&(r[Um]=i)}}var Jm,Ym,Xm,jg=Symbol("module-map"),el=Symbol("mask-level"),zg=Symbol("mask-self"),je=class{constructor(e,t){this.parent=t,this[Jm]="ModuleStroge",this[Ym]=0,this[Xm]=this,this._stroge=new Map(e),this.set(jg,this)}clear(){return this._stroge.clear()}delete(e){return this._stroge.delete(e)}forEach(e,t){return this._stroge.forEach(e,t)}set(e,t){return this._stroge.set(e,t),this}get size(){return this._stroge.size}[Symbol.iterator](){return this._stroge[Symbol.iterator]()}entries(){return this._stroge.entries()}keys(){return this._stroge.keys()}values(){return this._stroge.values()}get(e){return!this.parent||this._stroge.has(e)?this._stroge.get(e):this.parent.get(e)}has(e){return!!this._stroge.has(e)||!!this.parent&&this.parent.has(e)}installMask(e){const t=s=>s===jg&&e.get(s)===e?n:e.has(s)?e.get(s):this.get(s),r=s=>e.has(s)||this.has(s),n=new Proxy(this,{get:(s,i,o)=>i==="_mask"?e:i===el?this[el]+1:i===zg?this:i==="get"?t:i==="has"?r:Reflect.get(s,i,o)});return n}uninstallMask(e=1){e=Math.min(this[el],e);let t=this;for(let r=0;r<e;r+=1)t=this[zg];return t}groupInsert(e,t){(this._groupCollection||(this._groupCollection=new Gt(r=>new Set))).forceGet(e).add(t)}groupGet(...e){let t;for(const r of e){let n;switch(typeof r){case"function":n=[...jm(r)];break;case"object":n=r;break;default:n=[r]}if(!(n instanceof Array))throw new TypeError;const s=this.groupsGet_(n);if(s)if(t)for(const i of s)t.add(i);else t=s;if(this.parent){const i=this.parent.groupsGet_(n);if(i)if(t)for(const o of i)t.add(o);else t=i}}return t||new Set}groupsGet_(e){let t;e=e.slice();let r=n=>!0;for(;;){const n=e.shift();if(n===void 0)break;t=new Set;for(const s of this.groupGet_(n))r(s)&&t.add(s);if(!t.size)break;{const s=t;r=i=>s.has(i)}}return t}groupGet_(e){const t=[];if(this._groupCollection){const r=this._groupCollection.get(e);r&&t.push(...r)}return this.parent&&t.push(...this.parent.groupGet_(e)),t}};Jm=Symbol.toStringTag,Ym=el,Xm=zg,je=p([j(jg),h("design:paramtypes",[Object,je])],je);var xE=new Map;function BE(e){for(;;){const t=Kg.get(e);if(t)return t;if((e=Object.getPrototypeOf(e))===Object.prototype||!e)break}return xE}function At(e,t=new je){const r=e[Vg],n=e[Gg],s=jm(e);let i;if(n instanceof e?t.set(r,i=n):i=t.get(r),!i){const o=BE(e),c=Reflect.getMetadata("design:paramtypes",e),l=c?c.map((y,m)=>{const d=o&&o.get(m);if(d!==void 0){if(!(d.conf&&d.conf.optional)&&!t.has(d.id))throw new ReferenceError(`Need Inject Module '${String(d.id)}' in ${String(r)}`);return t.get(d.id)}return At(y,t)}):[];Zh.push(t),i=new e(...l),Zh.pop(),$m.set(i,t),n&&(e[Gg]=i),r!==void 0&&t.set(r,i);for(const y of s)t.groupInsert(y,i);typeof i.bfOnInit=="function"&&i.bfOnInit();const u=Reflect.getMetadata(Gm,e.prototype);if(u)for(const[y,m]of u)i[y]=At(m.injectModel,t);typeof i.bfAfterInit=="function"&&queueMicrotask(()=>{i.bfAfterInit()});const g=Reflect.getMetadata(Vm,e.prototype);g&&queueMicrotask(()=>{for(const[y,m]of g)i[y]=At(m.injectModel,t)})}return i}function k(e,t){return(r,n,s)=>{if(typeof s!="number"){if(e===void 0)throw new ReferenceError("inject_moudle should not be empty");return kE(e,t)(r,n,s)}{const i=typeof e=="function"?Km(e):e;if(i!==void 0){const o=Kg.get(r)||new Map;Kg.set(r,o),o.set(s,{id:i,conf:t})}}}}var HE=(e=>(e[e.NO_RESOLVE=0]="NO_RESOLVE",e[e.ON_GETTER=1]="ON_GETTER",e[e.ON_INIT=2]="ON_INIT",e[e.AFTER_INIT=3]="AFTER_INIT",e))(HE||{});function Qm(e,t){let r=Reflect.getMetadata(t,e);return r||(r=new Map,Reflect.metadata(t,r)(e)),r}function kE(e,t={}){const{dynamics:r,optional:n,autoResolve:s,writable:i=!0}=t;let o;o=s===!1?0:s===!0||s===void 0?1:s;const c=typeof e=="function"?Km(e):e;if(c===void 0)throw new TypeError("module name is undefined");return(l,u,g)=>{if(o!==0&&o!==1){if(typeof e!="function")throw new TypeError(`${l} could not resolve prop '${u}', inject_module not an function.`);o===3?Qm(l,Vm).set(u,{injectModel:e}):o===2&&Qm(l,Gm).set(u,{injectModel:e})}const y=T=>{const S=PE(T);if(!S)throw new ReferenceError(`instance of ${T.constructor.name} is not an instance which is created by Resolve`);return S},m=(T,S)=>{y(T).set(c,S)},d=T=>{const S=y(T);if(S.has(c))return S.get(c);if(o!==0&&typeof e=="function")return At(e,S);if(!n)throw new ReferenceError(`module of ${String(c)} must been Injected first.`)},I={configurable:!0,enumerable:!0};if(r)i&&(I.set=function(T){m(this,T)}),I.get=function(){return d(this)};else{const T=(S,w)=>{Object.defineProperty(S,u,{value:w,writable:i,configurable:!0,enumerable:!0})};i&&(I.set=function(S){m(this,S),T(this,S)}),I.get=function(){const S=d(this);return T(this,S),S}}Object.defineProperty(l,u,I)}}function Wi(e){return t=>{}}var Jg,vp;(function(e){e.CHINESE="zh_CN.UTF-8",e.ENGLISH="en_US.UTF-8"})(vp||(vp={}));var qm=Symbol("errorCodeLang"),Yg=Jg=class{constructor(e=vp.ENGLISH){this.__store=new Map,this.__checkLanguage(e),this.__lang=e}static from(e,t=new je){return At(Jg,t.installMask(new je([[qm,e]])))}__checkLanguage(e){if(e!==vp.CHINESE&&e!==vp.ENGLISH)throw new Error(`Invalid lang type ${e}`)}getErrorCodeList(e){const t=this.__store.get(e);if(!t)throw new Error(`Failed to get error code list by ${e}`);return t.sourceErrorCodeList}formatErrorCodeList(e,t){const r=t.get(this.__lang);if(!r)return console.debug(`Translated error code list not found, language ${this.__lang}`),e;for(const n in e){const s=e[n];s.message=r[s.code]||s.message}return e}addErrorCodeList(e,t,r){this.formatErrorCodeList(t,r),this.__store.set(e,{sourceErrorCodeList:t,translatedErrorCodeListMap:r})}setLanguage(e){if(this.__lang!==e){this.__checkLanguage(e),this.__lang=e;for(const{sourceErrorCodeList:t,translatedErrorCodeListMap:r}of this.__store.values())this.formatErrorCodeList(t,r)}}};Yg=Jg=p([j(),Se(0,k(qm,{optional:!0})),h("design:paramtypes",[String])],Yg);var LE={"001-00001":"params {param} lost","001-00002":"{prop} in {target} is required","001-00003":"{prop} in {target} is invalid","001-00004":"{to_compare_prop} in {to_target} and {be_compare_prop} in {be_target} not match","001-00005":"{prop} in {target} should greater than {field}","001-00006":"{prop} in {target} should greater than or equals to {field}","001-00007":"{prop} in {target} should less than {field}","001-00008":"{prop} in {target} should less than or equals to {field}","001-00009":"{prop} in {target} should equals to {field}","001-00010":"{to_compare_prop} in {to_target} should be {be_compare_prop}","001-00011":"{to_compare_prop} in {to_target} should not be {be_compare_prop}","001-00012":"{prop} in {target} not exist","001-00013":"{prop} in {target} should not exist","001-00014":"Transaction fee is not enough, errorId {errorId}, minFee {minFee}","001-00015":"{prop} in {target} not in [{min}, {max}]","001-00016":"{prop} in {target} is over length {limit}","001-00017":"{prop} in {target} should not start with or end with {field}","001-00018":"{prop} in {target} not a string, value {value}","001-00019":"{prop} in {target} not a ip, value {value}","001-00020":"{prop} in {target} not a ipv4, value {value}","001-00021":"{prop} in {target} not a ipv6, value {value}","001-00022":"{prop} in {target} not a longitude-latitude, value {value}","001-00023":"{prop} in {target} not a longitude, value {value}","001-00024":"{prop} in {target} not a latitude, value {value}","001-00025":"{prop} in {target} not a address, value {value}","001-00026":"{prop} in {target} not a locationName, value {value}","001-00027":"{prop} in {target} not a dns, value {value}","001-00028":"{prop} in {target} not a email, value {value}","001-00029":"{prop} in {target} not a url, value {value}","001-00030":"Permission denied at operation {operationName}","001-00031":"{prop} in {target} should not inclue {value}","001-00032":"{prop} in {target} should inclue {value}","001-00033":"{prop} in {target} should not duplicate","001-00034":"{prop} in {target} already exist, errorId {errorId}","001-00035":"Genesis generator not enough, at least {expected}, actual {actual}","001-00036":"{prop} in {target} should be an array","001-00037":"Invalid block generator, reason {reason}","001-00038":"transaction's porf of work verify fail","001-00039":"{prop} not found","001-00040":"{prop} is too large, reason {reason}, errorId {errorId}","001-00041":"{prop} length in {target} should less than {field}","001-00042":"{prop} length in {target} should less than or equals to {field}","001-00043":"{prop} length in {target} should greater than {field}","001-00044":"{prop} length in {target} should greater than or equals to {field}","001-00045":"{prop} length in {target} should equals to {field}","001-00046":"{prop} length in {target} should not equals to {field}","001-00047":"Invalid transaction base type: {base_type}","001-00048":"Invalid block constructor: {name}","001-00049":"Invalid block type: {type}","001-00050":"Custom transaction verify fail: {message}","001-00051":"Disabled create {trsName} Transaction","001-00052":"Disabled insert {trsName} Transaction","001-00053":"Transaction is in unchangable state","001-00054":"AssetStatistic index: {index} already in use","001-00055":"Invalid {taskLabel} signature","001-00056":"Invalid {taskLabel} signSignature","001-00057":"Invalid base type {base_type}","001-00058":"Unregistered TransactionFactory {factoryName}","001-00059":"Unregistered Transaction base type {trs_base}","001-00060":"Unregistered Transaction type {trs_key}","001-00061":"Invalid {taskLabel} fromAuthSignature","001-00062":"Invalid {taskLabel} fromAuthSignSignature","001-00063":"Invalid {taskLabel} toAuthSignature","001-00064":"Invalid {taskLabel} toAuthSignSignature","001-00065":"Invalid macro input type: {type}","001-00066":"{prop} in {target} already expired","001-11001":"{prop} in {target} lose","001-11002":"Account with address {address} was frozen, status {status}, errorId {errorId}","001-11003":"Transaction signSignature is required, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11004":"Transaction sender second secret have already change, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11005":"Transaction should not have senderSecondPublicKey, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11006":"Transaction should not have signSignature, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11007":"Invalid transaction({signature}) apply block height, reason {reason}","001-11008":"Invalid transaction({signature}) effective block height, reason {reason}","001-11009":"Invalid transaction from magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11010":"Invalid transaction to magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11011":"Invalid transaction timestamp, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11012":"DAppid is not exist, dappid {dappid}","001-11013":"DAppid is already exist, dappid {dappid}, errorId {errorId}","001-11014":"LocationName is not exist, locationName {locationName}, errorId {errorId}","001-11015":"LocationName is already exist, locationName {locationName}, errorId {errorId}","001-11016":"Entity factory is not exist, factoryId {factoryId}","001-11017":"Entity factory is already exist, factoryId {factoryId}, errorId {errorId}","001-11018":"Entity is not exist, entityId {entityId}","001-11019":"Entity is already exist, entityId {entityId}, errorId {errorId}","001-11020":"Unknow rangeType, rangeType {rangeType}","001-11021":"Invalid transaction byte length, reason {reason}","001-11022":"Need purchase dappid before use, dappid {dappid}","001-11025":"Can not delete locationName {locationName}, reason {reason}","001-11026":"Set locationName {locationName} manager field, reason {reason}, errorId {errorId}","001-11027":"Set locationName {locationName} recordValue field, reason {reason}, errorId {errorId}","001-11028":"Asset not enough, reason {reason}, errorId {errorId}","001-11029":"Account remain equity not enough, reason {reason}, errorId {errorId}","001-11030":"Frozen asset is not begin to unfrozen yet, frozenId {frozenId}","001-11031":"Frozen asset is already expiration, frozenId {frozenId}","001-11032":"Gift asset unfrozen time use up, frozenId {frozenId}","001-11034":"Account with address {address} is already an generator, errorId {errorId}","001-11035":"Account with address {address} is not an generator, errorId {errorId}","001-11038":"{prop} in {target} is forbidden","001-11039":"Asset not exist, magic {magic} assetType {assetType}","001-11040":"Account with address {address} not dappid {dappid} possessor, errorId {errorId}","001-11041":"Account with address {address} not locationName {locationName} possessor, errorId {errorId}","001-11042":"Account with address {address} not entityId {entityId} possessor, errorId {errorId}","001-11043":"DAppid not frozen, dappid {dappid}","001-11044":"DAppid already frozen, dappid {dappid}","001-11045":"LocationName not frozen, locationName {locationName}","001-11046":"LocationName already frozen, locationName {locationName}","001-11047":"Entity not frozen, entityId {entityId}","001-11048":"Entity already frozen, entityId {entityId}","001-11049":"No need to purchase asset, type {type} asset {asset}","001-11050":"Only top level location name can exchange","001-11051":"Can not destroy entityId {entityId}, reason {reason}","001-11052":"Entity already destroy, entityId {entityId}","001-11053":"Asset is already migration, migrateCertificateId {migrateCertificateId}","001-11054":"{prop} in {target} not exist or expired","001-11055":"Transaction with signature {signature} is not an expected related transaction","001-11056":"Can not secondary transaction, reason {reason}","001-11057":"The register generator quota is full in round {round}","001-11058":"Generator can not migrate asset","001-11059":"You can only migrate main asset, {assetType} is not main asset {mainAsset}","001-11060":"Can not carry second publicKey","001-11061":"Can not carry second signature","001-11063":"Account possess frozen asset","001-11064":"Need emigrate total asset, address {address}","001-11065":"Account possess asset expect chain asset","001-11066":"Account possess frozen asset expect chain asset","001-11067":"Account with address {address} can not be frozen, reason {reason}, errorId {errorId}","001-11068":"You can only trust main asset, {assetType} is not main asset {mainAsset}","001-11070":"Issue entity times use up, entityFactory {entityFactory}","001-11071":"Asset already exist, magic {magic} assetType {assetType}","001-11072":"Frozen asset with frozenAddress {frozenAddress} signature {signature} assetType {assetType} in blockChain not exist or expired","001-11073":"Not enough issue entity times, entityFactory {entityFactory}","001-11074":"Promise is not begin to resolve yet, promiseId {promiseId}","001-11075":"Certificate is not exist, certificateId {certificateId}","001-11076":"Certificate is already exist, certificateId {certificateId}, errorId {errorId}","001-11077":"Can not destroy certificate, certificateId {certificateId}, reason {reason}","001-11078":"Account with address {address} not certificate {certificateId} possessor, errorId {errorId}","001-11079":"Certificate not frozen, certificateId {certificateId}","001-11080":"Certificate already frozen, certificateId {certificateId}","001-11081":"Certificate already destroy, certificateId {certificateId}","001-12001":"Block signSignature is required, signature {signature} generatorAddress {generatorAddress} height {height}","001-12002":"Block generator second secret have already change, signature {signature} generatorAddress {generatorAddress} height {height}","001-12003":"Block should not have generatorSecondPublicKey, signature {signature} generatorAddress {generatorAddress} height {height}","001-12004":"Block should not have signSignature, signature {signature} generatorAddress {generatorAddress} height {height}","001-12005":"{variable} out of range","001-12006":"Failed to find nearest same block in one round, should not happen","001-12007":"GenesisBlock not match, the signature of genesisBlock and synchronized peer's genesisBlock's signature not equal","000-12008":"Falied to get blocks by range({minHeight}~{maxHeight})","001-22001":"Invalid params: {params}","001-22002":"Invalid params field: {field}","001-22003":"GenesisBlock maybe no equal","001-22004":"Invalid QueryBlockArg query params, no query conditions","001-22005":"QueryBlock ({query}) from peer({peerId}) timeout","001-22006":"ReqId reuse","001-22007":"ChainChannel closed","001-22008":"Refuse response query transaction","001-22009":"Refuse response index transaction","001-22010":"Refuse response download transaction","001-22011":"Refuse response broadcast transaction","001-22012":"Refuse response query block","001-22013":"Refuse response broadcast block","001-22014":"Message type error","001-22015":"OnMessage get invalid req_id: {req_id}","001-22016":"Request limit","001-22017":"Invalid message cmd","001-22018":"ChainChannel Timeout, cmd {cmd}","001-22019":"Task {task_id} abort because the free chainChannel size is zero","001-22020":"Refuse response open blob","001-22021":"Refuse response read blob","001-22022":"Refuse response close blob","001-23001":"blob({hash}) algorithm({algorithm}) is invalid","001-23002":"Fail to download blob({hash}) size({size})"},ME={"001-00001":" {param} ","001-00002":"{target}  {prop} ","001-00003":"{target}  {prop} ","001-00004":"{to_target}  {to_compare_prop}  {be_target}  {be_compare_prop} ","001-00005":"{target}  {prop}  {field}","001-00006":"{target}  {prop}  {field}","001-00007":"{target}  {prop}  {field}","001-00008":"{target}  {prop}  {field}","001-00009":"{target}  {prop}  {field}","001-00010":"{to_target}  {to_compare_prop}  {be_compare_prop}","001-00011":"{to_target}  {to_compare_prop}  {be_compare_prop}","001-00012":"{target}  {prop} ","001-00013":"{target}  {prop} ","001-00014":" id {errorId} {minFee}","001-00015":"{target}  {prop}  [{min}, {max}] ","001-00016":"{target}  {prop}  {limit}","001-00017":"{target}  {prop}  {field} ","001-00018":"{target}  {prop}  {value}","001-00019":"{target}  {prop}  ip,  {value}","001-00020":"{target}  {prop}  ipv4,  {value}","001-00021":"{target}  {prop}  ipv6,  {value}","001-00022":"{target}  {prop} ,  {value}","001-00023":"{target}  {prop} ,  {value}","001-00024":"{target}  {prop} ,  {value}","001-00025":"{target}  {prop} ,  {value}","001-00026":"{target}  {prop} ,  {value}","001-00027":"{target}  {prop}  dns,  {value}","001-00028":"{target}  {prop}  email,  {value}","001-00029":"{target}  {prop}  url,  {value}","001-00030":" {operationName} ","001-00031":"{target}  {prop}  {value}","001-00032":"{target}  {prop}  {value}","001-00033":"{target}  {prop} ","001-00034":"{target}  {prop}  id {errorId}","001-00035":" {expected} {actual}","001-00036":"{target}  {prop} ","001-00037":" {reason}","001-00038":"","001-00039":"{prop} ","001-00040":"{prop}  {reason} id {errorId}","001-00041":"{target}  {prop}  {field}","001-00042":"{target}  {prop}  {field}","001-00043":"{target}  {prop}  {field}","001-00044":"{target}  {prop}  {field}","001-00045":"{target}  {prop}  {field}","001-00046":"{target}  {prop}  {field}","001-00047":"{base_type}","001-00048":"{name}","001-00049":"{type}","001-00050":"{message}","001-00051":" {trsName}","001-00052":" {trsName}","001-00053":"","001-00054":"{index} ","001-00055":" {taskLabel} signature","001-00056":" {taskLabel} signSignature","001-00057":" base type {base_type}","001-00058":" factory {factoryName}","001-00059":" base type {trs_base}","001-00060":" type {trs_key}","001-00061":" {taskLabel} fromAuthSignature","001-00062":" {taskLabel} fromAuthSignSignature","001-00063":" {taskLabel} toAuthSignature","001-00064":" {taskLabel} toAuthSignSignature","001-00065":": {type}","001-00066":"{target}  {prop} ","001-11001":"{target}  {prop} ","001-11002":" {address}  {status} id {errorId}","001-11003":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11004":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11005":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11006":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11007":"{signature} {reason}","001-11008":"{signature} {reason}","001-11009":" {reason} {signature}  {senderId}  {applyBlockHeight}  {type}","001-11010":" {reason} {signature}  {senderId}  {applyBlockHeight}  {type}","001-11011":" {reason} {signature}  {senderId}  {applyBlockHeight}  {type}","001-11012":"DAppid dappid {dappid}","001-11013":"DAppid , dappid {dappid} id {errorId}","001-11014":",  {locationName} id {errorId}","001-11015":" {locationName} id {errorId}","001-11016":"Entity factory , factoryId {factoryId}","001-11017":"Entity factory , factoryId {factoryId} id {errorId}","001-11018":"Entity , entityId {entityId}","001-11019":"Entity , entityId {entityId} id {errorId}","001-11020":" rangeTyperangeType {rangeType}","001-11021":" {reason}","001-11022":" dappid dappid {dappid}","001-11023":" dappid  dappid dappid {dappid} id {errorId}","001-11024":" id {errorId {reason}","001-11025":" {locationName} {reason}","001-11026":" {locationName}  {reason} id {errorId}","001-11027":" {locationName}  {reason} id {errorId}","001-11028":" {reason} id {errorId}","001-11029":" {reason} id {errorId}","001-11030":"frozenId {frozenId}","001-11031":"frozenId {frozenId}","001-11032":"frozenId {frozenId}","001-11033":" id {errorId}","001-11034":" {address}  id {errorId}","001-11035":" {address}  id {errorId}","001-11036":" {address}  id {errorId}","001-11037":" {address}  id {errorId}","001-11038":"{target}  {prop} ","001-11039":" {magic}  {assetType}","001-11040":" {address}  dappid {dappid}  id {errorId}","001-11041":" {address}  locationName {locationName}  id {errorId}","001-11042":" {address}  entityId {entityId}  id {errorId}","001-11043":"DAppid dappid {dappid}","001-11044":"DAppid dappid {dappid}","001-11045":" {locationName}","001-11046":" {locationName}","001-11047":"Entity EntityId {entityId}","001-11048":"Entity entityId {entityId}","001-11049":" {type} {asset}","001-11050":"","001-11051":" entityId {entityId} {reason}","001-11052":"Entity  entityId {entityId}","001-11053":" id {migrateCertificateId}","001-11054":"{target}  {prop} ","001-11055":" {signature} ","001-11056":" {reason}","001-11057":" {round} ","001-11058":"","001-11059":"{assetType}  {mainAsset}","001-11060":"","001-11061":"","001-11062":"","001-11063":"","001-11064":" {address}","001-11065":"","001-11066":"","001-11067":" {address}  {reason} id {errorId}","001-11068":"{assetType}  {mainAsset}","001-11069":" id {errorId}","001-11070":" entity entityFactory {entityFactory}","001-11071":" {magic}  {assetType}","001-11072":" frozenAddress {frozenAddress} signature {signature} assetType {assetType} ","001-11073":" entity entityFactory {entityFactory}","001-11074":"promiseId {promiseId}","001-11075":" certificateId {certificateId}","001-11076":"certificateId {certificateId} id {errorId}","001-11077":"certificateId {certificateId}reason {reason}","001-11078":" address {address}  {certificateId}  id {errorId}","001-11079":"certificateId {certificateId}","001-11080":"certificateId {certificateId}","001-11081":"certificateId {certificateId}","001-12001":" {signature}  {generatorAddress}  {height}","001-12002":" {signature}  {generatorAddress}  {height}","001-12003":" {signature}  {generatorAddress}  {height}","001-12004":" {signature}  {generatorAddress}  {height}","001-12005":"{variable} ","001-12006":"","001-12007":",  signature  signature ","000-12008":"{minHeight}~{maxHeight}","001-22001":"{params}","001-22002":"{field}","001-22003":"","001-22004":" QueryBlockArg ","001-22005":" {peerId}  {query} ","001-22006":"ReqId ","001-22007":"ChainChannel ","001-22008":"","001-22009":"","001-22010":"","001-22011":"","001-22012":"","001-22013":"","001-22014":"Message ","001-22015":"OnMessage  req_id{req_id}","001-22016":"","001-22017":" message cmd","001-22018":"ChainChannel cmd {cmd}","001-22019":"Task {task_id}  chainChannel  0","001-22020":" blob","001-22021":" blob","001-22022":" blob","001-23001":"blob({hash})  algorithm({algorithm}) ","001-23002":" blob({hash}) size({size}) "},Xg=new Map;Xg.set("en_US.UTF-8",LE),Xg.set("zh_CN.UTF-8",ME);var DE=Xg,a={PARAM_LOST:new U("001-00001","params {param} lost"),PROP_IS_REQUIRE:new U("001-00002","{prop} in {target} is required"),PROP_IS_INVALID:new U("001-00003","{prop} in {target} is invalid"),NOT_MATCH:new U("001-00004","{to_compare_prop} in {to_target} and {be_compare_prop} in {be_target} not match"),PROP_SHOULD_GT_FIELD:new U("001-00005","{prop} in {target} should greater than {field}"),PROP_SHOULD_GTE_FIELD:new U("001-00006","{prop} in {target} should greater than or equals to {field}"),PROP_SHOULD_LT_FIELD:new U("001-00007","{prop} in {target} should less than {field}"),PROP_SHOULD_LTE_FIELD:new U("001-00008","{prop} in {target} should less than or equals to {field}"),PROP_SHOULD_EQ_FIELD:new U("001-00009","{prop} in {target} should equals to {field}"),SHOULD_BE:new U("001-00010","{to_compare_prop} in {to_target} should be {be_compare_prop}"),SHOULD_NOT_BE:new U("001-00011","{to_compare_prop} in {to_target} should not be {be_compare_prop}"),NOT_EXIST:new U("001-00012","{prop} in {target} not exist"),SHOULD_NOT_EXIST:new U("001-00013","{prop} in {target} should not exist"),TRANSACTION_FEE_NOT_ENOUGH:new U("001-00014","Transaction fee is not enough, errorId {errorId}, minFee {minFee}"),NOT_IN_EXPECTED_RANGE:new U("001-00015","{prop} in {target} not in [{min}, {max}]"),OVER_LENGTH:new U("001-00016","{prop} in {target} is over length {limit}"),SHOULD_NOT_START_WITH_OR_END_WITH:new U("001-00017","{prop} in {target} should not start with or end with {field}"),NOT_A_STRING:new U("001-00018","{prop} in {target} not a string, value {value}"),NOT_A_IP:new U("001-00019","{prop} in {target} not a ip, value {value}"),NOT_A_IPV4:new U("001-00020","{prop} in {target} not a ipv4, value {value}"),NOT_A_IPV6:new U("001-00021","{prop} in {target} not a ipv6, value {value}"),NOT_A_LONGITUDE_LATITUDE:new U("001-00022","{prop} in {target} not a longitude-latitude, value {value}"),NOT_A_LONGITUDE:new U("001-00023","{prop} in {target} not a longitude, value {value}"),NOT_A_LATITUDE:new U("001-00024","{prop} in {target} not a latitude, value {value}"),NOT_A_ADDRESS:new U("001-00025","{prop} in {target} not a address, value {value}"),NOT_A_LOCATION_NAME:new U("001-00026","{prop} in {target} not a locationName, value {value}"),NOT_A_DNS:new U("001-00027","{prop} in {target} not a dns, value {value}"),NOT_A_EMAIL:new U("001-00028","{prop} in {target} not a email, value {value}"),NOT_A_URL:new U("001-00029","{prop} in {target} not a url, value {value}"),PERMISSION_DENIED:new U("001-00030","Permission denied at operation {operationName}"),SHOULD_NOT_INCLUDE:new U("001-00031","{prop} in {target} should not inclue {value}"),SHOULD_INCLUDE:new U("001-00032","{prop} in {target} should inclue {value}"),SHOULD_NOT_DUPLICATE:new U("001-00033","{prop} in {target} should not duplicate"),ALREADY_EXIST:new U("001-00034","{prop} in {target} already exist, errorId {errorId}"),GENESIS_GENERATOR_NOT_ENOUGH:new U("001-00035","Genesis generator not enough, at least {expected}, actual {actual}"),PROP_SHOULD_BE_ARRAY:new U("001-00036","{prop} in {target} should be an array"),INVALID_BLOCK_GENERATOR:new U("001-00037","Invalid block generator, reason {reason}"),NOT_FOUND:new U("001-00039","{prop} not found"),TOO_LARGE:new U("001-00040","{prop} is too large, reason {reason}, errorId {errorId}"),PROP_LENGTH_SHOULD_LT_FIELD:new U("001-00041","{prop} length in {target} should less than {field}"),PROP_LENGTH_SHOULD_LTE_FIELD:new U("001-00042","{prop} length in {target} should less than or equals to {field}"),PROP_LENGTH_SHOULD_GT_FIELD:new U("001-00043","{prop} length in {target} should greater than {field}"),PROP_LENGTH_SHOULD_GTE_FIELD:new U("001-00044","{prop} length in {target} should greater than or equals to {field}"),PROP_LENGTH_SHOULD_EQ_FIELD:new U("001-00045","{prop} length in {target} should equals to {field}"),PROP_LENGTH_SHOULD_NOT_EQ_FIELD:new U("001-00046","{prop} length in {target} should not equals to {field}"),INVALID_TRANSACTION_BASE_TYPE:new U("001-00047","Invalid transaction base type: {base_type}"),INVALID_BLOCK_CONSTRUCTOR:new U("001-00048","Invalid block constructor: {name}"),INVALID_BLOCK_TYPE:new U("001-00049","Invalid block type: {type}"),CUSTOM_TRANS_VERIFY_FAIL:new U("001-00050","Custom transaction verify fail: {message}"),DISABLED_CREATE_TRANSACTION:new U("001-00051","Disabled create {trsName} Transaction"),DISABLED_INSERT_TRANSACTION:new U("001-00052","Disabled insert {trsName} Transaction"),TRANSACTION_IS_IN_UNCHANGABLE_STATE:new U("001-00053","Transaction is in unchangable state"),ASSETSTATISTIC_INDEX_ALREADY_IN_USE:new U("001-00054","AssetStatistic index: {index} already in use"),INVALID_SIGNATURE:new U("001-00055","Invalid {taskLabel} signature"),INVALID_SIGNSIGNATURE:new U("001-00056","Invalid {taskLabel} signSignature"),INVALID_BASE_TYPE:new U("001-00057","Invalid base type {base_type}"),UNREGISTERED_TRANSACTION_FACTORY:new U("001-00058","Unregistered TransactionFactory {factoryName}"),UNREGISTERED_TRANSACTION_BASE_TYPE:new U("001-00059","Unregistered Transaction base type {trs_base}"),UNREGISTERED_TRANSACTION_TYPE:new U("001-00060","Unregistered Transaction type {trs_key}"),INVALID_FROMAUTHSIGNATURE:new U("001-00061","Invalid {taskLabel} fromAuthSignature"),INVALID_FROMAUTHSIGNSIGNATURE:new U("001-00062","Invalid {taskLabel} fromAuthSignSignature"),INVALID_TOAUTHSIGNATURE:new U("001-00063","Invalid {taskLabel} toAuthSignature"),INVALID_TOAUTHSIGNSIGNATURE:new U("001-00064","Invalid {taskLabel} toAuthSignSignature"),INVALID_MACRO_INPUT_TYPE:new U("001-00065","Invalid macro input type: {type}"),ALREADY_EXPIRED:new U("001-00066","{prop} in {target} already expired"),PROP_LOSE:new U("001-11001","{prop} in {target} lose"),ACCOUNT_FROZEN:new U("001-11002","Account with address {address} was frozen, status {status}, errorId {errorId}"),TRANSACTION_SIGN_SIGNATURE_IS_REQUIRED:new U("001-11003","Transaction signSignature is required, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),TRANSACTION_SENDER_SECOND_PUBLICKEY_ALREADY_CHANGE:new U("001-11004","Transaction sender second secret have already change, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),TRANSACTION_SHOULD_NOT_HAVE_SENDER_SECOND_PUBLICKEY:new U("001-11005","Transaction should not have senderSecondPublicKey, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),TRANSACTION_SHOULD_NOT_HAVE_SIGN_SIGNATURE:new U("001-11006","Transaction should not have signSignature, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),INVALID_TRANSACTION_APPLY_BLOCK_HEIGHT:new U("001-11007","Invalid transaction({signature}) apply block height, reason {reason}"),INVALID_TRANSACTION_EFFECTIVE_BLOCK_HEIGHT:new U("001-11008","Invalid transaction({signature}) effective block height, reason {reason}"),INVALID_TRANSACTION_FROM_MAGIC:new U("001-11009","Invalid transaction from magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),INVALID_TRANSACTION_TO_MAGIC:new U("001-11010","Invalid transaction to magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),INVALID_TRANSACTION_TIMESTAMP:new U("001-11011","Invalid transaction timestamp, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),DAPPID_IS_NOT_EXIST:new U("001-11012","DAppid is not exist, dappid {dappid}"),DAPPID_IS_ALREADY_EXIST:new U("001-11013","DAppid is already exist, dappid {dappid}, errorId {errorId}"),LOCATION_NAME_IS_NOT_EXIST:new U("001-11014","LocationName is not exist, locationName {locationName}, errorId {errorId}"),LOCATION_NAME_IS_ALREADY_EXIST:new U("001-11015","LocationName is already exist, locationName {locationName}, errorId {errorId}"),ENTITY_FACTORY_IS_NOT_EXIST:new U("001-11016","Entity factory is not exist, factoryId {factoryId}"),ENTITY_FACTORY_IS_ALREADY_EXIST:new U("001-11017","Entity factory is already exist, factoryId {factoryId}, errorId {errorId}"),ENTITY_IS_NOT_EXIST:new U("001-11018","Entity is not exist, entityId {entityId}"),ENTITY_IS_ALREADY_EXIST:new U("001-11019","Entity is already exist, entityId {entityId}, errorId {errorId}"),UNKNOWN_RANGE_TYPE:new U("001-11020","Unknow rangeType, rangeType {rangeType}"),INVALID_TRANSACTION_BYTE_LENGTH:new U("001-11021","Invalid transaction byte length, reason {reason}"),NEED_PURCHASE_DAPPID_BEFORE_USE:new U("001-11022","Need purchase dappid before use, dappid {dappid}"),CAN_NOT_DELETE_LOCATION_NAME:new U("001-11025","Can not delete locationName {locationName}, reason {reason}"),SET_LOCATION_NAME_MANAGER_FIELD:new U("001-11026","Set locationName {locationName} manager field, reason {reason}, errorId {errorId}"),SET_LOCATION_NAME_RECORD_VALUE_FIELD:new U("001-11027","Set locationName {locationName} recordValue field, reason {reason}, errorId {errorId}"),ASSET_NOT_ENOUGH:new U("001-11028","Asset not enough, reason {reason}, errorId {errorId}"),ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH:new U("001-11029","Account remain equity not enough, reason {reason}, errorId {errorId}"),NOT_BEGIN_UNFROZEN_YET:new U("001-11030","Frozen asset is not begin to unfrozen yet, frozenId {frozenId}"),FROZEN_ASSET_EXPIRATION:new U("001-11031","Frozen asset is already expiration, frozenId {frozenId}"),UNFROZEN_TIME_USE_UP:new U("001-11032","Gift asset unfrozen time use up, frozenId {frozenId}"),FORBIDDEN:new U("001-11038","{prop} in {target} is forbidden"),ASSET_NOT_EXIST:new U("001-11039","Asset not exist, magic {magic} assetType {assetType}"),ACCOUNT_NOT_DAPPID_POSSESSOR:new U("001-11040","Account with address {address} not dappid {dappid} possessor, errorId {errorId}"),ACCOUNT_NOT_LOCATION_NAME_POSSESSOR:new U("001-11041","Account with address {address} not locationName {locationName} possessor, errorId {errorId}"),ACCOUNT_NOT_ENTITY_POSSESSOR:new U("001-11042","Account with address {address} not entityId {entityId} possessor, errorId {errorId}"),DAPPID_NOT_FROZEN:new U("001-11043","DAppid not frozen, dappid {dappid}"),DAPPID_ALREADY_FROZEN:new U("001-11044","DAppid already frozen, dappid {dappid}"),LOCATION_NAME_NOT_FROZEN:new U("001-11045","LocationName not frozen, locationName {locationName}"),LOCATION_NAME_ALREADY_FROZEN:new U("001-11046","LocationName already frozen, locationName {locationName}"),ENTITY_NOT_FROZEN:new U("001-11047","Entity not frozen, entityId {entityId}"),ENTITY_ALREADY_FROZEN:new U("001-11048","Entity already frozen, entityId {entityId}"),NO_NEED_TO_PURCHASE_SPECIAL_ASSET:new U("001-11049","No need to purchase asset, type {type} asset {asset}"),ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE:new U("001-11050","Only top level location name can exchange"),CAN_NOT_DESTROY_ENTITY:new U("001-11051","Can not destroy entityId {entityId}, reason {reason}"),ENTITY_ALREADY_DESTROY:new U("001-11052","Entity already destroy, entityId {entityId}"),ASSET_IS_ALREADY_MIGRATION:new U("001-11053","Asset is already migration, migrateCertificateId {migrateCertificateId}"),NOT_EXIST_OR_EXPIRED:new U("001-11054","{prop} in {target} not exist or expired"),NOT_EXPECTED_RELATED_TRANSACTION:new U("001-11055","Transaction with signature {signature} is not an expected related transaction"),CAN_NOT_SECONDARY_TRANSACTION:new U("001-11056","Can not secondary transaction, reason {reason}"),REGISTER_GENERATOR_QUOTA_FULL:new U("001-11057","The register generator quota is full in round {round}"),GENERATOR_CAN_NOT_MIGRATE_ASSET:new U("001-11058","Generator can not migrate asset"),MIGRATE_MAIN_ASSET_ONLY:new U("001-11059","You can only migrate main asset, {assetType} is not main asset {mainAsset}"),CAN_NOT_CARRY_SECOND_PUBLICKEY:new U("001-11060","Can not carry second publicKey"),CAN_NOT_CARRY_SECOND_SIGNATURE:new U("001-11061","Can not carry second signature"),POSSESS_FROZEN_ASSET:new U("001-11063","Account possess frozen asset"),NEED_EMIGRATE_TOTAL_ASSET:new U("001-11064","Need emigrate total asset, address {address}"),POSSESS_ASSET_EXCEPT_CHAIN_ASSET:new U("001-11065","Account possess asset expect chain asset"),POSSESS_FROZEN_ASSET_EXCEPT_CHAIN_ASSET:new U("001-11066","Account possess frozen asset expect chain asset"),ACCOUNT_CAN_NOT_BE_FROZEN:new U("001-11067","Account with address {address} can not be frozen, reason {reason}, errorId {errorId}"),TRUST_MAIN_ASSET_ONLY:new U("001-11068","You can only trust main asset, {assetType} is not main asset {mainAsset}"),ISSUE_ENTITY_TIMES_USE_UP:new U("001-11070","Issue entity times use up, entityFactory {entityFactory}"),ASSET_ALREADY_EXIST:new U("001-11071","Asset already exist, magic {magic} assetType {assetType}"),FROZEN_ASSET_NOT_EXIST_OR_EXPIRED:new U("001-11072","Frozen asset with frozenAddress {frozenAddress} signature {signature} assetType {assetType} in blockChain not exist or expired"),NOT_ENOUGH_ISSUE_ENTITY_TIMES:new U("001-11073","Not enough issue entity times, entityFactory {entityFactory}"),NOT_BEGIN_RESOLVE_YET:new U("001-11074","Promise is not begin to resolve yet, promiseId {promiseId}"),CERTIFICATE_IS_NOT_EXIST:new U("001-11075","Certificate is not exist, certificateId {certificateId}"),CERTIFICATE_IS_ALREADY_EXIST:new U("001-11076","Certificate is already exist, certificateId {certificateId}, errorId {errorId}"),CAN_NOT_DESTROY_CERTIFICATE:new U("001-11077","Can not destroy certificate, certificateId {certificateId}, reason {reason}"),ACCOUNT_NOT_CERTIFICATE_POSSESSOR:new U("001-11078","Account with address {address} not certificate {certificateId} possessor, errorId {errorId}"),CERTIFICATE_NOT_FROZEN:new U("001-11079","Certificate not frozen, certificateId {certificateId}"),CERTIFICATE_ALREADY_FROZEN:new U("001-11080","Certificate already frozen, certificateId {certificateId}"),CERTIFICATE_ALREADY_DESTROY:new U("001-11081","Certificate already destroy, certificateId {certificateId}"),FROZEN_ASSET_NOT_ENOUGH:new U("001-11082","Frozen asset not enough, frozenId {frozenId}, reason {reason}"),STAKE_ASSET_NOT_EXIST_OR_EXPIRED:new U("001-11083","Stake asset with stakeAddress {stakeAddress} stakeId {stakeId} in blockChain not exist or expired"),NOT_BEGIN_UNSTAKE_YET:new U("001-11084","Stake asset is not begin to unstake yet, stakeId {stakeId}"),STAKE_ASSET_NOT_ENOUGH:new U("001-11085","Stake asset not enough, stakeId {stakeId}, reason {reason}"),BLOCK_SIGN_SIGNATURE_IS_REQUIRED:new U("001-12001","Block signSignature is required, signature {signature} generatorAddress {generatorAddress} height {height}"),BLOCK_GENERATOR_SECOND_PUBLICKEY_ALREADY_CHANGE:new U("001-12002","Block generator second secret have already change, signature {signature} generatorAddress {generatorAddress} height {height}"),BLOCK_SHOULD_NOT_HAVE_GENERATOR_SECOND_PUBLICKEY:new U("001-12003","Block should not have generatorSecondPublicKey, signature {signature} generatorAddress {generatorAddress} height {height}"),BLOCK_SHOULD_NOT_HAVE_SIGN_SIGNATURE:new U("001-12004","Block should not have signSignature, signature {signature} generatorAddress {generatorAddress} height {height}"),OUT_OF_RANGE:new U("001-12005","{variable} out of range"),FAILED_TO_FIND_NEAREST_SAME_BLOCK_IN_ONE_ROUND:new U("001-12006","Failed to find nearest same block in one round, should not happen"),GENESIS_BLOCK_NOT_MATCH:new U("001-12007","GenesisBlock not match, the signature of genesisBlock and synchronized peer's genesisBlock's signature not equal"),FAILED_TO_GET_BLOCKS_BY_RANGE:new U("000-12008","Falied to get blocks by range({minHeight}~{maxHeight})"),INVALID_PARAMS:new U("001-22001","Invalid params: {params}"),INVALID_PARAMS_FIELD:new U("001-22002","Invalid params field: {field}"),GENESIS_BLOCK_MAYBE_NO_EQUAL:new U("001-22003","GenesisBlock maybe no equal"),INVALID_QUERYBLOCKARG_QUERY_PARAMS:new U("001-22004","Invalid QueryBlockArg query params, no query conditions"),QUERY_BLOCK_FROM_PEER_TIMEOUT:new U("001-22005","QueryBlock ({query}) from peer({peerId}) timeout"),REQID_REUSE:new U("001-22006","ReqId reuse"),CHAINCHANNEL_CLOSED:new U("001-22007","chainChannel closed"),REFUSE_RESPONSE_QUERY_TRANSACTION:new U("001-22008","Refuse response query transaction"),REFUSE_RESPONSE_INDEX_TRANSACTION:new U("001-22009","Refuse response index transaction"),REFUSE_RESPONSE_DOWNLOAD_TRANSACTION:new U("001-22010","Refuse response download transaction"),REFUSE_RESPONSE_BROADCAST_TRANSACTION:new U("001-22011","Refuse response broadcast transaction"),REFUSE_RESPONSE_QUERY_BLOCK:new U("001-22012","Refuse response query block"),REFUSE_RESPONSE_BROADCAST_BLOCK:new U("001-22013","Refuse response broadcast block"),MESSAGE_TYPE_ERROR:new U("001-22014","Message type error"),ONMESSAGE_GET_INVALID_REQ_ID:new U("001-22015","OnMessage get invalid req_id: {req_id}"),REQUEST_LIMIT:new U("001-22016","Request limit"),INVALID_MESSAGE_CMD:new U("001-22017","Invalid message cmd"),CHAINCHANNEL_TIMEOUT:new U("001-22018","ChainChannel Timeout, cmd {cmd}"),TASK_ABORT:new U("001-22019","Task {task_id} abort because the free chainChannel size is zero"),REFUSE_RESPONSE_OPEN_BLOB:new U("001-22020","Refuse response open blob"),REFUSE_RESPONSE_READ_BLOB:new U("001-22021","Refuse response read blob"),REFUSE_RESPONSE_CLOSE_BLOB:new U("001-22022","Refuse response close blob"),BLOB_ALGORITHM_IS_INVALID:new U("001-23001","blob({hash}) algorithm({algorithm}) is invalid"),FAIL_TO_DOWNLOAD_BLOB:new U("001-23002","Fail to download blob({hash}) size({size})")},FE=new Map,Cp=Error.captureStackTrace?e=>{const t={stack:""};return Error.captureStackTrace(t,e),t.stack}:Function("f",`
    let deep = 0;
    let caller = arguments.callee;
    do {
      if (caller.caller === f) {
        break;
      }
      deep += 1;
      caller = caller.caller;
      if (caller === null) {
        break;
      }
    } while (true);
    const stack = new Error().stack || "";
    const stackLineLine = stack.split('\\n');
    stackLineLine.splice(1, deep);
    return stackLineLine.join('\\n');
  `),Wm=class gI extends Error{get name(){return this.constructor.name}static call(t,r){if(!(t instanceof gI))throw new TypeError("please use new keyword to create CustomError instance.");return t.stack=Cp(t.constructor),t.message=r||"",t}},Qg=()=>{},Zm=Symbol("cog");function e_(e){for(const[t,r]of Object.entries(Object.getOwnPropertyDescriptors(e))){const n=r.get;n&&!n[Zm]&&(r.get=()=>{const s=n();return Object.defineProperty(e,t,{value:s}),s},r.get[Zm]=!0,Object.defineProperty(e,t,r))}return e}var t_=new Map,UE=(e=>(e.BLOCKER="blocker",e.CRITICAL="critical",e.MAJOR="major",e.MINOR="minor",e))(UE||{}),qe=class extends Wm{constructor(e="",t,r,n){super(t?e instanceof U?e.build(t):e.replace(/\{([^\\]+?)\}/g,(o,c)=>t[c]??o):e instanceof U?e.message:e),this.detail=t;const s=this.constructor,{ERROR_CODE_MAP:i}=s;Object.defineProperties(this,{detail:{value:t,enumerable:!1,writable:!1},sourceMessage:{value:e,enumerable:!1,writable:!1},type:{value:s.TYPE,enumerable:!1,writable:!1},PLATFORM:{value:s.PLATFORM,enumerable:!1,writable:!1},CHANNEL:{value:s.CHANNEL,enumerable:!1,writable:!1},BUSINESS:{value:s.BUSINESS,enumerable:!1,writable:!1},MODULE:{value:s.MODULE,enumerable:!1,writable:!1},FILE:{value:s.FILE,enumerable:!1,writable:!1},CODE:{value:r??(e instanceof U?e.code:i.get(e)||i.get("unknown error")||""),enumerable:!1,writable:!1},SEVERIFY:{value:n||"major",enumerable:!1,writable:!1}})}get name(){return this.constructor.TYPE}static is(e){return!(!e||e.type!==this.TYPE)}};function $E(e,t,r,n,s,i){function o(c){return c.PLATFORM=e,c.CHANNEL=t,c.BUSINESS=r,c.MODULE=n,c.FILE=s,c.ERROR_CODE_MAP=i,Object.freeze(c),c}return e_({getException:o,get Exception(){const c=qe;return o(class extends c{})},get OutOfRangeException(){var c;return o(((c=class extends qe{}).TYPE="OutOfRangeException",c))},get ArgumentException(){var c;return o(((c=class extends qe{}).TYPE="ArgumentException",c))},get ArgumentIllegalException(){var c;return o(((c=class extends qe{}).TYPE="ArgumentIllegalException",c))},get ArgumentFormatException(){var c;return o(((c=class extends qe{}).TYPE="ArgumentFormatException",c))},get NoFoundException(){var c;return o(((c=class extends qe{}).TYPE="NoFoundException",c))},get ResponseException(){var c;return o(((c=class extends qe{}).TYPE="ResponseException",c))},get IOException(){var c;return o(((c=class extends qe{}).TYPE="IOException",c))},get NetworkIOException(){var c;return o(((c=class extends qe{}).TYPE="NetworkIOException",c))},get BusyIOException(){var c;return o(((c=class extends qe{}).TYPE="BusyIOException",c))},get DatebaseIOException(){var c;return o(((c=class extends qe{}).TYPE="DatebaseIOException",c))},get InterruptedException(){var c;return o(((c=class extends qe{}).TYPE="InterruptedException",c))},get IllegalStateException(){var c;return o(((c=class extends qe{}).TYPE="IllegalStateException",c))},get TimeOutException(){var c;return o(((c=class extends qe{}).TYPE="TimeOutException",c))},get BusyException(){var c;return o(((c=class extends qe{}).TYPE="BusyException",c))},get ConsensusException(){var c;return o(((c=class extends qe{}).TYPE="ConsensusException",c))},get AbortException(){var c;return o(((c=class extends qe{}).TYPE="AbortException",c))},get RefuseException(){var c;return o(((c=class extends qe{}).TYPE="RefuseException",c))}})}qe.TYPE="Exception",qe.PLATFORM="",qe.CHANNEL="",qe.BUSINESS="",qe.MODULE="",qe.FILE="",qe.CODE="",qe.SEVERIFY="major",qe.ERROR_CODE_MAP=t_,typeof Error.stackTraceLimit=="number"&&(Error.stackTraceLimit+=3);var ro=1e3,no=60*ro,so=60*no,Zi=24*so,VE=7*Zi,GE=365.25*Zi;function KE(e,t={}){switch(typeof e){case"string":if(e.length>0)return jE(e);break;case"number":if(isFinite(e))return t.long?JE(e):zE(e)}throw new Error(`val is not a non-empty string or a valid number. val=${JSON.stringify(e)}`)}function jE(e){const t=String(e);if(t.length>100)return;const r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!r)return;const n=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*GE;case"weeks":case"week":case"w":return n*VE;case"days":case"day":case"d":return n*Zi;case"hours":case"hour":case"hrs":case"hr":case"h":return n*so;case"minutes":case"minute":case"mins":case"min":case"m":return n*no;case"seconds":case"second":case"secs":case"sec":case"s":return n*ro;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}function zE(e){const t=Math.abs(e);return t>=Zi?`${Math.round(e/Zi)}d`:t>=so?`${Math.round(e/so)}h`:t>=no?`${Math.round(e/no)}m`:t>=ro?`${Math.round(e/ro)}s`:`${e}ms`}function JE(e){const t=Math.abs(e);return t>=Zi?tl(e,t,Zi,"day"):t>=so?tl(e,t,so,"hour"):t>=no?tl(e,t,no,"minute"):t>=ro?tl(e,t,ro,"second"):`${e} ms`}function tl(e,t,r,n){const s=t>=1.5*r;return`${Math.round(e/r)} ${n}${s?"s":""}`}var r_,n_,s_,Mr;function YE(e){return e.source.slice(1,-1).replace(/\.\*\?$/,"*").replace(/\\/g,"")}function i_(e){const t=e[0]==="-";return{type:t?"disable":"enable",source:e,regexp:new RegExp("^"+e.substr(t?1:0).replace(/\*/g,".*?")+"$")}}function XE(e){return(e.type==="disable"?"-":"")+YE(e.regexp)}var QE=class{constructor(){this.namespaceFilters=[],this._levelFilter=e=>!0,this._createdDebugCache=new Gt(e=>new Rp(e,this)),this.setNamespaceFilter(this.load())}getNamespaceFilter(){return this.namespaceFilters.map(e=>e.source)}_resetInstancesEnabled(){for(const e of this._createdDebugCache.values()){e.forceSetEnabled(this.isEnabled(e.namespace,e.level));for(const t of e.scopePrinterMap.keys())t.enabled=this.levelFilter(t.level)}}setNamespaceFilter(e){e=typeof e=="string"?e:e.join(","),this.namespaceFilters.length=0;const t=[...new Set(e.split(/[\s,]+/))];for(const r of t)r&&this.namespaceFilters.push(i_(r));this._resetInstancesEnabled(),this.save(t.join(","))}addNamespaceFilter(e,t){this.removeNamespaceFilter(e),e=typeof e=="string"?i_(e):e,t===void 0||t>this.namespaceFilters.length-1||t<0?this.namespaceFilters.push(e):this.namespaceFilters.splice(t,0,e),this._resetInstancesEnabled(),this.save(this.getNamespaceFilter().join(","))}removeNamespaceFilter(e){const t=r=>r>=0&&r<this.namespaceFilters.length&&(this.namespaceFilters.splice(r,1),this._resetInstancesEnabled(),this.save(this.getNamespaceFilter().join(",")),!0);return typeof e=="number"?t(e):typeof e=="string"?t(this.namespaceFilters.findIndex(r=>r.source===e)):t(this.namespaceFilters.indexOf(e))||this.removeNamespaceFilter(XE(e))}get levelFilter(){return this._levelFilter}set levelFilter(e){this._levelFilter=e,this._resetInstancesEnabled()}isEnabled(e,t){if(!this.levelFilter(t))return!1;if(e[e.length-1]==="*")return!0;for(let r=this.namespaceFilters.length-1;r>=0;r--){const n=this.namespaceFilters[r];if(n.regexp.test(e))return n.type==="enable"}return!1}selectColor(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return this.colors[Math.abs(t)%this.colors.length]}getCreatedDebugs(){return this._createdDebugCache.values()}create(e){return this._createdDebugCache.forceGet(e)}destroy(e){return this._createdDebugCache.delete(e)}},Rp=class{constructor(e,t,r){this.namespace=e,this._creater=t,this.__prev=0,this.__curr=0,this._scope=new Gt(o=>{const c=Gt.from({creater:l=>({id:this._scopeIdAcc++,color:o,level:l,enabled:this._creater.levelFilter(l)}),afterDelete:()=>{c.size===0&&this._scope.delete(o)}});return c}),this._scopeIdAcc=0,this.scopePrinterMap=Gt.from({creater:o=>this._printerBuilder(o)}),this.$enableDefaultFormatter=!1,typeof t.init=="function"&&t.init(this);let n=0,s=!1,i=!1;return r&&(r.enableTime!==void 0&&(s=r.enableTime),r.enableDuration!==void 0&&(i=r.enableDuration),r.level!==void 0&&(n=r.level)),this._config={useColors:this._creater.canUseColors(),enabled:this._creater.isEnabled(this.namespace,n),color:this._creater.selectColor(this.namespace),level:n,enableTime:s,enableDuration:i},this}get useColors(){return this._config.useColors}forceSetUseColors(e){this._config.useColors=e}get enabled(){return this._config.enabled}forceSetEnabled(e){this._config.enabled=e}get color(){return this._config.color}get level(){return this._config.level}get enableTime(){return this._config.enableTime}get enableDuration(){return this._config.enableDuration}getDiff(){return this._curr-this._prev}get _prev(){return this.__prev}get _curr(){return this.__curr||(this.__curr=Date.now())}_resetDiff(){this.__prev=this.__curr,this.__curr=0}getDuration(){return KE(this.getDiff())}get _dater(){return new Date}getTime(){return this._dater.setTime(Date.now()),this._dater.toLocaleTimeString()}destroy(){this._config.enabled=!1,this._creater.destroy(this.namespace)}get print(){return this.scopePrinterMap.forceGet(this._config)}createPrinter(e,t){const r=this._scope.forceGet(e).forceGet(t);return this.scopePrinterMap.forceGet(r)}deletePrinter(e,t){const r=this._scope.tryGet(e);if(r){const n=r.tryGet(t);if(n)return r.delete(t),this.scopePrinterMap.delete(n)}return!1}_printerBuilder(e){const{_creater:t}=this,r=()=>e.enabled&&this.enabled,n=(...s)=>{if(!r())return;this._resetDiff();let i=typeof s[0]!="string"?"%O":s.shift();if(this.$enableDefaultFormatter){let c=0;i=i.replace(/%([a-zA-Z%])/g,(l,u)=>{if(l==="%%")return l;const g=t.formatters[u];return typeof g=="function"&&(l=g(this,s[c]),s.splice(c,1),c--),c++,l})}const o=[i,...s];t.formatArgs(this,o,e),t.printArgs(this,o,e)};return Object.defineProperty(n,"enabled",{get:r}),n}};p([ie,h("design:type",Object),h("design:paramtypes",[])],Rp.prototype,"_dater",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Rp.prototype,"print",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object,typeof(r_=typeof BFChainUtilLogger<"u"&&BFChainUtilLogger.DebugLevel)=="function"?r_:Object]),h("design:returntype",typeof(n_=typeof BFChainUtilLogger<"u"&&BFChainUtilLogger.Pinter)=="function"?n_:Object)],Rp.prototype,"createPrinter",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object,typeof(s_=typeof BFChainUtilLogger<"u"&&BFChainUtilLogger.DebugLevel)=="function"?s_:Object]),h("design:returntype",Boolean)],Rp.prototype,"deletePrinter",null),(function(e){e[e.log=0]="log",e[e.info=1]="info",e[e.warn=2]="warn",e[e.trace=3]="trace",e[e.success=4]="success",e[e.error=5]="error"})(Mr||(Mr={}));var io=class Gy extends QE{constructor(){super(...arguments),this.formatters={j(t,r){try{return JSON.stringify(r)}catch(n){return"[UnexpectedJSONParseError]: "+(n instanceof Error?n.message:n)}},t(t,r){let n;switch(typeof r){case"string":case"number":n=r;break;default:n=r instanceof Date?r:String(r)}return new Date(n).toLocaleString()},s:(t,r)=>String(r),d:(t,r)=>Number(r).toString()}}get colorTypeName(){return"browser"}get colors(){return"0000CC 0000FF 0033CC 0033FF 0066CC 0050c8 006080 005c99 006800 00681a 006733 00654c 006363 006179 3300CC 3300FF 3333CC 3232fb 2b55aa 274ec4 205f7e 1e5b97 1a6700 1a671a 196633 19644b 196262 186078 6600CC 6500fd 6633CC 5c2ee6 326500 326419 9100c2 8300da 842cb1 7928ca 496100 486018 b60000 b4002d b00058 a9007e 9f009f 9500ba a72a00 a62a2a a32951 9d2776 952595 8c23af 8c4600 8b4523 715400 70541c 5c5c00 5b5b17 b50024 b20047 ad0068 a70086 ac2200 ab2222 a82243 a42163 9f207f 981e98 973d00 973c1e 804d00 804d1a 6c5600 6c5616".split(" ").map(t=>"#"+t)}get storage(){try{return localStorage}catch{}}load(){let t;return t=this.storage&&this.storage.getItem("debug"),!t&&typeof process<"u"&&"env"in process&&(t={}.DEBUG),t||""}save(t){this.storage&&(t?this.storage.setItem("debug",t):this.storage.removeItem("debug"))}canUseColors(){return!0}static _getHtmlNamespace(t){let r=this._NamespaceWithToHtmlCache.get(t);return r===void 0&&(r=new this._namespaceCtor(t.namespace),this._NamespaceWithToHtmlCache.set(t,r)),r}static _getHtmlDuration(t){return new this._durationCtor(t)}formatArgs(t,r,n=t){const s="color: "+n.color;if(t.useColors){const i=[],o=Gy._getHtmlNamespace(t);o.buildHTML(s),t.enableTime?(r[0]=`[%s] %o %c${r[0]}`,i[i.length]=t.getTime(),i[i.length]=o):(r[0]=`%o ${r[0]}`,i[i.length]=o),r.splice(1,0,...i)}else r[0]=`${t.namespace} ${r[0]}`,t.enableTime&&(r[0]=`[${t.getTime()}] ${r[0]}`);if(t.enableDuration)if(t.useColors){const i=Gy._getHtmlDuration(t.getDiff());i.buildHTML(s),r[r.length]=i}else r.push(`+${t.getDuration()}`);return r}printArgs(t,r,n=t){switch(n.level){case Mr.log:console.log(...r);break;case Mr.info:console.info(...r);break;case Mr.warn:console.warn(...r);break;case Mr.trace:console.trace(...r);break;case Mr.success:console.info(...r);break;case Mr.error:console.error(...r)}}};io._NamespaceWithToHtmlCache=new WeakMap,io._namespaceCtor=new Function(`return class Namespace extends String {
    buildHTML(style) {
      if ((this.buildHTML.tmpStyle = style)) {
        this.buildHTML.tmpStyle = style;
        this.buildHTML.tmpHTML = \`<i class="logger-namespace" style="\${style}">\${this}ms</i>\`;
      }
    }
    toHTML() {
      return this.buildHTML.tmpHTML || this.toString();
    }
  }`)(),io._durationCtor=new Function(`return class Duration extends Number {
      buildHTML(style) {
        if ((this.buildHTML.tmpStyle = style)) {
          this.buildHTML.tmpStyle = style;
          this.buildHTML.tmpHTML = \`<i class="logger-duration" style="\${style}">+\${this}</i>\`;
        }
      }
      toHTML() {
        return this.buildHTML.tmpHTML || this.toString();
      }
    }`)(),p([ie,h("design:type",Object),h("design:paramtypes",[])],io.prototype,"colors",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],io.prototype,"storage",null);var qE=()=>new io,WE=qE(),ao={log:"inherit",info:"inherit",trace:"inherit",success:"inherit",warn:"inherit",error:"inherit"};function oo(e,t,r){const n=WE.create(e);return n.forceSetUseColors(!0),n.createPrinter(n.color,r)}function ZE(e){return e_({get log(){return oo(e,ao.log,Mr.log)},get info(){return oo(e,ao.info,Mr.info)},get warn(){return oo(e,ao.warn,Mr.warn)},get success(){return oo(e,ao.success,Mr.success)},get trace(){return oo(e,ao.trace,Mr.trace)},get error(){return oo(e,ao.error,Mr.error)}})}var a_=!!(typeof process<"u"&&process&&process.versions&&process.versions.node),eT=typeof process<"u"&&(process.platform==="win32"||/^(msys|cygwin)$/.test(Uy&&{}.OSTYPE)),qg=(e,t)=>{try{return new Function(`return typeof ${e} === "${t}"`)()}catch{return!1}},o_=qg("cordova","object"),Pp=qg("navigator","object"),tT=Pp&&/Android/i.test(navigator.userAgent),rT=Pp&&/iPhone|iPod|iPad/i.test(navigator.userAgent),Wg=Pp&&qg("document","object"),c_=Pp&&!Wg,Cs={getGlobalFlag(e,t=""){const r=this.global();return r[e]||r.process&&r.process.env&&r.process.env[e]||r.location&&r.location.href&&new URL(r.location.href).searchParams.get(e)||r.localStorage&&r.localStorage.getItem(e)||t},global(){const e=typeof globalThis=="object"?globalThis:typeof self=="object"?self.globalThis=self:typeof globalThis=="object"?globalThis.globalThis=globalThis:Function("return this")();return this.global=()=>e,e},platformName(){if(a_)return"Nodejs";const e=tT?"Android":rT?"IOS":"unknown";return o_?"Cordova-"+e:Wg?"WebMaster-"+e:c_?"WebWorker-"+e:"UNKNOWN"},getChannel:()=>"UNKNOWN",getBusiness:()=>"UNKNOWN"},p_,xp;function nT(e,t,r,n,s,i){let o=`${t.toLowerCase()}-${r.toLowerCase()}`;n&&(o+=`:${n}`),s&&(o+=`/${s}`);const c=ZE(o),l=$E(e,t,r,n,s,i);return new Proxy({},{get:(u,g)=>u[g]||c[g]||l[g]})}function sT(e){const t=typeof e.platform=="string"?e.platform:Cs.getGlobalFlag("PLATFORM")||Cs.platformName(),r=typeof e.platform=="string"?e.platform:Cs.getGlobalFlag("CHANNEL")||Cs.getChannel(),n=typeof e.platform=="string"?e.platform:Cs.getGlobalFlag("BUSINESS")||Cs.getBusiness();return function(s,i,o){return nT(o.platformName||t,o.channelName||r,o.businessName||n,s,i,o.errorCodeMap)}}(function(e){e.PLATFORM="exception.platform",e.CHANNEL="exception.channel",e.BUSINESS="exception.business"})(xp||(xp={}));var co=class{constructor(e){this.moduleMap=e,this.platformName=void 0,this.channelName=void 0,this.businessName=void 0,this.exceptionGeneratorDefiner=sT({platform:this.platformName,channel:this.channelName,business:this.businessName})}};p([k(xp.PLATFORM,{dynamics:!0,optional:!0}),h("design:type",String)],co.prototype,"platformName",void 0),p([k(xp.CHANNEL,{dynamics:!0,optional:!0}),h("design:type",String)],co.prototype,"channelName",void 0),p([k(xp.BUSINESS,{dynamics:!0,optional:!0}),h("design:type",String)],co.prototype,"businessName",void 0),co=p([j("bfchain-util:custom-exception",{singleton:!0}),h("design:paramtypes",[typeof(p_=je!==void 0&&je)=="function"?p_:Object])],co);var iT=At(co);function h_(e,t,r){return iT.exceptionGeneratorDefiner(e,t,Object.assign({errorCodeMap:t_,businessName:"util"},r))}var l_=class extends qe{};l_.TYPE="IdempotentException";function Z(e,t){const r=h_(e,t,{errorCodeMap:FE,businessName:"core"});let n;return Object.create(r,{IdempotentException:{get(){return n??(n=r.getException(l_))}}})}var rl,{ArgumentFormatException:Zg,error:qb,IllegalStateException:aT}=Z("MODEL","transactionModel");(()=>{const e=new Map,t=new Map;for(const s in B){const i=B[s];t.set(s,i),e.set(i,s)}const r=new Map,n=new Map;[[B.SIGNATURE,tp],[B.DAPP,rp],[B.DAPP_PURCHASING,np],[B.MARK,sp],[B.ISSUE_ASSET,ip],[B.INCREASE_ASSET,ap],[B.DESTROY_ASSET,cp],[B.TRANSFER_ASSET,op],[B.GIFT_ASSET,Ji],[B.GRAB_ASSET,pp],[B.TRUST_ASSET,qa],[B.SIGN_FOR_ASSET,hp],[B.EMIGRATE_ASSET,lp],[B.IMMIGRATE_ASSET,up],[B.TO_EXCHANGE_ASSET,Wa],[B.BE_EXCHANGE_ASSET,gp],[B.STAKE_ASSET,Yi],[B.UNSTAKE_ASSET,fp],[B.LOCATION_NAME,dp],[B.SET_LNS_RECORD_VALUE,mp],[B.SET_LNS_MANAGER,yp],[B.ISSUE_ENTITY_FACTORY,_p],[B.ISSUE_ENTITY_FACTORY_V1,Ap],[B.ISSUE_ENTITY,Xi],[B.DESTROY_ENTITY,Ip],[B.ISSUE_ENTITY_MULTI,Qi],[B.TRANSFER_ANY,Ep],[B.GIFT_ANY,qi],[B.GRAB_ANY,Tp],[B.TO_EXCHANGE_ANY,Za],[B.BE_EXCHANGE_ANY,Sp],[B.TO_EXCHANGE_ANY_MULTI,eo],[B.BE_EXCHANGE_ANY_MULTI,bp],[B.TO_EXCHANGE_ANY_MULTI_ALL,to],[B.BE_EXCHANGE_ANY_MULTI_ALL,wp],[B.ISSUE_CERTIFICATE,Np],[B.DESTROY_CERTIFICATE,Op]].forEach(([s,i])=>{r.set(s,i),n.set(i,s)}),ve.VK=e,ve.KV=t,ve.VM=r,ve.MV=n})();var ef=new WeakMap,ea=rl=class extends J{get transaction(){let e=ef.get(this._trs_bytes);if(!e){const t=ve.VM.get(this._trs_base_type);if(!t)throw new Zg(a.INVALID_TRANSACTION_BASE_TYPE,{base_type:this._trs_base_type});e=t.decode(this._trs_bytes),ef.set(this._trs_bytes,Object.freeze(e))}return e}set transaction(e){const t=ve.trsTypeToV(e.type);if(!ve.VK.has(t))throw new Zg(a.INVALID_TRANSACTION_BASE_TYPE,{base_type:t});if(Object.isFrozen(this))throw new aT(a.TRANSACTION_IS_IN_UNCHANGABLE_STATE);this._trs_base_type=t,this._trs_bytes=new Uint8Array(e.constructor.encode(e).finish()),Object.isFrozen(e)&&ef.set(this._trs_bytes,e)}static fromObject(e){const t=super.fromObject(e);if(e!==t){const r=e.transaction;if(r)if(r instanceof J)t.transaction=r;else{const n=r.type;if(n){const s=ve.trsTypeToV(n),i=ve.VM.get(s);if(!i)throw new Zg(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.transaction=i.fromObject(r)}}}return t}toJSON(){return{transaction:this.transaction.toJSON()}}};ea.INC=1,p([_.d(rl.INC++,"string"),h("design:type",String)],ea.prototype,"_trs_base_type",void 0),p([_.d(rl.INC++,"bytes"),h("design:type",Uint8Array)],ea.prototype,"_trs_bytes",void 0),ea=rl=p([C.d("SomeTransactionModel")],ea);var nl,ta,ra=nl=class extends J{toJSON(){return{remainAssetPrealnum:this.remainAssetPrealnum,frozenMainAssetPrealnum:this.frozenMainAssetPrealnum}}};ra.INC=1,p([_.d(nl.INC++,"string"),h("design:type",String)],ra.prototype,"remainAssetPrealnum",void 0),p([_.d(nl.INC++,"string"),h("design:type",String)],ra.prototype,"frozenMainAssetPrealnum",void 0),ra=nl=p([C.d("AssetPrealnumModel")],ra);var Xt=ta=class extends ea{get signature(){return Ne(this.signatureBuffer)}set signature(e){this.signatureBuffer=me(e)}get signSignature(){return this.signSignatureBuffer&&Ne(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=me(e)}getBytes(e,t){const r={};e&&(r.signatureBuffer={value:null}),t&&(r.signSignatureBuffer={value:null});const n=Object.create(this,r);return this.$type.encode(n).finish()}toJSON(){const e={tIndex:this.tIndex,height:this.height,signature:this.signature,transaction:this.transaction.toJSON()};return this.assetPrealnum&&(e.assetPrealnum=this.assetPrealnum.toJSON()),this.signSignature&&(e.signSignature=this.signSignature),e}static fromObject(e){const t=super.fromObject(e);return e!==t&&(e.signature&&(t.signature=e.signature),e.signSignature&&(t.signSignature=e.signSignature)),t}};p([_.d(ta.INC++,"uint32"),h("design:type",Number)],Xt.prototype,"tIndex",void 0),p([_.d(ta.INC++,"uint32"),h("design:type",Number)],Xt.prototype,"height",void 0),p([_.d(ta.INC++,ra,"optional"),h("design:type",ra)],Xt.prototype,"assetPrealnum",void 0),p([_.d(ta.INC++,"bytes"),h("design:type",Uint8Array)],Xt.prototype,"signatureBuffer",void 0),p([_.d(ta.INC++,"bytes","optional"),h("design:type",Uint8Array)],Xt.prototype,"signSignatureBuffer",void 0),p([As,h("design:type",Function),h("design:paramtypes",[Boolean,Boolean]),h("design:returntype",void 0)],Xt.prototype,"getBytes",null),Xt=ta=p([C.d("TransactionInBlock")],Xt);function tf(e,t,r){const n=[];for(const s in e)n[n.length]={sortKey:s,value:r(e[s])};n.sort((s,i)=>s.sortKey>i.sortKey?1:-1),t.clear();for(const s of n)t.set(s.sortKey,s.value);return t}var po,Hn=po=class extends J{toJSON(){return{changeAmount:this.changeAmount,changeCount:this.changeCount,moveAmount:this.moveAmount,transactionCount:this.transactionCount}}};Hn.INC=1,p([_.d(po.INC++,"string","required","0"),h("design:type",String)],Hn.prototype,"changeAmount",void 0),p([_.d(po.INC++,"uint32","required",0),h("design:type",Number)],Hn.prototype,"changeCount",void 0),p([_.d(po.INC++,"string","required","0"),h("design:type",String)],Hn.prototype,"moveAmount",void 0),p([_.d(po.INC++,"uint32","required",0),h("design:type",Number)],Hn.prototype,"transactionCount",void 0),Hn=po=p([C.d("CountAndAmountStatisticModel")],Hn);var sl,rf,na=sl=class extends J{get typeStatisticMap(){return this._typeStatisticMap||(this._typeStatisticMap=new Xs(this.typeStatisticHashMap))}toJSON(){return{typeStatisticHashMap:this.typeStatisticMap.toJSON(),total:this.total.toJSON()}}static fromObject(e){return e.total||(e=Object.create(e,{total:{}})),super.fromObject(e)}format(){return tf(this.typeStatisticHashMap,this.typeStatisticMap,e=>e),this}};na.INC=1,p([kr.d(sl.INC++,"string",Hn),h("design:type",Object)],na.prototype,"typeStatisticHashMap",void 0),p([_.d(sl.INC++,Hn),h("design:type",Hn)],na.prototype,"total",void 0),na=sl=p([C.d("AssetStatisticModel")],na);var sa=rf=class extends J{get assetTypeTypeStatisticMap(){return this._assetTypeTypeStatisticMap||(this._assetTypeTypeStatisticMap=new Xs(this.assetTypeTypeStatisticHashMap))}toJSON(){return{assetTypeTypeStatisticHashMap:this.assetTypeTypeStatisticMap.toJSON()}}format(){return tf(this.assetTypeTypeStatisticHashMap,this.assetTypeTypeStatisticMap,e=>e.format()),this}static fromObject(e){return super.fromObject(e)}};sa.INC=1,p([kr.d(rf.INC++,"string",na),h("design:type",Object)],sa.prototype,"assetTypeTypeStatisticHashMap",void 0),sa=rf=p([C.d("AssetTypeAssetStatisticModel")],sa);var ci,jr=ci=class extends J{get magicAssetTypeTypeStatisticMap(){return this._magicAssetTypeTypeStatisticMap||(this._magicAssetTypeTypeStatisticMap=new Xs(this.magicAssetTypeTypeStatisticHashMap))}get numberOfTransactionsMap(){return this._numberOfTransactionsMap||(this._numberOfTransactionsMap=new Xs(this.numberOfTransactionsHashMap))}get numberOfTransactions(){let e=0;const t=this.numberOfTransactionsHashMap;for(const r in t)e+=t[r];return e}toJSON(){return{totalFee:this.totalFee,totalAsset:this.totalAsset,totalChainAsset:this.totalChainAsset,totalAccount:this.totalAccount,magicAssetTypeTypeStatisticHashMap:this.magicAssetTypeTypeStatisticMap.toJSON(),numberOfTransactionsHashMap:this.numberOfTransactionsHashMap}}getBytes(){return super.getBytes()}format(){return tf(this.magicAssetTypeTypeStatisticHashMap,this.magicAssetTypeTypeStatisticMap,e=>e.format()),this}};jr.INC=1,p([_.d(ci.INC++,"string","required","0"),h("design:type",String)],jr.prototype,"totalFee",void 0),p([_.d(ci.INC++,"string","required","0"),h("design:type",String)],jr.prototype,"totalAsset",void 0),p([_.d(ci.INC++,"string","required","0"),h("design:type",String)],jr.prototype,"totalChainAsset",void 0),p([_.d(ci.INC++,"uint32","required",0),h("design:type",Number)],jr.prototype,"totalAccount",void 0),p([kr.d(ci.INC++,"string",sa),h("design:type",Object)],jr.prototype,"magicAssetTypeTypeStatisticHashMap",void 0),p([kr.d(ci.INC++,"string","uint32"),h("design:type",Object)],jr.prototype,"numberOfTransactionsHashMap",void 0),p([As,h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],jr.prototype,"getBytes",null),jr=ci=p([C.d("StatisticInfoModel")],jr);var as,ho,oT=new Ga(e=>new Xs(e.remark)),u_=new WeakMap,nf=new WeakMap,sf=class extends J{};p([_.d(1,"uint32"),h("design:type",Number)],sf.prototype,"version",void 0),sf=p([C.d("BlockVersionReader")],sf);var zr=as=class extends J{get payloadHash(){return Ne(this.payloadHashBuffer)}set payloadHash(e){this.payloadHashBuffer=me(e)}get blobSize(){return this.blobSizeLong.toNumber()}set blobSize(e){this.blobSizeLong=hc.fromNumber(e,!0)}get totalAmount(){return this.statisticInfo.totalAsset||"0"}get totalFee(){return this.statisticInfo.totalFee||"0"}get transactionInBlocks(){const{transactionInBlockBufferList:e}=this;let t=u_.get(e);return t||(t=this.transactionInBlockBufferList.map(r=>{const n=Xt.decode(r);return nf.set(n,r),n})),t}set transactionInBlocks(e){const t=e.map(r=>{let n=nf.get(r);return n||(n=Xt.encode(r).finish(),nf.set(r,n)),n});u_.set(t,e),this.transactionInBlockBufferList=t}toJSON(){return{startTindex:this.startTindex,offset:this.offset,numberOfTransactions:this.numberOfTransactions,payloadHash:this.payloadHash,payloadLength:this.payloadLength,blobSize:this.blobSize,totalAmount:this.totalAmount,totalFee:this.totalFee,transactionInBlocks:this.transactionInBlocks.map(e=>e.toJSON()),statisticInfo:this.statisticInfo.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e){e.blobSize!==void 0&&(t.blobSize=e.blobSize),e.payloadHash&&(t.payloadHash=e.payloadHash);const r=[];if(e.transactionInBlocks){const n=e.transactionInBlocks;for(const s of n)r[r.length]=Xt.fromObject(s)}t.transactionInBlocks=r}return t}};zr.INC=1,p([_.d(as.INC++,"uint32"),h("design:type",Number)],zr.prototype,"startTindex",void 0),p([_.d(as.INC++,"uint32"),h("design:type",Number)],zr.prototype,"offset",void 0),p([_.d(as.INC++,"uint32"),h("design:type",Number)],zr.prototype,"numberOfTransactions",void 0),p([_.d(as.INC++,"bytes"),h("design:type",Uint8Array)],zr.prototype,"payloadHashBuffer",void 0),p([_.d(as.INC++,"uint32"),h("design:type",Number)],zr.prototype,"payloadLength",void 0),p([_.d(as.INC++,"uint64"),h("design:type",Object)],zr.prototype,"blobSizeLong",void 0),p([_.d(as.INC++,jr),h("design:type",jr)],zr.prototype,"statisticInfo",void 0),p([_.d(as.INC++,"bytes","repeated"),h("design:type",Array)],zr.prototype,"transactionInBlockBufferList",void 0),zr=as=p([C.d("BlockTransactionInfo")],zr);var It=ho=class extends J{get signature(){return Ne(this.signatureBuffer)}set signature(e){this.signatureBuffer=me(e)}get generatorPublicKey(){return Ne(this.generatorPublicKeyBuffer)}set generatorPublicKey(e){this.generatorPublicKeyBuffer=me(e)}get generatorSecondPublicKey(){return this.generatorSecondPublicKeyBuffer&&Ne(this.generatorSecondPublicKeyBuffer)||void 0}set generatorSecondPublicKey(e){this.generatorSecondPublicKeyBuffer=me(e)}get signSignature(){return this.signSignatureBuffer&&Ne(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=me(e)}get remarkMap(){return oT.forceGet(this)}get startTindex(){return this.transactionInfo.startTindex}get offset(){return this.transactionInfo.offset}get numberOfTransactions(){return this.transactionInfo.numberOfTransactions}get payloadHash(){return this.transactionInfo.payloadHash}get payloadLength(){return this.transactionInfo.payloadLength}get blobSize(){return this.transactionInfo.blobSize}get totalAmount(){return this.transactionInfo.totalAmount}get totalFee(){return this.transactionInfo.totalFee}get statisticInfo(){return this.transactionInfo.statisticInfo}get transactionBufferList(){return this.transactionInfo.transactionInBlockBufferList}get transactions(){return this.transactionInfo.transactionInBlocks}getBytes(e,t,r){const n={};if(e&&(n.signatureBuffer={value:null}),t&&(n.signSignatureBuffer={value:null}),r){const i=this.transactionInfo;r===!0?n.transactionInfo={value:{startTindex:i.startTindex,offset:i.offset,numberOfTransactions:i.numberOfTransactions,payloadHashBuffer:i.payloadHashBuffer,payloadLength:i.payloadLength,blobSizeLong:i.blobSizeLong,statisticInfo:i.statisticInfo,transactionInBlockBufferList:[],totalAmount:i.totalAmount,totalFee:i.totalFee}}:n.transactionInfo={value:{startTindex:i.startTindex,offset:i.offset,numberOfTransactions:i.numberOfTransactions,payloadHashBuffer:i.payloadHashBuffer,payloadLength:i.payloadLength,blobSizeLong:i.blobSizeLong,statisticInfo:i.statisticInfo,transactionInBlockBufferList:r,totalAmount:i.totalAmount,totalFee:i.totalFee}}}const s=Object.create(this,n);return this.$type.encode(s).finish()}toJSON(){const e={version:this.version,height:this.height,blockSize:this.blockSize,timestamp:this.timestamp,signature:this.signature,generatorPublicKey:this.generatorPublicKey,previousBlockSignature:this.previousBlockSignature,reward:this.reward,magic:this.magic,remark:this.remark,asset:this.asset.toJSON(),transactionInfo:this.transactionInfo.toJSON()};return this.generatorSecondPublicKey&&(e.generatorSecondPublicKey=this.generatorSecondPublicKey),this.signSignature&&(e.signSignature=this.signSignature),e}static fromObject(e){const t=super.fromObject(e);return e.generatorPublicKey&&(t.generatorPublicKey=e.generatorPublicKey),e.generatorSecondPublicKey&&(t.generatorSecondPublicKey=e.generatorSecondPublicKey),e.signature&&(t.signature=e.signature),e.signSignature&&(t.signSignature=e.signSignature),t}};It.INC=10,p([_.d(1,"uint32"),h("design:type",Number)],It.prototype,"version",void 0),p([_.d(2,"uint32"),h("design:type",Number)],It.prototype,"height",void 0),p([_.d(3,"bytes"),h("design:type",Uint8Array)],It.prototype,"signatureBuffer",void 0),p([_.d(4,"uint32"),h("design:type",Number)],It.prototype,"timestamp",void 0),p([_.d(5,"bytes"),h("design:type",Uint8Array)],It.prototype,"generatorPublicKeyBuffer",void 0),p([_.d(6,"string"),h("design:type",String)],It.prototype,"previousBlockSignature",void 0),p([_.d(7,"string"),h("design:type",String)],It.prototype,"magic",void 0),p([_.d(8,"bytes","optional"),h("design:type",Uint8Array)],It.prototype,"generatorSecondPublicKeyBuffer",void 0),p([_.d(9,"bytes","optional"),h("design:type",Uint8Array)],It.prototype,"signSignatureBuffer",void 0),p([_.d(ho.INC++,"uint32"),h("design:type",Number)],It.prototype,"blockSize",void 0),p([kr.d(ho.INC++,"string","string"),h("design:type",Object)],It.prototype,"remark",void 0),p([_.d(ho.INC++,"string","required","0"),h("design:type",String)],It.prototype,"reward",void 0),p([_.d(ho.INC++,zr),h("design:type",zr)],It.prototype,"transactionInfo",void 0),p([As,h("design:type",Function),h("design:paramtypes",[Boolean,Boolean,Object]),h("design:returntype",void 0)],It.prototype,"getBytes",null),It=ho=p([C.d("Block")],It);var af,ia=af=class extends J{get assetChangeHash(){if(this.assetChangeBuffer!==void 0)return Ne(this.assetChangeBuffer)}set assetChangeHash(e){this.assetChangeBuffer=me(e)}toJSON(){const e={};return this.assetChangeHash&&(e.assetChangeHash=this.assetChangeHash),e}getBytes(){return this.$type.encode(this).finish()}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.assetChangeHash&&(t.assetChangeHash=e.assetChangeHash),t}};ia.INC=1,p([_.d(af.INC++,"bytes","optional"),h("design:type",Uint8Array)],ia.prototype,"assetChangeBuffer",void 0),p([As,h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],ia.prototype,"getBytes",null),ia=af=p([C.d("CommonAssetModel")],ia);var Bp=class extends J{toJSON(){return{commonAsset:this.commonAsset.toJSON()}}};p([_.d(1,ia),h("design:type",ia)],Bp.prototype,"commonAsset",void 0),Bp=p([C.d("CommonBlockAssetModel")],Bp);var il,of,lo=il=class extends J{toJSON(){return{address:this.address,numberOfForgeEntities:this.numberOfForgeEntities}}};lo.INC=1,p([_.d(il.INC++,"string"),h("design:type",String)],lo.prototype,"address",void 0),p([_.d(il.INC++,"uint32"),h("design:type",Number)],lo.prototype,"numberOfForgeEntities",void 0),lo=il=p([C.d("NextRoundGeneratorModel")],lo);var uo=of=class extends J{get nextRoundGeneratorAddressList(){if(!this._next_round_generator_address_list){this._next_round_generator_address_list=[];for(const e of this.nextRoundGenerators)this._next_round_generator_address_list.push(e.address)}return this._next_round_generator_address_list}toJSON(){return{nextRoundGenerators:this.nextRoundGenerators.map(e=>e.toJSON())}}};uo.INC=1,p([_.d(of.INC++,lo,"repeated"),h("design:type",Array)],uo.prototype,"nextRoundGenerators",void 0),uo=of=p([C.d("RoundGeneratorModel")],uo);var Ze,Hp=class extends J{toJSON(){return{port:this.port}}};p([_.d(1,"uint32"),h("design:type",Number)],Hp.prototype,"port",void 0),Hp=p([C.d("PortsModel")],Hp);var We=Ze=class extends uo{get beginEpochTime(){return this.beginEpochTimeLong.toNumber()}set beginEpochTime(e){this.beginEpochTimeLong=hc.fromNumber(e,!0)}get maxTransactionBlobSize(){return this.maxTransactionBlobSizeLong.toNumber()}set maxTransactionBlobSize(e){this.maxTransactionBlobSizeLong=hc.fromNumber(e,!0)}get maxBlockBlobSize(){return this.maxBlockBlobSizeLong.toNumber()}set maxBlockBlobSize(e){this.maxBlockBlobSizeLong=hc.fromNumber(e,!0)}get assetChangeHash(){if(this.assetChangeBuffer!==void 0)return Ne(this.assetChangeBuffer)}set assetChangeHash(e){this.assetChangeBuffer=me(e)}toJSON(){const e=Object.assign({chainName:this.chainName,assetType:this.assetType,magic:this.magic,bnid:this.bnid,beginEpochTime:this.beginEpochTime,genesisLocationName:this.genesisLocationName,genesisAmount:this.genesisAmount,maxSupply:this.maxSupply,minTransactionFeePerByte:this.minTransactionFeePerByte.toJSON(),maxTransactionSize:this.maxTransactionSize,maxTransactionBlobSize:this.maxTransactionBlobSize,maxBlockSize:this.maxBlockSize,maxBlockBlobSize:this.maxBlockBlobSize,maxTPSPerBlock:this.maxTPSPerBlock,consessusBeforeSyncBlockDiff:this.consessusBeforeSyncBlockDiff,maxGrabTimesOfGiftAsset:this.maxGrabTimesOfGiftAsset,issueAssetMinChainAsset:this.issueAssetMinChainAsset,maxMultipleOfAssetAndMainAsset:this.maxMultipleOfAssetAndMainAsset.toJSON(),issueEntityFactoryMinChainAsset:this.issueEntityFactoryMinChainAsset,maxMultipleOfEntityAndMainAsset:this.maxMultipleOfEntityAndMainAsset.toJSON(),registerChainMinChainAsset:this.registerChainMinChainAsset,maxApplyAndConfirmedBlockHeightDiff:this.maxApplyAndConfirmedBlockHeightDiff,blockPerRound:this.blockPerRound,whetherToAllowGeneratorContinusElections:this.whetherToAllowGeneratorContinusElections,forgeInterval:this.forgeInterval,basicRewards:this.basicRewards,ports:this.ports.toJSON()},super.toJSON());return this.assetChangeHash&&(e.assetChangeHash=this.assetChangeHash),e}getBytes(){return this.$type.encode(this).finish()}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.beginEpochTime!==void 0&&(t.beginEpochTime=e.beginEpochTime),e.maxTransactionBlobSize!==void 0&&(t.maxTransactionBlobSize=e.maxTransactionBlobSize),e.maxBlockBlobSize!==void 0&&(t.maxBlockBlobSize=e.maxBlockBlobSize),e.assetChangeHash!==void 0&&(t.assetChangeHash=e.assetChangeHash)),t}};p([_.d(Ze.INC++,"string"),h("design:type",String)],We.prototype,"chainName",void 0),p([_.d(Ze.INC++,"string"),h("design:type",String)],We.prototype,"assetType",void 0),p([_.d(Ze.INC++,"string"),h("design:type",String)],We.prototype,"magic",void 0),p([_.d(Ze.INC++,"string"),h("design:type",String)],We.prototype,"bnid",void 0),p([_.d(Ze.INC++,"uint64"),h("design:type",Object)],We.prototype,"beginEpochTimeLong",void 0),p([_.d(Ze.INC++,"string"),h("design:type",String)],We.prototype,"genesisLocationName",void 0),p([_.d(Ze.INC++,"string"),h("design:type",String)],We.prototype,"genesisAmount",void 0),p([_.d(Ze.INC++,"string"),h("design:type",String)],We.prototype,"maxSupply",void 0),p([_.d(Ze.INC++,qn),h("design:type",qn)],We.prototype,"minTransactionFeePerByte",void 0),p([_.d(Ze.INC++,"uint32"),h("design:type",Number)],We.prototype,"maxTransactionSize",void 0),p([_.d(Ze.INC++,"uint64","required"),h("design:type",Object)],We.prototype,"maxTransactionBlobSizeLong",void 0),p([_.d(Ze.INC++,"uint32"),h("design:type",Number)],We.prototype,"maxBlockSize",void 0),p([_.d(Ze.INC++,"uint64","required"),h("design:type",Object)],We.prototype,"maxBlockBlobSizeLong",void 0),p([_.d(Ze.INC++,"uint32"),h("design:type",Number)],We.prototype,"maxTPSPerBlock",void 0),p([_.d(Ze.INC++,"uint32"),h("design:type",Number)],We.prototype,"consessusBeforeSyncBlockDiff",void 0),p([_.d(Ze.INC++,"uint32"),h("design:type",Number)],We.prototype,"maxGrabTimesOfGiftAsset",void 0),p([_.d(Ze.INC++,"string"),h("design:type",String)],We.prototype,"issueAssetMinChainAsset",void 0),p([_.d(Ze.INC++,gr),h("design:type",gr)],We.prototype,"maxMultipleOfAssetAndMainAsset",void 0),p([_.d(Ze.INC++,"string","required"),h("design:type",String)],We.prototype,"issueEntityFactoryMinChainAsset",void 0),p([_.d(Ze.INC++,gr),h("design:type",gr)],We.prototype,"maxMultipleOfEntityAndMainAsset",void 0),p([_.d(Ze.INC++,"string"),h("design:type",String)],We.prototype,"registerChainMinChainAsset",void 0),p([_.d(Ze.INC++,"uint32"),h("design:type",Number)],We.prototype,"maxApplyAndConfirmedBlockHeightDiff",void 0),p([_.d(Ze.INC++,"uint32"),h("design:type",Number)],We.prototype,"blockPerRound",void 0),p([_.d(Ze.INC++,"bool"),h("design:type",Boolean)],We.prototype,"whetherToAllowGeneratorContinusElections",void 0),p([_.d(Ze.INC++,"uint32","required"),h("design:type",Number)],We.prototype,"forgeInterval",void 0),p([_.d(Ze.INC++,"string"),h("design:type",String)],We.prototype,"basicRewards",void 0),p([_.d(Ze.INC++,Hp,"required"),h("design:type",Hp)],We.prototype,"ports",void 0),p([_.d(Ze.INC++,"bytes","optional"),h("design:type",Uint8Array)],We.prototype,"assetChangeBuffer",void 0),p([As,h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],We.prototype,"getBytes",null),We=Ze=p([C.d("GenesisAssetModel")],We);var kp=class extends J{toJSON(){return{genesisAsset:this.genesisAsset.toJSON()}}};p([_.d(1,We),h("design:type",We)],kp.prototype,"genesisAsset",void 0),kp=p([C.d("GenesisBlockAssetModel")],kp);var al,aa=al=class extends uo{get assetChangeHash(){if(this.assetChangeBuffer!==void 0)return Ne(this.assetChangeBuffer)}set assetChangeHash(e){this.assetChangeBuffer=me(e)}get chainOnChainHash(){return Ne(this.chainOnChainBuffer)}set chainOnChainHash(e){this.chainOnChainBuffer=me(e)}toJSON(){const e=Object.assign({chainOnChainHash:this.chainOnChainHash},super.toJSON());return this.assetChangeHash&&(e.assetChangeHash=this.assetChangeHash),e}getBytes(){return this.$type.encode(this).finish()}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.assetChangeHash&&(t.assetChangeHash=e.assetChangeHash),e.chainOnChainHash&&(t.chainOnChainHash=e.chainOnChainHash)),t}};p([_.d(al.INC++,"bytes","optional"),h("design:type",Uint8Array)],aa.prototype,"assetChangeBuffer",void 0),p([_.d(al.INC++,"bytes"),h("design:type",Uint8Array)],aa.prototype,"chainOnChainBuffer",void 0),p([As,h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],aa.prototype,"getBytes",null),aa=al=p([C.d("RoundLastAssetModel")],aa);var Lp=class extends J{toJSON(){return{roundLastAsset:this.roundLastAsset.toJSON()}}};p([_.d(1,aa),h("design:type",aa)],Lp.prototype,"roundLastAsset",void 0),Lp=p([C.d("RoundLastBlockAssetModel")],Lp);var go=class extends It{};p([_.d(21,Bp),h("design:type",Bp)],go.prototype,"asset",void 0),go=p([C.d("CommonBlock")],go);var oa=class extends It{};p([_.d(21,kp),h("design:type",kp)],oa.prototype,"asset",void 0),oa=p([C.d("GenesisBlock")],oa);var fo=class extends It{};p([_.d(22,Lp),h("design:type",Lp)],fo.prototype,"asset",void 0),fo=p([C.d("RoundLastBlock")],fo);var ol,{ArgumentFormatException:g_}=Z("MODEL","blockModel"),Ft;(function(e){e[e.GENESIS=0]="GENESIS",e[e.COMMON=1]="COMMON",e[e.ROUNDEND=2]="ROUNDEND"})(Ft||(Ft={}));var cl=(()=>{const e=new Map,t=new Map;return[[Ft.GENESIS,oa],[Ft.COMMON,go],[Ft.ROUNDEND,fo]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{KM:e,MK:t}})(),cf=new WeakMap,pi=ol=class extends J{get block(){let e=cf.get(this._block_bytes);if(!e){const t=cl.KM.get(this._block_type);if(!t)throw new g_(a.INVALID_BLOCK_TYPE,{type:this._block_type});e=t.decode(this._block_bytes),cf.set(this._block_bytes,e)}return e}set block(e){const t=e.constructor,r=cl.MK.get(t);if(r===void 0)throw new g_(a.INVALID_BLOCK_CONSTRUCTOR,{name:t.name});this._block_type=r,this._block_bytes=new Uint8Array(t.encode(e).finish()),cf.set(this._block_bytes,e)}static fromObject(e){const t=super.fromObject(e);if(e!==t){const r=e.block;if(r)if(r instanceof J)t.block=r;else{let n=Ft.COMMON;r.height===0?n=Ft.GENESIS:r.remark&&"hash"in r.remark&&(n=Ft.ROUNDEND);const s=cl.KM.get(n);s&&(t.block=s.fromObject(r))}}return t}toJSON(){return{block:this.block}}};pi.INC=1,p([_.d(ol.INC++,Ft),h("design:type",Number)],pi.prototype,"_block_type",void 0),p([_.d(ol.INC++,"bytes"),h("design:type",Uint8Array)],pi.prototype,"_block_bytes",void 0),pi=ol=p([C.d("SomeBlockModel")],pi);var Mp=class extends J{toJSON(){return{genesisBlock:this.genesisBlock}}};p([_.d(1,"string"),h("design:type",String)],Mp.prototype,"genesisBlock",void 0),Mp=p([C.d("RegisterChainModel")],Mp);var Dp=class extends J{toJSON(){return{registerChain:this.registerChain.toJSON()}}};p([_.d(1,Mp),h("design:type",Mp)],Dp.prototype,"registerChain",void 0),Dp=p([C.d("RegisterChainAssetModel")],Dp);var pf,yo=pf=class extends Je{};p([_.d(pf.INC++,Dp),h("design:type",Dp)],yo.prototype,"asset",void 0),yo=pf=p([C.d("RegisterChainTransaction")],yo);var hf,{ArgumentFormatException:f_,error:Wb,IllegalStateException:Zb}=Z("MODEL","transactionModel"),d_=new WeakMap,lf=new WeakMap,mo=hf=class extends J{get transactions(){const{transactionBufferList:e}=this;let t=d_.get(e);return t||(t=this.transactionBufferList.map(r=>{const n=Je.decode(r),s=ve.trsTypeToV(n.type),i=ve.VM.get(s);if(!i)throw new f_(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});const o=i.decode(r);return lf.set(o,r),o})),t}set transactions(e){const t=e.map(r=>{let n=lf.get(r);return n||(n=r.getBytes(),lf.set(r,n)),n});d_.set(t,e),this.transactionBufferList=t}toJSON(){return{transactions:this.transactions.map(e=>e.toJSON())}}static fromObject(e){const t=super.fromObject(e);if(t!==e&&e.transactions){const r=e.transactions,n=[];for(const s of r)if(s instanceof J)n.push(s);else{const i=s.type;if(i){const o=ve.trsTypeToV(i),c=ve.VM.get(o);if(!c)throw new f_(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:o});n.push(c.fromObject(s))}}t.transactions=n}return t}};mo.INC=1,p([_.d(hf.INC++,"bytes","repeated"),h("design:type",Array)],mo.prototype,"transactionBufferList",void 0),mo=hf=p([C.d("MultipleModel")],mo);var Fp=class extends J{toJSON(){return{multiple:this.multiple.toJSON()}}};p([_.d(1,mo),h("design:type",mo)],Fp.prototype,"multiple",void 0),Fp=p([C.d("MultipleAssetModel")],Fp);var uf,_o=uf=class extends Je{as(e,t){const r=ve.MV.get(e),n=ve.trsTypeToV(this.type);if(r===n)if(t){if(this.signature===t)return this}else return this;const{transactions:s}=this.asset.multiple;for(const i of s){const o=i.as(e,t);if(o)return o}}getBlobSize(e=!1){let t=0;const r=this.blobMap.values();for(const n of r)t+=n[3];if(e===!1){const{transactions:n}=this.asset.multiple;for(const s of n)t+=s.getBlobSize(e)}return t}};p([_.d(uf.INC++,Fp),h("design:type",Fp)],_o.prototype,"asset",void 0),_o=uf=p([C.d("MultipleTransaction")],_o);var gf,{ArgumentFormatException:y_,error:ew,IllegalStateException:tw}=Z("MODEL","transactionModel"),ff=new WeakMap,df=new WeakMap,Ao=gf=class extends J{get transaction(){const{transactionBuffer:e}=this;let t=ff.get(e);if(!t){const r=Je.decode(e),n=ve.trsTypeToV(r.type),s=ve.VM.get(n);if(!s)throw new y_(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:n});t=s.decode(e),df.set(t,e),ff.set(e,t)}return t}set transaction(e){let t=df.get(e);t||(t=e.getBytes(),df.set(e,t),ff.set(t,e)),this.transactionBuffer=t}toJSON(){return{transaction:this.transaction.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e&&e.transaction){const r=e.transaction;if(r instanceof J)t.transaction=r;else{const n=r.type;if(n){const s=ve.trsTypeToV(n),i=ve.VM.get(s);if(!i)throw new y_(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.transaction=i.fromObject(r)}}}return t}};Ao.INC=1,p([_.d(gf.INC++,"bytes"),h("design:type",Uint8Array)],Ao.prototype,"transactionBuffer",void 0),Ao=gf=p([C.d("PromiseModel")],Ao);var Up=class extends J{toJSON(){return{promise:this.promise.toJSON()}}};p([_.d(1,Ao),h("design:type",Ao)],Up.prototype,"promise",void 0),Up=p([C.d("PromiseAssetModel")],Up);var yf,ca=yf=class extends Ve{};p([_.d(yf.INC++,Up),h("design:type",Up)],ca.prototype,"asset",void 0),ca=yf=p([C.d("PromiseTransaction")],ca);var pl,{ArgumentFormatException:m_}=Z("MODEL","transactionModel"),pa=pl=class extends J{get promiseId(){return Ne(this.promiseIdBuffer)}set promiseId(e){this.promiseIdBuffer=me(e)}get transaction(){const{transactionBuffer:e}=this,t=Je.decode(e),r=ve.trsTypeToV(t.type),n=ve.VM.get(r);if(!n)throw new m_(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:r});return n.decode(e)}set transaction(e){this.transactionBuffer=e.getBytes()}toJSON(){return{promiseId:this.promiseId,transaction:this.transaction.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e&&(e.promiseId&&(t.promiseId=e.promiseId),e.transaction)){const r=e.transaction;if(r instanceof J)t.transaction=r;else{const n=r.type;if(n){const s=ve.trsTypeToV(n),i=ve.VM.get(s);if(!i)throw new m_(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.transaction=i.fromObject(r)}}}return t}};pa.INC=1,p([_.d(pl.INC++,"bytes"),h("design:type",Uint8Array)],pa.prototype,"promiseIdBuffer",void 0),p([_.d(pl.INC++,"bytes"),h("design:type",Uint8Array)],pa.prototype,"transactionBuffer",void 0),pa=pl=p([C.d("PromiseResolveModel")],pa);var $p=class extends J{toJSON(){return{resolve:this.resolve.toJSON()}}};p([_.d(1,pa),h("design:type",pa)],$p.prototype,"resolve",void 0),$p=p([C.d("PromiseResolveAssetModel")],$p);var mf,Io=mf=class extends Je{as(e,t){const r=ve.MV.get(e);let n=ve.trsTypeToV(this.type);if(r===n)if(t){if(this.signature===t)return this}else return this;const{transaction:s}=this.asset.resolve;return s.as(e,t)}getBlobSize(e=!1){let t=0;const r=this.blobMap.values();for(const n of r)t+=n[3];return e===!1&&(t+=this.asset.resolve.transaction.getBlobSize(e)),t}};p([_.d(mf.INC++,$p),h("design:type",$p)],Io.prototype,"asset",void 0),Io=mf=p([C.d("PromiseResolveTransaction")],Io);var Rt;(function(e){e.TEXT="text",e.ADDRESS="address",e.PUBLICKEY="publicKey",e.SIGNATURE="signature",e.NUMBER="number",e.CALC="calc"})(Rt||(Rt={}));var Eo;(function(e){e.STRING="string",e.LITERAL="literal"})(Eo||(Eo={}));var __;(function(e){e.FLOAT_32="float32",e.FLOAT_64="float64",e.FLOAT_128="float128",e.FLOAT_big="bigfloat"})(__||(__={}));var ha,kn=ha=class extends J{toJSON(){const e={type:this.type,name:this.name,keyPath:this.keyPath};return this.pattern&&(e.pattern=this.pattern),this.repeat!==void 0&&(e.repeat=this.repeat),e}};kn.INC=1,p([_.d(ha.INC++,"string"),h("design:type",String)],kn.prototype,"type",void 0),p([_.d(ha.INC++,"string"),h("design:type",String)],kn.prototype,"name",void 0),p([_.d(ha.INC++,"string"),h("design:type",String)],kn.prototype,"keyPath",void 0),p([_.d(ha.INC++,"string","optional"),h("design:type",String)],kn.prototype,"pattern",void 0),p([_.d(ha.INC++,"bool","optional"),h("design:type",Boolean)],kn.prototype,"repeat",void 0),kn=ha=p([C.d("BaseInputModel")],kn);var la,Rs=la=class extends kn{toJSON(){const e={...super.toJSON(),format:this.format};return this.base&&(e.base=this.base.toJSON()),this.min&&(e.min=this.min.toJSON()),this.max&&(e.max=this.max.toJSON()),this.step&&(e.step=this.step.toJSON()),e}};p([_.d(la.INC++,gr,"optional"),h("design:type",gr)],Rs.prototype,"base",void 0),p([_.d(la.INC++,gr,"optional"),h("design:type",gr)],Rs.prototype,"min",void 0),p([_.d(la.INC++,gr,"optional"),h("design:type",gr)],Rs.prototype,"max",void 0),p([_.d(la.INC++,gr,"optional"),h("design:type",gr)],Rs.prototype,"step",void 0),p([_.d(la.INC++,"string","required",Eo.LITERAL),h("design:type",String)],Rs.prototype,"format",void 0),Rs=la=p([C.d("NumberInputModel")],Rs);var Ut=class fI{constructor(t,r){if(Object.defineProperty(this,"numerator",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"denominator",{enumerable:!0,configurable:!0,writable:!0,value:r}),r<0n)throw new RangeError("invalid denominator: should not be negative number.")}static from(t,r=1){t=t.toString().trim();let n=BigInt(r);const s=t.lastIndexOf(".");s!==-1&&(n=10n**BigInt(t.length-s-1),t=t.slice(0,s)+t.slice(s+1));let i=BigInt(t);return n<0n&&(n=-n,i=-i),new fI(i,n)}isFinite(){return this.denominator!==0n}isInfinity(){return this.denominator===0n&&this.numerator!==0n}isNaN(){return this.denominator===0n&&this.numerator===0n}isNeg(){return this.numerator<0n}toString(){return this.toPrecision(8)}toPrecision(t,r=Vp.ROUND){if(this.isNaN())return"NaN";if(this.isInfinity())return this.isNeg()?"-Infinity":"Infinity";let{denominator:n,numerator:s}=this;if(n===1n)return s.toString();const i=Math.floor(t),o=i+1;if(o<1)throw new Error("invalid digits");const c=10n**BigInt(o);let l=s*c/n,u="";l<0&&(u="-",l=-l);const g=l/10n;let y;switch(r){case Vp.FLOOR:y=g.toString();break;case Vp.CEIL:{l%10n!==0n?y=(g+1n).toString():y=g.toString();break}default:l%10n>=5n?y=(g+1n).toString():y=g.toString()}y=y.padStart(o,"0");let m=y.slice(0,-i)+"."+y.slice(-i);return m.endsWith("0")&&(m=m.replace(/[\.0]+$/,"")),u+m}},Vp;(function(e){e[e.FLOOR=0]="FLOOR",e[e.ROUND=1]="ROUND",e[e.CEIL=2]="CEIL"})(Vp||(Vp={}));var _f=(e,t,r)=>{if(e.denominator===t.denominator)return new Ut(r(e.numerator,t.numerator,e.denominator),e.denominator);const n=e.numerator*t.denominator,s=t.numerator*e.denominator,i=e.denominator*t.denominator;return new Ut(r(n,s,i),e.denominator*t.denominator)},cT=(e,t)=>_f(e,t,(r,n)=>r+n),pT=(e,t)=>_f(e,t,(r,n)=>r-n),A_=(e,t)=>_f(e,t,(r,n)=>r*n),hT=(e,t)=>A_(e,new Ut(t.denominator,t.numerator));new Ut(0n,0n),new Ut(1n,1n),new Ut(0n,1n),Ut.from(Math.PI),Ut.from(Math.E),Ut.from(Math.LN2),Ut.from(Math.LN10),Ut.from(Math.LOG2E),Ut.from(Math.LOG10E),Ut.from(Math.SQRT1_2);var Dr=class{constructor(e,t={}){Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isBinary",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isPrefix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"precedence",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateContext",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=e,this.isBinary=!!t.isBinary,this.isPrefix=!!t.isPrefix,this.precedence=t.precedence??-1}},Et={start:new Dr("start"),end:new Dr("end"),parenL:new Dr("("),parenR:new Dr(")"),numeric:new Dr("numeric"),identifier:new Dr("identifier"),plus:new Dr("+",{isBinary:!0,precedence:13}),minus:new Dr("-",{isBinary:!0,precedence:13}),times:new Dr("*",{isBinary:!0,precedence:14}),div:new Dr("/",{isBinary:!0,precedence:14}),prefixPlus:new Dr("+",{isPrefix:!0,precedence:16}),prefixMinus:new Dr("-",{isPrefix:!0,precedence:16})};Et.parenL.updateContext=function(){this.allowPrefix=!0},Et.parenR.updateContext=function(){this.allowPrefix=!1},Et.numeric.updateContext=function(){this.allowPrefix=!1},Et.identifier.updateContext=function(){this.allowPrefix=!1};var Af=class{constructor(e){Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type="",this.start=e,this.end=e}};function If(e){return e>=48&&e<=57}function I_(e){return e===46?!0:If(e)}function E_(e){return e>=65&&e<=90||e>=97&&e<=122}function lT(e){return!!(E_(e)||If(e)||e===95)}function uT(e){let t=e;const r=[];for(let n=0;n<t.length;n++)t.charCodeAt(n)!==95&&r.push(t[n]);return r.length!==t.length&&(t=r.join("")),t}var T_=["+","-","*","/","(",")"],Ps=[];function gT(e){Ps.includes(e)||Ps.unshift(e)}function S_(e,t){if(typeof e!="string"||!/^\S+$/.test(e))throw new Error("The custom operator should be a non-empty string");if(T_.includes(e))throw new Error(`The custom operator cannot use reserved character, including: ${T_.join(", ")}`);if(I_(e.charCodeAt(0)))throw new Error("The custom operator cannot start with a possible number, including: `.`, 0-9");if(e.charCodeAt(0)===63)throw new Error("The custom operator cannot start with `?`");if(t!=null&&(typeof t!="number"||t<0))throw new Error("The precedence should be a number greater than 0")}var b_=class{constructor(e,t,r,n=!1){Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"codes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"calc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e,this.codes=e.split("").map((s,i)=>e.charCodeAt(i)),this.type=new Dr(e,{isBinary:!n,isPrefix:n,precedence:t}),this.calc=r}};function fT(e,t,r){if(S_(e,t),typeof r!="function")throw new Error("Expected to receive a calculation method, like: `(left, right) => String(left - right)`");return new b_(e,t,r,!1)}function dT(e,t,r){if(S_(e,t),typeof r!="function")throw new Error("Expected to receive a calculation method, like: `(value) => String(Math.abs(value))`");return new b_(e,t,r,!0)}var w_={"+":(e,t)=>String(Number(e)+Number(t)),"-":(e,t)=>String(Number(e)-Number(t)),"*":(e,t)=>String(Number(e)*Number(t)),"/":(e,t)=>String(Number(e)/Number(t))};function yT(e){const t=["+","-","*","/"];e=e||{},t.forEach(r=>{if(typeof e[r]!="function")throw new Error(`Missing method for calculation operator \`${r}\``)}),w_=e}function mT(e,t,r){switch(r){case"+":case"-":case"*":case"/":return w_[r](e,t);default:for(let n=0;n<Ps.length;n++){const s=Ps[n];if(s.type.isBinary&&s.value===r)return s.calc(e,t)}}throw new Error(`Unexpected binary operator: ${r}`)}function _T(e,t){switch(t){case"+":return e;case"-":return String(-e);default:for(let r=0;r<Ps.length;r++){const n=Ps[r];if(n.type.isPrefix&&n.value===t)return n.calc(e)}}throw new Error(`Unexpected unary operator: ${t}`)}function Gp(e,t={}){if(e instanceof Af){let r;switch(e.type){case"Expression":return Gp(e.expression,t);case"BinaryExpression":return mT(Gp(e.left,t),Gp(e.right,t),e.operator);case"UnaryExpression":return _T(Gp(e.argument,t),e.operator);case"NumericLiteral":return e.value;case"Identifier":if(r=t[e.name],r===void 0)throw new Error(`The scope name \`${e.name}\` is not initialized`);return String(r);default:throw new Error(`Unexpected type: ${e.type}`)}}return e}var os=class dI{static evaluate(t,r){return new dI(t).compile()(r)}constructor(t){Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastTokenStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastTokenEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowPrefix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.input=String(t),this.tokenType=Et.start,this.value="",this.pos=0,this.start=0,this.end=0,this.lastTokenStart=0,this.lastTokenEnd=0,this.allowPrefix=!0}compile(){let t=this.node;return t===void 0&&(t=this.parse()),r=>t?Gp(t,r??{}):"0"}parse(){this.next();const t=this.startNode(this.start);return this.tokenType===Et.end?this.node=null:(t.expression=this.parseExprAtom(this.start,-1),this.tokenType!==Et.end&&this.unexpected(this.value),this.node=this.finishNode(t,"Expression"))}parseExprAtom(t,r){if(this.tokenType===Et.parenL){this.next();const n=this.parseExprAtom(this.start,-1);return this.expect(Et.parenR),this.parseMaybeBinary(n,t,r)}else{const n=this.parseMaybeUnary(r);return this.parseMaybeBinary(n,t,r)}}parseMaybeBinary(t,r,n){const s=this.tokenType.precedence;if(this.tokenType.isBinary&&s>n){const i=this.startNode(r),o=this.value;this.next();const c=this.start,l=this.parseExprAtom(c,s),u=this.parseMaybeBinary(l,c,s);return i.left=t,i.operator=o,i.right=u,this.finishNode(i,"BinaryExpression"),this.parseMaybeBinary(i,r,n)}return t}parseMaybeUnary(t){const r=this.tokenType.precedence,n=this.startNode(),s=this.start,i=this.value;if(this.tokenType.isPrefix&&r>=t)return n.operator=i,n.prefix=!0,this.next(),n.argument=this.parseExprAtom(this.start,r),this.finishNode(n,"UnaryExpression");if(this.tokenType===Et.numeric){const o=uT(i);return n.rawValue=i,n.value=o,this.next(),this.finishNode(n,"NumericLiteral")}return this.tokenType===Et.identifier?(n.name=i,this.next(),this.finishNode(n,"Identifier")):this.unexpected(i,s)}next(){if(this.lastTokenStart=this.start,this.lastTokenEnd=this.end,this.skipSpace(),this.start=this.pos,this.pos>=this.input.length){if(this.tokenType===Et.end)return;this.finishToken(Et.end)}else this.readToken()}readToken(){const t=this.codeAt(this.pos);return I_(t)?this.readNumeric():this.readTokenFromCode()}readNumeric(){const t=this.pos;let r=-1,n=!0,s=!1,i=!1,o=-1;for(;this.isValidPosition();){const l=this.codeAt(this.pos);if(If(l))r===-1&&(r=0),this.pos++,i=!1,s=!0;else if(i){o=this.pos,i=!1;break}else if(l===69||l===101){if(r!==0){o=this.pos;break}r++,this.pos++,this.isValidPosition()&&(this.codeAt(this.pos)===43||this.codeAt(this.pos)===45)&&this.pos++,n=!1,i=!0}else if(l===46){if(!n){o=this.pos;break}n=!1,this.pos++,this.pos-t===1&&(i=!0)}else if(l===95){if(!s){o=this.pos;break}s=!1,i=!0,this.pos++}else break}i&&(o=this.pos-1),o>=0&&this.unexpected(this.input[o],o);const c=this.input.slice(t,this.pos);this.finishToken(Et.numeric,c)}readTokenFromCode(){const t=this.codeAt(this.pos);let r,n,s;for(n=0;n<Ps.length;n++){const i=Ps[n];for(s=0;s<i.codes.length&&i.codes[s]===this.codeAt(this.pos+s);s++);if(s===i.codes.length){r=i;break}}if(r)return this.pos+=r.codes.length,this.finishToken(r.type,r.value);switch(t){case 40:return this.pos++,this.finishToken(Et.parenL,"(");case 41:return this.pos++,this.finishToken(Et.parenR,")");case 42:return this.pos++,this.finishToken(Et.times,"*");case 43:return this.pos++,this.allowPrefix?this.finishToken(Et.prefixPlus,"+"):this.finishToken(Et.plus,"+");case 45:return this.pos++,this.allowPrefix?this.finishToken(Et.prefixMinus,"-"):this.finishToken(Et.minus,"-");case 47:return this.pos++,this.finishToken(Et.div,"/");default:if(E_(t))return this.readIdentifier()}this.unexpected(this.input[this.pos])}readIdentifier(){const t=this.pos;for(;this.isValidPosition();){const n=this.codeAt(this.pos);if(lT(n))this.pos++;else break}const r=this.input.slice(t,this.pos);this.finishToken(Et.identifier,r)}finishToken(t,r=""){const n=this.tokenType;this.end=this.pos,this.tokenType=t,this.value=r,this.updateContext(n)}updateContext(t){const r=this.tokenType;r.isBinary||r.isPrefix?this.allowPrefix=!0:r.updateContext&&r.updateContext.call(this,t)}codeAt(t){return this.input.charCodeAt(t)}isValidPosition(){return this.pos<this.input.length}startNode(t){return new Af(t??this.start)}finishNode(t,r){return t.type=r,t.end=this.lastTokenEnd,t}skipSpace(){for(;this.isValidPosition();){const t=this.codeAt(this.pos);if(t===32||t===160)this.pos++;else if(t===13||t===10||t===8232||t===8233)t===13&&this.codeAt(this.pos+1)===10&&this.pos++,this.pos++;else if(t>8&&t<14)this.pos++;else break}}expect(t){this.eat(t)||this.unexpected(this.value)}eat(t){return this.tokenType===t?(this.next(),!0):!1}unexpected(t="",r){this.raise(r??this.start,`Unexpected token ${t}`)}raise(t,r){throw t>this.input.length-1?r="Unexpected end of input":r+=` at position ${t}`,new SyntaxError(r)}};Object.defineProperty(os,"Node",{enumerable:!0,configurable:!0,writable:!0,value:Af}),Object.defineProperty(os,"TokenType",{enumerable:!0,configurable:!0,writable:!0,value:Dr}),Object.defineProperty(os,"tokenTypes",{enumerable:!0,configurable:!0,writable:!0,value:Et}),Object.defineProperty(os,"installedOperators",{enumerable:!0,configurable:!0,writable:!0,value:Ps});var N_=os.evaluate;os.createBinaryOperator=fT,os.createUnaryOperator=dT,os.useOperator=gT,os.useAdapter=yT;var AT={"+":(e,t)=>cT(Ut.from(e),Ut.from(t)).toString(),"-":(e,t)=>pT(Ut.from(e),Ut.from(t)).toString(),"*":(e,t)=>A_(Ut.from(e),Ut.from(t)).toString(),"/":(e,t)=>hT(Ut.from(e),Ut.from(t)).toString()};os.useAdapter(AT);var hl,Kp=hl=class extends Rs{toJSON(){return{...super.toJSON(),calc:this.calc,precision:this.precision}}evaluate(e){return N_(this.calc,e)}};p([_.d(hl.INC++,"string"),h("design:type",String)],Kp.prototype,"calc",void 0),p([_.d(hl.INC++,"string"),h("design:type",String)],Kp.prototype,"precision",void 0),Kp=hl=p([C.d("CalcInputModel")],Kp);var To=class extends kn{};To=p([C.d("TextInputModel")],To);var Ef=class extends To{};Ef=p([C.d("AddressInputModel")],Ef);var Tf=class extends To{};Tf=p([C.d("SignatureInputModel")],Tf);var Sf=class extends To{};Sf=p([C.d("PublicKeyInputModel")],Sf);var O_=(()=>{const e=new Map,t=new Map;return[[Rt.NUMBER,Rs],[Rt.CALC,Kp],[Rt.TEXT,To],[Rt.ADDRESS,Ef],[Rt.PUBLICKEY,Sf],[Rt.SIGNATURE,Tf]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{VM:e,MV:t}})(),ll,{ArgumentFormatException:ul}=Z("MODEL","transactionModel"),ua=ll=class extends J{get inputs(){return this.inputBufferList.map(e=>{const t=kn.decode(e),r=O_.VM.get(t.type);if(!r)throw new ul(a.INVALID_MACRO_INPUT_TYPE,{type_base:t.type});return r.decode(e)})}set inputs(e){const t=e.map(r=>r.getBytes());this.inputBufferList=t}get template(){const{templateBuffer:e}=this,t=Je.decode(e),r=ve.trsTypeToV(t.type),n=ve.VM.get(r);if(!n)throw new ul(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:r});return n.decode(e)}set template(e){this.templateBuffer=e.getBytes()}toJSON(){return{inputs:this.inputs.map(e=>e.toJSON()),template:this.template.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e){if(e.inputs){const r=e.inputs,n=[];for(const s of r)if(s instanceof J)n.push(s);else{const i=s.type,o=O_.VM.get(i);if(!o)throw new ul(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:i});n.push(o.fromObject(s))}t.inputs=n}if(e.template){const r=e.template;if(r instanceof J)t.template=r;else{const n=r.type;if(n){const s=ve.trsTypeToV(n),i=ve.VM.get(s);if(!i)throw new ul(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.template=i.fromObject(r)}}}}return t}};ua.INC=1,p([_.d(ll.INC++,"bytes","repeated"),h("design:type",Array)],ua.prototype,"inputBufferList",void 0),p([_.d(ll.INC++,"bytes"),h("design:type",Uint8Array)],ua.prototype,"templateBuffer",void 0),ua=ll=p([C.d("MacroModel")],ua);var jp=class extends J{toJSON(){return{macro:this.macro.toJSON()}}};p([_.d(1,ua),h("design:type",ua)],jp.prototype,"macro",void 0),jp=p([C.d("MacroAssetModel")],jp);var bf,ga=bf=class extends Ve{};p([_.d(bf.INC++,jp),h("design:type",jp)],ga.prototype,"asset",void 0),ga=bf=p([C.d("MacroTransaction")],ga);var IT=e=>typeof e=="object"&&e!==null&&typeof e.then=="function",Kt=class{constructor(){this.is_resolved=!1,this.is_rejected=!1,this.is_finished=!1,this.promise=new Promise((e,t)=>{this.resolve=r=>{try{IT(r)?r.then(this.resolve,this.reject):(this.is_resolved=!0,this.is_finished=!0,e(this.value=r),this._runThen(),this._innerFinallyArg=Object.freeze({status:"resolved",result:this.value}),this._runFinally())}catch(n){this.reject(n)}},this.reject=r=>{this.is_rejected=!0,this.is_finished=!0,t(this.reason=r),this._runCatch(),this._innerFinallyArg=Object.freeze({status:"rejected",reason:this.reason}),this._runFinally()}})}onSuccess(e){this.is_resolved?this.__callInnerThen(e):(this._innerThen||(this._innerThen=[])).push(e)}onError(e){this.is_rejected?this.__callInnerCatch(e):(this._innerCatch||(this._innerCatch=[])).push(e)}onFinished(e){this.is_finished?this.__callInnerFinally(e):(this._innerFinally||(this._innerFinally=[])).push(e)}_runFinally(){if(this._innerFinally){for(const e of this._innerFinally)this.__callInnerFinally(e);this._innerFinally=void 0}}__callInnerFinally(e){queueMicrotask(async()=>{try{await e(this._innerFinallyArg)}catch(t){console.error("Unhandled promise rejection when running onFinished",e,t)}})}_runThen(){if(this._innerThen){for(const e of this._innerThen)this.__callInnerThen(e);this._innerThen=void 0}}_runCatch(){if(this._innerCatch){for(const e of this._innerCatch)this.__callInnerCatch(e);this._innerCatch=void 0}}__callInnerThen(e){queueMicrotask(async()=>{try{await e(this.value)}catch(t){console.error("Unhandled promise rejection when running onSuccess",e,t)}})}__callInnerCatch(e){queueMicrotask(async()=>{try{await e(this.value)}catch(t){console.error("Unhandled promise rejection when running onError",e,t)}})}},ET=(e,t)=>["%c"+e,t],hi=Symbol("eventemitter.description"),Pt={head:ET,MIDNIGHTBLUE_BOLD_UNDERLINE:"color:midnightblue;text-decoration: underline;font-weight: bold;",DARKVIOLET_BOLD_UNDERLINE:"color:darkviolet;text-decoration: underline;font-weight: bold;"};function v_(e,t){const r=Object.getOwnPropertyDescriptor(e,"name");r&&r.configurable&&Object.defineProperty(e,"name",{value:t,configurable:!0})}var C_=Cs.getGlobalFlag("BFCHAIN_ENV","development");C_.split(",").map(e=>e.trim());var wf=new Map;for(const e of C_.split(",")){const[t,r]=e.split("=").map(i=>i.trim());let n=t,s=!1;n.startsWith("- ")&&(s=!0,n=n.substr(2)),s?wf.delete(n):wf.set(n,r)}function zp(e){return wf.has(e)}var Jr=zp("eventemitter")&&zp("browser"),mn=class{constructor(){this._e=Object.create(null)}on(e,t,r={}){this._on(e,t,r.taskname,r.once)}_on(e,t,r,n){const s=this._e;let i=s[e];i?i.has(t)&&console.warn(`hanlder '${t.name}' already exits in event set ${e}.`):i=s[e]=new Map,r===void 0&&(r=Cp(this.constructor)),i.set(t,{taskname:r,once:n})}once(e,t,r={}){this._on(e,t,r.taskname,!0)}off(e,t){return this._off(e,t)}_off(e,t){const r=this._e[e];let n=!0;return r?t?r.delete(t)&&r.size===0&&delete this._e[e]:(r.clear(),delete this._e[e]):n=!1,n}get[hi](){return""}emit(e,...t){this._emit(e,t)}_emit(e,t){const r=this._e[e];if(Jr&&(console.group(...Pt.head("%s EMIT [%s]",Pt.MIDNIGHTBLUE_BOLD_UNDERLINE),this[hi]||this,e),console.log(...Pt.head("%s ARGS:",Pt.MIDNIGHTBLUE_BOLD_UNDERLINE),...t)),r)for(const[n,s]of r.entries())try{if(Jr){const{taskname:o=n.name}=s;console.log(...Pt.head("%s RUN [%s]",Pt.MIDNIGHTBLUE_BOLD_UNDERLINE),this[hi]||this,o)}const i=n(...t);i instanceof Promise&&i.catch(o=>this._emitErrorHanlder(o,e,t))}catch(i){this._emitErrorHanlder(i,e,t)}finally{s.once&&r.delete(n)}Jr&&console.groupEnd()}_emitErrorHanlder(e,t,r){if(!this._hasEmitErrorHandlerSet)throw Jr&&console.error(`EventEmitter '${this.constructor.name}' emit '${t.toString()}' fail:`,e),e;for(const n of this._emitErrorHandlerSet)n(e,{eventname:t,args:r})}get _emitErrorHandlerSet(){return this._hasEmitErrorHandlerSet=!0,new Set}onError(e,t){typeof t=="string"&&v_(e,t),this._emitErrorHandlerSet.has(e)&&console.warn(`hanlder '${e.name}' already exits in custom error hanlder event set.`),this._emitErrorHandlerSet.add(e)}offError(e){return!!this._hasEmitErrorHandlerSet&&(e?this._emitErrorHandlerSet.delete(e):(this._emitErrorHandlerSet.clear(),!0))}clear(e={}){this._e=Object.create(null);const{ignoreCustomErrorHanlder:t}=e;!t&&this._hasEmitErrorHandlerSet&&this._emitErrorHandlerSet.clear()}get removeAllListeners(){return this.clear}get addListener(){return this.on}get removeListener(){return this.off}};p([ie,h("design:type",Object),h("design:paramtypes",[])],mn.prototype,"_emitErrorHandlerSet",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],mn.prototype,"removeAllListeners",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],mn.prototype,"addListener",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],mn.prototype,"removeListener",null);var R_=e=>!(!e||!e.constructor)&&typeof e.next=="function"&&typeof e.return=="function"&&typeof e.throw=="function"&&typeof e[Symbol.asyncIterator]=="function"&&e[Symbol.asyncIterator]()===e,P_=e=>!!e&&typeof e.next=="function"&&typeof e.return=="function"&&typeof e.throw=="function"&&typeof e[Symbol.iterator]=="function"&&e[Symbol.iterator]()===e,li=class{constructor(){this._e=Object.create(null)}on(e,t,r={}){let n=this._e[e];n?n.has(t)&&console.warn(`[${r.taskname||e.toString()}]`):n=this._e[e]=new Map,r.taskname===void 0&&(r.taskname=Cp(this.on)),n.set(t,r)}once(e,t,r){return this.on(e,t,r?new Proxy(r,{get:(n,s,i)=>s==="once"||Reflect.get(n,s,i)}):{once:!0})}has(e,t){const r=this._e[e];return!!r&&(t?r.has(t):r.size>0)}off(e,t){const r=this._e[e];let n=!1;return r&&(n=r.delete(t))&&r.size===0&&delete this._e[e],n}get[hi](){return""}emit(e,t){const r=this._e[e];if(r){Jr&&r.size&&console.log(...Pt.head("%s QUENE EMIT [%s]",Pt.DARKVIOLET_BOLD_UNDERLINE),this[hi]||this,e,t);const n=r.entries(),s=o=>{if(typeof o=="object"){if(R_(o))return(async()=>{try{const c=o[Symbol.asyncIterator]();for(;;){const l=await c.next();if(l.done)return l.value}}catch(c){this._emitErrorHanlder(c,e,t)}})();if(P_(o)){const c=o[Symbol.iterator]();try{for(;;){const l=c.next();if(l.done)return l.value}}catch(l){this._emitErrorHanlder(l,e,t)}}}return o},i=()=>{const o=n.next();if(!o.done){const[c,l]=o.value;try{Jr&&console.log(...Pt.head("RUN [%s]",Pt.DARKVIOLET_BOLD_UNDERLINE),c.name);const u=c(t,i);return u instanceof Promise?u.then(s,g=>this._emitErrorHanlder(g,e,t)):s(u)}catch(u){this._emitErrorHanlder(u,e,t)}finally{l.once&&r.delete(c)}}};return i()}}async*emitToAsyncGenerator(e,t){const r=this._e[e];if(r){Jr&&r.size&&console.log(...Pt.head("%s QUENE EMIT [%s]",Pt.DARKVIOLET_BOLD_UNDERLINE),this[hi]||this,e,t);const n=r.entries(),s=(async function*(){const i=n.next();if(!i.done){const[o,c]=i.value;try{Jr&&console.log(...Pt.head("RUN [%s]",Pt.DARKVIOLET_BOLD_UNDERLINE),o.name),yield;const l=await o(t,s);if(typeof l=="object"){if(R_(l))return yield*l;if(P_(l))return yield*l}return l}catch(l){this._emitErrorHanlder(l,e,t)}finally{c.once&&r.delete(o)}}}).bind(this);return yield*s()}}clear(e={}){this._e=Object.create(null);const{ignoreCustomErrorHanlder:t}=e;!t&&this._hasEmitErrorHandlerSet&&this._emitErrorHandlerSet.clear()}get removeAllListeners(){return this.clear}get addListener(){return this.on}get removeListener(){return this.off}_emitErrorHanlder(e,t,r){if(!this._hasEmitErrorHandlerSet)throw Jr&&console.error(`QueneEventEmitter '${this.constructor.name}' emit '${t.toString()}' fail:`,e),e;for(const n of this._emitErrorHandlerSet)n(e,{eventname:t,arg:r})}get _emitErrorHandlerSet(){return this._hasEmitErrorHandlerSet=!0,new Set}onError(e,t){typeof t=="string"&&v_(e,t),this._emitErrorHandlerSet.has(e)&&console.warn(`hanlder '${e.name}' already exits in custom error hanlder event set.`),this._emitErrorHandlerSet.add(e)}offError(e){return!!this._hasEmitErrorHandlerSet&&(e?this._emitErrorHandlerSet.delete(e):(this._emitErrorHandlerSet.clear(),!0))}};p([ie,h("design:type",Object),h("design:paramtypes",[])],li.prototype,"removeAllListeners",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],li.prototype,"addListener",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],li.prototype,"removeListener",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],li.prototype,"_emitErrorHandlerSet",null);var gl=class extends mn{_emit(e,t){if(this._hasBeforeTaskMap){const r=this._beforeTasks[e];r&&(delete this._beforeTasks[e],r.resolve(t))}if(this._hasCommonEmitHandlerMap){Jr&&this._commonEmitHandlerMap.size&&console.log(...Pt.head("%s EMIT WILDCARDS * [%s]",Pt.MIDNIGHTBLUE_BOLD_UNDERLINE),this[hi]||this,{eventname:e,args:t});for(const[r,n]of this._commonEmitHandlerMap)try{if(Jr){const{taskname:i=r.name}=n;console.log(...Pt.head("RUN [%s]",Pt.MIDNIGHTBLUE_BOLD_UNDERLINE),i)}const s=r({eventname:e,args:t});s instanceof Promise&&s.catch(i=>this._emitErrorHanlder(i,e,t))}catch(s){this._emitErrorHanlder(s,e,t)}finally{n.once&&this._commonEmitHandlerMap.delete(r)}}if(super._emit(e,t),this._hasAfterTaskMap){const r=this._afterTasks[e];r&&(delete this._afterTasks[e],r.resolve(t))}}clear(e={}){super.clear(e);const{ignoreCommonErrorHanlder:t,ignoreBeforeTask:r,ignoreAfterTask:n}=e;if(!t&&this._hasCommonEmitHandlerMap&&this._commonEmitHandlerMap.clear(),!r&&this._hasBeforeTaskMap){const s=new Error("Remove all listeners");for(const i in this._beforeTasks)this._beforeTasks[i].reject(s)}if(!n&&this._hasAfterTaskMap){const s=new Error("Remove all listeners");for(const i in this._afterTasks)this._afterTasks[i].reject(s)}}get _commonEmitHandlerMap(){return this._hasCommonEmitHandlerMap=!0,new Map}onEmit(e,t={}){this._commonEmitHandlerMap.has(e)&&console.warn(`hanlder '${e.name}' already exits in common hanlder event set.`),t.taskname===void 0&&(t.taskname=Cp(this.onEmit)),this._commonEmitHandlerMap.set(e,t)}offEmit(e){return!!this._hasCommonEmitHandlerMap&&(e?this._commonEmitHandlerMap.delete(e):(this._commonEmitHandlerMap.clear(),!0))}get _afterTasks(){return this._hasAfterTaskMap=!0,Object.create(null)}after(e){let t=this._afterTasks[e];return t||(t=this._afterTasks[e]=new Kt),t.promise}abortAfter(e,t){const r=this._afterTasks[e];return r&&r.reject(t),r}get _beforeTasks(){return this._hasBeforeTaskMap=!0,Object.create(null)}before(e){let t=this._beforeTasks[e];return t||(t=this._beforeTasks[e]=new Kt),t.promise}abortBefore(e,t){const r=this._beforeTasks[e];return r&&r.reject(t),r}};p([ie,h("design:type",Object),h("design:paramtypes",[])],gl.prototype,"_commonEmitHandlerMap",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],gl.prototype,"_afterTasks",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],gl.prototype,"_beforeTasks",null);var x_=class extends li{emit(e,t){if(this._hasCommonEmitHandlerMap){if(Jr&&this._commonEmitHandlerMap.size){const r=this[hi]||this;console.log(...Pt.head("%s QUENE EMIT WILDCARDS * [%s]",Pt.DARKVIOLET_BOLD_UNDERLINE),r,e,t)}for(const[r,n]of this._commonEmitHandlerMap)try{if(Jr){const{taskname:i=r.name}=n;console.log(...Pt.head("RUN [%s]",Pt.DARKVIOLET_BOLD_UNDERLINE),i)}const s=r({eventname:e,args:t});s instanceof Promise&&s.catch(i=>this._emitErrorHanlder(i,e,t))}catch(s){this._emitErrorHanlder(s,e,t)}finally{n.once&&this._commonEmitHandlerMap.delete(r)}}return super.emit(e,t)}get _commonEmitHandlerMap(){return this._hasCommonEmitHandlerMap=!0,new Map}onEmit(e,t={}){this._commonEmitHandlerMap.has(e)&&console.warn(`hanlder '${e.name}' already exits in common hanlder event set.`),t.taskname===void 0&&(t.taskname=Cp(this.onEmit)),this._commonEmitHandlerMap.set(e,t)}offEmit(e){return!!this._hasCommonEmitHandlerMap&&(e?this._commonEmitHandlerMap.delete(e):(this._commonEmitHandlerMap.clear(),!0))}clear(e={}){super.clear(e);const{ignoreCommonErrorHanlder:t}=e;!t&&this._hasCommonEmitHandlerMap&&this._commonEmitHandlerMap.clear()}};p([ie,h("design:type",Object),h("design:paramtypes",[])],x_.prototype,"_commonEmitHandlerMap",null);var fr=class extends li{constructor(){super(...arguments),this.list=[],this.min_next_index=0,this.calcs=[],this._is_rejected=!1,this._is_resolved=!1,this._requestProcess=0}canPush(e){return!(e<this.min_next_index||e in this.list||this.is_done)}push(e,t=this.min_next_index){if(t<this.min_next_index)throw new RangeError(`push into wrong index:${t}, should be ${this.min_next_index}`);if(t in this.list||t in this.calcs)throw new TypeError(`index:${t} already have value`);for(this.list[t]=e;this.list[this.min_next_index];)this.min_next_index+=1;return this.emit("push",{item:e,index:t})}pushCalc(e,t=this.min_next_index){if(t<this.min_next_index)throw new RangeError(`push into wrong index:${t}, should be ${this.min_next_index}`);if(t in this.list||t in this.calcs)throw new TypeError(`index:${t} already have value`);const r=()=>{delete this.calcs[t];const n=this.list[t]=e();return this.emit("push",{item:n,index:t}),n};for(this.calcs[t]=r;this.list[this.min_next_index];)this.min_next_index+=1;return this.emit("pushCalc",{calc:r,index:t})}get is_done(){return this._is_rejected||this._is_resolved}_initTask(){let e=this._task;return e||(e=this._task=new Kt,this._is_rejected?e.reject(this._reason):this._is_resolved?e.resolve(this.list):(this._requestProcess=1/0,this.emit("requestAll",void 0))),e.promise}async done(){var e;if(!this.is_done){for(this._is_resolved=!0,(e=this._task)==null?void 0:e.resolve(this.list);;){const t=new Set(Object.keys(this.calcs));if(t.size===0)break;await new Promise((r,n)=>{const s=()=>{this.off("push",i),this.off("error",o)},i=c=>{t.delete(c.index.toString())&&t.size===0&&(r(),s())},o=()=>{n(),s()};this.on("push",i),this.once("error",o)})}return Object.freeze(this.list),this.emit("done",void 0)}}throw(e){var t;if(!this.is_done)return this._is_rejected=!0,(t=this._task)==null||t.reject(e),Object.freeze(this.list),this.emit("error",this._reason=e)}resolve(){return this.done()}reject(e){return this.throw(e)}then(...e){return this._initTask().then(...e)}catch(...e){return this._initTask().catch(...e)}get requestProcess(){return this._requestProcess}[Symbol.asyncIterator](){const e=this,{list:t,calcs:r}=e;return{index:0,return:()=>(zu(e.done()),Promise.resolve({done:!0,value:void 0})),async next(){const n=this.index;r[n]&&zu(r[n]());const s=t[n];let i={done:e.is_done,value:s};return n in t?i.done=!1:e.is_done||(i=await new Promise(async(o,c)=>{const l=()=>{e.off("error",u),e.off("push",y),e.off("pushCalc",m),e.off("done",g)},u=(d,I)=>(l(),c(d),I()),g=(d,I)=>(l(),o({done:!0,value:s}),I()),y=({item:d,index:I},T)=>(n===I&&(l(),o({done:!1,value:d})),T()),m=({calc:d,index:I},T)=>(n===I&&(l(),o({done:!1,value:d()})),T());e.on("error",u),e.on("done",g),e.on("push",y),e.on("pushCalc",m);try{await e.emit("requestItem",e._requestProcess=n)}catch(d){e.emit("error",d)}})),this.index+=1,i}}}toAsyncIterableIterator(){return TT(this)}};async function*TT(e){yield*e}p([Me,h("design:type",Function),h("design:paramtypes",[Object,Object]),h("design:returntype",void 0)],fr.prototype,"push",null),p([Me,h("design:type",Function),h("design:paramtypes",[Function,Object]),h("design:returntype",void 0)],fr.prototype,"pushCalc",null),p([Me,h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",Promise)],fr.prototype,"done",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],fr.prototype,"throw",null),p([Me,h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],fr.prototype,"resolve",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],fr.prototype,"reject",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],fr.prototype,"then",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],fr.prototype,"catch",null);var Nf=(e,t,r)=>{let n=[new Kt];const s=(c,l)=>{let u=c[l];return u===void 0&&(u=c[l]=new Kt),u},i=c=>{if(n!==void 0)return s(n,c).promise};let o=0;(async()=>{await i(o);for await(const c of e){let l=r(c);if(l.async&&(l=await l.value),l.filter){if(l.multi)for(const u of l.maps)t.push(u);else t.push(l.map);await i(o)}}await t.done()})().catch(t.throw),t.on("done",(c,l)=>(e.done(),l())),t.on("error",(c,l)=>(e.throw(c),l())),t.on("requestItem",(c,l)=>{n!==void 0&&(s(n,o).resolve(),o+=1),l()}),t.on("requestAll",(c,l)=>{if(n!==void 0){for(const u of n)u.is_resolved===!1&&u.resolve();n=void 0}l()})},ui=class{static InitCryptTable(){const e=new Array(1280);let t,r,n,s=1048577,i=0,o=0;for(i=0;i<256;i++)for(o=i,t=0;t<5;t++,o+=256)s=(125*s+3)%2796203,r=(65535&s)<<16,s=(125*s+3)%2796203,n=65535&s,e[o]=r|n;return e}static hashString(e,t){const{cryptTable:r,cryptTable_length:n}=ui;let s,i=2146271213,o=4008636142;for(let c=0;c<e.length;c+=1)s=((t<<8)+e.charCodeAt(c))%n,i=r[s]^i+o,o=s+i+o+(o<<5)+3;return i}static inRangePosition(e){const{hashRange:t}=ui;return(e-t.min)/t.dis%1}static hashToRandom(e,t,r=0,n=1,s){const i=(ui.hashString(e,t)-ui.hashRange.min)/ui.hashRange.dis*(n-r)+r;return s?Math.floor(i):i}},Of=ui;Of.cryptTable=Object.freeze(ui.InitCryptTable()),Of.cryptTable_length=ui.cryptTable.length,Of.hashRange=Object.freeze({min:-2147483648,max:2147483647,dis:Math.pow(2,32)});var ST=class extends Gt{constructor(e){super(t=>[],e)}add(e,t){this.forceGet(e).push(t)}remove(e,t){const r=this.get(e);if(r){const n=r.indexOf(t);if(n!==-1)return r.splice(n,1),!0}return!1}},vf=class{constructor(e){this.eventEmitter=e,this.BINDED_EVENTS_MAP=new ST}on(e,t,r){return this.eventEmitter.on(e,t,r),this.BINDED_EVENTS_MAP.add(e,t),this}off(e,t){return this.BINDED_EVENTS_MAP.remove(e,t)&&this.eventEmitter.off(e,t),this}emit(e,...t){return this.eventEmitter.emit(e,...t),this}once(e,t,r){const n=(...s)=>(this.BINDED_EVENTS_MAP.remove(e,n),t(...s));return this.BINDED_EVENTS_MAP.add(e,n),this.eventEmitter.once(e,t,r),this}removeAllListeners(){for(const[e,t]of this.BINDED_EVENTS_MAP)for(const r of t)this.eventEmitter.off(e,r);return this.BINDED_EVENTS_MAP.clear(),this}get clear(){return this.removeAllListeners}get addListener(){return this.on}get removeListener(){return this.off}};p([ie,h("design:type",Object),h("design:paramtypes",[])],vf.prototype,"clear",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],vf.prototype,"addListener",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],vf.prototype,"removeListener",null);var B_,Cf=class{constructor(){this._instanceParamWM=new WeakMap}getParam(e){return this._instanceParamWM.get(e)}setParam(e,t){this._instanceParamWM.set(e,t)}};Cf=p([j()],Cf);var bT=/"(?:\.|(\\\")|[^\""\n])*"|'(?:\.|(\\\')|[^\''\n])*'/g,fl=class{constructor(e,t){this.moduleMap=e,this.flagParamStack=t,this._applyedFlagMap=new Map,this._flagInfomationMap=new Map}strToBool_(e){const t=e.toLowerCase();return t!=="disable"&&t!=="disabled"&&t!=="false"&&(t==="enable"||t==="enabled"||t==="true"||t===""||e)}_formatString(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}parse(e){const t=[],r=`_PLACE_${Math.random().toString(36).slice(2)}_HOLDER_`,n=e.replace(bT,i=>(t.push(i),r)).split(/\s+/).filter(i=>!!i),s=new Map;for(const i of n){const o=i.indexOf("=");let c,l,u="";if(o===-1)c=i;else{if(c=i.substr(0,o),c.includes(r))throw new Error(`Flags format error: ${c.replace(r,t.shift()||r)} is invilde.`);u=i.substr(o+1).replace(new RegExp(r,"g"),y=>{const m=t.shift();if(!m)throw new Error;return m})}const g=this._flagInfomationMap.get(i);if(g)switch(g.type){case"boolean":l=!!this.strToBool_(u);break;case"number":const y=Number.parseFloat(u);l=Number.isNaN(y)?void 0:y;break;case"string":l=this._formatString(u)}else{if(l=this.strToBool_(u),typeof l=="string"){const y=parseFloat(l);y.toString()===l&&(l=y)}typeof l=="string"&&(l=this._formatString(l))}s.delete(c),s.set(c,l)}return s}quote(e){const t=[];for(let[r,n]of e)n===void 0?t.push(r):(typeof n=="string"&&(n=JSON.stringify(n)),t.push(`${r}=${n}`));return t.join(" ")}applyFlags(e){e instanceof Map||(e=this.parse(e));for(const[t,r]of e)this.setFlagValue(t,r);return this._applyedFlagMap=e}getFlagValue(e){return this._applyedFlagMap.get(e)}setFlagValue(e,t){const r=this._flagInfomationMap.get(e);return!!r&&(t===!1?(r.onDisable instanceof Function&&r.onDisable(),this._applyedFlagMap.delete(e)):(r.onEnable instanceof Function&&r.onEnable(t),this._applyedFlagMap.set(e,t)),!0)}hasFlag(e){return this._applyedFlagMap.has(e)}getApplyedFlags(){return this.quote(this._applyedFlagMap)}registerBooleanFlag(e,t,r){if(this._flagInfomationMap.has(e))throw new Error(`Duplicate registration boolean flag: ${e}.`);this._flagInfomationMap.set(e,{type:"boolean",onEnable:t,onDisable:r})}registerStringFlag(e,t,r){if(this._flagInfomationMap.has(e))throw new Error(`Duplicate registration string flag: ${e}.`);this._flagInfomationMap.set(e,{type:"string",onEnable:t,onDisable:r})}registerNumberFlag(e,t,r){if(this._flagInfomationMap.has(e))throw new Error(`Duplicate registration number flag: ${e}.`);this._flagInfomationMap.set(e,{type:"number",onEnable:t,onDisable:r})}registerInjectionFlag(e,t,r="boolean"){if(this._flagInfomationMap.has(e))throw new Error(`Duplicate registration injection flag: ${e}.`);this._flagInfomationMap.set(e,{type:r,onEnable:n=>{const s=this.moduleMap,i=At(t,s.installMask(new je([[wT,n]])));this.flagParamStack.setParam(i,n)}})}};fl=p([j(),h("design:paramtypes",[typeof(B_=je!==void 0&&je)=="function"?B_:Object,Cf])],fl);var wT=Symbol("flag param in constructor"),NT=()=>performance,Ln=class{constructor(){this.platformInfo=Cs,this.performance=NT()}get platformName(){return Cs.platformName()}get isNodejs(){return a_}get isWindows(){return eT}get isCordova(){return o_}get isWebView(){return Pp}get isWebMainThread(){return Wg}get isWebWorker(){return c_}};p([ie,h("design:type",Object),h("design:paramtypes",[])],Ln.prototype,"platformName",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ln.prototype,"isNodejs",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ln.prototype,"isWindows",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ln.prototype,"isCordova",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ln.prototype,"isWebView",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ln.prototype,"isWebMainThread",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Ln.prototype,"isWebWorker",null),Ln=p([j()],Ln);var Rf=new WeakMap;function fa(e,t,r){let n,s=Rf.get(e);if(!s){const i={resolves:new Set,rejects:new Set},o=()=>{i.resolves.clear(),i.rejects.clear(),l.cbs=void 0},c=e.then(u=>{for(const g of i.resolves)queueMicrotask(async()=>{try{await g(u)}catch(y){console.error("Unhandled promise rejection when running onfulfilled",g,y)}});o()},async u=>{for(const g of i.rejects)queueMicrotask(async()=>{try{await g(u)}catch(y){console.error("Unhandled promise rejection when running onrejected",g,y)}});o()}),l={cbs:i,promise:c};Rf.set(e,s=l)}return s.cbs?(t&&s.cbs.resolves.add(t),r&&s.cbs.rejects.add(r),n=s.promise):n=e.then(t,r),{thened:s,toPromise:n}}function dl(e,t,r){const n=Rf.get(e);return n&&n.cbs&&r&&n.cbs.rejects.delete(r),n}var OT=class yI{constructor(t){this.rankList=[],this.thenedMap=new Map,this._cter=!1,this.options=yI.mergeOptions(t)}static mergeOptions(t){return Object.assign({throwWhenNoRacer:!1},t)}resolve(t){this.quota?(this.quota.resolve(t),this.quota=void 0):this.rankList.push({type:1,value:t})}reject(t){this.quota?(this.quota.reject(t),this.quota=void 0):this.rankList.push({type:0,value:t})}addRacer(t){const r=this.thenedMap.get(t);if(!r){const n=c=>{this.resolve(c),this.thenedMap.delete(t)},s=c=>{this.reject(c),this.thenedMap.delete(t)},{thened:i,toPromise:o}=fa(t,n,s);return i.cbs&&this.thenedMap.set(t,{cbs:i.cbs,onfulfilled:n,onrejected:s,toPromise:o}),o}return r.toPromise}removeRacer(t){const r=this.thenedMap.get(t);return!!r&&(this._removeRacer(t,r),this._checkToEndRace(),!0)}_removeRacer(t,r){r.cbs.resolves.delete(r.onfulfilled),r.cbs.rejects.delete(r.onrejected),this.thenedMap.delete(t)}hasRacer(t){return this.thenedMap.has(t)}get size(){return this.thenedMap.size}_queneToCheck(){}_checkToEndRace(){this.options.throwWhenNoRacer&&this._cter===!1&&this.thenedMap.size===0&&(this._cter=!0,queueMicrotask(()=>{this.thenedMap.size===0&&this.quota&&this.quota.is_finished===!1&&this.quota.reject(new RangeError("no racer to race"))}))}static isNoRacerException(t){return t instanceof RangeError&&t.message==="no racer to race"}race(t){const r=this.rankList.shift();if(!r)return t?(this.quota?this.quota!==t&&this.quota.promise.then(t.resolve,t.reject):this.quota=t,t.promise):(this._checkToEndRace(),(this.quota||(this.quota=new Kt)).promise);if(r.type===1)return r.value;throw r.value}clear(t){for(const r of this.thenedMap)this._removeRacer(r[0],r[1]);this.rankList.length=0,this.quota&&(this.quota.reject(t),this.quota=void 0)}};function H_(e){const t=new Kt;let r=!0;const n=[];for(const s of e){if(typeof s!="object"||s===null||typeof s.then!="function"){r=!1,t.resolve(s);break}n.push(s)}if(r)if(n.length===0)console.warn("safePromiseRace got empty array");else{const s=new OT;t.onFinished(()=>s.clear());for(const i of n)s.addRacer(i);s.race(t)}return t.promise}var Pf=Symbol("then"),xf=Symbol("catch"),Bf=class{constructor(e){let t,r;const n=new Promise((o,c)=>{t=o,r=c});this.promise=Object.assign(n,{[Pf]:n.then,[xf]:n.catch});let s=!1;const i=()=>{s||(e(t,r),s=!0)};n.then=(o,c)=>(i(),this.delayThen(o,c)),n.catch=o=>(i(),this.delayCatch(o))}delayThen(e,t){return this.promise[Pf](e,t)}delayCatch(e){return this.promise[xf](e)}get then(){return this.promise.then}get catch(){return this.promise.catch}};Bf.THEN_SYMBOL=Pf,Bf.CATCH_SYMBOL=xf;var vT=class{constructor(e=2){this.maxParallelNum=e,this._runningTasks=[],this._waitingQuene=[]}addTaskExecutor(e){const t=new Kt;return this._waitingQuene.push({executor:e,po:t}),t.promise}get isDone(){return this._runningTasks.length===0&&this._waitingQuene.length===0}get hasTask(){return!this.isDone}get isFull(){return this._runningTasks.length+this._waitingQuene.length>=this.maxParallelNum}async*_startParallel(){for(;;){const e=this._waitingQuene.shift();if(!e)break;try{const t=await e.executor();e.po.resolve(t),yield{asset:t}}catch(t){yield{error:t},e.po.reject(t)}}}async doAll(e){const t=[];for await(const r of this.yieldResults(e))t.push(r);return t}async doRace(e){for await(const t of this.yieldResults(e))return t}yieldResults(e){return this._yielding||(this._yielding=this._yieldResults(e)),this._yielding}async*_yieldResults(e={}){const t=[],r=()=>this._startParallel(),n=this._runningTasks;for(;;){for(;n.length<this.maxParallelNum&&this._waitingQuene.length>0;){const i=t.shift()||r(),o=i.next().then(l=>{if(!l.done){t.push(i);const u=l.value;if(u){if(!("error"in u))return{asset:u.asset,rm:c};if(e.onError&&e.onError(u.error),!e.ignoreError)throw u.error}}c()});n.push(o);const c=()=>{const l=n.indexOf(o);l!==-1&&n.splice(l,1)}}if(n.length===0)break;const s=await H_(n);s&&(yield s.asset,s.rm())}this._yielding=void 0}},CT=class extends Wm{constructor(e,t){super(e),this.silence=t,this.ABORT_ERROR_FLAG=!0}},RT=class mI extends Kt{constructor(){super()}get is_done(){return this.is_resolved||this.is_rejected}abort(t="Abort"){this.is_done||(this.reject(this.abort_error=new CT(t)),this._hasAbortEvent&&this._abortEvent.emit("abort",this.abort_error,this))}get _abortEvent(){return this._hasAbortEvent=!0,new mn}onAbort(t){this._abortEvent.on("abort",t)}follow(t){return t.then(this.resolve).catch(this.reject),this.promise}static fromPromise(t){const r=new mI;return zu(t instanceof Bf?t.delayThen(r.resolve,r.reject):t.then(r.resolve,r.reject)),r}finally(t){return this.promise.finally(t)}};p([ie,h("design:type",Object),h("design:paramtypes",[])],RT.prototype,"_abortEvent",null);var yl=new WeakMap,xs=(e,t)=>{let r;e<=0&&(e=1);const n=new Promise(s=>r=setTimeout(()=>{yl.delete(n),s()},e)).then(t);return yl.set(n,r),n},k_=e=>{const t=yl.get(e);t!==void 0&&(yl.delete(e),clearTimeout(t))},L_=class{constructor(){this._task_list=[]}toPromise(){return Promise.all(this._task_list)}set next(e){this._task_list.push(e)}tryToPromise(){return this._task_list.some(e=>e&&typeof e.then=="function")?Promise.all(this._task_list):this._task_list}},Ue=async e=>{const t=new L_;try{await e(t)}catch(r){t.next=Promise.reject(r)}return t.toPromise()},ml,M_,{info:PT}=h_("util","TimeHelper"),xT={TIME_SPEED:"TIME_SPEED"},_l=ml=class{constructor(e,t=1){this.platformHelper=e,this.TIME_SPEED=t,this.clearTimeout=clearTimeout,this.clearInterval=clearInterval,this.time_offset_ms=0,this.SYSTEM_START_TIME=this.platformHelper.performance.timeOrigin,typeof t=="number"&&t>0||(this.TIME_SPEED=1),PT("TIME SPPED  %d.",this.TIME_SPEED)}setTimeout(e,t){return setTimeout(e,t/this.TIME_SPEED)}setInterval(e,t){return setInterval(e,t/this.TIME_SPEED)}sleep(e,t){return xs(e/this.TIME_SPEED,t)}get BLOCKCHAIN_SYSTEM_START_TIME(){return this.SYSTEM_START_TIME+this.time_offset_ms}now(e=!1){const t=this.platformHelper.performance.now()+this.SYSTEM_START_TIME+this.time_offset_ms,r=Date.now()-t;r>1&&(this.time_offset_ms+=r);const n=this.SYSTEM_START_TIME+(this.platformHelper.performance.now()+this.time_offset_ms)*this.TIME_SPEED;return e?parseInt(n.toString()):n}changeNowByDiff(e){const{NOW_DIFF_SYMBOL:t}=ml,r=Reflect.get(Date,t);if(this.time_offset_ms+=e-(r||0),e!==0){if(r===void 0){const n=Date.now,s=Date.now=()=>n()+Reflect.get(Date,t);Reflect.set(s,"source",n)}Reflect.set(Date,t,e)}else{const n=Date.now,s=Reflect.get(n,"source");s!==void 0&&(Date.now=s,Reflect.deleteProperty(Date,t))}}changeNowByTime(e){const{NOW_DIFF_SYMBOL:t}=ml,r=Reflect.get(Date,t)||0,n=e-(Date.now()-r);return this.changeNowByDiff(n)}formatDate(e,t="yyyy-MM-dd hh:mm:ss"){const r=e.getMonth()+1,n={"M+":r,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),E:["","","",""][Math.floor(r%12/3)],W:["","","","","","",""][e.getDay()],S:e.getMilliseconds()};let s=t;/(y+)/.test(s)&&(s=s.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(const i in n)new RegExp("("+i+")").test(s)&&(s=s.replace(RegExp.$1,RegExp.$1.length===1?""+n[i]:("00"+n[i]).substr((""+n[i]).length)));return s}formatDateTime(e=this.now()){return this.formatDate(new Date(e))}formatYMDHMS(e,t,r,n,s,i){const o=(c,l=2)=>String(c).padStart(l,"0");return`${o(e,4)}-${o(t)}-${o(r)} ${o(n)}:${o(s)}:${o(i)}`}};_l.NOW_DIFF_SYMBOL=Symbol("now-diff-ms"),_l=ml=p([j(),Se(1,k(xT.TIME_SPEED,{optional:!0})),h("design:paramtypes",[typeof(M_=Ln!==void 0&&Ln)=="function"?M_:Object,Object])],_l);var So=class{get v4(){return"(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}"}get v6seg(){return"[a-fA-F\\d]{1,4}"}get v6(){const{v4:e,v6seg:t}=this;return`
    (
    (?:${t}:){7}(?:${t}|:)|                                // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
    (?:${t}:){6}(?:${e}|:${t}|:)|                         // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
    (?:${t}:){5}(?::${e}|(:${t}){1,2}|:)|                 // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
    (?:${t}:){4}(?:(:${t}){0,1}:${e}|(:${t}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
    (?:${t}:){3}(?:(:${t}){0,2}:${e}|(:${t}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
    (?:${t}:){2}(?:(:${t}){0,3}:${e}|(:${t}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
    (?:${t}:){1}(?:(:${t}){0,4}:${e}|(:${t}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
    (?::((?::${t}){0,5}:${e}|(?::${t}){1,7}|:))           // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
    )(%[0-9a-zA-Z]{1,})?                                           // %eth0            %1
    `.replace(/\/\/.*$/gm,"").replace(/(^\s+)|(\s+$)|\s+/g,"").replace(/\n/g,"")}isIp(e){const{v4:t,v6:r}=this;return new RegExp(`(?:^${t}$)|(?:^${r}$)`).test(e)}isIpV4(e){const{v4:t}=this;return new RegExp(`^${t}$`).test(e)}isIpV6(e){const{v6:t}=this;return new RegExp(`^${t}$`).test(e)}ipv4ToUint32(e){return e.split(".").reduce((t,r,n)=>t+ +r*Math.pow(256,3-n),0)}uint32ToIpv4(e){return`${e/16777216|0}.${e%16777216/65536|0}.${e%65536/256|0}.${e%256}`}};p([ie,h("design:type",Object),h("design:paramtypes",[])],So.prototype,"v4",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],So.prototype,"v6seg",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],So.prototype,"v6",null),So=p([j()],So);var dr=class extends Jn.Buffer{static from(e,t,r){return Jn.Buffer.from(e,t,r)}static alloc(e,t,r){return Jn.Buffer.alloc(e,t,r)}static allocUnsafe(e){return Jn.Buffer.allocUnsafe(e)}static allocUnsafeSlow(e){return Jn.Buffer.allocUnsafeSlow(e)}};function Hf(e){return typeof e=="object"&&e!==null&&!(Symbol.iterator in e)}function kf(e){return e.length===1?e[0]:new Proxy(e[0],{get(t,r,n){const s=e.filter(c=>Reflect.has(c,r));if(s.length===0)return;if(s.length===1)return Reflect.get(s[0],r);const i=s.map(c=>Reflect.get(c,r)),o=i.filter(c=>Hf(c));return o.length===0?i[i.length-1]:kf(o)},getOwnPropertyDescriptor(t,r){const n=e.filter(c=>Reflect.has(c,r));if(n.length===0)return;if(n.length===1)return Object.getOwnPropertyDescriptor(n[0],r);const s=n.map(c=>({obj:c,value:Reflect.get(c,r)})),i=s.filter(c=>Hf(c.value)),o=Object.getOwnPropertyDescriptor(s[s.length-1].obj,r);return i.length===0?o:{...o,value:kf(s.map(c=>c.value))}},ownKeys(){const t=new Set;for(const r of e)for(const n of Reflect.ownKeys(r))t.add(n);return[...t]}})}function BT(...e){const t=e.filter(Hf);return t.length===0?{}:kf(t)}var HT=()=>({TextDecoder,TextEncoder}),kT=new WeakMap,{TextEncoder:LT,TextDecoder:MT}=HT(),DT=new LT;new MT("utf-8");var FT=new Uint8Array;function UT(e){if(!e)return FT;const t=e.length<=128?$T(e):DT.encode(e);return kT.set(t,e),t}function $T(e){const t=[];let r,n;for(let s=0;s<e.length;++s)r=e.charCodeAt(s),r<128?t[t.length]=r:r<2048?(t[t.length]=r>>6|192,t[t.length]=63&r|128):(64512&r)==55296&&(64512&(n=e.charCodeAt(s+1)))==56320?(r=65536+((1023&r)<<10)+(1023&n),++s,t[t.length]=r>>18|240,t[t.length]=r>>12&63|128,t[t.length]=r>>6&63|128,t[t.length]=63&r|128):(t[t.length]=r>>12|224,t[t.length]=r>>6&63|128,t[t.length]=63&r|128);return new Uint8Array(t)}var D_,cs=class _I{constructor(t,r=s=>s,n){this.transformKey=r,this._afterDelete=n,this._set=new Set(t)}static from(t){return new _I(t.entries,t.transformKey,t.afterDelete)}tryAdd(t){return this.add(this.transformKey(t))}tryDelete(t){return this.delete(this.transformKey(t))}tryHas(t){return this.has(this.transformKey(t))}get clear(){return this._set.clear.bind(this._set)}get delete(){const t=this._set.delete.bind(this._set),{_afterDelete:r}=this;return r?n=>!!t(n)&&(r(n),!0):t}get forEach(){return this._set.forEach.bind(this._set)}get has(){return this._set.has.bind(this._set)}get add(){return this._set.add.bind(this._set)}get size(){return this._set.size}get[D_=Symbol.iterator](){return this._set[Symbol.iterator].bind(this._set)}get entries(){return this._set.entries.bind(this._set)}get keys(){return this._set.keys.bind(this._set)}get values(){return this._set.values.bind(this._set)}get[Symbol.toStringTag](){return"EasySet"}};p([ie,h("design:type",Object),h("design:paramtypes",[])],cs.prototype,"clear",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],cs.prototype,"delete",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],cs.prototype,"forEach",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],cs.prototype,"has",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],cs.prototype,"add",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],cs.prototype,D_,null),p([ie,h("design:type",Object),h("design:paramtypes",[])],cs.prototype,"entries",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],cs.prototype,"keys",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],cs.prototype,"values",null);var Lf=class AI{constructor(t,r=s=>s,n){this.transformKey=r,this._afterDelete=n,this._ws=new WeakSet(t)}static from(t){return new AI(t.entries,t.transformKey,t.afterDelete)}tryAdd(t){return this.add(this.transformKey(t))}tryDelete(t){return this.delete(this.transformKey(t))}tryHas(t){return this.has(this.transformKey(t))}get delete(){const t=this._ws.delete.bind(this._ws),{_afterDelete:r}=this;return r?n=>!!t(n)&&(r(n),!0):t}get add(){return this._ws.add.bind(this._ws)}get has(){return this._ws.has.bind(this._ws)}get[Symbol.toStringTag](){return"EasyWeakSet"}};p([ie,h("design:type",Object),h("design:paramtypes",[])],Lf.prototype,"delete",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Lf.prototype,"add",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Lf.prototype,"has",null);var VT=typeof Promise=="function",GT=typeof self=="object"?self:globalThis,F_=typeof Symbol<"u",Mf=typeof Map<"u",Df=typeof Set<"u",KT=typeof WeakMap<"u",jT=typeof WeakSet<"u",zT=typeof DataView<"u",U_=F_&&Symbol.iterator!==void 0,$_=F_&&Symbol.toStringTag!==void 0,JT=Df&&typeof Set.prototype.entries=="function",YT=Mf&&typeof Map.prototype.entries=="function",XT=JT&&Object.getPrototypeOf(new Set().entries()),QT=YT&&Object.getPrototypeOf(new Map().entries()),V_=U_&&typeof Array.prototype[Symbol.iterator]=="function",qT=V_&&Object.getPrototypeOf([][Symbol.iterator]()),G_=U_&&typeof String.prototype[Symbol.iterator]=="function",WT=G_&&Object.getPrototypeOf(""[Symbol.iterator]());function ZT(e){const t=typeof e;if(t!=="object")return t;if(e===null)return"null";if(e===GT)return"global";if(Array.isArray(e)&&($_===!1||!(Symbol.toStringTag in e)))return"Array";if(typeof window=="object"&&window!==null){if(typeof window.location=="object"&&e===window.location)return"Location";if(typeof window.document=="object"&&e===window.document)return"Document";if(typeof window.navigator=="object"){if(typeof window.navigator.mimeTypes=="object"&&e===window.navigator.mimeTypes)return"MimeTypeArray";if(typeof window.navigator.plugins=="object"&&e===window.navigator.plugins)return"PluginArray"}if((typeof window.HTMLElement=="function"||typeof window.HTMLElement=="object")&&e instanceof window.HTMLElement){if(e.tagName==="BLOCKQUOTE")return"HTMLQuoteElement";if(e.tagName==="TD")return"HTMLTableDataCellElement";if(e.tagName==="TH")return"HTMLTableHeaderCellElement"}}const r=$_&&e[Symbol.toStringTag];if(typeof r=="string")return r;const n=Object.getPrototypeOf(e);return n===RegExp.prototype?"RegExp":n===Date.prototype?"Date":VT&&n===Promise.prototype?"Promise":Df&&n===Set.prototype?"Set":Mf&&n===Map.prototype?"Map":jT&&n===WeakSet.prototype?"WeakSet":KT&&n===WeakMap.prototype?"WeakMap":zT&&n===DataView.prototype?"DataView":Mf&&n===QT?"Map Iterator":Df&&n===XT?"Set Iterator":V_&&n===qT?"Array Iterator":G_&&n===WT?"String Iterator":n===null?"Object":Object.prototype.toString.call(e).slice(8,-1)}var K_=typeof Buffer<"u";K_&&Buffer.from;var eS=K_?function(e){return Buffer.isBuffer(e)}:function(e){return!1};function j_(e){return eS(e)?"Buffer":ZT(e)}var z_=new class{get(e,t,r=j_(e)){switch(r){case"Arguments":case"Array":case"Object":return e[t];case"Map":return e.get(t);case"Set":return t}}set(e,t,r,n=j_(e)){switch(n){case"Arguments":case"Array":case"Object":e[t]=r;break;case"Map":e.set(t,r);break;case"Set":e.add(r)}return e}};z_.get,z_.set;var tS=typeof globalThis<"u"&&globalThis!==null&&globalThis.Object===Object&&globalThis,rS=typeof globalThis<"u"&&globalThis!==null&&globalThis.Object===Object&&globalThis,nS=typeof self<"u"&&self!==null&&self.Object===Object&&self;tS||rS||nS||Function("return this")();var Jp,{ArgumentFormatException:J_}=Z("MODEL","transactionModel"),sS=new Ga(e=>new Cm(e.inputs)),gi=Jp=class extends J{get macroId(){return Ne(this.macroIdBuffer)}set macroId(e){this.macroIdBuffer=me(e)}get inputMap(){return sS.forceGet(this)}get transaction(){const{transactionBuffer:e}=this,t=Je.decode(e),r=ve.trsTypeToV(t.type),n=ve.VM.get(r);if(!n)throw new J_(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:r});return n.decode(e)}set transaction(e){this.transactionBuffer=e.getBytes()}toJSON(){return{macroId:this.macroId,inputs:this.inputs,transaction:this.transaction.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e&&(e.macroId&&(t.macroId=e.macroId),e.transaction)){const r=e.transaction;if(r instanceof J)t.transaction=r;else{const n=r.type;if(n){const s=ve.trsTypeToV(n),i=ve.VM.get(s);if(!i)throw new J_(a.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.transaction=i.fromObject(r)}}}return t}};gi.INC=1,p([_.d(Jp.INC++,"bytes"),h("design:type",Uint8Array)],gi.prototype,"macroIdBuffer",void 0),p([kr.d(Jp.INC++,"string","string"),h("design:type",Object)],gi.prototype,"inputs",void 0),p([_.d(Jp.INC++,"bytes"),h("design:type",Uint8Array)],gi.prototype,"transactionBuffer",void 0),gi=Jp=p([C.d("MacroCallModel")],gi);var Yp=class extends J{toJSON(){return{call:this.call.toJSON()}}};p([_.d(1,gi),h("design:type",gi)],Yp.prototype,"call",void 0),Yp=p([C.d("MacroCallAssetModel")],Yp);var Ff,bo=Ff=class extends Je{as(e,t){const r=ve.MV.get(e),n=ve.trsTypeToV(this.type);if(r===n)if(t){if(this.signature===t)return this}else return this;const{transaction:s}=this.asset.call;return s.as(e,t)}getBlobSize(e=!1){let t=0;const r=this.blobMap.values();for(const n of r)t+=n[3];return e===!1&&(t+=this.asset.call.transaction.getBlobSize(e)),t}};p([_.d(Ff.INC++,Yp),h("design:type",Yp)],bo.prototype,"asset",void 0),bo=Ff=p([C.d("MacroCallTransaction")],bo),ve.VM.set(B.REGISTER_CHAIN,yo),ve.MV.set(yo,B.REGISTER_CHAIN),ve.VM.set(B.MULTIPLE,_o),ve.MV.set(_o,B.MULTIPLE),ve.VM.set(B.PROMISE,ca),ve.MV.set(ca,B.PROMISE),ve.VM.set(B.PROMISE_RESOLVE,Io),ve.MV.set(Io,B.PROMISE_RESOLVE),ve.VM.set(B.MACRO,ga),ve.MV.set(ga,B.MACRO),ve.VM.set(B.MACRO_CALL,bo),ve.MV.set(bo,B.MACRO_CALL);var da,fi;(function(e){e[e.INDETERMINATE=0]="INDETERMINATE",e[e.DETERMINATE=1]="DETERMINATE",e[e.BUFFER=2]="BUFFER",e[e.QUERY=3]="QUERY"})(fi||(fi={}));var Cr=da=class extends J{get loaded(){return this._loaded>this.total?this.total:this._loaded}set loaded(e){this._loaded=e}get buffer(){return this._buffer&&this._buffer>this.total?this.total:this._buffer}set buffer(e){this._buffer=e}toJSON(){var e;const t={type:this.type,mode:this.mode,loaded:this.loaded,buffer:this.buffer,total:this.total};return(e=this.buffer)!==null&&e!==void 0||(t.buffer=this.buffer),t}static fromObject(e){const t=super.fromObject(e);return e.loaded&&(t.loaded=e.loaded),e.buffer&&(t.buffer=e.buffer),t}};Cr.INC=1,p([_.d(da.INC++,"string"),h("design:type",String)],Cr.prototype,"type",void 0),p([_.d(da.INC++,fi),h("design:type",Number)],Cr.prototype,"mode",void 0),p([_.d(da.INC++,"uint32"),h("design:type",Number)],Cr.prototype,"_loaded",void 0),p([_.d(da.INC++,"uint32","optional"),h("design:type",Number)],Cr.prototype,"_buffer",void 0),p([_.d(da.INC++,"uint32"),h("design:type",Number)],Cr.prototype,"total",void 0),Cr=da=p([C.d("ProgressEvent")],Cr);var Uf,Al=Uf=class extends Cr{toJSON(){return Object.assign({finishedDetails:this.finishedDetails.map(e=>e.toJSON())},super.toJSON())}};p([_.d(Uf.INC++,Ua,"repeated"),h("design:type",Array)],Al.prototype,"finishedDetails",void 0),Al=Uf=p([C.d("TransactionsProgressEvent")],Al);var Il,di=Il=class extends Cr{toJSON(){return Object.assign({finishedDetails:this.finishedDetails.map(e=>e.toJSON()),processingDetails:this.processingDetails},super.toJSON())}};p([_.d(Il.INC++,Ua,"repeated"),h("design:type",Array)],di.prototype,"finishedDetails",void 0),p([kr.d(Il.INC++,"uint32",Al),h("design:type",Object)],di.prototype,"processingDetails",void 0),di=Il=p([C.d("BlocksProgressEvent")],di);var $f,Bs=$f=class extends Cr{toJSON(){return Object.assign({currentBlockDetails:this.currentBlockDetails.toJSON()},super.toJSON())}};p([_.d($f.INC++,di),h("design:type",di)],Bs.prototype,"currentBlockDetails",void 0),Bs=$f=p([C.d("BlockchainRebuidingProgressEvent")],Bs);var wo=class extends Cr{};wo=p([C.d("BlockchainPeerScanningProgressEvent")],wo);var yi=class extends Cr{toJSON(){const e={};for(const r in this.applyDetails)e[r]=this.applyDetails[r].toJSON();const t={};for(const r in this.syncDetails)t[r]=this.syncDetails[r].toJSON();return Object.assign({applyDetails:e,syncDetails:t},super.toJSON())}};p([kr.d(Bs.INC++,"uint32",di),h("design:type",Object)],yi.prototype,"applyDetails",void 0),p([kr.d(Bs.INC++,"uint32",di),h("design:type",Object)],yi.prototype,"syncDetails",void 0),yi=p([C.d("BlockchainReplayBlockProgressEvent")],yi);var No=class extends Cr{};No=p([C.d("BlockchainRollbackProgressEventModel")],No);var Oo=class extends Cr{};Oo=p([C.d("BlockchainGeneratingProgressEvent")],Oo);var be;(function(e){e[e.error=0]="error",e[e.busy=1]="busy",e[e.success=2]="success",e[e.idempotentError=3]="idempotentError"})(be||(be={}));var Yr;(function(e){e[e.OFFLINE=0]="OFFLINE",e[e.FREE=1]="FREE",e[e.REBUIDING=2]="REBUIDING",e[e.PEER_SCANNING=3]="PEER_SCANNING",e[e.REPLAY_BLOCK=4]="REPLAY_BLOCK",e[e.GENERATING=5]="GENERATING",e[e.ROLLBACK=6]="ROLLBACK"})(Yr||(Yr={}));var El;(function(e){e[e.Refuse=0]="Refuse",e[e.InBlock=1]="InBlock",e[e.InUnconfirmQuene=2]="InUnconfirmQuene"})(El||(El={}));var Ce;(function(e){e[e.FEE_LESS_THAN_WEB_FEE=0]="FEE_LESS_THAN_WEB_FEE",e[e.TRS_EXPRIED=1]="TRS_EXPRIED",e[e.TRANSACTION_IN_UNTREATEDTR=2]="TRANSACTION_IN_UNTREATEDTR",e[e.TRANSACTION_IN_TRS=3]="TRANSACTION_IN_TRS",e[e.TRANSACTION_BASE_TYPE_NOT_FOUND=4]="TRANSACTION_BASE_TYPE_NOT_FOUND",e[e.TRANSACTION_BASE_NOT_FOUND=5]="TRANSACTION_BASE_NOT_FOUND",e[e.CHAIN_ASSET_NOT_ENOUGH=6]="CHAIN_ASSET_NOT_ENOUGH",e[e.ASSET_NOT_ENOUGH=7]="ASSET_NOT_ENOUGH",e[e.TRANSACTION_SENDER_ASSET_FROZEN=8]="TRANSACTION_SENDER_ASSET_FROZEN",e[e.TRANSACTION_RECIPIENT_ASSET_FROZEN=9]="TRANSACTION_RECIPIENT_ASSET_FROZEN",e[e.TRANSACTION_FEE_NOT_ENOUGH=10]="TRANSACTION_FEE_NOT_ENOUGH",e[e.TRANSACTION_ASSET_DEBT=11]="TRANSACTION_ASSET_DEBT",e[e.LOCATION_NAME_NOT_EXIST=12]="LOCATION_NAME_NOT_EXIST",e[e.ACCOUNT_NOT_LNS_POSSESSOR=13]="ACCOUNT_NOT_LNS_POSSESSOR",e[e.DAPP_ALREADY_EXISTS=14]="DAPP_ALREADY_EXISTS",e[e.ASSETTYPE_ALREADY_EXIST=15]="ASSETTYPE_ALREADY_EXIST",e[e.CHAINNAME_ALREADY_EXIST=16]="CHAINNAME_ALREADY_EXIST",e[e.ASSET_ALREADY_EXIST=17]="ASSET_ALREADY_EXIST",e[e.LOCATION_NAME_ALREADY_EXIST=18]="LOCATION_NAME_ALREADY_EXIST",e[e.CAN_NOT_SET_FROZEN_ACCOUNT_AS_MANAGER=19]="CAN_NOT_SET_FROZEN_ACCOUNT_AS_MANAGER",e[e.CAN_NOT_SET_SAME_ACCOUNT_AS_MANAGER=20]="CAN_NOT_SET_SAME_ACCOUNT_AS_MANAGER",e[e.SET_LNS_MANAGER_PERMISSION_DENIED=21]="SET_LNS_MANAGER_PERMISSION_DENIED",e[e.SET_LNS_RECORD_VALUE_PERMISSION_DENIED=22]="SET_LNS_RECORD_VALUE_PERMISSION_DENIED",e[e.TRS_IN_FEATURE=23]="TRS_IN_FEATURE",e[e.TRUST_MAIN_ASSET_ONLY=24]="TRUST_MAIN_ASSET_ONLY",e[e.USE_MAIN_ASSET_PURCHASE_ONLY=25]="USE_MAIN_ASSET_PURCHASE_ONLY",e[e.ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH=26]="ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH",e[e.MIGRATE_MAIN_ASSET_ONLY=27]="MIGRATE_MAIN_ASSET_ONLY",e[e.ASSET_IS_ALREADY_MIGRATION=28]="ASSET_IS_ALREADY_MIGRATION",e[e.MAGIC_ALREADY_EXIST=29]="MAGIC_ALREADY_EXIST",e[e.ENTITY_FACTORY_ALREADY_EXIST=30]="ENTITY_FACTORY_ALREADY_EXIST",e[e.ENTITY_FACTORY_NOT_EXIST=31]="ENTITY_FACTORY_NOT_EXIST",e[e.ENTITY_ALREADY_EXIST=32]="ENTITY_ALREADY_EXIST",e[e.ENTITY_NOT_EXIST=33]="ENTITY_NOT_EXIST",e[e.ACCOUNT_NOT_ENTITY_POSSESSOR=34]="ACCOUNT_NOT_ENTITY_POSSESSOR",e[e.ACCOUNT_NOT_DAPPID_POSSESSOR=35]="ACCOUNT_NOT_DAPPID_POSSESSOR",e[e.ASSET_NOT_EXIST=36]="ASSET_NOT_EXIST",e[e.DAPPID_NOT_EXIST=37]="DAPPID_NOT_EXIST",e[e.CERTIFICATE_ALREADY_EXIST=38]="CERTIFICATE_ALREADY_EXIST",e[e.CERTIFICATE_NOT_EXIST=39]="CERTIFICATE_NOT_EXIST",e[e.ACCOUNT_NOT_CERTIFICATE_POSSESSOR=40]="ACCOUNT_NOT_CERTIFICATE_POSSESSOR"})(Ce||(Ce={}));var Ae;(function(e){e[e.REFUSE=0]="REFUSE",e[e.RESPONSE=1]="RESPONSE",e[e.QUERY_TRANSACTION=2]="QUERY_TRANSACTION",e[e.NEW_TRANSACTION=4]="NEW_TRANSACTION",e[e.QUERY_BLOCK=8]="QUERY_BLOCK",e[e.NEW_BLOCK=16]="NEW_BLOCK",e[e.GET_PEER_INFO=32]="GET_PEER_INFO",e[e.INDEX_TRANSACTION=64]="INDEX_TRANSACTION",e[e.DOWNLOAD_TRANSACTION=128]="DOWNLOAD_TRANSACTION",e[e.OPEN_BLOB=256]="OPEN_BLOB",e[e.READ_BLOB=512]="READ_BLOB",e[e.CLOSE_BLOB=1024]="CLOSE_BLOB",e[e.QUERY_TINDEX=2048]="QUERY_TINDEX",e[e.GET_TRANSACTIONINBLOCK=4096]="GET_TRANSACTIONINBLOCK",e[e.QUERY_TRANSACTION_RETURN=3]="QUERY_TRANSACTION_RETURN",e[e.NEW_TRANSACTION_RETURN=5]="NEW_TRANSACTION_RETURN",e[e.QUERY_BLOCK_RETURN=9]="QUERY_BLOCK_RETURN",e[e.NEW_BLOCK_RETURN=17]="NEW_BLOCK_RETURN",e[e.GET_PEER_INFO_RETURN=33]="GET_PEER_INFO_RETURN",e[e.INDEX_TRANSACTION_RETURN=65]="INDEX_TRANSACTION_RETURN",e[e.DOWNLOAD_TRANSACTION_RETURN=129]="DOWNLOAD_TRANSACTION_RETURN",e[e.OPEN_BLOB_RETURN=257]="OPEN_BLOB_RETURN",e[e.READ_BLOB_RETURN=513]="READ_BLOB_RETURN",e[e.CLOSE_BLOB_RETURN=1025]="CLOSE_BLOB_RETURN",e[e.QUERY_TINDEX_RETURN=2049]="QUERY_TINDEX_RETURN",e[e.GET_TRANSACTIONINBLOCK_RETURN=4097]="GET_TRANSACTIONINBLOCK_RETURN"})(Ae||(Ae={}));var Vf,Tl,Tt=Vf=class extends J{constructor(){super(...arguments),this._parsed_detail=!1}get detail(){if(!this._parsed_detail){this._parsed_detail=!0;try{this._detail=this.detailJSON?JSON.parse(this.detailJSON):{}}catch{this._detail={}}}return this._detail}set detail(e){this.detailJSON=JSON.stringify(e),this._detail=e,this._parsed_detail=!0}static fromException(e){const t=Vf.fromObject(e);return t.detail=e.detail,t}toJSON(){return{message:this.message,detailJSON:this.detailJSON,PLATFORM:this.PLATFORM,CHANNEL:this.CHANNEL,BUSINESS:this.BUSINESS,MODULE:this.MODULE,FILE:this.FILE,CODE:this.CODE}}};p([_.d(1,"string"),h("design:type",String)],Tt.prototype,"message",void 0),p([_.d(2,"string","required",""),h("design:type",String)],Tt.prototype,"detailJSON",void 0),p([_.d(3,"string","optional"),h("design:type",String)],Tt.prototype,"PLATFORM",void 0),p([_.d(4,"string","optional"),h("design:type",String)],Tt.prototype,"CHANNEL",void 0),p([_.d(5,"string","optional"),h("design:type",String)],Tt.prototype,"BUSINESS",void 0),p([_.d(6,"string","optional"),h("design:type",String)],Tt.prototype,"MODULE",void 0),p([_.d(7,"string","optional"),h("design:type",String)],Tt.prototype,"FILE",void 0),p([_.d(8,"string","optional"),h("design:type",String)],Tt.prototype,"CODE",void 0),Tt=Vf=p([C.d("ExceptionMessage")],Tt);var Qt=Tl=class extends J{toJSON(){const e={status:this.status};return this.error&&(e.error=this.error.toJSON()),e}};Qt.INC=1,p([_.d(Tl.INC++,be),h("design:type",Number)],Qt.prototype,"status",void 0),p([_.d(Tl.INC++,Tt,"optional"),h("design:type",Tt)],Qt.prototype,"error",void 0),Qt=Tl=p([C.d("CommonResponse")],Qt);var qt,Gf,Kf,jf,zf,Jf,Yf,ya,Xf,Qf,tt=qt=class extends J{get signature(){return this.signatureBuffer&&Ne(this.signatureBuffer)||void 0}set signature(e){this.signatureBuffer=me(e)}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.signature&&(t.signature=e.signature),t}toJSON(){return{type:this.type,types:this.types,signature:this.signature,senderId:this.senderId,recipientId:this.recipientId,dappid:this.dappid,lns:this.lns,storage:this.storage,blockSignature:this.blockSignature,minHeight:this.minHeight,maxHeight:this.maxHeight,trusteeId:this.trusteeId,purchaseDAppid:this.purchaseDAppid,range:this.range,offset:this.offset,limit:this.limit,address:this.address}}};tt.INC=1,p([_.d(qt.INC++,"string","optional"),h("design:type",String)],tt.prototype,"type",void 0),p([_.d(qt.INC++,"string","repeated"),h("design:type",Array)],tt.prototype,"types",void 0),p([_.d(qt.INC++,"bytes","optional"),h("design:type",Uint8Array)],tt.prototype,"signatureBuffer",void 0),p([_.d(qt.INC++,"string","optional"),h("design:type",String)],tt.prototype,"senderId",void 0),p([_.d(qt.INC++,"string","optional"),h("design:type",String)],tt.prototype,"recipientId",void 0),p([_.d(qt.INC++,"string","optional"),h("design:type",String)],tt.prototype,"dappid",void 0),p([_.d(qt.INC++,"string","optional"),h("design:type",String)],tt.prototype,"lns",void 0),p([_.d(qt.INC++,Wn,"optional"),h("design:type",Wn)],tt.prototype,"storage",void 0),p([_.d(qt.INC++,"string","optional"),h("design:type",String)],tt.prototype,"blockSignature",void 0),p([_.d(qt.INC++,"uint32","optional"),h("design:type",Number)],tt.prototype,"minHeight",void 0),p([_.d(qt.INC++,"uint32","optional"),h("design:type",Number)],tt.prototype,"maxHeight",void 0),p([_.d(qt.INC++,"string","optional"),h("design:type",String)],tt.prototype,"trusteeId",void 0),p([_.d(qt.INC++,"string","optional"),h("design:type",String)],tt.prototype,"purchaseDAppid",void 0),p([_.d(qt.INC++,"uint32"),h("design:type",Number)],tt.prototype,"offset",void 0),p([_.d(qt.INC++,"uint32","optional"),h("design:type",Number)],tt.prototype,"limit",void 0),p([_.d(qt.INC++,"string","optional"),h("design:type",String)],tt.prototype,"range",void 0),p([_.d(qt.INC++,"string","optional"),h("design:type",String)],tt.prototype,"address",void 0),tt=qt=p([C.d("TransactionQueryOptions")],tt);var Xr=Gf=class extends J{toJSON(){return{tIndex:this.tIndex}}};Xr.INC=1,p([_.d(Gf.INC++,"int32","required",1),h("design:type",Number)],Xr.prototype,"tIndex",void 0),Xr=Gf=p([C.d("TransactionSortOptions")],Xr);var ma=class extends J{toJSON(){return{query:this.query.toJSON(),sort:this.sort.toJSON()}}};p([_.d(1,tt),h("design:type",tt)],ma.prototype,"query",void 0),p([_.d(2,Xr),h("design:type",Xr)],ma.prototype,"sort",void 0),ma=p([C.d("QueryTransactionArg")],ma);var vo=Kf=class extends Qt{toJSON(){return Object.assign({transactions:this.transactions.map(e=>e.toJSON())},super.toJSON())}};p([_.d(Kf.INC++,Xt,"repeated"),h("design:type",Array)],vo.prototype,"transactions",void 0),vo=Kf=p([C.d("QueryTransactionReturn")],vo);var Xp=class extends J{toJSON(){return{query:this.query,sort:this.sort}}};p([_.d(1,tt),h("design:type",tt)],Xp.prototype,"query",void 0),p([_.d(2,Xr),h("design:type",Xr)],Xp.prototype,"sort",void 0),Xp=p([C.d("QueryTindexArg")],Xp);var Co=jf=class extends Qt{toJSON(){return Object.assign({tIndexes:this.tIndexes},super.toJSON())}};p([_.d(jf.INC++,"uint32","repeated"),h("design:type",Array)],Co.prototype,"tIndexes",void 0),Co=jf=p([C.d("QueryTindexReturn")],Co);var _a=zf=class extends J{static fromObject(e){return super.fromObject(e)}toJSON(){return{tIndexRanges:this.tIndexRanges}}};_a.INC=1,p([_.d(zf.INC++,"uint32","repeated"),h("design:type",Array)],_a.prototype,"tIndexRanges",void 0),_a=zf=p([C.d("TransactionInBlockGetOptions")],_a);var Qp=class extends J{toJSON(){return{query:this.query}}};p([_.d(1,_a),h("design:type",_a)],Qp.prototype,"query",void 0),Qp=p([C.d("GetTransactionInBlockArg")],Qp);var Ro=Jf=class extends Qt{toJSON(){return Object.assign({transactionInBlocks:this.transactionInBlocks.map(e=>e.toJSON())},super.toJSON())}};p([_.d(Jf.INC++,Xt,"repeated"),h("design:type",Array)],Ro.prototype,"transactionInBlocks",void 0),Ro=Jf=p([C.d("GetTransactionInBlockReturn")],Ro);var qp=Yf=class extends ea{static fromObject(e){return super.fromObject(e)}};p([_.d(Yf.INC++,"string","optional"),h("design:type",String)],qp.prototype,"grabSecret",void 0),qp=Yf=p([C.d("NewTransactionArg")],qp);var ps=ya=class extends Qt{toJSON(){var e,t,r;const n=Object.assign({newTrsStatus:this.newTrsStatus,minFee:this.minFee},super.toJSON());return(e=this.refuseReason)!==null&&e!==void 0||(n.refuseReason=this.refuseReason),(t=this.errorCode)!==null&&t!==void 0||(n.errorCode=this.errorCode),(r=this.errorMessage)!==null&&r!==void 0||(n.errorMessage=this.errorMessage),n}};p([_.d(ya.INC++,El,"required",El.Refuse),h("design:type",Number)],ps.prototype,"newTrsStatus",void 0),p([_.d(ya.INC++,"string","required","0"),h("design:type",String)],ps.prototype,"minFee",void 0),p([_.d(ya.INC++,Ce,"optional"),h("design:type",Number)],ps.prototype,"refuseReason",void 0),p([_.d(ya.INC++,"string","optional"),h("design:type",String)],ps.prototype,"errorCode",void 0),p([_.d(ya.INC++,"string","optional"),h("design:type",String)],ps.prototype,"errorMessage",void 0),ps=ya=p([C.d("NewTransactionReturn")],ps);var hs=class extends J{toJSON(){const e={height:this.height,tIndex:this.tIndex,length:this.length};return this.blockSignature&&(e.blockSignature=this.blockSignature),e}};p([_.d(1,"uint32"),h("design:type",Number)],hs.prototype,"height",void 0),p([_.d(2,"uint32"),h("design:type",Number)],hs.prototype,"tIndex",void 0),p([_.d(3,"uint32","required",1),h("design:type",Number)],hs.prototype,"length",void 0),p([_.d(4,"string"),h("design:type",String)],hs.prototype,"blockSignature",void 0),hs=p([C.d("TransactionIndexModel")],hs);var Wp=class extends J{toJSON(){return{query:this.query.toJSON(),sort:this.sort.toJSON()}}};p([_.d(1,tt),h("design:type",tt)],Wp.prototype,"query",void 0),p([_.d(2,Xr),h("design:type",Xr)],Wp.prototype,"sort",void 0),Wp=p([C.d("IndexTransactionArg")],Wp);var Po=Xf=class extends Qt{toJSON(){return Object.assign({tIndexes:this.tIndexes.map(e=>e.toJSON())},super.toJSON())}};p([_.d(Xf.INC++,hs,"repeated"),h("design:type",Array)],Po.prototype,"tIndexes",void 0),Po=Xf=p([C.d("IndexTransactionReturn")],Po);var Zp=class extends J{toJSON(){return{tIndexes:this.tIndexes.map(e=>e.toJSON())}}};p([_.d(1,hs,"repeated"),h("design:type",Array)],Zp.prototype,"tIndexes",void 0),Zp=p([C.d("DownloadTransactionArg")],Zp);var xo=Qf=class extends Qt{toJSON(){return Object.assign({transactions:this.transactions.map(e=>e.toJSON())},super.toJSON())}};p([_.d(Qf.INC++,Xt,"repeated"),h("design:type",Array)],xo.prototype,"transactions",void 0),xo=Qf=p([C.d("DownloadTransactionReturn")],xo);var eh,th,qf,rh,mi=eh=class extends J{get hash(){return Ne(this.hashBuffer)}set hash(e){this.hashBuffer=me(e)}toJSON(){return{algorithm:this.algorithm,hash:this.hash,downloadSize:this.downloadSize}}static fromObject(e){const t=super.fromObject(e);return e.hash&&(t.hash=e.hash),t}};mi.INC=1,p([_.d(eh.INC++,"string"),h("design:type",String)],mi.prototype,"algorithm",void 0),p([_.d(eh.INC++,"bytes"),h("design:type",Uint8Array)],mi.prototype,"hashBuffer",void 0),p([_.d(eh.INC++,"int32"),h("design:type",Number)],mi.prototype,"downloadSize",void 0),mi=eh=p([C.d("OpenBlobArgModel")],mi);var _i=th=class extends Qt{toJSON(){const e=super.toJSON();return e.descriptor=this.descriptor,e.contentType=this.contentType,e}static fromObject(e){return super.fromObject(e)}};p([_.d(th.INC++,"string","optional"),h("design:type",String)],_i.prototype,"descriptor",void 0),p([_.d(th.INC++,"string","optional"),h("design:type",String)],_i.prototype,"contentType",void 0),p([_.d(th.INC++,"uint32","optional"),h("design:type",Number)],_i.prototype,"size",void 0),_i=th=p([C.d("OpenBlobReturn")],_i);var Bo=qf=class extends J{toJSON(){return{descriptor:this.descriptor}}};Bo.INC=1,p([_.d(qf.INC++,"string"),h("design:type",String)],Bo.prototype,"descriptor",void 0),Bo=qf=p([C.d("CloseBlobArg")],Bo);var nh=class extends Qt{};nh=p([C.d("CloseBlobReturn")],nh);var Hs=rh=class extends J{toJSON(){return{descriptor:this.descriptor,start:this.start,end:this.end}}};Hs.INC=1,p([_.d(rh.INC++,"string"),h("design:type",String)],Hs.prototype,"descriptor",void 0),p([_.d(rh.INC++,"uint32"),h("design:type",Number)],Hs.prototype,"start",void 0),p([_.d(rh.INC++,"uint32"),h("design:type",Number)],Hs.prototype,"end",void 0),Hs=rh=p([C.d("ReadBlobArg")],Hs);var Aa=class extends Qt{get chunk(){return Ne(this.chunkBuffer)}set chunk(e){this.chunkBuffer=me(e)}toJSON(){const e=super.toJSON();return e.chunk=this.chunk,e}static fromObject(e){const t=super.fromObject(e);return e.chunk&&(t.chunk=e.chunk),t}};Aa.INC=1,p([_.d(Hs.INC++,"bytes"),h("design:type",Uint8Array)],Aa.prototype,"chunkBuffer",void 0),Aa=p([C.d("ReadBlobReturn")],Aa);var Wf,ls,Ia=class extends J{toJSON(){const e=super.toJSON();return this.signature&&(e.signature=this.signature),this.height&&(e.height=this.height),e}};p([_.d(1,"string","optional"),h("design:type",String)],Ia.prototype,"signature",void 0),p([_.d(2,"uint32","optional"),h("design:type",Number)],Ia.prototype,"height",void 0),Ia=p([C.d("BlockQueryOptions")],Ia);var Ho=class extends J{toJSON(){return{query:this.query.toJSON()}}};p([_.d(1,Ia),h("design:type",Ia)],Ho.prototype,"query",void 0),Ho=p([C.d("QueryBlockArg")],Ho);var ko=Wf=class extends Qt{toJSON(){const e=super.toJSON();return this.someBlock&&(e.someBlock=this.someBlock.toJSON()),e}};p([_.d(Wf.INC++,pi,"optional"),h("design:type",pi)],ko.prototype,"someBlock",void 0),ko=Wf=p([C.d("QueryBlockReturn")],ko);var Fr=ls=class extends J{get generatorPublicKey(){return Ne(this.generatorPublicKeyBuffer)}set generatorPublicKey(e){this.generatorPublicKeyBuffer=me(e)}toJSON(){return{height:this.height,signature:this.signature,previousBlockSignature:this.previousBlockSignature,timestamp:this.timestamp,totalFee:this.totalFee,numberOfTransactions:this.numberOfTransactions,generatorPublicKey:this.generatorPublicKey,version:this.version}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.generatorPublicKey&&(t.generatorPublicKey=e.generatorPublicKey),t}};Fr.INC=1,p([_.d(ls.INC++,"uint32"),h("design:type",Number)],Fr.prototype,"height",void 0),p([_.d(ls.INC++,"string"),h("design:type",String)],Fr.prototype,"signature",void 0),p([_.d(ls.INC++,"string"),h("design:type",String)],Fr.prototype,"previousBlockSignature",void 0),p([_.d(ls.INC++,"uint32"),h("design:type",Number)],Fr.prototype,"timestamp",void 0),p([_.d(ls.INC++,"string"),h("design:type",String)],Fr.prototype,"totalFee",void 0),p([_.d(ls.INC++,"uint32"),h("design:type",Number)],Fr.prototype,"numberOfTransactions",void 0),p([_.d(ls.INC++,"bytes"),h("design:type",Uint8Array)],Fr.prototype,"generatorPublicKeyBuffer",void 0),p([_.d(ls.INC++,"uint32"),h("design:type",Number)],Fr.prototype,"version",void 0),Fr=ls=p([C.d("NewBlockArg")],Fr);var Lo=class extends Qt{};Lo=p([C.d("NewBlockReturn")],Lo);var Qr,Ai,ks,Zf,Y_=new WeakMap,ed=new WeakMap,sh=class extends J{toJSON(){return{uid:this.uid}}};p([_.d(1,"uint32","optional"),h("design:type",Number)],sh.prototype,"uid",void 0),sh=p([C.d("GetPeerInfoArg")],sh);var ih=class extends J{get peerTime(){return this.peerTimeLong.toNumber()}set peerTime(e){this.peerTimeLong=hc.fromNumber(e,!0)}toJSON(){return{peerTime:this.peerTime}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.peerTime!==void 0&&(t.peerTime=e.peerTime),t}};p([_.d(1,"uint64"),h("design:type",Object)],ih.prototype,"peerTimeLong",void 0),ih=p([C.d("PeerConsensus")],ih);var or=Qr=class extends J{get servicePeerInfo(){return{peerInfoDelay:this.peerInfoDelay,onlineUser:this.onlineUser,productivity:this.productivity,paidSourceChainMagic:this.paidSourceChainMagic,paidsourceChainName:this.paidsourceChainName,paidAssetType:this.paidAssetType,paidAmount:this.paidAmount,paidType:this.paidType,serviceNotesName:this.serviceNotesName,noteIP:this.noteIP,dappOnChainBuy:this.dappOnChainBuy}}set servicePeerInfo(e){this.peerInfoDelay=e.peerInfoDelay,this.onlineUser=e.onlineUser,this.productivity=e.productivity,this.paidSourceChainMagic=e.paidSourceChainMagic,this.paidsourceChainName=e.paidsourceChainName,this.paidAssetType=e.paidAssetType,this.paidAmount=e.paidAmount,this.paidType=e.paidType,this.serviceNotesName=e.serviceNotesName,this.noteIP=e.noteIP,this.dappOnChainBuy=e.dappOnChainBuy}toJSON(){return{peerInfoDelay:this.peerInfoDelay,onlineUser:this.onlineUser,productivity:this.productivity,paidSourceChainMagic:this.paidSourceChainMagic,paidsourceChainName:this.paidsourceChainName,paidAssetType:this.paidAssetType,paidAmount:this.paidAmount,paidType:this.paidType,serviceNotesName:this.serviceNotesName,noteIP:this.noteIP,dappOnChainBuy:this.dappOnChainBuy}}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.peerInfoDelay&&(t.peerInfoDelay=e.peerInfoDelay),e.onlineUser&&(t.onlineUser=e.onlineUser),e.productivity&&(t.productivity=e.productivity),e.paidSourceChainMagic&&(t.paidSourceChainMagic=e.paidSourceChainMagic),e.paidsourceChainName&&(t.paidsourceChainName=e.paidsourceChainName),e.paidAmount&&(t.paidAmount=e.paidAmount),e.paidType&&(t.paidType=e.paidType),e.serviceNotesName&&(t.serviceNotesName=e.serviceNotesName),e.noteIP&&(t.noteIP=e.noteIP),e.dappOnChainBuy&&(t.dappOnChainBuy=e.dappOnChainBuy)),t}};or.INC=1,p([_.d(Qr.INC++,"uint32"),h("design:type",Number)],or.prototype,"peerInfoDelay",void 0),p([_.d(Qr.INC++,"uint32"),h("design:type",Number)],or.prototype,"onlineUser",void 0),p([_.d(Qr.INC++,"uint32"),h("design:type",Number)],or.prototype,"productivity",void 0),p([_.d(Qr.INC++,"string"),h("design:type",String)],or.prototype,"paidSourceChainMagic",void 0),p([_.d(Qr.INC++,"string"),h("design:type",String)],or.prototype,"paidsourceChainName",void 0),p([_.d(Qr.INC++,"string"),h("design:type",String)],or.prototype,"paidAssetType",void 0),p([_.d(Qr.INC++,"string"),h("design:type",String)],or.prototype,"paidAmount",void 0),p([_.d(Qr.INC++,"string"),h("design:type",String)],or.prototype,"paidType",void 0),p([_.d(Qr.INC++,"string"),h("design:type",String)],or.prototype,"serviceNotesName",void 0),p([_.d(Qr.INC++,"string"),h("design:type",String)],or.prototype,"noteIP",void 0),p([_.d(Qr.INC++,"bool"),h("design:type",Boolean)],or.prototype,"dappOnChainBuy",void 0),or=Qr=p([C.d("ServicePeerInfo")],or);var Mn=Ai=class extends J{get progress(){const{status:e}=this;return e===Yr.REBUIDING?{status:e,progressEvent:this.rebuildingProgressEvent}:e===Yr.PEER_SCANNING?{status:e,progressEvent:this.peerScanningProgressEvent}:e===Yr.REPLAY_BLOCK?{status:e,progressEvent:this.replayBlockProgressEvent}:e===Yr.GENERATING?{status:e,progressEvent:this.generatingProgressEvent}:e===Yr.ROLLBACK?{status:e,progressEvent:this.rollbackProgressEvent}:{status:e,progressEvent:void 0}}get progressEvent(){return this._progressEvent}set progressEvent(e){e&&(e instanceof Bs?this.rebuildingProgressEvent=e:e instanceof wo?this.peerScanningProgressEvent=e:e instanceof yi?this.replayBlockProgressEvent=e:e instanceof Oo?this.generatingProgressEvent=e:e instanceof No&&(this.rollbackProgressEvent=e))}get status(){return this._status}set status(e){e!==this._status&&(this._status=e,this._clearProgressEvent(),e===Yr.REBUIDING?this.rebuildingProgressEvent=Bs.fromObject({mode:fi.DETERMINATE}):e===Yr.PEER_SCANNING?this.peerScanningProgressEvent=wo.fromObject({mode:fi.BUFFER}):e===Yr.REPLAY_BLOCK?this.replayBlockProgressEvent=yi.fromObject({mode:fi.BUFFER}):e===Yr.GENERATING?this.generatingProgressEvent=Oo.fromObject({mode:fi.QUERY}):e===Yr.ROLLBACK&&(this.rollbackProgressEvent=No.fromObject({mode:fi.BUFFER})))}_clearProgressEvent(){this.rebuildingProgressEvent=void 0,this.peerScanningProgressEvent=void 0,this.replayBlockProgressEvent=void 0,this.generatingProgressEvent=void 0,this.rollbackProgressEvent=void 0}toJSON(){return this.progress}};Mn.INC=1,p([_.d(Ai.INC++,Bs,"optional"),h("design:type",Bs)],Mn.prototype,"rebuildingProgressEvent",void 0),p([_.d(Ai.INC++,wo,"optional"),h("design:type",wo)],Mn.prototype,"peerScanningProgressEvent",void 0),p([_.d(Ai.INC++,yi,"optional"),h("design:type",yi)],Mn.prototype,"replayBlockProgressEvent",void 0),p([_.d(Ai.INC++,Oo,"optional"),h("design:type",Oo)],Mn.prototype,"generatingProgressEvent",void 0),p([_.d(Ai.INC++,No,"optional"),h("design:type",No)],Mn.prototype,"rollbackProgressEvent",void 0),p([_.d(Ai.INC++,Yr),h("design:type",Number)],Mn.prototype,"_status",void 0),Mn=Ai=p([C.d("BlockchainStatus")],Mn);var qr=ks=class extends J{constructor(){super(...arguments),this._parsed_serviceInfo=!1}get serviceInfo(){return!this._parsed_serviceInfo&&typeof this.serviceInfoJSON=="string"&&(this._parsed_serviceInfo=!0,this._serviceInfo=JSON.parse(this.serviceInfoJSON)),this._serviceInfo}set serviceInfo(e){this.serviceInfoJSON=(this._serviceInfo=e)?JSON.stringify(e):void 0,this._parsed_serviceInfo=!0}get servicePeerInfo(){const{servicePeerInfoBufferList:e}=this;let t=Y_.get(e);return t||(t=this.servicePeerInfoBufferList.map(r=>{const n=or.decode(r);return ed.set(n,r),n})),t}set servicePeerInfo(e){const t=e.map(r=>{let n=ed.get(r);return n||(n=or.encode(r).finish(),ed.set(r,n)),n});Y_.set(t,e),this.servicePeerInfoBufferList=t}toJSON(){return{uid:this.uid,height:this.height,blockchainStatus:this.blockchainStatus.toJSON(),serviceInfo:this.serviceInfo,servicePeerInfo:this.servicePeerInfo.map(e=>e.toJSON()),peerConsensus:this.peerConsensus.toJSON(),peerLinkCount:this.peerLinkCount}}static fromObject(e){const t=super.fromObject(e);if(t!==e){const r=[];if(e.servicePeerInfo){const n=e.servicePeerInfo;for(const s of n)r[r.length]=or.fromObject(s)}t.servicePeerInfo=r}return t}};qr.INC=1,p([_.d(ks.INC++,"uint32"),h("design:type",Number)],qr.prototype,"uid",void 0),p([_.d(ks.INC++,"uint32"),h("design:type",Number)],qr.prototype,"height",void 0),p([_.d(ks.INC++,Mn),h("design:type",Mn)],qr.prototype,"blockchainStatus",void 0),p([_.d(ks.INC++,"string","optional"),h("design:type",String)],qr.prototype,"serviceInfoJSON",void 0),p([_.d(ks.INC++,"bytes","repeated"),h("design:type",Array)],qr.prototype,"servicePeerInfoBufferList",void 0),p([_.d(ks.INC++,ih),h("design:type",ih)],qr.prototype,"peerConsensus",void 0),p([_.d(ks.INC++,"uint32"),h("design:type",Number)],qr.prototype,"peerLinkCount",void 0),qr=ks=p([C.d("PeerInfo")],qr);var Mo=Zf=class extends Qt{toJSON(){const e=super.toJSON();return this.peerInfo&&(e.peerInfo=this.peerInfo.toJSON()),e}};p([_.d(Zf.INC++,qr,"optional"),h("design:type",qr)],Mo.prototype,"peerInfo",void 0),Mo=Zf=p([C.d("GetPeerInfoReturn")],Mo);var Ls,Wr=Ls=class extends J{};Wr.INC=1,p([_.d(Ls.INC++,"uint32"),h("design:type",Number)],Wr.prototype,"version",void 0),p([_.d(Ls.INC++,"uint32"),h("design:type",Number)],Wr.prototype,"req_id",void 0),p([_.d(Ls.INC++,Ae),h("design:type",Number)],Wr.prototype,"cmd",void 0),p([_.d(Ls.INC++,"bytes"),h("design:type",Uint8Array)],Wr.prototype,"binary",void 0),p([_.d(Ls.INC++,"uint32"),h("design:type",Number)],Wr.prototype,"lockTimespan",void 0),p([_.d(Ls.INC++,"uint32"),h("design:type",Number)],Wr.prototype,"refuseTimespan",void 0),p([_.d(Ls.INC++,"uint32"),h("design:type",Number)],Wr.prototype,"messageVersion",void 0),Wr=Ls=p([C.d("ChainChannelMessageModel")],Wr);var Sl;(function(e){e[e.TESTNET=0]="TESTNET",e[e.MAINNET=1]="MAINNET"})(Sl||(Sl={}));var re=class{constructor(e,t){this.genesisBlock=e,this.business=t,this.events=new mn,this._hookBlockMap=new Map,this._hookBlockMap.set(e.version,e),this.hookedGenesisBlock=this.genesisBlock}_applyHookGenesisBlock(){const e=[...this._hookBlockMap].sort((t,r)=>t[0]-r[0]);this.hookedGenesisBlock=BT(this.genesisBlock,...e.map(t=>({...t[1],version:t[0]}))),iE(this),this.events.emit("hookGenesisBlockApply",this.toJSON())}setHookGenesisBlock(e,t){this._hookBlockMap.set(e,t),this._applyHookGenesisBlock()}getHookGenesisBlock(e){return this._hookBlockMap.get(e)}rollBackHookGenesisBlock(e){this._hookBlockMap.delete(e)&&this._applyHookGenesisBlock()}get version(){return this.hookedGenesisBlock.version}get miniUnit(){return"1"}get netType(){return this.initials==="b"?Sl.MAINNET:Sl.TESTNET}get initials(){return this.bnid}get genesisAccountPublicKey(){return this.hookedGenesisBlock.generatorPublicKey}get chainName(){return this.hookedGenesisBlock.asset.genesisAsset.chainName}get assetType(){return this.hookedGenesisBlock.asset.genesisAsset.assetType}get magic(){return this.hookedGenesisBlock.asset.genesisAsset.magic}get bnid(){return this.hookedGenesisBlock.asset.genesisAsset.bnid}get beginEpochTime(){return this.hookedGenesisBlock.asset.genesisAsset.beginEpochTime}get genesisLocationName(){return this.hookedGenesisBlock.asset.genesisAsset.genesisLocationName}get genesisAmount(){return this.hookedGenesisBlock.asset.genesisAsset.genesisAmount}get maxSupply(){return this.hookedGenesisBlock.asset.genesisAsset.maxSupply}get minTransactionFeePerByte(){return this.hookedGenesisBlock.asset.genesisAsset.minTransactionFeePerByte}get maxTransactionSize(){return this.hookedGenesisBlock.asset.genesisAsset.maxTransactionSize}get maxTransactionBlobSize(){return this.hookedGenesisBlock.asset.genesisAsset.maxTransactionBlobSize}get maxBlockSize(){return this.hookedGenesisBlock.asset.genesisAsset.maxBlockSize}get maxBlockBlobSize(){return this.hookedGenesisBlock.asset.genesisAsset.maxBlockBlobSize}get maxTPSPerBlock(){return this.hookedGenesisBlock.asset.genesisAsset.maxTPSPerBlock}get consessusBeforeSyncBlockDiff(){return this.hookedGenesisBlock.asset.genesisAsset.consessusBeforeSyncBlockDiff}get maxGrabTimesOfGiftAsset(){return this.hookedGenesisBlock.asset.genesisAsset.maxGrabTimesOfGiftAsset}get issueAssetMinChainAsset(){return this.magic==="RRJJO"?"100000000000":this.hookedGenesisBlock.asset.genesisAsset.issueAssetMinChainAsset}get maxMultipleOfAssetAndMainAsset(){return this.magic==="RRJJO"?{numerator:"1000000",denominator:"1"}:this.hookedGenesisBlock.asset.genesisAsset.maxMultipleOfAssetAndMainAsset}get issueEntityFactoryMinChainAsset(){return this.hookedGenesisBlock.asset.genesisAsset.issueEntityFactoryMinChainAsset}get maxMultipleOfEntityAndMainAsset(){return this.hookedGenesisBlock.asset.genesisAsset.maxMultipleOfEntityAndMainAsset}get registerChainMinChainAsset(){return this.hookedGenesisBlock.asset.genesisAsset.registerChainMinChainAsset}get maxApplyAndConfirmedBlockHeightDiff(){return this.hookedGenesisBlock.asset.genesisAsset.maxApplyAndConfirmedBlockHeightDiff}get blockPerRound(){return this.hookedGenesisBlock.asset.genesisAsset.blockPerRound}get whetherToAllowGeneratorContinusElections(){return this.hookedGenesisBlock.asset.genesisAsset.whetherToAllowGeneratorContinusElections}get forgeInterval(){return this.hookedGenesisBlock.asset.genesisAsset.forgeInterval}get basicRewards(){return this.hookedGenesisBlock.asset.genesisAsset.basicRewards}get ports(){return this.hookedGenesisBlock.asset.genesisAsset.ports}get generatorPublicKey(){return this.hookedGenesisBlock.generatorPublicKey}get signature(){return this.hookedGenesisBlock.signature}get nextRoundGenerators(){return this.hookedGenesisBlock.asset.genesisAsset.nextRoundGenerators}get blobFeeMultipleRatio(){return{numerator:BigInt(this.genesisAmount),denominator:BigInt(31456e11)}}toJSON(){return{version:this.version,miniUnit:this.miniUnit,chainName:this.chainName,assetType:this.assetType,magic:this.magic,bnid:this.bnid,beginEpochTime:this.beginEpochTime,genesisLocationName:this.genesisLocationName,genesisAmount:this.genesisAmount,maxSupply:this.maxSupply,minTransactionFeePerByte:this.minTransactionFeePerByte,maxTransactionSize:this.maxTransactionSize,maxTransactionBlobSize:this.maxTransactionBlobSize,maxBlockSize:this.maxBlockSize,maxBlockBlobSize:this.maxBlockBlobSize,maxTPSPerBlock:this.maxTPSPerBlock,consessusBeforeSyncBlockDiff:this.consessusBeforeSyncBlockDiff,maxGrabTimesOfGiftAsset:this.maxGrabTimesOfGiftAsset,issueAssetMinChainAsset:this.issueAssetMinChainAsset,maxMultipleOfAssetAndMainAsset:this.maxMultipleOfAssetAndMainAsset,issueEntityFactoryMinChainAsset:this.issueEntityFactoryMinChainAsset,maxMultipleOfEntityAndMainAsset:this.maxMultipleOfEntityAndMainAsset,registerChainMinChainAsset:this.registerChainMinChainAsset,maxApplyAndConfirmedBlockHeightDiff:this.maxApplyAndConfirmedBlockHeightDiff,blockPerRound:this.blockPerRound,whetherToAllowGeneratorContinusElections:this.whetherToAllowGeneratorContinusElections,forgeInterval:this.forgeInterval,basicRewards:this.basicRewards,ports:this.ports}}};p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"version",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"miniUnit",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"netType",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"genesisAccountPublicKey",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"chainName",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"assetType",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"magic",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"bnid",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"beginEpochTime",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"genesisLocationName",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"genesisAmount",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"maxSupply",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"minTransactionFeePerByte",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"maxTransactionSize",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"maxTransactionBlobSize",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"maxBlockSize",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"maxBlockBlobSize",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"maxTPSPerBlock",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"consessusBeforeSyncBlockDiff",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"maxGrabTimesOfGiftAsset",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"issueAssetMinChainAsset",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"maxMultipleOfAssetAndMainAsset",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"issueEntityFactoryMinChainAsset",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"maxMultipleOfEntityAndMainAsset",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"registerChainMinChainAsset",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"maxApplyAndConfirmedBlockHeightDiff",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"blockPerRound",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"whetherToAllowGeneratorContinusElections",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"forgeInterval",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"basicRewards",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"ports",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"generatorPublicKey",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"signature",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],re.prototype,"nextRoundGenerators",null),re=p([j("config"),h("design:paramtypes",[Object,String])],re);var yr=class{constructor(){this._map=new Map}get clear(){return this._map.clear.bind(this._map)}get delete(){return this._map.delete.bind(this._map)}get forEach(){return this._map.forEach.bind(this._map)}get get(){return this._map.get.bind(this._map)}get has(){return this._map.has.bind(this._map)}get set(){return this._map.set.bind(this._map)}get size(){return this._map.size}get[Symbol.iterator](){return this._map[Symbol.iterator].bind(this._map)}get entries(){return this._map.entries.bind(this._map)}get keys(){return this._map.keys.bind(this._map)}get values(){return this._map.values.bind(this._map)}get[Symbol.toStringTag](){return"EasyMap"}};p([ie,h("design:type",Object),h("design:paramtypes",[])],yr.prototype,"delete",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],yr.prototype,"forEach",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],yr.prototype,"get",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],yr.prototype,"has",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],yr.prototype,"set",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],yr.prototype,Symbol.iterator,null),p([ie,h("design:type",Object),h("design:paramtypes",[])],yr.prototype,"entries",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],yr.prototype,"keys",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],yr.prototype,"values",null),yr=p([j("configMap")],yr);var xt=class extends _l{getTimestamp(e=this.now()){return Math.floor((e-this.config.beginEpochTime)/1e3)}getTimeByTimestamp(e){return e*1e3+this.config.beginEpochTime}get beginEpochTime(){return new Date(this.config.beginEpochTime)}getSlotNumberByTimestamp(e=this.getTimestamp()){return Math.floor(e/this.config.forgeInterval)}getNextSlotNumberByTimestamp(e=this.getTimestamp()){return this.getSlotNumberByTimestamp(e)+1}getTimestampBySlotNumber(e){return e*this.config.forgeInterval}formatTimestamp(e=this.getTimestamp()){return this.formatDateTime(e*1e3+this.config.beginEpochTime)}};p([k(re),h("design:type",re)],xt.prototype,"config",void 0),p([ie,h("design:type",Object),h("design:paramtypes",[])],xt.prototype,"beginEpochTime",null);var{ArgumentIllegalException:iS}=Z("HELPER","jsbiHelper");function mr(e){try{if(typeof e=="string"){if(/^[0-9-]*$/.test(e)===!1)throw new Error("QAQ");e=parseInt(e)}else if(typeof e=="number")e=Math.floor(e);else return e;return BigInt(e)}catch{throw new iS(a.PROP_IS_INVALID,{prop:`param ${e}`,target:"fraction"})}}var St=class{multiplyFloor(e,t){return this.multiplyFloorFraction(e,this.numberToFraction(t))}floorFraction(e){const t=mr(e.numerator),r=mr(e.denominator);return t/r}ceilFraction(e){const t=mr(e.numerator),r=mr(e.denominator),n=t/r;return n*r===t?n:n+BigInt(1)}multiplyFraction(e,t){const r=BigInt(e.numerator),n=BigInt(e.denominator),s=BigInt(t.numerator),i=BigInt(t.denominator);return{numerator:r*s,denominator:n*i}}multiplyFractionAndFloor(e,t){return this.floorFraction(this.multiplyFraction(e,t))}multiplyFractionAndCeil(e,t){return this.ceilFraction(this.multiplyFraction(e,t))}multiplyFloorFraction(e,t){const r=mr(e),n=BigInt(t.numerator),s=BigInt(t.denominator);return r*n/s}multiplyFloorFractionString(e,t){const r=mr(e),n=BigInt(t.numerator),s=BigInt(t.denominator);return r*n/s}multiplyRound(e,t){return this.multiplyRoundFraction(e,this.numberToFraction(t))}multiplyRoundFraction(e,t){const r=this.multiplyFloorFraction(e,{numerator:BigInt(t.numerator)*BigInt(10),denominator:BigInt(t.denominator)}),n=r/BigInt(10);return r%BigInt(10)>=BigInt(5)?n+BigInt(1):n}numberToFraction(e){const t=e.toFixed(45).split("."),r=t.length>1?t[1].length:0,n=1+"0".repeat(r);return{numerator:t.join(""),denominator:n}}multiplyCeil(e,t){return this.multiplyCeilFraction(e,this.numberToFraction(t))}multiplyCeilFraction(e,t){const r=mr(e),n=BigInt(t.numerator),s=BigInt(t.denominator),i=r*n,o=i/s;return o*s===i?o:o+BigInt(1)}divisionCeilFraction(e,t){const r=mr(e),n=BigInt(t.numerator),s=BigInt(t.denominator),i=r*s,o=i/n;return o*n===i?o:o+BigInt(1)}divisionFraction(e,t){const r=BigInt(e.numerator),n=BigInt(e.denominator),s=BigInt(t.numerator),i=BigInt(t.denominator);return{numerator:r*i,denominator:n*s}}divisionFractionAndFloor(e,t){return this.floorFraction(this.divisionFraction(e,t))}divisionFractionAndCeil(e,t){return this.ceilFraction(this.divisionFraction(e,t))}compareFraction(e,t){const r=mr(e.numerator),n=mr(e.denominator),s=mr(t.numerator),i=mr(t.denominator),o=r*i,c=s*n;return o===c?0:o>c?1:-1}greatestCommonDivisor(e,t){return t===BigInt(0)?e:this.greatestCommonDivisor(t,e%t)}toFraction(e){if(e.includes(".")){const t=e.split(".");let r=BigInt(t[0]+t[1]),n=BigInt("1"+"0".repeat(t[1].length));const s=this.greatestCommonDivisor(r,n);return{numerator:(r/s).toString(),denominator:(n/s).toString()}}else return{numerator:e,denominator:"1"}}minusFraction(e,t){const r=mr(e.numerator),n=mr(e.denominator),s=mr(t.numerator),i=mr(t.denominator),o=n*i,c=r*i-s*n,l=this.greatestCommonDivisor(c,o);return{numerator:(c/l).toString(),denominator:(o/l).toString()}}};St=p([j()],St);var _r=class{constructor(e,t,r){this.cryptoHelper=e,this.keypairHelper=t,this.ed2curveHelper=r}async detachedSign(e,t){const r=await this.cryptoHelper.sha256(e);return this.keypairHelper.detached_sign(r,t)}async detachedVeriy(e,t,r){const n=await this.cryptoHelper.sha256(e);return this.keypairHelper.detached_verify(n,t,r)}async signToString(e,t,r="hex"){return(await this.detachedSign(e,t)).toString(r)}async asymmetricEncrypt(e,t,r){const n=await this.ed2curveHelper.convertPublicKey(t);if(!n)throw new Error("decryptPK convertPublicKey fail");const s=await this.ed2curveHelper.convertSecretKey(r);return this.keypairHelper.box(e,n,s)}async asymmetricDecrypt(e,t,r,n=new Uint8Array(24)){const s=await this.ed2curveHelper.convertPublicKey(t);if(!s)throw new Error("decryptPK convertPublicKey fail");const i=await this.ed2curveHelper.convertSecretKey(r);return await this.keypairHelper.open(e,n,s,i)}};_r=p([j("asymmetricHelper"),Se(0,k("cryptoHelper")),Se(1,k("keypairHelper")),Se(2,k("ed2curveHelper")),h("design:paramtypes",[Object,Object,Object])],_r);var bl=class{calcParityBit(e){let t=0;for(let r=0;r<e.length;r++)t+=e.charCodeAt(r);return t%36}shuffle(e){let t=e.length;for(;t;){const r=Math.floor(Math.random()*t--);[e[r],e[t]]=[e[t],e[r]]}return e}__getRandomString(e){const t=[];for(let s=0;s<10;s++)t[t.length]=s;for(let s=65;s<91;s++)t[t.length]=String.fromCharCode(s);const r=this.shuffle(t);let n="";for(let s=0;s<e;s++)n+=r[Math.floor(Math.random()*e)];return n}__addParityBit(e){const t=`P_${this.calcParityBit(e)}`;return e+Hi[t]}createMagic(e){if(e){if(typeof e!="string")throw new Error(`Not a valid magic ${e}`);if(!new RegExp("^[A-Z0-9]{4}$").test(e))throw new Error(`Not a valid magic ${e}`)}else e=this.__getRandomString(4);return this.__addParityBit(e)}createDAppId(e){if(e){if(typeof e!="string")throw new Error(`Not a valid dappid ${e}`);if(!new RegExp("^[A-Z0-9]{7}$").test(e))throw new Error(`Not a valid dappid ${e}`)}else e=this.__getRandomString(7);return this.__addParityBit(e)}};bl=p([j()],bl);var aS="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",oS=class{constructor(e=aS){this.ALPHABET=e,this.BASE=this.ALPHABET.length,this.ALPHABET_MAP={},this.LEADER=this.ALPHABET.charAt(0);for(let t=0;t<e.length;t++){const r=e.charAt(t);if(this.ALPHABET_MAP[r]!==void 0)throw new TypeError(r+" is ambiguous");this.ALPHABET_MAP[r]=t}}encode(e){if(e.length===0)return"";const t=[0];for(let n=0;n<e.length;++n){let s=e[n];for(let i=0;i<t.length;++i)s+=t[i]<<8,t[i]=s%this.BASE,s=s/this.BASE|0;for(;s>0;)t.push(s%this.BASE),s=s/this.BASE|0}let r="";for(let n=0;e[n]===0&&n<e.length-1;++n)r+=this.ALPHABET[0];for(let n=t.length-1;n>=0;--n)r+=this.ALPHABET[t[n]];return r}decodeUnsafe(e){if(e.length===0)return new Uint8Array;const t=[0];for(let r=0;r<e.length;r++){let n=this.ALPHABET_MAP[e[r]];if(n===void 0)return;let s=n;for(let i=0;i<t.length;++i)s+=t[i]*this.BASE,t[i]=s&255,s>>=8;for(;s>0;)t.push(s&255),s>>=8}for(let r=0;e[r]===this.LEADER&&r<e.length-1;++r)t.push(0);return new Uint8Array(t).reverse()}decode(e){const t=this.decodeUnsafe(e);if(t)return t;throw new Error("Non-base"+this.BASE+" character")}},cS=new oS,wl=class{constructor(e,t){this.cryptoHelper=e,this.Buffer=t,this.bs58=cS}async sha256x2(e){const t=await this.cryptoHelper.sha256(e);return this.cryptoHelper.sha256(t)}async encode(e){return this.bs58.encode(this.Buffer.concat([e,await this.sha256x2(e)],e.length+4))}async decodeRaw(e){let t=e.slice(0,-4),r=e.slice(-4),n=await this.sha256x2(t);if(!(r[0]^n[0]|r[1]^n[1]|r[2]^n[2]|r[3]^n[3]))return this.Buffer.from(t)}async decodeUnsafe(e){let t=await this.bs58.decodeUnsafe(e);if(t)return this.decodeRaw(t)}async decode(e){let t=this.bs58.decode(e),r=await this.decodeRaw(t);if(!r)throw new Error("Invalid checksum");return r}};wl=p([j(),Se(0,k("cryptoHelper")),Se(1,k("Buffer")),h("design:paramtypes",[Object,Object])],wl);var X_=new WeakMap,de=class{constructor(e,t,r,n,s){this.cryptoHelper=e,this.keypairHelperInterface=t,this.Buffer=r,this.base58Helper=n,this.config=s}get _prefix(){return this.config.initials}checkSecret(e){if(/^\s|\s$/.test(e))throw new SyntaxError("Main Secret cannot contain spaces at the beginning or end");if(/[\cA-\cZ]/.test(e))throw new SyntaxError("Main Secret cannot contain Special Characters");return!0}async createSecretKeypair(e){return await this.keypairHelperInterface.create(await this.cryptoHelper.sha256(UT(e)))}async getPublicKeyFromSecret(e){return(await this.createSecretKeypair(e)).publicKey}async getPublicKeyStringFromSecret(e,t="hex"){return(await this.getPublicKeyFromSecret(e)).toString(t)}async getBinaryAddressFromPublicKey(e){const t=X_.get(e);if(t)return t;const r=await this.cryptoHelper.sha256(e),n=await this.cryptoHelper.ripemd160(r);return X_.set(e,n),n}async getAddressFromPublicKey(e,t=this._prefix){return t+await this.base58Helper.encode(await this.getBinaryAddressFromPublicKey(e))}getAddressFromPublicKeyString(e,t){return this.getAddressFromPublicKey(xm(e),t)}async getAddressFromSecret(e,t){return this.getAddressFromPublicKey(await this.getPublicKeyFromSecret(e),t)}async isAddress(e){return typeof e!="string"||/^[0-9]{1,20}$/g.test(e)?!1:!(e[0]!==this._prefix||!await this.base58Helper.decodeUnsafe(e.slice(1)))}async createSecondSecretKeypair(e,t){return this.createSecretKeypair(`${e}-${t}`)}async getPublicKeyFromSecondSecret(e,t){return(await this.createSecondSecretKeypair(e,t)).publicKey}async getPublicKeyStringFromSecondSecret(e,t,r="hex"){return(await this.getPublicKeyFromSecondSecret(e,t)).toString(r)}async checkSecondSecret(e,t,r){return await this.getPublicKeyStringFromSecondSecret(e,t)===r}};de=p([j(),Se(0,k("cryptoHelper")),Se(1,k("keypairHelper")),Se(2,k("Buffer")),h("design:paramtypes",[Object,Object,Object,wl,re])],de);var Re=class{constructor(e,t,r,n,s){this.accountBaseHelper=e,this.configHelper=t,this.ipHelper=r,this.parityBitHelper=n,this.jsbiHelper=s,this.MAX_UINT_32_INTEGER=2**32,this.MAX_INT_32_INTEGER=2**31-1,this.MIN_INT_32_INTEGER=-2147483648,this.isValidSecondPublicKey=this.isValidPublicKey,this.isValidAssetNumber=this.isStringNumber,this.isValidAccountEquity=this.isStringNumber,this.isValidBlockParticipation=this.isStringNumber,this.isValidEquityRate=this.isStringNumber,this.isValidAssetPrealnum=this.isStringNumber}isIp(e){return this.ipHelper.isIp(e)}isIpV4(e){return this.ipHelper.isIpV4(e)}isIpV6(e){return this.ipHelper.isIpV6(e)}isLongitude(e){return/^[\-\+]((0(\.\d{1,10})?)|(([1,9](\d)?)(\.\d{1,10})?)|(1[0-7]\d{1}(\.\d{1,10})?)|(180(\.0{1,10})?))$/.test(e)}isLatitude(e){return/^[\-\+]((0(\.\d{1,10})?)|([1,9](\.\d{1,10})?)|([1-8]\d?(\.\d{1,10})?)|(90(\.0{1,10})?))$/.test(e)}isDNS(e){return/^(?=^.{3,255}$)[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/.test(e)}isEmail(e){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)?["qq.com","163.com","vip.163.com","263.net","yeah.net","sohu.com","sina.cn","sina.com","eyou.com","gmail.com","hotmail.com","42du.cn"].includes(e.substring(e.indexOf("@")+1)):!1}async isValidLocationNameRecord(e){if(!this.isObject(e))return!1;const{recordType:t,recordValue:r}=e;if(t===void 0||r===void 0||!this.isString(r))return!1;if(t===0)return!0;if(t===1)return this.isIpV4(r);if(t===2)return this.isIpV6(r);if(t===3){const n=r.split(",");return n.length!==2?!1:this.isLongitude(n[0])&&this.isLatitude(n[1])}return t===4?await this.accountBaseHelper.isAddress(r):t===5?this.isValidLocationName(r):t===6?this.isDNS(r):t===8?this.isEmail(r):t===7?this.isURL(r):!1}async isValidRange(e,t){if(e!==0&&e!==1&&e!==2&&e!==4||!this.isArray(t))return!1;if(e===0){if(t.length!==0)return!1}else{if(t.length===0)return!1;switch(e){case 1:for(const r of t)if(!await this.accountBaseHelper.isAddress(r))return!1;break;case 2:for(const r of t)if(!this.isValidDAppId(r))return!1;break;case 4:for(const r of t)if(!this.isValidLocationName(r))return!1;break;default:return!1}}return!0}isValidCipherPublicKeys(e){if(!this.isArray(e))return!1;for(const t of e)if(!this.isValidPublicKey(t))return!1;return!0}isValidAccountSignature(e){if(!e||!this.isObject(e))return!1;const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;return!(!(this.isValidPublicKey(t)&&this.isValidSignature(r))||n&&!s||!n&&s||n&&s&&!(this.isValidPublicKey(n)&&this.isValidSignature(s)))}getVariableType(e){return Object.prototype.toString.call(e)}isBoolean(e){return typeof e=="boolean"}isNaturalNumber(e){return Number.isInteger(e)&&e>=0}isUint32(e){return this.isNaturalNumber(e)&&e<this.MAX_UINT_32_INTEGER}isInt32(e){return Number.isInteger(e)&&e<this.MAX_INT_32_INTEGER&&e>this.MIN_INT_32_INTEGER}isNoEmptyUint8Array(e){return e instanceof Uint8Array&&e.length>0}isPositiveInteger(e){return Number.isInteger(e)&&e>0}isPositiveFloatMatchCondition(e,t){let r=e;if(e&&typeof e.denominator=="number"&&typeof e.numerator=="number"){if(e.denominator===0)return!1;r=e.numerator/e.denominator}return Number.isNaN(r)?!1:t(r)}isPositiveFloatContainZero(e){return this.isPositiveFloatMatchCondition(e,t=>t>=0)}isPositiveFloatNotContainZero(e){return this.isPositiveFloatMatchCondition(e,t=>t>0)}isPositiveBigFloatMatchCondition(e,t,r=32){if(!(e&&typeof e.denominator=="string"&&typeof e.numerator=="string"))return!1;const{numerator:n,denominator:s}=e;return this.isStringNumber(n)===!1||n.length>r||this.isPositiveStringNumber(s)===!1||s.length>r?!1:t(e)}isPositiveBigFloatContainZero(e,t=32){return this.isPositiveBigFloatMatchCondition(e,r=>this.jsbiHelper.compareFraction(r,{numerator:0,denominator:888})>=0,t)}isPositiveBigFloatNotContainZero(e,t=32){return this.isPositiveBigFloatMatchCondition(e,r=>this.jsbiHelper.compareFraction(r,{numerator:0,denominator:888})>0,t)}isFraction(e){if(typeof e!="object"||e===null||!(e.numerator&&e.denominator))return!1;try{const t=BigInt(e.denominator),r=BigInt(0);if(t===r)return!1}catch{return!1}return!0}isFiniteBigInt(e){try{return BigInt(e),!0}catch{return!1}}isEmptyObject(e){if(!this.isObject(e))return!1;let t;for(t in e)return!1;return!0}isArrayEqual(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}isValidBufferSize(e,t){if(e instanceof Uint8Array)return e.length===t;if(this.isString(e)&&e.length===t*2)for(let r=0;r<e.length;r+=1){let n=e[r];return n>="0"&&n<="f"}return!1}isValidPublicKey(e){return this.isValidBufferSize(e,32)}isValidSecretKey(e){return this.isValidBufferSize(e,64)}isString(e){return typeof e=="string"}isHexString(e){return typeof e=="string"&&/^[A-F0-9]+$/i.test(e)}isArray(e){return this.getVariableType(e)==="[object Array]"}isObject(e){return this.getVariableType(e)==="[object Object]"}isImage(e){return this.isString(e)}isURL(e){try{if(this.isString(e))return new URL(e).hostname!==""}catch{}return!1}isValidTransactionSignature(e){return this.isValidSignature(e)}isValidBlockSignature(e){return this.isValidSignature(e)}isValidSignature(e){return this.isValidBufferSize(e,64)}isValidAssetChangeHash(e){return this.isValidBufferSize(e,32)}isValidChainOnChainHash(e){return this.isValidBufferSize(e,32)}isValidUpperChainName(e){return this.isString(e)?/^[A-Z0-9]{5,20}$/.test(e):!1}isValidChainName(e){return this.isString(e)?/^[a-z0-9]{5,20}$/.test(e):!1}isValidAssetType(e){return this.isString(e)?/^[A-Z]{3,10}$/.test(e):!1}isValidChainMagic(e){if(!this.isString(e)||!/^[A-Z0-9]{5}$/.test(e))return!1;const t=e.slice(0,4),r=e.slice(4),n=`P_${this.parityBitHelper.calcParityBit(t)}`;return Hi[n]===void 0?!1:Hi[n].toString()===r}isValidTransactionType(e){if(!this.isString(e))return!1;const t=e.split("-");if(t.length!==4||!this.isValidAssetType(t[0])||!this.isValidUpperChainName(t[1]))return!1;const r=t[2];if(!(r===r.trim().toUpperCase()&&r.length===3))return!1;const n=t[3];return!!(/^[0-9]+$/.test(n)&&n.length===2)}isValidDAppId(e){if(!this.isString(e)||!/^[A-Z0-9]{8}$/.test(e))return!1;const t=e.slice(0,7),r=e.slice(7),n=`P_${this.parityBitHelper.calcParityBit(t)}`;return Hi[n]===void 0?!1:Hi[n].toString()===r}isMakeUpWithNumber(e){return/^(([0-9])|([1-9](\d)+?))$/.test(e)}isStringNumber(e){return this.isString(e)?this.isMakeUpWithNumber(e):!1}isPositiveStringNumber(e){return this.isStringNumber(e)&&BigInt(e)>BigInt(0)}isValidLocationName(e,t=this.configHelper.chainName){if(!this.isString(e)||e.length>512||this.isStartWithOrEndWithPoint(e))return!1;const r=e.split("."),n=r.length;if(n<2)return!1;for(let s=0;s<n;s++){const i=r[s];if(i.length>128)return!1;if(s===n-2){if(!this.isLowerCaseLetter(i))return!1}else if(s===n-1){if(i!==t)return!1}else if(i.length<=2){if(!this.isLowerCaseLetterOrNumber(i))return!1}else if(!this.isLowerCaseLetterOrNumberOrUnderline(i))return!1}return!0}isValidNumber(e){const t=e.toString();return!(t.length>1&&t.startsWith("0"))}isValidPort(e){return!Number.isNaN(e)&&this.isValidNumber(e)&&e>0&&e<65536}isValidChainPorts(e){return this.isEmptyObject(e)?!1:this.isValidPort(e.port)}isUpperCaseString(e){return this.isString(e)&&e===e.trim().toUpperCase()}isLowerCaseString(e){return this.isString(e)&&e===e.trim().toLowerCase()}isScientificCounting(e){return e.includes(".")||e.includes("e")}isLowerCaseLetter(e){return this.isString(e)&&/^[a-z]+$/.test(e)}isUpperCaseLetter(e){return this.isString(e)&&/^[A-Z]+$/.test(e)}isUpperCaseLetterOrNumber(e){return this.isString(e)&&/^[A-Z0-9]+$/.test(e)}isUpperCaseOrLowerCaseLetter(e){return this.isString(e)&&/^[A-Za-z]+$/.test(e)}isUpperCaseOrLowerCaseLetterOrNumber(e){return this.isString(e)&&/^[A-Za-z0-9]+$/.test(e)}isStartWithOrEndWithPoint(e){return!/^[^\.].*[^\.]$/.test(e)}isLowerCaseLetterOrNumber(e){return/^[a-z0-9]+$/.test(e)}isLowerCaseLetterOrNumberOrUnderline(e){return/^[a-z0-9][a-z0-9_]*[a-z0-9]+$/.test(e)}isValidStakeId(e){return this.isString(e)?/^[a-z0-9]{1,30}$/.test(e):!1}isValidFeeRate(e){if(!e)return!1;const t=e.senderPaidFeeRate,r=e.recipientPaidFeeRate;return!(!this.isPositiveFloatContainZero(t)||!this.isPositiveFloatContainZero(r)||!(t.denominator===1&&r.denominator===1)||!(t.numerator===1&&r.numerator===0||t.numerator===0&&r.numerator===1))}isValidRate(e){if(!e)return!1;const t=e.prevWeight,r=e.nextWeight;try{const n=BigInt(t),s=BigInt(r);return n===BigInt(0)||s===BigInt(0)?!1:typeof r==typeof t}catch{return!1}}isValidAssetExchangeWeightRatio(e){if(!e)return!1;const{toExchangeAssetWeight:t,beExchangeAssetWeight:r}=e;return!(!(this.isStringNumber(e.toExchangeAssetWeight)&&this.isStringNumber(e.beExchangeAssetWeight))||t==="0"||r==="0")}isValidEntityFactoryId(e){return this.isString(e)?/^[a-z0-9]{3,15}$/.test(e):!1}isValidEntityId(e){if(!this.isString(e))return!1;const t=e.split("_");if(t.length!==2&&t.length!==3)return!1;const r=/^[a-z0-9]{3,30}$/;return t.length===3?t[0]!=="m"||!this.isValidEntityFactoryId(t[1])?!1:r.test(t[2]):this.isValidEntityFactoryId(t[0])?r.test(t[1]):!1}isValidTindexRanges(e){const t=e.length;if(t===0||t%2!==0||!this.isNaturalNumber(e[0]))return!1;for(let r=1;r<t;r++)if(!this.isPositiveInteger(e[r]))return!1;return!0}isValidCertificateId(e){if(!this.isString(e)||e.length<3||e.length>100||e.includes(":")===!1)return!1;const t=e.split(":");return t.length!==2||this.isPositiveStringNumber(t[0])===!1?!1:/^[A-Za-z0-9\-_]*$/.test(t[1])}isValidMacroInputName(e){return this.isString(e)===!1?!1:/^\S.{1,30}\S$/.test(e)}};Re=p([j(),h("design:paramtypes",[de,re,So,bl,St])],Re);var pS=Symbol("bfchain-core:TransactionFilter"),hS=Symbol("bfchain-core:AbortForbiddenTransaction"),{ArgumentFormatException:td,ArgumentIllegalException:Q_,NoFoundException:lS}=Z("HELPER","transactionHelper"),_e=class{constructor(e,t,r,n,s,i,o,c){this.config=e,this.baseHelper=t,this.jsbiHelper=r,this.cryptoHelper=n,this.keypairHelper=s,this.Buffer=i,this.asymmetricHelper=o,this.accountBaseHelper=c,this.ALL_TRANSACTION_TYPES=[this.SIGNATURE,this.DAPP,this.DAPP_PURCHASING,this.REGISTER_CHAIN,this.MARK,this.ISSUE_ASSET,this.INCREASE_ASSET,this.DESTROY_ASSET,this.TRANSFER_ASSET,this.TO_EXCHANGE_ASSET,this.BE_EXCHANGE_ASSET,this.GIFT_ASSET,this.GRAB_ASSET,this.TRUST_ASSET,this.SIGN_FOR_ASSET,this.EMIGRATE_ASSET,this.IMMIGRATE_ASSET,this.LOCATION_NAME,this.SET_LNS_RECORD_VALUE,this.SET_LNS_MANAGER,this.ISSUE_ENTITY_FACTORY,this.ISSUE_ENTITY,this.DESTROY_ENTITY,this.ISSUE_ENTITY_MULTI,this.TRANSFER_ANY,this.GIFT_ANY,this.GRAB_ANY,this.TO_EXCHANGE_ANY,this.BE_EXCHANGE_ANY,this.TO_EXCHANGE_ANY_MULTI,this.BE_EXCHANGE_ANY_MULTI,this.TO_EXCHANGE_ANY_MULTI_ALL,this.BE_EXCHANGE_ANY_MULTI_ALL,this.ISSUE_CERTIFICATE,this.DESTROY_CERTIFICATE,this.MULTIPLE,this.PROMISE,this.PROMISE_RESOLVE,this.MACRO,this.MACRO_CALL],this.abortForbiddenTransaction=!0}get _ASSETTYPE(){return this.config.assetType}get _CHAIN_NAME(){return this.config.chainName.toUpperCase()}parseType(e){const t=e.indexOf("-"),r=e.indexOf("-",t+1),n=e.substr(r+1);return{assetType:e.substr(0,t),chainName:e.substring(t+1,r),baseType:n}}resolveType(e){return`${e.assetType}-${e.chainName}-${e.baseType}`}getTypeName(e){const{baseType:t}=this.parseType(e);return this.getTypeNameByBaseType(t)}getTypeNameByBaseType(e){return ve.VK.get(e)}getTransactionType(e){return`${this._ASSETTYPE}-${this._CHAIN_NAME}-${e}`}isValidType(e){return this.baseHelper.isValidTransactionType(e)}async generateSignature(e){return Qu(await this.cryptoHelper.sha256(e.getBytes(!0,!0)))}isValidTransactionSignature(e){return this.baseHelper.isValidTransactionSignature(e)}get SIGNATURE(){return this.getTransactionType(B.SIGNATURE)}get DAPP(){return this.getTransactionType(B.DAPP)}get DAPP_PURCHASING(){return this.getTransactionType(B.DAPP_PURCHASING)}get REGISTER_CHAIN(){return this.getTransactionType(B.REGISTER_CHAIN)}get MARK(){return this.getTransactionType(B.MARK)}get ISSUE_ASSET(){return this.getTransactionType(B.ISSUE_ASSET)}get INCREASE_ASSET(){return this.getTransactionType(B.INCREASE_ASSET)}get DESTROY_ASSET(){return this.getTransactionType(B.DESTROY_ASSET)}get TRANSFER_ASSET(){return this.getTransactionType(B.TRANSFER_ASSET)}get GIFT_ASSET(){return this.getTransactionType(B.GIFT_ASSET)}get GRAB_ASSET(){return this.getTransactionType(B.GRAB_ASSET)}get TRUST_ASSET(){return this.getTransactionType(B.TRUST_ASSET)}get SIGN_FOR_ASSET(){return this.getTransactionType(B.SIGN_FOR_ASSET)}get EMIGRATE_ASSET(){return this.getTransactionType(B.EMIGRATE_ASSET)}get IMMIGRATE_ASSET(){return this.getTransactionType(B.IMMIGRATE_ASSET)}get TO_EXCHANGE_ASSET(){return this.getTransactionType(B.TO_EXCHANGE_ASSET)}get BE_EXCHANGE_ASSET(){return this.getTransactionType(B.BE_EXCHANGE_ASSET)}get STAKE_ASSET(){return this.getTransactionType(B.STAKE_ASSET)}get UNSTAKE_ASSET(){return this.getTransactionType(B.UNSTAKE_ASSET)}get LOCATION_NAME(){return this.getTransactionType(B.LOCATION_NAME)}get SET_LNS_RECORD_VALUE(){return this.getTransactionType(B.SET_LNS_RECORD_VALUE)}get SET_LNS_MANAGER(){return this.getTransactionType(B.SET_LNS_MANAGER)}get ISSUE_ENTITY_FACTORY(){return this.getTransactionType(B.ISSUE_ENTITY_FACTORY)}get ISSUE_ENTITY_FACTORY_V1(){return this.getTransactionType(B.ISSUE_ENTITY_FACTORY_V1)}get ISSUE_ENTITY(){return this.getTransactionType(B.ISSUE_ENTITY)}get DESTROY_ENTITY(){return this.getTransactionType(B.DESTROY_ENTITY)}get ISSUE_ENTITY_MULTI(){return this.getTransactionType(B.ISSUE_ENTITY_MULTI)}get TRANSFER_ANY(){return this.getTransactionType(B.TRANSFER_ANY)}get GIFT_ANY(){return this.getTransactionType(B.GIFT_ANY)}get GRAB_ANY(){return this.getTransactionType(B.GRAB_ANY)}get TO_EXCHANGE_ANY(){return this.getTransactionType(B.TO_EXCHANGE_ANY)}get BE_EXCHANGE_ANY(){return this.getTransactionType(B.BE_EXCHANGE_ANY)}get TO_EXCHANGE_ANY_MULTI(){return this.getTransactionType(B.TO_EXCHANGE_ANY_MULTI)}get BE_EXCHANGE_ANY_MULTI(){return this.getTransactionType(B.BE_EXCHANGE_ANY_MULTI)}get TO_EXCHANGE_ANY_MULTI_ALL(){return this.getTransactionType(B.TO_EXCHANGE_ANY_MULTI_ALL)}get BE_EXCHANGE_ANY_MULTI_ALL(){return this.getTransactionType(B.BE_EXCHANGE_ANY_MULTI_ALL)}get ISSUE_CERTIFICATE(){return this.getTransactionType(B.ISSUE_CERTIFICATE)}get DESTROY_CERTIFICATE(){return this.getTransactionType(B.DESTROY_CERTIFICATE)}get MULTIPLE(){return this.getTransactionType(B.MULTIPLE)}get PROMISE(){return this.getTransactionType(B.PROMISE)}get PROMISE_RESOLVE(){return this.getTransactionType(B.PROMISE_RESOLVE)}get MACRO(){return this.getTransactionType(B.MACRO)}get MACRO_CALL(){return this.getTransactionType(B.MACRO_CALL)}genesisGenerators(e=this.config){const t=e.genesisBlock.transactionInfo.transactionInBlocks.filter(r=>r.transaction.type===this.ISSUE_ENTITY).map(r=>r.transaction.senderId);return[...new Set(t)]}async getGensisAcountAddress(e=this.config){return this.accountBaseHelper.getAddressFromPublicKeyString(e.genesisAccountPublicKey)}async verifyTransactionSignature(e,t){const r=t&&t.taskLabel||"Transaction",{signSignatureBuffer:n,signatureBuffer:s,senderSecondPublicKeyBuffer:i,senderPublicKeyBuffer:o}=e,c=await this.cryptoHelper.sha256().update(e.getBytes(!0,!0)).digest();if(!await this.keypairHelper.detached_verify(c,s,o))throw new td(a.INVALID_SIGNATURE,{taskLabel:r});if(i&&i.length>0||n&&n.length>0)if(i&&n){const l=await this.cryptoHelper.sha256().update(e.getBytes(!1,!0)).digest();if(!await this.keypairHelper.detached_verify(l,n,i))throw new td(a.INVALID_SIGNSIGNATURE,{taskLabel:r})}else throw new td(`Invalid ${r} miss signSignature or senderSecondPublicKey`)}verifyTransactionSize(e){const{maxTransactionSize:t}=this.config,r=e.getBytes().length;if(r>t)throw new Q_(a.PROP_SHOULD_LTE_FIELD,{prop:`transaction size ${r}`,target:"transaction",field:t})}verifyTransactionBlobSize(e){const{maxTransactionBlobSize:t}=this.config,r=e.getBlobSize(!0);if(r>t)throw new Q_(a.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${r}`,target:"transaction",field:t})}__calcStandardMinFee(e){const t=this.config.minTransactionFeePerByte;return e?this.jsbiHelper.compareFraction(t,e)>=0?t:e:t}calcMinFeePerBytes(e,t,r=this.config.minTransactionFeePerByte){let n=t,s=e;do{const i=this.jsbiHelper.multiplyCeilFraction(n,r).toString();if(i.length===s.length)return i;n+=i.length-s.length,s=i}while(!0)}calcTransactionMinFeeByBytes(e,t,r){return BigInt(this.calcMinFeePerBytes(e.fee,t||e.getBytes().length,this.__calcStandardMinFee(r)))}calcTransactionMinFeeByMaxBytes(e,t){return this.jsbiHelper.multiplyCeilFraction(this.config.maxTransactionSize,this.__calcStandardMinFee(t))*BigInt(e)}calcTransactionMinFeeByMulti(e,t,r,n){const s=this.calcMinFeePerBytes(e.fee,r||e.getBytes().length,this.__calcStandardMinFee(n));return BigInt(s)*BigInt(t)}calcTransactionBlobFee(e,t){const r=e.getBlobSize(!0);if(r===0)return BigInt(0);const n=this.calcMinFeePerBytes(e.fee,r,this.__calcStandardMinFee(t));return this.jsbiHelper.multiplyCeilFraction(BigInt(n),this.config.blobFeeMultipleRatio)}calcTransactionMinFee(e,t,r){const n=e.type;if(n===this.GIFT_ASSET){const s=e.asset.giftAsset.totalGrabableTimes+1;return(this.calcTransactionMinFeeByMaxBytes(s,r)+this.calcTransactionBlobFee(e,r)).toString()}if(n===this.GIFT_ANY){const s=e.asset.giftAny.totalGrabableTimes+1;return(this.calcTransactionMinFeeByMaxBytes(s,r)+this.calcTransactionBlobFee(e,r)).toString()}if(n===this.TRUST_ASSET){const s=e.asset.trustAsset.numberOfSignFor+1;return(this.calcTransactionMinFeeByMaxBytes(s,r)+this.calcTransactionBlobFee(e,r)).toString()}return n===this.ISSUE_ENTITY_MULTI?(this.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length,void 0,r)+this.calcTransactionBlobFee(e,r)).toString():n==this.TO_EXCHANGE_ANY_MULTI?(this.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.calcTransactionBlobFee(e,r)).toString():n===this.BE_EXCHANGE_ANY_MULTI?(this.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.calcTransactionBlobFee(e,r)).toString():n===this.GRAB_ASSET||n===this.GRAB_ANY||n===this.SIGN_FOR_ASSET?this.calcTransactionBlobFee(e,r):(this.calcTransactionMinFeeByBytes(e,t,r)+this.calcTransactionBlobFee(e,r)).toString()}calcTransactionFee(e,t=this.config.minTransactionFeePerByte){return this.calcMinFeePerBytes(e.fee,e.getBytes().length,t)}hashCode(e){let t=0,r=0;const n=e.length;for(;r<n;)t=(t<<5)-t+e.charCodeAt(r++)<<0;return Math.abs(t)}async calcGrabRandomGiftAssetNumber(e,t,r,n,s,i){const o=BigInt(s);if(i===1)return o;const{jsbiHelper:c}=this,l=BigInt(0),u=BigInt(this.config.miniUnit),g=o/BigInt(i);if(g===l)return u;const y=BigInt(`0x${await this.cryptoHelper.md5().update(e).update(t).update(r).update(n).digest("hex")}`),m=c.multiplyFloorFractionString(s,{numerator:y,denominator:BigInt(2)**BigInt(128)});if(m<u)return u;const d=g*BigInt(2);if(m<=d)return m;let I=m%d;return m>d*BigInt(2)&&I<=g&&(I+=g),I}async calcGrabRecipientRandomGiftAssetNumber(e,t,r,n,s,i){const o=new Map;let c=BigInt(0);for(const u of s){const g=BigInt(`0x${(await this.cryptoHelper.md5().update(t).update(r).update(n).update(u).digest("hex")).substr(0,16)}`);c=c+g,o.set(u,g)}const l=o.get(e);if(!l)throw new lS(a.NOT_EXIST,{prop:`grabId(${e})`,target:"giftTransactionRecipient"});return l*BigInt(i)/c}calcGrabAverageGiftAssetNumber(e,t){const r=BigInt(e),n=BigInt(this.config.miniUnit);if(t===1)return r;const s=BigInt(0),i=r/BigInt(t);return i===s?n:i}async calcGrabGiftAssetNumber(e,t,r){const n=t.asset.giftAsset;switch(n.giftDistributionRule){case 0:return this.calcGrabAverageGiftAssetNumber(n.amount,n.totalGrabableTimes);case 1:return await this.calcGrabRandomGiftAssetNumber(e,r,t.signatureBuffer,t.senderId,n.amount,n.totalGrabableTimes);case 2:return await this.calcGrabRandomGiftAssetNumber(e,r,t.signatureBuffer,t.senderId,n.amount,n.totalGrabableTimes)}}async calcGrabbedAssetNumber(e,t,r,n,s,i,o){switch(o){case 0:return this.calcGrabAverageGiftAssetNumber(s,i);case 1:return await this.calcGrabRandomGiftAssetNumber(e,me(t),me(r),n,s,i);case 2:return this.calcGrabRandomGiftAssetNumber(e,me(t),me(r),n,s,i)}}async generateGrabAsset(e,t,r){const n=await this.accountBaseHelper.createSecretKeypair(r.mainSecret),s=e.asset.giftAsset,{grabId:i=await this.accountBaseHelper.getAddressFromPublicKey(n.publicKey),grabSecret:o}=r,c=e.signatureBuffer;let l;o&&(l=pt.fromObject({signatureBuffer:await this.getCiphertextSignature({secret:o,transactionSignatureBuffer:c,senderId:i}),publicKeyBuffer:n.publicKey}));const u=On.fromObject({blockSignatureBuffer:t,transactionSignatureBuffer:c,giftAsset:s,ciphertextSignature:l});return u.amount=(await this.calcGrabGiftAssetNumber(i,e,t)).toString(),u}async getCiphertextSignature(e){return this.asymmetricHelper.detachedSign(await this.cryptoHelper.sha256().update(e.transactionSignatureBuffer).update(e.senderId).digest(),(await this.accountBaseHelper.createSecretKeypair(e.secret)).secretKey)}async verifyCiphertextSignature(e){return this.asymmetricHelper.detachedVeriy(await this.cryptoHelper.sha256().update(e.transactionSignatureBuffer).update(e.senderId).digest(),e.ciphertextSignatureBuffer,e.secretPublicKey)}getTransactionMaxEffectiveHeight(e){let t=e.effectiveBlockHeight;return(e instanceof Xi||e instanceof Qi||e instanceof Yi)&&(t=Number.MAX_SAFE_INTEGER),t}getTransactionMinEffectiveHeight(e){let t=e.applyBlockHeight;if(e instanceof Ji){const r=e.asset.giftAsset.beginUnfrozenBlockHeight;r&&(t=r)}else if(e instanceof qi){const r=e.asset.giftAny.beginUnfrozenBlockHeight;r&&(t=r)}else e instanceof Yi&&(t=e.asset.stakeAsset.beginUnstakeHeight);return t}isTransactionInFilter(e){return!(this.transactionFilter&&!this.transactionFilter.includes(e))}calcTransactionQueryRange(e,t=this.config){const r=e-t.maxApplyAndConfirmedBlockHeightDiff;return{startHeight:r<=0?1:r,endHeight:e-1}}calcTransactionQueryRangeByApplyBlockHeight(e,t){return{startHeight:e,endHeight:t-1}}getFactoryIdByEntityId(e){const t=e.split("_");return t.length>2?t[1]:t[0]}calcDestroyMainAssetsOfIsseuEntityFactory(e,t=this.config){const r=this.jsbiHelper,n=r.divisionFraction({numerator:e,denominator:"1"},t.maxMultipleOfEntityAndMainAsset);return r.multiplyCeilFraction(Bm,n).toString()}tIndexRangesToTindexes(e){let t=e[0];const r=[t];for(let n=1;n<e.length;n++)if(n%2===1)for(let s=0;s<e[n]-1;s++)r[r.length]=++t;else t+=e[n]+1,r[r.length]=t;return r}tIndexRangesToStartAndEndTindex(e){let t=e[0];const r=[t];t+=e[1],r.push(t-1);for(let n=2;n<e.length;n+=2)t+=e[n],r.push(t),t+=e[n+1],r.push(t-1);return r}getStakeSaveId(e,t){return`${t}_${e}`}};p([k(pS,{optional:!0}),h("design:type",Array)],_e.prototype,"transactionFilter",void 0),p([k(hS,{dynamics:!0}),h("design:type",Object)],_e.prototype,"abortForbiddenTransaction",void 0),_e=p([j(),Se(3,k("cryptoHelper")),Se(4,k("keypairHelper")),Se(5,k("Buffer")),h("design:paramtypes",[re,Re,St,Object,Object,Object,_r,de])],_e);var{NoFoundException:uS,ArgumentIllegalException:rd,RefuseException:Nl}=Z("helper","blobHelper"),Ii=class{constructor(e){this.timeHelper=e}support(e,t="readwrite"){let r=!0;return e==="SHA256"?(t.includes("read")&&(r=r&&this.blobSha256Reader!==void 0),t.includes("write")&&(r=r&&this.blobSha256Writer!==void 0)):r=!1,r}supportAlgorithms(e){const t=new Set;for(const r of["SHA256"])this.support(r,e)&&t.add(r);return t}async exists(e){const{blobSha256Reader:t}=this;return!t||e.algorithm!=="SHA256"?!1:t.has(e.hash)}async open(e){const{blobSha256Reader:t}=this;if(t===void 0)throw new uS(a.PARAM_LOST,{param:"blobSha256Reader"});const{hash:r,algorithm:n}=e;if(n!=="SHA256")throw new rd(a.BLOB_ALGORITHM_IS_INVALID,{hash:r,algorithm:n});return await t.open(r)}async read(e){const{blobSha256Reader:t}=this;if(t===void 0)throw new rd(a.PARAM_LOST,{param:"blobSha256Reader"});return{chunkBuffer:await t.read(e.descriptor,e.start,e.end)}}async close(e){const{blobSha256Reader:t}=this;if(t===void 0)throw new rd(a.PARAM_LOST,{param:"blobSha256Reader"});return await t.close(e.descriptor)}requestStorage(e,t,r,n,s){const{blobSha256Writer:i}=this;if(!i)throw new Nl(a.PARAM_LOST,{param:"blobSha256Writer"});return i.requestStorage(e,t,r,n,s)}saveChunk(e,t,r){const{blobSha256Writer:n}=this;if(!n)throw new Nl(a.PARAM_LOST,{param:"blobSha256Writer"});return n.saveChunk(e,t,r)}saveAsBlob(e){const{blobSha256Writer:t}=this;if(!t)throw new Nl(a.PARAM_LOST,{param:"blobSha256Writer"});return t.saveAsBlob(e)}changeBlobStrategy(e,t){const{blobSha256Writer:r}=this;if(!r)throw new Nl(a.PARAM_LOST,{param:"blobSha256Writer"});return r.changeBlobStrategy(e,t)}};p([k("blobSha256Reader",{optional:!0}),h("design:type",Object)],Ii.prototype,"blobSha256Reader",void 0),p([k("blobSha256Writer",{optional:!0}),h("design:type",Object)],Ii.prototype,"blobSha256Writer",void 0),Ii=p([j(),h("design:paramtypes",[xt])],Ii);var gS=class{constructor(e,t,r){this.chainName=e,this.magic=t,this.assetType=r}},q_=new Map,W_=new WeakSet,Le=class{isChainAssetInfo(e){return W_.has(e)}getAssetInfo(e,t,r){const n=e+":"+t+":"+r;let s=q_.get(n);return s||(s=new gS(e,t,r),Object.freeze(s),q_.set(n,s),W_.add(s)),s}};Le=p([j()],Le);var nd,sd;Z("helper-block_base_statistics","blockBaseStatisticsHelper");var Ms=nd=class{constructor(e,t,r,n){this.transactionHelper=e,this.chainAssetInfo=t,this.config=r,this.moduleMap=n,this._block_statistics_m=new Map}getConfig(){return this.tempConfig||this.config}forceGetStatisticsInfoByBlock(e,t,r,n){let s=this._block_statistics_m.get(e);return s||(s=At(ah,new je([[ah.SOURCE_DATA_SYMBOL,r]],this.moduleMap)),s.on("destroy",()=>{this._block_statistics_m.delete(e)}),this._block_statistics_m.set(e,s)),s.ref(t),n&&(this.tempConfig=n,s.on("destroy",()=>{this._block_statistics_m.delete(e),this.tempConfig=void 0})),s}getStatisticsInfoByBlock(e){return this._block_statistics_m.get(e)}_applyFee(e,t){const{applyInfo:r,transaction:n}=e,{address:s,assetInfo:i}=r,o=BigInt(r.sourceAmount),{baseType:c}=this.transactionHelper.parseType(n.type),l=t.initAssetStatistic(i);l.total.changeAmount=(BigInt(l.total.changeAmount)+o).toString(),l.total.moveAmount=(BigInt(l.total.moveAmount)+o).toString(),l.total.changeCount+=1;const u=n.signature;t.subIdMap.has(u)||(l.total.transactionCount+=1,t.subIdMap.set(u,!0));const g=t.initTypeStatistic(i,c);t.totalFee=t.totalFee+o,t.totalAsset=t.totalAsset+o,t.totalChainAsset=t.totalChainAsset+o,t.addTotalAccount(s),g.changeAmount=(BigInt(g.changeAmount)+o).toString(),g.changeCount+=1,g.moveAmount=(BigInt(g.moveAmount)+o).toString(),t.typeSubIdMap.has(u)||(g.transactionCount+=1,t.typeSubIdMap.set(u,!0))}_applyAsset(e,t,r=!1){const{applyInfo:n,transaction:s}=e,{type:i}=s,o=BigInt(n.sourceAmount),{baseType:c}=this.transactionHelper.parseType(i),l=t.initAssetStatistic(n.assetInfo),u=t.initTypeStatistic(n.assetInfo,c);l.total.changeAmount=(BigInt(l.total.changeAmount)+o).toString(),l.total.changeCount+=1;const g=s.signature;if(t.subIdMap.has(g)||(l.total.transactionCount+=1,t.subIdMap.set(g,!0)),u.changeAmount=(BigInt(u.changeAmount)+o).toString(),u.changeCount+=1,t.typeSubIdMap.has(g)||(u.transactionCount+=1,t.typeSubIdMap.set(g,!0)),n.amount.startsWith("-")||r){l.total.moveAmount=(BigInt(l.total.moveAmount)+o).toString(),t.totalAsset=t.totalAsset+o;const{assetInfo:y}=n,m=this.getConfig();y.assetType===m.assetType&&y.magic===m.magic&&(t.totalChainAsset=t.totalChainAsset+o),u.moveAmount=(BigInt(u.moveAmount)+o).toString()}t.addTotalAccount(n.address)}_applyCount(e,t){const{transaction:r}=e,{baseType:n}=this.transactionHelper.parseType(r.type),s=t.numberOfTransactions;s[n]?s[n]++:s[n]=1}bindApplyTransactionEventEmiter(e,t){const r=nd.eventEmitterStatisticsWM.forceGet(e);if(!r.has(t))return r.add(t),e.on("fee",(n,s)=>(this._applyFee(n,t),s()),{taskname:"applyTransaction/blockStatistic/fee"}),e.on("feeFromUnfrozen",(n,s)=>(this._applyFee(n,t),s()),{taskname:"applyTransaction/blockStatistic/feeFromUnfrozen"}),e.on("asset",(n,s)=>(this._applyAsset(n,t),s()),{taskname:"applyTransaction/blockStatistic/asset"}),e.on("frozenAsset",(n,s)=>(this._applyAsset(n,t),s()),{taskname:"applyTransaction/blockStatistic/frozenAsset"}),e.on("unfrozenAsset",(n,s)=>(this._applyAsset(n,t,!0),s()),{taskname:"applyTransaction/blockStatistic/unfrozenAsset"}),e.on("issueAsset",(n,s)=>(this._applyAsset(n,t,!0),s()),{taskname:"applyTransaction/blockStatistic/issueAsset"}),e.on("count",(n,s)=>(this._applyCount(n,t),s())),!0}};Ms.eventEmitterStatisticsWM=new Ga(e=>new WeakSet),Ms=nd=p([j("bfchain-core:BlockBaseStatistics"),h("design:paramtypes",[_e,Le,re,je])],Ms);var ah=sd=class extends mn{constructor(e=jr.fromObject({}),t){super(),this.source_data=e,this.chainAssetInfoHelper=t,this.subIdMap=new Map,this.typeSubIdMap=new Map,this._accountAddressSet=new Set,this._souce_data_totalAccount=this.source_data.totalAccount,this._reasonSet=new Set}get totalFee(){return this._totalFee||(this._totalFee=BigInt(this.source_data.totalFee))}set totalFee(e){this._totalFee=e}get totalAsset(){return this._totalAsset||(this._totalAsset=BigInt(this.source_data.totalAsset))}set totalAsset(e){this._totalAsset=e}get totalChainAsset(){return this._totalChainAsset||(this._totalChainAsset=BigInt(this.source_data.totalChainAsset))}set totalChainAsset(e){this._totalChainAsset=e}get numberOfTransactions(){return this._numberOfTransactions||(this._numberOfTransactions=this.source_data.numberOfTransactionsHashMap)}get totalAccount(){return this.source_data.totalAccount}addTotalAccount(e){return this._accountAddressSet.add(e),this.source_data.totalAccount=this._souce_data_totalAccount+this._accountAddressSet.size}getAssetTypeTypeStatisticMap(e){let t=this.source_data.magicAssetTypeTypeStatisticMap.get(e);return t||(t=sa.fromObject({}),this.source_data.magicAssetTypeTypeStatisticMap.set(e,t)),t.assetTypeTypeStatisticMap}__initAssetStatistic(){return na.fromObject({typeStatisticHashMap:{},total:{changeAmount:"0",changeCount:0,moveAmount:"0",transactionCount:0}})}getAssetStatistic(e){const{magic:t,assetType:r}=e,n=this.getAssetTypeTypeStatisticMap(t);let s=n.get(r);return s||(s=this.__initAssetStatistic(),n.set(r,s)),s}setAssetStatistic(e,t){const{magic:r,assetType:n}=e;let s=this.source_data.magicAssetTypeTypeStatisticMap.get(r);return s||(s=sa.fromObject({}),this.source_data.magicAssetTypeTypeStatisticMap.set(r,s)),s.assetTypeTypeStatisticMap.set(n,t),this}initAssetStatistic(e){const{magic:t,assetType:r}=e,n=this.getAssetTypeTypeStatisticMap(t);let s=n.get(r);return s||(s=this.__initAssetStatistic(),n.set(r,s)),s}__initTypeStatistic(){return Hn.fromObject({changeAmount:"0",changeCount:0,moveAmount:"0",transactionCount:0})}getTypeStatistic(e,t){let r=this.getAssetStatistic(e).typeStatisticMap.get(t);return r||(r=this.__initTypeStatistic()),r}setTypeStatistic(e,t,r){return this.getAssetStatistic(e).typeStatisticMap.set(t,r),this}initTypeStatistic(e,t){const r=this.getAssetStatistic(e);let n=r.typeStatisticMap.get(t);return n||(n=this.__initTypeStatistic(),r.typeStatisticMap.set(t,n)),n}ref(e){this._reasonSet.add(e)}unref(e){this._reasonSet.delete(e),this._reasonSet.size===0&&this.emit("destroy")}toModel(){return this._totalFee&&(this.source_data.totalFee=this._totalFee.toString()),this._totalAsset&&(this.source_data.totalAsset=this._totalAsset.toString()),this._totalChainAsset&&(this.source_data.totalChainAsset=this._totalChainAsset.toString()),this.source_data.format()}};ah.SOURCE_DATA_SYMBOL=Symbol("source-data"),ah=sd=p([j(),Se(0,k(sd.SOURCE_DATA_SYMBOL,{optional:!0})),h("design:paramtypes",[Object,Le])],ah);var{ArgumentFormatException:Ei,NoFoundException:Ea,ArgumentIllegalException:rw,OutOfRangeException:fS,IllegalStateException:dS,ConsensusException:yS}=Z("HELPER","blockHelper"),ht=class{constructor(e,t,r,n,s,i,o){this.config=e,this.baseHelper=t,this.accountBaseHelper=r,this.jsbiHelper=n,this.cryptoHelper=s,this.keypairHelper=i,this.Buffer=o,this._BTC_BLOCK_WM=new WeakMap,this._BLOCK_BTC_WM=new WeakMap}async generateSignature(e){return Qu(await this.cryptoHelper.sha256(e.getBytes(!0,!0)))}isValidSignature(e){return this.baseHelper.isValidSignature(e)}async verifyBlockSignature(e,t){const r=t&&t.taskLabel||"Block",{Buffer:n}=this,{generatorPublicKeyBuffer:s,signatureBuffer:i,generatorSecondPublicKeyBuffer:o,signSignatureBuffer:c}=e,l=await this.cryptoHelper.sha256(e.getBytes(!0,!0,!0));if(!await this.keypairHelper.detached_verify(l,i,s))throw new Ei(a.INVALID_SIGNATURE,{taskLabel:r});if(o&&o.length>0||c&&c.length>0)if(o&&c){const u=await this.cryptoHelper.sha256().update(e.getBytes(!1,!0,!0)).digest();if(!this.keypairHelper.detached_verify(u,n.from(c),n.from(o)))throw new Ei(a.INVALID_SIGNSIGNATURE,{taskLabel:r})}else throw new Ei(`Invalid ${r} miss signSignature or senderSecondPublicKey`)}verifyBlockVersion(e,t=this.config){if(e.version>t.version)throw new yS(a.NOT_MATCH,{to_compare_prop:`block version ${e.version}`,be_compare_prop:`blockChain version ${t.version}`,to_target:"block",be_target:"config"})}parseTypeByHeight(e){return e===1?Ft.GENESIS:e%this.config.blockPerRound===0?Ft.ROUNDEND:Ft.COMMON}calcRoundByHeight(e){return Math.ceil(e/this.config.blockPerRound)}calcBlockNumberToRoundEnd(e){return this.config.blockPerRound-(e%this.config.blockPerRound||this.config.blockPerRound)}calcRoundStartHeight(e){return(e-1)*this.config.blockPerRound+1}calcRoundEndHeight(e){return e*this.config.blockPerRound}calcRoundStartHeightByHeight(e){const t=this.calcRoundByHeight(e);return this.calcRoundStartHeight(t)}calcRoundEndHeightByHeight(e){const t=this.calcRoundByHeight(e);return this.calcRoundEndHeight(t)}calcBlockChainRoundByHeight(e){return this.calcRoundByHeight(e+1)}isRoundLastBlock(e){return e%this.config.blockPerRound===0}isRoundChange(e,t){return this.calcRoundByHeight(e)===this.calcRoundByHeight(t)}async forceGetBlockByHeight(e,t=this.blockGetterHelper){if(!t)throw new Ea(a.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=await t.getBlockByHeight(e);if(!r)throw new Ei(a.NOT_EXIST,{prop:`height:${e}`,target:"blocks"});return r}async forceGetBlockBySignature(e,t=this.blockGetterHelper){if(!t)throw new Ea(a.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=await t.getBlockBySignature(e);if(!r)throw new Ei(a.NOT_EXIST,{prop:`signature: ${e}`,target:"blockChain"});return r}async forceGetBlockListByHeightRange(e,t,r=this.blockGetterHelper){const n=[];if(e>t)throw new fS(a.OUT_OF_RANGE,{variable:"min and max",message:`min: ${e} max: ${t}`});for(let s=e;s<=t;s++)n[n.length]=await this.forceGetBlockByHeight(s,r);return n}async forceGetBlockGeneratorAddressByHeight(e,t=this.blockGetterHelper){if(!t)throw new Ea(a.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=typeof t.getBlockGeneratorPublicKeyBufferByHeight=="function"?await t.getBlockGeneratorPublicKeyBufferByHeight(e):(await this.forceGetBlockByHeight(e,t)).generatorPublicKeyBuffer;if(!r)throw new Ei(a.NOT_EXIST,{prop:`height:${e}`,target:"generatorPublicKey"});return this.accountBaseHelper.getAddressFromPublicKey(r)}async forceGetBlockSignatureBufferByHeight(e,t=this.blockGetterHelper){if(!t)throw new Ea(a.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=typeof t.getBlockSignatureByHeight=="function"?await t.getBlockSignatureByHeight(e):(await this.forceGetBlockByHeight(e,t)).signatureBuffer;if(!r)throw new Ei(a.NOT_EXIST,{prop:`height:${e}`,target:"generatorPublicKey"});return r}async forceGetBlockSignatureByHeight(e,t=this.blockGetterHelper){return Ne(await this.forceGetBlockSignatureBufferByHeight(e,t))}async getLastBlock(e=this.blockGetterHelper){if(!e)throw new Ea(a.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});return e.getLastBlock()}async getBlocksByRange(e,t,r=this.blockGetterHelper){if(!r)throw new Ea(a.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});if(!("getBlockByHeight"in r))return r.getBlocksByRange(e,t);if("getBlockByHeight"in r){const n=[];for(let s=e;s<t;s++){const i=await r.getBlockByHeight(s);if(!i)break;n.push(i)}return n}throw new dS(a.FAILED_TO_GET_BLOCKS_BY_RANGE,{minHeight:e,maxHeight:t})}async getCurrentGenerateBlock(e=this.blockGetterHelper){if(e&&e.getCurrentGenerateBlock)return e.getCurrentGenerateBlock()}async getCurrentReplayingBlockInfo(e=this.blockGetterHelper){if(e&&e.getCurrentReplayingBlockInfo)return e.getCurrentReplayingBlockInfo()}async getCurrentProcessingBlockPlotChecker(e=this.blockGetterHelper){const t=await this.getCurrentGenerateBlock();if(t)return this.parseNewBlockToPlotChecker(t);const r=await this.getCurrentReplayingBlockInfo(e);if(r)return this.parseBlockToPlotChecker(r.replayingBlock||r.currentBlock)}parseBlockToPlotChecker(e){let t=this._BLOCK_BTC_WM.get(e);return t||(t={height:e.height,timestamp:e.timestamp,numberOfTransactions:e.numberOfTransactions,get totalFee(){return Object.defineProperty(this,"totalFee",{value:BigInt(e.totalFee)}),this.totalFee},signature:e.signature,previousBlockSignature:e.previousBlockSignature},this._BLOCK_BTC_WM.set(e,t),this._BTC_BLOCK_WM.set(t,e)),t}getBlockFromPlotChecker(e){return this._BTC_BLOCK_WM.get(e)}parseNewBlockToPlotChecker(e){return{height:e.height,timestamp:e.timestamp,numberOfTransactions:e.numberOfTransactions,get totalFee(){return Object.defineProperty(this,"totalFee",{value:BigInt(e.totalFee)}),this.totalFee},signature:"signature"in e?e.signature:"ff".repeat(64),previousBlockSignature:e.previousBlockSignature}}parseBlockPlotCheckerListToPlotChecker(e){const t=e[0],r=e[e.length-1];return{height:r.height,timestamp:r.timestamp,get numberOfTransactions(){return Object.defineProperty(this,"numberOfTransactions",{value:e.reduce((n,s)=>n+s.numberOfTransactions,0)}),this.numberOfTransactions},get totalFee(){return Object.defineProperty(this,"totalFee",{value:e.reduce((n,s)=>n+s.totalFee,BigInt(0))}),this.totalFee},get signature(){return Object.defineProperty(this,"signature",{value:e.reduce((n,s)=>n+s.signature,"")}),this.signature},previousBlockSignature:t.previousBlockSignature}}async forceGetBlockGeneratorAddressByRound(e,t=this.blockGetterHelper){if(!t)throw new Ea(a.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=(e-1)*this.config.blockPerRound+1,n=e*this.config.blockPerRound,s=[];for(let i=r;i<=n;i++){const o=typeof t.getBlockGeneratorPublicKeyBufferByHeight=="function"?await t.getBlockGeneratorPublicKeyBufferByHeight(i):(await this.forceGetBlockByHeight(i,t)).generatorPublicKeyBuffer;if(!o)throw new Ei(a.NOT_EXIST,{prop:`height:${i}`,target:"generatorPublicKey"});const c=await this.accountBaseHelper.getAddressFromPublicKey(o);s.includes(c)||s.push(c)}return s}async calcAssetChangeHash(e,t="utf-8"){const r=[];for(const s in e){const i=e[s];for(const o in i){const c=i[o];for(const l in c)r.push(`${s}-${o}-${l}-${c[l]}`)}}if(r.sort((s,i)=>s>i?1:-1),r.length===0)return;const n=this.cryptoHelper.sha256();for(const s of r)n.update(dr.from(s,t));return(await n.digest()).toString("hex")}async calcChainOnChainHash(e,t){let r=(this.calcRoundByHeight(e)-1)*this.config.blockPerRound;r=r===0?1:r;const n=this.cryptoHelper.sha256();if(r!==1){const s=await this.forceGetBlockByHeight(r,t);n.update(s.asset.roundLastAsset.chainOnChainBuffer)}for(let s=r;s<e;s++){const i=await this.forceGetBlockSignatureBufferByHeight(s,t);n.update(i)}return(await n.digest()).toString("hex")}nextRoundGeneratorsCompareFn(e,t){return t.numberOfForgeEntities>e.numberOfForgeEntities?1:t.numberOfForgeEntities<e.numberOfForgeEntities?-1:t.producedblocks>e.producedblocks?1:t.producedblocks<e.producedblocks?-1:e.publicKey>t.publicKey?1:e.publicKey===t.publicKey?0:-1}sortInRankAccountInfoList(e){return e.sort(this.nextRoundGeneratorsCompareFn)}calcForginAndHoldingRewards(e,t,r,n){const s=BigInt(e.reward),i={forgingRewards:BigInt(e.totalFee)+s,holdingRewardsList:[],circulations:BigInt(0)};let o=s;if(s>BigInt(0)){if(t>BigInt(0)&&r>0){const c=BigInt(r),l=[];for(const u of n){const g=t*BigInt(u.numberOfShareEntities)/c;g>BigInt(0)&&(o=o+g,l.push({address:u.address,rewards:g}))}i.holdingRewardsList=l}i.circulations=o}return i}};p([k("blockGetterHelper",{optional:!0}),h("design:type",Object)],ht.prototype,"blockGetterHelper",void 0),ht=p([j(),Se(4,k("cryptoHelper")),Se(5,k("keypairHelper")),Se(6,k("Buffer")),h("design:paramtypes",[re,Re,de,St,Object,Object,Object])],ht);var Ds=class II{constructor(t){this._map=new Map(t)}get(t){return this._map.get(t)}has(t){return this._map.has(t)}set(t,r){return this._map.set(t,r)}[Symbol.iterator](){return this._map.entries()}entries(){return this._map[Symbol.iterator]}static fromPrefix(t,r){const n=new II;for(const[s,i]of r)n.set(t+s,i);return n}mergeWithPrefix(t,r){for(const[n,s]of r)this.set(t+n,s);return this}},Xe="/",_n="utf-8",{ArgumentIllegalException:us}=Z("HELPER","transactionHelper"),id=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new us(a.PROP_IS_REQUIRE,{prop:`chainInfo ${e}`,target:"encodeArgs"});const{chainName:t,magic:r,genesisBlockSignature:n}=e;if(!t)throw new us(a.PROP_IS_REQUIRE,{prop:`chainName ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new us(a.PROP_IS_INVALID,{prop:`chainName ${t}`,target:"encodeArgs"});if(!r)throw new us(a.PROP_IS_REQUIRE,{prop:`magic ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new us(a.PROP_IS_INVALID,{prop:`magic ${r}`,target:"encodeArgs"});if(!n)throw new us(a.PROP_IS_REQUIRE,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new us(a.PROP_IS_INVALID,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new us(a.PROP_IS_REQUIRE,{prop:`fromChainId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new us(a.PROP_IS_INVALID,{prop:`fromChainId ${e}`,target:"decodeArgs"});if(e.split(Xe).length!==4)throw new us(a.PROP_IS_INVALID,{prop:`fromChainId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${Xe}${e.magic}${Xe}${e.chainName}${Xe}${e.genesisBlockSignature}`}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(Xe);return{magic:r[1],chainName:r[2],genesisBlockSignature:r[3]}}};id=p([j()],id);function mS(e="fromChainId"){const t=new id;return new Ds([[`${e}/${t.version}`,t]])}var{ArgumentIllegalException:gs}=Z("HELPER","transactionHelper"),ad=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new gs(a.PROP_IS_REQUIRE,{prop:`chainInfo ${e}`,target:"encodeArgs"});const{chainName:t,magic:r,genesisBlockSignature:n}=e;if(!t)throw new gs(a.PROP_IS_REQUIRE,{prop:`chainName ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new gs(a.PROP_IS_INVALID,{prop:`chainName ${t}`,target:"encodeArgs"});if(!r)throw new gs(a.PROP_IS_REQUIRE,{prop:`magic ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new gs(a.PROP_IS_INVALID,{prop:`magic ${r}`,target:"encodeArgs"});if(!n)throw new gs(a.PROP_IS_REQUIRE,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new gs(a.PROP_IS_INVALID,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new gs(a.PROP_IS_REQUIRE,{prop:`toChainId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new gs(a.PROP_IS_INVALID,{prop:`toChainId ${e}`,target:"decodeArgs"});if(e.split(Xe).length!==4)throw new gs(a.PROP_IS_INVALID,{prop:`toChainId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${Xe}${e.magic}${Xe}${e.chainName}${Xe}${e.genesisBlockSignature}`}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(Xe);return{magic:r[1],chainName:r[2],genesisBlockSignature:r[3]}}};ad=p([j()],ad);function _S(e="toChainId"){const t=new ad;return new Ds([[`${e}/${t.version}`,t]])}var{ArgumentIllegalException:oh}=Z("HELPER","transactionHelper"),od=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new oh(a.PROP_IS_REQUIRE,{prop:`address ${e}`,target:"encodeArgs"});if(typeof e!="string")throw new oh(a.PROP_IS_INVALID,{prop:`address ${e}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new oh(a.PROP_IS_REQUIRE,{prop:`fromId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new oh(a.PROP_IS_INVALID,{prop:`fromId ${e}`,target:"decodeArgs"});if(e.split(Xe).length!==2)throw new oh(a.PROP_IS_INVALID,{prop:`fromId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${Xe}${e}`}decode(e,t=!1){return t||this.checkDecodeArgs(e),e.split(Xe)[1]}};od=p([j()],od);function AS(e="fromId"){const t=new od;return new Ds([[`${e}/${t.version}`,t]])}var{ArgumentIllegalException:ch}=Z("HELPER","transactionHelper"),cd=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new ch(a.PROP_IS_REQUIRE,{prop:`address ${e}`,target:"encodeArgs"});if(typeof e!="string")throw new ch(a.PROP_IS_INVALID,{prop:`address ${e}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new ch(a.PROP_IS_REQUIRE,{prop:`toId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new ch(a.PROP_IS_INVALID,{prop:`toId ${e}`,target:"decodeArgs"});if(e.split(Xe).length!==2)throw new ch(a.PROP_IS_INVALID,{prop:`toId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${Xe}${e}`}decode(e,t=!1){return t||this.checkDecodeArgs(e),e.split(Xe)[1]}};cd=p([j()],cd);function IS(e="toId"){const t=new cd;return new Ds([[`${e}/${t.version}`,t]])}var{ArgumentIllegalException:Do}=Z("HELPER","transactionHelper"),pd=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new Do(a.PROP_IS_REQUIRE,{prop:`assetInfo ${e}`,target:"encodeArgs"});const{parentAssetType:t,assetType:r}=e;if(t!==G.DAPP&&t!==G.LOCATION_NAME&&t!==G.ENTITY&&t!==G.ASSETS)throw new Do(a.PROP_IS_INVALID,{prop:`parentAssetType ${t}`,target:"encodeArgs"});if(typeof r!="string")throw new Do(a.PROP_IS_INVALID,{prop:`assetType ${r}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new Do(a.PROP_IS_REQUIRE,{prop:`assetId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new Do(a.PROP_IS_INVALID,{prop:`assetId ${e}`,target:"decodeArgs"});if(e.split(Xe).length!==3)throw new Do(a.PROP_IS_INVALID,{prop:`assetId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${Xe}${e.parentAssetType}${Xe}${e.assetType}`}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(Xe);return{parentAssetType:Number(r[1]),assetType:r[2]}}};pd=p([j()],pd);function ES(e="assetId"){const t=new pd;return new Ds([[`${e}/${t.version}`,t]])}var{ArgumentIllegalException:Ar}=Z("HELPER","transactionHelper"),hd=class{constructor(){this.version="1"}checkEncodeArgs(e){const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;if(!t)throw new Ar(a.PROP_IS_REQUIRE,{prop:`publicKey ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new Ar(a.PROP_IS_INVALID,{prop:`publicKey ${t}`,target:"encodeArgs"});if(!r)throw new Ar(a.PROP_IS_REQUIRE,{prop:`signature ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new Ar(a.PROP_IS_INVALID,{prop:`signature ${r}`,target:"encodeArgs"});if(n){if(!n)throw new Ar(a.PROP_IS_REQUIRE,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new Ar(a.PROP_IS_INVALID,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(!s)throw new Ar(a.PROP_IS_REQUIRE,{prop:`signSignature ${s}`,target:"encodeArgs"});if(typeof s!="string")throw new Ar(a.PROP_IS_INVALID,{prop:`signSignature ${s}`,target:"encodeArgs"})}else if(s)throw new Ar(a.SHOULD_NOT_EXIST,{prop:`signSignature ${s}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new Ar(a.PROP_IS_REQUIRE,{prop:`signature ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new Ar(a.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"});const t=e.split("/");if(t.length!==2&&t.length!==3)throw new Ar(a.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"});if(t[1].split("-").length!==2)throw new Ar(a.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"});if(t[2]&&t[2].split("-").length!==2)throw new Ar(a.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"})}encode(e,t=!1){t||this.checkEncodeArgs(e);let r=`${this.version}${Xe}${e.publicKey}-${e.signature}`;return e.secondPublicKey&&e.signSignature&&(r+=`${Xe}${e.secondPublicKey}-${e.signSignature}`),r}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(Xe),n=r[1].split("-"),s={publicKey:n[0],signature:n[1]};if(r[2]){const i=r[2].split("-");s.secondPublicKey=i[0],s.signSignature=i[1]}return s}splitSignature(e){return e.split("/")[0]}splitSignSignature(e){return e.split("/").slice(0,2).join(Xe)}async generateSignature(e,t,r){const{secret:n,secondSecret:s,migrateCertificate:i}=e;i.signature=this.version;const o=await t.createSecretKeypair(n),c=Ne(o.publicKey),l=await r.detachedSign(dr.from(JSON.stringify({body:i.body,signature:i.signature}),_n),o.secretKey);if(i.signature+=`/${c}-${Ne(l)}`,s){const u=await t.createSecondSecretKeypair(n,s),g=Ne(u.publicKey),y=await r.detachedSign(dr.from(JSON.stringify({body:i.body,signature:i.signature}),_n),u.secretKey);i.signature+=`/${g}-${Ne(y)}`}return i}async verifySignature(e,t,r){const n=r&&r.taskLabel||"MigrateCertificate",s=e.signature,i=this.decode(s);if(!await t.detachedVeriy(dr.from(JSON.stringify({body:e.body,signature:this.splitSignature(s)}),_n),me(i.signature),me(i.publicKey)))throw new Ar(a.INVALID_SIGNATURE,{taskLabel:n});if(i.secondPublicKey&&i.signSignature&&!await t.detachedVeriy(dr.from(JSON.stringify({body:e.body,signature:this.splitSignSignature(s)}),_n),me(i.signSignature),me(i.secondPublicKey)))throw new Ar(a.INVALID_SIGNSIGNATURE,{taskLabel:n})}};hd=p([j()],hd);function TS(e="signature"){const t=new hd;return new Ds([[`${e}/${t.version}`,t]])}var{ArgumentIllegalException:Ir}=Z("HELPER","transactionHelper"),ld=class{constructor(){this.version="1"}checkEncodeArgs(e){const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;if(!t)throw new Ir(a.PROP_IS_REQUIRE,{prop:`publicKey ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new Ir(a.PROP_IS_INVALID,{prop:`publicKey ${t}`,target:"encodeArgs"});if(!r)throw new Ir(a.PROP_IS_REQUIRE,{prop:`signature ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new Ir(a.PROP_IS_INVALID,{prop:`signature ${r}`,target:"encodeArgs"});if(n){if(!n)throw new Ir(a.PROP_IS_REQUIRE,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new Ir(a.PROP_IS_INVALID,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(!s)throw new Ir(a.PROP_IS_REQUIRE,{prop:`signSignature ${s}`,target:"encodeArgs"});if(typeof s!="string")throw new Ir(a.PROP_IS_INVALID,{prop:`signSignature ${s}`,target:"encodeArgs"})}else if(s)throw new Ir(a.SHOULD_NOT_EXIST,{prop:`signSignature ${s}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new Ir(a.PROP_IS_REQUIRE,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new Ir(a.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});const t=e.split("/");if(t.length!==2&&t.length!==3)throw new Ir(a.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});if(t[1].split("-").length!==2)throw new Ir(a.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});if(t[2]&&t[2].split("-").length!==2)throw new Ir(a.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"})}encode(e,t=!1){t||this.checkEncodeArgs(e);let r=`${this.version}${Xe}${e.publicKey}-${e.signature}`;return e.secondPublicKey&&e.signSignature&&(r+=`${Xe}${e.secondPublicKey}-${e.signSignature}`),r}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(Xe),n=r[1].split("-"),s={publicKey:n[0],signature:n[1]};if(r[2]){const i=r[2].split("-");s.secondPublicKey=i[0],s.signSignature=i[1]}return s}splitSignature(e){return e.split("/")[0]}splitSignSignature(e){return e.split("/").slice(0,2).join(Xe)}async generateSignature(e,t,r){const{authSecret:n,authSecondSecret:s,migrateCertificate:i}=e;i.fromAuthSignature=this.version;const o=await t.createSecretKeypair(n),c=Ne(o.publicKey),l=await r.detachedSign(dr.from(JSON.stringify({body:i.body,signature:i.signature,fromAuthSignature:i.fromAuthSignature}),_n),o.secretKey);if(i.fromAuthSignature+=`/${c}-${Ne(l)}`,s){const u=await t.createSecondSecretKeypair(n,s),g=Ne(u.publicKey),y=await r.detachedSign(dr.from(JSON.stringify({body:i.body,signature:i.signature,fromAuthSignature:i.fromAuthSignature}),_n),u.secretKey);i.fromAuthSignature+=`/${g}-${Ne(y)}`}return i}async verifySignature(e,t,r){const n=r&&r.taskLabel||"MigrateCertificate",s=e.fromAuthSignature,i=this.decode(s);if(!await t.detachedVeriy(dr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:this.splitSignature(s)}),_n),me(i.signature),me(i.publicKey)))throw new Ir(a.INVALID_FROMAUTHSIGNATURE,{taskLabel:n});if(i.secondPublicKey&&i.signSignature&&!await t.detachedVeriy(dr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:this.splitSignSignature(s)}),_n),me(i.signSignature),me(i.secondPublicKey)))throw new Ir(a.INVALID_FROMAUTHSIGNSIGNATURE,{taskLabel:n})}};ld=p([j()],ld);function SS(e="fromAuthSignature"){const t=new ld;return new Ds([[`${e}/${t.version}`,t]])}var{ArgumentIllegalException:Er}=Z("HELPER","transactionHelper"),ud=class{constructor(){this.version="1"}checkEncodeArgs(e){const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;if(!t)throw new Er(a.PROP_IS_REQUIRE,{prop:`publicKey ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new Er(a.PROP_IS_INVALID,{prop:`publicKey ${t}`,target:"encodeArgs"});if(!r)throw new Er(a.PROP_IS_REQUIRE,{prop:`signature ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new Er(a.PROP_IS_INVALID,{prop:`signature ${r}`,target:"encodeArgs"});if(n){if(!n)throw new Er(a.PROP_IS_REQUIRE,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new Er(a.PROP_IS_INVALID,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(!s)throw new Er(a.PROP_IS_REQUIRE,{prop:`signSignature ${s}`,target:"encodeArgs"});if(typeof s!="string")throw new Er(a.PROP_IS_INVALID,{prop:`signSignature ${s}`,target:"encodeArgs"})}else if(s)throw new Er(a.SHOULD_NOT_EXIST,{prop:`signSignature ${s}`,target:"encodeArgs"})}checkDecodeArgs(e,t){if(!e)throw new Er(a.PROP_IS_REQUIRE,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new Er(a.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});const r=e.split("/");if(r.length!==2&&r.length!==3)throw new Er(a.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});if(r[1].split("-").length!==2)throw new Er(a.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});if(r[2]&&r[2].split("-").length!==2)throw new Er(a.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"})}encode(e,t=!1){t||this.checkEncodeArgs(e);let r=`${this.version}${Xe}${e.publicKey}-${e.signature}`;return e.secondPublicKey&&e.signSignature&&(r+=`${Xe}${e.secondPublicKey}-${e.signSignature}`),r}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(Xe),n=r[1].split("-"),s={publicKey:n[0],signature:n[1]};if(r[2]){const i=r[2].split("-");s.secondPublicKey=i[0],s.signSignature=i[1]}return s}splitSignature(e){return e.split("/")[0]}splitSignSignature(e){return e.split("/").slice(0,2).join(Xe)}async generateSignature(e,t,r){const{authSecret:n,authSecondSecret:s,migrateCertificate:i}=e;i.toAuthSignature=this.version;const o=await t.createSecretKeypair(n),c=Ne(o.publicKey),l=await r.detachedSign(dr.from(JSON.stringify({body:i.body,signature:i.signature,fromAuthSignature:i.fromAuthSignature,toAuthSignature:i.toAuthSignature}),_n),o.secretKey);if(i.toAuthSignature+=`/${c}-${Ne(l)}`,s){const u=await t.createSecondSecretKeypair(n,s),g=Ne(u.publicKey),y=await r.detachedSign(dr.from(JSON.stringify({body:i.body,signature:i.signature,fromAuthSignature:i.fromAuthSignature,toAuthSignature:i.toAuthSignature}),_n),u.secretKey);i.toAuthSignature+=`/${g}-${Ne(y)}`}return i}async verifySignature(e,t,r){const n=r&&r.taskLabel||"MigrateCertificate",s=e.toAuthSignature,i=this.decode(s);if(!await t.detachedVeriy(dr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:e.fromAuthSignature,toAuthSignature:this.splitSignature(s)}),_n),me(i.signature),me(i.publicKey)))throw new Er(a.INVALID_TOAUTHSIGNATURE,{taskLabel:n});if(i.secondPublicKey&&i.signSignature&&!await t.detachedVeriy(dr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:e.fromAuthSignature,toAuthSignature:this.splitSignSignature(s)}),_n),me(i.signSignature),me(i.secondPublicKey)))throw new Er(a.INVALID_TOAUTHSIGNSIGNATURE,{taskLabel:n})}};ud=p([j()],ud);function bS(e="toAuthSignature"){const t=new ud;return new Ds([[`${e}/${t.version}`,t]])}function wS(e=1){return new Ds().mergeWithPrefix(`${e}/`,mS()).mergeWithPrefix(`${e}/`,_S()).mergeWithPrefix(`${e}/`,AS()).mergeWithPrefix(`${e}/`,IS()).mergeWithPrefix(`${e}/`,ES()).mergeWithPrefix(`${e}/`,TS()).mergeWithPrefix(`${e}/`,SS()).mergeWithPrefix(`${e}/`,bS())}var cr=wS(),Ol=class{constructor(e){this.config=e,this.fieldConverter=cr,this._init(),this._check()}get fromChainId(){return this.__fromChainId}get toChainId(){return this.__toChainId}get fromId(){return this.__fromId}get toId(){return this.__toId}get assetId(){return this.__assetId}get signature(){return this.__signature}get fromAuthSignature(){return this.__fromAuthSignature}get toAuthSignature(){return this.__toAuthSignature}getUUID(e){return this.signature.decode(e.fromAuthSignature,!0).signature}_init(){if(!this.config){this.__fromChainId=cr.get("1/fromChainId/1"),this.__toChainId=cr.get("1/toChainId/1"),this.__fromId=cr.get("1/fromId/1"),this.__toId=cr.get("1/toId/1"),this.__assetId=cr.get("1/assetId/1"),this.__signature=cr.get("1/signature/1"),this.__fromAuthSignature=cr.get("1/fromAuthSignature/1"),this.__toAuthSignature=cr.get("1/toAuthSignature/1");return}const{fromChainIdVersion:e,toChainIdVersion:t,fromIdVersion:r,toIdVersion:n,assetIdVersion:s,signatureVersion:i,fromAuthSignatureVersion:o,toAuthSignatureVersion:c}=this.config;this.__fromChainId=cr.get(`1/fromChainId/${e}`),this.__toChainId=cr.get(`1/toChainId/${t}`),this.__fromId=cr.get(`1/fromId/${r}`),this.__toId=cr.get(`1/toId/${n}`),this.__assetId=cr.get(`1/assetId/${s}`),this.__signature=cr.get(`1/signature/${i}`),this.__fromAuthSignature=cr.get(`1/fromAuthSignature/${o||i}`),this.__toAuthSignature=cr.get(`1/toAuthSignature/${c||o||i}`)}_check(){if(this.config){if(!this.__fromChainId)throw new SyntaxError(`unknown fromChainId version ${this.config.fromChainIdVersion}`);if(!this.__toChainId)throw new SyntaxError(`unknown toChainId version ${this.config.toChainIdVersion}`);if(!this.__fromId)throw new SyntaxError(`unknown fromId version ${this.config.fromIdVersion}`);if(!this.__toId)throw new SyntaxError(`unknown toId version ${this.config.toIdVersion}`);if(!this.__assetId)throw new SyntaxError(`unknown assetId version ${this.config.assetIdVersion}`);if(!this.__signature)throw new SyntaxError(`unknown signature version ${this.config.signatureVersion}`);if(!this.__fromAuthSignature)throw new SyntaxError(`unknown fromAuthSignature version ${this.config.fromAuthSignatureVersion}`);if(!this.__toAuthSignature)throw new SyntaxError(`unknown toAuthSignature version ${this.config.toAuthSignatureVersion}`)}}};Ol=p([j(),h("design:paramtypes",[Object])],Ol);var{ArgumentIllegalException:Z_}=Z("HELPER","transactionHelper");function Ti(e){return e.split("/",1)[0]}function Dn(e){if(!e)return new Ol;const{body:t,signature:r,fromAuthSignature:n,toAuthSignature:s}=e;if(!t)throw new Z_(a.PROP_IS_REQUIRE,{prop:"json.body"});if(!r)throw new Z_(a.PROP_IS_REQUIRE,{prop:"json.signature"});const{fromChainId:i,toChainId:o,fromId:c,toId:l,assetId:u}=t,g=Ti(i),y=Ti(o),m=Ti(c),d=Ti(l),I=Ti(u),T=Ti(r),S={fromChainIdVersion:g,toChainIdVersion:y,fromIdVersion:m,toIdVersion:d,assetIdVersion:I,signatureVersion:T};return n&&(S.fromAuthSignatureVersion=Ti(n)),s&&(S.toAuthSignatureVersion=Ti(s)),new Ol(S)}var gd=class{constructor(){this.__version="0.0.1"}get version(){return this.__version}set version(e){this.__version=e}};gd=p([j()],gd);var{ArgumentIllegalException:tr}=Z("HELPER","transactionHelper"),Fs=class{constructor(e,t,r,n,s,i,o){this.baseHelper=e,this.configHelper=t,this.chainTimeHelper=r,this.asymmetricHelper=n,this.accountBaseHelper=s,this.transactionHelper=i,this.config=o}__checkVersion(e){if(!e)throw new tr(a.PROP_IS_REQUIRE,{prop:"version",target:"migrateCertificate"});if(typeof e!="string")throw new tr(a.PROP_IS_INVALID,{prop:"version",target:"migrateCertificate"})}__checkTimestamp(e){if(!e)throw new tr(a.PROP_IS_REQUIRE,{prop:"timestamp",target:"migrateCertificate"});if(!this.baseHelper.isPositiveInteger(e))throw new tr(a.PROP_IS_INVALID,{prop:"timestamp",target:"migrateCertificate"})}__checkAssets(e){if(!e)throw new tr(a.PROP_IS_REQUIRE,{prop:"assets",target:"migrateCertificate"});if(!this.baseHelper.isValidAssetNumber(e))throw new tr(a.PROP_IS_INVALID,{prop:"assets",target:"migrateCertificate"});if(e==="0")throw new tr(a.PROP_SHOULD_GT_FIELD,{prop:"assets",fueld:"0",target:"migrateCertificate"})}getMigrateCertificateConverter(e){return Dn(e)}formatMigrateCertificate(e){const{body:t,signature:r,fromAuthSignature:n,toAuthSignature:s}=e;return{body:{version:t.version,timestamp:t.timestamp,fromChainId:t.fromChainId,toChainId:t.toChainId,fromId:t.fromId,toId:t.toId,assetId:t.assetId,assetPrealnum:t.assetPrealnum},signature:r||"",fromAuthSignature:n||"",toAuthSignature:s||""}}combineMigrateCertificateBody(e,t=this.configHelper){const r=Dn(),{senderId:n,recipientId:s,toChainInfo:i,assetInfo:o,assetPrealnum:c}=e;return{body:{version:t.version.toString(),timestamp:this.chainTimeHelper.now(!0),fromChainId:r.fromChainId.encode({magic:t.magic,chainName:t.chainName,genesisBlockSignature:t.signature},!0),toChainId:r.toChainId.encode(i),fromId:r.fromId.encode(n,!0),toId:r.toId.encode(s,!0),assetId:r.assetId.encode(o,!0),assetPrealnum:c},signature:r.signature.version}}combineMigrateCertificateSignature(e,t){const r=Dn(e),{signature:n,fromAuthSignature:s,toAuthSignature:i}=t;return n&&(e.signature=r.signature.encode(n)),s&&(e.fromAuthSignature=r.fromAuthSignature.encode(s)),i&&(e.toAuthSignature=r.toAuthSignature.encode(i)),e}async generateMigrateCertificate(e,t=this.configHelper){const{senderSecret:r,senderSecondSecret:n,recipientId:s,toChainInfo:i,assetInfo:o,assetPrealnum:c}=e,l=Dn();this.__checkAssets(c);const u=this.accountBaseHelper,g=await u.createSecretKeypair(r),y=await u.getAddressFromPublicKey(g.publicKey);let m={body:{version:this.config.version,timestamp:this.chainTimeHelper.now(!0),fromChainId:l.fromChainId.encode({magic:t.magic,chainName:t.chainName,genesisBlockSignature:t.signature},!0),toChainId:l.toChainId.encode(i),fromId:l.fromId.encode(y,!0),toId:l.toId.encode(s,!0),assetId:l.assetId.encode(o,!0),assetPrealnum:c},signature:"",fromAuthSignature:"",toAuthSignature:""};return r&&(m=await l.signature.generateSignature({secret:r,secondSecret:n,migrateCertificate:m},u,this.asymmetricHelper)),m}parseMigrateCertificateToJson(e){const{body:t,signature:r,fromAuthSignature:n,toAuthSignature:s}=e,i=Dn(e);return{body:{version:t.version,senderId:i.fromId.decode(t.fromId),recipientId:i.toId.decode(t.toId),timestamp:t.timestamp,fromChain:i.fromChainId.decode(t.fromChainId),toChain:i.toChainId.decode(t.toChainId),asset:i.assetId.decode(t.assetId),assetPrealnum:t.assetPrealnum},signature:i.signature.decode(r),fromAuthSignature:n&&n.includes("/")?i.fromAuthSignature.decode(n):void 0,toAuthSignature:s&&s.includes("/")?i.toAuthSignature.decode(s):void 0}}async fromAuthSignMigrateCertificate(e){return Dn(e.migrateCertificate).fromAuthSignature.generateSignature(e,this.accountBaseHelper,this.asymmetricHelper)}async toAuthSignMigrateCertificate(e){return Dn(e.migrateCertificate).toAuthSignature.generateSignature(e,this.accountBaseHelper,this.asymmetricHelper)}async verifyMigrateCertificateSignature(e,t){return Dn(e).signature.verifySignature(e,this.asymmetricHelper,t)}async verifyMigrateCertificateFromAuthSignature(e,t){return Dn(e).fromAuthSignature.verifySignature(e,this.asymmetricHelper,t)}async verifyMigrateCertificateToAuthSignature(e,t){return Dn(e).toAuthSignature.verifySignature(e,this.asymmetricHelper,t)}async __checkAuthAccount(e,t,r){const n=await this.accountBaseHelper.getAddressFromPublicKeyString(r.publicKey),s=t.genesisGenerators,i=await this.accountBaseHelper.getAddressFromPublicKeyString(t.generatorPublicKey);if(s.push(i),!s.includes(n))throw new tr(a.NOT_MATCH,{to_compare_prop:`${e} auth signature address ${n}`,be_compare_prop:"genesis generator address",to_target:"migrateCertificate",be_target:"fromChain"})}async checkChainInfo(e,t,r,n){if(t.magic!==r.magic)throw new tr(a.SHOULD_BE,{to_compare_prop:`${e}.magic ${t.magic}`,to_target:"migrateCertificate",be_compare_prop:r.magic});if(t.chainName!==r.chainName)throw new tr(a.SHOULD_BE,{to_compare_prop:`${e}.chainName ${t.chainName}`,to_target:"migrateCertificate",be_compare_prop:r.chainName});if(t.genesisBlockSignature!==t.genesisBlockSignature)throw new tr(a.SHOULD_BE,{to_compare_prop:`${e}.genesisBlockSignature ${t.genesisBlockSignature}`,to_target:"migrateCertificate",be_compare_prop:t.genesisBlockSignature});n&&await this.__checkAuthAccount(e,r,n)}async verifyMigrateCertificate(e,t){const r={target:"migrateCertificate"},n=Dn(e),{forceCheckFromChainInfo:s,fromChainBaseConfig:i,forceCheckFromAuthSignature:o,forceCheckToChainInfo:c,toChainBaseConfig:l,forceCheckToAuthSignature:u}=t,{body:g,signature:y,fromAuthSignature:m,toAuthSignature:d}=e;this.__checkVersion(g.version),this.__checkTimestamp(g.timestamp),n.fromChainId.checkDecodeArgs(g.fromChainId),n.toChainId.checkDecodeArgs(g.toChainId),n.fromId.checkDecodeArgs(g.fromId),n.toId.checkDecodeArgs(g.toId),n.assetId.checkDecodeArgs(g.assetId),this.__checkAssets(g.assetPrealnum),n.signature.checkDecodeArgs(y);const I=this.baseHelper,T=n.signature.decode(y,!0);if(!I.isValidAccountSignature(T))throw new tr(a.PROP_IS_INVALID,{prop:`signature ${y}`,...r});if(await n.signature.verifySignature(e,this.asymmetricHelper),s){if(!i)throw new tr(a.PROP_IS_REQUIRE,{prop:"fromChainBaseConfig",target:"options"});const S=n.fromChainId.decode(g.fromChainId);if(await this.checkChainInfo("fromChain",S,i),m&&m.includes(Xe)){n.fromAuthSignature.checkDecodeArgs(m);const w=n.fromAuthSignature.decode(m,!0);if(!I.isValidAccountSignature(w))throw new tr(a.PROP_IS_INVALID,{prop:`fromAuthSignature ${m}`,...r});await this.__checkAuthAccount("fromChain",i,w)}}if(o){if(!m)throw new tr(a.PROP_IS_REQUIRE,{prop:"fromAuthSignature",...r});await this.verifyMigrateCertificateFromAuthSignature(e)}if(c){if(!l)throw new tr(a.PROP_IS_REQUIRE,{prop:"toChainBaseConfig",target:"options"});const S=n.toChainId.decode(g.toChainId);if(await this.checkChainInfo("toChain",S,l),d&&d.includes(Xe)){n.toAuthSignature.checkDecodeArgs(d);const w=n.toAuthSignature.decode(d,!0);if(!I.isValidAccountSignature(w))throw new tr(a.PROP_IS_INVALID,{prop:`toAuthSignature ${d}`,...r});await this.__checkAuthAccount("toChain",l,w)}}if(u){if(!d)throw new tr(a.PROP_IS_REQUIRE,{prop:"toAuthSignature",...r});await this.verifyMigrateCertificateToAuthSignature(e)}return n}};Fs=p([j(),h("design:paramtypes",[Re,re,xt,_r,de,_e,gd])],Fs);var fd=class{constructor(){this.__version="0.0.1"}get version(){return this.__version}set version(e){this.__version=e}};fd=p([j()],fd);var vl="utf-8",{ArgumentIllegalException:Zr}=Z("HELPER","RegisterChainCertificateHelper"),Cl=class{constructor(e,t,r,n,s){this.baseHelper=e,this.chainTimeHelper=t,this.asymmetricHelper=r,this.accountBaseHelper=n,this.config=s}__checkVersion(e){if(!e)throw new Zr(a.PROP_IS_REQUIRE,{prop:"version",target:"registerChainCertificate"});if(typeof e!="string")throw new Zr(a.PROP_IS_INVALID,{prop:"version",target:"registerChainCertificate"})}__checkTimestamp(e){if(!e)throw new Zr(a.PROP_IS_REQUIRE,{prop:"timestamp",target:"registerChainCertificate"});if(!this.baseHelper.isPositiveInteger(e))throw new Zr(a.PROP_IS_INVALID,{prop:"timestamp",target:"registerChainCertificate"})}__checkPublicKey(e){if(!e)throw new Zr(a.PROP_IS_REQUIRE,{prop:"publicKey",target:"registerChainCertificate"});if(!this.baseHelper.isValidPublicKey(e))throw new Zr(a.PROP_IS_INVALID,{prop:"publicKey",target:"registerChainCertificate"})}__checkSignature(e){if(!e)throw new Zr(a.PROP_IS_REQUIRE,{prop:"signature",target:"registerChainCertificate"});if(!this.baseHelper.isValidSignature(e))throw new Zr(a.PROP_IS_INVALID,{prop:"signature",target:"registerChainCertificate"})}async generateRegisterChainCertificate(e){const{generatorSecret:t,generatorSecondSecret:r,genesisBlockInfo:n,version:s,timestamp:i}=e,o=this.accountBaseHelper,c=await o.createSecretKeypair(t),l=Ne(c.publicKey);let u;const g={body:{version:s||this.config.version,timestamp:i===void 0?this.chainTimeHelper.now(!0):i,genesisBlockInfo:{genesisAccount:{address:await o.getAddressFromPublicKey(c.publicKey),publicKey:l},...n}},publicKey:l};r&&(u=await o.createSecretKeypair(t),g.secondPublicKey=Ne(u.publicKey));const y=await this.asymmetricHelper.detachedSign(Buffer.from(JSON.stringify(g),vl),c.secretKey),m={...g,signature:Ne(y)};if(u){const d=await this.asymmetricHelper.detachedSign(Buffer.from(JSON.stringify(g),vl),u.secretKey);m.signSignature=Ne(d)}return m}async verifyRegisterChainCertificateSignature(e,t){const r=t&&t.taskLabel||"RegisterChainCertificate",{body:n,publicKey:s,signature:i,secondPublicKey:o,signSignature:c}=e;if(!await this.asymmetricHelper.detachedVeriy(Buffer.from(JSON.stringify({body:n,publicKey:s}),vl),me(i),me(s)))throw new Zr(a.INVALID_SIGNATURE,{taskLabel:r});if(o&&c&&!await this.asymmetricHelper.detachedVeriy(Buffer.from(JSON.stringify({body:n,publicKey:s,secondPublicKey:o,signature:i}),vl),me(c),me(o)))throw new Zr(a.INVALID_SIGNSIGNATURE,{taskLabel:r})}async verifyRegisterChainCertificate(e){const{body:t,publicKey:r,signature:n,secondPublicKey:s,signSignature:i}=e;if(r!==t.genesisBlockInfo.genesisAccount.publicKey)throw new Zr(a.NOT_MATCH,{to_compare_prop:`publicKey ${r}`,be_compare_prop:`generatorPublicKey ${t.genesisBlockInfo.genesisAccount.publicKey}`,to_target:"registerChainCertificate",be_target:"registerChainCertificate.body.genesisBlockInfo"});if(this.__checkVersion(t.version),this.__checkTimestamp(t.timestamp),this.__checkPublicKey(r),this.__checkSignature(n),s&&i)this.__checkPublicKey(s),this.__checkSignature(i);else{if(s)throw new Zr(a.SHOULD_NOT_EXIST,{prop:`secondPublicKey ${s}`,target:"registerChainCertificate"});if(i)throw new Zr(a.SHOULD_NOT_EXIST,{prop:`signSignature ${i}`,target:"registerChainCertificate"})}return await this.verifyRegisterChainCertificateSignature(e),!0}encode(e){return JSON.stringify(e)}decode(e){return JSON.parse(e)}};Cl=p([j(),h("design:paramtypes",[Re,xt,_r,de,fd])],Cl);var{ArgumentIllegalException:Ie}=Z("CONTROLLER","_txbase"),Ge=class{async fromJSON(e,t){const r=this.init(e,e.asset);return t&&t.verify&&await this.verify(r,t.config),r}verifyKeypair(e){if(!e)throw new Ie(a.PARAM_LOST,{param:"keypair"});const t={target:"keypair"};if(!e.publicKey)throw new Ie(a.PROP_IS_REQUIRE,{prop:"publicKey",...t});if(!e.secretKey)throw new Ie(a.PROP_IS_REQUIRE,{param:"secretKey",...t})}verifySecondKeypair(e){if(!e)throw new Ie(a.PARAM_LOST,{param:"keypair"});const t={target:"keypair"};if(!e.publicKey)throw new Ie(a.PROP_IS_REQUIRE,{prop:"publicKey",...t});if(!e.secretKey)throw new Ie(a.PROP_IS_REQUIRE,{param:"secretKey",...t})}async verifyTransactionBody(e,t,r=this.configHelper){if(!e)throw new Ie(a.PARAM_LOST,{param:"body"});if(!t)throw new Ie(a.PARAM_LOST,{param:"asset"});const n={target:"body"},{baseHelper:s,accountBaseHelper:i}=this;if(!s.isPositiveInteger(e.version))throw new Ie(a.PROP_IS_REQUIRE,{prop:"version",...n});if(!e.type)throw new Ie(a.PROP_IS_REQUIRE,{prop:"type",...n});if(!s.isValidTransactionType(e.type))throw new Ie(a.PROP_IS_INVALID,{prop:"type",type:"transaction type",...n});if(!e.senderId)throw new Ie(a.PROP_IS_REQUIRE,{prop:"senderId",...n});if(!await i.isAddress(e.senderId))throw new Ie(a.PROP_IS_INVALID,{prop:`senderId ${e.senderId}`,type:"account address",...n});if(!e.senderPublicKey)throw new Ie(a.PROP_IS_REQUIRE,{prop:"senderPublicKey",...n});if(!s.isValidPublicKey(e.senderPublicKey))throw new Ie(a.PROP_IS_INVALID,{prop:`senderPublicKey ${e.senderPublicKey}`,type:"account publicKey",...n});const o=await i.getAddressFromPublicKeyString(e.senderPublicKey);if(e.senderId!==o)throw new Ie(a.NOT_MATCH,{to_compare_prop:`senderId ${e.senderId}`,be_compare_prop:`publicKey => address ${o}`,to_target:"senderPublicKey",be_target:"body",...n});if(e.senderSecondPublicKey&&!s.isValidPublicKey(e.senderSecondPublicKey))throw new Ie(a.PROP_IS_INVALID,{prop:`senderSecondPublicKey ${e.senderSecondPublicKey}`,type:"account publicKey",...n});if(e.recipientId!==void 0&&!await i.isAddress(e.recipientId))throw new Ie(a.PROP_IS_INVALID,{prop:`recipientId ${e.recipientId}`,type:"account address",...n});const{range:c}=e;if(c.length>0){const d=new Set(c);if(c.length!==d.size)throw new Ie(a.SHOULD_NOT_DUPLICATE,{prop:"range",...n})}if(!await this.baseHelper.isValidRange(e.rangeType,c))throw new Ie(a.PROP_IS_INVALID,{prop:`range ${e.rangeType}`,type:"transaction range",...n});if(!s.isNaturalNumber(e.timestamp))throw new Ie(a.PROP_IS_INVALID,{prop:`timestamp ${e.timestamp}`,type:"natural number",...n});const l=e.applyBlockHeight;if(!s.isPositiveInteger(l))throw new Ie(a.PROP_IS_INVALID,{prop:`applyBlockHeight ${l}`,type:"positive integer",...n});const u=e.effectiveBlockHeight;if(!s.isPositiveInteger(u))throw new Ie(a.PROP_IS_INVALID,{prop:`effectiveBlockHeight ${u}`,type:"positive integer",...n});if(u<l)throw new Ie(a.PROP_SHOULD_GTE_FIELD,{prop:`effectiveBlockHeight ${u}`,field:l,...n});const{maxApplyAndConfirmedBlockHeightDiff:g}=r,y=l+g;if(u>y)throw new Ie(a.PROP_SHOULD_LTE_FIELD,{prop:`effectiveBlockHeight ${u}`,field:y,...n});if(this.checkTrsBaseFee(e.fee,n),!e.fromMagic)throw new Ie(a.PROP_IS_REQUIRE,{prop:"fromMagic",...n});if(!s.isValidChainMagic(e.fromMagic))throw new Ie(a.PROP_IS_INVALID,{prop:`fromMagic ${e.fromMagic}`,type:"chain magic",...n});if(!e.toMagic)throw new Ie(a.PROP_IS_REQUIRE,{prop:"toMagic",...n});if(!s.isValidChainMagic(e.toMagic))throw new Ie(a.PROP_IS_INVALID,{prop:`toMagic ${e.toMagic}`,type:"chain magic",...n});if(e.sourceIP!==void 0&&!s.isIp(e.sourceIP))throw new Ie(a.PROP_IS_INVALID,{prop:`sourceIP ${e.sourceIP}`,type:"ip",...n});if(e.dappid!==void 0&&!s.isValidDAppId(e.dappid))throw new Ie(a.PROP_IS_INVALID,{prop:`dappid ${e.dappid}`,type:"dappid",...n});if(e.lns!==void 0&&!s.isValidLocationName(e.lns,r.chainName))throw new Ie(a.PROP_IS_INVALID,{prop:`lns ${e.lns}`,type:"location name",...n});const m=e.remark;if(!m)throw new Ie(a.PROP_IS_REQUIRE,{prop:"remark",...n});if(s.getVariableType(m)!=="[object Object]")throw new Ie(a.PROP_IS_INVALID,{prop:"remark",...n});for(const d in m)if(!s.isString(m[d]))throw new Ie(a.PROP_IS_INVALID,{prop:"remark",...n})}async verifyBaseInfo(e,t=this.configHelper){if(!e)throw new Ie(a.PARAM_LOST,{param:"transaction"});await this.verifyTransactionBody(e,e.asset,t);const r={target:"transaction"},{baseHelper:n}=this;if(!e.signature)throw new Ie(a.PROP_IS_REQUIRE,{prop:"signature",...r});if(!n.isValidSignature(e.signature))throw new Ie(a.PROP_IS_INVALID,{prop:`signature ${e.signature}`,type:"signature",...r});if(e.signSignature&&!n.isValidSignature(e.signSignature))throw new Ie(a.PROP_IS_INVALID,{prop:`signSignature ${e.signSignature}`,type:"signature",...r})}async verifySignature(e){await this.transactionHelper.verifyTransactionSignature(e)}verifyTransactionSize(e){this.transactionHelper.verifyTransactionSize(e)}verifyTransactionBlobSize(e){this.transactionHelper.verifyTransactionBlobSize(e)}async verify(e,t=this.configHelper){await this.verifyBaseInfo(e,t),this.verifyTransactionSize(e),this.verifyTransactionBlobSize(e),await this.verifySignature(e)}checkAssetAmount(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});const{baseHelper:n}=this;if(!n.isValidAssetNumber(e))throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,type:"asset number",...r});const s=BigInt(0),i=BigInt(e);if(s>=i)throw new Ie(a.PROP_SHOULD_GT_FIELD,{prop:`${t} ${e}`,field:"0",...r})}checkAssetPrealnum(e,t,r){this.checkBaseAssetPrealnum(r,t,e),this.isAssetPrealnumGtZero(e,t,r)}checkBaseAssetPrealnum(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});const{baseHelper:n}=this;if(!n.isValidAssetNumber(e))throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,type:"asset prealnum",...r});const s=BigInt(0),i=BigInt(e);if(s>i)throw new Ie(a.PROP_SHOULD_GTE_FIELD,{prop:`${t} ${e}`,field:"0",...r})}isAssetPrealnumGtZero(e,t,r){if(e==="0")throw new Ie(a.PROP_SHOULD_GT_FIELD,{prop:`${t} ${e}`,field:"0",...r})}checkTrsBaseFee(e,t){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:"fee",...t});const{baseHelper:r}=this;if(!r.isValidAssetNumber(e))throw new Ie(a.PROP_IS_INVALID,{prop:`fee ${e}`,type:"asset number",...t});const n=BigInt(e);if(BigInt("0")>n)throw new Ie(a.PROP_SHOULD_GTE_FIELD,{prop:`fee ${e}`,field:"0",...t})}emptyRangeType(e,t){if(e.rangeType!==0)throw new Ie(a.SHOULD_BE,{to_compare_prop:`rangeType ${e.rangeType}`,to_target:"body",be_compare_prop:"RANGE_TYPE.EMPTY",...t})}checkChainName(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidChainName(e))throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,type:"chain name",...r})}checkChainMagic(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidChainMagic(e))throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,type:"chain magic",...r})}checkParentAssetType(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});if(!G[e])throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkAsset(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidAssetType(e))throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkDAppId(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidDAppId(e))throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkLocationName(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidLocationName(e))throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkEntityFactoryId(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidEntityFactoryId(e))throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkEntityId(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidEntityId(e))throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkCertificateId(e,t,r){if(!e)throw new Ie(a.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidCertificateId(e))throw new Ie(a.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkAssetType(e,t,r,n){if(e===G.ASSETS){this.checkAsset(t,r,n);return}if(e===G.DAPP){this.checkDAppId(t,r,n);return}if(e===G.LOCATION_NAME){this.checkLocationName(t,r,n);return}if(e===G.ENTITY){this.checkEntityId(t,r,n);return}if(e===G.CERTIFICATE){this.checkCertificateId(t,r,n);return}throw new Ie(a.PROP_IS_INVALID,{prop:`parentAssetType ${e}`,...n})}async checkTaxInformation(e,t){if(!t)throw new Ie(a.PROP_IS_REQUIRE,{prop:"taxInformation",...e});const{taxCollector:r,taxAssetPrealnum:n}=t;if(!r)throw new Ie(a.PROP_IS_REQUIRE,{prop:"taxInformation.taxCollector",...e});if(!await this.accountBaseHelper.isAddress(r))throw new Ie(a.PROP_IS_INVALID,{prop:`taxInformation.taxCollector ${r}`,...e});if(!n)throw new Ie(a.PROP_IS_REQUIRE,{prop:"taxInformation.taxAssetPrealnum",...e});if(!this.baseHelper.isValidAssetPrealnum(n))throw new Ie(a.PROP_IS_INVALID,{prop:`taxInformation.taxAssetPrealnum ${n}`,...e})}async applyTransaction(e,t,r=this.configHelper){const n=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);return Ue(s=>{s.next=t.emit("fee",{type:"fee",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:n,amount:"-"+e.fee,sourceAmount:e.fee}}),s.next=t.emit("count",{type:"count",transaction:e})})}beginDealTransaction(e,t){return t.emit("beginDealTransaction",{type:"beginDealTransaction",transaction:e,applyInfo:void 0})}endDealTransaction(e,t){return t.emit("endDealTransaction",{transactionInBlock:e})}_applyTransactionEmitAsset(e,t,r,n){return Ue(s=>{s.next=e.emit("asset",{type:"asset",transaction:t,applyInfo:{address:n.senderId,publicKeyBuffer:n.senderPublicKeyBuffer,assetInfo:n.assetInfo,amount:"-"+r,sourceAmount:r}}),n.recipientId&&(s.next=e.emit("asset",{type:"asset",transaction:t,applyInfo:{address:n.recipientId,publicKeyBuffer:n.recipientPublicKeyBuffer,assetInfo:n.assetInfo,amount:r,sourceAmount:r}}))})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}},{ArgumentIllegalException:Ta}=Z("CONTROLLER","SignatureTransactionFactory"),Rl=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(e.recipientId)throw new Ta(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Ta(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Ta(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new Ta(a.SHOULD_NOT_EXIST,{prop:"storage",...n});const i=t.signature;if(!i)throw new Ta(a.PARAM_LOST,{param:"signature"});const o={...n,target:"signatureAsset"},c=i.publicKey;if(!c)throw new Ta(a.PROP_IS_REQUIRE,{prop:"publicKey",...o});if(!s.isValidSecondPublicKey(c))throw new Ta(a.PROP_IS_INVALID,{prop:`publicKey ${c}`,type:"account second publicKey",...o})}init(e,t){return tp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r),n.next=t.emit("setSecondPublicKey",{type:"setSecondPublicKey",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,secondPublicKeyBuffer:e.asset.signature.publicKeyBuffer}})})}};Rl=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Rl);var{ArgumentIllegalException:pr}=Z("CONTROLLER","DAppTransactionFactory"),ph=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new pr(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new pr(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new pr(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new pr(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="dappid")throw new pr(a.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"dappid",...n});const i=t.dapp;if(this.verifyDAppAsset(i,r),s.value!==i.dappid)throw new pr(a.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`dappid ${i.dappid}`,to_target:"storage",be_target:"dapp",...n})}verifyDAppAsset(e,t=this.configHelper){const{baseHelper:r}=this,n={target:"body"};if(!e)throw new pr(a.PARAM_LOST,{param:"dapp",...n});const s={...n,target:"dappAsset"},{dappid:i,sourceChainMagic:o,sourceChainName:c,type:l,purchaseAsset:u}=e;if(!i)throw new pr(a.PROP_IS_REQUIRE,{prop:"dappid",...s});if(!r.isString(i))throw new pr(a.PROP_IS_INVALID,{prop:`dappid ${i}`,type:"string",...s});if(i.length!==8)throw new pr(a.PROP_LENGTH_SHOULD_EQ_FIELD,{prop:`dappid ${i}`,fileds:8,...s});if(!r.isUpperCaseLetterOrNumber(i))throw new pr(a.PROP_IS_INVALID,{prop:`dappid ${i}`,type:"uppercase or number",...s});if(this.checkChainName(c,"sourceChainName",s),c!==t.chainName)throw new pr(a.SHOULD_BE,{to_compare_prop:`sourceChainName ${c}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(o,"sourceChainMagic",s),o!==t.magic)throw new pr(a.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${o}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(l!==1&&l!==0)throw new pr(a.NOT_MATCH,{to_compare_prop:`type ${l}`,be_compare_prop:"dappType",to_target:"dapp",be_target:"DAPP_TYPE",...s});if(l===0){if(!u)throw new pr(a.PROP_IS_REQUIRE,{prop:"purchaseAsset",...s});if(!r.isValidAssetNumber(u))throw new pr(a.PROP_IS_INVALID,{prop:"purchaseAsset",type:"asset number",...s});this.checkAssetAmount(u,"purchaseAsset",s)}else if(l===1&&u)throw new pr(a.SHOULD_NOT_EXIST,{prop:"purchaseAsset",...s})}init(e,t){return rp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{sourceChainName:s,sourceChainMagic:i,dappid:o,type:c,purchaseAsset:l}=e.asset.dapp;n.next=t.emit("issueDAppid",{type:"issueDAppid",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:s,sourceChainMagic:i,dappid:o,possessorAddress:e.recipientId,type:c,purchaseAsset:l,status:0}})})}};ph=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],ph);var{ArgumentIllegalException:Si}=Z("CONTROLLER","DAppPurchasingTransactionFactory"),dd=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.dappTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new Si(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Si(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Si(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Si(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="dappid")throw new Si(a.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"dappid",...n});const i=t.dappPurchasing;if(!i)throw new Si(a.PARAM_LOST,{param:"dappPurchasing"});const o={...n,target:"dappPurchasingAsset"},{dappAsset:c}=i;if(this.dappTransactionFactory.verifyDAppAsset(c),s.value!==c.dappid)throw new Si(a.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`dappid ${c.dappid}`,to_target:"storage",be_target:"dapp",...o});if(c.type!==0)throw new Si(a.SHOULD_NOT_BE,{to_compare_prop:`type ${c.type}`,to_target:"dappAsset",be_compare_prop:0,...o})}init(e,t){return np.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{chainName:s,magic:i,assetType:o}=r,{purchaseAsset:c}=e.asset.dappPurchasing.dappAsset,l=this.chainAssetInfoHelper.getAssetInfo(s,i,o);n.next=this._applyTransactionEmitAsset(t,e,c,{senderId:e.senderId,senderPublicKeyBuffer:e.senderPublicKeyBuffer,recipientId:e.recipientId,assetInfo:l})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,purchaseAsset:n}=e.asset.dappPurchasing.dappAsset;return t.magic===r&&t.assetType===this.configHelper.assetType&&n||"0"}};dd=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,ph])],dd);var{ArgumentIllegalException:Rr}=Z("CONTROLLER","MarkTransactionFactory"),yd=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.dappTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Rr(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Rr(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Rr(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.dappid)throw new Rr(a.PROP_IS_REQUIRE,{prop:"dappid",...n});if(!e.storage)throw new Rr(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="dappid")throw new Rr(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"dappid",...n});const o=t.mark;if(!o)throw new Rr(a.PARAM_LOST,{param:"mark"});const c={...n,target:"markAsset"},l=o.dapp;if(this.dappTransactionFactory.verifyDAppAsset(l),e.dappid!==l.dappid)throw new Rr(a.NOT_MATCH,{to_compare_prop:`dappid ${i.value}`,be_compare_prop:`dappid ${l.dappid}`,to_target:"body",be_target:"mark",...n});if(i.value!==l.dappid)throw new Rr(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`dappid ${l.dappid}`,to_target:"storage",be_target:"mark",...n});const u=o.content;if(!u)throw new Rr(a.PROP_IS_REQUIRE,{prop:"content",...c});if(!s.isString(u))throw new Rr(a.PROP_IS_INVALID,{prop:`content ${u}`,type:"string",...c});if(u.length>1024)throw new Rr(a.OVER_LENGTH,{prop:`content ${u}`,limit:1024,...c});const g=o.action;if(!g)throw new Rr(a.PROP_IS_REQUIRE,{prop:"action",...c});if(!s.isString(g))throw new Rr(a.PROP_IS_INVALID,{prop:`action ${g}`,type:"string",...c});const y=g.length;if(y<1||y>10)throw new Rr(a.NOT_IN_EXPECTED_RANGE,{prop:`action ${g}`,min:1,max:10,...c})}init(e,t){return sp.fromObject({...e,asset:t})}};yd=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,ph])],yd);var{ArgumentIllegalException:Tr}=Z("CONTROLLER","IssueAssetTransactionFactory"),md=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this,i=e.recipientId;if(!e.recipientId)throw new Tr(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.senderId===i)throw new Tr(a.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${i}`,...n});if(e.fromMagic!==r.magic)throw new Tr(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Tr(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Tr(a.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="assetType")throw new Tr(a.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const c=t.issueAsset;if(!c)throw new Tr(a.PARAM_LOST,{param:"issueAsset"});const l={...n,target:"issueAssetAsset"},{sourceChainName:u,sourceChainMagic:g,assetType:y,expectedIssuedAssets:m}=c;if(this.checkChainName(u,"sourceChainName",l),u!==r.chainName)throw new Tr(a.SHOULD_BE,{to_compare_prop:`sourceChainName ${u}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(g,"sourceChainMagic",l),g!==r.magic)throw new Tr(a.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${g}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!y)throw new Tr(a.PROP_IS_REQUIRE,{prop:"assetType",...l});if(!s.isUpperCaseLetter(y))throw new Tr(a.PROP_IS_INVALID,{prop:`assetType ${y}`,type:"uppercase",...l});const d=y.length;if(d<3||d>10)throw new Tr(a.NOT_IN_EXPECTED_RANGE,{prop:`assetType ${y}`,type:"string length",min:3,max:10,...l});if(o.value!==y)throw new Tr(a.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`assetType ${y}`,to_target:"storage",be_target:"issueAsset",...n});if(!m)throw new Tr(a.PROP_IS_REQUIRE,{prop:"expectedIssuedAssets",...l});if(!s.isValidAssetNumber(m))throw new Tr(a.PROP_IS_INVALID,{prop:`expectedIssuedAssets ${m}`,type:"asset number",...l});if(BigInt(m)<BigInt(0))throw new Tr(a.PROP_SHOULD_GT_FIELD,{prop:"expectedIssuedAssets",field:"0",...l})}init(e,t){return ip.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{sourceChainName:c,sourceChainMagic:l,assetType:u,expectedIssuedAssets:g}=e.asset.issueAsset;n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,accountStatus:16}});const y=this.chainAssetInfoHelper.getAssetInfo(c,l,u);n.next=t.emit("issueAsset",{type:"issueAsset",transaction:e,applyInfo:{address:s,genesisAddress:i,publicKeyBuffer:o,sourceChainName:c,assetInfo:y,amount:g,sourceAmount:g}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,expectedIssuedAssets:s}=e.asset.issueAsset;return t.magic===r&&t.assetType===n?s:"0"}};md=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],md);var{ArgumentIllegalException:Sr}=Z("CONTROLLER","IncreaseAssetTransactionFactory"),_d=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Sr(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Sr(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Sr(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Sr(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="assetType")throw new Sr(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const o=t.increaseAsset;if(!o)throw new Sr(a.PARAM_LOST,{param:"increaseAsset"});const c={...n,target:"increaseAssetAsset"},{applyAddress:l,sourceChainName:u,sourceChainMagic:g,assetType:y,increasedAssetPrealnum:m,frozenMainAssetPrealnum:d}=o;if(!await this.accountBaseHelper.isAddress(l))throw new Sr(a.PROP_IS_INVALID,{prop:`applyAddress ${l}`,type:"account address",...n,target:"increaseAsset"});if(this.checkChainName(u,"sourceChainName",c),u!==r.chainName)throw new Sr(a.SHOULD_BE,{to_compare_prop:`sourceChainName ${u}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(g,"sourceChainMagic",c),g!==r.magic)throw new Sr(a.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${g}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(this.checkAssetType(G.ASSETS,y,"assetType",c),y===r.assetType)throw new Sr(a.SHOULD_NOT_BE,{to_compare_prop:`assetType ${y}`,to_target:"body",be_compare_prop:"local chain assetType",...n});if(i.value!==y)throw new Sr(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`assetType ${y}`,to_target:"storage",be_target:"increaseAsset",...n});if(!m)throw new Sr(a.PROP_IS_REQUIRE,{prop:"increasedAssetPrealnum",...c});if(!s.isValidAssetNumber(m))throw new Sr(a.PROP_IS_INVALID,{prop:`increasedAssetPrealnum ${m}`,type:"asset number",...c});if(BigInt(m)<=BigInt(0))throw new Sr(a.PROP_SHOULD_GT_FIELD,{prop:"increasedAssetPrealnum",field:"0",...c});if(!d)throw new Sr(a.PROP_IS_REQUIRE,{prop:"frozenMainAssetPrealnum",...c});if(!s.isValidAssetNumber(d))throw new Sr(a.PROP_IS_INVALID,{prop:`frozenMainAssetPrealnum ${d}`,type:"asset number",...c})}init(e,t){return ap.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{applyAddress:c,sourceChainName:l,sourceChainMagic:u,assetType:g,increasedAssetPrealnum:y,frozenMainAssetPrealnum:m}=e.asset.increaseAsset,d=this.chainAssetInfoHelper.getAssetInfo(l,u,g);n.next=t.emit("increaseAsset",{type:"increaseAsset",transaction:e,applyInfo:{address:s,recipientId:i,applyAddress:c,publicKeyBuffer:o,sourceChainName:l,assetInfo:d,amount:y,sourceAmount:y,frozenMainAssetPrealnum:m}});const I=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,m,{senderId:e.senderId,senderPublicKeyBuffer:e.senderPublicKeyBuffer,recipientId:c,assetInfo:I})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,increasedAssetPrealnum:s}=e.asset.increaseAsset;return t.magic===r&&t.assetType===n?s:"0"}};_d=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],_d);var{ArgumentIllegalException:Fo}=Z("CONTROLLER","TransferTransactionFactory"),Pl=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async commonVerifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const s=e.recipientId;if(!s)throw new Fo(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.senderId===s)throw new Fo(a.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${s}`,...n});if(e.fromMagic!==r.magic)throw new Fo(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Fo(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Fo(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="assetType")throw new Fo(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"assetType",...n});return i}};Pl=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Pl);var{ArgumentIllegalException:eA}=Z("CONTROLLER","TransferAssetTransactionFactory"),xl=class extends Pl{async verifyTransactionBody(e,t,r=this.configHelper){const n={target:"transferAssetAsset"},s=await super.commonVerifyTransactionBody(e,t,r),i=t.transferAsset;if(!i)throw new eA(a.PARAM_LOST,{param:"transferAsset"});const{sourceChainMagic:o,sourceChainName:c,assetType:l,amount:u}=i;if(o===this.configHelper.magic&&(this.checkChainName(c,"sourceChainName",n),this.checkChainMagic(o,"sourceChainMagic",n),this.checkAsset(l,"assetType",n)),s.value!==l)throw new eA(a.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`assetType ${l}`,to_target:"storage",be_target:"transferAsset"});this.checkAssetAmount(u,"amount",n)}init(e,t){return op.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{amount:s,assetType:i,sourceChainMagic:o,sourceChainName:c}=e.asset.transferAsset,l=this.chainAssetInfoHelper.getAssetInfo(c,o,i);n.next=this._applyTransactionEmitAsset(t,e,s,{senderId:e.senderId,senderPublicKeyBuffer:e.senderPublicKeyBuffer,recipientId:e.recipientId,assetInfo:l})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.transferAsset;return t.magic===r&&t.assetType===n?s:"0"}};xl=p([j()],xl);var{ArgumentIllegalException:Uo}=Z("CONTROLLER","TransferAnyTransactionFactory"),Bl=class extends Pl{async verifyTransactionBody(e,t,r=this.configHelper){const n=await super.commonVerifyTransactionBody(e,t,r),s={target:"transferAnyAsset"};if(n.key!=="assetType")throw new Uo(a.SHOULD_BE,{to_compare_prop:`storage.key ${n.key}`,to_target:"storage",be_compare_prop:"assetType",...s});const i=t.transferAny;if(!i)throw new Uo(a.PARAM_LOST,{param:"transferAny"});const{sourceChainMagic:o,sourceChainName:c,parentAssetType:l,assetType:u,taxInformation:g}=i;if(o===this.configHelper.magic&&(this.checkChainName(c,"sourceChainName",s),this.checkChainMagic(o,"sourceChainMagic",s),this.checkAssetType(l,u,"assetType",s)),n.value!==u)throw new Uo(a.NOT_MATCH,{to_compare_prop:`storage.value ${n.value}`,be_compare_prop:`assetType ${u}`,to_target:"storage",be_target:"transferAny",...s});if(this.checkAssetAmount(i.amount,"amount",s),l!==G.ASSETS&&i.amount!=="1")throw new Uo(a.SHOULD_BE,{to_compare_prop:`amount ${i.amount}`,to_target:"transferAny",be_compare_prop:"1"});if(l===G.ENTITY)await this.checkTaxInformation(s,g);else if(g)throw new Uo(a.SHOULD_NOT_EXIST,{prop:"taxInformation",...s})}init(e,t){return Ep.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,recipientId:o,asset:c}=e,{amount:l,assetType:u,sourceChainMagic:g,sourceChainName:y,parentAssetType:m,taxInformation:d}=c.transferAny;if(m===G.ASSETS){const I=this.chainAssetInfoHelper.getAssetInfo(y,g,u);n.next=this._applyTransactionEmitAsset(t,e,l,{senderId:s,senderPublicKeyBuffer:i,recipientId:o,assetInfo:I})}else if(m===G.DAPP)n.next=t.emit("changeDAppidPossessor",{type:"changeDAppidPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,possessorAddress:o,sourceChainName:y,sourceChainMagic:g,dappid:u}});else if(m===G.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,possessorAddress:o,sourceChainName:y,sourceChainMagic:g,name:u}});else if(m===G.ENTITY&&d){n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,possessorAddress:o,sourceChainName:y,sourceChainMagic:g,entityId:u}}),n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:y,sourceChainMagic:g,parentAssetType:m,assetType:u,taxInformation:d.toJSON()}});const I=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,d.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:i,recipientId:d.taxCollector,assetInfo:I})}else if(m===G.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,possessorAddress:o,sourceChainName:y,sourceChainMagic:g,certificateId:u}});else throw new Uo(a.PROP_IS_INVALID,{prop:`parentAssetType ${m}`,target:"transaction.asset.transferAsset"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.transferAny;return t.magic===r&&t.assetType===n?s:"0"}};Bl=p([j()],Bl);var{ArgumentIllegalException:Fn}=Z("CONTROLLER","DestroyAssetTransactionFactory"),Hl=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const s=e.recipientId;if(!s)throw new Fn(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.senderId===s)throw new Fn(a.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${s}`,...n});if(e.fromMagic!==r.magic)throw new Fn(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Fn(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Fn(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="assetType")throw new Fn(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const o=t.destroyAsset;if(!o)throw new Fn(a.PARAM_LOST,{param:"destroyAsset"});const c={...n,target:"destroyAssetAsset"},{sourceChainMagic:l,sourceChainName:u,assetType:g}=o;if(u!==r.chainName)throw new Fn(a.SHOULD_BE,{to_compare_prop:"sourceChainName",to_target:"body",be_compare_prop:"local chain name",...c});if(l!==r.magic)throw new Fn(a.SHOULD_BE,{to_compare_prop:"sourceChainMagic",to_target:"body",be_compare_prop:"local chain magic",...c});if(this.checkAsset(g,"assetType",c),g===r.assetType)throw new Fn(a.SHOULD_NOT_BE,{to_compare_prop:"assetType",to_target:"destroyAsset",be_compare_prop:r.assetType,...c});if(i.value!==g)throw new Fn(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`assetType ${g}`,to_target:"storage",be_target:"destroyAsset",...n});this.checkAssetAmount(o.amount,"amount",c)}init(e,t){return cp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,recipientId:o}=e,{amount:c,assetType:l,sourceChainMagic:u,sourceChainName:g}=e.asset.destroyAsset,y=this.chainAssetInfoHelper.getAssetInfo(g,u,l);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:y,amount:`-${c}`,sourceAmount:c}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:o,publicKeyBuffer:i,assetInfo:y,amount:c,sourceAmount:c}}),n.next=t.emit("destroyAsset",{type:"destroyAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:e.senderPublicKeyBuffer,assetsApplyAddress:o,assetInfo:y,amount:c,sourceAmount:c}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.destroyAsset;return t.magic===r&&t.assetType===n?s:"0"}};Hl=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Hl);var{ArgumentIllegalException:en}=Z("CONTROLLER","ToExchangeAssetTransactionFactory"),kl=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new en(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new en(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new en(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});const s=t.toExchangeAsset;if(this.verifyToExchangeAsset(s,r),s.toExchangeNumber==="0")throw new en(a.PROP_SHOULD_GT_FIELD,{prop:"toExchangeNumber",field:"0",target:"toExchangeAsset"});if(e.storage)throw new en(a.SHOULD_NOT_EXIST,{prop:"storage",...n})}verifyToExchangeAsset(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new en(a.PARAM_LOST,{param:"toExchangeAsset"});const n={target:"toExchangeAssetAsset"},s=e.cipherPublicKeys,i=new Set(s);if(s.length!==i.size)throw new en(a.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(s))throw new en(a.PROP_IS_INVALID,{prop:"cipherPublicKeys",...n});if(e.toExchangeSource===this.configHelper.magic&&(this.checkChainName(e.toExchangeChainName,"toExchangeChainName",n),this.checkChainMagic(e.toExchangeSource,"toExchangeSource",n),this.checkAsset(e.toExchangeAsset,"toExchangeAsset",n)),e.beExchangeSource===this.configHelper.magic&&(this.checkChainName(e.beExchangeChainName,"beExchangeChainName",n),this.checkChainMagic(e.beExchangeSource,"beExchangeSource",n),this.checkAsset(e.beExchangeAsset,"beExchangeAsset",n)),!e.toExchangeNumber)throw new en(a.PROP_IS_REQUIRE,{prop:"toExchangeNumber",...n});if(!r.isValidAssetNumber(e.toExchangeNumber))throw new en(a.PROP_IS_INVALID,{prop:"toExchangeNumber",type:"asset number",...n});if(e.toExchangeNumber==="0")throw new en(a.PROP_SHOULD_GT_FIELD,{prop:"toExchangeNumber",field:"0",...n});if(!r.isValidRate(e.exchangeRate))throw new en(a.PROP_IS_INVALID,{prop:`exchangeRate ${JSON.stringify(e.exchangeRate)}`,type:"rate",...n});if(e.toExchangeAsset===e.beExchangeAsset)throw new en(a.SHOULD_NOT_BE,{to_compare_prop:`toExchangeAsset ${e.toExchangeAsset}`,to_target:"toExchangeAsset",be_compare_prop:e.beExchangeAsset})}init(e,t){return Wa.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{toExchangeChainName:s,toExchangeSource:i,toExchangeAsset:o,toExchangeNumber:c}=e.asset.toExchangeAsset,l=this.chainAssetInfoHelper.getAssetInfo(s,i,o);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:l,amount:`-${c}`,sourceAmount:c,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:e.signature,frozenReason:it.EXCHANGE}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeSource:s,toExchangeAsset:i,toExchangeNumber:o}=e.asset.toExchangeAsset;return r===s&&n===i?o:"0"}};kl=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],kl);var{ArgumentIllegalException:jt}=Z("CONTROLLER","BeExchangeAssetTransactionFactory"),Ad=class extends Ge{constructor(e,t,r,n,s,i,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=i,this.toExchangeAssetTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s,jsbiHelper:i}=this;if(!e.recipientId)throw new jt(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new jt(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new jt(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new jt(a.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="transactionSignature")throw new jt(a.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const c=t.beExchangeAsset;if(!c)throw new jt(a.PARAM_LOST,{param:"beExchangeAsset"});const l={...n,target:"beExchangeAsset"},{transactionSignature:u}=c;if(!u)throw new jt(a.PROP_IS_REQUIRE,{prop:"transactionSignature",...l});if(!s.isValidSignature(u))throw new jt(a.PROP_IS_INVALID,{prop:`transactionSignature ${u}`,type:"transaction signature",...l});if(o.value!==u)throw new jt(a.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`transactionSignature ${u}`,to_target:"storage",be_target:"beExchangeAsset",...n});const{toExchangeNumber:g,beExchangeNumber:y}=c;if(!g)throw new jt(a.PROP_IS_REQUIRE,{prop:"toExchangeNumber",...l});if(!s.isValidAssetNumber(g))throw new jt(a.PROP_IS_INVALID,{prop:"toExchangeNumber",type:"asset number",...l});if(!y)throw new jt(a.PROP_IS_REQUIRE,{prop:"beExchangeNumber",...l});if(!s.isValidAssetNumber(y))throw new jt(a.PROP_IS_INVALID,{prop:"beExchangeNumber",type:"asset number",...l});const{exchangeAsset:m,ciphertextSignature:d}=c;if(this.toExchangeAssetTransactionFactory.verifyToExchangeAsset(m),BigInt(g)>BigInt(m.toExchangeNumber))throw new jt(a.PROP_SHOULD_LTE_FIELD,{prop:`toExchangeNumber ${g}`,field:m.toExchangeNumber,...l});if(!s.isValidRate(m.exchangeRate))throw new jt(a.PROP_IS_INVALID,{prop:`exchangeRate ${m.exchangeRate}`,type:"rate",...l});const{cipherPublicKeys:I}=m;if(I.length>0){if(!d)throw new jt(a.NOT_EXIST,{prop:`ciphertextSignature ${d}`,...l});if(!s.isValidAccountSignature(d))throw new jt(a.PROP_IS_INVALID,{prop:`ciphertextSignature ${d}`,...l});const{signature:T,publicKey:S}=d;if(!I.includes(S))throw new jt(a.NOT_MATCH,{to_compare_prop:`publicKey ${S}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...l});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:me(S),ciphertextSignatureBuffer:me(T),transactionSignatureBuffer:me(u),senderId:e.senderId}))throw new jt(a.PROP_IS_INVALID,{prop:`ciphertextSignature ${T}`,type:"signature",...l})}else if(d)throw new jt(a.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${d}`,...l})}init(e,t){return gp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{exchangeAsset:s,toExchangeNumber:i,beExchangeNumber:o}=e.asset.beExchangeAsset,{toExchangeChainName:c,toExchangeSource:l,toExchangeAsset:u,beExchangeChainName:g,beExchangeSource:y,beExchangeAsset:m}=s,d=this.chainAssetInfoHelper.getAssetInfo(g,y,m);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:d,amount:`-${o}`,sourceAmount:o}});const I=e.recipientId;n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:I,assetInfo:d,amount:o,sourceAmount:o}});const T=this.chainAssetInfoHelper.getAssetInfo(c,l,u);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:T,amount:i,sourceAmount:i,recipientId:I,frozenId:e.asset.beExchangeAsset.transactionSignature,frozenReason:it.EXCHANGE}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{exchangeAsset:s,toExchangeNumber:i,beExchangeNumber:o}=e.asset.beExchangeAsset,{toExchangeSource:c,beExchangeSource:l,toExchangeAsset:u,beExchangeAsset:g}=s;return r===c&&n===u?i:r===l&&n===g?o:"0"}};Ad=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,St,kl])],Ad);var{ArgumentIllegalException:$o}=Z("CONTROLLER","GiftTransactionFactory"),Ll=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=i}async commonVerifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new $o(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new $o(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new $o(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new $o(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="assetType")throw new $o(a.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"assetType",...n});return s}checkTransactionFee(e,t,r=this.configHelper){const{maxTransactionSize:n,minTransactionFeePerByte:s}=r,i=n*(t+1),o={numerator:BigInt(e),denominator:i};if(this.jsbiHelper.compareFraction(o,s)<0){const c=this.jsbiHelper.multiplyCeilFraction(o.denominator,s).toString();throw new $o(a.TRANSACTION_FEE_NOT_ENOUGH,{errorId:Ce.TRANSACTION_FEE_NOT_ENOUGH,minFee:c.toString(),target:"body"})}}};Ll=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,St])],Ll);var{ArgumentIllegalException:fs}=Z("CONTROLLER","GiftAssetTransactionFactory"),Ml=class extends Ll{async verifyTransactionBody(e,t,r=this.configHelper){const n=await this.commonVerifyTransactionBody(e,t,r),s=t.giftAsset;if(this.verifyGiftAsset(s,r),s.giftDistributionRule===2&&e.rangeType!==1)throw new fs(a.SHOULD_BE,{to_compare_prop:`rangeType ${e.rangeType}`,to_target:"body",be_compare_prop:1});if(s.beginUnfrozenBlockHeight&&s.beginUnfrozenBlockHeight>=e.effectiveBlockHeight)throw new fs(a.PROP_SHOULD_LT_FIELD,{prop:`beginUnfrozenBlockHeight ${s.beginUnfrozenBlockHeight}`,field:e.effectiveBlockHeight,target:"giftAsset"});if(n.value!==s.assetType)throw new fs(a.NOT_MATCH,{to_compare_prop:`storage.value ${n.value}`,be_compare_prop:`assetType ${s.assetType}`,to_target:"storage",be_target:"giftAsset"});this.checkTransactionFee(e.fee,s.totalGrabableTimes,r)}verifyGiftAsset(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new fs(a.PARAM_LOST,{param:"giftAsset"});const n={target:"giftAssetAsset"},s=e.cipherPublicKeys,i=new Set(s);if(s.length!==i.size)throw new fs(a.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(s))throw new fs(a.PROP_IS_INVALID,{prop:"cipherPublicKeys",type:"cipher publicKeys",...n});const{sourceChainMagic:o,sourceChainName:c,assetType:l,amount:u,giftDistributionRule:g,totalGrabableTimes:y,beginUnfrozenBlockHeight:m}=e;if(o===this.configHelper.magic&&(this.checkChainName(c,"sourceChainName",n),this.checkChainMagic(o,"sourceChainMagic",n),this.checkAsset(l,"assetType",n)),!r.isPositiveInteger(y))throw new fs(a.PROP_IS_INVALID,{prop:`totalGrabableTimes ${y}`,type:"positive integer",...n});if(y>t.maxGrabTimesOfGiftAsset)throw new fs(a.PROP_SHOULD_LTE_FIELD,{prop:`totalGrabableTimes ${y}`,field:t.maxGrabTimesOfGiftAsset,...n});if(m!==void 0&&!r.isPositiveInteger(m))throw new fs(a.PROP_IS_INVALID,{prop:`beginUnfrozenBlockHeight ${m}`,type:"positive integer",...n});if(g!==1&&g!==0&&g!==2)throw new fs(a.PROP_IS_INVALID,{prop:`giftDistributionRule ${g}`,type:"enum of GIFT_DISTRIBUTION_RULE",...n});this.checkAssetAmount(u,"amount",n)}init(e,t){return Ji.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{chainAssetInfoHelper:s}=this,{amount:i,assetType:o,sourceChainMagic:c,sourceChainName:l,totalGrabableTimes:u}=e.asset.giftAsset,g=s.getAssetInfo(l,c,o),y=this.transactionHelper.getTransactionMinEffectiveHeight(e),m=this.transactionHelper.getTransactionMaxEffectiveHeight(e);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:g,amount:`-${i}`,sourceAmount:i,minEffectiveHeight:y,maxEffectiveHeight:m,totalUnfrozenTimes:u,frozenId:e.signature,frozenReason:it.GIFT}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.giftAsset;return t.magic===r&&t.assetType===n?s:"0"}};Ml=p([j()],Ml);var{ArgumentIllegalException:br}=Z("CONTROLLER","GiftAnyTransactionFactory"),hh=class extends Ll{async verifyTransactionBody(e,t,r=this.configHelper){const n=await this.commonVerifyTransactionBody(e,t,r),s=t.giftAny;if(await this.verifyGiftAny(s,r),s.giftDistributionRule===2&&e.rangeType!==1)throw new br(a.SHOULD_BE,{to_compare_prop:`rangeType ${e.rangeType}`,to_target:"body",be_compare_prop:1});if(s.beginUnfrozenBlockHeight&&s.beginUnfrozenBlockHeight>=e.effectiveBlockHeight)throw new br(a.PROP_SHOULD_LT_FIELD,{prop:`beginUnfrozenBlockHeight ${s.beginUnfrozenBlockHeight}`,field:e.effectiveBlockHeight,target:"giftAsset"});if(n.value!==s.assetType)throw new br(a.NOT_MATCH,{to_compare_prop:`storage.value ${n.value}`,be_compare_prop:`assetType ${s.assetType}`,to_target:"storage",be_target:"giftAsset"});this.checkTransactionFee(e.fee,s.totalGrabableTimes,r)}async verifyGiftAny(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new br(a.PARAM_LOST,{param:"giftAny"});const n={target:"giftAnyAsset"},s=e.cipherPublicKeys,i=new Set(s);if(s.length!==i.size)throw new br(a.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(e.cipherPublicKeys))throw new br(a.PROP_IS_INVALID,{prop:"cipherPublicKeys",...n});const{sourceChainMagic:o,sourceChainName:c,parentAssetType:l,assetType:u,amount:g,giftDistributionRule:y,totalGrabableTimes:m,beginUnfrozenBlockHeight:d,taxInformation:I}=e;if(o===this.configHelper.magic&&(this.checkChainName(c,"sourceChainName",n),this.checkChainMagic(o,"sourceChainMagic",n),this.checkAssetType(l,u,"assetType",n)),!r.isPositiveInteger(m))throw new br(a.PROP_IS_INVALID,{prop:`totalGrabableTimes ${m}`,type:"positive integer",...n});if(m>t.maxGrabTimesOfGiftAsset)throw new br(a.PROP_SHOULD_LTE_FIELD,{prop:`totalGrabableTimes ${m}`,field:t.maxGrabTimesOfGiftAsset,...n});if(d!==void 0&&!r.isPositiveInteger(d))throw new br(a.PROP_IS_INVALID,{prop:`beginUnfrozenBlockHeight ${e.beginUnfrozenBlockHeight}`,type:"positive integer",...n});if(this.checkAssetAmount(g,"amount",n),l===G.ASSETS){if(y===void 0)throw new br(a.PROP_IS_REQUIRE,{prop:"giftDistributionRule",...n});if(y!==1&&y!==0&&y!==2)throw new br(a.PROP_IS_INVALID,{prop:`giftDistributionRule ${y}`,type:"enum of GIFT_DISTRIBUTION_RULE",...n})}else{if(m!==1)throw new br(a.SHOULD_BE,{to_compare_prop:`totalGrabableTimes ${m}`,to_target:"giftAny",be_compare_prop:1});if(g!=="1")throw new br(a.SHOULD_BE,{to_compare_prop:`amount ${g}`,to_target:"giftAny",be_compare_prop:"1"});if(y!==void 0)throw new br(a.SHOULD_NOT_EXIST,{prop:"giftDistributionRule",target:"giftAny"})}if(l===G.ENTITY)await this.checkTaxInformation(n,I);else if(I)throw new br(a.SHOULD_NOT_EXIST,{prop:"taxInformation",...n})}init(e,t){return qi.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{chainAssetInfoHelper:s}=this,{senderId:i,senderPublicKeyBuffer:o,signature:c,asset:l}=e,{taxInformation:u,amount:g,assetType:y,parentAssetType:m,sourceChainMagic:d,sourceChainName:I,totalGrabableTimes:T}=l.giftAny,S=this.transactionHelper.getTransactionMinEffectiveHeight(e),w=this.transactionHelper.getTransactionMaxEffectiveHeight(e);if(m===G.ASSETS){const b=s.getAssetInfo(I,d,y);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:i,publicKeyBuffer:o,assetInfo:b,amount:`-${g}`,sourceAmount:g,minEffectiveHeight:S,maxEffectiveHeight:w,totalUnfrozenTimes:T,frozenId:c,frozenReason:it.GIFT}})}else if(m===G.DAPP)n.next=t.emit("frozenDAppid",{type:"frozenDAppid",transaction:e,applyInfo:{address:i,sourceChainName:I,sourceChainMagic:d,dappid:y,minEffectiveHeight:S,maxEffectiveHeight:w,status:17,frozenId:c}});else if(m===G.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:i,sourceChainName:I,sourceChainMagic:d,name:y,minEffectiveHeight:S,maxEffectiveHeight:w,status:17,frozenId:c}});else if(m===G.ENTITY&&u){n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:i,sourceChainName:I,sourceChainMagic:d,entityId:y,minEffectiveHeight:S,maxEffectiveHeight:w,status:17,frozenId:c}}),n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:I,sourceChainMagic:d,parentAssetType:m,assetType:y,taxInformation:u.toJSON()}});const{taxAssetPrealnum:b}=u;if(b!=="0"){const R=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:i,publicKeyBuffer:o,assetInfo:R,amount:`-${b}`,sourceAmount:b,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:c,frozenReason:it.GIFT}})}}else if(m===G.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:i,sourceChainName:I,sourceChainMagic:d,certificateId:y,minEffectiveHeight:S,maxEffectiveHeight:w,status:17,frozenId:c}});else throw new br(a.PROP_IS_INVALID,{prop:`parentAssetType ${m}`,target:"transaction.asset.giftAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.giftAny;return t.magic===r&&t.assetType===n?s:"0"}};hh=p([j()],hh);var{ArgumentIllegalException:wr}=Z("CONTROLLER","GrabAssetTransactionFactory"),Id=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.__giftAssetTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new wr(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new wr(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new wr(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new wr(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="transactionSignature")throw new wr(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const o=t.grabAsset;if(!o)throw new wr(a.PARAM_LOST,{param:"grabAsset"});const c={...n,target:"grabAssetAsset"},{blockSignature:l,transactionSignature:u}=o;if(!l)throw new wr(a.PROP_IS_REQUIRE,{prop:"blockSignature",...c});if(!s.isValidSignature(l))throw new wr(a.PROP_IS_INVALID,{prop:`blockSignature ${l}`,type:"block signature",...c});if(!u)throw new wr(a.PROP_IS_REQUIRE,{prop:"transactionSignature",...c});if(!s.isValidSignature(u))throw new wr(a.PROP_IS_INVALID,{prop:`transactionSignature ${u}`,type:"transaction signature",...c});if(i.value!==u)throw new wr(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`transactionSignature ${u}`,to_target:"storage",be_target:"grabAsset",...n});this.checkAssetAmount(o.amount,"amount",c);const{giftAsset:g,ciphertextSignature:y}=o;this.__giftAssetTransactionFactory.verifyGiftAsset(g);const{cipherPublicKeys:m}=g;if(m.length>0){if(!y)throw new wr(a.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...c});if(!s.isValidAccountSignature(y))throw new wr(a.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...c});const{publicKey:d,signature:I}=y;if(!m.includes(d))throw new wr(a.NOT_MATCH,{to_compare_prop:`publicKey ${d}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...c});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:me(d),ciphertextSignatureBuffer:me(I),transactionSignatureBuffer:me(u),senderId:e.senderId}))throw new wr(a.PROP_IS_INVALID,{prop:`ciphertextSignature ${I}`,type:"signature",...c})}else if(y)throw new wr(a.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${y}`,type:"grabAsset",...c})}init(e,t){return pp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{const{chainAssetInfoHelper:s}=this,{grabAsset:i}=e.asset,{amount:o,transactionSignature:c}=i,{assetType:l,sourceChainMagic:u,sourceChainName:g}=i.giftAsset,y=e.recipientId,m=s.getAssetInfo(g,u,l);n.next=super.applyTransaction(e,t,r),n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:m,amount:o,sourceAmount:o,recipientId:y,frozenId:c,frozenReason:it.GIFT}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{amount:r,giftAsset:n}=e.asset.grabAsset,{sourceChainMagic:s,assetType:i}=n;return t.magic===s&&t.assetType===i?r:"0"}};Id=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,Ml])],Id);var{ArgumentIllegalException:hr}=Z("CONTROLLER","GrabAnyTransactionFactory"),Dl=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.__giftAnyTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new hr(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new hr(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new hr(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new hr(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="transactionSignature")throw new hr(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const o=t.grabAny;if(!o)throw new hr(a.PARAM_LOST,{param:"grabAny"});const c={...n,target:"grabAnyAsset"},{blockSignature:l,transactionSignature:u}=o;if(!l)throw new hr(a.PROP_IS_REQUIRE,{prop:"blockSignature",...c});if(!s.isValidSignature(l))throw new hr(a.PROP_IS_INVALID,{prop:`blockSignature ${l}`,type:"block signature",...c});if(!u)throw new hr(a.PROP_IS_REQUIRE,{prop:"transactionSignature",...c});if(!s.isValidSignature(u))throw new hr(a.PROP_IS_INVALID,{prop:`transactionSignature ${u}`,type:"transaction signature",...c});if(i.value!==u)throw new hr(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`transactionSignature ${u}`,to_target:"storage",be_target:"grabAsset",...n});this.checkAssetAmount(o.amount,"amount",c);const{giftAny:g,ciphertextSignature:y}=o;await this.__giftAnyTransactionFactory.verifyGiftAny(g);const{cipherPublicKeys:m}=g;if(m.length>0){if(!y)throw new hr(a.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...c});if(!s.isValidAccountSignature(y))throw new hr(a.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...c});const{publicKey:d,signature:I}=y;if(!m.includes(d))throw new hr(a.NOT_MATCH,{to_compare_prop:`publicKey ${d}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...c});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:me(d),ciphertextSignatureBuffer:me(I),transactionSignatureBuffer:me(u),senderId:e.senderId}))throw new hr(a.PROP_IS_INVALID,{prop:`ciphertextSignature ${I}`,type:"signature",...c})}else if(y)throw new hr(a.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${y}`,type:"grabAsset",...c})}init(e,t){return Tp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{const{chainAssetInfoHelper:s}=this,{senderId:i,recipientId:o,senderPublicKeyBuffer:c,asset:l}=e,{amount:u,giftAny:g,transactionSignature:y}=l.grabAny,{assetType:m,parentAssetType:d,sourceChainMagic:I,sourceChainName:T}=g,S=s.getAssetInfo(T,I,m);if(n.next=super.applyTransaction(e,t,r),d===G.ASSETS)n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:i,publicKeyBuffer:c,assetInfo:S,amount:u,sourceAmount:u,recipientId:o,frozenId:y,frozenReason:it.GIFT}});else if(d===G.DAPP)n.next=t.emit("unfrozenDAppid",{type:"unfrozenDAppid",transaction:e,applyInfo:{address:i,publicKeyBuffer:c,possessorAddress:i,sourceChainName:T,sourceChainMagic:I,dappid:m,status:0,frozenId:y}});else if(d===G.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:i,publicKeyBuffer:c,possessorAddress:i,sourceChainName:T,sourceChainMagic:I,name:m,status:0,frozenId:y}});else if(d===G.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:i,publicKeyBuffer:c,possessorAddress:i,sourceChainName:T,sourceChainMagic:I,entityId:m,status:0,frozenId:y}}),g.taxInformation){const{taxCollector:w,taxAssetPrealnum:b}=g.taxInformation,R=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);b==="0"?n.next=this._applyTransactionEmitAsset(t,e,b,{senderId:i,senderPublicKeyBuffer:c,recipientId:w,assetInfo:R}):n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:w,publicKeyBuffer:c,assetInfo:R,amount:b,sourceAmount:b,recipientId:o,frozenId:y,frozenReason:it.GIFT}})}}else if(d===G.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:i,publicKeyBuffer:c,possessorAddress:i,sourceChainName:T,sourceChainMagic:I,certificateId:m,status:0,frozenId:y}});else throw new hr(a.PROP_IS_INVALID,{prop:`parentAssetType ${d}`,target:"transaction.asset.grabAny.giftAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{amount:r,giftAny:n}=e.asset.grabAny,{sourceChainMagic:s,assetType:i}=n;return t.magic===s&&t.assetType===i?r:"0"}};Dl=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,hh])],Dl);var{ArgumentIllegalException:rr}=Z("CONTROLLER","TrustAssetTransactionFactory"),Fl=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{senderId:s,recipientId:i}=e;if(!i)throw new rr(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(s===i)throw new rr(a.SHOULD_NOT_BE,{to_compare_prop:`senderId ${s}`,to_target:"body",be_compare_prop:`recipientId ${i}`,...n});if(e.fromMagic!==r.magic)throw new rr(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new rr(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new rr(a.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="assetType")throw new rr(a.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const c=t.trustAsset;await this.verifyTrustAsset(c,s,i);const l=c.trustees;if(!l.includes(s))throw new rr(a.SHOULD_INCLUDE,{prop:"trustees",value:`senderId ${s}`,...n,target:"trustAsset"});if(!l.includes(i))throw new rr(a.SHOULD_INCLUDE,{prop:"trustee",value:`recipientId ${i}`,...n,target:"trustAsset"});if(o.value!==c.assetType)throw new rr(a.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`assetType ${c.assetType}`,to_target:"storage",be_target:"trustAsset",...n})}async verifyTrustAsset(e,t,r){const{baseHelper:n,accountBaseHelper:s}=this;if(!e)throw new rr(a.PARAM_LOST,{param:"trustAsset"});const i={target:"trustAssetAsset"},{trustees:o,numberOfSignFor:c,sourceChainName:l,sourceChainMagic:u}=e;if(!n.isArray(o))throw new rr(a.PROP_IS_INVALID,{prop:"trustees",type:"string array",...i,target:"trustAsset"});if(o.length<0)throw new rr(a.PROP_IS_REQUIRE,{prop:`trustees length ${o.length}`,...i});for(const y of o)if(!await s.isAddress(y))throw new rr(a.PROP_IS_INVALID,{prop:`trustee ${y}`,type:"account address",target:"trustees"});const g=[...new Set([...o,t,r])];if(o.length!==g.length)throw new rr(a.SHOULD_NOT_DUPLICATE,{prop:"trustee",...i});if(!n.isPositiveInteger(c))throw new rr(a.PROP_IS_INVALID,{prop:`numberOfSignFor ${c}`,type:"positive integer",...i});if(c>g.length)throw new rr(a.PROP_SHOULD_LTE_FIELD,{prop:`numberOfSignFor ${c}`,field:g.length,...i,target:"trustAsset"});if(c<1)throw new rr(a.PROP_SHOULD_GTE_FIELD,{prop:`numberOfSignFor ${c}`,field:1,...i,target:"trustAsset"});if(u===this.configHelper.magic&&(this.checkChainName(l,"sourceChainName",i),this.checkChainMagic(u,"sourceChainMagic",i),this.checkAsset(e.assetType,"assetType",i)),this.checkAssetAmount(e.amount,"amount",i),e.amount==="0")throw new rr(a.PROP_SHOULD_GT_FIELD,{prop:`amount ${e.amount}`,fueld:"0",...i})}init(e,t){return qa.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{amount:s,assetType:i,sourceChainMagic:o,sourceChainName:c,numberOfSignFor:l}=e.asset.trustAsset,u=this.chainAssetInfoHelper.getAssetInfo(c,o,i);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:u,amount:`-${s}`,sourceAmount:s,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),totalUnfrozenTimes:l,frozenId:e.signature,frozenReason:it.TRUST}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.trustAsset;return t.magic===r&&t.assetType===n?s:"0"}};Fl=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Fl);var{ArgumentIllegalException:Pr}=Z("CONTROLLER","signForAssetTransactionFactory"),Ed=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.trustAssetTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s,accountBaseHelper:i,transactionHelper:o}=this,c=e.recipientId;if(!c)throw new Pr(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});const l=e.senderId;if(e.fromMagic!==r.magic)throw new Pr(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Pr(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Pr(a.PROP_IS_REQUIRE,{prop:"storage",...n});const u=e.storage;if(u.key!=="transactionSignature")throw new Pr(a.SHOULD_BE,{to_compare_prop:`storage.key ${u.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const g={...n,target:"signForAssetAsset"},y=t.signForAsset;if(!y)throw new Pr(a.PARAM_LOST,{param:"signForAsset"});const{trustAsset:m,trustSenderId:d,trustRecipientId:I,transactionSignature:T}=y;if(!T)throw new Pr(a.PROP_IS_REQUIRE,{prop:"transactionSignature",...g});if(!s.isValidSignature(T))throw new Pr(a.PROP_IS_INVALID,{prop:`transactionSignature ${T}`,type:"transaction signature",...g});if(u.value!==T)throw new Pr(a.NOT_MATCH,{to_compare_prop:`storage.value ${u.value}`,be_compare_prop:`transactionSignature ${T}`,to_target:"storage",be_target:"signForAsset",...n});if(!d)throw new Pr(a.PROP_IS_REQUIRE,{prop:"trustSenderId",...g});if(!await i.isAddress(d))throw new Pr(a.PROP_IS_INVALID,{prop:`trustSenderId ${d}`,type:"account address",...n,target:"trustAsset"});if(!I)throw new Pr(a.PROP_IS_REQUIRE,{prop:"trustRecipientId",...g});if(!await i.isAddress(I))throw new Pr(a.PROP_IS_INVALID,{prop:`trustRecipientId ${I}`,type:"account address",...g});if(c!==I)throw new Pr(a.SHOULD_BE,{to_compare_prop:`recipientId ${c}`,to_target:"body",be_compare_prop:`trustRecipientId ${I}`,...g});await this.trustAssetTransactionFactory.verifyTrustAsset(m,d,I);const{trustees:S}=m;if(![...new Set([...S,d,I])].includes(l))throw new Pr(a.PERMISSION_DENIED,{operationName:`sign for asset ${T}`,...g})}init(e,t){return hp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{transactionSignature:s,trustSenderId:i,trustRecipientId:o,trustAsset:c}=e.asset.signForAsset,l=this.chainAssetInfoHelper.getAssetInfo(c.sourceChainName,c.sourceChainMagic,c.assetType);n.next=t.emit("signForAsset",{type:"signForAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:l,frozenAddress:i,recipientId:o,frozenId:s,frozenReason:it.TRUST}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.signForAsset.trustAsset;return t.magic===r&&t.assetType===n?s:"0"}};Ed=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,Fl])],Ed);var{ArgumentIllegalException:tn}=Z("CONTROLLER","EmigrateAssetTransactionFactory"),Td=class extends Ge{constructor(e,t,r,n,s,i){super(),this.baseHelper=e,this.configHelper=t,this.accountBaseHelper=r,this.transactionHelper=n,this.chainAssetInfoHelper=s,this.migrateCertificateHelper=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new tn(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new tn(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic===r.magic)throw new tn(a.SHOULD_NOT_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new tn(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="assetType")throw new tn(a.SHOULD_BE,{to_compare_prop:`key ${s.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const i=t.emigrateAsset;if(!i)throw new tn(a.PARAM_LOST,{param:"emigrateAsset"});if(!i.migrateCertificate)throw new tn(a.PROP_IS_REQUIRE,{prop:"migrateCertificate",target:"emigrateAsset"});let o;try{o=JSON.parse(i.migrateCertificate)}catch{throw new tn(a.PROP_IS_INVALID,{prop:"migrateCertificate",target:"emigrateAsset"})}const c=await this.migrateCertificateHelper.verifyMigrateCertificate(o,{forceCheckFromChainInfo:!0,fromChainBaseConfig:{chainName:r.chainName,magic:r.magic,generatorPublicKey:r.generatorPublicKey,genesisBlockSignature:r.signature,genesisGenerators:this.transactionHelper.genesisGenerators(r)},forceCheckFromAuthSignature:!0});if(o.toAuthSignature)throw new tn(a.SHOULD_NOT_EXIST,{prop:"toAuthSignature",...n,target:"aemigrateAsset.migrateCertificate"});const{toChainId:l,fromId:u,toId:g,assetId:y}=o.body,m=c.fromId.decode(u);if(e.senderId!==m)throw new tn(a.NOT_MATCH,{to_compare_prop:`senderId ${e.senderId}`,be_compare_prop:`fromId ${m}`,to_target:"body",be_target:"migrateCertificate",...n});const d=c.toId.decode(g);if(e.recipientId!==d)throw new tn(a.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`toId ${d}`,to_target:"body",be_target:"migrateCertificate",...n});const I=c.toChainId.decode(l);if(e.toMagic!==I.magic)throw new tn(a.NOT_MATCH,{to_compare_prop:`toMagic ${e.toMagic}`,be_compare_prop:`toChainId ${I.magic}`,to_target:"body",be_target:"migrateCertificate",...n});const T=c.assetId.decode(y);if(s.value!==T.assetType)throw new tn(a.NOT_MATCH,{to_compare_prop:`value ${s.value}`,be_compare_prop:`assetTypeId ${T.assetType}`,to_target:"storage",be_target:"migrateCertificateBody",...n})}init(e,t){return lp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i}=e;n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,accountStatus:17}})})}};Td=p([j(),h("design:paramtypes",[Re,re,de,_e,Le,Fs])],Td);var{ArgumentIllegalException:rn}=Z("CONTROLLER","ImmigrateAssetTransactionFactory"),Sd=class extends Ge{constructor(e,t,r,n,s,i){super(),this.baseHelper=e,this.configHelper=t,this.accountBaseHelper=r,this.transactionHelper=n,this.chainAssetInfoHelper=s,this.migrateCertificateHelper=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new rn(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic===r.magic)throw new rn(a.SHOULD_NOT_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new rn(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new rn(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="assetType")throw new rn(a.SHOULD_BE,{to_compare_prop:`key ${s.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const i=t.immigrateAsset;if(!i)throw new rn(a.PARAM_LOST,{param:"immigrateAsset"});const o={...n,target:"immigrateAsset"};if(!i.migrateCertificate)throw new rn(a.PROP_IS_REQUIRE,{prop:"migrateCertificate",...o});let c;try{c=JSON.parse(i.migrateCertificate)}catch{throw new rn(a.PROP_IS_INVALID,{prop:"migrateCertificate",...o})}const l=await this.migrateCertificateHelper.verifyMigrateCertificate(c,{forceCheckToChainInfo:!0,toChainBaseConfig:{chainName:r.chainName,magic:r.magic,generatorPublicKey:r.generatorPublicKey,genesisBlockSignature:r.signature,genesisGenerators:this.transactionHelper.genesisGenerators(r)},forceCheckToAuthSignature:!0,forceCheckFromAuthSignature:!0}),{fromChainId:u,toId:g,assetId:y}=c.body,m=l.toId.decode(g,!0);if(e.recipientId!==m)throw new rn(a.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`toId ${m}`,to_target:"body",be_target:"migrateCertificate",...n});const d=l.fromChainId.decode(u,!0);if(e.fromMagic!==d.magic)throw new rn(a.NOT_MATCH,{to_compare_prop:`fromMagic ${e.fromMagic}`,be_compare_prop:`fromChainId ${d.magic}`,to_target:"body",be_target:"migrateCertificate",...n});const I=l.assetId.decode(y,!0);if(s.value!==I.assetType)throw new rn(a.NOT_MATCH,{to_compare_prop:`value ${s.value}`,be_compare_prop:`asset ${JSON.stringify(I)}`,to_target:"storage",be_target:"migrateCertificate",...n})}init(e,t){return up.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);let s;try{s=JSON.parse(e.asset.immigrateAsset.migrateCertificate)}catch{throw new rn(a.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const i=this.migrateCertificateHelper.getMigrateCertificateConverter(s),{fromChainId:o,assetId:c,assetPrealnum:l}=s.body,u=i.fromChainId.decode(o),g=i.assetId.decode(c),{parentAssetType:y,assetType:m}=g;if(y===G.ASSETS){const d=this.chainAssetInfoHelper.getAssetInfo(u.chainName,u.magic,m);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:e.recipientId,assetInfo:d,amount:l,sourceAmount:l}})}else throw new Error("");n.next=t.emit("migrateCertificate",{type:"migrateCertificate",transaction:e,applyInfo:{migrateCertificateId:i.getUUID(s),assetInfo:{chainName:u.chainName,magic:u.magic,assetType:m},assets:l,migrateIdBuffer:e.signatureBuffer}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){let r;try{r=JSON.parse(e.asset.immigrateAsset.migrateCertificate)}catch{throw new rn(a.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const n=this.migrateCertificateHelper.getMigrateCertificateConverter(r),{fromChainId:s,assetId:i,assetPrealnum:o}=r.body,c=n.fromChainId.decode(s),l=n.assetId.decode(i);return t.magic===c.magic&&t.assetType===l.assetType?o:"0"}};Sd=p([j(),h("design:paramtypes",[Re,re,de,_e,Le,Fs])],Sd);var{ArgumentIllegalException:Un}=Z("CONTROLLER","StakeAssetTransactionFactory"),Ul=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new Un(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Un(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Un(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Un(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="stakeId")throw new Un(a.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"stakeId",...n});const i=t.stakeAsset;if(!i)throw new Un(a.PARAM_LOST,{param:"stakeAsset"});const o={target:"stakeAssetAsset"},{baseHelper:c}=this,{stakeId:l,sourceChainName:u,sourceChainMagic:g,assetType:y,assetPrealnum:m,beginUnstakeHeight:d}=i;if(c.isValidStakeId(l)===!1)throw new Un(a.PROP_IS_INVALID,{prop:`stakeId ${l}`,...o});if(g===this.configHelper.magic&&(this.checkChainName(u,"sourceChainName",o),this.checkChainMagic(g,"sourceChainMagic",o),this.checkAsset(y,"assetType",o)),this.checkAssetAmount(m,"assetPrealnum",o),m==="0")throw new Un(a.PROP_SHOULD_GT_FIELD,{prop:`assetPrealnum ${m}`,fueld:"0",...o});if(c.isPositiveInteger(d)===!1)throw new Un(a.PROP_IS_INVALID,{prop:`beginUnstakeHeight ${d}`,...o});if(i.beginUnstakeHeight<e.applyBlockHeight)throw new Un(a.PROP_SHOULD_GT_FIELD,{prop:`beginUnstakeHeight ${i.beginUnstakeHeight}`,field:e.applyBlockHeight,target:"stakeAssetAsset"});if(s.value!==i.stakeId)throw new Un(a.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`stakeId ${i.stakeId}`,to_target:"storage",be_target:"stakeAsset",...n})}init(e,t){return Yi.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i}=e,{stakeId:o,assetType:c,sourceChainName:l,sourceChainMagic:u,assetPrealnum:g,beginUnstakeHeight:y}=e.asset.stakeAsset,m=this.chainAssetInfoHelper.getAssetInfo(l,u,c);n.next=t.emit("stakeAsset",{type:"stakeAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:m,amount:`-${g}`,sourceAmount:g,beginUnstakeHeight:y,stakeId:o}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,assetPrealnum:s}=e.asset.stakeAsset;return t.magic===r&&t.assetType===n?s:"0"}};Ul=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Ul);var{ArgumentIllegalException:ds}=Z("CONTROLLER","UnstakeAssetTransactionFactory"),bd=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.stakeAssetTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s,accountBaseHelper:i}=this;if(e.recipientId)throw new ds(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ds(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ds(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new ds(a.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="stakeId")throw new ds(a.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"stakeId",...n});const c=t.unstakeAsset;if(!c)throw new ds(a.PARAM_LOST,{param:"unstakeAsset"});const l={target:"unstakeAssetAsset"},{stakeId:u,sourceChainName:g,sourceChainMagic:y,assetType:m,assetPrealnum:d}=c;if(s.isValidStakeId(u)===!1)throw new ds(a.PROP_IS_INVALID,{prop:`stakeId ${u}`,...l});if(y===this.configHelper.magic&&(this.checkChainName(g,"sourceChainName",l),this.checkChainMagic(y,"sourceChainMagic",l),this.checkAsset(m,"assetType",l)),this.checkAssetAmount(d,"assetPrealnum",l),d==="0")throw new ds(a.PROP_SHOULD_GT_FIELD,{prop:`assetPrealnum ${d}`,fueld:"0",...l});if(o.value!==u)throw new ds(a.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`stakeId ${u}`,to_target:"storage",be_target:"unstakeAsset",...n});if(this.checkAssetAmount(d,"assetPrealnum",l),d==="0")throw new ds(a.PROP_SHOULD_GT_FIELD,{prop:`assetPrealnum ${d}`,fueld:"0",...l})}init(e,t){return fp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s}=e,{stakeId:i,sourceChainName:o,sourceChainMagic:c,assetType:l,assetPrealnum:u}=e.asset.unstakeAsset,g=this.chainAssetInfoHelper.getAssetInfo(o,c,l);n.next=t.emit("unstakeAsset",{type:"unstakeAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:g,amount:u,sourceAmount:u,stakeId:i}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,assetPrealnum:s}=e.asset.unstakeAsset;return t.magic===r&&t.assetType===n?s:"0"}};bd=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,Ul])],bd);var{ArgumentIllegalException:$t}=Z("CONTROLLER","LocationNameTransactionFactory"),wd=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new $t(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new $t(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new $t(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new $t(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="name")throw new $t(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"name",...n});const o=t.locationName;if(!o)throw new $t(a.PARAM_LOST,{param:"locationName"});const c={...n,target:"locationName"},l=o.name;if(!l)throw new $t(a.PROP_IS_REQUIRE,{prop:"name",...c});if(!s.isString(l))throw new $t(a.PROP_IS_INVALID,{prop:`name ${l}`,type:"string",...c});if(l.length>512)throw new $t(a.OVER_LENGTH,{prop:`name ${l}`,limit:512,...c});if(s.isStartWithOrEndWithPoint(l))throw new $t(a.SHOULD_NOT_START_WITH_OR_END_WITH,{prop:`name ${l}`,field:".",...c});const u=l.split("."),g=u.length;if(g<2)throw new $t(a.PROP_IS_INVALID,{prop:`name ${l}`,...c});for(let I=0;I<g;I++){const T=u[I];if(T.length>128)throw new $t(a.OVER_LENGTH,{prop:`name ${T}`,limit:128,...c});if(I===g-2){if(!s.isLowerCaseLetter(T))throw new $t(a.PROP_IS_INVALID,{prop:`name ${T}`,type:"lowercase",...c})}else if(I===g-1){if(T!==r.chainName)throw new $t(a.SHOULD_BE,{to_compare_prop:"root location name",to_target:`name ${T}`,be_compare_prop:r.chainName,...c})}else if(T.length<=2){if(!s.isLowerCaseLetterOrNumber(T))throw new $t(a.PROP_IS_INVALID,{prop:`name ${T}`,type:"lowercase letter or number",...c})}else if(!s.isLowerCaseLetterOrNumberOrUnderline(T))throw new $t(a.PROP_IS_INVALID,{prop:`name ${T}`,type:"lowercase letter or number or underline",...c})}if(i.value!==l)throw new $t(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`name ${l}`,to_target:"storage",be_target:"locationName",...n});const{sourceChainName:y,sourceChainMagic:m,operationType:d}=o;if(this.checkChainName(y,"sourceChainName",c),y!==r.chainName)throw new $t(a.SHOULD_BE,{to_compare_prop:`sourceChainName ${y}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(m,"sourceChainMagic",c),m!==r.magic)throw new $t(a.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${m}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(d!==0&&d!==1)throw new $t(a.NOT_MATCH,{to_compare_prop:`operationType ${d}`,be_compare_prop:"locationNameType",to_target:"locationName",be_target:"LOCATION_NAME_OPERATION_TYPE",...c});if(d===1&&e.senderId!==e.recipientId)throw new $t(a.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"transaction",be_compare_prop:e.senderId,...n})}init(e,t){return dp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i}=e,{name:o,sourceChainMagic:c,sourceChainName:l,operationType:u}=e.asset.locationName;u===0?n.next=t.emit("registerLocationName",{type:"registerLocationName",transaction:e,applyInfo:{address:s,name:o,sourceChainMagic:c,sourceChainName:l,possessorAddress:i,status:0}}):n.next=t.emit("cancelLocationName",{type:"cancelLocationName",transaction:e,applyInfo:{address:s,sourceChainName:l,sourceChainMagic:c,name:o,status:255}})})}};wd=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],wd);var{ArgumentIllegalException:Us}=Z("CONTROLLER","SetLnsManagerTransactionFactory"),Nd=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Us(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Us(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Us(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Us(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="name")throw new Us(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"name",...n});const o=t.lnsManager;if(!o)throw new Us(a.PARAM_LOST,{param:"lnsManager"});const c={...n,target:"lnsManagerAsset"},l=o.name;if(!l)throw new Us(a.PROP_IS_REQUIRE,{prop:"name",...c});if(!s.isValidLocationName(l))throw new Us(a.PROP_IS_INVALID,{prop:`name ${l}`,type:"location name",...c});if(i.value!==l)throw new Us(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`name ${l}`,to_target:"storage",be_target:"lnsManager",...n});const{sourceChainName:u,sourceChainMagic:g}=o;this.checkChainName(u,"sourceChainName",c),this.checkChainMagic(g,"sourceChainMagic",c)}init(e,t){return yp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{name:s,sourceChainMagic:i,sourceChainName:o}=e.asset.lnsManager;n.next=t.emit("setLnsManager",{type:"setLnsManager",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:o,sourceChainMagic:i,name:s,manager:e.recipientId}})})}};Nd=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Nd);var{ArgumentIllegalException:rt}=Z("CONTROLLER","SetLnsRecordValueTransactionFactory"),Od=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(e.recipientId)throw new rt(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new rt(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new rt(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new rt(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="name")throw new rt(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"name",...n});const o=t.lnsRecordValue;if(!o)throw new rt(a.PARAM_LOST,{param:"lnsRecordValue"});const c={...n,target:"lnsRecordValueAsset"},l=o.name;if(!l)throw new rt(a.PROP_IS_REQUIRE,{prop:"name",...c});if(!s.isValidLocationName(l))throw new rt(a.PROP_IS_INVALID,{prop:`name ${l}`,type:"location name",...c});if(i.value!==l)throw new rt(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`name ${l}`,to_target:"storage",be_target:"lnsRecordValue",...n});const{sourceChainName:u,sourceChainMagic:g}=o;switch(this.checkChainName(u,"sourceChainName",c),this.checkChainMagic(g,"sourceChainMagic",c),o.operationType){case 0:if(!o.addRecord)throw new rt(a.PROP_IS_REQUIRE,{prop:"addRecord",...c});if(o.deleteRecord)throw new rt(a.SHOULD_NOT_EXIST,{prop:"deleteRecord",...c});await this.checkLocationNameRecord(o.addRecord);break;case 1:if(o.addRecord)throw new rt(a.SHOULD_NOT_EXIST,{prop:"addRecord",...c});if(!o.deleteRecord)throw new rt(a.PROP_IS_REQUIRE,{prop:"deleteRecord",...c});await this.checkLocationNameRecord(o.deleteRecord);break;case 2:if(!o.addRecord)throw new rt(a.PROP_IS_REQUIRE,{prop:"addRecord",...c});if(!o.deleteRecord)throw new rt(a.PROP_IS_REQUIRE,{prop:"deleteRecord",...c});await this.checkLocationNameRecord(o.addRecord),await this.checkLocationNameRecord(o.deleteRecord);break;default:throw new rt(a.PROP_IS_INVALID,{prop:"operationType",type:"location name operation type",...c})}}async checkLocationNameRecord(e){const{baseHelper:t,accountBaseHelper:r}=this;if(!e)throw new rt(a.PARAM_LOST,{param:"record"});const n={target:"lnsRecordValue"},{recordType:s,recordValue:i}=e;if(!t.isString(i))throw new rt(a.NOT_A_STRING,{prop:"recordValue",value:i,...n});if(s===1){if(!t.isIpV4(i))throw new rt(a.NOT_A_IPV4,{prop:"recordValue",value:i,...n})}else if(s===2){if(!t.isIpV6(i))throw new rt(a.NOT_A_IPV6,{prop:"recordValue",value:i,...n})}else if(s===3){const o=i.split(",");if(o.length!==2)throw new rt(a.NOT_A_LONGITUDE_LATITUDE,{prop:"recordValue",value:i,...n});if(!t.isLongitude(o[0]))throw new rt(a.NOT_A_LONGITUDE,{prop:"recordValue",value:i,...n});if(!t.isLatitude(o[1]))throw new rt(a.NOT_A_LATITUDE,{prop:"recordValue",value:i,...n})}else if(s===4){if(!await r.isAddress(i))throw new rt(a.NOT_A_ADDRESS,{prop:"recordValue",value:i,...n})}else if(s===5){if(!t.isValidLocationName(i))throw new rt(a.NOT_A_LOCATION_NAME,{prop:"recordValue",value:i,...n})}else if(s===6){if(!t.isDNS(i))throw new rt(a.NOT_A_DNS,{prop:"recordValue",value:i,...n})}else if(s===8){if(!t.isEmail(i))throw new rt(a.NOT_A_EMAIL,{prop:"recordValue",value:i,...n})}else if(s===7){if(!t.isURL(i))throw new rt(a.NOT_A_URL,{prop:"recordValue",value:i,...n})}else if(s!==0)throw new rt(a.NOT_EXIST,{prop:"recordType",...n})}init(e,t){return mp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{name:s,sourceChainMagic:i,sourceChainName:o,operationType:c,addRecord:l,deleteRecord:u}=e.asset.lnsRecordValue;n.next=t.emit("setLnsRecordValue",{type:"setLnsRecordValue",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainMagic:i,sourceChainName:o,name:s,operationType:c,addRecord:l,deleteRecord:u}})})}};Od=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Od);var{ArgumentIllegalException:Wt}=Z("CONTROLLER","IssueEntityFactoryTransactionFactory"),Sa=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=i}async commonVerifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new Wt(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Wt(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Wt(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Wt(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="factoryId")throw new Wt(a.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"factoryId",...n});const i=t.issueEntityFactory;if(this.verifyIssueEntityFactoryAsset(i,r),s.value!==i.factoryId)throw new Wt(a.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`factoryId ${i.factoryId}`,to_target:"storage",be_target:"dapp",...n})}async verifyTransactionBody(e,t,r=this.configHelper){if(await this.commonVerifyTransactionBody(e,t,r),e.senderId===e.recipientId)throw new Wt(a.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${e.recipientId}`,target:"body"})}verifyIssueEntityFactoryAsset(e,t=this.configHelper){const{baseHelper:r}=this,n={target:"body"};if(!e)throw new Wt(a.PARAM_LOST,{param:"issueEntityFactory",...n});const s={...n,target:"issueEntityFactory"},{sourceChainMagic:i,sourceChainName:o,factoryId:c,entityPrealnum:l,entityFrozenAssetPrealnum:u,purchaseAssetPrealnum:g}=e;if(o!==t.chainName)throw new Wt(a.SHOULD_BE,{to_compare_prop:`sourceChainName ${o}`,to_target:"body",be_compare_prop:"local chain name",...n});if(i!==t.magic)throw new Wt(a.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${i}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!c)throw new Wt(a.PROP_IS_REQUIRE,{prop:"factoryId",...s});if(!r.isString(c))throw new Wt(a.PROP_IS_INVALID,{prop:`factoryId ${c}`,type:"string",...s});const y=c.length;if(y<3||y>15)throw new Wt(a.NOT_IN_EXPECTED_RANGE,{prop:`factoryId ${c}`,type:"string length",min:3,max:15,...s});if(!r.isLowerCaseLetterOrNumber(c))throw new Wt(a.PROP_IS_INVALID,{prop:`factoryId ${c}`,type:"lowercase letter or number",...s});if(!r.isPositiveStringNumber(l))throw new Wt(a.PROP_IS_INVALID,{prop:`entityPrealnum ${l}`,type:"positive integer",IssueEntityFactoryAsset_Exception_Detail:s});if(!u)throw new Wt(a.PROP_IS_REQUIRE,{prop:"entityFrozenAssetPrealnum",...s});if(!r.isValidAssetPrealnum(u))throw new Wt(a.PROP_IS_INVALID,{prop:`entityFrozenAssetPrealnum ${u}`,type:"string number",...s});if(!g)throw new Wt(a.PROP_IS_REQUIRE,{prop:"purchaseAssetPrealnum",...s});if(!r.isValidAssetPrealnum(g))throw new Wt(a.PROP_IS_INVALID,{prop:`purchaseAssetPrealnum ${g}`,type:"string number",...s})}init(e,t){return _p.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{sourceChainName:s,sourceChainMagic:i,factoryId:o,entityPrealnum:c,entityFrozenAssetPrealnum:l,purchaseAssetPrealnum:u}=e.asset.issueEntityFactory;n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,accountStatus:16}}),n.next=t.emit("issueEntityFactoryByFrozen",{type:"issueEntityFactoryByFrozen",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:s,sourceChainMagic:i,factoryId:o,entityPrealnum:c,entityFrozenAssetPrealnum:l,possessorAddress:e.recipientId,purchaseAssetPrealnum:u,status:0}})})}};Sa=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,St])],Sa);var $l=class extends Sa{async verifyTransactionBody(e,t,r=this.configHelper){await this.commonVerifyTransactionBody(e,t,r)}init(e,t){return Ap.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ue(n=>{const{senderId:s,recipientId:i,senderPublicKeyBuffer:o,fee:c}=e,l=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("fee",{type:"fee",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:l,amount:"-"+e.fee,sourceAmount:e.fee}}),n.next=t.emit("count",{type:"count",transaction:e});const{sourceChainName:u,sourceChainMagic:g,factoryId:y,entityPrealnum:m,entityFrozenAssetPrealnum:d,purchaseAssetPrealnum:I}=e.asset.issueEntityFactory,T=this.transactionHelper.calcDestroyMainAssetsOfIsseuEntityFactory(m,r);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:l,amount:"-"+T,sourceAmount:T}}),n.next=t.emit("destroyMainAsset",{type:"destroyMainAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:l,amount:"-"+T,sourceAmount:T}}),n.next=t.emit("issueEntityFactoryByDestroy",{type:"issueEntityFactoryByDestroy",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:u,sourceChainMagic:g,factoryId:y,entityPrealnum:m,entityFrozenAssetPrealnum:d,possessorAddress:e.recipientId,purchaseAssetPrealnum:I,status:0}})})}};$l=p([j()],$l);var{ArgumentIllegalException:Zt}=Z("CONTROLLER","IssueEntityTransactionFactory"),Vl=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.issueEntityFactoryTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Zt(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Zt(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Zt(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Zt(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="entityId")throw new Zt(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"entityId",...n});const o=t.issueEntity;if(!o)throw new Zt(a.PARAM_LOST,{param:"issueEntity"});const c={...n,target:"issueEntityAsset"},{sourceChainName:l,sourceChainMagic:u,entityId:g,taxAssetPrealnum:y,entityFactoryPossessor:m,entityFactory:d}=o;if(l!==r.chainName)throw new Zt(a.SHOULD_BE,{to_compare_prop:`sourceChainName ${l}`,to_target:"body",be_compare_prop:"local chain name",...n});if(u!==r.magic)throw new Zt(a.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${l}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!m)throw new Zt(a.PROP_IS_REQUIRE,{prop:"entityFactoryPossessor",...n});if(!await this.accountBaseHelper.isAddress(m))throw new Zt(a.PROP_IS_INVALID,{prop:`entityFactoryPossessor ${m}`,type:"account address",...n,target:"issueEntity"});if(!g)throw new Zt(a.PROP_IS_REQUIRE,{prop:"entityId",...c});const I=g.split("_");if(I.length!==2)throw new Zt(a.PROP_IS_INVALID,{prop:`entityId ${g}`,...c});if(!s.isValidEntityFactoryId(I[0]))throw new Zt(a.PROP_IS_INVALID,{prop:`factoryId ${I[0]}`,...c});const T=I[1].length;if(T<3||T>30)throw new Zt(a.NOT_IN_EXPECTED_RANGE,{prop:`entityId ${I[1]}`,type:"string length",min:3,max:30,...c});if(!s.isLowerCaseLetterOrNumber(I[1]))throw new Zt(a.PROP_IS_INVALID,{prop:`entityId ${I[1]}`,type:"lowercase or number",...c});if(!y)throw new Zt(a.PROP_IS_REQUIRE,{prop:"taxAssetPrealnum",...c});if(!this.baseHelper.isValidAssetPrealnum(y))throw new Zt(a.PROP_IS_INVALID,{prop:`taxAssetPrealnum ${y}`,...c});if(i.value!==g)throw new Zt(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`entityId ${g}`,to_target:"storage",be_target:"issueEntityAsset",...n});if(this.issueEntityFactoryTransactionFactory.verifyIssueEntityFactoryAsset(d),I[0]!==d.factoryId)throw new Zt(a.NOT_MATCH,{to_compare_prop:`factoryId ${I[0]}`,be_compare_prop:`factoryId ${d.factoryId}`,to_target:"entityId",be_target:"entityFactory",...n})}init(e,t){return Xi.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ue(n=>{const{senderId:s,recipientId:i,senderPublicKeyBuffer:o,signature:c}=e,{sourceChainName:l,sourceChainMagic:u,entityId:g,taxAssetPrealnum:y,entityFactoryPossessor:m,entityFactory:d,taxAssetRecipientId:I}=e.asset.issueEntity,{factoryId:T,entityFrozenAssetPrealnum:S,purchaseAssetPrealnum:w}=d,b=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("fee",{type:"fee",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:b,amount:"-"+e.fee,sourceAmount:e.fee}}),n.next=t.emit("count",{type:"count",transaction:e}),n.next=t.emit("issueEntity",{type:"issueEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,sourceChainName:l,sourceChainMagic:u,factoryId:T,entityId:g,taxAssetPrealnum:y,possessorAddress:i,entityFactoryPossessorAddress:m,entityFrozenAssetPrealnum:S,issueId:c,status:0,taxAssetRecipientId:I||s}}),S!=="0"&&(n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:b,amount:`-${S}`,sourceAmount:S,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),totalUnfrozenTimes:1,frozenId:c,frozenReason:it.ENTITY}})),n.next=this._applyTransactionEmitAsset(t,e,w,{senderId:s,senderPublicKeyBuffer:o,recipientId:m,assetInfo:b})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,entityFrozenAssetPrealnum:n,purchaseAssetPrealnum:s}=e.asset.issueEntity.entityFactory;return t.magic===r&&t.assetType===this.configHelper.assetType?(BigInt(n)+BigInt(s)).toString():"0"}};Vl=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,Sa])],Vl);var{ArgumentIllegalException:nr}=Z("CONTROLLER","DestroyEntityTransactionFactory"),vd=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.issueEntityFactoryTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new nr(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new nr(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new nr(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new nr(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="entityId")throw new nr(a.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"entityId",...n});const i=t.destroyEntity;if(!i)throw new nr(a.PARAM_LOST,{param:"destroyEntity"});const o={...n,target:"destroyAssetAsset"},{sourceChainMagic:c,sourceChainName:l,entityId:u,entityFactoryApplicant:g,entityFactoryPossessor:y,entityFactory:m,transactionSignature:d}=i;if(l!==r.chainName)throw new nr(a.SHOULD_BE,{to_compare_prop:"sourceChainName",to_target:"body",be_compare_prop:"local chain name",...o});if(c!==r.magic)throw new nr(a.SHOULD_BE,{to_compare_prop:"sourceChainMagic",to_target:"body",be_compare_prop:"local chain magic",...o});const I=this.baseHelper;if(!u)throw new nr(a.PROP_IS_REQUIRE,{prop:"entityId",...o});if(!I.isValidEntityId(u))throw new nr(a.PROP_IS_INVALID,{prop:`entityId ${u}`,type:"entityId",...o});if(s.value!==u)throw new nr(a.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`entityId ${u}`,to_target:"storage",be_target:"destroyEntity",...n});if(!y)throw new nr(a.PROP_IS_REQUIRE,{prop:"entityFactoryPossessor",...n});if(!await this.accountBaseHelper.isAddress(y))throw new nr(a.PROP_IS_INVALID,{prop:`entityFactoryPossessor ${y}`,type:"account address",...n,target:"destroyEntity"});if(!g)throw new nr(a.PROP_IS_REQUIRE,{prop:"entityFactoryApplicant",...n});if(!await this.accountBaseHelper.isAddress(g))throw new nr(a.PROP_IS_INVALID,{prop:`entityFactoryApplicant ${g}`,type:"account address",...n,target:"destroyEntity"});this.issueEntityFactoryTransactionFactory.verifyIssueEntityFactoryAsset(m);const T=this.transactionHelper.getFactoryIdByEntityId(u);if(T!==m.factoryId)throw new nr(a.NOT_MATCH,{to_compare_prop:`factoryId ${T}`,be_compare_prop:`factoryId ${m.factoryId}`,to_target:"entityId",be_target:"entityFactory",...n});if(!d)throw new nr(a.PROP_IS_REQUIRE,{prop:"transactionSignature",...o});if(!I.isValidTransactionSignature(d))throw new nr(a.PROP_IS_INVALID,{prop:`transactionSignature ${d}`,type:"transaction signature",...o})}init(e,t){return Ip.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,recipientId:o}=e,{sourceChainMagic:c,sourceChainName:l,entityId:u,entityFactoryApplicant:g,entityFactoryPossessor:y,entityFactory:m,transactionSignature:d}=e.asset.destroyEntity;n.next=t.emit("destroyEntity",{type:"destroyEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,sourceChainMagic:c,sourceChainName:l,entityId:u,entityFactoryApplicantAddress:g,entityFactoryPossessorAddress:y,entityFactory:m.toJSON(),frozenId:d,status:255}});const I=m.entityFrozenAssetPrealnum;if(I!=="0"){const T=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:T,amount:I,sourceAmount:I,recipientId:o,frozenId:d,frozenReason:it.ENTITY}})}})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,entityFactory:n}=e.asset.destroyEntity;return t.magic===r&&t.assetType===this.configHelper.assetType?n.entityFrozenAssetPrealnum:"0"}};vd=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,Sa])],vd);var{ArgumentIllegalException:dt}=Z("CONTROLLER","ToExchangeAnyTransactionFactory"),lh=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new dt(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new dt(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new dt(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic"});const s=t.toExchangeAny;if(await this.verifyToExchangeAny(s,r),s.toExchangeAssetPrealnum==="0")throw new dt(a.PROP_SHOULD_GT_FIELD,{prop:"toExchangeAssetPrealnum",field:"0",target:"toExchangeAny"});if(e.storage)throw new dt(a.SHOULD_NOT_EXIST,{prop:"storage",...n})}async verifyToExchangeAny(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new dt(a.PARAM_LOST,{param:"toExchangeAny"});const n={target:"toExchangeAnyAsset"},s=e.cipherPublicKeys,i=new Set(s);if(s.length!==i.size)throw new dt(a.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(s))throw new dt(a.PROP_IS_INVALID,{prop:"cipherPublicKeys",...n});const{toExchangeParentAssetType:o,toExchangeAssetType:c,beExchangeParentAssetType:l,beExchangeAssetType:u}=e;this.checkParentAssetType(o,"toExchangeParentAssetType",n),this.checkParentAssetType(l,"beExchangeParentAssetType",n),e.toExchangeSource===this.configHelper.magic&&(this.checkChainName(e.toExchangeChainName,"toExchangeChainName",n),this.checkChainMagic(e.toExchangeSource,"toExchangeSource",n),this.checkAssetType(o,c,"toExchangeAssetType",n)),e.beExchangeSource===this.configHelper.magic&&(this.checkChainName(e.beExchangeChainName,"beExchangeChainName",n),this.checkChainMagic(e.beExchangeSource,"beExchangeSource",n),this.checkAssetType(l,u,"beExchangeAssetType",n));const{toExchangeAssetPrealnum:g,beExchangeAssetPrealnum:y,assetExchangeWeightRatio:m,taxInformation:d}=e;if(!g)throw new dt(a.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...n});if(!r.isValidAssetNumber(g))throw new dt(a.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...n});if(o===G.ASSETS)if(l===G.ASSETS){if(y)throw new dt(a.SHOULD_NOT_EXIST,{prop:"beExchangeAssetPrealnum",...n});if(!m)throw new dt(a.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",...n});if(!r.isValidAssetExchangeWeightRatio(m))throw new dt(a.PROP_IS_INVALID,{prop:`assetExchangeWeightRatio ${JSON.stringify(m)}`,...n})}else{if(!y)throw new dt(a.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...n});if(y!=="1")throw new dt(a.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${y}`,to_target:"toExchangeAnyAsset",be_compare_prop:"1"});if(m)throw new dt(a.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...n})}else{if(g!=="1")throw new dt(a.SHOULD_BE,{to_compare_prop:`toExchangeAssetPrealnum ${g}`,to_target:"toExchangeAnyAsset",be_compare_prop:"1",...n});if(!y)throw new dt(a.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...n});if(m)throw new dt(a.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...n});if(!r.isValidAssetNumber(y))throw new dt(a.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...n});if(l===G.ASSETS){if(y==="0")throw new dt(a.PROP_SHOULD_GT_FIELD,{prop:"beExchangeAssetPrealnum",field:"0",...n})}else if(y!=="1")throw new dt(a.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${y}`,to_target:"toExchangeAnyAsset",be_compare_prop:"1"})}if(c===u)throw new dt(a.SHOULD_NOT_BE,{to_compare_prop:`toExchangeAssetType ${c}`,to_target:"toExchangeAny",be_compare_prop:u});if(o===G.ENTITY)await this.checkTaxInformation(n,d);else if(d)throw new dt(a.SHOULD_NOT_EXIST,{prop:"taxInformation",...n})}init(e,t){return Za.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,signature:o}=e,{toExchangeChainName:c,toExchangeSource:l,toExchangeParentAssetType:u,toExchangeAssetType:g,toExchangeAssetPrealnum:y,taxInformation:m}=e.asset.toExchangeAny;if(u===G.ASSETS){const d=this.chainAssetInfoHelper.getAssetInfo(c,l,g);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:d,amount:`-${y}`,sourceAmount:y,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o,frozenReason:it.EXCHANGE}})}else if(u===G.DAPP)n.next=t.emit("frozenDAppid",{type:"frozenDAppid",transaction:e,applyInfo:{address:s,sourceChainName:c,sourceChainMagic:l,dappid:g,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(u===G.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:s,sourceChainName:c,sourceChainMagic:l,name:g,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(u===G.ENTITY){if(n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:s,sourceChainName:c,sourceChainMagic:l,entityId:g,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}}),m){n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:c,sourceChainMagic:l,parentAssetType:u,assetType:g,taxInformation:m.toJSON()}});const{taxAssetPrealnum:d}=m;if(d!=="0"){const I=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:I,amount:`-${d}`,sourceAmount:d,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o,frozenReason:it.EXCHANGE}})}}}else if(u===G.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:s,sourceChainName:c,sourceChainMagic:l,certificateId:g,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else throw new dt(a.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${u}`,target:"transaction.asset.toExchangeAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeSource:s,toExchangeAssetType:i,toExchangeAssetPrealnum:o}=e.asset.toExchangeAny;return r===s&&n===i?o:"0"}};lh=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],lh);var{ArgumentIllegalException:Bt}=Z("CONTROLLER","BeExchangeAnyTransactionFactory"),Gl=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.toExchangeAnyTransactionFactory=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Bt(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Bt(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Bt(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Bt(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="transactionSignature")throw new Bt(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const o=t.beExchangeAny;if(!o)throw new Bt(a.PARAM_LOST,{param:"beExchangeAny"});const c={...n,target:"beExchangeAny"},{transactionSignature:l}=o;if(!l)throw new Bt(a.PROP_IS_REQUIRE,{prop:"transactionSignature",...c});if(!s.isValidSignature(l))throw new Bt(a.PROP_IS_INVALID,{prop:`transactionSignature ${l}`,type:"transaction signature",...c});if(i.value!==l)throw new Bt(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`transactionSignature ${l}`,to_target:"storage",be_target:"beExchangeAny",...n});const{toExchangeAssetPrealnum:u,beExchangeAssetPrealnum:g}=o;if(!u)throw new Bt(a.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...c});if(!s.isValidAssetNumber(u))throw new Bt(a.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",type:"asset prealnum",...c});if(!g)throw new Bt(a.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...c});if(!s.isValidAssetNumber(g))throw new Bt(a.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",type:"asset prealnum",...c});const{exchangeAny:y,ciphertextSignature:m}=o;await this.toExchangeAnyTransactionFactory.verifyToExchangeAny(y);const{beExchangeParentAssetType:d}=y;if(BigInt(u)>BigInt(y.toExchangeAssetPrealnum))throw new Bt(a.PROP_SHOULD_LTE_FIELD,{prop:`toExchangeAssetPrealnum ${u}`,field:y.toExchangeAssetPrealnum,...c});if(d===G.ENTITY)await this.checkTaxInformation(c,o.taxInformation);else if(o.taxInformation)throw new Bt(a.SHOULD_NOT_EXIST,{prop:"taxInformation",...c});const{cipherPublicKeys:I}=y;if(I.length>0){if(!m)throw new Bt(a.NOT_EXIST,{prop:`ciphertextSignature ${m}`,...c});if(!s.isValidAccountSignature(m))throw new Bt(a.PROP_IS_INVALID,{prop:`ciphertextSignature ${m}`,...c});const{signature:T,publicKey:S}=m;if(!I.includes(S))throw new Bt(a.NOT_MATCH,{to_compare_prop:`publicKey ${S}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...c});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:me(S),ciphertextSignatureBuffer:me(T),transactionSignatureBuffer:me(l),senderId:e.senderId}))throw new Bt(a.PROP_IS_INVALID,{prop:`ciphertextSignature ${T}`,type:"signature",...c})}else if(m)throw new Bt(a.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${m}`,...c})}init(e,t){return Sp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{exchangeAny:c,toExchangeAssetPrealnum:l,beExchangeAssetPrealnum:u,taxInformation:g,transactionSignature:y}=e.asset.beExchangeAny,{toExchangeChainName:m,toExchangeSource:d,toExchangeParentAssetType:I,toExchangeAssetType:T,beExchangeChainName:S,beExchangeSource:w,beExchangeParentAssetType:b,beExchangeAssetType:R}=c;if(I===G.ASSETS){const v=this.chainAssetInfoHelper.getAssetInfo(m,d,T);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:v,amount:l,sourceAmount:l,recipientId:i,frozenId:y,frozenReason:it.EXCHANGE}})}else{let v=s;if(l==="0"&&(v=i),I===G.DAPP)n.next=t.emit("unfrozenDAppid",{type:"unfrozenDAppid",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:v,sourceChainName:m,sourceChainMagic:d,dappid:T,status:0,frozenId:y}});else if(I===G.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:v,sourceChainName:m,sourceChainMagic:d,name:T,status:0,frozenId:y}});else if(I===G.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:v,sourceChainName:m,sourceChainMagic:d,entityId:T,status:0,frozenId:y}}),c.taxInformation){const{taxCollector:$,taxAssetPrealnum:D}=c.taxInformation,L=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);D==="0"?n.next=this._applyTransactionEmitAsset(t,e,D,{senderId:s,senderPublicKeyBuffer:o,recipientId:$,assetInfo:L}):n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:$,publicKeyBuffer:o,assetInfo:L,amount:D,sourceAmount:D,frozenId:y,recipientId:i,frozenReason:it.EXCHANGE}})}}else if(I===G.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:v,sourceChainName:m,sourceChainMagic:d,certificateId:T,status:0,frozenId:y}});else throw new Bt(a.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${I}`,target:"transaction.asset.beExchangeAny.exchangeAny"})}if(b===G.ENTITY&&g&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:S,sourceChainMagic:w,parentAssetType:b,assetType:R,taxInformation:g.toJSON()}})),u==="0"){if(g){const v=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,"0",{senderId:s,senderPublicKeyBuffer:o,recipientId:g.taxCollector,assetInfo:v})}return}if(b===G.ASSETS){const v=this.chainAssetInfoHelper.getAssetInfo(S,w,R);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:v,amount:`-${u}`,sourceAmount:u}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:i,assetInfo:v,amount:u,sourceAmount:u}})}else if(b===G.DAPP)n.next=t.emit("changeDAppidPossessor",{type:"changeDAppidPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:S,sourceChainMagic:w,dappid:R}});else if(b===G.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:S,sourceChainMagic:w,name:R}});else if(b===G.ENTITY){if(n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:S,sourceChainMagic:w,entityId:R}}),g){const v=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,g.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:o,recipientId:g.taxCollector,assetInfo:v})}}else if(b===G.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:S,sourceChainMagic:w,certificateId:R}});else throw new Bt(a.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${b}`,target:"transaction.asset.beExchangeAny.exchangeAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{exchangeAny:s,toExchangeAssetPrealnum:i,beExchangeAssetPrealnum:o}=e.asset.beExchangeAny,{toExchangeSource:c,beExchangeSource:l,toExchangeAssetType:u,beExchangeAssetType:g}=s;return r===c&&n===u?i:r===l&&n===g?o:"0"}};Gl=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,lh])],Gl);var{ArgumentIllegalException:Ht}=Z("CONTROLLER","IssueEntityMultiTransactionV1"),Kl=class extends Ge{constructor(e,t,r,n,s,i,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=i,this.issueEntityFactoryTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Ht(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Ht(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Ht(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Ht(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="factoryId")throw new Ht(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"factoryId",...n});const o=t.issueEntityMulti;if(!o)throw new Ht(a.PARAM_LOST,{param:"issueEntityMulti"});const c={...n,target:"issueEntityMultiAsset"},{sourceChainName:l,sourceChainMagic:u,entityStructList:g,entityFactoryPossessor:y,entityFactory:m}=o;if(this.issueEntityFactoryTransactionFactory.verifyIssueEntityFactoryAsset(m),l!==r.chainName)throw new Ht(a.SHOULD_BE,{to_compare_prop:`sourceChainName ${l}`,to_target:"body",be_compare_prop:"local chain name",...n});if(u!==r.magic)throw new Ht(a.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${l}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!y)throw new Ht(a.PROP_IS_REQUIRE,{prop:"entityFactoryPossessor",...n});if(!await this.accountBaseHelper.isAddress(y))throw new Ht(a.PROP_IS_INVALID,{prop:`entityFactoryPossessor ${y}`,type:"account address",...n,target:"issueEntityMulti"});const d=g.length;if(!(s.isArray(g)&&d>0))throw new Ht(a.PROP_IS_INVALID,{prop:`entityStructList ${JSON.stringify(g)}`,...n,target:"issueEntityMulti"});const I=m.factoryId,T=new Set;for(const{entityId:S,taxAssetPrealnum:w}of g){if(!S)throw new Ht(a.PROP_IS_REQUIRE,{prop:"entityId",...c});T.add(S);const b=S.split("_");if(b.length!==3)throw new Ht(a.PROP_IS_INVALID,{prop:`entityId ${S}`,target:"issueEntityMulti.entityStructList"});if(b[0]!=="m")throw new Ht(a.SHOULD_BE,{to_compare_prop:`entityId first item ${b[0]}`,be_compare_prop:"m",to_target:"issueEntityMulti.entityStructList"});if(!s.isValidEntityFactoryId(b[1]))throw new Ht(a.PROP_IS_INVALID,{prop:`factoryId ${b[0]}`,target:"issueEntityMulti.entityStructList"});if(b[1]!==I)throw new Ht(a.NOT_MATCH,{to_compare_prop:`factoryId ${b[1]}`,be_compare_prop:`factoryId ${I}`,to_target:"entityId",be_target:"entityFactory",...n});const R=b[2].length;if(R<3||R>30)throw new Ht(a.NOT_IN_EXPECTED_RANGE,{prop:`entityId ${b[2]}`,min:3,max:30,target:"issueEntityMulti.entityStructList"});if(!s.isLowerCaseLetterOrNumber(b[2]))throw new Ht(a.PROP_IS_INVALID,{prop:`entityId ${b[2]}`,target:"issueEntityMulti.entityStructList"});if(!w)throw new Ht(a.PROP_IS_REQUIRE,{prop:"taxAssetPrealnum",target:"issueEntityMulti.entityStructList"});if(!this.baseHelper.isValidAssetPrealnum(w))throw new Ht(a.PROP_IS_INVALID,{prop:`taxAssetPrealnum ${w}`,target:`issueEntityMulti.entityStructList ${S}`})}if(T.size<d)throw new Ht(a.SHOULD_NOT_DUPLICATE,{prop:`entityStructList ${JSON.stringify(g)}`,target:"issueEntityMulti"});if(i.value!==I)throw new Ht(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`factoryId ${I}`,to_target:"storage",be_target:"issueEntityMultiAsset",...n})}init(e,t){return Qi.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ue(n=>{const{senderId:s,recipientId:i,senderPublicKeyBuffer:o,signature:c,fee:l}=e,{sourceChainName:u,sourceChainMagic:g,entityStructList:y,entityFactoryPossessor:m,entityFactory:d}=e.asset.issueEntityMulti,{factoryId:I,entityFrozenAssetPrealnum:T,purchaseAssetPrealnum:S}=d;n.next=super.applyTransaction(e,t,r),n.next=t.emit("issueEntityMulti",{type:"issueEntityMulti",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,sourceChainName:u,sourceChainMagic:g,factoryId:I,entityStructList:y.map(R=>({...R,taxAssetRecipientId:R.taxAssetRecipientId||s})),possessorAddress:i,entityFactoryPossessorAddress:m,entityFrozenAssetPrealnum:T,issueId:c,status:0}});const w=y.length,b=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);if(T!=="0"){const R=(BigInt(T)*BigInt(w)).toString();n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:b,amount:`-${R}`,sourceAmount:R,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),totalUnfrozenTimes:w,frozenId:c,frozenReason:it.ENTITY}})}n.next=this._applyTransactionEmitAsset(t,e,(BigInt(S)*BigInt(w)).toString(),{senderId:s,senderPublicKeyBuffer:o,recipientId:m,assetInfo:b})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{entityStructList:r,entityFactory:n}=e.asset.issueEntityMulti,{sourceChainMagic:s,entityFrozenAssetPrealnum:i,purchaseAssetPrealnum:o}=n;if(t.magic===s&&t.assetType===this.configHelper.assetType){const c=r.length;return(BigInt(i)*BigInt(c)+BigInt(o)*BigInt(c)).toString()}return"0"}};Kl=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,St,Sa])],Kl);var{ArgumentIllegalException:st}=Z("CONTROLLER","ToExchangeAnyMultiTransactionFactory"),jl=class extends Ge{constructor(e,t,r,n,s,i){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new st(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new st(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new st(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});const s=t.toExchangeAnyMulti;if(!s)throw new st(a.PARAM_LOST,{param:"toExchangeAnyMulti",...n});const i=s.cipherPublicKeys,o=new Set(i);if(i.length!==o.size)throw new st(a.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",target:"toExchangeAnyMulti"});if(!this.baseHelper.isValidCipherPublicKeys(i))throw new st(a.PROP_IS_INVALID,{prop:"toExchangeAnyMulti.cipherPublicKeys",target:"toExchangeAnyMulti"});const{toExchangeAssets:c,beExchangeAsset:l}=s,u=await this.verifyToExchangeAnyMulti("toExchangeAnyMulti",c,l,r);for(const y of c)if(y.toExchangeAssetPrealnum==="0")throw new st(a.PROP_SHOULD_GT_FIELD,{prop:"toExchangeAssetPrealnum",field:"0",target:"toExchangeAnyMulti.toExchangeAssets.toExchangeAsset"});const g=l.beExchangeAssetPrealnum;if(u){if(l.beExchangeParentAssetType!==G.ASSETS){if(g!=="1")throw new st(a.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${g}`,to_target:"toExchangeAnyMulti.beExchangeAsset",be_compare_prop:"1"})}else if(g==="0")throw new st(a.PROP_SHOULD_GT_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,target:"toExchangeAnyMulti.beExchangeAsset",field:"0"})}else if(g)throw new st(a.SHOULD_NOT_EXIST,{prop:"beExchangeAssetPrealnum",target:"toExchangeAnyMulti.beExchangeAsset"});if(e.storage)throw new st(a.SHOULD_NOT_EXIST,{prop:"storage",...n})}async verifyToExchangeAnyMulti(e,t,r,n=this.configHelper){const{baseHelper:s}=this;if(!t)throw new st(a.PARAM_LOST,{param:`${e}.toExchangeAssets`});if(!r)throw new st(a.PARAM_LOST,{param:`${e}.beExchangeAsset`});if(t.length<=0)throw new st(a.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"toExchangeAssets",target:e,field:0});const{beExchangeChainName:i,beExchangeSource:o,beExchangeParentAssetType:c,beExchangeAssetType:l,beExchangeAssetPrealnum:u}=r,g={target:`${e}.beExchangeAsset`},y=this.configHelper.magic;this.checkParentAssetType(c,"beExchangeParentAssetType",g),o===y&&(this.checkChainName(i,"beExchangeChainName",g),this.checkChainMagic(o,"beExchangeSource",g),this.checkAssetType(c,l,"beExchangeAssetType",g));let m=!1,d=new Set;const I={target:`${e}.toExchangeAssets.toExchangeAsset`};for(const T of t){const{toExchangeChainName:S,toExchangeSource:w,toExchangeParentAssetType:b,toExchangeAssetType:R,toExchangeAssetPrealnum:v,assetExchangeWeightRatio:$,taxInformation:D}=T;if(d.has(R))throw new st(a.SHOULD_NOT_DUPLICATE,{prop:`toExchangeAssets ${JSON.stringify(t)}`,target:e});if(d.add(R),this.checkParentAssetType(b,"toExchangeParentAssetType",I),w===y&&(this.checkChainName(S,"toExchangeChainName",I),this.checkChainMagic(w,"toExchangeSource",I),this.checkAssetType(b,R,"toExchangeAssetType",I)),!v)throw new st(a.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...I});if(!s.isValidAssetNumber(v))throw new st(a.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...I});if(b===G.ENTITY)await this.checkTaxInformation(I,D);else if(D)throw new st(a.SHOULD_NOT_EXIST,{prop:"taxInformation",...I});if(b!==G.ASSETS){if(m=!0,v!=="1")throw new st(a.SHOULD_BE,{to_compare_prop:`toExchangeAssetPrealnum ${v}`,to_target:"toExchangeAnyMulti.toExchangeAssets",be_compare_prop:"1"});if($)throw new st(a.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...I})}else if(c===G.ASSETS){if(!$)throw new st(a.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",...I});if(!s.isValidAssetExchangeWeightRatio($))throw new st(a.PROP_IS_INVALID,{prop:`assetExchangeWeightRatio ${$}`,...I})}else{if($)throw new st(a.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...I});m=!0}}if(d.has(l))throw new st(a.SHOULD_NOT_BE,{to_compare_prop:`beExchangeAssetType ${l}`,to_target:"toExchangeAsset",be_compare_prop:l});if(m){if(!u)throw new st(a.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...g});if(!s.isValidAssetNumber(u))throw new st(a.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...g})}if(c===G.ENTITY)await this.checkTaxInformation(g,r.taxInformation);else if(r.taxInformation)throw new st(a.SHOULD_NOT_EXIST,{prop:"taxInformation",target:`${e}.toExchangeAssets.beExchangeAsset`});return m}init(e,t){return eo.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,signature:o}=e,{toExchangeAssets:c,beExchangeAsset:l}=e.asset.toExchangeAnyMulti;let u=BigInt(0);for(const g of c){const{toExchangeSource:y,toExchangeChainName:m,toExchangeParentAssetType:d,toExchangeAssetType:I,toExchangeAssetPrealnum:T,taxInformation:S}=g;if(d===G.ASSETS){const w=this.chainAssetInfoHelper.getAssetInfo(m,y,I);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:w,amount:`-${T}`,sourceAmount:T,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o,frozenReason:it.EXCHANGE}})}else if(d===G.DAPP)n.next=t.emit("frozenDAppid",{type:"frozenDAppid",transaction:e,applyInfo:{address:s,sourceChainName:m,sourceChainMagic:y,dappid:I,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(d===G.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:s,sourceChainName:m,sourceChainMagic:y,name:I,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(d===G.ENTITY){if(n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:s,sourceChainName:m,sourceChainMagic:y,entityId:I,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}}),S){n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:m,sourceChainMagic:y,parentAssetType:d,assetType:I,taxInformation:S.toJSON()}});const{taxAssetPrealnum:w}=S;w!=="0"&&(u+=BigInt(S.taxAssetPrealnum))}}else if(d===G.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:s,sourceChainName:m,sourceChainMagic:y,certificateId:I,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else throw new st(a.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${d}`,target:"transaction.asset.toExchangeAnyMulti"})}if(u!==BigInt(0)){const g=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:g,amount:`-${u.toString()}`,sourceAmount:u.toString(),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o+this.Buffer.from("_entity").toString("hex"),frozenReason:it.EXCHANGE}})}l.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:l.beExchangeChainName,sourceChainMagic:l.beExchangeSource,parentAssetType:l.beExchangeParentAssetType,assetType:l.beExchangeAssetType,taxInformation:l.taxInformation.toJSON()}}))})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,s=e.asset.toExchangeAnyMulti.toExchangeAssets;for(const i of s){const{toExchangeSource:o,toExchangeAssetType:c,toExchangeAssetPrealnum:l}=i;if(r===o&&n===c)return l}return"0"}};jl=p([j(),Se(0,k("Buffer")),h("design:paramtypes",[Object,de,_e,Re,re,Le])],jl);var{ArgumentIllegalException:nt}=Z("CONTROLLER","BeExchangeAnyMultiTransactionFactory"),zl=class extends Ge{constructor(e,t,r,n,s,i){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=i}async verifyToExchangeAnyMulti(e,t,r,n=this.configHelper){const{baseHelper:s}=this;if(!t)throw new nt(a.PARAM_LOST,{param:`${e}.toExchangeAssets`});if(!r)throw new nt(a.PARAM_LOST,{param:`${e}.beExchangeAsset`});if(t.length<=0)throw new nt(a.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"toExchangeAssets",target:e,field:0});const{beExchangeChainName:i,beExchangeSource:o,beExchangeParentAssetType:c,beExchangeAssetType:l,beExchangeAssetPrealnum:u}=r,g={target:`${e}.beExchangeAsset`},y=this.configHelper.magic;this.checkParentAssetType(c,"beExchangeParentAssetType",g),o===y&&(this.checkChainName(i,"beExchangeChainName",g),this.checkChainMagic(o,"beExchangeSource",g),this.checkAssetType(c,l,"beExchangeAssetType",g));let m=!1,d=new Set;const I={target:`${e}.toExchangeAssets.toExchangeAsset`};for(const T of t){const{toExchangeChainName:S,toExchangeSource:w,toExchangeParentAssetType:b,toExchangeAssetType:R,toExchangeAssetPrealnum:v,assetExchangeWeightRatio:$,taxInformation:D}=T;if(d.has(R))throw new nt(a.SHOULD_NOT_DUPLICATE,{prop:`toExchangeAssets ${JSON.stringify(t)}`,target:e});if(d.add(R),this.checkParentAssetType(b,"toExchangeParentAssetType",I),w===y&&(this.checkChainName(S,"toExchangeChainName",I),this.checkChainMagic(w,"toExchangeSource",I),this.checkAssetType(b,R,"toExchangeAssetType",I)),!v)throw new nt(a.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...I});if(!s.isValidAssetNumber(v))throw new nt(a.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...I});if(b===G.ENTITY)await this.checkTaxInformation(I,D);else if(D)throw new nt(a.SHOULD_NOT_EXIST,{prop:"taxInformation",...I});if(b!==G.ASSETS){if(m=!0,$)throw new nt(a.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...I});if(c!==G.ASSETS&&l===R)throw new nt(a.SHOULD_NOT_BE,{to_compare_prop:`beExchangeAssetType ${l}`,to_target:"toExchangeAnyMulti.beExchangeAsset",be_compare_prop:R})}else if(c===G.ASSETS){if(!$)throw new nt(a.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",...I});if(!s.isValidAssetExchangeWeightRatio($))throw new nt(a.PROP_IS_INVALID,{prop:`assetExchangeWeightRatio ${$}`,...I})}else{if($)throw new nt(a.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...I});m=!0}}if(m){if(!u)throw new nt(a.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...g});if(!s.isValidAssetNumber(u))throw new nt(a.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...g})}return m}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new nt(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new nt(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new nt(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new nt(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="transactionSignature")throw new nt(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const o=t.beExchangeAnyMulti;if(!o)throw new nt(a.PARAM_LOST,{param:"beExchangeAnyMulti"});const c={...n,target:"beExchangeAnyMulti"},{transactionSignature:l}=o;if(!l)throw new nt(a.PROP_IS_REQUIRE,{prop:"transactionSignature",...c});if(!s.isValidSignature(l))throw new nt(a.PROP_IS_INVALID,{prop:`transactionSignature ${l}`,type:"transaction signature",...c});if(i.value!==l)throw new nt(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`transactionSignature ${l}`,to_target:"storage",be_target:"beExchangeAnyMulti",...n});const{toExchangeAssets:u,beExchangeAsset:g,ciphertextSignature:y}=o;await this.verifyToExchangeAnyMulti("beExchangeAnyMulti",u,g,r);const{beExchangeParentAssetType:m,beExchangeAssetPrealnum:d,taxInformation:I}=g;if(!d)throw new nt(a.PROP_IS_REQUIRE,{prop:"beExchangeAsset.beExchangeAssetPrealnum",...c});if(m===G.ENTITY)await this.checkTaxInformation(c,I);else if(I)throw new nt(a.SHOULD_NOT_EXIST,{prop:"beExchangeAsset.taxInformation",...c});if(y){if(!s.isValidAccountSignature(y))throw new nt(a.PROP_IS_INVALID,{prop:`ciphertextSignature ${y}`,...c});const{signature:T,publicKey:S}=y;if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:me(S),ciphertextSignatureBuffer:me(T),transactionSignatureBuffer:me(l),senderId:e.senderId}))throw new nt(a.PROP_IS_INVALID,{prop:`ciphertextSignature ${T}`,type:"signature",...c})}}init(e,t){return bp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{toExchangeAssets:c,beExchangeAsset:l,transactionSignature:u}=e.asset.beExchangeAnyMulti,{beExchangeChainName:g,beExchangeSource:y,beExchangeParentAssetType:m,beExchangeAssetType:d,beExchangeAssetPrealnum:I}=l;let T=0;for(const S of c){const{toExchangeSource:w,toExchangeChainName:b,toExchangeParentAssetType:R,toExchangeAssetType:v,toExchangeAssetPrealnum:$,taxInformation:D}=S;if(R===G.ASSETS){const L=this.chainAssetInfoHelper.getAssetInfo(b,w,v);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:L,amount:$,sourceAmount:$,frozenId:u,recipientId:i,frozenReason:it.EXCHANGE}}),T++}else{let L=s;if($==="0"&&(L=i),R===G.DAPP)n.next=t.emit("unfrozenDAppid",{type:"unfrozenDAppid",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:L,sourceChainName:b,sourceChainMagic:w,dappid:v,status:0,frozenId:u}}),T++;else if(R===G.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:L,sourceChainName:b,sourceChainMagic:w,name:v,status:0,frozenId:u}}),T++;else if(R===G.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:L,sourceChainName:b,sourceChainMagic:w,entityId:v,status:0,frozenId:u}}),T++,D){const{taxCollector:z,taxAssetPrealnum:Y}=D,x=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);Y==="0"?n.next=this._applyTransactionEmitAsset(t,e,Y,{senderId:s,senderPublicKeyBuffer:o,recipientId:z,assetInfo:x}):n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:z,assetInfo:x,amount:Y,sourceAmount:Y,recipientId:i,frozenId:u+this.Buffer.from("_entity").toString("hex"),frozenReason:it.EXCHANGE}})}}else if(R===G.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:L,sourceChainName:b,sourceChainMagic:w,certificateId:v,status:0,frozenId:u}});else throw new nt(a.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${R}`,target:"transaction.asset.beExchangeAnyMulti.toExchangeAsset"})}}if(m===G.ENTITY&&l.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:g,sourceChainMagic:y,parentAssetType:m,assetType:d,taxInformation:l.taxInformation.toJSON()}})),I==="0"){if(l.taxInformation){const S=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,"0",{senderId:s,senderPublicKeyBuffer:o,recipientId:l.taxInformation.taxCollector,assetInfo:S})}return}if(m===G.ASSETS){const S=this.chainAssetInfoHelper.getAssetInfo(g,y,d),w=(BigInt(I)*BigInt(T)).toString();n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:S,amount:`-${w}`,sourceAmount:w}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:i,assetInfo:S,amount:w,sourceAmount:w}})}else if(m===G.DAPP)n.next=t.emit("changeDAppidPossessor",{type:"changeDAppidPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:g,sourceChainMagic:y,dappid:d}});else if(m===G.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:g,sourceChainMagic:y,name:d}});else if(m===G.ENTITY){if(n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:g,sourceChainMagic:y,entityId:d}}),l.taxInformation){const S=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,l.taxInformation.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:o,recipientId:l.taxInformation.taxCollector,assetInfo:S})}}else if(m===G.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:g,sourceChainMagic:y,certificateId:d}});else throw new nt(a.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${m}`,target:"transaction.asset.beExchangeAnyMulti.beExchangeAsset"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeAssets:s,beExchangeAsset:i}=e.asset.beExchangeAnyMulti;for(const o of s){const{toExchangeSource:c,toExchangeAssetType:l,toExchangeAssetPrealnum:u}=o;if(r===c&&n===l)return u}return r===i.beExchangeSource&&n===i.beExchangeAssetType?i.beExchangeAssetPrealnum:"0"}};zl=p([j(),Se(0,k("Buffer")),h("design:paramtypes",[Object,de,_e,Re,re,Le])],zl);var{ArgumentIllegalException:yt}=Z("CONTROLLER","ToExchangeAnyMultiAllTransactionFactory"),Jl=class extends Ge{constructor(e,t,r,n,s,i){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new yt(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new yt(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new yt(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});const s=t.toExchangeAnyMultiAll;if(!s)throw new yt(a.PARAM_LOST,{param:"toExchangeAnyMultiAll",...n});const i=s.cipherPublicKeys,o=new Set(i);if(i.length!==o.size)throw new yt(a.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",target:"toExchangeAnyMultiAll"});if(!this.baseHelper.isValidCipherPublicKeys(i))throw new yt(a.PROP_IS_INVALID,{prop:"cipherPublicKeys",target:"toExchangeAnyMultiAll"});const{toExchangeAssets:c,beExchangeAssets:l}=s;await this.verifyExchangeAnyMultiAll("toExchangeAnyMultiAll",c,l,r);for(const{beExchangeParentAssetType:u,beExchangeAssetPrealnum:g}of l)if(u===G.ASSETS){if(g==="0")throw new yt(a.PROP_SHOULD_GT_FIELD,{prop:"beExchangeAssetPrealnum",field:"0",target:"toExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}else if(g!=="1")throw new yt(a.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${g}`,to_target:"toExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset",be_compare_prop:"1"});if(e.storage)throw new yt(a.SHOULD_NOT_EXIST,{prop:"storage",...n})}async verifyExchangeAnyMultiAll(e,t,r,n=this.configHelper){const{baseHelper:s}=this;if(!t)throw new yt(a.PARAM_LOST,{param:`${e}.toExchangeAssets`});if(!r)throw new yt(a.PARAM_LOST,{param:`${e}.beExchangeAssets`});if(t.length<=0)throw new yt(a.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"toExchangeAssets",target:e,field:0});if(r.length<=0)throw new yt(a.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"beExchangeAssets",target:e,field:0});const i=this.configHelper.magic,o=new Set,c={target:`${e}.toExchangeAssets.toExchangeAsset`};for(const g of t){const{toExchangeChainName:y,toExchangeSource:m,toExchangeParentAssetType:d,toExchangeAssetType:I,toExchangeAssetPrealnum:T,taxInformation:S}=g,w=`${m}-${I}`;if(o.has(w))throw new yt(a.SHOULD_NOT_DUPLICATE,{prop:`toExchangeAssets.toExchangeAsset ${JSON.stringify(g)}`,target:e});if(o.add(w),this.checkParentAssetType(d,"toExchangeParentAssetType",c),m===i&&(this.checkChainName(y,"toExchangeChainName",c),this.checkChainMagic(m,"toExchangeSource",c),this.checkAssetType(d,I,"toExchangeAssetType",c)),!T)throw new yt(a.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...c});if(!s.isValidAssetNumber(T))throw new yt(a.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...c});if(d===G.ENTITY)await this.checkTaxInformation(c,S);else if(S)throw new yt(a.SHOULD_NOT_EXIST,{prop:"taxInformation",...c});if(d===G.ASSETS){if(T==="0")throw new yt(a.PROP_SHOULD_GT_FIELD,{prop:"toExchangeAssetPrealnum",field:"0",target:`${e}.toExchangeAssets.toExchangeAsset`})}else if(T!=="1")throw new yt(a.SHOULD_BE,{to_compare_prop:`toExchangeAssetPrealnum ${T}`,to_target:`${e}.toExchangeAssets.toExchangeAsset`,be_compare_prop:"1"})}const l={target:`${e}.beExchangeAssets.beExchangeAsset`},u=new Set;for(const g of r){const{beExchangeChainName:y,beExchangeSource:m,beExchangeParentAssetType:d,beExchangeAssetType:I,beExchangeAssetPrealnum:T,taxInformation:S}=g,w=`${m}-${I}`;if(o.has(w))throw new yt(a.SHOULD_NOT_BE,{to_compare_prop:`beExchangeAssetType ${I}`,to_target:"toExchangeAnyMultiAll.beExchangeAssets",be_compare_prop:I});if(u.has(w))throw new yt(a.SHOULD_NOT_DUPLICATE,{prop:`beExchangeAssets.beExchangeAsset ${JSON.stringify(g)}`,target:e});if(u.add(w),this.checkParentAssetType(d,"beExchangeParentAssetType",l),m===i&&(this.checkChainName(y,"beExchangeChainName",l),this.checkChainMagic(m,"beExchangeSource",l),this.checkAssetType(d,I,"beExchangeAssetType",l)),!T)throw new yt(a.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...l});if(!s.isValidAssetNumber(T))throw new yt(a.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...l});if(d===G.ENTITY)await this.checkTaxInformation(l,S);else if(S)throw new yt(a.SHOULD_NOT_EXIST,{prop:"taxInformation",target:`${e}.beExchangeAssets.beExchangeAsset`})}}init(e,t){return to.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,signature:o}=e,{toExchangeAssets:c,beExchangeAssets:l}=e.asset.toExchangeAnyMultiAll;let u=BigInt(0);for(const g of c){const{toExchangeSource:y,toExchangeChainName:m,toExchangeParentAssetType:d,toExchangeAssetType:I,toExchangeAssetPrealnum:T,taxInformation:S}=g;if(d===G.ASSETS){const w=this.chainAssetInfoHelper.getAssetInfo(m,y,I);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:w,amount:`-${T}`,sourceAmount:T,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o,frozenReason:it.EXCHANGE}})}else if(d===G.DAPP)n.next=t.emit("frozenDAppid",{type:"frozenDAppid",transaction:e,applyInfo:{address:s,sourceChainName:m,sourceChainMagic:y,dappid:I,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(d===G.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:s,sourceChainName:m,sourceChainMagic:y,name:I,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else if(d===G.ENTITY){if(n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:s,sourceChainName:m,sourceChainMagic:y,entityId:I,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}}),S){n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:m,sourceChainMagic:y,parentAssetType:d,assetType:I,taxInformation:S.toJSON()}});const{taxAssetPrealnum:w}=S;w!=="0"&&(u+=BigInt(S.taxAssetPrealnum))}}else if(d===G.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:s,sourceChainName:m,sourceChainMagic:y,certificateId:I,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:o}});else throw new yt(a.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${d}`,target:"toExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}if(u!==BigInt(0)){const g=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,assetInfo:g,amount:`-${u.toString()}`,sourceAmount:u.toString(),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:o+this.Buffer.from("_entity").toString("hex"),frozenReason:it.EXCHANGE}})}for(const g of l)g.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:g.beExchangeChainName,sourceChainMagic:g.beExchangeSource,parentAssetType:g.beExchangeParentAssetType,assetType:g.beExchangeAssetType,taxInformation:g.taxInformation.toJSON()}}))})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,s=e.asset.toExchangeAnyMultiAll.toExchangeAssets;for(const i of s){const{toExchangeSource:o,toExchangeAssetType:c,toExchangeAssetPrealnum:l}=i;if(r===o&&n===c)return l}return"0"}};Jl=p([j(),Se(0,k("Buffer")),h("design:paramtypes",[Object,de,_e,Re,re,Le])],Jl);var{ArgumentIllegalException:nn}=Z("CONTROLLER","BeExchangeAnyMultiAllTransactionFactory"),Cd=class extends Ge{constructor(e,t,r,n,s,i,o){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=i,this.toExchangeAnyMultiAllTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new nn(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new nn(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new nn(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new nn(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="transactionSignature")throw new nn(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const o=t.beExchangeAnyMultiAll;if(!o)throw new nn(a.PARAM_LOST,{param:"beExchangeAnyMultiAll"});const c={...n,target:"beExchangeAnyMultiAll"},{transactionSignature:l}=o;if(!l)throw new nn(a.PROP_IS_REQUIRE,{prop:"transactionSignature",...c});if(!s.isValidSignature(l))throw new nn(a.PROP_IS_INVALID,{prop:`transactionSignature ${l}`,type:"transaction signature",...c});if(i.value!==l)throw new nn(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`transactionSignature ${l}`,to_target:"storage",be_target:"beExchangeAnyMultiAll",...n});const{toExchangeAssets:u,beExchangeAssets:g,ciphertextSignature:y}=o;if(await this.toExchangeAnyMultiAllTransactionFactory.verifyExchangeAnyMultiAll("beExchangeAnyMultiAll",u,g,r),y){if(!s.isValidAccountSignature(y))throw new nn(a.PROP_IS_INVALID,{prop:`ciphertextSignature ${y}`,...c});const{signature:m,publicKey:d}=y;if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:me(d),ciphertextSignatureBuffer:me(m),transactionSignatureBuffer:me(l),senderId:e.senderId}))throw new nn(a.PROP_IS_INVALID,{prop:`ciphertextSignature ${m}`,type:"signature",...c})}}init(e,t){return wp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{toExchangeAssets:c,beExchangeAssets:l,transactionSignature:u}=e.asset.beExchangeAnyMultiAll;for(const g of c){const{toExchangeSource:y,toExchangeChainName:m,toExchangeParentAssetType:d,toExchangeAssetType:I,toExchangeAssetPrealnum:T,taxInformation:S}=g;if(d===G.ASSETS){const w=this.chainAssetInfoHelper.getAssetInfo(m,y,I);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:w,amount:T,sourceAmount:T,frozenId:u,recipientId:i,frozenReason:it.EXCHANGE}})}else{const w=s;if(d===G.DAPP)n.next=t.emit("unfrozenDAppid",{type:"unfrozenDAppid",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:w,sourceChainName:m,sourceChainMagic:y,dappid:I,status:0,frozenId:u}});else if(d===G.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:w,sourceChainName:m,sourceChainMagic:y,name:I,status:0,frozenId:u}});else if(d===G.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:w,sourceChainName:m,sourceChainMagic:y,entityId:I,status:0,frozenId:u}}),S){const{taxCollector:b,taxAssetPrealnum:R}=S,v=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);R==="0"?n.next=this._applyTransactionEmitAsset(t,e,R,{senderId:s,senderPublicKeyBuffer:o,recipientId:b,assetInfo:v}):n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:b,assetInfo:v,amount:R,sourceAmount:R,recipientId:i,frozenId:u+this.Buffer.from("_entity").toString("hex"),frozenReason:it.EXCHANGE}})}}else if(d===G.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:w,sourceChainName:m,sourceChainMagic:y,certificateId:I,status:0,frozenId:u}});else throw new nn(a.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${d}`,target:"beExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}}for(const g of l){const{beExchangeChainName:y,beExchangeSource:m,beExchangeParentAssetType:d,beExchangeAssetType:I,beExchangeAssetPrealnum:T,taxInformation:S}=g;if(d===G.ENTITY&&g.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:y,sourceChainMagic:m,parentAssetType:d,assetType:I,taxInformation:g.taxInformation.toJSON()}})),T==="0"){if(g.taxInformation){const w=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,"0",{senderId:s,senderPublicKeyBuffer:o,recipientId:g.taxInformation.taxCollector,assetInfo:w})}continue}if(d===G.ASSETS){const w=this.chainAssetInfoHelper.getAssetInfo(y,m,I),b=T;n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:w,amount:`-${b}`,sourceAmount:b}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:i,assetInfo:w,amount:b,sourceAmount:b}})}else if(d===G.DAPP)n.next=t.emit("changeDAppidPossessor",{type:"changeDAppidPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:y,sourceChainMagic:m,dappid:I}});else if(d===G.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:y,sourceChainMagic:m,name:I}});else if(d===G.ENTITY){if(n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:y,sourceChainMagic:m,entityId:I}}),S){const w=this.chainAssetInfoHelper.getAssetInfo(r.chainName,r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,S.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:o,recipientId:S.taxCollector,assetInfo:w})}}else if(d===G.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:i,sourceChainName:y,sourceChainMagic:m,certificateId:I}});else throw new nn(a.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${d}`,target:"beExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeAssets:s,beExchangeAssets:i}=e.asset.beExchangeAnyMultiAll;for(const o of s){const{toExchangeSource:c,toExchangeAssetType:l,toExchangeAssetPrealnum:u}=o;if(r===c&&n===l)return u}for(const o of i)if(r===o.beExchangeSource&&n===o.beExchangeAssetType)return o.beExchangeAssetPrealnum;return"0"}};Cd=p([j(),Se(0,k("Buffer")),h("design:paramtypes",[Object,de,_e,Re,re,Le,Jl])],Cd);var{ArgumentIllegalException:An}=Z("CONTROLLER","IssueCertificateTransactionFactory"),Rd=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(e.recipientId,!e.recipientId)throw new An(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new An(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new An(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new An(a.PROP_IS_REQUIRE,{prop:"storage",...n});const i=e.storage;if(i.key!=="certificateId")throw new An(a.SHOULD_BE,{to_compare_prop:`storage.key ${i.key}`,to_target:"storage",be_compare_prop:"certificateId",...n});const o=t.issueCertificate;if(!o)throw new An(a.PARAM_LOST,{param:"issueCertificate"});const c={...n,target:"issueCertificateAsset"},{sourceChainMagic:l,sourceChainName:u,certificateId:g,type:y}=o;if(this.checkChainName(u,"sourceChainName",c),u!==r.chainName)throw new An(a.SHOULD_BE,{to_compare_prop:`sourceChainName ${u}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(l,"sourceChainMagic",c),l!==r.magic)throw new An(a.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${u}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!g)throw new An(a.PROP_IS_REQUIRE,{prop:"certificateId",...c});if(!s.isValidCertificateId(g))throw new An(a.PROP_IS_INVALID,{prop:`certificateId ${g}`,...c});if(y!==0&&y!==1&&y!==2)throw new An(a.NOT_MATCH,{to_compare_prop:`type ${y}`,be_compare_prop:"type",to_target:"dapp",be_target:"CERTIFICATE_TYPE"});if(i.value!==g)throw new An(a.NOT_MATCH,{to_compare_prop:`storage.value ${i.value}`,be_compare_prop:`certificateId ${g}`,to_target:"storage",be_target:"issueCertificate",...n})}init(e,t){return Np.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:i,senderPublicKeyBuffer:o}=e,{sourceChainName:c,sourceChainMagic:l,certificateId:u,type:g}=e.asset.issueCertificate;n.next=t.emit("issueCertificate",{type:"issueCertificate",transaction:e,applyInfo:{address:s,possessorAddress:i,publicKeyBuffer:o,sourceChainName:c,sourceChainMagic:l,certificateId:u,type:g,status:0,issueId:e.signature}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};Rd=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Rd);var{ArgumentIllegalException:ys}=Z("CONTROLLER","DestroyCertificateTransactionFactory"),Pd=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new ys(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ys(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ys(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new ys(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="certificateId")throw new ys(a.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"certificateId",...n});const i=t.destroyCertificate;if(!i)throw new ys(a.PARAM_LOST,{param:"destroyCertificate"});const o={...n,target:"destroyCertificateAsset"},{sourceChainMagic:c,sourceChainName:l,certificateId:u,type:g}=i;if(l!==r.chainName)throw new ys(a.SHOULD_BE,{to_compare_prop:"sourceChainName",to_target:"body",be_compare_prop:"local chain name",...o});if(c!==r.magic)throw new ys(a.SHOULD_BE,{to_compare_prop:"sourceChainMagic",to_target:"body",be_compare_prop:"local chain magic",...o});if(!this.baseHelper.isValidCertificateId(u))throw new ys(a.PROP_IS_INVALID,{prop:`certificateId ${u}`,...o});if(s.value!==u)throw new ys(a.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`certificateId ${u}`,to_target:"storage",be_target:"destroyCertificate"})}init(e,t){return Op.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i,recipientId:o}=e,{sourceChainMagic:c,sourceChainName:l,certificateId:u,type:g}=e.asset.destroyCertificate;n.next=t.emit("destroyCertificate",{type:"destroyCertificate",transaction:e,applyInfo:{address:s,possessorAddress:o,publicKeyBuffer:i,sourceChainName:l,sourceChainMagic:c,certificateId:u,status:255}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};Pd=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Pd);var{ArgumentFormatException:uh,OutOfRangeException:nw,ConsensusException:tA,warn:rA}=Z("CONTROLLER","transaction"),kt=class{constructor(e,t,r,n,s,i,o){this.transactionHelper=e,this.accountBaseHelper=t,this.asymmetricHelper=r,this.keypairHelper=n,this.Buffer=s,this.config=i,this.moduleMap=o,this._txFactoryCache=new Map,this.fromJSON=this.recombineTransaction}getTransactionFactory(e){let t=this._txFactoryCache.get(e);return t||(t=At(e,this.moduleMap),this._txFactoryCache.set(e,t)),t}getTransactionFactoryFromType(e){const{baseType:t}=this.transactionHelper.parseType(e);return this.getTransactionFactoryFromBaseType(t)}getTransactionFactoryFromBaseType(e){const t=xr.VF.get(e);if(!t)throw new uh(a.INVALID_BASE_TYPE,{base_type:e});return this.getTransactionFactory(t)}canCreateTransaction(e){return this.transactionHelper.isTransactionInFilter(e)}get abortForbiddenTransaction(){return this.transactionHelper.abortForbiddenTransaction}async createTransactionWithoutSignature(e,t,r,n=this.config){const s=t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e);if(!this.canCreateTransaction(s)){const c=ve.VK.get(ve.trsTypeToV(s)),l=new tA(a.DISABLED_CREATE_TRANSACTION,{trsName:c});if(this.abortForbiddenTransaction)throw l;rA(l)}const i=this.getTransactionFactory(e);await i.verifyTransactionBody(t,r,n);const o={version:t.version,type:t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e),senderId:t.senderId,senderPublicKey:t.senderPublicKey,senderSecondPublicKey:t.senderSecondPublicKey,recipientId:t.recipientId||void 0,rangeType:t.rangeType,range:t.range,timestamp:t.timestamp,fee:t.fee,remark:t.remark,dappid:t.dappid||void 0,lns:t.lns||void 0,sourceIP:t.sourceIP||void 0,fromMagic:t.fromMagic,toMagic:t.toMagic,applyBlockHeight:t.applyBlockHeight,effectiveBlockHeight:t.effectiveBlockHeight,storage:t.storage};return i.init(o,r)}async createTransaction(e,t,r,n,s,i=this.config){const o=t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e);if(!this.canCreateTransaction(o)){const g=ve.VK.get(ve.trsTypeToV(o)),y=new tA(a.DISABLED_CREATE_TRANSACTION,{trsName:g});if(this.abortForbiddenTransaction)throw y;rA(y)}const c=this.getTransactionFactory(e);c.verifyKeypair(n),s&&c.verifySecondKeypair(s),await c.verifyTransactionBody(t,r,i);const l={version:t.version,type:t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e),senderId:t.senderId,senderPublicKey:t.senderPublicKey,senderSecondPublicKey:t.senderSecondPublicKey,recipientId:t.recipientId||void 0,rangeType:t.rangeType,range:t.range,timestamp:t.timestamp,fee:t.fee,remark:t.remark,dappid:t.dappid||void 0,lns:t.lns||void 0,sourceIP:t.sourceIP||void 0,fromMagic:t.fromMagic,toMagic:t.toMagic,applyBlockHeight:t.applyBlockHeight,effectiveBlockHeight:t.effectiveBlockHeight,storage:t.storage},u=c.init(l,r);return u.signatureBuffer=await this.asymmetricHelper.detachedSign(u.getBytes(!0,!0),n.secretKey),s&&(u.signSignatureBuffer=await this.asymmetricHelper.detachedSign(u.getBytes(!1,!0),s.secretKey)),this.transactionHelper.verifyTransactionSize(u),this.transactionHelper.verifyTransactionBlobSize(u),u}async recombineTransaction(e){return await this.getTransactionFactoryFromType(e.type).fromJSON(e)}recombineTransactionInBlock(e){return Xt.fromObject(e)}parseBytesToTransaction(e){return Je.decode(e)}parseBytesToSomeTransaction(e){const t=new Nn(e);t.uint32(),t.uint32(),t.uint32();const r=t.string();return this.getTransactionModelConstructorFromType(r).decode(e)}getTransactionModelConstructorFromType(e){const{baseType:t}=this.transactionHelper.parseType(e);return this.getTransactionModelConstructorFromBaseType(t)}getTransactionModelConstructorFromBaseType(e){const t=ve.VM.get(e);if(!t)throw new uh(a.INVALID_BASE_TYPE,{base_type:e});return t}getTransactionTypeFromTransactionFactoryConstructor(e){const t=xr.FV.get(e);if(!t)throw new uh(a.UNREGISTERED_TRANSACTION_FACTORY,{factoryName:e.name});const r=xr.VK.get(t);if(!r)throw new uh(a.UNREGISTERED_TRANSACTION_BASE_TYPE,{trs_base:t});const n=this.transactionHelper[r];if(!n)throw new uh(a.UNREGISTERED_TRANSACTION_TYPE,{trs_key:r});return n}getMoveAmount(e,t={magic:this.config.magic,assetType:this.config.assetType}){return this.getTransactionFactoryFromType(e.type).getMoveAmount(e,t)}};kt=p([j("bfchain-core:TransactionCore"),Se(3,k("keypairHelper")),Se(4,k("Buffer")),h("design:paramtypes",[_e,de,_r,Object,Object,re,je])],kt);var xr=(()=>{const e=new Map,t=new Map;for(const s in B){const i=B[s];t.set(s,i),e.set(i,s)}const r=new Map,n=new Map;return[[B.SIGNATURE,Rl],[B.DAPP,ph],[B.DAPP_PURCHASING,dd],[B.MARK,yd],[B.ISSUE_ASSET,md],[B.INCREASE_ASSET,_d],[B.DESTROY_ASSET,Hl],[B.TRANSFER_ASSET,xl],[B.TO_EXCHANGE_ASSET,kl],[B.BE_EXCHANGE_ASSET,Ad],[B.GIFT_ASSET,Ml],[B.GRAB_ASSET,Id],[B.TRUST_ASSET,Fl],[B.SIGN_FOR_ASSET,Ed],[B.EMIGRATE_ASSET,Td],[B.IMMIGRATE_ASSET,Sd],[B.STAKE_ASSET,Ul],[B.UNSTAKE_ASSET,bd],[B.LOCATION_NAME,wd],[B.SET_LNS_RECORD_VALUE,Od],[B.SET_LNS_MANAGER,Nd],[B.ISSUE_ENTITY_FACTORY,Sa],[B.ISSUE_ENTITY_FACTORY_V1,$l],[B.ISSUE_ENTITY,Vl],[B.DESTROY_ENTITY,vd],[B.ISSUE_ENTITY_MULTI,Kl],[B.TRANSFER_ANY,Bl],[B.GIFT_ANY,hh],[B.GRAB_ANY,Dl],[B.TO_EXCHANGE_ANY,lh],[B.BE_EXCHANGE_ANY,Gl],[B.TO_EXCHANGE_ANY_MULTI,jl],[B.BE_EXCHANGE_ANY_MULTI,zl],[B.TO_EXCHANGE_ANY_MULTI_ALL,Jl],[B.BE_EXCHANGE_ANY_MULTI_ALL,Cd],[B.ISSUE_CERTIFICATE,Rd],[B.DESTROY_CERTIFICATE,Pd]].forEach(([s,i])=>{r.set(s,i),n.set(i,s)}),{VK:e,KV:t,VF:r,FV:n,trsTypeToV(s){const i=s.indexOf("-",s.indexOf("-")+1);return s.substr(i+1)}}})(),{ConsensusException:bt}=Z("VERIFIER","HelperLogicVerifier"),bi=class{deepClone(e){const t=Array.isArray(e)?[]:{};if(typeof e=="object"){for(const r in e)e[r]&&typeof e[r]=="object"?t[r]=this.deepClone(e[r]):t[r]=e[r];return t}else return e}async isAccountFrozen(e,t){const r=await this.accountGetterHelper.getAccountInfo(e,t);if(r&&r.accountStatus!==0)throw new bt(a.ACCOUNT_FROZEN,{address:e,status:r.accountStatus})}async isPossessAssetExceptChainAsset(e,t,r=this.configHelper){for(const n in t){const s=t[n];for(const i in s)if(i!==r.assetType&&s[i].assetNumber>BigInt(0))throw new bt(a.POSSESS_ASSET_EXCEPT_CHAIN_ASSET)}if(await this.accountGetterHelper.isPossessFrozenAssetExceptMain(e))throw new bt(a.POSSESS_FROZEN_ASSET_EXCEPT_CHAIN_ASSET)}async isDAppPossessor(e,t=this.configHelper){if(await this.accountGetterHelper.isDAppPossessor(t.magic,e))throw new bt(a.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"DApp id possessor can not initiate a frozen account transaction"})}async isLnsPossessorOrManager(e,t=this.configHelper){if(await this.accountGetterHelper.isLocationNamePossessor(t.magic,e))throw new bt(a.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Location name possessor or manager can not initiate a frozen account transaction"})}async isEntityFactoryPossessor(e,t=this.configHelper){if(await this.accountGetterHelper.isEntityFactoryPossessor(t.magic,e))throw new bt(a.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"EntityFactory possessor can not initiate a frozen account transaction"})}async isEntityPossessor(e,t=this.configHelper){if(await this.accountGetterHelper.isEntityPossessor(t.magic,e))throw new bt(a.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Entity possessor can not initiate a frozen account transaction"})}async isCertApplicantOrPossessor(e,t=this.configHelper){if(await this.accountGetterHelper.isCertApplicantOrPossessor(t.magic,e))throw new bt(a.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Certificate applicant or possessor can not initiate a frozen account transaction"})}async isStakeAsset(e){if(await this.accountGetterHelper.isStakeAsset(e))throw new bt(a.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Already stake asset can not initiate a frozen account transaction"})}async isChainAssetPossessor(e){await this.isDAppPossessor(e,this.configHelper),await this.isLnsPossessorOrManager(e,this.configHelper),await this.isEntityFactoryPossessor(e,this.configHelper),await this.isEntityPossessor(e,this.configHelper),await this.isCertApplicantOrPossessor(e,this.configHelper),await this.isStakeAsset(e)}async isAssetExist(e,t,r){const n=await this.accountGetterHelper.getAsset(t,r);if(!n)throw new bt(a.NOT_EXIST,{prop:`asset with magic ${t} assetType ${r}`,target:"blockChain"});if(n.sourceChainName!==e)throw new bt(a.NOT_MATCH,{to_compare_prop:`sourceChainName ${n.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} assetType ${r}`,be_target:`transaction magic ${t} assetType ${r}`});return n}async isDAppExist(e,t,r,n){const s=await this.accountGetterHelper.getDApp(t,r,n);if(!s)throw new bt(a.DAPPID_IS_NOT_EXIST,{dappid:r,errorId:Ce.DAPPID_NOT_EXIST});if(s.sourceChainName!==e)throw new bt(a.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} dappid ${r}`,be_target:`transaction magic ${t} dappid ${r}`});return s}async isLocationNameExist(e,t,r,n){const s=await this.accountGetterHelper.getLocationName(t,r,n);if(!s)throw new bt(a.LOCATION_NAME_IS_NOT_EXIST,{locationName:r,errorId:Ce.LOCATION_NAME_NOT_EXIST});if(s.sourceChainName!==e)throw new bt(a.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} locationName ${r}`,be_target:`transaction magic ${t} locationName ${r}`});return s}async isEntityFactoryExist(e,t,r,n){const s=await this.accountGetterHelper.getEntityFactory(t,r,n);if(!s)throw new bt(a.ENTITY_FACTORY_IS_NOT_EXIST,{factoryId:r,errorId:Ce.ENTITY_FACTORY_NOT_EXIST});if(s.sourceChainName!==e)throw new bt(a.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} factoryId ${r}`,be_target:`transaction magic ${t} factoryId ${r}`});return s}async isEntityExist(e,t,r,n){const s=await this.accountGetterHelper.getEntity(t,r,n);if(!s)throw new bt(a.ENTITY_IS_NOT_EXIST,{entityId:r,errorId:Ce.ENTITY_NOT_EXIST});if(s.sourceChainName!==e)throw new bt(a.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} entityId ${r}`,be_target:`transaction magic ${t} entityId ${r}`});return s}async isCertificateExist(e,t,r,n){const s=await this.accountGetterHelper.getCertificate(t,r,n);if(!s)throw new bt(a.CERTIFICATE_IS_NOT_EXIST,{certificateId:r,errorId:Ce.CERTIFICATE_NOT_EXIST});if(s.sourceChainName!==e)throw new bt(a.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} certificateId ${r}`,be_target:`transaction magic ${t} certificateId ${r}`});return s}async getAccountForce(e,t,r){let n=e.get(t);if(!n){if(n=await this.accountGetterHelper.getAccountInfo(t,r),!n)throw new bt(a.NOT_EXIST,{prop:`Account with address ${t}`,target:"blockChain"});e.set(t,n)}return n}async getFrozenAssetForce(e,t,r){const n=await this.accountGetterHelper.getFrozenAsset(e,t,r);if(!n)throw new bt(a.FROZEN_ASSET_NOT_EXIST_OR_EXPIRED,{frozenAddress:e,signature:t,assetType:r});return n}async getStakeAssetForce(e,t){const r=await this.accountGetterHelper.getStakeAsset(e,t);if(!r)throw new bt(a.STAKE_ASSET_NOT_EXIST_OR_EXPIRED,{stakeAddress:e,stakeId:t});return r}};p([k(re),h("design:type",re)],bi.prototype,"configHelper",void 0),p([k("accountGetterHelper",{dynamics:!0}),h("design:type",Object)],bi.prototype,"accountGetterHelper",void 0),bi=p([j()],bi);var{ConsensusException:W,NoFoundException:sw}=Z("VERIFIER","EventLogicVerifier"),$n=class{addRecord(e,t,r){const{recordType:n,recordValue:s}=t;if(r&&r[n]&&r[n][s])throw new W(a.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:e,reason:"New location name record value already exist"})}deleteRecord(e,t,r){const{recordType:n,recordValue:s}=t;if(!(r[n]&&r[n][s]))throw new W(a.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:e,reason:"Delete location name record value not exist"})}__listenEventFee(e,t,r){r.on("fee",async({transaction:n,applyInfo:s},i)=>{const{magic:o,assetType:c}=this.configHelper;if(o!==this.configHelper.magic)throw new W(a.SHOULD_BE,{to_compare_prop:`magic ${o}`,to_target:"applyInfo",be_compare_prop:this.configHelper.magic});if(c!==this.configHelper.assetType)throw new W(a.SHOULD_BE,{to_compare_prop:`assetType ${c}`,to_target:"applyInfo",be_compare_prop:this.configHelper.assetType});const l=BigInt(s.amount),u=s.address,{assets:g}=await this.helperLogicVerifier.getAccountForce(e,u,t);g[o]=g[o]||{},g[o][c]=g[o][c]||{sourceChainMagic:o,assetType:c,assetNumber:BigInt(0),history:{}};const y=g[o][c],m=y.assetNumber;if(y.assetNumber+=l,y.assetNumber<BigInt(0))throw new W(a.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${n.signature} address: ${u} magic ${s.assetInfo.magic} assetType: ${s.assetInfo.assetType} hodingAsset: ${m.toString()} spendFee: ${s.amount}`,errorId:Ce.ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/fee"})}__listenEventDestroyMainAsset(e,t,r){r.on("destroyMainAsset",async({transaction:n,applyInfo:s},i)=>{const{magic:o,assetType:c}=this.configHelper;if(o!==this.configHelper.magic)throw new W(a.SHOULD_BE,{to_compare_prop:`magic ${o}`,to_target:"applyInfo",be_compare_prop:this.configHelper.magic});if(c!==this.configHelper.assetType)throw new W(a.SHOULD_BE,{to_compare_prop:`assetType ${c}`,to_target:"applyInfo",be_compare_prop:this.configHelper.assetType});const{amount:l,sourceAmount:u}=s,g=await this.accountGetterHelper.getAsset(o,c);if(!g)throw new W(a.ASSET_NOT_EXIST,{magic:o,assetType:c,errorId:Ce.ASSET_NOT_EXIST});if(g.remainAssetPrealnum<BigInt(u))throw new W(a.ASSET_NOT_ENOUGH,{reason:`Asset ${o} ${c} remain: ${g.remainAssetPrealnum.toString()} destroyAsset: ${l}`,errorId:Ce.ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/destroyMainAsset"})}__listenEventAsset(e,t,r){r.on("asset",async({transaction:n,applyInfo:s},i)=>{const{magic:o,assetType:c}=s.assetInfo,l=s.address,{assets:u}=await this.helperLogicVerifier.getAccountForce(e,l,t);u[o]=u[o]||{},u[o][c]=u[o][c]||{sourceChainMagic:o,assetType:c,assetNumber:BigInt(0),history:{}};const g=u[o][c],y=g.assetNumber;if(g.assetNumber+=BigInt(s.amount),g.assetNumber<BigInt(0))throw new W(a.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${n.signature} address: ${l} magic ${s.assetInfo.magic} assetType: ${s.assetInfo.assetType} hodingAsset: ${y.toString()} spendAsset: ${s.amount}`,errorId:Ce.ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/asset"})}__listenEventFrozenAsset(e,t,r){r.on("frozenAsset",async({transaction:n,applyInfo:s},i)=>{const{magic:o,assetType:c}=s.assetInfo,l=s.address,{assets:u}=await this.helperLogicVerifier.getAccountForce(e,l,t);u[o]=u[o]||{},u[o][c]=u[o][c]||{sourceChainMagic:o,assetType:c,assetNumber:BigInt(0),history:{}};const g=u[o][c],y=g.assetNumber;if(g.assetNumber+=BigInt(s.amount),g.assetNumber<BigInt(0))throw new W(a.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${n.signature} address: ${l} magic ${s.assetInfo.magic} assetType: ${s.assetInfo.assetType} hodingAsset: ${y.toString()} frozenAsset: ${s.amount}`,errorId:Ce.ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/frozenAsset"})}__listenEventUnfrozenAsset(e,t){t.on("unfrozenAsset",async({transaction:r,applyInfo:n},s)=>{const{assetInfo:i,frozenId:o,amount:c,recipientId:l}=n,{magic:u,assetType:g}=i,y=await this.helperLogicVerifier.getFrozenAssetForce(l,o,g),{maxEffectiveHeight:m,minEffectiveHeight:d,remainUnfrozenTimes:I,amount:T}=y;if(d>e)throw new W(a.NOT_BEGIN_UNFROZEN_YET,{frozenId:o});if(e>m)throw new W(a.FROZEN_ASSET_EXPIRATION,{frozenId:o});if(m<e)throw new W(a.FROZEN_ASSET_EXPIRATION,{frozenId:o});if(BigInt(c)>BigInt(T))throw new W(a.FROZEN_ASSET_NOT_ENOUGH,{reason:`No enough asset to unfrozen magic ${u} assetType ${g} remain ${T} spend ${c}`,frozenId:o});if(I!==void 0&&I===0)throw new W(a.UNFROZEN_TIME_USE_UP,{frozenId:o});return s()},{taskname:"applyTransaction/logicVerifier/unfrozenAsset"})}__listenEventSignForAsset(e,t){t.on("signForAsset",async({transaction:r,applyInfo:n},s)=>{const{frozenId:i,frozenAddress:o,assetInfo:c}=n,l=await this.helperLogicVerifier.getFrozenAssetForce(o,i,c.assetType),{maxEffectiveHeight:u,minEffectiveHeight:g,remainUnfrozenTimes:y,amount:m}=l;if(g>e)throw new W(a.NOT_BEGIN_UNFROZEN_YET,{frozenId:i});if(e>u)throw new W(a.FROZEN_ASSET_EXPIRATION,{frozenId:i});if(u<e)throw new W(a.FROZEN_ASSET_EXPIRATION,{frozenId:i});if(BigInt(m)===BigInt(0))throw new W(a.ASSET_NOT_ENOUGH,{reason:`No enough asset to sign for magic ${l.sourceChainMagic} assetType ${l.assetType} remain ${m}`});if(y!==void 0&&y===0)throw new W(a.UNFROZEN_TIME_USE_UP,{frozenId:i});return s()},{taskname:"applyTransaction/logicVerifier/signForAsset"})}__listenEventFrozenAccount(e,t,r){r.on("frozenAccount",async({applyInfo:n},s)=>{const{address:i}=n,o=(await this.helperLogicVerifier.getAccountForce(e,i,t)).accountStatus;if(o===1||o===16||o===17)throw new W(a.ACCOUNT_FROZEN,{address:i,status:o});return s()},{taskname:"applyTransaction/logicVerifier/frozenAccount"})}__listenEventSetSecondPublicKey(e){e.on("setSecondPublicKey",({applyInfo:t},r)=>r(),{taskname:"applyTransaction/logicVerifier/setSecondPublicKey"})}async __checkAsset(e,t,r){await this.helperLogicVerifier.isAccountFrozen(e,r);const n=this.configHelper.magic;if(await this.accountGetterHelper.isCurrencyForbidden(t))throw new W(a.FORBIDDEN,{prop:`AssetType ${t}`,target:"blockChain"});if(await this.accountGetterHelper.getCurrency(t))throw new W(a.ALREADY_EXIST,{prop:`AssetType ${t}`,target:"blockChain",errorId:Ce.ASSETTYPE_ALREADY_EXIST});if(await this.accountGetterHelper.getAsset(n,t))throw new W(a.ASSET_ALREADY_EXIST,{magic:n,assetType:t,errorId:Ce.ASSET_ALREADY_EXIST})}__listenEventIssueAsset(e,t,r){r.on("issueAsset",async({transaction:n,applyInfo:s},i)=>{const{address:o,assetInfo:c,genesisAddress:l,sourceAmount:u}=s,{assetType:g}=c;await this.__checkAsset(l,g,t);const{assets:y}=await this.helperLogicVerifier.getAccountForce(e,o,t);await this.helperLogicVerifier.isPossessAssetExceptChainAsset(o,y),await this.helperLogicVerifier.isChainAssetPossessor(o);const{magic:m,assetType:d,issueAssetMinChainAsset:I}=this.configHelper,T=y[m][d].assetNumber;if(BigInt(I)>T)throw new W(a.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${I}, remain Assets: ${T}`,errorId:Ce.CHAIN_ASSET_NOT_ENOUGH});const S=this.jsbiHelper.multiplyFloorFraction(T,this.configHelper.maxMultipleOfAssetAndMainAsset);if(BigInt(u)>S)throw new W(a.PROP_SHOULD_LTE_FIELD,{prop:`expectedIssuedAssets ${u}`,target:"issueAsset",field:`calc max assets ${S}`});return i()},{taskname:"applyTransaction/logicVerifier/issueAsset"})}__listenEventIncreaseAsset(e,t,r){r.on("increaseAsset",async({transaction:n,applyInfo:s},i)=>{const{address:o,recipientId:c,assetInfo:l,applyAddress:u,sourceAmount:g}=s,{magic:y,assetType:m}=l,d=await this.accountGetterHelper.getAsset(y,m);if(!d)throw new W(a.ASSET_NOT_EXIST,{magic:y,assetType:m,errorId:Ce.ASSET_NOT_EXIST});if(u!==d.applyAddress)throw new W(a.NOT_MATCH,{to_compare_prop:`applyAddress ${u}`,to_target:"increaseAsset",be_compare_prop:`applyAddress ${d.applyAddress}`,be_target:"blockChain"});if(o!==d.genesisAddress)throw new W(a.NOT_MATCH,{to_compare_prop:`genesisAddress ${o}`,to_target:"increaseAsset",be_compare_prop:`genesisAddress ${d.genesisAddress}`,be_target:"blockChain"});return i()},{taskname:"applyTransaction/logicVerifier/increaseAsset"})}__listenEventDestroyAsset(e){e.on("destroyAsset",async({applyInfo:t},r)=>{const{sourceAmount:n,assetInfo:s}=t,{magic:i,assetType:o}=s,c=await this.accountGetterHelper.getAsset(i,o);if(!c)throw new W(a.ASSET_NOT_EXIST,{magic:i,assetType:o,errorId:Ce.ASSET_NOT_EXIST});if(c.remainAssetPrealnum<BigInt(n))throw new W(a.ASSET_NOT_ENOUGH,{reason:`Asset ${i} ${o} remain: ${c.remainAssetPrealnum.toString()} destroyAsset: ${n}`,errorId:Ce.ASSET_NOT_ENOUGH});return r()},{taskname:"applyTransaction/logicVerifier/destroyAsset"})}__listenEventIssueDAppid(e,t){t.on("issueDAppid",async({applyInfo:r},n)=>{const{address:s,dappid:i,sourceChainMagic:o,possessorAddress:c}=r;if(s!==c&&await this.helperLogicVerifier.isAccountFrozen(c,e),await this.accountGetterHelper.getDApp(o,i,e))throw new W(a.DAPPID_IS_ALREADY_EXIST,{dappid:i,errorId:Ce.DAPP_ALREADY_EXISTS});return n()},{taskname:"applyTransaction/logicVerifier/issueDAppid"})}__listenEventFrozenDAppid(e,t){t.on("frozenDAppid",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,dappid:c}=r,l=await this.helperLogicVerifier.isDAppExist(i,o,c,e);if(l.possessorAddress!==s)throw new W(a.ACCOUNT_NOT_DAPPID_POSSESSOR,{address:s,dappid:c,errorId:Ce.ACCOUNT_NOT_DAPPID_POSSESSOR});if(l.status===17)throw new W(a.DAPPID_ALREADY_FROZEN,{dappid:c});return n()},{taskname:"applyTransaction/logicVerifier/frozenDAppid"})}__listenEventUnfrozenDAppid(e,t){t.on("unfrozenDAppid",async({transaction:r,applyInfo:n},s)=>{const{address:i,sourceChainName:o,sourceChainMagic:c,dappid:l,frozenId:u}=n,g=await this.helperLogicVerifier.isDAppExist(o,c,l,e);if(g.status!==17)throw new W(a.DAPPID_NOT_FROZEN,{dappid:l});if(g.frozenId!==u)throw new W(a.SHOULD_BE,{to_compare_prop:`frozenId ${u}`,to_target:"transaction",be_compare_prop:`dapp frozenId ${g.frozenId}`});if(r.recipientId!==g.possessorAddress)throw new W(a.SHOULD_BE,{to_compare_prop:`recipientId ${r.recipientId}`,to_target:"transaction",be_compare_prop:`dapp possessor ${g.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/unfrozenDAppid"})}__listenEventChangeDAppidPossessor(e,t){t.on("changeDAppidPossessor",async({transaction:r,applyInfo:n},s)=>{const{address:i,possessorAddress:o,sourceChainName:c,sourceChainMagic:l,dappid:u}=n;i!==o&&await this.helperLogicVerifier.isAccountFrozen(o,e);const g=await this.helperLogicVerifier.isDAppExist(c,l,u,e);if(g.status===17)throw new W(a.DAPPID_ALREADY_FROZEN,{dappid:u});if(r.senderId!==g.possessorAddress)throw new W(a.SHOULD_BE,{to_compare_prop:`senderId ${r.senderId}`,to_target:"transaction",be_compare_prop:`dapp possessor ${g.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/changeDAppidPossessor"})}__listenEventRegisterChain(e,t,r){r.on("registerChain",async({transaction:n,applyInfo:s},i)=>{const{address:o,genesisBlock:c}=s,{assets:l}=await this.helperLogicVerifier.getAccountForce(e,o,t);await this.helperLogicVerifier.isPossessAssetExceptChainAsset(o,l),await this.helperLogicVerifier.isChainAssetPossessor(o);const{magic:u,assetType:g,registerChainMinChainAsset:y}=this.configHelper,m=l[u][g].assetNumber;if(BigInt(y)>m)throw new W(a.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${y}, remain Assets: ${m}`,errorId:Ce.CHAIN_ASSET_NOT_ENOUGH});const{magic:d,assetType:I,chainName:T}=c;if(await this.accountGetterHelper.getMagic(d))throw new W(a.ALREADY_EXIST,{prop:`Magic ${d}`,target:"blockChain",errorId:Ce.MAGIC_ALREADY_EXIST});if(await this.accountGetterHelper.getCurrency(T))throw new W(a.ALREADY_EXIST,{prop:`ChainName ${T}`,target:"blockChain",errorId:Ce.CHAINNAME_ALREADY_EXIST});if(await this.accountGetterHelper.getCurrency(I))throw new W(a.ALREADY_EXIST,{prop:`AssetType ${I}`,target:"blockChain",errorId:Ce.ASSETTYPE_ALREADY_EXIST});if(await this.accountGetterHelper.getChain(d))throw new W(a.ALREADY_EXIST,{prop:`Chain with magic ${d}`,target:"blockChain"});return i()},{taskname:"applyTransaction/logicVerifier/registerChain"})}__listenEventRegisterLocationName(e,t){t.on("registerLocationName",async({applyInfo:r},n)=>{const{address:s,sourceChainMagic:i,name:o,possessorAddress:c}=r;if(s!==c&&await this.helperLogicVerifier.isAccountFrozen(c,e),await this.accountGetterHelper.getLocationName(i,o,e))throw new W(a.LOCATION_NAME_IS_ALREADY_EXIST,{prop:o,target:"blockChain",errorId:Ce.LOCATION_NAME_ALREADY_EXIST});if(await this.accountGetterHelper.isLocationNameForbidden(o))throw new W(a.FORBIDDEN,{prop:`Location name ${o}`,target:"blockChain"});if(o.split(".").length>2){const l=o.indexOf(".")+1,u=o.substr(l);if(!await this.accountGetterHelper.getLocationName(i,u,e))throw new W(a.LOCATION_NAME_IS_NOT_EXIST,{locationName:u})}return n()},{taskname:"applyTransaction/logicVerifier/registerLocationName"})}__listenEventCancelLocationName(e,t){t.on("cancelLocationName",async({transaction:r,applyInfo:n},s)=>{const{sourceChainName:i,sourceChainMagic:o,name:c}=n,l=await this.helperLogicVerifier.isLocationNameExist(i,o,c,e);if(l.status===17)throw new W(a.CAN_NOT_DELETE_LOCATION_NAME,{locationName:c,reason:"Frozen location name can not be delete"});if(l.status===255)throw new W(a.CAN_NOT_DELETE_LOCATION_NAME,{locationName:c,reason:"Location name has been deleted"});if(r.senderId!==r.recipientId)throw new W(a.SHOULD_BE,{to_compare_prop:"recipientId",to_target:"transaction",be_compare_prop:r.senderId});if(l.possessorAddress!==r.senderId)throw new W(a.CAN_NOT_DELETE_LOCATION_NAME,{locationName:c,reason:"Only location name possessor can delete location name"});if(await this.accountGetterHelper.isSubLocationNameExist(o,c))throw new W(a.CAN_NOT_DELETE_LOCATION_NAME,{locationName:c,reason:"Location name have child location name, please delete it at first"});return s()},{taskname:"applyTransaction/logicVerifier/cancelLocationName"})}__listenEventSetLnsManager(e,t){t.on("setLnsManager",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,name:c,manager:l}=r;await this.helperLogicVerifier.isAccountFrozen(l,e);const u=await this.helperLogicVerifier.isLocationNameExist(i,o,c,e);if(u.status===17)throw new W(a.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:c,reason:"Frozen location name can not set manager"});if(l===u.manager)throw new W(a.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:c,reason:"Can not set the same account as manager",errorId:Ce.CAN_NOT_SET_SAME_ACCOUNT_AS_MANAGER});if(u.type==="MULTI_LEVEL"){const g=c.split(".")[0].length+1,y=c.substr(g),m=await this.accountGetterHelper.getLocationName(o,y,e);if(!m)throw new W(a.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:y,reason:"Last location name is not exists"});if(!(s===u.possessorAddress||s===m.manager))throw new W(a.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:y,reason:"Only the location name possessor or upper level location name manager can set manager of multi level location name"})}else if(s!==u.possessorAddress)throw new W(a.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:c,reason:"Only the location name possessor can set manager of top level location name"});return n()},{taskname:"applyTransaction/logicVerifier/setLnsManager"})}__listenEventSetLnsRecordValue(e,t){t.on("setLnsRecordValue",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,name:c,operationType:l,addRecord:u,deleteRecord:g}=r,y=await this.helperLogicVerifier.isLocationNameExist(i,o,c,e),{records:m,status:d}=y;if(d===17)throw new W(a.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:c,reason:"Frozen location name can not set record value"});if(!(s===y.possessorAddress||s===y.manager))throw new W(a.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:c,reason:"Only the location name possessor or manager can set record value"});if(l===0){if(!u)throw new W(a.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:c,reason:"New location name record value lose"});this.addRecord(c,u,m)}else if(l===1){if(!g)throw new W(a.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:c,reason:"Delete location name record value lose"});this.deleteRecord(c,g,m)}else if(l===2){if(!(u&&g))throw new W(a.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:c,reason:"New location name record value and delete location name record value lose"});this.deleteRecord(c,g,m),this.addRecord(c,u,m)}return n()},{taskname:"applyTransaction/logicVerifier/setLnsRecordValue"})}__listenEventFrozenLocationName(e,t){t.on("frozenLocationName",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,name:c}=r,l=await this.helperLogicVerifier.isLocationNameExist(i,o,c,e);if(l.status===17)throw new W(a.LOCATION_NAME_ALREADY_FROZEN,{locationName:c});if(l.type!=="TOP_LEVEL")throw new W(a.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(l.possessorAddress!==s)throw new W(a.ACCOUNT_NOT_LOCATION_NAME_POSSESSOR,{address:s,locationName:c,errorId:Ce.ACCOUNT_NOT_LNS_POSSESSOR});return n()},{taskname:"applyTransaction/logicVerifier/frozenLocationName"})}__listenEventUnfrozenLocationName(e,t){t.on("unfrozenLocationName",async({transaction:r,applyInfo:n},s)=>{const{address:i,sourceChainName:o,sourceChainMagic:c,name:l,frozenId:u}=n,g=await this.helperLogicVerifier.isLocationNameExist(o,c,l,e);if(g.status!==17)throw new W(a.LOCATION_NAME_NOT_FROZEN,{locationName:l});if(g.frozenId!==u)throw new W(a.SHOULD_BE,{to_compare_prop:`frozenId ${u}`,to_target:"transaction",be_compare_prop:`location name frozenId ${g.frozenId}`});if(g.type!=="TOP_LEVEL")throw new W(a.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(r.recipientId!==g.possessorAddress)throw new W(a.SHOULD_BE,{to_compare_prop:`recipientId ${r.recipientId}`,to_target:"transaction",be_compare_prop:`locationName possessor ${g.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/unfrozenLocationName"})}__listenEventChangeLocationNamePossessor(e,t){t.on("changeLocationNamePossessor",async({transaction:r,applyInfo:n},s)=>{const{address:i,possessorAddress:o,sourceChainName:c,sourceChainMagic:l,name:u}=n;i!==o&&await this.helperLogicVerifier.isAccountFrozen(o,e);const g=await this.helperLogicVerifier.isLocationNameExist(c,l,u,e);if(g.type!=="TOP_LEVEL")throw new W(a.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(g.status===17)throw new W(a.LOCATION_NAME_ALREADY_FROZEN,{locationName:u});if(r.senderId!==g.possessorAddress)throw new W(a.SHOULD_BE,{to_compare_prop:`senderId ${r.senderId}`,to_target:"transaction",be_compare_prop:`locationName possessor ${g.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/changeLocationNamePossessor"})}async __checkEntityFactory(e,t,r,n){if(await this.helperLogicVerifier.isAccountFrozen(t,e),await this.accountGetterHelper.getEntityFactory(r,n,e))throw new W(a.ENTITY_FACTORY_IS_ALREADY_EXIST,{factoryId:n,errorId:Ce.ENTITY_FACTORY_ALREADY_EXIST})}__listenEventIssueEntityFactoryByFrozen(e,t,r){r.on("issueEntityFactoryByFrozen",async({transaction:n,applyInfo:s},i)=>{const{address:o,factoryId:c,sourceChainMagic:l,possessorAddress:u,entityPrealnum:g}=s;await this.__checkEntityFactory(t,u,l,c);const{assets:y}=await this.helperLogicVerifier.getAccountForce(e,o,t);await this.helperLogicVerifier.isPossessAssetExceptChainAsset(o,y),await this.helperLogicVerifier.isChainAssetPossessor(o);const{magic:m,assetType:d,issueEntityFactoryMinChainAsset:I}=this.configHelper,T=y[m][d].assetNumber;if(BigInt(I)>T)throw new W(a.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${I}, remain Assets: ${T}`,errorId:Ce.CHAIN_ASSET_NOT_ENOUGH});const S=this.jsbiHelper.multiplyFractionAndFloor({numerator:T,denominator:Bm},this.configHelper.maxMultipleOfEntityAndMainAsset);if(BigInt(g)>S)throw new W(a.PROP_SHOULD_LTE_FIELD,{prop:`entityPrealnum ${g}`,target:"issueEntityFactory",field:`calc max entities ${S}`});return i()},{taskname:"applyTransaction/logicVerifier/issueEntityFactoryByFrozen"})}__listenEventIssueEntityFactoryByDestroy(e,t){t.on("issueEntityFactoryByDestroy",async({transaction:r,applyInfo:n},s)=>{const{factoryId:i,sourceChainMagic:o,possessorAddress:c}=n;return await this.__checkEntityFactory(e,c,o,i),s()},{taskname:"applyTransaction/logicVerifier/issueEntityFactoryByDestroy"})}__isEntityFactoryMatch(e,t,r){if(e.sourceChainMagic!==t.sourceChainMagic||e.sourceChainName!==t.sourceChainName||e.factoryId!==t.factoryId||e.entityPrealnum!==t.entityPrealnum.toString()||e.entityFrozenAssetPrealnum!==t.entityFrozenAssetPrealnum||e.purchaseAssetPrealnum!==t.purchaseAssetPrealnum)throw new W(a.NOT_MATCH,{to_compare_prop:`entityFactory ${JSON.stringify(e)}`,be_compare_prop:`entityFactory ${JSON.stringify({sourceChainName:t.sourceChainName,sourceChainMagic:t.sourceChainMagic,factoryId:t.factoryId,entityPrealnum:t.entityPrealnum.toString(),entityFrozenAssetPrealnum:t.entityFrozenAssetPrealnum,purchaseAssetPrealnum:t.purchaseAssetPrealnum})}`,to_target:r,be_target:"blockChain"})}__listenEventIssueEntity(e,t,r){r.on("issueEntity",async({transaction:n,applyInfo:s},i)=>{const{address:o,possessorAddress:c,entityFactoryPossessorAddress:l,factoryId:u,entityId:g,sourceChainName:y,sourceChainMagic:m,entityFrozenAssetPrealnum:d}=s;o!==c&&await this.helperLogicVerifier.isAccountFrozen(c,t);const I=await this.helperLogicVerifier.isEntityFactoryExist(y,m,u,t);if(this.__isEntityFactoryMatch(n.asset.issueEntity.entityFactory.toJSON(),I,"IssueEntityTransaction"),l!==I.possessorAddress)throw new W(a.NOT_MATCH,{to_compare_prop:`entityFactoryPossessor ${l}`,be_compare_prop:`possessorAddress ${I.possessorAddress}`,to_target:"issueEntity",be_target:"memEntityFactory"});if(I.remainEntityPrealnum===BigInt(0))throw new W(a.ISSUE_ENTITY_TIMES_USE_UP,{entityFactory:u});if(await this.accountGetterHelper.getEntity(m,g,t))throw new W(a.ENTITY_IS_ALREADY_EXIST,{entityId:g,errorId:Ce.ENTITY_ALREADY_EXIST});const{assets:T}=await this.helperLogicVerifier.getAccountForce(e,o,t),{magic:S,assetType:w}=this.configHelper;let b=T[S][w].assetNumber;const R=I.purchaseAssetPrealnum;if(R!=="0"&&(b-=BigInt(R),b<BigInt(0)))throw new W(a.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${R}, remain Assets: ${b}`,errorId:Ce.CHAIN_ASSET_NOT_ENOUGH});if(d!=="0"&&BigInt(d)>b)throw new W(a.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${d}, remain Assets: ${b}`,errorId:Ce.CHAIN_ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/issueEntityV1"})}__listenEventIssueEntityMulti(e,t,r){r.on("issueEntityMulti",async({transaction:n,applyInfo:s},i)=>{const{address:o,possessorAddress:c,entityFactoryPossessorAddress:l,factoryId:u,entityStructList:g,sourceChainName:y,sourceChainMagic:m,entityFrozenAssetPrealnum:d}=s;o!==c&&await this.helperLogicVerifier.isAccountFrozen(c,t);const I=await this.helperLogicVerifier.isEntityFactoryExist(y,m,u,t);if(this.__isEntityFactoryMatch(n.asset.issueEntityMulti.entityFactory.toJSON(),I,"IssueEntityMultiTransactionV1"),l!==I.possessorAddress)throw new W(a.NOT_MATCH,{to_compare_prop:`entityFactoryPossessor ${l}`,be_compare_prop:`possessorAddress ${I.possessorAddress}`,to_target:"issueEntity",be_target:"memEntityFactory"});const{remainEntityPrealnum:T}=I;if(T===BigInt(0))throw new W(a.ISSUE_ENTITY_TIMES_USE_UP,{entityFactory:u});if(T<BigInt(g.length))throw new W(a.NOT_ENOUGH_ISSUE_ENTITY_TIMES,{entityFactory:u});if(I.entityPrealnum!==T){for(const{entityId:$}of g)if(await this.accountGetterHelper.getEntity(m,$,t))throw new W(a.ENTITY_IS_ALREADY_EXIST,{entityId:$,errorId:Ce.ENTITY_ALREADY_EXIST})}const{assets:S}=await this.helperLogicVerifier.getAccountForce(e,o,t),{magic:w,assetType:b}=this.configHelper;let R=S[w][b].assetNumber;const v=I.purchaseAssetPrealnum;if(v!=="0"&&(R-=BigInt(v),R<BigInt(0)))throw new W(a.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${v}, remain Assets: ${R}`,errorId:Ce.CHAIN_ASSET_NOT_ENOUGH});if(d!=="0"&&BigInt(d)>R)throw new W(a.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${d}, remain Assets: ${R}`,errorId:Ce.CHAIN_ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/issueEntityV1"})}__listenEventDestroyEntity(e,t){t.on("destroyEntity",async({transaction:r,applyInfo:n},s)=>{const{sourceChainName:i,sourceChainMagic:o,entityId:c,entityFactoryApplicantAddress:l,entityFactoryPossessorAddress:u,entityFactory:g}=n,y=g.factoryId,m=await this.helperLogicVerifier.isEntityFactoryExist(i,o,y,e);if(this.__isEntityFactoryMatch(r.asset.destroyEntity.entityFactory.toJSON(),m,"DestroyEntityTransaction"),l!==m.applyAddress)throw new W(a.NOT_MATCH,{to_compare_prop:`entityFactoryApplicant ${l}`,be_compare_prop:`applyAddress ${m.applyAddress}`,to_target:"destroyEntity",be_target:"memEntityFactory"});if(u!==m.possessorAddress)throw new W(a.NOT_MATCH,{to_compare_prop:`entityFactoryPossessor ${u}`,be_compare_prop:`possessorAddress ${m.possessorAddress}`,to_target:"destroyEntity",be_target:"memEntityFactory"});const d=await this.helperLogicVerifier.isEntityExist(i,o,c,e);if(d.status===17)throw new W(a.CAN_NOT_DESTROY_ENTITY,{entityId:c,reason:"Frozen entity can not be destroy"});if(d.status===255)throw new W(a.ENTITY_ALREADY_DESTROY,{entityId:c,reason:"Entity already be destroy"});if(d.possessorAddress!==r.senderId)throw new W(a.CAN_NOT_DESTROY_ENTITY,{entityId:c,reason:`Only entity possessor can deestory entity ${c}`});return s()},{taskname:"applyTransaction/logicVerifier/destroyEntity"})}__listenEventFrozenEntity(e,t){t.on("frozenEntity",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,entityId:c}=r,l=await this.helperLogicVerifier.isEntityExist(i,o,c,e);if(l.possessorAddress!==s)throw new W(a.ACCOUNT_NOT_ENTITY_POSSESSOR,{address:s,entityId:c,errorId:Ce.ACCOUNT_NOT_ENTITY_POSSESSOR});if(l.status===17)throw new W(a.ENTITY_ALREADY_FROZEN,{entityId:c});if(l.status===255)throw new W(a.ENTITY_ALREADY_DESTROY,{entityId:c});return n()},{taskname:"applyTransaction/logicVerifier/frozenEntity"})}__listenEventUnfrozenEntity(e,t){t.on("unfrozenEntity",async({transaction:r,applyInfo:n},s)=>{const{address:i,sourceChainName:o,sourceChainMagic:c,entityId:l,frozenId:u}=n,g=await this.helperLogicVerifier.isEntityExist(o,c,l,e);if(g.status===0)throw new W(a.ENTITY_NOT_FROZEN,{entityId:l});if(g.frozenId!==u)throw new W(a.SHOULD_BE,{to_compare_prop:`frozenId ${u}`,to_target:"transaction",be_compare_prop:`entity frozenId ${g.frozenId}`});if(g.status===255)throw new W(a.ENTITY_ALREADY_DESTROY,{entityId:l});if(r.recipientId!==g.possessorAddress)throw new W(a.SHOULD_BE,{to_compare_prop:`recipientId ${r.recipientId}`,to_target:"transaction",be_compare_prop:`entity possessor ${g.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/unfrozenEntity"})}__listenEventChangeEntityPossessor(e,t){t.on("changeEntityPossessor",async({transaction:r,applyInfo:n},s)=>{const{address:i,possessorAddress:o,sourceChainName:c,sourceChainMagic:l,entityId:u}=n;i!==o&&await this.helperLogicVerifier.isAccountFrozen(o,e);const g=await this.helperLogicVerifier.isEntityExist(c,l,u,e);if(g.status===17)throw new W(a.ENTITY_ALREADY_FROZEN,{entityId:u});if(g.status===255)throw new W(a.ENTITY_ALREADY_DESTROY,{entityId:u});if(r.senderId!==g.possessorAddress)throw new W(a.SHOULD_BE,{to_compare_prop:`senderId ${r.senderId}`,to_target:"transaction",be_compare_prop:`entity possessor ${g.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/changeEntityPossessor"})}__listenEventMigrateCertificate(e){e.on("migrateCertificate",async({applyInfo:t},r)=>{const{migrateCertificateId:n}=t;if(await this.accountGetterHelper.getMigrateCertificate(n))throw new W(a.ASSET_IS_ALREADY_MIGRATION,{migrateCertificateId:n});return r()},{taskname:"applyTransaction/logicVerifier/migrateCertificate"})}__listenEventPayTax(e,t){t.on("payTax",async({applyInfo:r},n)=>{const{sourceChainName:s,sourceChainMagic:i,parentAssetType:o,assetType:c,taxInformation:l}=r;if(o===G.ENTITY){const u=await this.helperLogicVerifier.isEntityExist(s,i,c,e);if(u.taxAssetRecipientId!==l.taxCollector)throw new W(a.NOT_MATCH,{to_compare_prop:`taxAssetRecipientId ${u.taxAssetRecipientId}`,be_compare_prop:`taxCollector ${l.taxCollector}`,to_target:"taxInformation",be_target:"memEntity"});if(u.taxAssetPrealnum!==l.taxAssetPrealnum)throw new W(a.NOT_MATCH,{to_compare_prop:`taxAssetPrealnum ${u.taxAssetPrealnum}`,be_compare_prop:`taxAssetPrealnum ${l.taxAssetPrealnum}`,to_target:"taxInformation",be_target:"memEntity"})}return n()},{taskname:"applyTransaction/logicVerifier/payTax"})}__listenEventIssueCertificate(e,t){t.on("issueCertificate",async({transaction:r,applyInfo:n},s)=>{const{address:i,possessorAddress:o,sourceChainMagic:c,sourceChainName:l,certificateId:u}=n;if(i!==o&&await this.helperLogicVerifier.isAccountFrozen(o,e),await this.accountGetterHelper.getCertificate(c,u,e))throw new W(a.CERTIFICATE_IS_ALREADY_EXIST,{certificateId:u,errorId:Ce.CERTIFICATE_ALREADY_EXIST});return s()},{taskname:"applyTransaction/logicVerifier/issueCertificate"})}__listenEventDestroyCertificate(e,t){t.on("destroyCertificate",async({transaction:r,applyInfo:n},s)=>{const{sourceChainMagic:i,sourceChainName:o,certificateId:c}=n,l=await this.helperLogicVerifier.isCertificateExist(o,i,c,e);if(l.status===255)throw new W(a.CERTIFICATE_ALREADY_DESTROY,{certificateId:c});if(l.status===17)throw new W(a.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:c,reason:"Frozen certificate can not be destroy"});if(l.type===0)throw new W(a.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:c,reason:"Certificate with type 0 can not be destroy"});if(l.type===1&&l.applyAddress!==r.senderId)throw new W(a.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:c,reason:`Only certificate applicant can deestory certificate ${c}`});if(l.possessorAddress!==r.senderId)throw new W(a.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:c,reason:`Only certificate possessor can deestory certificate ${c}`});return s()},{taskname:"applyTransaction/logicVerifier/destroyCertificate"})}__listenEventFrozenCertificate(e,t){t.on("frozenCertificate",async({applyInfo:r},n)=>{const{address:s,sourceChainName:i,sourceChainMagic:o,certificateId:c}=r,l=await this.helperLogicVerifier.isCertificateExist(i,o,c,e);if(l.status===255)throw new W(a.CERTIFICATE_ALREADY_DESTROY,{certificateId:c});if(l.status===17)throw new W(a.CERTIFICATE_ALREADY_FROZEN,{certificateId:c});if(l.possessorAddress!==s)throw new W(a.ACCOUNT_NOT_CERTIFICATE_POSSESSOR,{address:s,certificateId:c,errorId:Ce.ACCOUNT_NOT_CERTIFICATE_POSSESSOR});return n()},{taskname:"applyTransaction/logicVerifier/frozenCertificate"})}__listenEventUnfrozenCertificate(e,t){t.on("unfrozenCertificate",async({transaction:r,applyInfo:n},s)=>{const{address:i,sourceChainName:o,sourceChainMagic:c,certificateId:l,frozenId:u}=n,g=await this.helperLogicVerifier.isCertificateExist(o,c,l,e);if(g.status===255)throw new W(a.CERTIFICATE_ALREADY_DESTROY,{certificateId:l});if(g.status!==17)throw new W(a.CERTIFICATE_NOT_FROZEN,{certificateId:l});if(g.frozenId!==u)throw new W(a.SHOULD_BE,{to_compare_prop:`frozenId ${u}`,to_target:"transaction",be_compare_prop:`certificate frozenId ${g.frozenId}`});if(r.recipientId!==g.possessorAddress)throw new W(a.SHOULD_BE,{to_compare_prop:`recipientId ${r.recipientId}`,to_target:"transaction",be_compare_prop:`Certificate possessor ${g.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/unfrozenCertificate"})}__listenEventChangeCertificatePossessor(e,t){t.on("changeCertificatePossessor",async({transaction:r,applyInfo:n},s)=>{const{address:i,possessorAddress:o,sourceChainName:c,sourceChainMagic:l,certificateId:u}=n;i!==o&&await this.helperLogicVerifier.isAccountFrozen(o,e);const g=await this.helperLogicVerifier.isCertificateExist(c,l,u,e);if(g.status===255)throw new W(a.CERTIFICATE_ALREADY_DESTROY,{certificateId:u});if(g.status===17)throw new W(a.CERTIFICATE_ALREADY_FROZEN,{certificateId:u});if(r.senderId!==g.possessorAddress)throw new W(a.SHOULD_BE,{to_compare_prop:`senderId ${r.senderId}`,to_target:"transaction",be_compare_prop:`Certificate possessor ${g.possessorAddress}`});return s()},{taskname:"applyTransaction/logicVerifier/changeCertificatePossessor"})}__listenEventStakeAsset(e,t,r){r.on("stakeAsset",async({transaction:n,applyInfo:s},i)=>{const{address:o,stakeId:c,beginUnstakeHeight:l,assetInfo:u}=s,{magic:g,chainName:y,assetType:m}=u,d=await this.accountGetterHelper.getStakeAsset(o,c);if(d){if(l<d.beginUnstakeHeight)throw new W(a.PROP_SHOULD_GTE_FIELD,{prop:`beginUnstakeHeight ${l}`,target:"stakeAsset",field:d.beginUnstakeHeight});if(g!==d.sourceChainMagic||m!==d.assetType)throw new W(a.NOT_MATCH,{to_compare_prop:`stakeAsset: ${JSON.stringify({sourceChainMagic:g,sourceChainName:y,assetType:m})}`,be_compare_prop:`stakeAsset: ${JSON.stringify({sourceChainMagic:d.sourceChainMagic,sourceChainName:d.sourceChainName,assetType:d.assetType})}`,to_target:"StakeAssetTransaction.asset.stakeAsset",be_target:"blockChain"})}const{assets:I}=await this.helperLogicVerifier.getAccountForce(e,o,t);I[g]=I[g]||{},I[g][m]=I[g][m]||{sourceChainMagic:g,assetType:m,assetNumber:BigInt(0),history:{}};const T=I[g][m],S=T.assetNumber;if(T.assetNumber+=BigInt(s.amount),T.assetNumber<BigInt(0))throw new W(a.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${n.signature} address: ${o} magic ${s.assetInfo.magic} assetType: ${s.assetInfo.assetType} hodingAsset: ${S.toString()} stakeAsset: ${s.amount}`,errorId:Ce.ASSET_NOT_ENOUGH});return i()},{taskname:"applyTransaction/logicVerifier/stakeAsset"})}__listenEventUnstakeAsset(e,t){t.on("unstakeAsset",async({transaction:r,applyInfo:n},s)=>{const{address:i,assetInfo:o,stakeId:c,amount:l}=n,{magic:u,assetType:g}=o,y=await this.helperLogicVerifier.getStakeAssetForce(i,c),{beginUnstakeHeight:m,amount:d}=y;if(m>e)throw new W(a.NOT_BEGIN_UNSTAKE_YET,{stakeId:c});if(BigInt(l)>BigInt(d))throw new W(a.STAKE_ASSET_NOT_ENOUGH,{reason:`No enough asset to unstake magic ${u} assetType ${g} remain ${d} spend ${l}`,stakeId:c});return s()},{taskname:"applyTransaction/logicVerifier/unstakeAsset"})}listenEvent(e,t,r){this.__listenEventFee(e,t,r),this.__listenEventDestroyMainAsset(e,t,r),this.__listenEventAsset(e,t,r),this.__listenEventFrozenAsset(e,t,r),this.__listenEventUnfrozenAsset(t,r),this.__listenEventSignForAsset(t,r),this.__listenEventFrozenAccount(e,t,r),this.__listenEventSetSecondPublicKey(r),this.__listenEventIssueAsset(e,t,r),this.__listenEventIncreaseAsset(e,t,r),this.__listenEventDestroyAsset(r),this.__listenEventIssueDAppid(t,r),this.__listenEventFrozenDAppid(t,r),this.__listenEventUnfrozenDAppid(t,r),this.__listenEventChangeDAppidPossessor(t,r),this.__listenEventRegisterChain(e,t,r),this.__listenEventRegisterLocationName(t,r),this.__listenEventCancelLocationName(t,r),this.__listenEventSetLnsManager(t,r),this.__listenEventSetLnsRecordValue(t,r),this.__listenEventFrozenLocationName(t,r),this.__listenEventUnfrozenLocationName(t,r),this.__listenEventChangeLocationNamePossessor(t,r),this.__listenEventIssueEntityFactoryByFrozen(e,t,r),this.__listenEventIssueEntityFactoryByDestroy(t,r),this.__listenEventIssueEntity(e,t,r),this.__listenEventIssueEntityMulti(e,t,r),this.__listenEventDestroyEntity(t,r),this.__listenEventFrozenEntity(t,r),this.__listenEventUnfrozenEntity(t,r),this.__listenEventChangeEntityPossessor(t,r),this.__listenEventMigrateCertificate(r),this.__listenEventPayTax(t,r),this.__listenEventIssueCertificate(t,r),this.__listenEventDestroyCertificate(t,r),this.__listenEventFrozenCertificate(t,r),this.__listenEventUnfrozenCertificate(t,r),this.__listenEventChangeCertificatePossessor(t,r),this.__listenEventStakeAsset(e,t,r),this.__listenEventUnstakeAsset(t,r)}async awaitEventResult(e,t){await this.transactionCore.getTransactionFactoryFromType(e.type).applyTransaction(e,t)}};p([k(St),h("design:type",St)],$n.prototype,"jsbiHelper",void 0),p([k(re),h("design:type",re)],$n.prototype,"configHelper",void 0),p([k(ht),h("design:type",ht)],$n.prototype,"blockHelper",void 0),p([k(_e),h("design:type",_e)],$n.prototype,"transactionHelper",void 0),p([k(bi),h("design:type",bi)],$n.prototype,"helperLogicVerifier",void 0),p([k("bfchain-core:TransactionCore"),h("design:type",Object)],$n.prototype,"transactionCore",void 0),p([k("accountGetterHelper",{dynamics:!0}),h("design:type",Object)],$n.prototype,"accountGetterHelper",void 0),$n=p([j()],$n);var Vo=class{constructor(){this.__cacheMap=new Map}getCache(e){return this.__cacheMap.get(e)}setCache(e,t){this.__cacheMap.set(e,t)}clearCache(){this.__cacheMap.clear()}};Vo=p([j()],Vo);var{ConsensusException:lt,NoFoundException:iw}=Z("VERIFIER","TransactionLogicVerifier"),Be=class{async logicVerify(e,t,r){if(e.version>this.configHelper.version)throw new lt(a.PROP_SHOULD_LTE_FIELD,{prop:`version ${e.version}`,target:`transaction ${e.signature}`,field:`blockChain version ${this.configHelper.version}`});const{senderId:n,recipientId:s}=e,i=await this.helperLogicVerifier.getAccountForce(r,n,t);if(this.checkSenderAccountStatus(i),this.checkSecondPublicKey(i,e),this.checkApplyBlockHeight(e,t),this.checkEffectiveBlockHeight(e,t),await this.checkTransactionMagic(e),t>1&&this.checkTransactionTimestamp(e),await this.checkTransactionRange(e,t),s){const o=await this.helperLogicVerifier.getAccountForce(r,s,t);this.checkRecipientAccountStatus(o)}return this.checkTrsMaxBytes(e.getBytes().length),await this.checkDAppId(e,t),await this.checkLocationName(e,t),!0}checkSenderAccountStatus(e){if(!(e&&e.hasOwnProperty("accountStatus")))throw new lt(a.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(e.accountStatus===16||e.accountStatus===17)throw new lt(a.ACCOUNT_FROZEN,{address:e.address,errorId:Ce.TRANSACTION_SENDER_ASSET_FROZEN})}checkRecipientAccountStatus(e){if(!e.hasOwnProperty("accountStatus"))throw new lt(a.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(e.accountStatus===1||e.accountStatus===17)throw new lt(a.ACCOUNT_FROZEN,{address:e.address,errorId:Ce.TRANSACTION_RECIPIENT_ASSET_FROZEN})}checkSecondPublicKey(e,t){const{type:r,senderId:n,senderSecondPublicKey:s,applyBlockHeight:i,signature:o,signSignature:c}=t,l=e.secondPublicKey;if(l){if(!(s&&c))throw new lt(a.TRANSACTION_SIGN_SIGNATURE_IS_REQUIRED,{signature:o,senderId:n,applyBlockHeight:i,type:r});if(l!==s)throw new lt(a.TRANSACTION_SENDER_SECOND_PUBLICKEY_ALREADY_CHANGE,{signature:o,senderId:n,applyBlockHeight:i,type:r})}else{if(s)throw new lt(a.TRANSACTION_SHOULD_NOT_HAVE_SENDER_SECOND_PUBLICKEY,{signature:o,senderId:n,applyBlockHeight:i,type:r});if(c)throw new lt(a.TRANSACTION_SHOULD_NOT_HAVE_SIGN_SIGNATURE,{signature:o,senderId:n,applyBlockHeight:i,type:r})}}checkApplyBlockHeight(e,t){const r=e.applyBlockHeight;if(r>t)throw new lt(a.INVALID_TRANSACTION_APPLY_BLOCK_HEIGHT,{signature:e.signature,reason:`applyBlockHeight ${r} must less than currntBlockHeight ${t}`},void 0,"minor")}checkEffectiveBlockHeight(e,t){const r=e.effectiveBlockHeight;if(r<t)throw new lt(a.INVALID_TRANSACTION_EFFECTIVE_BLOCK_HEIGHT,{signature:e.signature,reason:`effectiveBlockHeight ${r} must greate than or equal to currntBlockHeight ${t}`})}async checkTransactionMagic(e){const t=e.fromMagic,r=e.toMagic,n=this.configHelper.magic;if(t===n){if(r===n)return;if(!await this.accountGetterHelper.getChain(r))throw new lt(a.INVALID_TRANSACTION_TO_MAGIC,{reason:"Transaction toMagic chain not exists",signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type})}else{if(!await this.accountGetterHelper.getChain(t))throw new lt(a.INVALID_TRANSACTION_FROM_MAGIC,{reason:"Transaction fromMagic chain not exists",signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type});if(r!==n)throw new lt(a.INVALID_TRANSACTION_TO_MAGIC,{reason:"Transaction to magic must be local",signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type})}}checkTransactionTimestamp(e){const{timeHelper:t}=this,r=t.getTimestamp(),n=t.getSlotNumberByTimestamp(e.timestamp),s=t.getSlotNumberByTimestamp(r);if(n>s)throw new lt(a.INVALID_TRANSACTION_TIMESTAMP,{reason:`Transaction timestamp in future. Transaction time is ahead of the time on the server, transaction timestamp ${e.timestamp}, transaction timestamp slot ${n}, blockChain now timestamp ${r}, blockChain now timestamp slot ${s}`,signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type})}async checkTransactionRange(e,t){const{accountGetterHelper:r}=this,{rangeType:n,range:s}=e,{magic:i}=this.configHelper;switch(n){case 0:break;case 1:break;case 2:for(const o of s)if(!await r.getDApp(i,o,t))throw new lt(a.DAPPID_IS_NOT_EXIST,{dappid:o});break;case 4:for(const o of s)if(!await r.getLocationName(i,o,t))throw new lt(a.LOCATION_NAME_IS_NOT_EXIST,{locationName:o});break;default:throw new lt(a.UNKNOWN_RANGE_TYPE,{rangeType:n})}}checkTrsMaxBytes(e){if(BigInt(e)>BigInt(this.configHelper.maxTransactionSize))throw new lt(a.INVALID_TRANSACTION_BYTE_LENGTH,{reason:`The size of the transaction ${e} exceeds the limit`})}async checkDAppId(e,t){const{dappid:r,senderId:n}=e;if(!r)return;const{accountGetterHelper:s,transactionGetterHelper:i}=this,o=await s.getDApp(e.fromMagic,r,t);if(!o)throw new lt(a.DAPPID_IS_NOT_EXIST,{dappid:r});const c=o.possessorAddress;if(!await s.getAccountInfo(c,t))throw new lt(a.NOT_FOUND,{porp:`Dapp possessor ${c}`});if(o.type===0&&!await i.getPurchaseDApp(n,r))throw new lt(a.NEED_PURCHASE_DAPPID_BEFORE_USE,{dappid:`${r} user ${n} possessor ${c}`})}async checkLocationName(e,t){const r=e.lns;if(r&&!await this.accountGetterHelper.getLocationName(this.configHelper.magic,r,t))throw new lt(a.LOCATION_NAME_IS_NOT_EXIST,{locationName:r,errorId:Ce.LOCATION_NAME_NOT_EXIST})}isFeeEnough(e,t,r){return BigInt(t)<BigInt(r)?{signature:e,isFeeEnough:!1,minFee:r}:{signature:e,isFeeEnough:!0,minFee:r}}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByBytes(e,t)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByBytes(e,t,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}checkTransactionBlobSize(e,t){const{maxBlockBlobSize:r}=this.configHelper,n=t===void 0||r<t?r:t,s=e.getBlobSize(!0);if(s>n)throw new lt(a.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${s}`,target:"transaction",field:n})}async checkRepeatInUntreatedTransaction(e){const{senderId:t,signature:r}=e;if(await this.transactionGetterHelper.countTransactionInUntreatedBySignature(t,r)>0)throw new lt(a.ALREADY_EXIST,{prop:`Transaction with signature ${r}`,target:"untreated transaction"})}async checkRepeatInBlockChainTransaction(e,t,r=0){const{signature:n,applyBlockHeight:s}=e;if(await this.transactionGetterHelper.countTransactionInBlockChainBySignature(n,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(s,t))>r)throw new lt(a.ALREADY_EXIST,{prop:`Transaction with signature ${n}`,target:"blockChain"})}getLockData(e){return[]}clearCache(){this.memoryCache.clearCache()}};p([k(re),h("design:type",re)],Be.prototype,"configHelper",void 0),p([k(xt),h("design:type",xt)],Be.prototype,"timeHelper",void 0),p([k(ht),h("design:type",ht)],Be.prototype,"blockHelper",void 0),p([k(_e),h("design:type",_e)],Be.prototype,"transactionHelper",void 0),p([k(St),h("design:type",St)],Be.prototype,"jsbiHelper",void 0),p([k($n,{dynamics:!0}),h("design:type",$n)],Be.prototype,"eventLogicVerifier",void 0),p([k(bi),h("design:type",bi)],Be.prototype,"helperLogicVerifier",void 0),p([k("transactionGetterHelper",{dynamics:!0}),h("design:type",Object)],Be.prototype,"transactionGetterHelper",void 0),p([k("blockGetterHelper",{dynamics:!0}),h("design:type",Object)],Be.prototype,"blockGetterHelper",void 0),p([k("accountGetterHelper",{dynamics:!0}),h("design:type",Object)],Be.prototype,"accountGetterHelper",void 0),p([k(Vo),h("design:type",Vo)],Be.prototype,"memoryCache",void 0);var xd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}};xd=p([j(),h("design:paramtypes",[])],xd);var Bd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.dapp.dappid]}};Bd=p([j(),h("design:paramtypes",[])],Bd);var{ConsensusException:Go}=Z("VERIFIER","DAppPurchasingLogicVerifier"),Hd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.isDAppidMatch(e,t),await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}async isDAppidMatch(e,t){const{dappAsset:r}=e.asset.dappPurchasing,{sourceChainMagic:n,dappid:s}=r,i=await this.accountGetterHelper.getDApp(n,s,t);if(!i)throw new Go(a.DAPPID_IS_NOT_EXIST,{dappid:s});if(e.recipientId!==i.possessorAddress)throw new Go(a.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"DAppPurchasingTransaction",be_compare_prop:`dapp possessor ${i.possessorAddress}`});if(r.sourceChainName!==i.sourceChainName||r.type!==i.type)throw new Go(a.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(r.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:r.sourceChainMagic,sourceChainName:i.sourceChainName,dappid:s,type:i.type})}`,to_target:"DAppPurchasingTransaction.asset.dappPurchasing",be_target:"blockChain dapp"});if(i.purchaseAsset){if(!r.purchaseAsset)throw new Go(a.PROP_IS_REQUIRE,{prop:"purchaseAsset",target:"DAppPurchasingTransaction.asset.dappPurchasing.dappAsset"});if(r.purchaseAsset!==i.purchaseAsset)throw new Go(a.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(r.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:r.sourceChainMagic,sourceChainName:i.sourceChainName,dappid:s,type:i.type,purchaseAsset:i.purchaseAsset})}`,to_target:"DAppPurchasingTransaction.asset.dappPurchasing",be_target:"blockChain dapp"})}else if(r.purchaseAsset)throw new Go(a.SHOULD_NOT_EXIST,{prop:"purchaseAsset",target:"DAppPurchasingTransaction.asset.dappPurchasing.dappAsset"})}};Hd=p([j(),h("design:paramtypes",[])],Hd);var{ConsensusException:gh}=Z("VERIFIER","MarkLogicVerifier"),kd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.isDAppidMatch(e,t),await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}async isDAppidMatch(e,t){const{dapp:r}=e.asset.mark,{sourceChainMagic:n,dappid:s}=r,i=await this.accountGetterHelper.getDApp(n,s,t);if(!i)throw new gh(a.DAPPID_IS_NOT_EXIST,{dappid:s});if(r.sourceChainName!==i.sourceChainName||r.type!==i.type)throw new gh(a.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(r.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:r.sourceChainMagic,sourceChainName:i.sourceChainName,dappid:s,type:i.type})}`,to_target:"MarkTransaction.asset.mark",be_target:"blockChain dapp"});if(i.purchaseAsset){if(!r.purchaseAsset)throw new gh(a.PROP_IS_REQUIRE,{prop:"purchaseAsset",target:"MarkTransaction.asset.mark.dapp"});if(r.purchaseAsset!==i.purchaseAsset)throw new gh(a.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(r.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:r.sourceChainMagic,sourceChainName:i.sourceChainName,dappid:s,type:i.type,purchaseAsset:i.purchaseAsset})}`,to_target:"MarkTransaction.asset.mark",be_target:"blockChain dapp"})}else if(r.purchaseAsset)throw new gh(a.SHOULD_NOT_EXIST,{prop:"purchaseAsset",target:"MarkTransaction.asset.mark.dapp"})}};kd=p([j(),h("design:paramtypes",[])],kd);var Ld=class extends Be{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.type]}};Ld=p([j(),Se(0,k(de)),Se(1,k(_e)),h("design:paramtypes",[de,_e])],Ld);var{ConsensusException:nA}=Z("VERIFIER","TransactionLogicVerifier"),Md=class extends Be{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:c}=e.asset.increaseAsset;await this.helperLogicVerifier.isAssetExist(c,i,o);const l=await this.helperLogicVerifier.getAccountForce(r,e.recipientId,t);this.checkRecipientStatus(o,l),await this.logicVerify(e,t,r);const{eventLogicVerifier:u}=this;return n===!1&&u.listenEvent(r,t,s),await u.awaitEventResult(e,s),!0}checkRecipientStatus(e,t){if(!t.hasOwnProperty("accountStatus"))throw new nA(a.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(t.accountStatus===16&&e!==this.configHelper.assetType)throw new nA(a.PERMISSION_DENIED,{operationName:`Increase asset ${e} to ${t.address}, because ${t.address} was frozen`})}getLockData(e){return[e.asset.increaseAsset.applyAddress]}};Md=p([j(),Se(0,k(de)),Se(1,k(_e)),h("design:paramtypes",[de,_e])],Md);var{ConsensusException:sA}=Z("VERIFIER","TransactionLogicVerifier"),Dd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:c}=e.asset.transferAsset;await this.helperLogicVerifier.isAssetExist(c,i,o);const l=await this.helperLogicVerifier.getAccountForce(r,e.recipientId,t);this.checkRecipientStatus(o,l),await this.logicVerify(e,t,r);const{eventLogicVerifier:u}=this;return n===!1&&u.listenEvent(r,t,s),await u.awaitEventResult(e,s),!0}checkRecipientStatus(e,t){if(!t.hasOwnProperty("accountStatus"))throw new sA(a.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(t.accountStatus===16&&e!==this.configHelper.assetType)throw new sA(a.PERMISSION_DENIED,{operationName:`Transfer asset ${e} to ${t.address}, because ${t.address} was frozen`})}};Dd=p([j(),h("design:paramtypes",[])],Dd);var{ConsensusException:iA}=Z("VERIFIER","TransactionLogicVerifier"),Fd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainName:i,sourceChainMagic:o,parentAssetType:c,assetType:l}=e.asset.transferAny;c===G.ASSETS&&await this.helperLogicVerifier.isAssetExist(i,o,l);const u=await this.helperLogicVerifier.getAccountForce(r,e.recipientId,t);this.checkRecipientStatus(l,u),await this.logicVerify(e,t,r);const{eventLogicVerifier:g}=this;return n===!1&&g.listenEvent(r,t,s),await g.awaitEventResult(e,s),!0}checkRecipientStatus(e,t){if(!t.hasOwnProperty("accountStatus"))throw new iA(a.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(t.accountStatus===16&&e!==this.configHelper.assetType)throw new iA(a.PERMISSION_DENIED,{operationName:`Transfer asset ${e} to ${t.address}, because ${t.address} was frozen`})}getLockData(e){const{parentAssetType:t,assetType:r,taxInformation:n}=e.asset.transferAny,s=[];return(t===G.DAPP||t===G.LOCATION_NAME||t===G.ENTITY)&&(s.push(r),n&&s.push(n.taxCollector)),s}};Fd=p([j(),h("design:paramtypes",[])],Fd);var{ConsensusException:NS}=Z("VERIFIER","TransactionLogicVerifier"),Ud=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:c}=e.asset.destroyAsset,l=await this.helperLogicVerifier.isAssetExist(c,i,o);if(l.applyAddress!==e.recipientId)throw new NS(a.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"transaction",be_compare_prop:`asset apply account address ${l.applyAddress}`});await this.logicVerify(e,t,r);const{eventLogicVerifier:u}=this;return n===!1&&u.listenEvent(r,t,s),await u.awaitEventResult(e,s),!0}};Ud=p([j(),h("design:paramtypes",[])],Ud);var $d=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:c,totalGrabableTimes:l}=e.asset.giftAsset;await this.helperLogicVerifier.isAssetExist(c,i,o),await this.logicVerify(e,t,r);const{eventLogicVerifier:u}=this;return n===!1&&u.listenEvent(r,t,s),await u.awaitEventResult(e,s),!0}checkTrsFeeAndWebFee(e,t){const r=e.asset.giftAsset.totalGrabableTimes+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(r)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=e.asset.giftAsset.totalGrabableTimes+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(n,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}};$d=p([j(),h("design:paramtypes",[])],$d);var Vd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,parentAssetType:c,sourceChainName:l}=e.asset.giftAny;c===G.ASSETS&&await this.helperLogicVerifier.isAssetExist(l,i,o),await this.logicVerify(e,t,r);const{eventLogicVerifier:u}=this;return n===!1&&u.listenEvent(r,t,s),await u.awaitEventResult(e,s),!0}checkTrsFeeAndWebFee(e,t){const r=e.asset.giftAny.totalGrabableTimes+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(r)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=e.asset.giftAny.totalGrabableTimes+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(n,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{parentAssetType:t,assetType:r}=e.asset.giftAny,n=[];return(t===G.DAPP||t===G.LOCATION_NAME||t===G.ENTITY)&&n.push(r),n}};Vd=p([j(),h("design:paramtypes",[])],Vd);var{ConsensusException:sr,NoFoundException:OS}=Z("VERIFIER","GrabAssetLogicVerifier"),Yl=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.grabAsset,{transactionSignature:o}=i,c=await this.transactionGetterHelper.getTransactionAndBlockSignatureBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!c)throw new OS(a.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"grabAsset"});const l=c.transaction,u=(await this.transactionCore.recombineTransaction(l)).as(Ji,o);if(!u)throw new sr(a.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});this.isValidRecipientId(e,u),this.isBlockSignatureMatch(e,c.blockSignature),this.isDependentTransactionMatch(e,u),await this.isValidAmount(e),await this.logicVerify(e,t,r);const{eventLogicVerifier:g}=this;return n===!1&&g.listenEvent(r,t,s),await g.awaitEventResult(e,s),!0}async isValidAmount(e){const{senderId:t,recipientId:r,asset:n}=e,s=n.grabAsset,{giftAsset:i,blockSignatureBuffer:o,transactionSignatureBuffer:c}=s;let l;switch(i.giftDistributionRule){case 0:l=this.transactionHelper.calcGrabAverageGiftAssetNumber(i.amount,i.totalGrabableTimes);break;case 1:l=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,o,c,r,i.amount,i.totalGrabableTimes);break;case 2:l=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,o,c,r,i.amount,i.totalGrabableTimes);break}if(!l)throw new sr(a.PROP_IS_INVALID,{prop:`calculate amount ${l.toString()}`,target:"giftAsset"});if(l.toString()!==s.amount)throw new sr(a.SHOULD_BE,{to_compare_prop:`amount ${s.amount}`,to_target:"grabAsset",be_compare_prop:l.toString()})}isValidRecipientId(e,t){if(e.recipientId!==t.senderId)throw new sr(a.NOT_MATCH,{to_compare_prop:`GrabAssetTransaction.recipientId ${e.recipientId}`,be_compare_prop:`GiftAssetTransaction.senderId ${t.senderId}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"})}isBlockSignatureMatch(e,t){if(t!==e.asset.grabAsset.blockSignature)throw new sr(a.NOT_MATCH,{to_compare_prop:`blockSignature ${t}`,be_compare_prop:`blockSignature ${e.asset.grabAsset.blockSignature}`,to_target:"grabAsset",be_target:"blockChain"})}isDependentTransactionMatch(e,t){const r=e.asset.grabAsset,{giftAsset:n,ciphertextSignature:s}=r,{sourceChainMagic:i,sourceChainName:o,assetType:c,amount:l,giftDistributionRule:u,totalGrabableTimes:g,cipherPublicKeys:y,beginUnfrozenBlockHeight:m}=n,d=t.asset.giftAsset;if(d.sourceChainMagic!==i||d.sourceChainName!==o||d.assetType!==c||d.totalGrabableTimes!==g||d.amount!==l||d.giftDistributionRule!==u)throw new sr(a.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(d)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"});if(d.beginUnfrozenBlockHeight!==void 0){if(m===void 0)throw new sr(a.PROP_IS_REQUIRE,{prop:"beginUnfrozenBlockHeight",target:"grabAsset.giftAsset"});if(d.beginUnfrozenBlockHeight!==m)throw new sr(a.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(d)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"})}else if(m!==void 0)throw new sr(a.SHOULD_NOT_EXIST,{prop:"beginUnfrozenBlockHeight",target:"grabAsset.giftAsset"});if(d.cipherPublicKeys.length!==y.length)throw new sr(a.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(d)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"});for(const S of d.cipherPublicKeys)if(!y.includes(S))throw new sr(a.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(d)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"});if(y.length>0){if(!s)throw new sr(a.PROP_IS_REQUIRE,{prop:"ciphertextSignature",target:"grabAsset"});const{publicKey:S}=s;if(!y.includes(S))throw new sr(a.NOT_MATCH,{to_compare_prop:`publicKey ${S}`,be_compare_prop:"cipherPublicKeys",to_target:"grabAsset.ciphertextSignature",be_target:"giftAsset.cipherPublicKeys"})}else if(s)throw new sr(a.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"grabAsset"});const{rangeType:I,range:T}=t;if(I&1){if(!T.includes(e.senderId))throw new sr(a.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"grabAssetTransaction",be_compare_prop:"giftAssetTransaction.range"})}else if(I&2){if(!e.dappid||!T.includes(e.dappid))throw new sr(a.SHOULD_BE,{to_compare_prop:`dappid ${e.dappid}`,to_target:"grabAssetTransaction",be_compare_prop:"giftAssetTransaction.range"})}else if(I&4&&(!e.lns||!T.includes(e.lns)))throw new sr(a.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"grabAssetTransaction",be_compare_prop:"giftAssetTransaction.range"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e,r).toString())}async checkSecondaryTransaction(e,t){if(await this.transactionGetterHelper.checkSecondaryTransaction({senderId:e.senderId,storageValue:e.storageValue,heightRange:this.transactionHelper.calcTransactionQueryRange(t)}))throw new sr(a.CAN_NOT_SECONDARY_TRANSACTION,{reason:`Can not secondary grab asset, sender ${e.senderId} gift transaction signature ${e.storageValue}`})}getLockData(e){const{transactionSignature:t}=e.asset.grabAsset;return[t]}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],Yl.prototype,"transactionCore",void 0),Yl=p([j(),h("design:paramtypes",[])],Yl);var{ConsensusException:Lt,NoFoundException:vS}=Z("VERIFIER","GrabAnyLogicVerifier"),Xl=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.grabAny,{transactionSignature:o,giftAny:c}=i,l=await this.transactionGetterHelper.getTransactionAndBlockSignatureBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!l)throw new vS(a.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"grabAny"});const u=l.transaction,g=(await this.transactionCore.recombineTransaction(u)).as(qi,o);if(!g)throw new Lt(a.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});this.isValidRecipientId(e,g),this.isBlockSignatureMatch(e,l.blockSignature),this.isDependentTransactionMatch(e,g),await this.isValidAmount(e),await this.logicVerify(e,t,r);const{eventLogicVerifier:y}=this;return n===!1&&y.listenEvent(r,t,s),await y.awaitEventResult(e,s),!0}async isValidAmount(e){const{senderId:t,recipientId:r,asset:n}=e,s=n.grabAny,{giftAny:i,blockSignatureBuffer:o,transactionSignatureBuffer:c}=s,{giftDistributionRule:l,parentAssetType:u,totalGrabableTimes:g,amount:y}=i;if(u===G.ASSETS){let m;switch(l){case 0:m=this.transactionHelper.calcGrabAverageGiftAssetNumber(y,g);break;case 1:m=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,o,c,r,y,g);break;case 2:m=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,o,c,r,y,g);break}if(!m)throw new Lt(a.PROP_IS_INVALID,{prop:"calculate amount",target:"giftAsset"});if(m.toString()!==s.amount)throw new Lt(a.SHOULD_BE,{to_compare_prop:`amount ${s.amount}`,to_target:"grabAny",be_compare_prop:m.toString()})}else if(s.amount!=="1")throw new Lt(a.SHOULD_BE,{to_compare_prop:`amount ${s.amount}`,to_target:"giftAny",be_compare_prop:"1"})}isValidRecipientId(e,t){if(e.recipientId!==t.senderId)throw new Lt(a.NOT_MATCH,{to_compare_prop:`GrabAnyTransaction.recipientId ${e.recipientId}`,be_compare_prop:`GiftAnyTransaction.senderId ${t.senderId}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"})}isBlockSignatureMatch(e,t){if(t!==e.asset.grabAny.blockSignature)throw new Lt(a.NOT_MATCH,{to_compare_prop:`blockSignature ${t}`,be_compare_prop:`blockSignature ${e.asset.grabAny.blockSignature}`,to_target:"grabAny",be_target:"blockChain"})}isDependentTransactionMatch(e,t){const{giftAny:r,ciphertextSignature:n}=e.asset.grabAny,{sourceChainMagic:s,sourceChainName:i,assetType:o,amount:c,giftDistributionRule:l,totalGrabableTimes:u,beginUnfrozenBlockHeight:g,taxInformation:y,cipherPublicKeys:m}=r,d=t.asset.giftAny;if(d.sourceChainMagic!==s||d.sourceChainName!==i||d.assetType!==o||d.amount!==c||d.giftDistributionRule!==l||d.totalGrabableTimes!==u)throw new Lt(a.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(d)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"});if(d.beginUnfrozenBlockHeight!==void 0){if(g===void 0)throw new Lt(a.PROP_IS_REQUIRE,{prop:"beginUnfrozenBlockHeight",target:"grabAny.giftAny"});if(d.beginUnfrozenBlockHeight!==g)throw new Lt(a.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(d)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"})}else if(g!==void 0)throw new Lt(a.SHOULD_NOT_EXIST,{prop:"beginUnfrozenBlockHeight",target:"grabAny.giftAny"});if(d.taxInformation){if(!y)throw new Lt(a.PROP_IS_REQUIRE,{prop:"taxInformation",target:"grabAny.giftAny"});if(d.taxInformation.taxAssetPrealnum!==y.taxAssetPrealnum||d.taxInformation.taxCollector!==y.taxCollector)throw new Lt(a.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(d)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"})}else if(y)throw new Lt(a.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"grabAny.giftAny"});if(d.cipherPublicKeys.length!==m.length)throw new Lt(a.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(d)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"});for(const S of d.cipherPublicKeys)if(!m.includes(S))throw new Lt(a.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(d)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"});if(m.length>0){if(!n)throw new Lt(a.NOT_EXIST,{prop:"ciphertextSignature",target:"grabAny"});const{publicKey:S}=n;if(!m.includes(S))throw new Lt(a.NOT_MATCH,{to_compare_prop:`publicKey ${S}`,be_compare_prop:"cipherPublicKeys",to_target:"grabAny.ciphertextSignature",be_target:"giftAny.cipherPublicKeys"})}else if(n)throw new Lt(a.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"grabAny"});const{rangeType:I,range:T}=t;if(I&1){if(!T.includes(e.senderId))throw new Lt(a.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"grabAnyTransaction",be_compare_prop:"giftAnyTransaction.range"})}else if(I&2){if(!e.dappid||!T.includes(e.dappid))throw new Lt(a.SHOULD_BE,{to_compare_prop:`dappid ${e.dappid}`,to_target:"grabAnyTransaction",be_compare_prop:"giftAnyTransaction.range"})}else if(I&4&&(!e.lns||!T.includes(e.lns)))throw new Lt(a.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"grabAnyTransaction",be_compare_prop:"giftAnyTransaction.range"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e,r).toString())}async checkSecondaryTransaction(e,t){if(await this.transactionGetterHelper.checkSecondaryTransaction({senderId:e.senderId,storageValue:e.storageValue,heightRange:this.transactionHelper.calcTransactionQueryRange(t)}))throw new Lt(a.CAN_NOT_SECONDARY_TRANSACTION,{reason:`Can not secondary grab asset, sender ${e.senderId} gift transaction signature ${e.storageValue}`})}getLockData(e){const{transactionSignature:t,giftAny:r}=e.asset.grabAny,{parentAssetType:n,assetType:s,taxInformation:i}=r,o=[t];return(n===G.DAPP||n===G.LOCATION_NAME||n===G.ENTITY)&&(o.push(s),i&&o.push(i.taxCollector)),o}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],Xl.prototype,"transactionCore",void 0),Xl=p([j(),h("design:paramtypes",[])],Xl);var{ConsensusException:aA}=Z("VERIFIER","TrustAssetLogicVerifier"),Gd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:c,numberOfSignFor:l}=e.asset.trustAsset;if(!(i===this.configHelper.magic&&o===this.configHelper.assetType))throw new aA(a.TRUST_MAIN_ASSET_ONLY,{assetType:o,mainAsset:this.configHelper.assetType,errorId:Ce.TRUST_MAIN_ASSET_ONLY});await this.isTrusteesFrozen(e.asset.trustAsset.trustees,t),await this.helperLogicVerifier.isAssetExist(c,i,o),await this.logicVerify(e,t,r);const{eventLogicVerifier:u}=this;return n===!1&&u.listenEvent(r,t,s),await u.awaitEventResult(e,s),!0}async isTrusteesFrozen(e,t){for(const r of e){const n=await this.accountGetterHelper.getAccountInfo(r,t);if(n&&n.accountStatus!==0)throw new aA(a.ACCOUNT_FROZEN,{address:n.address,errorId:Ce.TRANSACTION_SENDER_ASSET_FROZEN})}}checkTrsFeeAndWebFee(e,t){const r=e.asset.trustAsset.numberOfSignFor+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(r)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=e.asset.trustAsset.numberOfSignFor+1;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(n,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}};Gd=p([j(),h("design:paramtypes",[])],Gd);var{ConsensusException:ba}=Z("VERIFIER","SignForAssetLogicVerifier"),Ql=class extends Be{constructor(e){super(),this.accountBaseHelper=e}async verify(e,t,r,n,s){const{transactionSignature:i}=e.asset.signForAsset,o=await this.transactionGetterHelper.getTransactionBySignature(i,this.transactionHelper.calcTransactionQueryRange(t));if(!o)throw new ba(a.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${i}`,target:"blockChain"});const c=(await this.transactionCore.recombineTransaction(o)).as(qa,i);if(!c)throw new ba(a.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${i}`});await this.isDependentTransactionMatch(e,c),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}async isDependentTransactionMatch(e,t){const{trustAsset:r,trustSenderId:n,trustRecipientId:s}=e.asset.signForAsset,i=t.asset.trustAsset;if(n!==t.senderId)throw new ba(a.SHOULD_BE,{to_compare_prop:`trustSenderId ${n}`,be_compare_prop:`trustSenderId ${t.senderId}`,to_target:"SignForAssetTransaction.asset.signForAsset",be_target:"TrustAssetTransaction"});if(s!==t.recipientId)throw new ba(a.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`recipientId ${t.recipientId}`,to_target:"SignForAssetTransaction",be_target:"TrustAssetTransaction"});if(i.sourceChainMagic!==r.sourceChainMagic||i.sourceChainName!==r.sourceChainName||i.assetType!==r.assetType||i.amount!==r.amount||i.numberOfSignFor!==r.numberOfSignFor||i.trustees.length!==r.trustees.length)throw new ba(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(i)}`,be_compare_prop:`trustAsset: ${JSON.stringify(r.toJSON())}`,to_target:"SignForAssetTransaction.asset.signForAsset",be_target:"TrustAssetTransaction.asset.trustAsset"});const o=[...i.trustees],c=[...r.trustees];for(const l of o)if(!c.includes(l))throw new ba(a.NOT_MATCH,{to_compare_prop:`trustees: ${JSON.stringify(c)}`,be_compare_prop:`address: ${l}`,to_target:"SignForAssetTransaction.asset.signForAsset.trustAsset",be_target:"TrustAssetTransaction.asset.trustAsset"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,this.transactionHelper.calcTransactionBlobFee(e,r).toString())}async checkSecondaryTransaction(e,t){if(await this.transactionGetterHelper.checkSecondaryTransaction({senderId:e.senderId,storageValue:e.storageValue,heightRange:this.transactionHelper.calcTransactionQueryRange(t)}))throw new ba(a.CAN_NOT_SECONDARY_TRANSACTION,{reason:`Can not secondary sign for asset, sender ${e.senderId} trust transaction signature ${e.storageValue}`})}getLockData(e){return[e.asset.signForAsset.transactionSignature]}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],Ql.prototype,"transactionCore",void 0),Ql=p([j(),Se(0,k(de)),h("design:paramtypes",[de])],Ql);var Kd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.toExchangeAsset;await this.isExchangeAssetAlreadyExist(i),await this.logicVerify(e,t,r);const{eventLogicVerifier:o}=this;return n===!1&&o.listenEvent(r,t,s),await o.awaitEventResult(e,s),!0}async isExchangeAssetAlreadyExist(e){const{toExchangeSource:t,toExchangeChainName:r,toExchangeAsset:n,beExchangeSource:s,beExchangeChainName:i,beExchangeAsset:o}=e;await this.helperLogicVerifier.isAssetExist(r,t,n),await this.helperLogicVerifier.isAssetExist(i,s,o)}};Kd=p([j(),h("design:paramtypes",[])],Kd);var{ConsensusException:ir,NoFoundException:CS}=Z("VERIFIER","TransactionLogicVerifier"),ql=class extends Be{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){const i=e.asset.beExchangeAsset,{transactionSignature:o}=i,c=await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!c)throw new CS(a.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});const l=(await this.transactionCore.recombineTransaction(c)).as(Wa,o);if(!l)throw new ir(a.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});this.isValidRecipientId(e,l),this.isDependentTransactionMatch(e,l),await this.logicVerify(e,t,r);const{eventLogicVerifier:u}=this;return n===!1&&u.listenEvent(r,t,s),await u.awaitEventResult(e,s),!0}isValidRecipientId(e,t){if(e.recipientId!==t.senderId)throw new ir(a.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${t.senderId}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"})}isDependentTransactionMatch(e,t){const r=e.asset.beExchangeAsset,{exchangeAsset:n,ciphertextSignature:s,toExchangeNumber:i,beExchangeNumber:o}=r,{cipherPublicKeys:c,exchangeRate:l}=n,u=t.asset.toExchangeAsset;if(u.toExchangeSource!==n.toExchangeSource||u.beExchangeSource!==n.beExchangeSource||u.toExchangeChainName!==n.toExchangeChainName||u.beExchangeChainName!==n.beExchangeChainName||u.toExchangeAsset!==n.toExchangeAsset||u.beExchangeAsset!==n.beExchangeAsset||u.toExchangeNumber!==n.toExchangeNumber)throw new ir(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(u)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});if(u.exchangeRate){if(!l)throw new ir(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(u)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});if(u.exchangeRate.prevWeight!==l.prevWeight||u.exchangeRate.nextWeight!==l.nextWeight)throw new ir(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(u)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"})}else if(l)throw new ir(a.SHOULD_NOT_EXIST,{prop:"exchangeRate",target:"BeExchangeAssetTransaction.beExchangeAsset.exchangeAsset"});if(e.senderId===e.recipientId){if(i==="0")throw new ir(a.PROP_SHOULD_GT_FIELD,{prop:`toExchangeNumber ${i}`,field:"0",target:"BeExchangeAssetTransaction.beExchangeAsset"});if(o!=="0")throw new ir(a.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeNumber ${o}`,field:"0",target:"BeExchangeAssetTransaction.beExchangeAsset"})}else{if(i==="0"&&o==="0")throw new ir(a.PROP_SHOULD_GT_FIELD,{prop:`beExchangeNumber ${o}`,field:"0",target:"beExchangeAsset"});const m=this.jsbiHelper.multiplyRoundFraction(i,{numerator:n.exchangeRate.nextWeight,denominator:n.exchangeRate.prevWeight});if(m>BigInt(o))throw new ir(a.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeNumber ${o}`,field:m.toString(),target:"BeExchangeAssetTransaction.beExchangeAsset"})}if(u.cipherPublicKeys.length!==c.length)throw new ir(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(u)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});for(const m of u.cipherPublicKeys)if(!c.includes(m))throw new ir(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(u)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});if(c.length>0){if(!s)throw new ir(a.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAsset"});const{publicKey:m}=s;if(!c.includes(m))throw new ir(a.NOT_MATCH,{to_compare_prop:`publicKey ${m}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAsset.ciphertextSignature",be_target:"toExchangeAsset.cipherPublicKeys"})}else if(s)throw new ir(a.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAsset"});const{rangeType:g,range:y}=t;if(g&1){if(!y.includes(e.senderId))throw new ir(a.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAssetTransaction",be_compare_prop:"toExchangeAssetTransaction.range"})}else if(g&2){if(!e.dappid||!y.includes(e.dappid))throw new ir(a.SHOULD_BE,{to_compare_prop:`dappid ${e.dappid}`,to_target:"beExchangeAssetTransaction",be_compare_prop:"toExchangeAssetTransaction.range"})}else if(g&4&&(!e.lns||!y.includes(e.lns)))throw new ir(a.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAssetTransaction",be_compare_prop:"toExchangeAssetTransaction.range"})}getLockData(e){return[e.asset.beExchangeAsset.transactionSignature]}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],ql.prototype,"transactionCore",void 0),ql=p([j(),h("design:paramtypes",[St])],ql);var{ConsensusException:Vn}=Z("VERIFIER","EmigrateAssetLogicVerifier"),jd=class extends Be{constructor(e,t,r){super(),this.accountBaseHelper=e,this.configMap=t,this.migrateCertificateHelper=r}async verify(e,t,r,n,s){const{accountGetterHelper:i}=this,{senderId:o,toMagic:c}=e,l=await this.helperLogicVerifier.getAccountForce(r,o,t);if(await i.isFrozenAsset(o))throw new Vn(a.POSSESS_FROZEN_ASSET);await this.helperLogicVerifier.isPossessAssetExceptChainAsset(o,l.assets),await this.helperLogicVerifier.isDAppPossessor(o,this.configHelper),await this.helperLogicVerifier.isLnsPossessorOrManager(o,this.configHelper),await this.helperLogicVerifier.isEntityFactoryPossessor(o,this.configHelper),await this.helperLogicVerifier.isEntityPossessor(o,this.configHelper);let u;try{u=JSON.parse(e.asset.emigrateAsset.migrateCertificate)}catch{throw new Vn(a.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const g=this.migrateCertificateHelper.getMigrateCertificateConverter(u),y=u.body,m=g.assetId.decode(y.assetId,!0),d=g.fromChainId.decode(y.fromChainId,!0).magic;if(!(d===this.configHelper.magic&&m.assetType===this.configHelper.assetType))throw new Vn(a.MIGRATE_MAIN_ASSET_ONLY,{assetType:m.assetType,mainAsset:this.configHelper.assetType,errorId:Ce.MIGRATE_MAIN_ASSET_ONLY});const I=await i.getChain(c);if(!I)throw new Vn(a.NOT_EXIST,{prop:`Chain with magic ${c}`,target:"blockChain"});const T=I.genesisBlock,S=g.toChainId.decode(y.toChainId,!0);await this.migrateCertificateHelper.checkChainInfo("toChain",S,{chainName:T.chainName,magic:T.magic,generatorPublicKey:T.genesisAccount.publicKey,genesisBlockSignature:T.genesisBlockSignature,genesisGenerators:T.genesisGenerators.map(L=>L.address)});const{publicKey:w,secondPublicKey:b,signSignature:R}=g.fromAuthSignature.decode(u.fromAuthSignature,!0),v=await this.accountBaseHelper.getAddressFromPublicKeyString(w),$=await i.getAccountInfo(v,t);if(!$)throw new Vn(a.NOT_EXIST,{prop:`Account with address ${v}`,target:"blockChain"});if($.secondPublicKey){if(!b)throw new Vn(a.PROP_IS_REQUIRE,{prop:"secondPublicKey",target:"genesisGeneratorsignature"});if(!R)throw new Vn(a.PROP_IS_REQUIRE,{prop:"signSignature",target:"genesisGeneratorsignature"});if($.secondPublicKey!==b)throw new Vn(a.NOT_MATCH,{to_compare_prop:`secondPublicKey ${$.secondPublicKey}`,be_compare_prop:`secondPublicKey ${b}`,to_target:"transaction",be_target:"generator"})}else{if(b)throw new Vn(a.CAN_NOT_CARRY_SECOND_PUBLICKEY);if(R)throw new Vn(a.CAN_NOT_CARRY_SECOND_SIGNATURE,{signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type})}if(m.parentAssetType===G.ASSETS){const L=m.assetType===this.configHelper.assetType?BigInt(e.fee)+BigInt(y.assetPrealnum):BigInt(y.assetPrealnum);if(l.assets[d][m.assetType].assetNumber!==L)throw new Vn(a.NEED_EMIGRATE_TOTAL_ASSET,{address:o})}await this.logicVerify(e,t,r);const{eventLogicVerifier:D}=this;return n===!1&&D.listenEvent(r,t,s),await D.awaitEventResult(e,s),!0}};jd=p([j(),Se(0,k(de)),h("design:paramtypes",[de,yr,Fs])],jd);var{ConsensusException:wi,NoFoundException:aw}=Z("VERIFIER","ImmigrateAssetLogicVerifier"),zd=class extends Be{constructor(e,t,r,n){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.configMap=r,this.migrateCertificateHelper=n}async verify(e,t,r,n,s){const i=this.accountGetterHelper;let o;try{o=JSON.parse(e.asset.immigrateAsset.migrateCertificate)}catch{throw new wi(a.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const c=this.migrateCertificateHelper.getMigrateCertificateConverter(o),l=c.fromChainId.decode(o.body.fromChainId,!0),u=e.fromMagic,g=await i.getChain(u);if(!g)throw new wi(a.NOT_EXIST,{prop:`Chain with magic ${l.magic}`,target:"blockChain"});const y=g.genesisBlock;await this.migrateCertificateHelper.checkChainInfo("fromChain",l,{chainName:y.chainName,magic:y.magic,generatorPublicKey:y.genesisAccount.publicKey,genesisBlockSignature:y.genesisBlockSignature,genesisGenerators:y.genesisGenerators.map(b=>b.address)});const{publicKey:m,secondPublicKey:d,signSignature:I}=c.toAuthSignature.decode(o.toAuthSignature,!0),T=await this.accountBaseHelper.getAddressFromPublicKeyString(m),S=await i.getAccountInfo(T,t);if(!S)throw new wi(a.NOT_EXIST,{prop:`Account with address ${T}`,target:"blockChain"});if(S.secondPublicKey){if(!d)throw new wi(a.PROP_IS_REQUIRE,{prop:"secondPublicKey",target:"genesisGeneratorsignature"});if(!I)throw new wi(a.PROP_IS_REQUIRE,{prop:"signSignature",target:"genesisGeneratorsignature"});if(S.secondPublicKey!==d)throw new wi(a.NOT_MATCH,{to_compare_prop:`secondPublicKey ${S.secondPublicKey}`,be_compare_prop:`secondPublicKey ${d}`,to_target:"transaction",be_target:"generator"})}else{if(d)throw new wi(a.CAN_NOT_CARRY_SECOND_PUBLICKEY);if(I)throw new wi(a.CAN_NOT_CARRY_SECOND_SIGNATURE)}await this.logicVerify(e,t,r);const{eventLogicVerifier:w}=this;return n===!1&&w.listenEvent(r,t,s),await w.awaitEventResult(e,s),!0}};zd=p([j(),Se(0,k(de)),Se(1,k(_e)),h("design:paramtypes",[de,_e,yr,Fs])],zd);var Jd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,assetType:o,sourceChainName:c}=e.asset.stakeAsset;await this.helperLogicVerifier.isAssetExist(c,i,o),await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.stakeAsset.stakeId]}};Jd=p([j(),h("design:paramtypes",[])],Jd);var{ConsensusException:RS}=Z("VERIFIER","UnstakeAssetLogicVerifier"),Wl=class extends Be{constructor(e){super(),this.accountBaseHelper=e}async verify(e,t,r,n,s){const{stakeId:i,sourceChainMagic:o,sourceChainName:c,assetType:l}=e.asset.unstakeAsset,u=await this.helperLogicVerifier.getStakeAssetForce(e.senderId,i);if(u.sourceChainMagic!==o||u.sourceChainName!==c||u.assetType!==l)throw new RS(a.NOT_MATCH,{to_compare_prop:`stakeAsset: ${JSON.stringify({sourceChainMagic:u.sourceChainMagic,sourceChainName:u.sourceChainName,assetType:u.assetType})}`,be_compare_prop:`unstakeAsset: ${JSON.stringify({sourceChainMagic:o,sourceChainName:c,assetType:l})}`,to_target:"UnstakeAssetTransaction.asset.unstakeAsset",be_target:"StakeAssetTransaction.asset.stakeAsset"});await this.logicVerify(e,t,r);const{eventLogicVerifier:g}=this;return n===!1&&g.listenEvent(r,t,s),await g.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.unstakeAsset.stakeId]}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],Wl.prototype,"transactionCore",void 0),Wl=p([j(),Se(0,k(de)),h("design:paramtypes",[de])],Wl);var Yd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.locationName.name]}};Yd=p([j(),h("design:paramtypes",[])],Yd);var Xd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.lnsManager.name]}};Xd=p([j(),h("design:paramtypes",[])],Xd);var Qd=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.lnsRecordValue.name]}};Qd=p([j(),h("design:paramtypes",[])],Qd);var qd=class extends Be{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.type]}};qd=p([j(),Se(0,k(de)),Se(1,k(_e)),h("design:paramtypes",[de,_e])],qd);var Wd=class extends Be{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.type]}};Wd=p([j(),Se(0,k(de)),Se(1,k(_e)),h("design:paramtypes",[de,_e])],Wd);var Zd=class extends Be{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await this.eventLogicVerifier.awaitEventResult(e,s),!0}getLockData(e){return[e.asset.issueEntity.entityFactoryPossessor]}};Zd=p([j(),Se(0,k(de)),Se(1,k(_e)),h("design:paramtypes",[de,_e])],Zd);var{ConsensusException:Zl,NoFoundException:PS}=Z("VERIFIER","DestroyEntityLogicVerifier"),eu=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.destroyEntity,{transactionSignature:o}=i,c=await this.transactionGetterHelper.getTransactionAndBlockSignatureBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!c)throw new PS(a.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"destroyEntity"});let l="";const u=c.transaction,g=await this.transactionCore.recombineTransaction(u),y=g.as(Xi,o);if(y){const d=y.asset.issueEntity;if(d.entityId!==i.entityId)throw new Zl(a.NOT_MATCH,{to_compare_prop:`entityId ${i.entityId}`,be_compare_prop:`entityId ${d.entityId}`,to_target:"transaction",be_target:"issueEntityTransaction"});l=y.senderId}else{const d=g.as(Qi,o);if(!d)throw new Zl(a.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});const I=d.asset.issueEntityMulti.entityStructList.map(T=>T.entityId);if(!I.includes(i.entityId))throw new Zl(a.NOT_MATCH,{to_compare_prop:`entityId ${i.entityId}`,be_compare_prop:`entityId [${I.slice(0,3).join(",")}...]`,to_target:"transaction",be_target:"issueEntityMultiTransaction"});l=d.senderId}if(e.recipientId!==l)throw new Zl(a.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`entityApplicant ${l}`,to_target:"transaction",be_target:"issueEntityTransaction"});await this.logicVerify(e,t,r);const{eventLogicVerifier:m}=this;return n===!1&&m.listenEvent(r,t,s),await m.awaitEventResult(e,s),!0}getLockData(e){const{entityFactoryApplicant:t,entityFactoryPossessor:r,entityId:n}=e.asset.destroyEntity;return[t,r,n]}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],eu.prototype,"transactionCore",void 0),eu=p([j(),h("design:paramtypes",[])],eu);var{ConsensusException:xS}=Z("CONTROLLER","IssueEntityMultiLogicVerifier"),ey=class extends Be{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){this.__checkTrsFee(e),await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await this.eventLogicVerifier.awaitEventResult(e,s),!0}__checkTrsFee(e){const t=this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length);if(BigInt(e.fee)<BigInt(t))throw new xS(a.TRANSACTION_FEE_NOT_ENOUGH,{errorId:Ce.TRANSACTION_FEE_NOT_ENOUGH,minFee:t,target:"transaction"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){return[e.asset.issueEntityMulti.entityFactoryPossessor]}};ey=p([j(),Se(0,k(de)),Se(1,k(_e)),h("design:paramtypes",[de,_e])],ey);var{ConsensusException:Ko}=Z("VERIFIER","ToExchangeAnyLogicVerifier"),ty=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.toExchangeAny,{beExchangeSource:o,beExchangeChainName:c,beExchangeParentAssetType:l,beExchangeAssetType:u}=i,g=this.accountGetterHelper;if(l===G.ASSETS)await this.helperLogicVerifier.isAssetExist(c,o,u);else if(l===G.DAPP){if(!await g.getDApp(o,u,t))throw new Ko(a.DAPPID_IS_NOT_EXIST,{dappid:u})}else if(l===G.LOCATION_NAME){if(u.split(",").length>2)throw new Ko(a.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(!await g.getLocationName(o,u,t))throw new Ko(a.LOCATION_NAME_IS_NOT_EXIST,{locationName:u,errorId:Ce.LOCATION_NAME_NOT_EXIST})}else if(l===G.ENTITY){const m=await g.getEntity(o,u,t);if(!m)throw new Ko(a.ENTITY_IS_NOT_EXIST,{entityId:u,errorId:Ce.ENTITY_NOT_EXIST});if(m.status===255)throw new Ko(a.ENTITY_ALREADY_DESTROY,{entityId:u,reason:"Entity already be destroy"})}else throw new Ko(a.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${l}`,target:"transaction.asset.toExchangeAny"});await this.logicVerify(e,t,r);const{eventLogicVerifier:y}=this;return n===!1&&y.listenEvent(r,t,s),await y.awaitEventResult(e,s),!0}getLockData(e){const{toExchangeParentAssetType:t,toExchangeAssetType:r}=e.asset.toExchangeAny,n=[];return(t===G.DAPP||t===G.LOCATION_NAME||t===G.ENTITY)&&n.push(r),n}};ty=p([j(),h("design:paramtypes",[])],ty);var{ConsensusException:at,NoFoundException:BS}=Z("VERIFIER","BeExchangeAnyLogicVerifier"),tu=class extends Be{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){const i=e.asset.beExchangeAny,{transactionSignature:o}=i,c=await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!c)throw new BS(a.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});const l=(await this.transactionCore.recombineTransaction(c)).as(Za,o);if(!l)throw new at(a.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});if(e.recipientId!==l.senderId)throw new at(a.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${l.senderId}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});this.isDependentTransactionMatch(e,l),await this.logicVerify(e,t,r);const{eventLogicVerifier:u}=this;return n===!1&&u.listenEvent(r,t,s),await u.awaitEventResult(e,s),!0}isDependentTransactionMatch(e,t){const r=e.asset.beExchangeAny,{exchangeAny:n,ciphertextSignature:s}=r,{cipherPublicKeys:i,assetExchangeWeightRatio:o,taxInformation:c}=n,l=t.asset.toExchangeAny;if(l.toExchangeSource!==n.toExchangeSource||l.beExchangeSource!==n.beExchangeSource||l.toExchangeParentAssetType!==n.toExchangeParentAssetType||l.beExchangeParentAssetType!==n.beExchangeParentAssetType||l.toExchangeAssetType!==n.toExchangeAssetType||l.beExchangeAssetType!==n.beExchangeAssetType||l.toExchangeAssetPrealnum!==n.toExchangeAssetPrealnum)throw new at(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(l.beExchangeAssetPrealnum){if(!n.beExchangeAssetPrealnum)throw new at(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(l.beExchangeAssetPrealnum!==n.beExchangeAssetPrealnum)throw new at(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"})}else if(n.beExchangeAssetPrealnum)throw new at(a.SHOULD_NOT_EXIST,{prop:"beExchangeAssetPrealnum",target:"BeExchangeAnyTransaction.beExchangeAny.exchangeAny"});if(l.assetExchangeWeightRatio){if(!o)throw new at(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(l.assetExchangeWeightRatio.toExchangeAssetWeight!==o.toExchangeAssetWeight||l.assetExchangeWeightRatio.beExchangeAssetWeight!==o.beExchangeAssetWeight)throw new at(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"})}else if(o)throw new at(a.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",target:"BeExchangeAnyTransaction.beExchangeAny.exchangeAny"});if(l.taxInformation){if(!c)throw new at(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(l.taxInformation.taxCollector!==c.taxCollector||l.taxInformation.taxAssetPrealnum!==c.taxAssetPrealnum)throw new at(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"})}else if(c)throw new at(a.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"BeExchangeAnyTransaction.beExchangeAny.exchangeAny"});if(l.cipherPublicKeys.length!==i.length)throw new at(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});for(const d of l.cipherPublicKeys)if(!i.includes(d))throw new at(a.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(i.length>0){if(!s)throw new at(a.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAny"});const{publicKey:d}=s;if(!i.includes(d))throw new at(a.NOT_MATCH,{to_compare_prop:`publicKey ${d}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAny.ciphertextSignature",be_target:"toExchangeAny.cipherPublicKeys"})}else if(s)throw new at(a.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAny"});const{toExchangeAssetPrealnum:u,beExchangeAssetPrealnum:g}=r;if(e.senderId===e.recipientId){if(n.toExchangeParentAssetType===G.ASSETS){if(u==="0")throw new at(a.PROP_SHOULD_GT_FIELD,{prop:`toExchangeAssetPrealnum ${u}`,field:"0",target:"beExchangeAny"})}else if(u!=="1")throw new at(a.PROP_SHOULD_EQ_FIELD,{prop:`toExchangeAssetPrealnum ${u}`,field:"1",target:"beExchangeAny"});if(g!=="0")throw new at(a.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,field:"0",target:"beExchangeAny"})}else{if(u==="0"&&g==="0")throw new at(a.PROP_SHOULD_GT_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,field:"0",target:"beExchangeAny"});if(o){const d=this.jsbiHelper.multiplyRoundFraction(u,{numerator:o.beExchangeAssetWeight,denominator:o.toExchangeAssetWeight});if(d>BigInt(g))throw new at(a.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,field:d.toString(),target:"beExchangeAny"})}else if(n.beExchangeParentAssetType===G.ASSETS){if(BigInt(g)<BigInt(n.beExchangeAssetPrealnum))throw new at(a.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,field:n.beExchangeAssetPrealnum,target:"beExchangeAny"})}else if(g!=="1")throw new at(a.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,field:"1",target:"beExchangeAny"})}const{rangeType:y,range:m}=t;if(y&1){if(!m.includes(e.senderId))throw new at(a.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAnyTransaction",be_compare_prop:"beExchangeAnyTransaction.range"})}else if(y&2){if(!e.dappid||!m.includes(e.dappid))throw new at(a.SHOULD_BE,{to_compare_prop:`dappid ${e.senderId}`,to_target:"beExchangeAnyTransaction",be_compare_prop:"beExchangeAnyTransaction.range"})}else if(y&4&&(!e.lns||!m.includes(e.lns)))throw new at(a.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAnyTransaction",be_compare_prop:"beExchangeAnyTransaction.range"})}getLockData(e){const{transactionSignature:t,exchangeAny:r,taxInformation:n}=e.asset.beExchangeAny,{toExchangeParentAssetType:s,beExchangeParentAssetType:i}=r,o=[t];return(s===G.DAPP||s===G.LOCATION_NAME||s===G.ENTITY)&&(o.push(r.toExchangeAssetType),r.taxInformation&&o.push(r.taxInformation.taxCollector)),(i===G.DAPP||i===G.LOCATION_NAME||i===G.ENTITY)&&(o.push(r.beExchangeAssetType),n&&o.push(n.taxCollector)),o}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],tu.prototype,"transactionCore",void 0),tu=p([j(),h("design:paramtypes",[St])],tu);var{ConsensusException:wa}=Z("VERIFIER","ToExchangeAnyMultiLogicVerifier"),ry=class extends Be{constructor(){super()}async verify(e,t,r,n,s){this.__checkTrsFee(e);const i=e.asset.toExchangeAnyMulti,{beExchangeAsset:o}=i,{beExchangeSource:c,beExchangeChainName:l,beExchangeParentAssetType:u,beExchangeAssetType:g}=o,y=this.accountGetterHelper;if(u===G.ASSETS)await this.helperLogicVerifier.isAssetExist(l,c,g);else if(u===G.DAPP){if(!await y.getDApp(c,g,t))throw new wa(a.DAPPID_IS_NOT_EXIST,{dappid:g})}else if(u===G.LOCATION_NAME){if(g.split(",").length>2)throw new wa(a.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(!await y.getLocationName(c,g,t))throw new wa(a.LOCATION_NAME_IS_NOT_EXIST,{locationName:g,errorId:Ce.LOCATION_NAME_NOT_EXIST})}else if(u===G.ENTITY){const d=await y.getEntity(c,g,t);if(!d)throw new wa(a.ENTITY_IS_NOT_EXIST,{entityId:g,errorId:Ce.ENTITY_NOT_EXIST});if(d.status===255)throw new wa(a.ENTITY_ALREADY_DESTROY,{entityId:g,reason:"Entity already be destroy"})}else throw new wa(a.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${u}`,target:"transaction.asset.toExchangeAnyMulti"});await this.logicVerify(e,t,r);const{eventLogicVerifier:m}=this;return n===!1&&m.listenEvent(r,t,s),await m.awaitEventResult(e,s),!0}__checkTrsFee(e){const t=this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length);if(BigInt(e.fee)<BigInt(t))throw new wa(a.TRANSACTION_FEE_NOT_ENOUGH,{errorId:Ce.TRANSACTION_FEE_NOT_ENOUGH,minFee:t,target:"transaction"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{toExchangeAssets:t}=e.asset.toExchangeAnyMulti,r=[];for(const n of t){const{toExchangeParentAssetType:s,toExchangeAssetType:i}=n;(s===G.DAPP||s===G.LOCATION_NAME||s===G.ENTITY)&&r.push(i)}return r}};ry=p([j(),h("design:paramtypes",[])],ry);var{ConsensusException:ut,NoFoundException:HS}=Z("VERIFIER","BeExchangeAnyMultiLogicVerifier"),ru=class extends Be{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){this.__checkTrsFee(e);const i=e.asset.beExchangeAnyMulti,{transactionSignature:o}=i,c=await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!c)throw new HS(a.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});const l=(await this.transactionCore.recombineTransaction(c)).as(eo,o);if(!l)throw new ut(a.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});if(e.recipientId!==l.senderId)throw new ut(a.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${l.senderId}`,to_target:"BeExchangeAnyMultiTransaction",be_target:"ToExchangeAnyMultiTransaction"});this.isDependentTransactionMatch(e,l),await this.logicVerify(e,t,r);const{eventLogicVerifier:u}=this;return n===!1&&u.listenEvent(r,t,s),await u.awaitEventResult(e,s),!0}isDependentTransactionMatch(e,t){const{toExchangeAssets:r,beExchangeAsset:n,cipherPublicKeys:s}=t.asset.toExchangeAnyMulti,{toExchangeAssets:i,beExchangeAsset:o,ciphertextSignature:c}=e.asset.beExchangeAnyMulti,l={};for(const I of r){const{toExchangeSource:T,toExchangeChainName:S,toExchangeParentAssetType:w,toExchangeAssetType:b,toExchangeAssetPrealnum:R,assetExchangeWeightRatio:v,taxInformation:$}=I;l[`${T}${b}`]={toExchangeChainName:S,toExchangeParentAssetType:w,toExchangeAssetPrealnum:R,assetExchangeWeightRatio:v,taxInformation:$}}for(const I of i){const{toExchangeSource:T,toExchangeChainName:S,toExchangeParentAssetType:w,toExchangeAssetType:b,toExchangeAssetPrealnum:R,assetExchangeWeightRatio:v,taxInformation:$}=I,D=`${T}${b}`,L=l[D];if(!L)throw new ut(a.SHOULD_NOT_INCLUDE,{prop:"toExchangeAssets",target:"toExchangeAnyMulti",value:`toExchangeChainName ${S} toExchangeSource ${T} toExchangeAssetType ${b}`});if(L.toExchangeChainName!==S||L.toExchangeParentAssetType!==w)throw new ut(a.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:L.toExchangeChainName,toExchangeParentAssetType:L.toExchangeParentAssetType,toExchangeAssetType:b})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(I.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"});if(BigInt(R)>BigInt(L.toExchangeAssetPrealnum))throw new ut(a.PROP_SHOULD_LTE_FIELD,{prop:`toExchangeAssets.toExchangeAsset.toExchangeAssetPrealnum ${R}`,target:"beExchangeAnyMulti",field:L.toExchangeAssetPrealnum});if(L.assetExchangeWeightRatio){if(!v)throw new ut(a.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",target:"beExchangeAnyMulti.beExchangeAsset"});if(L.assetExchangeWeightRatio.toExchangeAssetWeight!==v.toExchangeAssetWeight||L.assetExchangeWeightRatio.beExchangeAssetWeight!==v.beExchangeAssetWeight)throw new ut(a.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:S,toExchangeAssetType:b})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(I.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"})}else if(v)throw new ut(a.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",target:"beExchangeAnyMulti.beExchangeAsset"});if(L.taxInformation){if(!$)throw new ut(a.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:S,toExchangeAssetType:b})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(I.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"});if(L.taxInformation.taxCollector!==$.taxCollector||L.taxInformation.taxAssetPrealnum!==$.taxAssetPrealnum)throw new ut(a.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:S,toExchangeAssetType:b})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(I.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"})}else if($)throw new ut(a.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.toExchangeAsset"})}if(n.beExchangeSource!==o.beExchangeSource||n.beExchangeChainName!==o.beExchangeChainName||n.beExchangeParentAssetType!==o.beExchangeParentAssetType||n.beExchangeAssetType!==o.beExchangeAssetType)throw new ut(a.NOT_MATCH,{to_compare_prop:`beExchangeAsset: ${JSON.stringify(n)}`,be_compare_prop:`beExchangeAsset: ${JSON.stringify(o.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"});const{beExchangeAssetPrealnum:u,beExchangeParentAssetType:g}=o,y=BigInt(u);if(e.senderId===e.recipientId){for(const I of i){const{toExchangeParentAssetType:T,toExchangeAssetPrealnum:S}=I;if(T===G.ASSETS){if(S==="0")throw new ut(a.PROP_SHOULD_GT_FIELD,{prop:`toExchangeAssetPrealnum ${S}`,field:"0",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.toExchangeAssets"})}else if(S!=="1")throw new ut(a.PROP_SHOULD_EQ_FIELD,{prop:`toExchangeAssetPrealnum ${S}`,field:"1",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.toExchangeAssets"})}if(u!=="0")throw new ut(a.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${u}`,field:"0",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"})}else if(g===G.ASSETS){let I=!1;for(const T of i){const{toExchangeParentAssetType:S,toExchangeAssetPrealnum:w,assetExchangeWeightRatio:b}=T;if(S!==G.ASSETS&&(I=!0),b){const R=this.jsbiHelper.multiplyRoundFraction(w,{numerator:b.beExchangeAssetWeight,denominator:b.toExchangeAssetWeight});if(R>y)throw new ut(a.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAssetPrealnum ${u}`,field:R.toString(),target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"})}if(w==="0"&&u==="0")throw new ut(a.PROP_SHOULD_GT_FIELD,{prop:`beExchangeAssetPrealnum ${u}`,field:"0",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"})}if(I&&n.beExchangeAssetPrealnum&&o.beExchangeAssetPrealnum&&BigInt(o.beExchangeAssetPrealnum)<BigInt(n.beExchangeAssetPrealnum))throw new ut(a.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAsset.beExchangeAssetPrealnum ${o.beExchangeAssetPrealnum}`,target:"beExchangeAnyMulti",field:n.beExchangeAssetPrealnum})}else if(u!=="1")throw new ut(a.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${u}`,field:"1",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"});if(s.length>0){if(!c)throw new ut(a.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMulti"});const{publicKey:I}=c;if(!s.includes(I))throw new ut(a.NOT_MATCH,{to_compare_prop:`publicKey ${I}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAnyMulti.ciphertextSignature",be_target:"toExchangeAnyMulti.cipherPublicKeys"})}else if(c)throw new ut(a.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMulti"});const{rangeType:m,range:d}=t;if(m&1){if(!d.includes(e.senderId))throw new ut(a.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAnyMultiTransaction",be_compare_prop:"beExchangeAnyMultiTransaction.range"})}else if(m&2){if(!e.dappid||!d.includes(e.dappid))throw new ut(a.SHOULD_BE,{to_compare_prop:`dappid ${e.senderId}`,to_target:"beExchangeAnyMultiTransaction",be_compare_prop:"beExchangeAnyMultiTransaction.range"})}else if(m&4&&(!e.lns||!d.includes(e.lns)))throw new ut(a.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAnyMultiTransaction",be_compare_prop:"beExchangeAnyMultiTransaction.range"})}__checkTrsFee(e){const t=this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length);if(BigInt(e.fee)<BigInt(t))throw new ut(a.TRANSACTION_FEE_NOT_ENOUGH,{errorId:Ce.TRANSACTION_FEE_NOT_ENOUGH,minFee:t,target:"transaction"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{transactionSignature:t,toExchangeAssets:r,beExchangeAsset:n}=e.asset.beExchangeAnyMulti,s=[t],{beExchangeParentAssetType:i,beExchangeAssetType:o}=n;for(const c of r){const{toExchangeParentAssetType:l,toExchangeAssetType:u,taxInformation:g}=c;(l===G.DAPP||l===G.LOCATION_NAME||l===G.ENTITY)&&(s.push(u),g&&s.push(g.taxCollector))}return(i===G.DAPP||i===G.LOCATION_NAME||i===G.ENTITY)&&(s.push(o),s.push(o),n.taxInformation&&s.push(n.taxInformation.taxCollector)),s}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],ru.prototype,"transactionCore",void 0),ru=p([j(),h("design:paramtypes",[St])],ru);var{ConsensusException:Na}=Z("VERIFIER","ToExchangeAnyMultiAllLogicVerifier"),ny=class extends Be{constructor(){super()}async verify(e,t,r,n,s){this.__checkTrsFee(e);const i=e.asset.toExchangeAnyMultiAll,{beExchangeAssets:o}=i,c=this.accountGetterHelper;for(const u of o){const{beExchangeSource:g,beExchangeChainName:y,beExchangeParentAssetType:m,beExchangeAssetType:d}=u;if(m===G.ASSETS)await this.helperLogicVerifier.isAssetExist(y,g,d);else if(m===G.DAPP){if(!await c.getDApp(g,d,t))throw new Na(a.DAPPID_IS_NOT_EXIST,{dappid:d})}else if(m===G.LOCATION_NAME){if(d.split(",").length>2)throw new Na(a.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(!await c.getLocationName(g,d,t))throw new Na(a.LOCATION_NAME_IS_NOT_EXIST,{locationName:d,errorId:Ce.LOCATION_NAME_NOT_EXIST})}else if(m===G.ENTITY){const I=await c.getEntity(g,d,t);if(!I)throw new Na(a.ENTITY_IS_NOT_EXIST,{entityId:d,errorId:Ce.ENTITY_NOT_EXIST});if(I.status===255)throw new Na(a.ENTITY_ALREADY_DESTROY,{entityId:d,reason:"Entity already be destroy"})}else throw new Na(a.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${m}`,target:"transaction.asset.toExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}await this.logicVerify(e,t,r);const{eventLogicVerifier:l}=this;return n===!1&&l.listenEvent(r,t,s),await l.awaitEventResult(e,s),!0}__checkTrsFee(e){const{toExchangeAssets:t,beExchangeAssets:r}=e.asset.toExchangeAnyMultiAll,n=this.transactionHelper.calcTransactionMinFeeByMulti(e,t.length+r.length);if(BigInt(e.fee)<BigInt(n))throw new Na(a.TRANSACTION_FEE_NOT_ENOUGH,{errorId:Ce.TRANSACTION_FEE_NOT_ENOUGH,minFee:n,target:"transaction"})}checkTrsFeeAndWebFee(e,t){const{toExchangeAssets:r,beExchangeAssets:n}=e.asset.toExchangeAnyMultiAll;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,r.length+n.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const{toExchangeAssets:n,beExchangeAssets:s}=e.asset.toExchangeAnyMultiAll;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,n.length+s.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{toExchangeAssets:t}=e.asset.toExchangeAnyMultiAll,r=[];for(const n of t){const{toExchangeParentAssetType:s,toExchangeAssetType:i}=n;(s===G.DAPP||s===G.LOCATION_NAME||s===G.ENTITY)&&r.push(i)}return r}};ny=p([j(),h("design:paramtypes",[])],ny);var{ConsensusException:wt,NoFoundException:kS}=Z("VERIFIER","BeExchangeAnyMultiAllLogicVerifier"),nu=class extends Be{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){this.__checkTrsFee(e);const i=e.asset.beExchangeAnyMultiAll,{transactionSignature:o}=i,c=await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!c)throw new kS(a.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});const l=(await this.transactionCore.recombineTransaction(c)).as(to,o);if(!l)throw new wt(a.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});if(e.recipientId!==l.senderId)throw new wt(a.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${l.senderId}`,to_target:"BeExchangeAnyMultiAllTransaction",be_target:"ToExchangeAnyMultiAllTransaction"});this.isDependentTransactionMatch(e,l),await this.logicVerify(e,t,r);const{eventLogicVerifier:u}=this;return n===!1&&u.listenEvent(r,t,s),await u.awaitEventResult(e,s),!0}isDependentTransactionMatch(e,t){const{toExchangeAssets:r,beExchangeAssets:n,cipherPublicKeys:s}=t.asset.toExchangeAnyMultiAll,{toExchangeAssets:i,beExchangeAssets:o,ciphertextSignature:c}=e.asset.beExchangeAnyMultiAll;if(r.length!==i.length)throw new wt(a.NOT_MATCH,{to_compare_prop:`toExchangeAssets.length: ${r.length}`,be_compare_prop:`toExchangeAssets.length: ${i.length}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(n.length!==o.length)throw new wt(a.NOT_MATCH,{to_compare_prop:`beExchangeAssets.length: ${n.length}`,be_compare_prop:`beExchangeAssets.length: ${o.length}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});const l={};for(const m of r){const{toExchangeSource:d,toExchangeChainName:I,toExchangeParentAssetType:T,toExchangeAssetType:S,toExchangeAssetPrealnum:w,taxInformation:b}=m;l[`${d}${S}`]={toExchangeChainName:I,toExchangeParentAssetType:T,toExchangeAssetPrealnum:w,taxInformation:b}}const u={};for(const m of n){const{beExchangeSource:d,beExchangeChainName:I,beExchangeParentAssetType:T,beExchangeAssetType:S,beExchangeAssetPrealnum:w,taxInformation:b}=m;u[`${d}${S}`]={beExchangeChainName:I,beExchangeParentAssetType:T,beExchangeAssetPrealnum:w,taxInformation:b}}for(const m of i){const{toExchangeSource:d,toExchangeChainName:I,toExchangeParentAssetType:T,toExchangeAssetType:S,toExchangeAssetPrealnum:w,taxInformation:b}=m,R=`${d}${S}`,v=l[R];if(!v)throw new wt(a.SHOULD_NOT_INCLUDE,{prop:"toExchangeAssets",target:"toExchangeAnyMultiAll",value:`toExchangeChainName ${I} toExchangeSource ${d} toExchangeAssetType ${S}`});const $={toExchangeSource:d,toExchangeChainName:v.toExchangeChainName,toExchangeParentAssetType:v.toExchangeParentAssetType,toExchangeAssetType:S};if(v.toExchangeChainName!==I||v.toExchangeParentAssetType!==T)throw new wt(a.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify($)}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(m.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(w!==v.toExchangeAssetPrealnum)throw new wt(a.PROP_SHOULD_EQ_FIELD,{prop:`toExchangeAssets.toExchangeAsset.toExchangeAssetPrealnum ${w}`,target:"beExchangeAnyMultiAll",field:v.toExchangeAssetPrealnum});if(v.taxInformation){if(!b)throw new wt(a.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify($)}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(m.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(v.taxInformation.taxCollector!==b.taxCollector||v.taxInformation.taxAssetPrealnum!==b.taxAssetPrealnum)throw new wt(a.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({...$,taxInformation:{taxCollector:b.taxCollector,taxAssetPrealnum:b.taxAssetPrealnum}})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(m.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"})}else if(b)throw new wt(a.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"beExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}for(const m of o){const{beExchangeSource:d,beExchangeChainName:I,beExchangeParentAssetType:T,beExchangeAssetType:S,beExchangeAssetPrealnum:w,taxInformation:b}=m,R=`${d}${S}`,v=u[R];if(!v)throw new wt(a.SHOULD_NOT_INCLUDE,{prop:"beExchangeAssets",target:"beExchangeAnyMultiAll",value:`beExchangeChainName ${I} beExchangeSource ${d} beExchangeAssetType ${S}`});const $={beExchangeSource:d,beExchangeChainName:v.beExchangeChainName,beExchangeParentAssetType:v.beExchangeParentAssetType,beExchangeAssetType:S};if(I!==v.beExchangeChainName||T!==v.beExchangeParentAssetType)throw new wt(a.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify($)}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(m.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(e.senderId===e.recipientId){if(w!=="0")throw new wt(a.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${w}`,field:"0",target:"beExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}else if(w!==v.beExchangeAssetPrealnum)throw new wt(a.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify($)}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(m.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(v.taxInformation){if(!b)throw new wt(a.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify($)}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(m.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(v.taxInformation.taxCollector!==b.taxCollector||v.taxInformation.taxAssetPrealnum!==b.taxAssetPrealnum)throw new wt(a.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify({...$,taxInformation:{taxCollector:b.taxCollector,taxAssetPrealnum:b.taxAssetPrealnum}})}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(m.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"})}else if(b)throw new wt(a.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"beExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}if(s.length>0){if(!c)throw new wt(a.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMultiAll"});const{publicKey:m}=c;if(!s.includes(m))throw new wt(a.NOT_MATCH,{to_compare_prop:`publicKey ${m}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAnyMultiAll.ciphertextSignature",be_target:"toExchangeAnyMultiAll.cipherPublicKeys"})}else if(c)throw new wt(a.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMultiAll"});const{rangeType:g,range:y}=t;if(g&1){if(!y.includes(e.senderId))throw new wt(a.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAnyMultiAllTransaction",be_compare_prop:"beExchangeAnyMultiAllTransaction.range"})}else if(g&2){if(!e.dappid||!y.includes(e.dappid))throw new wt(a.SHOULD_BE,{to_compare_prop:`dappid ${e.senderId}`,to_target:"beExchangeAnyMultiAllTransaction",be_compare_prop:"beExchangeAnyMultiAllTransaction.range"})}else if(g&4&&(!e.lns||!y.includes(e.lns)))throw new wt(a.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAnyMultiAllTransaction",be_compare_prop:"beExchangeAnyMultiAllTransaction.range"})}__checkTrsFee(e){const{toExchangeAssets:t,beExchangeAssets:r}=e.asset.beExchangeAnyMultiAll,n=this.transactionHelper.calcTransactionMinFeeByMulti(e,t.length+r.length);if(BigInt(e.fee)<BigInt(n))throw new wt(a.TRANSACTION_FEE_NOT_ENOUGH,{errorId:Ce.TRANSACTION_FEE_NOT_ENOUGH,minFee:n,target:"transaction"})}checkTrsFeeAndWebFee(e,t){const{toExchangeAssets:r,beExchangeAssets:n}=e.asset.beExchangeAnyMultiAll;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,r.length+n.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const{toExchangeAssets:n,beExchangeAssets:s}=e.asset.beExchangeAnyMultiAll;return this.isFeeEnough(e.signature,e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,n.length+s.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{transactionSignature:t,toExchangeAssets:r,beExchangeAssets:n}=e.asset.beExchangeAnyMultiAll,s=[t];for(const i of r){const{toExchangeParentAssetType:o,toExchangeAssetType:c,taxInformation:l}=i;(o===G.DAPP||o===G.LOCATION_NAME||o===G.ENTITY)&&(s.push(c),l&&s.push(l.taxCollector))}for(const i of n){const{beExchangeParentAssetType:o,beExchangeAssetType:c,taxInformation:l}=i;(o===G.DAPP||o===G.LOCATION_NAME||o===G.ENTITY)&&(s.push(c),s.push(c),l&&s.push(l.taxCollector))}return s}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],nu.prototype,"transactionCore",void 0),nu=p([j(),h("design:paramtypes",[St])],nu);var{ConsensusException:oA,NoFoundException:ow}=Z("VERIFIER","IssueCertificateLogicVerifier"),sy=class extends Be{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}checkCertificateOnChainHeight(e,t){const r=e.asset.issueCertificate.certificateId,n=Number(r.split(":")[0]);if(n<t)throw new oA(a.PROP_SHOULD_GTE_FIELD,{prop:`CertificateId on chain height ${n}`,target:"issueCertificate",field:t})}isCertificateOnChainHeight(e,t){const r=e.asset.issueCertificate.certificateId,n=Number(r.split(":")[0]);if(n!==t)throw new oA(a.SHOULD_BE,{to_compare_prop:`CertificateId on chain height ${n}`,to_target:"issueCertificate",be_compare_prop:t})}getLockData(e){return[e.type]}};sy=p([j(),Se(0,k(de)),Se(1,k(_e)),h("design:paramtypes",[de,_e])],sy);var{ConsensusException:cA}=Z("VERIFIER","TransactionLogicVerifier"),iy=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:i,sourceChainName:o,certificateId:c,type:l}=e.asset.destroyCertificate,u=await this.helperLogicVerifier.isCertificateExist(o,i,c,t);if(u.applyAddress!==e.recipientId)throw new cA(a.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"transaction",be_compare_prop:`certificate apply account address ${u.applyAddress}`});if(u.type!==l)throw new cA(a.NOT_MATCH,{to_compare_prop:`type ${l}`,be_compare_prop:`type ${u.type}`,to_target:"transaction",be_target:"issueCertificateTransaction"});await this.logicVerify(e,t,r);const{eventLogicVerifier:g}=this;return n===!1&&g.listenEvent(r,t,s),await g.awaitEventResult(e,s),!0}};iy=p([j(),h("design:paramtypes",[])],iy);var{ArgumentFormatException:LS}=Z("CONTROLLER","TransactionLogicVerifierCore"),$s=class{constructor(e,t,r,n,s,i,o){this.transactionHelper=e,this.accountBaseHelper=t,this.asymmetricHelper=r,this.keypairHelper=n,this.Buffer=s,this.config=i,this.moduleMap=o,this._txLogicVerifierCache=new Map}getTransactionLogicVerifier(e){let t=this._txLogicVerifierCache.get(e);return t||(t=At(e,this.moduleMap),this._txLogicVerifierCache.set(e,t)),t}getTransactionLogicVerifierFromType(e){const{baseType:t}=this.transactionHelper.parseType(e);return this.getTransactionLogicVerifierFromBaseType(t)}getTransactionLogicVerifierFromBaseType(e){const t=sn.KLV.get(e);if(!t)throw new LS(a.INVALID_BASE_TYPE,{base_type:e});return this.getTransactionLogicVerifier(t)}};$s=p([j("bfchain-core:TransactionLogicVerifierCore"),Se(3,k("keypairHelper")),Se(4,k("Buffer")),h("design:paramtypes",[_e,de,_r,Object,Object,re,je])],$s);var sn=(()=>{const e=new Map,t=new Map;return[[B.SIGNATURE,xd],[B.DAPP,Bd],[B.DAPP_PURCHASING,Hd],[B.MARK,kd],[B.ISSUE_ASSET,Ld],[B.INCREASE_ASSET,Md],[B.DESTROY_ASSET,Ud],[B.TRANSFER_ASSET,Dd],[B.TO_EXCHANGE_ASSET,Kd],[B.BE_EXCHANGE_ASSET,ql],[B.GIFT_ASSET,$d],[B.GRAB_ASSET,Yl],[B.TRUST_ASSET,Gd],[B.SIGN_FOR_ASSET,Ql],[B.EMIGRATE_ASSET,jd],[B.IMMIGRATE_ASSET,zd],[B.STAKE_ASSET,Jd],[B.UNSTAKE_ASSET,Wl],[B.LOCATION_NAME,Yd],[B.SET_LNS_RECORD_VALUE,Qd],[B.SET_LNS_MANAGER,Xd],[B.ISSUE_ENTITY_FACTORY,qd],[B.ISSUE_ENTITY_FACTORY_V1,Wd],[B.ISSUE_ENTITY,Zd],[B.DESTROY_ENTITY,eu],[B.ISSUE_ENTITY_MULTI,ey],[B.TRANSFER_ANY,Fd],[B.GIFT_ANY,Vd],[B.GRAB_ANY,Xl],[B.TO_EXCHANGE_ANY,ty],[B.BE_EXCHANGE_ANY,tu],[B.TO_EXCHANGE_ANY_MULTI,ry],[B.BE_EXCHANGE_ANY_MULTI,ru],[B.TO_EXCHANGE_ANY_MULTI_ALL,ny],[B.BE_EXCHANGE_ANY_MULTI_ALL,nu],[B.ISSUE_CERTIFICATE,sy],[B.DESTROY_CERTIFICATE,iy]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{KLV:e,LVK:t,trsTypeToV(r){const n=r.indexOf("-",r.indexOf("-")+1);return r.substr(n+1)}}})(),su=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}getLockData(e){return[e.type]}};su=p([j(),h("design:paramtypes",[])],su);var{NoFoundException:pA}=Z("VERIFIER","LogicHelper"),Nr=class{async getMacroCallTransaction(e){const{macroId:t,inputs:r}=e.asset.call,n=`${t}_${e.signature}`;let s=this.memoryCache.getCache(n);if(s===void 0){const i=await this.transactionGetterHelper.getMacroCallTransaction(t,r);if(!i)throw new pA(a.NOT_EXIST,{prop:`Macro call transaction with macroId ${t}`,target:"blockChain"});s=await this.transactionCore.recombineTransaction(i),this.memoryCache.setCache(n,s)}return s}async getPromiseTransaction(e){let t=this.memoryCache.getCache(e);if(t===void 0){const r=await this.transactionGetterHelper.getPromiseTransaction(e);if(!r)throw new pA(a.NOT_EXIST,{prop:`Promise transaction ${e}`,target:"blockChain"});t=await this.transactionCore.recombineTransaction(r),this.memoryCache.setCache(e,t)}return t}async getCheckRepeatInfo(e,t=!1){let r=0,n=e.applyBlockHeight;const s=[],i=async o=>{switch(o.type){case this.transactionHelper.MULTIPLE:{const c=o.asset.multiple.transactions;for(const l of c)await i(l);break}case this.transactionHelper.MACRO_CALL:{const c=await this.getMacroCallTransaction(o);await i(c);break}case this.transactionHelper.PROMISE:{if(t===!1){const c=o.asset.promise.transaction;await i(c)}break}case this.transactionHelper.PROMISE_RESOLVE:{const c=await this.getPromiseTransaction(o.asset.resolve.promiseId);await i(c);break}}n>o.applyBlockHeight&&(n=o.applyBlockHeight),r+=1,s.push(o.signature)};return await i(e),{minHeight:n,count:r,ids:s}}};p([k(Vo),h("design:type",Vo)],Nr.prototype,"memoryCache",void 0),p([k(_e),h("design:type",_e)],Nr.prototype,"transactionHelper",void 0),p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],Nr.prototype,"transactionCore",void 0),p([k("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),h("design:type",$s)],Nr.prototype,"transactionLogicVerifierCore",void 0),p([k("transactionGetterHelper",{dynamics:!0}),h("design:type",Object)],Nr.prototype,"transactionGetterHelper",void 0),Nr=p([j()],Nr);var{ConsensusException:hA}=Z("VERIFIER","MultipleLogicVerifier"),jo=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s);const{transactions:o}=e.asset.multiple;for(const c of o)await this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(c.type).verify(c,t,r,!0,s);return!0}checkTrsFeeAndWebFee(e,t){const r=super.checkTrsFeeAndWebFee(e,t);if(r.isFeeEnough===!1)return r;let n;const{transactions:s}=e.asset.multiple;for(const i of s)if(n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(i.type).checkTrsFeeAndWebFee(i,i.getBytes().length),n.isFeeEnough===!1)return n;return r}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=super.checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r);if(n.isFeeEnough===!1)return n;let s;const{transactions:i}=e.asset.multiple;for(const o of i)if(s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(o.type).checkTrsFeeAndMiningMachineFeeAndWebFee(o,o.getBytes().length,r),s.isFeeEnough===!1)return s;return n}checkTransactionBlobSize(e,t){const{maxBlockBlobSize:r}=this.configHelper,n=t===void 0||r<t?r:t,s=e.getBlobSize(!0);if(s>n)throw new hA(a.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${s}`,target:"transaction",field:n});const{transactions:i}=e.asset.multiple;for(const o of i)this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(o.type).checkTransactionBlobSize(o,t)}async checkRepeatInBlockChainTransaction(e,t,r=0){const{minHeight:n,count:s,ids:i}=await this.complexTransactionLogicHelper.getCheckRepeatInfo(e,r!==0);if(await this.transactionGetterHelper.countTransactionsInBlockChainBySignature(i,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(n,t))>(r===0?0:s))throw new hA(a.ALREADY_EXIST,{prop:`One of transactions with signatures [${i.slice(0,3).join(",")}${i.length>3?"...":""}]`,target:"blockChain"})}async checkSecondaryTransaction(e,t){const{transactions:r}=e.asset.multiple;for(const n of r){const s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type);s.checkSecondaryTransaction&&await s.checkSecondaryTransaction(n,t)}}checkCertificateOnChainHeight(e,t){const{transactions:r}=e.asset.multiple;for(const n of r){const s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type);s.checkCertificateOnChainHeight&&s.checkCertificateOnChainHeight(n,t)}}isCertificateOnChainHeight(e,t){const{transactions:r}=e.asset.multiple;for(const n of r){const s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type);s.isCertificateOnChainHeight&&s.isCertificateOnChainHeight(n,t)}}getLockData(e){const{transactions:t}=e.asset.multiple,r=[];for(const n of t){const s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type).getLockData(n);r.push(...s)}return[...new Set(r)]}};p([k(Nr),h("design:type",Nr)],jo.prototype,"complexTransactionLogicHelper",void 0),p([k("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),h("design:type",$s)],jo.prototype,"transactionLogicVerifierCore",void 0),jo=p([j(),h("design:paramtypes",[])],jo);var{ConsensusException:ay}=Z("VERIFIER","PromiseLogicVerifier"),zo=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const i=e.asset.promise.transaction,{signature:o}=i;if(await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t)))throw new ay(a.ALREADY_EXIST,{prop:`promiseTransaction ${o}`,target:"blockChain",errorId:Ce.TRANSACTION_IN_TRS});await this.logicVerify(e,t,r);const{eventLogicVerifier:c}=this;return n===!1&&c.listenEvent(r,t,s),await c.awaitEventResult(e,s),await this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(i.type).verify(i,t,r,!0,s),!0}checkTrsFeeAndWebFee(e,t){const r=super.checkTrsFeeAndWebFee(e,t);if(r.isFeeEnough===!1)return r;const n=e.asset.promise.transaction,s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type).checkTrsFeeAndWebFee(n,n.getBytes().length);return s.isFeeEnough===!1?s:r}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=super.checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r);if(n.isFeeEnough===!1)return n;const s=e.asset.promise.transaction,i=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(s.type).checkTrsFeeAndMiningMachineFeeAndWebFee(s,s.getBytes().length,r);return i.isFeeEnough===!1?i:n}checkTransactionBlobSize(e,t){const{maxBlockBlobSize:r}=this.configHelper,n=t===void 0||r<t?r:t,s=e.getBlobSize(!0);if(s>n)throw new ay(a.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${s}`,target:"transaction",field:n});const i=e.asset.promise.transaction;this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(i.type).checkTransactionBlobSize(i,t)}async checkRepeatInBlockChainTransaction(e,t,r=0){const{minHeight:n,count:s,ids:i}=await this.complexTransactionLogicHelper.getCheckRepeatInfo(e,r!==0);if(await this.transactionGetterHelper.countTransactionsInBlockChainBySignature(i,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(n,t))>(r===0?0:s))throw new ay(a.ALREADY_EXIST,{prop:`One of transactions with signatures [${i.slice(0,3).join(",")}${i.length>3?"...":""}]`,target:"blockChain"})}};p([k(Nr),h("design:type",Nr)],zo.prototype,"complexTransactionLogicHelper",void 0),p([k("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),h("design:type",$s)],zo.prototype,"transactionLogicVerifierCore",void 0),zo=p([j(),h("design:paramtypes",[])],zo);var{ConsensusException:Ni,NoFoundException:MS}=Z("VERIFIER","PromiseResolveLogicVerifier"),Oa=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s);const{promiseId:o,transaction:c}=e.asset.resolve,l=await this.transactionGetterHelper.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!l)throw new MS(a.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});const u=(await this.transactionCore.recombineTransaction(l)).as(ca,o);if(!u)throw new Ni(a.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});if(e.senderId!==u.recipientId)throw new Ni(a.NOT_MATCH,{to_compare_prop:`senderId ${e.senderId}`,be_compare_prop:`recipientId ${u.recipientId}`,to_target:"promiseResolveTransaction",be_target:"doPromiseTransaction"});if(e.recipientId!==u.senderId)throw new Ni(a.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${u.senderId}`,to_target:"promiseResolveTransaction",be_target:"doPromiseTransaction"});const g=await this.complexTransactionLogicHelper.getPromiseTransaction(o);if(Ne(c.getBytes())!==Ne(g.getBytes()))throw new Ni(a.NOT_MATCH,{to_compare_prop:`transaction with promiseId ${o}`,be_compare_prop:`transaction with promiseId ${o}`,to_target:"promiseResolveTransaction",be_target:"blockChain"});const y=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(c.type);if(c.applyBlockHeight>t)throw new Ni(a.NOT_BEGIN_RESOLVE_YET,{promiseId:o});if(c.effectiveBlockHeight<t)throw new Ni(a.ALREADY_EXPIRED,{prop:`promise transaction ${o}`,target:"blockChain"});return await y.verify(c,t,r,!0,s),!0}checkTrsFeeAndWebFee(e,t){const r=super.checkTrsFeeAndWebFee(e,t);if(r.isFeeEnough===!1)return r;const n=e.asset.resolve.transaction,s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type).checkTrsFeeAndWebFee(n,n.getBytes().length);return s.isFeeEnough===!1?s:r}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=super.checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r);if(n.isFeeEnough===!1)return n;const s=e.asset.resolve.transaction,i=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(s.type).checkTrsFeeAndMiningMachineFeeAndWebFee(s,s.getBytes().length,r);return i.isFeeEnough===!1?i:n}checkTransactionBlobSize(e,t){const{maxBlockBlobSize:r}=this.configHelper,n=t===void 0||r<t?r:t,s=e.getBlobSize(!0);if(s>n)throw new Ni(a.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${s}`,target:"transaction",field:n});const i=e.asset.resolve.transaction;this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(i.type).checkTransactionBlobSize(i,t)}async checkRepeatInBlockChainTransaction(e,t,r=0){const{minHeight:n,count:s,ids:i}=await this.complexTransactionLogicHelper.getCheckRepeatInfo(e,r!==0);if(await this.transactionGetterHelper.countTransactionsInBlockChainBySignature(i,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(n,t))>(r===0?0:s))throw new Ni(a.ALREADY_EXIST,{prop:`One of transactions with signatures [${i.slice(0,3).join(",")}${i.length>3?"...":""}]`,target:"blockChain"})}async checkSecondaryTransaction(e,t){const r=e.asset.resolve.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.checkSecondaryTransaction&&await n.checkSecondaryTransaction(r,t)}checkCertificateOnChainHeight(e,t){const r=e.asset.resolve.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.checkCertificateOnChainHeight&&n.checkCertificateOnChainHeight(r,t)}isCertificateOnChainHeight(e,t){const r=e.asset.resolve.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.isCertificateOnChainHeight&&n.isCertificateOnChainHeight(r,t)}getLockData(e){const{transaction:t,promiseId:r}=e.asset.resolve,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(t.type).getLockData(t);return n.push(r),[...new Set(n)]}};p([k(Nr),h("design:type",Nr)],Oa.prototype,"complexTransactionLogicHelper",void 0),p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],Oa.prototype,"transactionCore",void 0),p([k("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),h("design:type",$s)],Oa.prototype,"transactionLogicVerifierCore",void 0),Oa=p([j(),h("design:paramtypes",[])],Oa);var fh=class extends Be{constructor(){super()}async verify(e,t,r,n,s){await this.logicVerify(e,t,r);const{eventLogicVerifier:i}=this;return n===!1&&i.listenEvent(r,t,s),await i.awaitEventResult(e,s),!0}};p([k("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),h("design:type",$s)],fh.prototype,"transactionLogicVerifierCore",void 0),fh=p([j(),h("design:paramtypes",[])],fh);var{ConsensusException:dh,NoFoundException:DS}=Z("VERIFIER","MacroCallLogicVerifier"),va=class extends Be{constructor(){super()}async verify(e,t,r,n,s){const{macroId:i,inputs:o}=e.asset.call,c=await this.transactionGetterHelper.getTransactionBySignature(i,this.transactionHelper.calcTransactionQueryRange(t));if(!c)throw new DS(a.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${i}`,target:"blockChain"});const l=(await this.transactionCore.recombineTransaction(c)).as(ga,i);if(!l)throw new dh(a.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${i}`});this.isInputMatch(o,l.asset.macro.inputs);const u=await this.isTransactionMatch(i,e);await this.logicVerify(e,t,r);const{eventLogicVerifier:g}=this;return n===!1&&g.listenEvent(r,t,s),await g.awaitEventResult(e,s),await this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(u.type).verify(u,t,r,!0,s),!0}isInputMatch(e,t){const r=t.map(n=>n.name);for(const n in e)if(r.includes(n)===!1)throw new dh(a.SHOULD_NOT_EXIST,{prop:`input ${n}`,target:"inputs"})}async isTransactionMatch(e,t){const r=await this.complexTransactionLogicHelper.getMacroCallTransaction(t),n=t.asset.call.transaction;if(Ne(n.getBytes())!==Ne(r.getBytes()))throw new dh(a.NOT_MATCH,{to_compare_prop:`transaction with macroId ${e}`,be_compare_prop:`transaction with macroId ${e}`,to_target:"MacroCallTransaction",be_target:"blockChain"});return n}checkTrsFeeAndWebFee(e,t){const r=super.checkTrsFeeAndWebFee(e,t);if(r.isFeeEnough===!1)return r;const n=e.asset.call.transaction,s=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(n.type).checkTrsFeeAndWebFee(n,n.getBytes().length);return s.isFeeEnough===!1?s:r}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=super.checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r);if(n.isFeeEnough===!1)return n;const s=e.asset.call.transaction,i=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(s.type).checkTrsFeeAndMiningMachineFeeAndWebFee(s,s.getBytes().length,r);return i.isFeeEnough===!1?i:n}checkTransactionBlobSize(e,t){const{maxBlockBlobSize:r}=this.configHelper,n=t===void 0||r<t?r:t,s=e.getBlobSize(!0);if(s>n)throw new dh(a.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${s}`,target:"transaction",field:n});const i=e.asset.call.transaction;this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(i.type).checkTransactionBlobSize(i,t)}async checkRepeatInBlockChainTransaction(e,t,r=0){const{minHeight:n,count:s,ids:i}=await this.complexTransactionLogicHelper.getCheckRepeatInfo(e,r!==0);if(await this.transactionGetterHelper.countTransactionsInBlockChainBySignature(i,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(n,t))>(r===0?0:s))throw new dh(a.ALREADY_EXIST,{prop:`One of transactions with signatures [${i.slice(0,3).join(",")}${i.length>3?"...":""}]`,target:"blockChain"})}async checkSecondaryTransaction(e,t){const r=e.asset.call.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.checkSecondaryTransaction&&await n.checkSecondaryTransaction(r,t)}checkCertificateOnChainHeight(e,t){const r=e.asset.call.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.checkCertificateOnChainHeight&&n.checkCertificateOnChainHeight(r,t)}isCertificateOnChainHeight(e,t){const r=e.asset.call.transaction,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(r.type);n.isCertificateOnChainHeight&&n.isCertificateOnChainHeight(r,t)}getLockData(e){const{transaction:t,macroId:r}=e.asset.call,n=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(t.type).getLockData(t);return n.push(r),[...new Set(n)]}};p([k(Nr),h("design:type",Nr)],va.prototype,"complexTransactionLogicHelper",void 0),p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],va.prototype,"transactionCore",void 0),p([k("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),h("design:type",$s)],va.prototype,"transactionLogicVerifierCore",void 0),va=p([j(),h("design:paramtypes",[])],va),sn.KLV.set(B.REGISTER_CHAIN,su),sn.LVK.set(su,B.REGISTER_CHAIN),sn.KLV.set(B.MULTIPLE,jo),sn.LVK.set(jo,B.MULTIPLE),sn.KLV.set(B.PROMISE,zo),sn.LVK.set(zo,B.PROMISE),sn.KLV.set(B.PROMISE_RESOLVE,Oa),sn.LVK.set(Oa,B.PROMISE_RESOLVE),sn.KLV.set(B.MACRO,fh),sn.LVK.set(fh,B.MACRO),sn.KLV.set(B.MACRO_CALL,va),sn.LVK.set(va,B.MACRO_CALL);var{ArgumentIllegalException:yh,NoFoundException:FS,ConsensusException:US,info:lA}=Z("CONTROLLER","_blockbase"),uA=zp("generateBlock"),oy=class{transactionInBlockFromJSON(e){return Xt.fromObject(e)}async generateBlock(e,t,r,n,s,i,o,c=this.config){uA&&lA("begin generateBlock"),await this.generateBlockCore.generateBlockBefore(e,t,r,i);const l=this._generateBlock(e,t);return await this.generateBlockCore.generateBlockAfter(l,r,n,s,i,o,c),uA&&lA("finish generateBlock"),l}async replayBlock(e,t,r,n={},s=this.config){return await this.replayBlockCore.replayBlock(e,t,r,n,s)}async checkAssetChangeHash(e,t,r={}){let n=r.accountGetterHelper;if(!n&&(n=this.moduleMap.get("accountGetterHelper"),!n))throw new FS(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});const s=await n.getAccountsAssetsChange(e),i=await this.blockHelper.calcAssetChangeHash(s);if(i!==t)throw new US(a.NOT_MATCH,{to_compare_prop:`assetChangeHash ${t}`,be_compare_prop:`assetChangeHash ${i}`,to_target:"block",be_target:"calculate"})}verifyKeypair(e){if(!e)throw new yh(a.PARAM_LOST,{param:"keypair"});const t={target:"keypair"},{baseHelper:r}=this,{publicKey:n,secretKey:s}=e;if(!n)throw new yh(a.PROP_IS_REQUIRE,{prop:"publicKey",...t});if(!r.isValidPublicKey(n))throw new yh(a.PROP_IS_INVALID,{prop:`publicKey ${n}`,...t});if(!s)throw new yh(a.PROP_IS_REQUIRE,{param:"secretKey",...t});if(!r.isValidSecretKey(s))throw new yh(a.PROP_IS_INVALID,{prop:`secretKey ${s}`,...t})}async verifyBlockBody(e,t,r=this.config){this.commonBlockVerify.verifyBlockBody(e,t)}async verify(e,t=this.config){await this.verifyBlockCore.verify(e,t)}async generateSignature(e){return await this.blockHelper.generateSignature(e)}async isBlockAlreadyExist(e,t,r){await this.commonBlockVerify.isBlockAlreadyExist(e,t,r)}},{NoFoundException:cw,ArgumentException:$S}=Z("Core","BlockGeneratorCalculator"),In=class{constructor(e,t,r,n){this.config=e,this.timeHelper=t,this.blockHelper=r,this.accountBaseHelper=n,this.getAddressSeedMap=s=>new Gt(i=>{let o=0;for(let c=1;c<i.length;c++)o+=i.charCodeAt(c);return o*s%256})}async fastCalcGenerateBlockGenerator(e,t={}){let r;if("toTimestamp"in t)r=t.toTimestamp;else{const{nowTimestamp:n=this.timeHelper.getTimestamp()}=t;r=this.timeHelper.getTimestampBySlotNumber(this.timeHelper.getSlotNumberByTimestamp(n)+1)}if(e.timestamp>=r)throw new $S(`lastblock timestamp(${e.timestamp}) should not be greater than toTimestamp(${r})`);for await(const n of this.calcGenerateBlockGeneratorIterator(e,{toTimestamp:r,blockGetterHelper:t.blockGetterHelper,ignoreOfflineGeneraters:!0}))if(n.timestamp===r)return{address:n.address,timestamp:n.timestamp};throw new Error}async calcGenerateBlockGenerator(e,t){for await(const r of this.calcGenerateBlockGeneratorIterator(e,t))if(r.timestamp===t.toTimestamp)return r;throw new Error}async*calcGenerateBlockGeneratorIterator(e,t={}){const{toTimestamp:r=1/0,blockGetterHelper:n=this.blockHelper.blockGetterHelper,ignoreOfflineGeneraters:s,yieldSkip:i=1}=t,o=e.timestamp+this.config.forgeInterval;let c=o;const l=new Gt(()=>[]),u=[],g=e.height%this.config.blockPerRound,y=t.blockCache||{};for(let z=0;z<g;z++){const Y=e.height-z;u.push(y[Y]||await this.blockHelper.forceGetBlockByHeight(Y,n))}const m=Math.max(1,this.blockHelper.calcRoundEndHeight(this.blockHelper.calcRoundByHeight(e.height+1)-1)),d=y[m]||await this.blockHelper.forceGetBlockByHeight(m,n),I=this.blockHelper.calcRoundByHeight(d.height+1),T=z=>{const Y=(z-d.timestamp)/this.config.forgeInterval/this.config.blockPerRound;return Y%1===0&&Y>0?Y-1:Math.floor(Y)},S=z=>(z*this.config.blockPerRound+1)*this.config.forgeInterval+d.timestamp,w=y[e.height]||await this.blockHelper.forceGetBlockByHeight(e.height,n);if(s){if(!Number.isSafeInteger(r))throw new RangeError("toTimestamp must be an integer, when you ignore Offline Generaters.");const z=T(o),Y=T(r);Y>z&&(c=S(Y))}const b=d.height===1?d.asset.genesisAsset.nextRoundGenerators:d.asset.roundLastAsset.nextRoundGenerators,R=async z=>{const Y=new Set;if(z===0)for(const M of b)Y.add(M.address);else if(I-z<=1)for(const M of this.config.genesisBlock.asset.genesisAsset.nextRoundGenerators)Y.add(M.address);else for(const M of b)Y.add(M.address);const x=new Set;for(const M of u)T(M.timestamp)===z&&x.add(await this.accountBaseHelper.getAddressFromPublicKey(M.generatorPublicKeyBuffer));const H=[];for(const M of Y)x.has(M)||H.push(M);return H},v=w.signatureBuffer.reduce((z,Y)=>z+Y,0),$=z=>z.slice().sort((Y,x)=>{const H=this.getAddressSeedMap(v).forceGet(Y)-this.getAddressSeedMap(v).forceGet(x);return H===0?z.indexOf(Y)-z.indexOf(x):H}),D=z=>({address:z,timestamp:this.timeHelper.getTimestampBySlotNumber(this.timeHelper.getSlotNumberByTimestamp(c))});let L=0;for(;c<=r;){const z=T(c),Y=await R(z),x=(S(z+1)-c)/this.config.forgeInterval;Y.length>x&&(Y.length=x);const H=$(Y);let M;do{const F=H.shift();if(!F)break;i>1?(++L===i||c===r)&&(L=0,yield D(F)):yield D(F),(M||(M=l.forceGet(z))).push(F),c+=this.config.forgeInterval}while(H.length)}}async calcNextBlockGenerator(e){const t=e.timestamp+this.config.forgeInterval;for await(const r of this.calcGenerateBlockGeneratorIterator({timestamp:e.timestamp,height:e.height},{toTimestamp:t,blockCache:{[e.height]:e}}))if(r.timestamp===t)return r;throw new Error}};In=p([j(),h("design:paramtypes",[re,xt,ht,de])],In);var{ArgumentIllegalException:an,ConsensusException:gA}=Z("CONTROLLER","_blockbase"),ms=class{constructor(e,t,r,n){this.config=e,this.blockHelper=t,this.baseHelper=r,this.chainAssetInfoHelper=n}verifyBlockBody(e,t){const{baseHelper:r}=this;if(!e)throw new an(a.PARAM_LOST,{param:"body"});if(!t)throw new an(a.PARAM_LOST,{param:"asset"});const n={target:"body"};if(!r.isPositiveInteger(e.version))throw new an(a.PROP_IS_INVALID,{prop:`version ${e.version}`,type:"positive integer",...n});const s=e.height;if(!r.isPositiveInteger(s))throw new an(a.PROP_IS_INVALID,{prop:`height ${s}`,type:"positive integer",...n});if(s>1&&!e.previousBlockSignature)throw new an(a.PROP_IS_REQUIRE,{prop:"previousBlockSignature",...n});if(!r.isNaturalNumber(e.timestamp))throw new an(a.PROP_IS_INVALID,{prop:`timestamp ${e.timestamp}`,type:"positive integer or 0",...n});const i=e.remark;if(!i)throw new an(a.PROP_IS_REQUIRE,{prop:"remark",...n});if(r.getVariableType(i)!=="[object Object]")throw new an(a.PROP_IS_INVALID,{prop:"remark",...n});for(const o in i)if(!r.isString(i[o]))throw new an(a.PROP_IS_INVALID,{prop:"remark",...n});if(!i&&r.getVariableType(i)!=="[object Object]")throw new an(a.PARAM_LOST,{param:"remark",...n})}verifyBlockSize(e,t){const r=this.calcBlockSize(e,t);if(e.blockSize!==r)throw new an(a.NOT_MATCH,{to_compare_prop:`blockSize ${e.blockSize}`,be_compare_prop:`blockSize ${r}`,to_target:"block",be_target:"calculate"});const{maxBlockSize:n}=this.config;if(r>n)throw new an(a.PROP_SHOULD_LTE_FIELD,{prop:`block size ${r}`,target:"block",field:n})}verifyBlockBlobSize(e){const{maxBlockBlobSize:t}=this.config;if(e.blobSize>t)throw new an(a.PROP_SHOULD_LTE_FIELD,{prop:`block blob size ${e.blobSize}`,target:"block",field:t})}verifySignature(e){return this.blockHelper.verifyBlockSignature(e)}get canInsertTransaction(){return this.transactionCore.canCreateTransaction.bind(this.transactionCore)}calcBlockSize(e,t){const r=It.$type.fields.blockSize.id,n=o=>({value:o,size:o===0?0:new Is().uint32(r).uint32(o).finish().length}),s=e.blockSize;let i=s;if(i=e.getBytes(!1,!1,t).length+(e.signatureBuffer.length?0:66),e.generatorPublicKeyBuffer){const o=e.signSignatureBuffer&&e.signSignatureBuffer.length||0;i+=o?0:66}if(s!==i){let o=n(s);do{const c=n(i);if(c.size===o.size)break;i+=c.size-o.size,o=c}while(!0)}return i}async isBlockAlreadyExist(e,t,r){if(typeof r.getCountBlock!="function")throw new gA(a.PROP_IS_INVALID,{prop:"getCountBlock",target:"blockGetterHelper"});if(await r.getCountBlock({signature:e})>0)throw new gA(a.ALREADY_EXIST,{prop:`Block with signature ${e}`,target:"blockChain",errorId:`Block already exists: ${e} height: ${t}`})}};p([k("bfchain-core:TransactionCore"),h("design:type",Object)],ms.prototype,"transactionCore",void 0),p([ie,h("design:type",Object),h("design:paramtypes",[])],ms.prototype,"canInsertTransaction",null),ms=p([j(),h("design:paramtypes",[re,ht,Re,Le])],ms);var{ArgumentIllegalException:Vs,ArgumentFormatException:pw,ConsensusException:hw}=Z("CONTROLLER","_blockbase"),Jo=class{constructor(e,t,r,n,s,i,o,c,l){this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.asymmetricHelper=s,this.chainAssetInfoHelper=i,this.commonBlockVerify=o,this.accountBaseHelper=c,this.cryptoHelper=l}async verify(e,t=this.config){this.commonBlockVerify.verifyBlockBody(e,e.remark),await this.verifyBlockDerivativeInfo(e,t),await this.commonBlockVerify.verifySignature(e)}async verifyBlockDerivativeInfo(e,t=this.config){const r={target:"block"},{baseHelper:n}=this;if(e.height!==1&&!e.previousBlockSignature&&n.isValidBlockSignature(e.previousBlockSignature))throw new Vs(a.PROP_IS_INVALID,{prop:`previousBlockSignature ${e.previousBlockSignature}`,...r});if(!n.isNaturalNumber(e.numberOfTransactions))throw new Vs(a.PROP_IS_INVALID,{prop:`numberOfTransactions ${e.numberOfTransactions}`,type:"natural number",...r});if(!e.payloadHash)throw new Vs(a.PROP_IS_REQUIRE,{prop:`payloadHash ${e.payloadHash}`,...r});if(!n.isNaturalNumber(e.payloadLength))throw new Vs(a.PROP_IS_INVALID,{prop:`payloadLength ${e.payloadLength}`,type:"natural number",...r});if(e.magic!==t.magic)throw new Vs(a.NOT_MATCH,{to_compare_prop:`block.magic ${e.magic}`,be_compare_prop:`genesisBlock.magic ${t.magic}`,to_target:"block_body",be_target:"genesis_block",...r});if(!e.generatorPublicKey)throw new Vs(a.PROP_IS_REQUIRE,{prop:"generatorPublicKey",...r});if(!n.isValidPublicKey(e.generatorPublicKey))throw new Vs(a.PROP_IS_INVALID,{prop:`generatorPublicKey ${e.generatorPublicKey}`,type:"account publicKey",...r});if(!e.signature)throw new Vs(a.PROP_IS_REQUIRE,{prop:"signature",...r});if(!n.isValidSignature(e.signature))throw new Vs(a.PROP_IS_INVALID,{prop:`signature ${e.signature}`,type:"signature",...r});this.commonBlockVerify.verifyBlockSize(e),this.commonBlockVerify.verifyBlockBlobSize(e)}};p([k("bfchain-core:TransactionCore"),h("design:type",Object)],Jo.prototype,"transactionCore",void 0),Jo=p([j(),Se(8,k("cryptoHelper")),h("design:paramtypes",[ht,Re,re,Ms,_r,Le,ms,de,Object])],Jo);var{ConsensusException:fA}=Z("CONTROLLER","_blockbase"),mh=class{async applyTransaction(e,t,r){const n=r.type,s=this.transactionCore,i=s.transactionHelper;if(await s.getTransactionFactoryFromType(n).applyTransaction(r,e),n===i.MULTIPLE){const{transactions:o}=r.asset.multiple;for(const c of o)await this.applyTransaction(e,t,c)}else if(n===i.PROMISE_RESOLVE){const{promiseId:o}=r.asset.resolve,c=await t.getPromiseTransaction(o);if(!c)throw new fA(a.NOT_EXIST,{prop:`promise transaction ${o}`,target:"blockChain"});const l=await s.recombineTransaction(c),u=l.type;u===i.MULTIPLE||u===i.PROMISE_RESOLVE||u===i.MACRO_CALL?await this.applyTransaction(e,t,l):await s.getTransactionFactoryFromType(l.type).applyTransaction(l,e)}else if(n===i.MACRO_CALL){const{macroId:o,inputs:c}=r.asset.call,l=await t.getMacroCallTransaction(o,c);if(!l)throw new fA(a.NOT_EXIST,{prop:`macro transaction ${o}`,target:"blockChain"});const u=await s.recombineTransaction(l),g=u.type;g===i.MULTIPLE||g===i.PROMISE_RESOLVE||g===i.MACRO_CALL?await this.applyTransaction(e,t,u):await s.getTransactionFactoryFromType(u.type).applyTransaction(u,e)}}};p([k("bfchain-core:TransactionCore"),h("design:type",Object)],mh.prototype,"transactionCore",void 0),mh=p([j()],mh);var{ArgumentIllegalException:_h,ArgumentFormatException:lw,NoFoundException:cy,log:iu,info:dA,warn:yA,ConsensusException:mA}=Z("CONTROLLER","_blockbase"),Yo=zp("generateBlock"),Xo=class{constructor(e,t,r,n,s,i,o,c,l,u){this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.asymmetricHelper=s,this.blockGeneratorCalculator=i,this.commonBlockVerify=o,this.blockUtils=c,this.cryptoHelper=l,this.moduleMap=u}async generateBlockBefore(e,t,r,n){if(!e)throw new _h(a.PARAM_LOST,{param:"body"});if(!t)throw new _h(a.PARAM_LOST,{param:"asset"});if(!r)throw new _h(a.PARAM_LOST,{param:"transactions"});Yo&&iu("before generateBlock"),n&&await this._wrapBlockError(n.emit("beforeGenerateBlock",e),n,"beforeGenerateBlock",e)}async _wrapBlockError(e,t,r,n){if(e)try{return await e}catch(s){await t.emit("blockError",{type:`generateBlock/${r}`,error:s,blockBody:n})}}async generateBlockAfter(e,t,r,n,s,i,o=this.config){return e.magic=o.magic,await this.insertTransactions(e,t,r,n,s,i),Yo&&iu("before signatureBlock"),s&&await this._wrapBlockError(s.emit("beforeSignatureBlock",e),s,"beforeSignatureBlock",e),e.blockSize=this.commonBlockVerify.calcBlockSize(e),e.signatureBuffer=await this.asymmetricHelper.detachedSign(e.getBytes(!0,!0,!0),r.secretKey),n&&(e.signSignatureBuffer=await this.asymmetricHelper.detachedSign(e.getBytes(!1,!0,!0),n.secretKey)),Yo&&iu("before generatedBlock"),s&&await this._wrapBlockError(s.emit("generatedBlock",e),s,"generatedBlock",e),e}async insertTransactions(e,t,r,n,s=new li,i){if(!i&&(i=this.moduleMap.get("transactionGetterHelper"),!i))throw new cy(a.NOT_EXIST,{prop:"transactionGetterHelper",target:"moduleStroge"});if(!s.blockRewardsGetter)throw new cy(a.NOT_EXIST,{prop:"blockRewardsGetter",target:"eventEmitter"});const{transactionCore:o,blockUtils:c}=this,l=o.abortForbiddenTransaction,{height:u,generatorPublicKey:g,statisticInfo:y}=e,{maxBlockSize:m}=this.config;let d=this.config.maxBlockBlobSize;if(s.customMaxBlobSizeGetter){const v=s.customMaxBlobSizeGetter();d=v<d?v:d}const I=this.cryptoHelper.sha256();let T=0,S=0;const w=this.statisticsHelper.forceGetStatisticsInfoByBlock(s.taskname||`core-generate-${u}`,g,y),b=[],R=new Set;try{this.statisticsHelper.bindApplyTransactionEventEmiter(s,w);const v=new Gt(L=>0);Yo&&dA("begin insertTransactions");for await(const L of t){s.tIndexGetter&&(L.tIndex=await s.tIndexGetter(L)),Yo&&iu("insert transaction: %d / %d",L.tIndex,e.numberOfTransactions);try{const z=L.transaction,{type:Y,senderId:x,signature:H}=z;if(R.has(H))throw new mA(a.SHOULD_NOT_DUPLICATE,{prop:`transaction with signature ${H}`,target:`block with height ${e.height}`});if(R.add(H),!this.commonBlockVerify.canInsertTransaction(Y)){const X=ve.VK.get(ve.trsTypeToV(Y)),ye=new mA(a.DISABLED_INSERT_TRANSACTION,{trsName:X});if(l)throw ye;yA(ye)}b.push(L),L.height=e.height;const M=o.getTransactionFactoryFromType(Y);await M.beginDealTransaction(z,s),await c.applyTransaction(s,i,z),s.assetPrealnumGetter&&(L.assetPrealnum=await s.assetPrealnumGetter(L));const F=L.assetPrealnum;if(F){const X=`height ${L.height} tIndex ${L.tIndex} type ${Y} senderId ${x} ${z.recipientId?" recipientId "+z.recipientId:" "} signature ${L.transaction.signature}`,{remainAssetPrealnum:ye,frozenMainAssetPrealnum:Te}=F;if(BigInt(ye)<BigInt(0))throw new _h(a.PROP_IS_INVALID,{prop:`remainAssetPrealnum ${ye}`,target:"assetPrealnum",detail:X});if(BigInt(Te)<BigInt(0))throw new _h(a.PROP_IS_INVALID,{prop:`frozenMainAssetPrealnum ${Te}`,target:"assetPrealnum",detail:X})}L.signatureBuffer=await this.asymmetricHelper.detachedSign(L.getBytes(!0,!0),r.secretKey),n&&(L.signSignatureBuffer=await this.asymmetricHelper.detachedSign(L.getBytes(!1,!0),n.secretKey)),Object.freeze(L);const K=L.getBytes();I.update(K),T+=K.length,T>m*.95&&await s.emit("nearMaxPayloadLength",{payloadLength:T}),S+=L.transaction.getBlobSize(),S>d*.95&&await s.emit("nearMaxBlobSize",{blobSize:S}),await M.endDealTransaction(L,s)}catch(z){const Y=await s.emit("error",{error:z,type:"genesisBlock",transactionInBlock:L});if(Y&&Y.continue)continue;throw z}}Yo&&dA("finish insertTransactions"),e.reward=await s.blockRewardsGetter(u);const $=b.length;if(e.transactionInfo.offset=$,$>0)e.transactionInfo.startTindex=b[0].tIndex;else{if(!s.startTindexGetter)throw new cy(a.NOT_EXIST,{prop:"startTindexGetter",target:"eventEmitter"});e.transactionInfo.startTindex=await s.startTindexGetter()}e.transactionInfo.statisticInfo=w.toModel(),e.transactionInfo.payloadHashBuffer=await I.digest(),e.transactionInfo.payloadLength=T,e.transactionInfo.blobSize=S,e.transactionInfo.transactionInBlocks=b;const D=e.transactionInfo.statisticInfo.numberOfTransactions;e.transactionInfo.numberOfTransactions=D,s.has("finishedDealTransactions")&&(yA("@deprecated",'logic "finishedDealTransactions" '),await s.emit("finishedDealTransactions",e))}finally{w.unref(g)}return e}};p([k("bfchain-core:TransactionCore"),h("design:type",Object)],Xo.prototype,"transactionCore",void 0),Xo=p([j(),Se(8,k("cryptoHelper")),h("design:paramtypes",[ht,Re,re,Ms,_r,In,ms,mh,Object,je])],Xo);var{ArgumentIllegalException:Br,OutOfRangeException:VS,ArgumentFormatException:py,NoFoundException:Qo,log:au,info:ou,warn:_A,ConsensusException:Ah}=Z("CONTROLLER","_blockbase"),Oi=zp("generateBlock"),qo=class{constructor(e,t,r,n,s,i,o,c,l,u,g,y,m,d){this.blockHelper=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.config=s,this.statisticsHelper=i,this.asymmetricHelper=o,this.chainAssetInfoHelper=c,this.chainTimeHelper=l,this.blockGeneratorCalculator=u,this.moduleMap=g,this.commonBlockVerify=y,this.blockUtils=m,this.cryptoHelper=d}async _wrapBlockError(e,t,r,n){if(e)try{return await e}catch(s){t.emit("blockError",{type:`replayBlock/${r}`,error:s,blockBody:n})}}async replayBlock(e,t,r,n={},s=this.config){Oi&&ou("begin replayBlock");const{verifySignature:i,recordForkBlock:o}=n;if(!t)throw new Br(a.PARAM_LOST,{param:"transactions"});if(Oi&&au("before replayBlock"),r&&await this._wrapBlockError(r.emit("beforeGenerateBlock",e),r,"beforeGenerateBlock",e),this.blockHelper.verifyBlockVersion(e,s),e.height>1){const l=await this.blockHelper.forceGetBlockByHeight(e.height-1);if(e.previousBlockSignature!==l.signature){if(o){let I=n.blockGetterHelper;if(!I&&(I=this.moduleMap.get("blockGetterHelper"),!I))throw new Qo(a.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});await I.chainBlockFork(e,Qh.DIFFERENT_PRE_BLOCK_SIGNATURE)}throw new Br(a.NOT_MATCH,{to_compare_prop:`previousBlockSignature ${e.previousBlockSignature}`,be_compare_prop:`blockSignature ${e.signature}`,to_target:"block",be_target:"blockChain lastBlock"})}const u=this.chainTimeHelper,g=u.getSlotNumberByTimestamp(e.timestamp),y=u.getNextSlotNumberByTimestamp(l.timestamp);if(g<y)throw new Ah(a.PROP_SHOULD_GT_FIELD,{prop:`timestamp ${e.timestamp}`,target:"block",field:`lastBlock timestamp ${l.timestamp}`});const{address:m}=await this.blockGeneratorCalculator.calcGenerateBlockGenerator(l,{toTimestamp:e.timestamp}),d=await this.accountBaseHelper.getAddressFromPublicKeyString(e.generatorPublicKey);if(m!==d){const I=u.getSlotNumberByTimestamp(e.timestamp);throw new Ah(a.INVALID_BLOCK_GENERATOR,{reason:`lastBlock.timestamp: ${l.timestamp} lastBlock.height: ${l.height}, block.timestamp: ${e.timestamp} curTime: ${u.getTimeByTimestamp(e.timestamp)} signature${e.signature} height: ${e.height} slot ${I} ${m}  ${d} `})}}const c=await this.insertTransactionsForReplay(e,t,r,n,s);return Oi&&au("before signatureBlock"),r&&await this._wrapBlockError(r.emit("beforeSignatureBlock",e),r,"beforeSignatureBlock",e),this.commonBlockVerify.verifyBlockSize(e,c),this.commonBlockVerify.verifyBlockBlobSize(e),i&&await this.commonBlockVerify.verifySignature(e),Oi&&au("before generatedBlock"),r&&await this._wrapBlockError(r.emit("generatedBlock",e),r,"generatedBlock",e),Oi&&ou("finish replayBlock"),e}async insertTransactionsForReplay(e,t,r=new li,n,s=this.config){let i=n.transactionGetterHelper;if(!i&&(i=this.moduleMap.get("transactionGetterHelper"),!i))throw new Qo(a.NOT_EXIST,{prop:"transactionGetterHelper",target:"moduleStroge"});const{verifySignature:o,skipVerifyStatisticInfo:c,skipVerifyParticipation:l}=n,{height:u,signature:g,generatorPublicKeyBuffer:y,statisticInfo:m}=e,d=this.cryptoHelper.sha256();let I=0,T=0;const S=this.statisticsHelper.forceGetStatisticsInfoByBlock(r.taskname||`core-replay-${u}`,g),w=[],{transactionCore:b,asymmetricHelper:R,transactionHelper:v,baseHelper:$,blockUtils:D}=this,{GRAB_ASSET:L,SIGN_FOR_ASSET:z}=v,Y=b.abortForbiddenTransaction,x=new Set;if(!r.startTindexGetter)throw new Qo(a.NOT_EXIST,{prop:"startTindexGetter",target:"eventEmitter"});if(!r.tIndexGetter)throw new Qo(a.NOT_EXIST,{prop:"tIndexGetter",target:"eventEmitter"});if(!r.assetPrealnumGetter)throw new Qo(a.NOT_EXIST,{prop:"assetPrealnumGetter",target:"eventEmitter"});if(!r.blockRewardsGetter)throw new Qo(a.NOT_EXIST,{prop:"blockRewardsGetter",target:"eventEmitter"});const H=await r.startTindexGetter();if(e.startTindex!==H)throw new Br(a.NOT_MATCH,{to_compare_prop:`startTindex ${e.startTindex}`,be_compare_prop:`startTindex ${H}`,to_target:"block",be_target:"calculate"});const M=new Map;try{this.statisticsHelper.bindApplyTransactionEventEmiter(r,S),Oi&&ou("begin insertTransactionsForReplay");for await(const le of t){const ge=r.tIndexGetter(le);Oi&&au("insert transaction: %d / %d",le.tIndex+1,e.numberOfTransactions);try{if(le.tIndex!==ge)throw new VS(a.NOT_MATCH,{to_compare_prop:`tIndex ${le.tIndex}`,be_compare_prop:`tIndex ${ge}`,to_target:"transactionInBlock",be_target:"calculate"});const N=le.transaction,{type:oe,senderId:pe,storageValue:xe,signature:ce}=N;if(x.has(ce))throw new Ah(a.SHOULD_NOT_DUPLICATE,{prop:`transaction with signature ${ce}`,target:`block with height ${e.height}`});if(x.add(ce),!this.commonBlockVerify.canInsertTransaction(oe)){const ae=ve.VK.get(ve.trsTypeToV(oe)),se=new Ah(a.DISABLED_INSERT_TRANSACTION,{trsName:ae});if(Y)throw se;_A(se)}if(w.push(le.getBytes()),xe&&(oe===L||oe===z)){const ae=M.get(xe);if(ae){for(const se of ae)if(se.senderId===pe)throw new Ah(a.SHOULD_NOT_INCLUDE,{prop:"Transactions",target:`block with height ${u}`,value:`transaction with storageValue ${xe}`});ae.push(N)}else M.set(xe,[N])}const q=b.getTransactionFactoryFromType(oe);if(await q.beginDealTransaction(N,r),await D.applyTransaction(r,i,N),!c){const ae=le.assetPrealnum;if(ae){const se=await r.assetPrealnumGetter(le);if(!se)throw new Br(a.NOT_FOUND,{prop:`transaction assetPrealnum ${ce}`,target:"blockChain"});if(se.remainAssetPrealnum!==ae.remainAssetPrealnum)throw new Br(a.NOT_MATCH,{to_compare_prop:`assetPrealnum.remainAssetPrealnum ${JSON.stringify(ae.remainAssetPrealnum)}`,be_compare_prop:`assetPrealnum.remainAssetPrealnum ${JSON.stringify(se.remainAssetPrealnum)}`,to_target:`transactionInBlock ${pe} ${ce}`,be_target:"calculate"});if(se.frozenMainAssetPrealnum!==ae.frozenMainAssetPrealnum)throw new Br(a.NOT_MATCH,{to_compare_prop:`assetPrealnum.frozenMainAssetPrealnum ${JSON.stringify(ae.frozenMainAssetPrealnum)}`,be_compare_prop:`assetPrealnum.frozenMainAssetPrealnum ${JSON.stringify(se.frozenMainAssetPrealnum)}`,to_target:`transactionInBlock ${pe} ${ce}`,be_target:"calculate"})}}if(o){if(!await R.detachedVeriy(le.getBytes(!0,!0),le.signatureBuffer,y))throw new py("Invalid transactionInBlock signature: %O",le.toJSON());if(e.generatorSecondPublicKeyBuffer){if(!le.signSignatureBuffer)throw new py(a.PROP_IS_REQUIRE,{prop:"signSignature",target:"transactionInBlock"});if(!await R.detachedVeriy(le.getBytes(!1,!0),le.signSignatureBuffer,e.generatorSecondPublicKeyBuffer))throw new py("Invalid transactionInBlock signSignature: %O",le.toJSON())}}Object.freeze(le);const ee=le.getBytes();d.update(ee),I+=ee.length,T+=le.transaction.getBlobSize(),await q.endDealTransaction(le,r)}catch(N){const oe=await r.emit("error",{error:N,type:"replayBlock",transactionInBlock:le});if(oe&&oe.continue)continue;throw N}}Oi&&ou("finish insertTransactionsForReplay");const F=await r.blockRewardsGetter(u);if(e.reward!==F)throw new Br(a.NOT_MATCH,{to_compare_prop:`blockReward ${e.reward}`,be_compare_prop:`expectedReward ${F}`,to_target:"block",be_target:"calculate"});const K=w.length;if(e.offset!==K)throw new Br(a.NOT_MATCH,{to_compare_prop:`offset ${e.offset}`,be_compare_prop:`offset ${K}`,to_target:"block",be_target:"calculate"});if(e.payloadLength!==I)throw new Br(a.NOT_MATCH,{to_compare_prop:`payloadLength ${e.payloadLength}`,be_compare_prop:`payloadLength ${I}`,to_target:"block",be_target:"calculate"});if(e.blobSize!==T)throw new Br(a.NOT_MATCH,{to_compare_prop:`blobSize ${e.blobSize}`,be_compare_prop:`blobSize ${T}`,to_target:"block",be_target:"calculate"});const X=await d.digest("hex");if(e.payloadHash!==X)throw new Br(a.NOT_MATCH,{to_compare_prop:`payloadHashHex ${e.payloadHash}`,be_compare_prop:`payloadHashHex ${X}`,to_target:"block",be_target:"calculate"});const ye=S.toModel(),Te=ye.numberOfTransactions;if(e.numberOfTransactions!==Te)throw new Br(a.NOT_MATCH,{to_compare_prop:`numberOfTransactions ${e.numberOfTransactions}`,be_compare_prop:`numberOfTransactions ${Te}`,to_target:"block",be_target:"calculate"});if(!c){if(!this.baseHelper.isArrayEqual(m.getBytes(),ye.getBytes()))throw new Br(a.NOT_MATCH,{to_compare_prop:`statisticsInfo ${JSON.stringify(m.toJSON())}`,be_compare_prop:`statisticsInfo ${JSON.stringify(ye.toJSON())}`,to_target:"block",be_target:"calculate"});const le=S.totalAsset,ge=S.totalFee;if(BigInt(e.totalAmount)!==le)throw new Br(a.NOT_MATCH,{to_compare_prop:`totalAmount ${e.totalAmount}`,be_compare_prop:`totalAmount ${le.toString()}`,to_target:"block",be_target:"calculate"});if(BigInt(e.totalFee)!==ge)throw new Br(a.NOT_MATCH,{to_compare_prop:`totalFee ${e.totalFee}`,be_compare_prop:`totalFee ${ge.toString()}`,to_target:"block",be_target:"calculate"});e.transactionInfo.transactionInBlockBufferList=w}r.has("finishedDealTransactions")&&(_A("@deprecated",'logic "finishedDealTransactions" '),await r.emit("finishedDealTransactions",e))}finally{S.unref(e.signature)}return w}};p([k("bfchain-core:TransactionCore"),h("design:type",Object)],qo.prototype,"transactionCore",void 0),qo=p([j(),Se(13,k("cryptoHelper")),h("design:paramtypes",[ht,de,_e,Re,re,Ms,_r,Le,xt,In,je,ms,mh,Object])],qo);var cu=class extends oy{constructor(e,t,r,n,s,i,o,c,l,u,g,y){super(),this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.asymmetricHelper=s,this.cryptoHelper=i,this.blockGeneratorCalculator=o,this.commonBlockVerify=c,this.verifyBlockCore=l,this.generateBlockCore=u,this.replayBlockCore=g,this.moduleMap=y}async fromJSON(e,t){const r=go.fromObject(e);return t&&t.verify&&await this.verify(r,t.config),r}async verifyBlockBody(e,t,r=this.config){await super.verifyBlockBody(e,t,r)}_generateBlock(e,t){const r=go.fromObject({...e,asset:t});return r.reward=this.config.basicRewards,r}async replayBlock(e,t,r,n={},s=this.config){return await super.replayBlock(e,t,r,n,s),n.verifyAsset&&await this.checkAssetChangeHash(e.height,e.asset.commonAsset.assetChangeHash,n),e}};p([k("bfchain-core:TransactionCore"),h("design:type",Object)],cu.prototype,"transactionCore",void 0),cu=p([j(),Se(5,k("cryptoHelper")),h("design:paramtypes",[ht,Re,re,Ms,_r,Object,In,ms,Jo,Xo,qo,je])],cu);var{ArgumentIllegalException:He}=Z("CONTROLLER","GenesisBlockFactory"),pu=class extends oy{constructor(e,t,r,n,s,i,o,c,l,u,g,y,m){super(),this.blockHelper=e,this.accountBaseHelper=t,this.baseHelper=r,this.config=n,this.statisticsHelper=s,this.asymmetricHelper=i,this.cryptoHelper=o,this.blockGeneratorCalculator=c,this.commonBlockVerify=l,this.verifyBlockCore=u,this.generateBlockCore=g,this.replayBlockCore=y,this.moduleMap=m}async fromJSON(e,t){const r=oa.fromObject(e);return t&&t.verify&&await this.verify(r,t.config),r}async verifyBlockBody(e,t,r=this.config){await super.verifyBlockBody(e,t);const{baseHelper:n}=this,s=t.genesisAsset;if(!s)throw new He(a.PARAM_LOST,{param:"genesisBlock"});const i={target:"genesisBlock"},o=s.assetType;if(!o)throw new He(a.PROP_IS_REQUIRE,{prop:"assetType",...i});if(!n.isValidAssetType(o))throw new He(a.PROP_IS_INVALID,{prop:`assetType ${s.assetType}`,...i});const c=s.chainName;if(!c)throw new He(a.PROP_IS_REQUIRE,{prop:"chainName",...i});if(!n.isValidChainName(c))throw new He(a.PROP_IS_INVALID,{prop:`chainName ${s.chainName}`,...i});const l=s.magic;if(!l)throw new He(a.PROP_IS_REQUIRE,{prop:"magic",...i});if(!n.isValidChainMagic(l))throw new He(a.PROP_IS_INVALID,{prop:`magic ${s.magic}`,...i});const u=s.bnid;if(!u)throw new He(a.PROP_IS_REQUIRE,{prop:"bnid",...i});if(u!==Yh.TESTNET&&u!==Yh.MAINNET)throw new He(a.SHOULD_BE,{to_compare_prop:`bnid ${u}`,to_target:"remark",be_compare_prop:"BNID_TYPE",...i});if(!n.isPositiveInteger(s.beginEpochTime))throw new He(a.PROP_IS_INVALID,{prop:`beginEpochTime ${s.beginEpochTime}`,...i});const g=s.genesisLocationName;if(!g)throw new He(a.PROP_IS_REQUIRE,{prop:"genesisLocationName",...i});if(!n.isValidLocationName(g,r.chainName))throw new He(a.PROP_IS_INVALID,{prop:`genesisLocationName ${s.genesisLocationName}`,...i});if(!s.genesisAmount)throw new He(a.PROP_IS_REQUIRE,{prop:"genesisAmount",...i});if(!n.isValidAssetNumber(s.genesisAmount))throw new He(a.PROP_IS_INVALID,{prop:`genesisAmount ${s.genesisAmount}`,...i});if(!s.maxSupply)throw new He(a.PROP_IS_REQUIRE,{prop:"maxSupply",...i});if(!n.isValidAssetNumber(s.maxSupply))throw new He(a.PROP_IS_INVALID,{prop:`maxSupply ${s.maxSupply}`,...i});if(BigInt(s.maxSupply)<BigInt(s.genesisAmount))throw new He(a.PROP_SHOULD_GTE_FIELD,{prop:"maxSupply",...i,field:s.genesisAmount});if(!n.isPositiveFloatContainZero(s.minTransactionFeePerByte))throw new He(a.PROP_IS_INVALID,{prop:`minTransactionFeePerByte ${s.minTransactionFeePerByte}`,...i});if(!n.isPositiveInteger(s.maxTPSPerBlock))throw new He(a.PROP_IS_INVALID,{prop:`maxTPSPerBlock ${s.maxTPSPerBlock}`,...i});if(!n.isPositiveInteger(s.maxTransactionSize))throw new He(a.PROP_IS_INVALID,{prop:`maxTransactionSize ${s.maxTransactionSize}`,...i});if(s.maxTransactionBlobSize===void 0)throw new He(a.PROP_IS_REQUIRE,{prop:`maxTransactionBlobSize ${s.maxTransactionBlobSize}`,...i});if(!n.isNaturalNumber(s.maxTransactionBlobSize))throw new He(a.PROP_IS_INVALID,{prop:`maxTransactionBlobSize ${s.maxTransactionBlobSize}`,...i});if(!n.isPositiveInteger(s.maxBlockSize))throw new He(a.PROP_IS_INVALID,{prop:`maxBlockSize ${s.maxBlockSize}`,...i});if(s.maxBlockBlobSize===void 0)throw new He(a.PROP_IS_REQUIRE,{prop:`maxBlockBlobSize ${s.maxBlockBlobSize}`,...i});if(!n.isNaturalNumber(s.maxBlockBlobSize))throw new He(a.PROP_IS_INVALID,{prop:`maxBlockBlobSize ${s.maxBlockBlobSize}`,...i});if(!n.isNaturalNumber(s.consessusBeforeSyncBlockDiff))throw new He(a.PROP_IS_INVALID,{prop:`consessusBeforeSyncBlockDiff ${s.consessusBeforeSyncBlockDiff}`,...i});if(!n.isPositiveInteger(s.maxGrabTimesOfGiftAsset))throw new He(a.PROP_IS_INVALID,{prop:`maxGrabTimesOfGiftAsset ${s.maxGrabTimesOfGiftAsset}`,...i});if(!s.issueAssetMinChainAsset)throw new He(a.PROP_IS_REQUIRE,{prop:"issueAssetMinChainAsset",...i});if(!n.isValidAssetNumber(s.issueAssetMinChainAsset))throw new He(a.PROP_IS_INVALID,{prop:`issueAssetMinChainAsset ${s.issueAssetMinChainAsset}`,...i});if(!s.maxMultipleOfAssetAndMainAsset)throw new He(a.PROP_IS_REQUIRE,{prop:"maxMultipleOfAssetAndMainAsset",...i});if(!n.isPositiveBigFloatNotContainZero(s.maxMultipleOfAssetAndMainAsset))throw new He(a.PROP_IS_INVALID,{prop:`maxMultipleOfAssetAndMainAsset ${s.maxMultipleOfAssetAndMainAsset}`,...i});if(!s.issueEntityFactoryMinChainAsset)throw new He(a.PROP_IS_REQUIRE,{prop:"issueEntityFactoryMinChainAsset",...i});if(!n.isValidAssetNumber(s.issueEntityFactoryMinChainAsset))throw new He(a.PROP_IS_INVALID,{prop:`issueEntityFactoryMinChainAsset ${s.issueEntityFactoryMinChainAsset}`,...i});if(!s.maxMultipleOfEntityAndMainAsset)throw new He(a.PROP_IS_REQUIRE,{prop:"maxMultipleOfEntityAndMainAsset",...i});if(!n.isPositiveBigFloatNotContainZero(s.maxMultipleOfEntityAndMainAsset))throw new He(a.PROP_IS_INVALID,{prop:`maxMultipleOfEntityAndMainAsset ${s.maxMultipleOfEntityAndMainAsset}`,...i});if(!s.registerChainMinChainAsset)throw new He(a.PROP_IS_REQUIRE,{prop:`registerChainMinChainAsset ${s.registerChainMinChainAsset}`,...i});if(!n.isValidAssetNumber(s.registerChainMinChainAsset))throw new He(a.PROP_IS_INVALID,{prop:`registerChainMinChainAsset ${s.registerChainMinChainAsset}`,...i});if(!n.isPositiveInteger(s.maxApplyAndConfirmedBlockHeightDiff))throw new He(a.PROP_IS_INVALID,{prop:`maxApplyAndConfirmedBlockHeightDiff ${s.maxApplyAndConfirmedBlockHeightDiff}`,...i});const{blockPerRound:y,forgeInterval:m,basicRewards:d,whetherToAllowGeneratorContinusElections:I}=s;if(!n.isPositiveInteger(y))throw new He(a.PROP_IS_INVALID,{prop:`blockPerRound ${y}`,...i});if(!d)throw new He(a.PROP_IS_REQUIRE,{prop:"maxSupply",...i});if(!n.isValidAssetNumber(d))throw new He(a.PROP_IS_INVALID,{prop:`basicRewards ${d}`,...i});if(!n.isBoolean(I))throw new He(a.PROP_IS_INVALID,{prop:`whetherToAllowGeneratorContinusElections ${I}`,...i});if(!n.isPositiveInteger(m))throw new He(a.PROP_IS_INVALID,{prop:`forgeInterval ${m}`,...i});if(m<5)throw new He(a.PROP_SHOULD_GTE_FIELD,{prop:`forgeInterval ${m}`,field:5,...i});if(!s.ports)throw new He(a.PROP_IS_REQUIRE,{prop:"ports",...i});if(!n.isValidChainPorts(s.ports))throw new He(a.PROP_IS_INVALID,{prop:`ports ${s.ports}`,...i});if(!s.assetChangeHash)throw new He(a.PROP_IS_REQUIRE,{prop:"assetChangeHash",...i});if(!n.isValidAssetChangeHash(s.assetChangeHash))throw new He(a.PROP_IS_INVALID,{prop:`assetChangeHash ${s.assetChangeHash}`,...i});const{nextRoundGenerators:T}=s;if(!T)throw new He(a.PROP_IS_REQUIRE,{prop:"nextRoundGenerators",...i});if(!n.isArray(T))throw new He(a.SHOULD_BE,{to_compare_prop:"nextRoundGenerators",to_target:"genesisBlock",be_compare_prop:"array",...i});if(T.length!==s.blockPerRound)throw new He(a.NOT_MATCH,{to_compare_prop:`nextRoundGenerators's length ${T.length}`,to_target:"genesisBlock",be_compare_prop:`blockPerRound: ${r.blockPerRound}`,be_target:"genesisBlock"});for(let S=0;S<T.length;S++){const w=T[S];if(!await this.accountBaseHelper.isAddress(w.address))throw new He(a.NOT_EXIST,{prop:`genesisBlock.nextRoundGenerators[${S}].address ${w.address}`,target:"genesisBlock.newGenerators"});if(!this.baseHelper.isNaturalNumber(w.numberOfForgeEntities))throw new He(a.PROP_IS_INVALID,{prop:`nextRoundGenerators[${S}].numberOfForgeEntities ${w.numberOfForgeEntities}`,target:"genesisBlock.nextRoundGenerators"})}}_generateBlock(e,t){const r=oa.fromObject({...e,asset:t});return r.generatorPublicKey=e.generatorPublicKey,r.reward="0",r}async replayBlock(e,t,r,n={},s=this.config){return await super.replayBlock(e,t,r,n,s),n.verifyAsset&&await this.checkAssetChangeHash(e.height,e.asset.genesisAsset.assetChangeHash,n),e}};p([k("bfchain-core:TransactionCore"),h("design:type",Object)],pu.prototype,"transactionCore",void 0),pu=p([j(),Se(6,k("cryptoHelper")),h("design:paramtypes",[ht,de,Re,re,Ms,_r,Object,In,ms,Jo,Xo,qo,je])],pu);var{ArgumentIllegalException:AA,ConsensusException:hu,NoFoundException:IA}=Z("CONTROLLER","RoundLastBlockFactory"),lu=class extends oy{constructor(e,t,r,n,s,i,o,c,l,u,g,y){super(),this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.asymmetricHelper=s,this.cryptoHelper=i,this.blockGeneratorCalculator=o,this.commonBlockVerify=c,this.verifyBlockCore=l,this.generateBlockCore=u,this.replayBlockCore=g,this.moduleMap=y}async fromJSON(e,t){const r=fo.fromObject(e);return t&&t.verify&&await this.verify(r,t.config),r}async verifyBlockBody(e,t,r=this.config){await super.verifyBlockBody(e,t,r);const n=t.roundLastAsset,s={target:"roundLastBlockAsset"},{baseHelper:i}=this;if(!n.nextRoundGenerators)throw new AA(a.PROP_IS_REQUIRE,{prop:"nextRoundGenerators",...s});if(!i.isValidChainOnChainHash(n.chainOnChainHash))throw new AA(a.PROP_IS_INVALID,{prop:`chainOnChainHash ${n.chainOnChainHash}`,type:"chainOnChainHash",...s})}_generateBlock(e,t){const r=fo.fromObject({...e,asset:t});return r.reward=this.config.basicRewards,r}async replayBlock(e,t,r,n={},s=this.config){if(await super.replayBlock(e,t,r,n,s),n.verifyAsset){const{height:i,asset:o}=e;let c=n.transactionGetterHelper;if(!c&&(c=this.moduleMap.get("transactionGetterHelper"),!c))throw new IA(a.NOT_EXIST,{prop:"transactionGetterHelper",target:"moduleStroge"});const l=o.roundLastAsset;let u=n.blockGetterHelper;if(!u&&(u=this.moduleMap.get("blockGetterHelper"),!u))throw new IA(a.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});await this.checkAssetChangeHash(i,l.assetChangeHash,n),await this.__checkChainOnChainHash(i,l.chainOnChainHash,u),await this.__checkNextRoundGenerators(e,u)}return e}async __checkChainOnChainHash(e,t,r){const n=await this.blockHelper.calcChainOnChainHash(e,r);if(n!==t)throw new hu(a.NOT_MATCH,{to_compare_prop:`chainOnChainHash ${t}`,be_compare_prop:`chainOnChainHash ${n}`,to_target:"block",be_target:"calculate"})}async __checkNextRoundGenerators(e,t){const r=await t.getNextRoundGenerators(await t.getLastBlock(),e.generatorPublicKey),n=e.asset.roundLastAsset.nextRoundGenerators,s=r.length;if(s!==n.length)throw new hu(a.NOT_MATCH,{to_compare_prop:`nextRoundGenerators length ${n.length}`,be_compare_prop:`nextRoundGenerators length ${r.length}`,to_target:"block remark",be_target:"calculate"});for(let i=0;i<s;i++){const{address:o,numberOfForgeEntities:c}=r[i],l=n[i];if(l.address!==o)throw new hu(a.NOT_MATCH,{to_compare_prop:`nextRoundGenerators index ${i} address ${l.address}`,be_compare_prop:`nextRoundGenerators index ${i} address ${o}`,to_target:"block remark",be_target:"calculate"});if(l.numberOfForgeEntities!==c)throw new hu(a.NOT_MATCH,{to_compare_prop:`nextRoundGenerators index ${i} address ${l.address} numberOfForgeEntities ${l.numberOfForgeEntities}`,be_compare_prop:`nextRoundGenerators index ${i} address ${o} numberOfForgeEntities ${c}`,to_target:"block remark",be_target:"calculate"})}}};p([k("bfchain-core:TransactionCore"),h("design:type",Object)],lu.prototype,"transactionCore",void 0),lu=p([j(),Se(5,k("cryptoHelper")),h("design:paramtypes",[ht,Re,re,Ms,_r,Object,In,ms,Jo,Xo,qo,je])],lu);var{NoFoundException:lr}=Z("helper-account","accountHelper"),uu=class{getAccounts(e,t,r=this.accountGetterHelper){if(!r)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAccounts(e,t)}getNextRoundGenerators(e=this.accountGetterHelper){if(!e&&!e)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return e.getNextRoundGenerators()}getAccountInfo(e,t,r=this.accountGetterHelper){if(!r)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAccountInfo(e,t)}getAccountTxCountInBlock(e,t=this.accountGetterHelper){if(!t)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getAccountTxCountInBlock(e)}getDApp(e,t,r,n=this.accountGetterHelper){if(!n)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return n.getDApp(e,t,r)}isDAppPossessor(e,t,r=this.accountGetterHelper){if(!r)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.isDAppPossessor(e,t)}getLocationName(e,t,r,n=this.accountGetterHelper){if(!n)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return n.getLocationName(e,t,r)}isLocationNamePossessor(e,t,r=this.accountGetterHelper){if(!r)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.isLocationNamePossessor(e,t)}isSubLocationNameExist(e,t,r=this.accountGetterHelper){if(!r)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.isSubLocationNameExist(e,t)}isLocationNameForbidden(e,t=this.accountGetterHelper){if(!t)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.isLocationNameForbidden(e)}getFrozenAsset(e,t,r,n=this.accountGetterHelper){if(!n)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return n.getFrozenAsset(e,t,r)}getAsset(e,t,r=this.accountGetterHelper){if(!r)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAsset(e,t)}getCurrency(e,t=this.accountGetterHelper){if(!t)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getCurrency(e)}isCurrencyForbidden(e,t=this.accountGetterHelper){if(!t)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.isCurrencyForbidden(e)}getMagic(e,t=this.accountGetterHelper){if(!t)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getMagic(e)}getChain(e,t=this.accountGetterHelper){if(!t)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getChain(e)}getMigrateCertificate(e,t=this.accountGetterHelper){if(!t)throw new lr(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getMigrateCertificate(e)}};p([k("accountGetterHelper",{optional:!0}),h("design:type",Object)],uu.prototype,"accountGetterHelper",void 0),uu=p([j()],uu);var EA=class{constructor(e,t,r,n){this.config=e,this.blockHelper=t,this.accountHelper=r,this.transactionHelper=n}async getNextRoundGenerators(e,t){const r=this.blockHelper.calcRoundByHeight(e);return await this.calcForgingGenerators(r,t)}async calcForgingGenerators(e,t){let r=await this.accountHelper.getNextRoundGenerators(t);const n=r.length<this.config.blockPerRound;let s=r.map(o=>o.address),i=e-1;for(;r.length<this.config.blockPerRound&&i!==0;){const o=await this.__getAlternateGenerators(i,r,s,t);r=o.results,s=o.pickAddressArr,i--}return n&&(r=this.blockHelper.sortInRankAccountInfoList(r)),r}async __getAlternateGenerators(e,t,r,n){const s=await this.blockHelper.forceGetBlockGeneratorAddressByRound(e),i=[];for(const c of s)r.includes(c)||(r[r.length]=c,i[i.length]=c);let o=await this.accountHelper.getAccounts(i,e,n);return o=this.__sortByProducedblocks(o),t.push.apply(t,o.slice(0,this.config.blockPerRound-t.length)),{results:t,pickAddressArr:r}}__sortByProducedblocks(e){if(e.length<=1)return e;const t=[...e],r=Math.floor(t.length/2),n=t.splice(r,1)[0],s=[],i=[];for(let o=0;o<t.length;o++)t[o].producedblocks>n.producedblocks?s[s.length]=t[o]:i[i.length]=t[o];return this.__sortByProducedblocks(s).concat([n],this.__sortByProducedblocks(i))}};EA=p([j(),h("design:paramtypes",[re,ht,uu,_e])],EA);var{warn:TA,ConsensusException:hy,log:GS}=Z("Core","blockForkCheck"),Qe;(function(e){e[e.KEEP=1]="KEEP",e[e.MERGE=2]="MERGE",e[e.FORK=3]="FORK"})(Qe||(Qe={}));var gu;(function(e){e[e.PUZZLED=11]="PUZZLED"})(gu||(gu={}));var SA=class{constructor(e,t,r){this.blockHelper=e,this.timeHelper=t,this.config=r}async checkNewBlockFromChainChannel(e,t,r=this.blockHelper.blockGetterHelper){const n=await this.checkNewBlock(e,t.toBlockGetterHelper({maxHeight:e.height}),r);if(n.plot===Qe.MERGE){const s=await this.blockHelper.getCurrentReplayingBlockInfo(r),i=s&&s.chainChannelGroup;i&&i.addChainChannels(t)}return n}checkSameHeightBlockPlot_(e,t){if(e.timestamp>t.timestamp)return Qe.FORK;if(e.timestamp<t.timestamp)return Qe.KEEP;if(e.previousBlockSignature===t.previousBlockSignature&&e.timestamp===t.timestamp){if(e.numberOfTransactions>t.numberOfTransactions||e.totalFee>t.totalFee)return Qe.KEEP;if(e.totalFee===t.totalFee){if(e.signature>t.signature)return Qe.KEEP;if(e.signature===t.signature)return Qe.MERGE}}return Qe.FORK}checkSameHeightBlockListPlot_(e,t){return this.checkSameHeightBlockPlot_(this.blockHelper.parseBlockPlotCheckerListToPlotChecker(e),this.blockHelper.parseBlockPlotCheckerListToPlotChecker(t))}async getBlockPlotCheckerEnd_(e,t){const r={pc:t,blockGetterHelper:e},n=await this.blockHelper.getCurrentReplayingBlockInfo(e);n&&(r.blockGetterHelper=n.blockGetterHelper,r.pc=this.blockHelper.parseBlockToPlotChecker(await n.blockGetterHelper.getLastBlock()));const s=await this.blockHelper.getCurrentGenerateBlock(e);return s&&(r.pc=this.blockHelper.parseNewBlockToPlotChecker(s)),r}async checkBlockGetterPlot(e,t,r,n){const[s,i]=await Promise.all([this.getBlockPlotCheckerEnd_(t,e),this.getBlockPlotCheckerEnd_(n,r)]);if(s.pc.height<=i.pc.height){const c=await this.checkBlockGetterPlotEnd(s.pc,i.pc,i.blockGetterHelper);return c.plot===Qe.KEEP?{plot:Qe.KEEP,height:e.height,blockPlotChecker:e}:c.plot===Qe.MERGE?{plot:Qe.MERGE,height:r.height,blockPlotChecker:r}:c.plot===Qe.FORK&&typeof c.height=="number"&&c.height<=e.height?{plot:c.plot,height:c.height}:c}const o=await this.checkBlockGetterPlotEnd(i.pc,s.pc,s.blockGetterHelper);return o.plot===Qe.MERGE?{plot:Qe.MERGE,height:r.height,blockPlotChecker:r}:o.plot===Qe.FORK?{plot:Qe.KEEP,height:e.height,blockPlotChecker:e}:(TA(`should not happen: the pc5.height is large then pc6.height, Why plot is ${Qe[o.plot]}?`),o)}async checkBlockGetterPlotEnd(e,t,r){const n={plot:Qe.MERGE,height:t.height,blockPlotChecker:t},s={plot:Qe.KEEP,height:e.height,blockPlotChecker:e},i=c=>({plot:Qe.FORK,height:c}),o=()=>({plot:gu.PUZZLED});if(e.height<t.height)return(e.height===t.height-1?t.previousBlockSignature:await this.blockHelper.forceGetBlockSignatureByHeight(e.height,r))===e.signature?n:i();if(e.height===t.height){if(e.signature===t.signature)return n;if(e.previousBlockSignature===t.previousBlockSignature){const c=this.checkSameHeightBlockPlot_(e,t);return c===Qe.FORK?i(e.height-1):c===Qe.KEEP?s:n}return o()}return s}async checkNewBlock(e,t,r=this.blockHelper.blockGetterHelper){const n=await this.blockHelper.getLastBlock(r),s=this.blockHelper.parseBlockToPlotChecker(await this.blockHelper.getLastBlock(r));let i;e instanceof It?i=this.blockHelper.parseBlockToPlotChecker(e):i=e;const o=await this.checkBlockGetterPlot(s,r,i,t),c={plot:Qe.MERGE,height:i.height,block:this.blockHelper.getBlockFromPlotChecker(i)},l={plot:Qe.KEEP,height:s.height,block:n},u=(g,y)=>({plot:Qe.FORK,height:g,block:y});if(o.plot===gu.PUZZLED){const g=await this.findNearestSameBlock(s.height-1,r,t),y=(await this.blockHelper.forceGetBlockListByHeightRange(g.height+1,s.height,r)).map(I=>this.blockHelper.parseBlockToPlotChecker(I)),m=(await this.blockHelper.forceGetBlockListByHeightRange(g.height+1,i.height,t)).map(I=>this.blockHelper.parseBlockToPlotChecker(I)),d=this.checkSameHeightBlockListPlot_(y,m);if(d===Qe.FORK)return u(g.height,g);if(d===Qe.KEEP)return l;if(d===Qe.MERGE)return TA("should not happen. pc1 and pc2 are puzzled. should not 'MERGE'!"),c;throw new Error("should not happen in PUZZLED")}if(o.plot===Qe.FORK){if(typeof o.height=="number")return u(o.height,o.height===s.height?n:void 0);const g=await this.findNearestSameBlock(s.height-1,r,t);return u(g.height,g)}if(o.plot===Qe.MERGE)return c;if(o.plot===Qe.KEEP)return l;throw new Error("should not happen in checkResult")}async findNearestSameBlock(e,t,r){if(e<1)throw new hy(a.GENESIS_BLOCK_MAYBE_NO_EQUAL);const n=this.blockHelper.calcRoundByHeight(e)-1,s=this.blockHelper.calcRoundEndHeight(n),i=await this.findNearestSameBlockInOneRound(e,s,t,r);if(i)return i;let o=s;do{const u=await this.blockHelper.forceGetBlockByHeight(o,t);if((await this.blockHelper.forceGetBlockByHeight(o,r)).asset.roundLastAsset.chainOnChainHash===u.asset.roundLastAsset.chainOnChainHash)break;o-=this.config.blockPerRound}while(o>1);const c=o+this.config.blockPerRound;GS(` ${c} 58 ()`);const l=await this.findNearestSameBlockInOneRound(c,c-this.config.blockPerRound,t,r);if(!l)throw new hy(a.FAILED_TO_FIND_NEAREST_SAME_BLOCK_IN_ONE_ROUND);return l}async findNearestSameBlockInOneRound(e,t,r,n){for(let s=e;s>=t-1;s--){const i=await this.blockHelper.forceGetBlockByHeight(s,n),o=await this.blockHelper.forceGetBlockByHeight(s,r);if(i.signature===o.signature)return o;if(s===1)throw new hy(a.GENESIS_BLOCK_NOT_MATCH)}}};SA=p([j(),h("design:paramtypes",[ht,xt,re])],SA);var{ArgumentFormatException:bA,log:uw,warn:KS}=Z("Core","Block"),Ih=class{constructor(e,t,r,n,s,i,o){this.blockHelper=e,this.asymmetricHelper=t,this.blockGeneratorCalculator=r,this.keypairHelper=n,this.cryptoHelper=s,this.Buffer=i,this.moduleMap=o,this._blockFactoryCache=new Map,this.fromJSON=this.recombineBlock}getBlockFactory(e){let t=this._blockFactoryCache.get(e);return t||(t=At(e,this.moduleMap),this._blockFactoryCache.set(e,t)),t}getBlockFactoryFromHeight(e){const t=this.blockHelper.parseTypeByHeight(e);return this.getBlockFactoryFromBaseType(t)}getBlockFactoryFromBaseType(e){const t=jS.KF.get(e);if(!t)throw new bA(a.INVALID_BASE_TYPE,{base_type:e});return this.getBlockFactory(t)}async generateBlock(e,t,r,n,s,i,o,c){const l=this.getBlockFactory(e);return l.verifyKeypair(s),i&&(l.verifyKeypair(i),t.generatorSecondPublicKey=Ne(i.publicKey)),t.remark=t.remark||{},await l.verifyBlockBody(t,r),await l.generateBlock(t,r,n,s,i,o,c)}async replayBlock(e,t,r,n={}){const s=this.getBlockFactoryFromHeight(e.height);return await s.verifyBlockBody(e,e.asset),await s.replayBlock(e,t,r,n)}async recombineBlock(e){return await this.getBlockFactoryFromHeight(e.height).fromJSON(e)}parseBytesToBlock(e){return It.decode(e)}parseBytesToSomeBlock(e,t){if(typeof t!="number"){const r=new Nn(e);r.uint32(),r.uint32(),r.uint32(),t=r.uint32()}return this.getBlockModelConstructorFromHeight(t).decode(e)}getBlockModelConstructorFromHeight(e){return this.getBlockModelConstructorFromBaseType(e)}getBlockModelConstructorFromBaseType(e){const t=this.blockHelper.parseTypeByHeight(e),r=cl.KM.get(t);if(!r)throw new bA(a.INVALID_BASE_TYPE,{base_type:t});return r}getRoundLastBlockRemarkHash(...e){return KS("@deprecated","blockHelper.getRoundLastBlockRemarkHash"),this.blockHelper.calcChainOnChainHash(...e)}};Ih=p([j("bfchain-core:BlockCore"),Se(3,k("keypairHelper")),Se(4,k("cryptoHelper")),Se(5,k("Buffer")),h("design:paramtypes",[ht,_r,In,Object,Object,Object,je])],Ih);var jS=(()=>{const e=new Map,t=new Map;return[[Ft.GENESIS,pu],[Ft.COMMON,cu],[Ft.ROUNDEND,lu]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{KF:e,FK:t}})(),{ConsensusException:En,NoFoundException:zS}=Z("VERIFIER","BlockLogicVerifier"),fu;(function(e){e[e.SYNC=1]="SYNC",e[e.REBUILD=2]="REBUILD",e[e.GENERATEBLOCK=3]="GENERATEBLOCK"})(fu||(fu={}));var on=class{async verifyBlockBase(e,t,r){this.blockHelper.verifyBlockVersion(e,this.configHelper),t!==fu.REBUILD&&await this.isBlockAlreadyExist(e.signature,e.height),this.checkBlockTimestamp(e),e.height!==1&&await this.checkPreviousBlock(e),await this.checkSecondPublicKey(e,r)}async checkSecondPublicKey(e,t){const{height:r,generatorPublicKey:n,generatorSecondPublicKey:s,signature:i,signSignature:o}=e,c=await this.accountBaseHelper.getAddressFromPublicKeyString(n);if(!t)throw new zS(a.NOT_EXIST,{prop:`generator with address ${c}`,target:"blockChain"});if(t.secondPublicKey){if(!(s&&o))throw new En(a.BLOCK_SIGN_SIGNATURE_IS_REQUIRED,{signature:i,generatorAddress:c,height:r});if(t.secondPublicKey!==s)throw new En(a.BLOCK_GENERATOR_SECOND_PUBLICKEY_ALREADY_CHANGE,{signature:i,generatorAddress:c,height:r})}else{if(s)throw new En(a.BLOCK_SHOULD_NOT_HAVE_GENERATOR_SECOND_PUBLICKEY,{signature:i,generatorAddress:c,height:r});if(o)throw new En(a.BLOCK_SHOULD_NOT_HAVE_SIGN_SIGNATURE,{signature:i,generatorAddress:c,height:r})}}checkBlockTimestamp(e){const{timeHelper:t}=this,r=t.getTimestamp(),n=t.getSlotNumberByTimestamp(e.timestamp),s=t.getSlotNumberByTimestamp(r);n>s&&console.debug(`Block timestamp in future. Block time is ahead of the time on the server, block timestamp ${e.timestamp}, block timestamp slot ${n}, blockChain now timestamp ${r}, blockChain now timestamp slot ${s}`)}async isBlockAlreadyExist(e,t){const r=this.blockGetterHelper;if(typeof r.getCountBlock!="function")throw new En(a.PROP_IS_INVALID,{prop:"getCountBlock",target:"blockGetterHelper"});if(await r.getCountBlock({signature:e})>0)throw new En(a.ALREADY_EXIST,{prop:`Block with signature ${e}`,target:"blockChain",errorId:`Block already exists: ${e} height: ${t}`})}async verifyBlockWithTransactions(e,t){t!==fu.GENERATEBLOCK&&await this.blockCore.getBlockFactoryFromHeight(e.height).verify(e)}async checkPreviousBlock(e){const t=this.blockGetterHelper;if(typeof t.chainBlockFork!="function")throw new En(a.PROP_IS_INVALID,{prop:"chainBlockFork",target:"blockGetterHelper"});const{height:r,previousBlockSignature:n,timestamp:s}=e,i=await t.getBlockByHeight(r-1);if(!i)throw new En(a.NOT_EXIST,{prop:`Block with height ${r-1}`,target:"blockChain"});const o=i.signature;if(n!==o)throw await t.chainBlockFork(e,Qh.DIFFERENT_PRE_BLOCK_SIGNATURE),new En(a.NOT_MATCH,{to_compare_prop:`previousBlockSignature: ${n}`,be_compare_prop:`__signature: ${o}`,to_target:`block ${r}`,be_target:`lastBlock ${i.height}`});const{timeHelper:c}=this,l=c.getSlotNumberByTimestamp(s),u=c.getNextSlotNumberByTimestamp(i.timestamp);if(l<u)throw new En(a.PROP_SHOULD_GT_FIELD,{prop:`timestamp ${s}`,target:"block",field:`lastBlock timestamp ${i.timestamp}`})}async isValidBlockSlot(e){const{timeHelper:t,blockGeneratorCalculator:r,blockGetterHelper:n}=this,s=await this.accountBaseHelper.getAddressFromPublicKeyString(e.generatorPublicKey),i=t.getSlotNumberByTimestamp(e.timestamp),o=await n.getLastBlock(),c=await r.calcGenerateBlockGenerator({timestamp:o.timestamp,height:o.height},{toTimestamp:e.timestamp,blockGetterHelper:n});if(c.address!==s)throw new En(a.INVALID_BLOCK_GENERATOR,{reason:`lastBlock.timestamp: ${o.timestamp} lastBlock.height: ${o.height}, block.timestamp: ${e.timestamp} curTime: ${t.getTimeByTimestamp(e.timestamp)} signature${e.signature} height: ${e.height} slot${i}${c.address}${s}`})}async checkAssetChangeHash(e,t){const r=await this.accountGetterHelper.getAccountsAssetsChange(e),n=await this.blockHelper.calcAssetChangeHash(r);if(n!==t)throw new En(a.NOT_MATCH,{to_compare_prop:`assetChangeHash ${t}`,be_compare_prop:`assetChangeHash ${n}`,to_target:"block",be_target:"calculate"})}};p([k(ht),h("design:type",ht)],on.prototype,"blockHelper",void 0),p([k(de),h("design:type",de)],on.prototype,"accountBaseHelper",void 0),p([k(re),h("design:type",re)],on.prototype,"configHelper",void 0),p([k(xt),h("design:type",xt)],on.prototype,"timeHelper",void 0),p([k(Le),h("design:type",Le)],on.prototype,"chainAssetInfoHelper",void 0),p([k("bfchain-core:BlockCore"),h("design:type",Object)],on.prototype,"blockCore",void 0),p([k(In),h("design:type",In)],on.prototype,"blockGeneratorCalculator",void 0),p([k("transactionGetterHelper",{dynamics:!0}),h("design:type",Object)],on.prototype,"transactionGetterHelper",void 0),p([k("blockGetterHelper",{dynamics:!0}),h("design:type",Object)],on.prototype,"blockGetterHelper",void 0),p([k("accountGetterHelper",{dynamics:!0}),h("design:type",Object)],on.prototype,"accountGetterHelper",void 0);var JS=class extends on{async verify(e,t,r){return await this.verifyBlockBase(e,t,r),!0}async verifyBlockAsset(e){await this.checkAssetChangeHash(e.height,e.asset.genesisAsset.assetChangeHash)}},YS=class extends on{async verify(e,t,r){return await this.verifyBlockBase(e,t,r),await this.checkPreviousBlock(e),await this.isValidBlockSlot(e),!0}async verifyBlockAsset(e){await this.checkAssetChangeHash(e.height,e.asset.commonAsset.assetChangeHash)}},{ConsensusException:Eh,NoFoundException:gw}=Z("VERIFIER","BlockLogicVerifier"),XS=class extends on{async verify(e,t,r){return await this.verifyBlockBase(e,t,r),await this.checkPreviousBlock(e),await this.isValidBlockSlot(e),!0}async verifyBlockAsset(e){const{height:t,asset:r}=e,{assetChangeHash:n,chainOnChainHash:s}=r.roundLastAsset;await this.checkAssetChangeHash(t,n),await this.checkChainOnChainHash(t,s),await this.checkNextRoundGenerators(e)}async checkChainOnChainHash(e,t){const r=await this.blockHelper.calcChainOnChainHash(e,this.blockGetterHelper);if(r!==t)throw new Eh(a.NOT_MATCH,{to_compare_prop:`hashString ${r}`,be_compare_prop:`hash ${t}`,to_target:"block",be_target:"calculate"})}async checkNextRoundGenerators(e){const t=this.blockGetterHelper;if(typeof t.getNextRoundGenerators!="function")throw new Eh(a.PROP_IS_INVALID,{prop:"checkNextRoundGenerators",target:"blockGetterHelper"});const r=await t.getNextRoundGenerators(await t.getLastBlock(),e.generatorPublicKey),n=e.asset.roundLastAsset.nextRoundGenerators;if(r.length!==n.length)throw new Eh(a.NOT_MATCH,{to_compare_prop:`generators length ${r.length}`,be_compare_prop:`generators length ${n.length}`,to_target:"block asset",be_target:"calculate"});for(let s=0;s<r.length;s++){const i=r[s].address,o=n[s];if(o.address!==i)throw new Eh(a.NOT_MATCH,{to_compare_prop:`nextRoundGenerators index ${s} address ${o.address}`,be_compare_prop:`nextRoundGenerators index ${s} address ${i}`,to_target:"block asset",be_target:"calculate"});const c=r[s].numberOfForgeEntities;if(o.numberOfForgeEntities!==c)throw new Eh(a.NOT_MATCH,{to_compare_prop:`nextRoundGenerators index ${s} address ${o.address} numberOfForgeEntities ${o.numberOfForgeEntities}`,be_compare_prop:`nextRoundGenerators index ${s} address ${i} numberOfForgeEntities ${c}`,to_target:"block asset",be_target:"calculate"})}}},{ArgumentFormatException:QS}=Z("Core","BlockLogicVerifierCore"),ly=class{constructor(e,t){this.blockHelper=e,this.moduleMap=t,this._blockLogicVerifierCache=new Map}getBlockLogicVerifier(e){let t=this._blockLogicVerifierCache.get(e);return t||(t=At(e,this.moduleMap),this._blockLogicVerifierCache.set(e,t)),t}getBlockLogicVerifierFromHeight(e){const t=this.blockHelper.parseTypeByHeight(e);return this.getBlockLogicVerifierFromBaseType(t)}getBlockLogicVerifierFromBaseType(e){const t=qS.KLV.get(e);if(!t)throw new QS(a.INVALID_BASE_TYPE,{base_type:e});return this.getBlockLogicVerifier(t)}};ly=p([j("bfchain-core:BlockLogicVerifierCore"),h("design:paramtypes",[ht,je])],ly);var qS=(()=>{const e=new Map,t=new Map;return[[Ft.GENESIS,JS],[Ft.COMMON,YS],[Ft.ROUNDEND,XS]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{KLV:e,LVK:t}})(),{ConsensusException:fw,NoFoundException:Wo}=Z("TICKER","BlockLogicTicker"),Ur=class{async tickBlockBase(e,t=this.accountGetterHelper,r=this.blockTickGetterHelper){const n=await this.__calcForginAndHoldingRewards(e,t);await this.__updateForgingAndHoldingAccount(e,n,r)}async __getShareEntityHolders(e=this.accountGetterHelper){if(!e)throw new Wo(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});const t=await e.getShareEntityHolders();let r=0;for(const n of t)r+=n.numberOfShareEntities;return{holders:t,totalEntities:r}}async __calcForginAndHoldingRewards(e,t=this.accountGetterHelper,r=this.blockGetterHelper){if(!t)throw new Wo(a.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});if(!r)throw new Wo(a.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const{blockHelper:n}=this;let s=0,i=[],o=BigInt(0);if(n.isRoundLastBlock(e.height)&&e.reward!=="0"){const c=await this.__getShareEntityHolders(t);if(s=c.totalEntities,i=c.holders,!r.getBlocksByRange)throw new Wo(a.NOT_EXIST,{prop:"blockGetterHelper.getBlocksByRange",target:"moduleStroge"});const l=this.blockHelper.calcRoundStartHeightByHeight(e.height),u=await r.getBlocksByRange(l,e.height);for(const m of u)o+=BigInt(m.totalFee);const g=await t.getAsset(this.configHelper.magic,this.configHelper.assetType);if(!g)throw new Wo(a.NOT_EXIST,{prop:`asset(${this.configHelper.magic}-${this.configHelper.assetType})`,target:"blockChain"});const y=g.issuedAssetPrealnum-g.circulatedAssetPrealnum-BigInt(e.reward);y<o&&(o=y)}return this.blockHelper.calcForginAndHoldingRewards(e,o,s,i)}async __updateForgingAndHoldingAccount(e,t,r=this.blockTickGetterHelper){if(!r)throw new Wo(a.NOT_EXIST,{prop:"blockTickGetterHelper",target:"moduleStroge"});const{forgingRewards:n,holdingRewardsList:s,circulations:i}=t;s.length>0&&await r.updateHoldingAccount(e,s),await r.updateForgingAccount(e,n),i>BigInt(0)&&await r.accumulateCirculations(e,this.configHelper.magic,this.configHelper.assetType,i)}};p([k(ht),h("design:type",ht)],Ur.prototype,"blockHelper",void 0),p([k(re),h("design:type",re)],Ur.prototype,"configHelper",void 0),p([k(xt),h("design:type",xt)],Ur.prototype,"timeHelper",void 0),p([k(de),h("design:type",de)],Ur.prototype,"accountBaseHelper",void 0),p([k(St),h("design:type",St)],Ur.prototype,"jsbiHelper",void 0),p([k(In),h("design:type",In)],Ur.prototype,"blockGeneratorCalculator",void 0),p([k("accountGetterHelper",{optional:!0,dynamics:!0}),h("design:type",Object)],Ur.prototype,"accountGetterHelper",void 0),p([k("blockGetterHelper",{optional:!0,dynamics:!0}),h("design:type",Object)],Ur.prototype,"blockGetterHelper",void 0),p([k("blockTickGetterHelper",{optional:!0,dynamics:!0}),h("design:type",Object)],Ur.prototype,"blockTickGetterHelper",void 0),Ur=p([j()],Ur),Z("CONTROLLER","BlockLogicVerifier");var uy=class extends Ur{async tick(e,t=this.accountGetterHelper,r=this.blockTickGetterHelper){await this.tickBlockBase(e,t,r)}};uy=p([j()],uy);var gy=class extends Ur{async tick(e,t=this.accountGetterHelper,r=this.blockTickGetterHelper){await this.tickBlockBase(e,t,r)}};gy=p([j()],gy),Z("TICKER","BlockLogicTicker");var fy=class extends Ur{async tick(e,t=this.accountGetterHelper,r=this.blockTickGetterHelper){await this.tickBlockBase(e,t,r)}async roundEnd(e,t,r=this.accountGetterHelper,n=this.blockTickGetterHelper){}};fy=p([j()],fy);var{ArgumentFormatException:WS,log:dw,warn:yw}=Z("Core","BlockTicker"),dy=class{constructor(e,t){this.blockHelper=e,this.moduleMap=t,this._blockTickerCache=new Map}getBlockTicker(e){let t=this._blockTickerCache.get(e);return t||(t=At(e,this.moduleMap),this._blockTickerCache.set(e,t)),t}getBlockTickerFromHeight(e){const t=this.blockHelper.parseTypeByHeight(e);return this.getBlockTickerFromBaseType(t)}getBlockTickerFromBaseType(e){const t=ZS.KT.get(e);if(!t)throw new WS(a.INVALID_BASE_TYPE,{base_type:e});return this.getBlockTicker(t)}};dy=p([j("bfchain-core:BlockTickerCore"),h("design:paramtypes",[ht,je])],dy);var ZS=(()=>{const e=new Map,t=new Map;return[[Ft.GENESIS,uy],[Ft.COMMON,gy],[Ft.ROUNDEND,fy]].forEach(([r,n])=>{e.set(r,n),t.set(n,r)}),{KT:e,TK:t}})(),{ArgumentIllegalException:Tn}=Z("CONTROLLER","RegisterChainTransactionFactory"),du=class extends Ge{constructor(e,t,r,n,s,i,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.registerChainCertificateHelper=i,this.configMap=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new Tn(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Tn(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"chain magic",...n});if(e.toMagic!==r.magic)throw new Tn(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"chain magic",...n});if(!e.storage)throw new Tn(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="magic")throw new Tn(a.SHOULD_BE,{to_compare_prop:`key ${s.key}`,to_target:"storage",be_compare_prop:"magic",...n});const i=t.registerChain;if(!i)throw new Tn(a.PARAM_LOST,{param:"registerChain"});const o={...n,target:"registerChainAsset"},c=i.genesisBlock;if(!c)throw new Tn(a.PROP_IS_REQUIRE,{prop:"genesisBlock",...o});if(!this.baseHelper.isString(c))throw new Tn(a.PROP_IS_INVALID,{prop:"genesisBlock",...o});const l=this.registerChainCertificateHelper.decode(c);await this.registerChainCertificateHelper.verifyRegisterChainCertificate(l);const{bnid:u,magic:g,assetType:y,chainName:m}=l.body.genesisBlockInfo;if(g===r.magic)throw new Tn(a.SHOULD_NOT_BE,{to_compare_prop:`magic ${g}`,to_target:"genesisBlockJson.asset.genesisAsset",be_compare_prop:r.magic,...o});if(y===r.assetType)throw new Tn(a.SHOULD_NOT_BE,{to_compare_prop:`assetType ${y}`,to_target:"genesisBlockJson.asset.genesisAsset",be_compare_prop:r.assetType,...o});if(m===r.chainName)throw new Tn(a.SHOULD_NOT_BE,{to_compare_prop:`chainName ${m}`,to_target:"genesisBlockJson.asset.genesisAsset",be_compare_prop:r.chainName,...o});if(r.initials!==u)throw new Tn(a.NOT_MATCH,{to_compare_prop:`initials ${r.initials}`,be_compare_prop:`bnid ${u}`,to_target:"config",be_target:"genesisBlockJson.asset.genesisBlock",...n})}init(e,t){return yo.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){const n=new L_;n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:i}=e,o=e.asset.registerChain.genesisBlock,c=this.registerChainCertificateHelper.decode(o);return n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,accountStatus:16}}),n.next=t.emit("registerChain",{type:"registerChain",transaction:e,applyInfo:{address:s,publicKeyBuffer:i,genesisBlock:c.body.genesisBlockInfo}}),n.toPromise()}};du=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,Cl,yr])],du);var{ArgumentIllegalException:Gn}=Z("CONTROLLER","MultipleTransactionFactory"),Th=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new Gn(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Gn(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Gn(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new Gn(a.SHOULD_NOT_EXIST,{prop:"storage",...n});const s=t.multiple;if(!s)throw new Gn(a.PARAM_LOST,{param:"multiple"});const i={...n,target:"multiple"},{transactions:o}=s;if(!o)throw new Gn(a.PROP_IS_REQUIRE,{prop:"transactions",...i});if(o.length===0)throw new Gn(a.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"transactions",field:0,...i});const c=new Set,l=new Set,u=new Set,{GRAB_ANY:g,GRAB_ASSET:y,SIGN_FOR_ASSET:m,MULTIPLE:d,PROMISE_RESOLVE:I,MACRO_CALL:T}=this.transactionHelper,S=w=>{if(c.has(w.signature))throw new Gn(a.SHOULD_NOT_DUPLICATE,{prop:`transactions ${w.signature}`,...i});switch(w.type){case y:{const b=`${w.senderId}-${w.storageValue}`;if(l.has(b))throw new Gn(a.SHOULD_NOT_DUPLICATE,{prop:`transactions ${b}`,...i});l.add(b);break}case g:{const b=`${w.senderId}-${w.storageValue}`;if(l.has(b))throw new Gn(a.SHOULD_NOT_DUPLICATE,{prop:`transactions ${b}`,...i});l.add(b);break}case m:{const b=`${w.senderId}-${w.storageValue}`;if(u.has(b))throw new Gn(a.SHOULD_NOT_DUPLICATE,{prop:`transactions ${b}`,...i});u.add(b);break}case d:{const b=w.asset.multiple.transactions;for(const R of b)S(R);break}case I:{S(w.asset.resolve.transaction);break}case T:{S(w.asset.call.transaction);break}}c.add(w.signature)};for(const w of o){S(w);const b=this.transactionCore.getTransactionFactoryFromType(w.type),R=await b.fromJSON(w);await b.verify(R)}}init(e,t){return _o.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r)})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],Th.prototype,"transactionCore",void 0),Th=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Th);var{ArgumentIllegalException:Zo}=Z("CONTROLLER","PromiseTransactionFactory"),Sh=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new Zo(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Zo(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Zo(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new Zo(a.SHOULD_NOT_EXIST,{prop:"storage",...n});const s=t.promise;if(!s)throw new Zo(a.PARAM_LOST,{param:"promise"});const i={...n,target:"promise"},{transaction:o}=s;if(!o)throw new Zo(a.PROP_IS_REQUIRE,{prop:"transaction",...i});const c=this.transactionCore.getTransactionFactoryFromType(o.type),l=await c.fromJSON(o);await c.verify(l)}init(e,t){return ca.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r)})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],Sh.prototype,"transactionCore",void 0),Sh=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],Sh);var{ArgumentIllegalException:_s}=Z("CONTROLLER","PromiseResolveTransactionFactory"),bh=class extends Ge{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new _s(a.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new _s(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new _s(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new _s(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="promiseId")throw new _s(a.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"promiseId",...n});const i=t.resolve;if(!i)throw new _s(a.PARAM_LOST,{param:"resolve"});const o={...n,target:"resolve"},{promiseId:c,transaction:l}=i;if(!c)throw new _s(a.PROP_IS_REQUIRE,{prop:"promiseId",...o});if(this.baseHelper.isValidSignature(c)===!1)throw new _s(a.PROP_IS_INVALID,{prop:`promiseId ${c}`,...o});if(!l)throw new _s(a.PROP_IS_REQUIRE,{prop:"transaction",...o});const u=await this.transactionCore.recombineTransaction(l);if(await this.transactionCore.getTransactionFactoryFromType(u.type).verify(u),s.value!==c)throw new _s(a.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`promiseId ${c}`,to_target:"storage",be_target:"resolve",...n})}init(e,t){return Io.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r),n.next=t.emit("promiseResolve",{type:"promiseResolve",transaction:e,applyInfo:{promiseId:e.asset.resolve.promiseId,recipientId:e.recipientId}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],bh.prototype,"transactionCore",void 0),bh=p([j(),h("design:paramtypes",[de,_e,Re,re,Le])],bh);var{ArgumentIllegalException:ot}=Z("CONTROLLER","MacrotionFactory"),wh=class extends Ge{constructor(e,t,r,n,s,i){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=i}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new ot(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ot(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ot(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new ot(a.SHOULD_NOT_EXIST,{prop:"storage",...n});const s=t.macro;if(!s)throw new ot(a.PARAM_LOST,{param:"macro"});const i={...n,target:"macro"},{inputs:o,template:c}=s,l=c instanceof Je?c.toJSON():c;if(!o)throw new ot(a.PROP_IS_REQUIRE,{prop:"inputs",...i});if(!l)throw new ot(a.PROP_IS_REQUIRE,{prop:"template",...i});const u=this.transactionCore.getTransactionFactoryFromType(l.type),g=await u.fromJSON(l);await u.verify(g);const y=this.baseHelper,m=new Set,d=new Set;for(const I of o){const{type:T,name:S,keyPath:w,pattern:b}=I;if(!S)throw new ot(a.PROP_IS_REQUIRE,{prop:"name",target:`macro.inputs.input ${JSON.stringify(I)}`});if(b)try{new RegExp(b)}catch{throw new ot(a.PROP_IS_INVALID,{prop:"pattern",target:`macro.inputs.input ${JSON.stringify(I)}`})}if(y.isValidMacroInputName(S)===!1)throw new ot(a.PROP_IS_REQUIRE,{prop:"name",target:`macro.inputs.input ${JSON.stringify(I)}`});if(m.has(S))throw new ot(a.SHOULD_NOT_DUPLICATE,{prop:`name ${S}`,target:`macro.inputs.input ${JSON.stringify(I)}`});if(m.add(S),!w)throw new ot(a.PROP_IS_REQUIRE,{prop:"keyPath",target:`macro.inputs.input ${JSON.stringify(I)}`});if(d.has(w))throw new ot(a.SHOULD_NOT_DUPLICATE,{prop:`keyPath ${w}`,target:`macro.inputs.input ${JSON.stringify(I)}`});if(d.add(w),!T)throw new ot(a.PROP_IS_REQUIRE,{prop:"type",target:`macro.inputs.input ${JSON.stringify(I)}`});if(w.includes(".")){let R=l;const v=w.split("."),$=v.pop();for(const D of v){if(R.hasOwnProperty(D)===!1)throw new ot(a.NOT_EXIST,{prop:`keyPath ${w}`,target:"macro.template"});R=R[D]}if(R.hasOwnProperty($)===!1)throw new ot(a.NOT_EXIST,{prop:`keyPath ${w}`,target:"macro.template"})}else if(l.hasOwnProperty(w)===!1)throw new ot(a.NOT_EXIST,{prop:`keyPath ${w}`,target:"macro.template"});if(T===Rt.NUMBER||T===Rt.CALC){const{base:R,min:v,max:$,step:D,format:L}=I;if(L===void 0)throw new ot(a.PROP_IS_REQUIRE,{prop:"format",target:`macro.inputs.input ${JSON.stringify(I)}`});if(L!==Eo.LITERAL&&L!==Eo.STRING)throw new ot(a.PROP_IS_INVALID,{prop:`format ${L}`,target:`macro.inputs.input ${JSON.stringify(I)}`});if(R&&y.isPositiveBigFloatContainZero(R)===!1)throw new ot(a.PROP_IS_INVALID,{prop:"base",target:`macro.inputs.input ${JSON.stringify(I)}`});if(v&&y.isPositiveBigFloatContainZero(v)===!1)throw new ot(a.PROP_IS_INVALID,{prop:"min",target:`macro.inputs.input ${JSON.stringify(I)}`});if($){if(y.isPositiveBigFloatContainZero($)===!1)throw new ot(a.PROP_IS_INVALID,{prop:"max",target:`macro.inputs.input ${JSON.stringify(I)}`});if(R&&this.jsbiHelper.compareFraction($,R)===-1)throw new ot(a.PROP_SHOULD_LTE_FIELD,{prop:"base",target:`macro.inputs.input ${JSON.stringify(I)}`,field:JSON.stringify($)})}if(D){if(y.isPositiveBigFloatContainZero(D)===!1)throw new ot(a.PROP_IS_INVALID,{prop:"step",target:`macro.inputs.input ${JSON.stringify(I)}`});if(this.jsbiHelper.compareFraction(D,{numerator:"0",denominator:"1"})<1)throw new ot(a.PROP_SHOULD_GT_FIELD,{prop:"step",target:`macro.inputs.input ${JSON.stringify(I)}`,field:"0"})}if(T===Rt.CALC){const{calc:z}=I;if(z===void 0)throw new ot(a.PROP_IS_REQUIRE,{prop:"calc",target:`macro.inputs.input ${JSON.stringify(I)}`})}}else if(!(T===Rt.TEXT||T===Rt.ADDRESS||T===Rt.PUBLICKEY||T===Rt.SIGNATURE))throw new ot(a.PROP_IS_INVALID,{prop:`type ${T}`,target:`macro.inputs.input ${JSON.stringify(I)}`})}}init(e,t){return ga.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r)})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],wh.prototype,"transactionCore",void 0),wh=p([j(),h("design:paramtypes",[de,_e,Re,re,Le,St])],wh);var{ArgumentIllegalException:Nt}=Z("CONTROLLER","MacroCallTransactionFactory"),Nh=class extends Ge{constructor(e,t,r,n,s,i,o){super(),this.accountBaseHelper=e,this.asymmetricHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=i,this.jsbiHelper=o}trySet(e,t,r){let n;if(t.includes(".")){const s=t.split(".");n=s.pop();for(const i of s){if(e.hasOwnProperty(i)===!1)return!1;e=e[i]}}else n=t;return e.hasOwnProperty(n)===!1?!1:(e[n]=r,!0)}parseToMacroCallInputs(e){return Object.fromEntries(Object.entries(e).map(t=>[t[0],JSON.stringify(t[1])]))}async generateTransactionWithJsonInput(e,t,r,n=!0){return await this.generateTransaction(e,t,this.parseToMacroCallInputs(r),n)}async generateTransaction(e,t,r,n=!0){const s=new Cm(r),i=this.baseHelper,o=e.toJSON();for(const l of t){const{name:u,pattern:g,repeat:y}=l;let m=s.get(u);const d=async I=>{if(typeof I!="string")throw new Nt(a.PROP_IS_INVALID,{prop:`${l.name} ${I}`,target:"inputs"});if(g&&new RegExp(g).test(I)===!1)throw new Nt(a.NOT_MATCH,{to_compare_prop:`${u} ${I}`,to_target:"inputs",be_compare_prop:`pattern ${g}`,be_target:"defineInput"});switch(l.type){case Rt.ADDRESS:if(await this.accountBaseHelper.isAddress(I)===!1)throw new Nt(a.NOT_MATCH,{to_compare_prop:`${u} ${I}`,to_target:"inputs",be_compare_prop:"pattern chain address",be_target:"defineInput"});break;case Rt.PUBLICKEY:if(this.baseHelper.isValidPublicKey(I)===!1)throw new Nt(a.NOT_MATCH,{to_compare_prop:`${u} ${I}`,to_target:"inputs",be_compare_prop:"pattern chain publicKey",be_target:"defineInput"});break;case Rt.SIGNATURE:if(this.transactionHelper.isValidTransactionSignature(I)===!1)throw new Nt(a.NOT_MATCH,{to_compare_prop:`${u} ${I}`,to_target:"inputs",be_compare_prop:"pattern chain signature",be_target:"defineInput"});break;case Rt.TEXT:break;case Rt.CALC:I=N_(l.calc,s.toObject());case Rt.NUMBER:{if(I.includes(".")){const R=I.split(".");if(BigInt(R[1])===BigInt(0))throw new Nt(a.SHOULD_BE,{to_compare_prop:`name ${u}(${I})`,to_target:"inputs",be_compare_prop:R[0]})}const T=l.base||{numerator:"0",denominator:"1"};let S=this.jsbiHelper.toFraction(I);if(l.min&&this.jsbiHelper.compareFraction(l.min,S)===1)throw new Nt(a.PROP_SHOULD_GTE_FIELD,{prop:`name ${u} ${I}`,target:"inputs",field:JSON.stringify(l.min)});if(l.max&&this.jsbiHelper.compareFraction(l.max,S)===-1)throw new Nt(a.PROP_SHOULD_LTE_FIELD,{prop:`name ${u} ${I}`,target:"inputs",field:JSON.stringify(l.max)});S=this.jsbiHelper.minusFraction(S,T);const w=l.step||{numerator:"1",denominator:"1"},b=this.jsbiHelper.divisionFractionAndCeil(S,w);if(this.jsbiHelper.compareFraction(S,this.jsbiHelper.multiplyFraction({numerator:b,denominator:BigInt(1)},w))!==0)throw new Nt(a.SHOULD_BE,{to_compare_prop:`name ${u}(${I})'s step`,to_target:"inputs",be_compare_prop:JSON.stringify(l.step)});l.format===Eo.LITERAL&&(I=Number(I));break}}return I};if(y){if(i.isArray(m)===!1)throw new Nt(a.PROP_IS_INVALID,{prop:`${l.name}(repeat ${y}) ${m}`,target:"inputs"});const I=[];for(const T of m)I.push(await d(T));if(this.trySet(o,l.keyPath,I)===!1)throw new Nt(a.PROP_IS_INVALID,{prop:`name ${u}`,target:"inputs"})}else{const I=await d(m);if(this.trySet(o,l.keyPath,I)===!1)throw new Nt(a.PROP_IS_INVALID,{prop:`name ${u}`,target:"inputs"})}}const c=await this.transactionCore.recombineTransaction(o);for(const l of t)if(l.type===Rt.NUMBER){const u=l.keyPath.split(".");let g=o,y=c;for(const m of u)g=g[m],y=y[m];if(g.toString()!==y.toString())throw new Nt(a.PROP_IS_INVALID,{prop:`${l.name} ${g}`,target:"inputs"})}return n===!1&&await this.transactionCore.getTransactionFactoryFromType(c.type).verify(c,this.configHelper),c}async signTransaction(e,t,r){const n=await this.transactionCore.recombineTransaction(e.toJSON()),{accountBaseHelper:s,asymmetricHelper:i}=this,o=await s.createSecretKeypair(t);n.signatureBuffer=await i.detachedSign(n.getBytes(!0,!0),o.secretKey);let c;return r&&(c=await s.createSecondSecretKeypair(t,r),n.signSignatureBuffer=await i.detachedSign(n.getBytes(!1,!0),c.secretKey),await this.transactionHelper.verifyTransactionSignature(n)),n}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new Nt(a.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Nt(a.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Nt(a.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Nt(a.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="macroId")throw new Nt(a.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"macroId",...n});const i=t.call;if(!i)throw new Nt(a.PARAM_LOST,{param:"call"});const o={...n,target:"call"},{macroId:c,inputs:l,transaction:u}=i;if(!c)throw new Nt(a.PROP_IS_REQUIRE,{prop:"macroId",...o});if(!this.baseHelper.isValidSignature(c))throw new Nt(a.PROP_IS_INVALID,{prop:`macroId ${c}`,type:"transaction signature",...o});if(!l)throw new Nt(a.PROP_IS_REQUIRE,{prop:"inputs",...o});if(!u)throw new Nt(a.PROP_IS_REQUIRE,{prop:"transaction",...o});const g=await this.transactionCore.recombineTransaction(u);if(await this.transactionCore.getTransactionFactoryFromType(g.type).verify(g),s.value!==c)throw new Nt(a.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`macroId ${c}`,to_target:"storage",be_target:"call",...n})}init(e,t){return bo.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ue(n=>{n.next=super.applyTransaction(e,t,r);const{macroId:s,inputs:i}=e.asset.call;n.next=t.emit("macroCall",{type:"macroCall",transaction:e,applyInfo:{macroId:s,inputs:i}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};p([k("bfchain-core:TransactionCore",{dynamics:!0}),h("design:type",kt)],Nh.prototype,"transactionCore",void 0),Nh=p([j(),h("design:paramtypes",[de,_r,_e,Re,re,Le,St])],Nh),xr.VF.set(B.REGISTER_CHAIN,du),xr.FV.set(du,B.REGISTER_CHAIN),xr.VF.set(B.MULTIPLE,Th),xr.FV.set(Th,B.MULTIPLE),xr.VF.set(B.PROMISE,Sh),xr.FV.set(Sh,B.PROMISE),xr.VF.set(B.PROMISE_RESOLVE,bh),xr.FV.set(bh,B.PROMISE_RESOLVE),xr.VF.set(B.MACRO,wh),xr.FV.set(wh,B.MACRO),xr.VF.set(B.MACRO_CALL,Nh),xr.FV.set(Nh,B.MACRO_CALL);var yy=class extends Kt{constructor(){super(),this._startTime=Date.now(),this._sleepTime=0,this.onFinished(()=>this.clearTimeout())}get sleepTime(){return this._sleepTime}get endTime(){return this._startTime+this._sleepTime}setTimeout(e,t){this.clearTimeout(),this._startTime=Date.now(),this._sleepTi=xs(this._sleepTime=e,t)}clearTimeout(){this._sleepTi&&(k_(this._sleepTi),this._sleepTime=0,this._sleepTi=void 0)}},vi,wA,NA,OA,{ArgumentIllegalException:fe,ArgumentFormatException:vt,TimeOutException:eb}=Z("channel","chainChannelHelper"),Fe=vi=class{constructor(e,t,r,n,s){this.baseHelper=e,this.transctionHelper=t,this.blockHelper=r,this.timeHelper=n,this.accountBaseHelper=s}async boxQueryTransactionArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=ma.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(D){throw new vt(a.INVALID_PARAMS,{error:D,params:e})}const r=this.baseHelper,{type:n,types:s,signature:i,senderId:o,recipientId:c,dappid:l,lns:u,storage:g,blockSignature:y,minHeight:m,maxHeight:d,trusteeId:I,purchaseDAppid:T,range:S,offset:w,limit:b,address:R}=t.query;let v=!1;if(n&&(v=!0,!r.isValidTransactionType(n)))throw new fe(a.INVALID_PARAMS_FIELD,{field:`type ${n}`});if(s){v=!0;for(const D of s)if(!r.isValidTransactionType(D))throw new fe(a.INVALID_PARAMS_FIELD,{field:`types.type ${D}`})}if(i&&(v=!0,i.length!==vi.MAX_SIGNATURE_LENGTH))throw new fe(a.INVALID_PARAMS_FIELD,{field:`signature ${i}`});if(o&&(v=!0,o.length>vi.MAX_ADDRESS_LENGTH))throw new fe(a.INVALID_PARAMS_FIELD,{field:`senderId ${o}`});if(c&&(v=!0,c.length>vi.MAX_ADDRESS_LENGTH))throw new fe(a.INVALID_PARAMS_FIELD,{field:`recipientId ${c}`});if(R&&(v=!0,R.length>vi.MAX_ADDRESS_LENGTH))throw new fe(a.INVALID_PARAMS_FIELD,{field:`address ${R}`});if(l&&(v=!0,!r.isValidDAppId(l)))throw new fe(a.INVALID_PARAMS_FIELD,{field:`dappid ${l}`});if(u&&(v=!0,!r.isValidLocationName(u)))throw new fe(a.INVALID_PARAMS_FIELD,{field:`lns ${u}`});if(g){if(v=!0,!(g.key&&g.key.length))throw new fe(a.INVALID_PARAMS_FIELD,{field:`storage.key ${g.key}`});if(!(g.value&&g.value.length))throw new fe(a.INVALID_PARAMS_FIELD,{field:`storage.value ${g.value}`})}if(y&&(v=!0,y.length!==vi.MAX_SIGNATURE_LENGTH))throw new fe(a.INVALID_PARAMS_FIELD,{field:`blockSignature ${y}`});if(m!==void 0&&(v=!0,!r.isUint32(m)))throw new fe(a.INVALID_PARAMS_FIELD,{field:`minHeight ${m}`});if(d!==void 0&&(v=!0,!r.isUint32(d)))throw new fe(a.INVALID_PARAMS_FIELD,{field:`maxHeight ${d}`});if(I&&(v=!0,I.length>vi.MAX_ADDRESS_LENGTH))throw new fe(a.INVALID_PARAMS_FIELD,{field:`trusteeId ${I}`});if(T&&(v=!0,!r.isValidDAppId(T)))throw new fe(a.INVALID_PARAMS_FIELD,{field:`purchaseDAppid ${T}`});if(S&&(v=!0,!r.isString(S)))throw new fe(a.INVALID_PARAMS_FIELD,{field:`range ${S}`});if(v===!1)throw new fe("Invalid QueryTransaction query params, no query conditions");if(!r.isUint32(w))throw new fe(a.INVALID_PARAMS_FIELD,{field:`offset ${w}`});if(b&&!r.isUint32(b))throw new fe(a.INVALID_PARAMS_FIELD,{field:`limit ${b}`});const{tIndex:$}=t.sort;if($!==void 0&&$!==-1&&$!==1)throw new fe(a.INVALID_PARAMS_FIELD,{field:`tIndex ${$}`});return t}async boxQueryTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=vo.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new vt(a.INVALID_PARAMS,{error:r,params:e})}if(t.status===be.success){const{transactions:r}=t;for(const n of r)await this.transctionHelper.verifyTransactionSignature(n.transaction,{taskLabel:"QueryTransactionReturn"})}return t}get boxIndexTransactionArg(){return this.boxQueryTransactionArg}async boxIndexTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=Po.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new vt(a.INVALID_PARAMS,{error:r,params:e})}return t}async boxDownloadTransactionArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=Zp.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(s){throw s instanceof qe?s:new vt(a.INVALID_PARAMS,{error:s,params:e})}const{tIndexes:r}=t;if(r.length===0)throw new fe("Invalid Download transaction query params, no query conditions");const n=this.baseHelper;for(const s of r){const{height:i,tIndex:o,length:c}=s;if(!n.isPositiveInteger(i))throw new fe(a.INVALID_PARAMS_FIELD,{field:`height ${i}`});if(!n.isNaturalNumber(o))throw new fe(a.INVALID_PARAMS_FIELD,{field:`tIndex ${o}`});if(!n.isPositiveInteger(c))throw new fe(a.INVALID_PARAMS_FIELD,{field:`length ${c}`})}return t}async boxDownloadTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=xo.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new vt(a.INVALID_PARAMS,{error:r,params:e})}if(t.status===be.success){const{transactions:r}=t;for(const n of r)await this.transctionHelper.verifyTransactionSignature(n.transaction,{taskLabel:"DownloadTransactionReturn"})}return t}async boxNewTransactionArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=qp.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw n instanceof qe?n:new vt(a.INVALID_PARAMS,{error:n,params:e})}const{transaction:r}=t;return await this.transctionHelper.verifyTransactionSignature(r,{taskLabel:"NewTransactionArg"}),t}boxNewTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=ps.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new vt(a.INVALID_PARAMS,{error:r,params:e})}if(t.status===be.success&&(Number.isNaN(parseFloat(t.minFee))||BigInt(t.minFee)<BigInt(0)))throw new fe(a.INVALID_PARAMS_FIELD,{field:"minFee"});return t}async boxOpenBlobArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=mi.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw n instanceof qe?n:new vt(a.INVALID_PARAMS,{error:n,params:e})}const{hash:r}=t;if(r===void 0||r.length!==64)throw new fe("Invalid Open Blob query params, wrong sha256 value");return t}async boxOpenBlobReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=_i.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new vt(a.INVALID_PARAMS,{error:r,params:e})}return t}async boxCloseBlobArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=Bo.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw r instanceof qe?r:new vt(a.INVALID_PARAMS,{error:r,params:e})}return t}async boxCloseBlobReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=nh.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new vt(a.INVALID_PARAMS,{error:r,params:e})}return t}async boxReadBlobArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=Hs.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(s){throw s instanceof qe?s:new vt(a.INVALID_PARAMS,{error:s,params:e})}const{start:r,end:n}=t;if(r<0||r>=n)throw new fe("Invalid Read Blob range");return t}async boxReadBlobReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=Aa.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new vt(a.INVALID_PARAMS,{error:r,params:e})}return t}boxQueryBlockArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=Ho.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(o){throw new vt(a.INVALID_PARAMS,{error:o,params:e})}const r=this.baseHelper,{height:n,signature:s}=t.query;let i=!1;if(n&&(i=!0,!r.isUint32(n)))throw new fe(a.INVALID_PARAMS_FIELD,{field:"height"});if(s&&(i=!0,!r.isValidBlockSignature(s)))throw new fe(a.INVALID_PARAMS_FIELD,{field:"signature"});if(i===!1)throw new fe(a.INVALID_QUERYBLOCKARG_QUERY_PARAMS);return t}async boxQueryBlockReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=ko.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw new vt(a.INVALID_PARAMS,{error:n,params:e})}const{someBlock:r}=t;return t.status===be.success&&r&&await this.blockHelper.verifyBlockSignature(r.block,{taskLabel:"QueryBlockReturn"}),t}boxNewBlockArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});let t;try{t=Fr.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw new vt(a.INVALID_PARAMS,{error:n,params:e})}const r=this.baseHelper;if(!r.isUint32(t.height))throw new fe(a.INVALID_PARAMS_FIELD,{field:`height ${t.height}`});if(!r.isValidBlockSignature(t.signature))throw new fe(a.INVALID_PARAMS_FIELD,{field:`signature ${t.signature}`});if(!r.isValidBlockSignature(t.previousBlockSignature))throw new fe(a.INVALID_PARAMS_FIELD,{field:`previousBlockSignature ${t.previousBlockSignature}`});if(!r.isFiniteBigInt(t.totalFee))throw new fe(a.INVALID_PARAMS_FIELD,{field:`totalFee ${t.totalFee}`});if(!r.isUint32(t.numberOfTransactions))throw new fe(a.INVALID_PARAMS_FIELD,{field:`numberOfTransactions ${t.numberOfTransactions}`});if(!r.isUint32(t.timestamp))throw new fe(a.INVALID_PARAMS_FIELD,{field:`timestamp ${t.timestamp}`});if(!r.isValidPublicKey(t.generatorPublicKeyBuffer))throw new fe(a.INVALID_PARAMS_FIELD,{field:`generatorPublicKey ${t.generatorPublicKey}`});if(!r.isUint32(t.version))throw new fe(a.INVALID_PARAMS_FIELD,{field:`version ${t.version}`});return t}boxNewBlockReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});try{return Lo.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(t){throw new vt(a.INVALID_PARAMS,{error:t,params:e})}}boxGetPeerInfoArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});try{return sh.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(t){throw new vt(a.INVALID_PARAMS,{error:t,params:e})}}boxGetPeerInfoReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{params:e});try{return Mo.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(t){throw new vt(a.INVALID_PARAMS,{error:t,params:e})}}async boxQueryTindexArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{function:"boxQueryTindexArg",params:e});let t;try{t=Xp.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch($){throw new vt(a.INVALID_PARAMS,{function:"boxQueryTindexArg",error:$,params:e})}const r=this.baseHelper,{type:n,signature:s,senderId:i,recipientId:o,dappid:c,lns:l,storage:u,blockSignature:g,minHeight:y,maxHeight:m,trusteeId:d,purchaseDAppid:I,range:T,address:S,offset:w,limit:b}=t.query;let R=!1;if(n&&(R=!0,!r.isValidTransactionType(n)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg",field:`type ${n}`});if(s&&(R=!0,!r.isValidTransactionSignature(s)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`signature ${s}`});if(i&&(R=!0,!await this.accountBaseHelper.isAddress(i)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`senderId ${i}`});if(o&&(R=!0,!await this.accountBaseHelper.isAddress(o)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`recipientId ${o}`});if(c&&(R=!0,!r.isValidDAppId(c)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`dappid ${c}`});if(l&&(R=!0,!r.isValidLocationName(l)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`lns ${l}`});if(u){if(R=!0,!(u.key&&u.key.length))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`storage.key ${u.key}`});if(!(u.value&&u.value.length))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`storage.value ${u.value}`})}if(g&&(R=!0,!r.isValidBlockSignature(g)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`blockSignature ${g}`});if(y!==void 0&&(R=!0,!r.isUint32(y)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`minHeight ${y}`});if(m!==void 0&&(R=!0,!r.isUint32(m)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`maxHeight ${m}`});if(d&&(R=!0,!await this.accountBaseHelper.isAddress(d)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`trusteeId ${d}`});if(I&&(R=!0,!r.isValidDAppId(I)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`purchaseDAppid ${I}`});if(T&&(R=!0,!r.isString(T)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`range ${T}`});if(S&&(R=!0,!await this.accountBaseHelper.isAddress(S)))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`address ${S}`});if(R===!1)throw new fe("Invalid QueryTransaction query params, no query conditions");if(!r.isUint32(w))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`offset ${w}`});if(b&&!r.isUint32(b))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`limit ${b}`});const{tIndex:v}=t.sort;if(v!==void 0&&v!==-1&&v!==1)throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.sort",field:`tIndex ${v}`});return t}async boxQueryTindexReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{function:"boxQueryTindexesReturn",params:e});let t;try{t=Co.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new vt(a.INVALID_PARAMS,{function:"boxQueryTindexesReturn",error:r,params:e})}if(t.status===be.success){const r=t.tIndexes,n=this.baseHelper;for(const s of r)if(!n.isNaturalNumber(s))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxQueryTindexesReturn",field:`tIndexes ${s}`})}return t}async boxGetTransactionInBlockArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{function:"boxGetTransactionInBlockArg",params:e});let t;try{t=Qp.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new vt(a.INVALID_PARAMS,{function:"boxGetTransactionInBlockArg",error:r,params:e})}if(!this.baseHelper.isValidTindexRanges(t.query.tIndexRanges))throw new fe(a.INVALID_PARAMS_FIELD,{function:"boxGetTransactionInBlockArg.query.tIndexRanges",field:`tIndexRanges ${t.query.tIndexRanges}`});return t}async boxGetTransactionInBlockReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new fe(a.INVALID_PARAMS,{function:"boxGetTransactionInBlockReturn",params:e});let t;try{t=Ro.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new vt(a.INVALID_PARAMS,{function:"boxGetTransactionInBlockReturn",error:r,params:e})}if(t.status===be.success){const{transactionInBlocks:r}=t;r.forEach(async n=>{await this.transctionHelper.verifyTransactionSignature(n.transaction,{taskLabel:"GetTransactionInBlockReturn"})})}return t}parserAborterOptions(e,t){if(e.disabledAborterOptions)return;let r;e.aborter&&(r||(r=new yy),this._bindRejectedToPromiseOut(e.aborter.abortedPromise,r));let n;if(e.timeout!==void 0&&(n=typeof e.timeout=="function"?e.timeout(t):e.timeout),e.deadlineTime!==void 0){const s=this.timeHelper.now(),i=e.deadlineTime-s;n?i<n&&(n=i):n=i}if(n!==void 0){const{reject:s}=r||(r=new yy);r.setTimeout(n,()=>s(typeof e.timeoutException=="function"?e.timeoutException(t):e.timeoutException||new eb))}return e.rejected&&(r||(r=new yy),this._bindRejectedToPromiseOut(e.rejected,r)),r}_bindRejectedToPromiseOut(e,t){fa(e,void 0,t.reject),t.onFinished(()=>dl(e,void 0,t.reject))}wrapAborterOptions(e,t,r){const n=t&&this.parserAborterOptions(t,r);return n&&(e.then(n.resolve,n.reject),e=n.promise),e}wrapOutAborterOptions(e,t,r){const n=t&&this.parserAborterOptions(t,r);return n&&(fa(e.promise,n.resolve,n.reject),fa(n.promise,e.resolve,e.reject),e=n),e}getChainChannelTimeout(e,t=3e4){return Math.max(Number.isFinite(e.delay)?e.delay:1e3,2e3)+t}verifyDownloadBlobArgs(e){const{algorithm:t,hash:r,downloadSize:n}=e;if(!Number.isInteger(n))throw new fe(a.INVALID_PARAMS_FIELD,{function:"openArg.downloadSize",field:`openArg.downloadSize ${n}`});if(n<=0)throw new fe(a.INVALID_PARAMS_FIELD,{function:"openArg.downloadSize",field:`openArg.downloadSize ${n}`})}};Fe.MAX_ADDRESS_LENGTH=40,Fe.MAX_SIGNATURE_LENGTH=128,p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxQueryTransactionArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxQueryTransactionReturn",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Fe.prototype,"boxIndexTransactionArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxIndexTransactionReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxDownloadTransactionReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxNewTransactionArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],Fe.prototype,"boxNewTransactionReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxOpenBlobArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxOpenBlobReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxCloseBlobArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxCloseBlobReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxReadBlobArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxReadBlobReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Ho)],Fe.prototype,"boxQueryBlockArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxQueryBlockReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Fr)],Fe.prototype,"boxNewBlockArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Lo)],Fe.prototype,"boxNewBlockReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",sh)],Fe.prototype,"boxGetPeerInfoArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Mo)],Fe.prototype,"boxGetPeerInfoReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxQueryTindexArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxQueryTindexReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxGetTransactionInBlockArg",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",Promise)],Fe.prototype,"boxGetTransactionInBlockReturn",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object,typeof(wA=typeof ENV<"u"&&ENV)=="function"?wA:Object]),h("design:returntype",void 0)],Fe.prototype,"parserAborterOptions",null),p([Me,h("design:type",Function),h("design:paramtypes",[Promise,Object,typeof(NA=typeof ENV<"u"&&ENV)=="function"?NA:Object]),h("design:returntype",void 0)],Fe.prototype,"wrapAborterOptions",null),p([Me,h("design:type",Function),h("design:paramtypes",[Kt,Object,typeof(OA=typeof ENV<"u"&&ENV)=="function"?OA:Object]),h("design:returntype",void 0)],Fe.prototype,"wrapOutAborterOptions",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object,Object]),h("design:returntype",void 0)],Fe.prototype,"getChainChannelTimeout",null),Fe=vi=p([j(),h("design:paramtypes",[Re,_e,ht,xt,de])],Fe);var{RefuseException:$r,ArgumentFormatException:vA,NoFoundException:CA,error:tb,TimeOutException:my,success:RA,log:PA}=Z("channel","chainChannel"),xA=class extends x_{toBlockGetterHelper(e){return this._blockGetterHelper||(this._blockGetterHelper={getBlockByHeight:t=>this.findBlock({height:t}),getBlockBySignature:t=>this.findBlock({signature:t}),maxHeight:1,lastBlock:oa.fromObject(this.config.genesisBlock),async getLastBlock(){if(this.lastBlock.height!==this.maxHeight){const t=await this.getBlockByHeight(this.maxHeight);if(!t)throw new CA;this.lastBlock=t}return this.lastBlock}}),e&&(this.baseHelper.isPositiveFloatNotContainZero(e.maxHeight)&&(this._blockGetterHelper.maxHeight=e.maxHeight),e.lastBlock&&(this._blockGetterHelper.lastBlock=e.lastBlock)),this._blockGetterHelper}},Gs=new Map,BA=new Uint32Array(1),rb=()=>{const e=BA[0]++||BA[0]++,t=Gs.get(e);return t&&(t.reject(new my(a.REQID_REUSE)),Gs.delete(e)),e},Oh=new Map([[Ae.QUERY_TRANSACTION,Ae.QUERY_TRANSACTION_RETURN],[Ae.INDEX_TRANSACTION,Ae.INDEX_TRANSACTION_RETURN],[Ae.DOWNLOAD_TRANSACTION,Ae.DOWNLOAD_TRANSACTION_RETURN],[Ae.NEW_TRANSACTION,Ae.NEW_TRANSACTION_RETURN],[Ae.QUERY_BLOCK,Ae.QUERY_BLOCK_RETURN],[Ae.NEW_BLOCK,Ae.NEW_BLOCK_RETURN],[Ae.GET_PEER_INFO,Ae.GET_PEER_INFO_RETURN],[Ae.OPEN_BLOB,Ae.OPEN_BLOB_RETURN],[Ae.READ_BLOB,Ae.READ_BLOB_RETURN],[Ae.CLOSE_BLOB,Ae.CLOSE_BLOB_RETURN]]),nb=2,Ks=class extends xA{constructor(e,t=1e3){super(),this.endpoint=e,this.refuseTime=t,this._canQueryTindex=!1,this._canGetTransactionInBlock=!1,this._limitQT=100,this._limitIT=100,this._limitDT=100,this.MESSAGE_VERSION=2,this._closed=!1,this._maybeHeight=1,this._lastConsensusVersion=1,this._address="",this._delayHistroyList=new Float32Array(32),this._reqIdSet=new Set,this.reqresLimitInfoEM=Gt.from({creater(r){return{preResponseTime:0,preRefuseTime:0,preResponseLimitConfig:{lockTimespan:0,refuseTimespan:1/0}}}}),this._msgPostQuene=Gt.from({creater:r=>{const n={taskList:[],running:!1,looper:async()=>{if(!n.running){n.running=!0;do{const s=n.taskList.shift();if(s===void 0)break;const i=this.reqresLimitInfoEM.get(r);if(i!==void 0){const l=i.preResponseTime+i.preResponseLimitConfig.lockTimespan-this.timeHelper.now();l>0&&(PA("req chainChannel(%s) cmd:%d need wait %dms",this.address,s.cmd,l),await xs(l))}if(s.sign.is_rejected)continue;const o=Wr.fromObject({version:this.config.version,req_id:s.req_id,cmd:s.cmd,binary:s.binary,messageVersion:this.MESSAGE_VERSION});this.endpoint.postMessage(o.getBytes()),s.sign.resolve();const c=Gs.get(s.req_id);c&&await new Promise(l=>c.onFinished(l))}while(n.taskList.length>0);this._msgPostQuene.delete(r)}}};return n}}),this._openedBlobs=new Set,this._busyNewTransaction=0,this.initOnMessage(),e.onClose(()=>{this._closed=!0;for(const r of this._reqIdSet){const n=Gs.get(r);n&&(n.reject(new my(a.CHAINCHANNEL_CLOSED)),Gs.delete(r))}this._reqIdSet.clear()})}get canQueryTransactions(){return!1}get canIndexTransactions(){return!1}get canDownloadTransactions(){return!0}get blobSupportAlgorithms(){return[]}get canQueryBlock(){return!0}get canBroadcastTransaction(){return!0}get canBroadcastBlock(){return!0}get canQueryTindex(){return this._canQueryTindex}get canGetTransactionInBlock(){return this._canGetTransactionInBlock}get limitQueryTransactions(){return this._limitQT}get limitIndexTransactions(){return this._limitIT}get limitDownloadTransactions(){return this._limitDT}get defaultReqOptions(){}get diffTime(){return 0}onClose(e,t){if(t){const r=this.endpoint.onClose(n=>{e(n),r()});return r}else return this.endpoint.onClose(e)}close(e){return this.endpoint.close(e)}get maybeHeight(){return this._maybeHeight}get lastConsensusVersion(){return this._lastConsensusVersion}get address(){return this._address}set address(e){this._address=e}get delay(){if(this._delayCache)return this._delayCache.value;const{_delayHistroyList:e}=this;let t=0,r=e.length;for(let s=0;s<e.length;s+=1){const i=e[s];i?t+=i:r-=1}const n=t/r||0;return this._delayCache={value:n},n}pushDelayHistroy(e){const{_delayHistroyList:t}=this,r=t.length;t.set(t.subarray(1,r),0),t[r-1]=e,this._delayCache=void 0}_request(e,t,r,n){return this._requestWithBinaryData(e,this._requestDataToBinary(t),r,n)}_requestDataToBinary(e){return new Uint8Array(e.constructor.encode(e).finish())}_sendWithBinaryData(e,t){return this.postChainChannelMessage(0,e,t)}async _requestWithBinaryData(e,t,r,n=this.defaultReqOptions){const s=rb();this._reqIdSet.add(s),await this.postChainChannelMessage(s,e,t);let i=new Kt;i.onFinished(()=>{Gs.delete(s),this._reqIdSet.delete(s)}),Gs.set(s,i),n&&(n.timeout||(n.timeout=1e3),n.timeoutException===void 0&&(n=Object.create(n,{timeoutException:{get(){return new my(a.CHAINCHANNEL_TIMEOUT,{endpoint:this.endpoint,cmd:Ae[e]})}}})),i=this.chainChannelHelper.wrapOutAborterOptions(i,n,{chainChannel:this}));const o=await r(await i.promise);return await this.emit("afterRequestWithBinaryData",{cmd:e,query:t,res:o}),o}_getMaybeQueneTimeCache(){let e=this._maybeQueneTimeFastCache;return e===void 0&&(e=this._maybeQueneTimeFastCache={cache:new Map,releaser:queueMicrotask(()=>this._maybeQueneTimeFastCache=void 0)}),e.cache}getApiMaybeQueueTime(e){if(!(e&Ae.RESPONSE))return 0;const t=this._getMaybeQueneTimeCache();let r=t.get(e);if(r===void 0){const n=this.reqresLimitInfoEM.get(e);if(n===void 0)r=0;else{const s=n.preResponseTime+n.preResponseLimitConfig.lockTimespan,i=Math.max(0,s-this.timeHelper.now()),o=this._msgPostQuene.get(e);o===void 0?r=i:r=o.taskList.length*n.preResponseLimitConfig.lockTimespan+i}t.set(e,r)}return r}async postChainChannelMessage(e,t,r){if(this._closed)return;let n=0,s=0;if(Oh.has(t)){if(this.reqresLimitInfoEM.get(t)!==void 0){const o=this._msgPostQuene.forceGet(t),c=new Kt;return o.taskList.push({req_id:e,cmd:t,binary:r,sign:c}),o.looper(),c.promise}}else if(t&Ae.RESPONSE&&this.has("onGetResponseLimitConfig")){let o=this.reqresLimitInfoEM.get(t);const c=this.timeHelper.now();if(o){const u=o.preResponseLimitConfig;(o.preResponseTime||c)+u.lockTimespan<c&&(o=void 0)}const l=await this.emit("onGetResponseLimitConfig",{cmd:t,requestLimitInfo:o});l!==void 0&&(o=o||this.reqresLimitInfoEM.forceGet(t),o.preResponseTime=c,o.preResponseLimitConfig=l,n=l.lockTimespan,s=l.refuseTimespan)}const i=Wr.fromObject({version:this.config.version,req_id:e,cmd:t,binary:r,lockTimespan:n,refuseTimespan:s,messageVersion:this.MESSAGE_VERSION});return this.endpoint.postMessage(i.getBytes())}async queryTransactions(e,t,r){if(!this.canQueryTransactions)return vo.fromObject({status:be.error,error:Tt.fromObject(new $r(a.REFUSE_RESPONSE_QUERY_TRANSACTION))});const n=ma.fromObject({query:tt.fromObject(e),sort:Xr.fromObject(t||{})}),s=await this._request(Ae.QUERY_TRANSACTION,n,this.chainChannelHelper.boxQueryTransactionReturn,r);return await this._downloadBlobFromTibs(s.transactions),s}async indexTransactions(e,t,r){if(!this.canIndexTransactions)return Po.fromObject({status:be.error,error:Tt.fromObject(new $r(a.REFUSE_RESPONSE_INDEX_TRANSACTION))});const n=Wp.fromObject({query:tt.fromObject(e),sort:Xr.fromObject(t||{})});return this._request(Ae.INDEX_TRANSACTION,n,this.chainChannelHelper.boxIndexTransactionReturn,r)}async downloadTransactions(e,t){if(!this.canDownloadTransactions)return xo.fromObject({status:be.error,error:Tt.fromObject(new $r(a.REFUSE_RESPONSE_DOWNLOAD_TRANSACTION))});const r=Zp.fromObject({tIndexes:e.map(s=>hs.fromObject(s))}),n=await this._request(Ae.DOWNLOAD_TRANSACTION,r,this.chainChannelHelper.boxDownloadTransactionReturn,t);return await this._downloadBlobFromTibs(n.transactions),n}async openBlob(e,t){if(!this.blobSupportAlgorithms.includes(e.algorithm))return _i.fromObject({status:be.error,error:Tt.fromObject(new $r(a.REFUSE_RESPONSE_OPEN_BLOB))});const r=mi.fromObject(e),n=await this._request(Ae.OPEN_BLOB,r,this.chainChannelHelper.boxOpenBlobReturn,t);return n.descriptor&&this._openedBlobs.add(n.descriptor),n}async readBlob(e,t){if(this._openedBlobs.has(e.descriptor)===!1)return Aa.fromObject({status:be.error,error:Tt.fromObject(new $r(a.REFUSE_RESPONSE_READ_BLOB))});const r=Hs.fromObject(e);return this._request(Ae.READ_BLOB,r,this.chainChannelHelper.boxReadBlobReturn,t)}async closeBlob(e,t){if(this._openedBlobs.has(e.descriptor)===!1)return nh.fromObject({status:be.error,error:Tt.fromObject(new $r(a.REFUSE_RESPONSE_CLOSE_BLOB))});const r=Bo.fromObject(e),n=await this._request(Ae.CLOSE_BLOB,r,this.chainChannelHelper.boxCloseBlobReturn,t);return n.status===be.success&&this._openedBlobs.delete(e.descriptor),n}async downloadBlob(e){this.chainChannelHelper.verifyDownloadBlobArgs(e);const t={totalSize:-1,totalCount:-1,currentCount:-1};if(await this.blobHelper.exists(e))return;let r;try{const n=await this.openBlob(e);if(n.status===be.busy&&await xs(5e3),n.status!==be.success)throw n.error;r=n.descriptor;const s=e.downloadSize;let i=1024*1024;i=i<s?i:s;const o=await this.blobHelper.requestStorage(e,s,i,n.contentType,0),c=Math.ceil(s/i),l=s-(c-1)*i;t.totalSize=s,t.totalCount=c,t.currentCount=0;const u=[];for(let d=0;d<c;d++)u.push(async()=>{let I=0,T=!1,S=0;for(;I<3;)try{const w=i*d,b=await this.readBlob({descriptor:r,start:w,end:d===c-1?w+l:w+i});if(b.status===be.busy||b.status!==be.success)throw b;if(S=b.chunkBuffer.length,S===0)break;await this.blobHelper.saveChunk(o,d,b.chunkBuffer),T=!0;break}catch(w){if(I++,I>=3)throw w;await xs(100)}return{isSuccess:T,bytesRead:S}});let g=0,y=!0,m=0;e:for(;;){const d=u.slice(g,g+3);if(d.length===0)break;const I=await Promise.all(d.map(T=>T()));for(const T of I){if(T.isSuccess===!1){y=!1;break e}m+=T.bytesRead}g+=d.length}if(!y)throw new $r(a.FAIL_TO_DOWNLOAD_BLOB,{hash:e.hash,size:s});if(m!==s)throw new $r(a.NOT_MATCH,{to_compare_prop:`downloadSize ${m}`,to_target:"real downloaded",be_compare_prop:`downloadSize ${s}`,be_target:"transaction blob"});await this.blobHelper.saveAsBlob(o)}finally{if(r!==void 0)try{await this.closeBlob({descriptor:r})}catch{}}}async _downloadBlobFromTibs(e){for(const t of e)await this.downloadBlobFromTrs(t.transaction)}async downloadBlobFromTrs(e){for(const[r,n,s,i]of e.blobMap.values())await this.downloadBlob({algorithm:r,hash:n,downloadSize:i});const t=this.transactionCore.transactionHelper;switch(e.type){case t.MACRO_CALL:{const{transaction:r}=e.asset.call;await this.downloadBlobFromTrs(r);break}case t.PROMISE_RESOLVE:{const{transaction:r}=e.asset.resolve;await this.downloadBlobFromTrs(r);break}case t.MULTIPLE:{const{transactions:r}=e.asset.multiple;for(const n of r)await this.downloadBlobFromTrs(n);break}}}async initBroadcastTransactionArg(e,t){const r=qp.fromObject({transaction:e instanceof J?e:await this.transactionCore.recombineTransaction(e),grabSecret:t?.grabSecret});return[Ae.NEW_TRANSACTION,this._requestDataToBinary(r),this.chainChannelHelper.boxNewTransactionReturn,t]}calcDiffTimeToTargetTime(e){return this.timeHelper.now()+this.diffTime-e}async broadcastTransaction(e,t){if(!this.canBroadcastTransaction)return ps.fromObject({status:be.error,error:Tt.fromObject(new $r(a.REFUSE_RESPONSE_BROADCAST_TRANSACTION))});const r=await this.initBroadcastTransactionArg(e,t),n=-this.calcDiffTimeToTargetTime(this.timeHelper.getTimeByTimestamp(e.timestamp));n>0&&(PA("chainChannel(%s) seems in feature. need wait %dms then broadcast.",this.address,n),await xs(n));const s=await this._requestWithBinaryData(...r);return RA("broadcasted Transaction(%s)",this.transactionCore.transactionHelper.getTypeName(e.type),e.asset),s}get isRefusePushNewTransaction(){return this.canBroadcastTransaction?this._busyNewTransaction>this.timeHelper.now()-this.refuseTime:!0}async fastBroadcastTransaction(e){if(this.isRefusePushNewTransaction)return 0;const t=await this.initBroadcastTransactionArg(e);return await this._sendWithBinaryData(t[0],t[1]),1}async queryBlock(e,t){if(!this.canQueryBlock)return ko.fromObject({status:be.error,error:Tt.fromObject(new $r(a.REFUSE_RESPONSE_QUERY_BLOCK))});const r=Ho.fromObject({query:Ia.fromObject(e)});return this._request(Ae.QUERY_BLOCK,r,this.chainChannelHelper.boxQueryBlockReturn,t)}async findBlock(e,t){const r=await this.queryBlock(e,t);return r.someBlock&&r.someBlock.block}initBroadcastBlockArg(e,t){const r=Fr.fromObject(e);return r.generatorPublicKey=e.generatorPublicKey,[Ae.NEW_BLOCK,this._requestDataToBinary(r),this.chainChannelHelper.boxNewBlockReturn,t]}async broadcastBlock(e,t){if(!this.canBroadcastBlock)return Lo.fromObject({status:be.error,error:Tt.fromObject(new $r(a.REFUSE_RESPONSE_BROADCAST_BLOCK))});const r=await this._requestWithBinaryData(...this.initBroadcastBlockArg(e,t));return RA("broadcasted block:",e.height),r}async queryTindexes(e,t,r){if(!this.canQueryTindex)return Co.fromObject({status:be.error,error:Tt.fromObject(new $r("Refuse response query transaction index"))});const n=ma.fromObject({query:tt.fromObject(e),sort:Xr.fromObject(t||{})});return this._request(Ae.QUERY_TINDEX,n,this.chainChannelHelper.boxQueryTindexReturn,r)}async queryTransactionInBlocks(e,t){if(!this.canGetTransactionInBlock)return Ro.fromObject({status:be.error,error:Tt.fromObject(new $r("Refuse response query transactionInBlock"))});const r=Qp.fromObject({query:_a.fromObject(e)});return this._request(Ae.GET_TRANSACTIONINBLOCK,r,this.chainChannelHelper.boxGetTransactionInBlockReturn,t)}initOnMessage(){this.endpoint.onMessage(async e=>{try{let t,r,n,s,i;try{s=Wr.decode(e),t=s.req_id,r=s.cmd,n=s.binary,i=s.messageVersion}catch{throw new vA(a.MESSAGE_TYPE_ERROR)}if(i<nb)return;let o,c;const l=(u,g)=>(u.status=be.error,u.error=Tt.fromException(g),u);try{let u=!0;if(Oh.has(r)){const g=r|Ae.RESPONSE,y=this.reqresLimitInfoEM.get(g),m=this.timeHelper.now();let d=0;if(y){const I=m-y.preResponseTime;I<y.preResponseLimitConfig.lockTimespan&&(y.preResponseLimitConfig.lockTimespan-I>y.preResponseLimitConfig.refuseTimespan?d=2:d=1)}if(this.has("onBreakRequestLimit")){const I=await this.emit("onBreakRequestLimit",{cmd:r,requestLimitStrategy:d,requestLimitInfo:y});I!==void 0&&(d=I.requestLimitStrategy)}if(d===2){y&&(y.preRefuseTime=m),await this.postChainChannelMessage(t,Ae.REFUSE,new Uint8Array(0));return}d===1&&(u=!1)}else if(r&Ae.RESPONSE){const g=r-Ae.RESPONSE;let y=this.reqresLimitInfoEM.get(g);const{lockTimespan:m,refuseTimespan:d}=s,I=m!==0||d!==0;y===void 0?I&&(y=this.reqresLimitInfoEM.forceGet(g),y.preResponseTime=this.timeHelper.now(),y.preResponseLimitConfig={lockTimespan:m,refuseTimespan:d}):I===!1?this.reqresLimitInfoEM.delete(g):(y.preResponseTime=this.timeHelper.now(),y.preResponseLimitConfig={lockTimespan:m,refuseTimespan:d})}switch(r){case Ae.QUERY_TRANSACTION:{if(u&&this.has("onQueryTransactionBinary")){c=await this.emit("onQueryTransactionBinary",await this.chainChannelHelper.boxQueryTransactionArg(n));break}const g=vo.fromObject({status:be.busy}),y=u&&this.has("onQueryTransaction")?await this.emit("onQueryTransaction",await this.chainChannelHelper.boxQueryTransactionArg(n)):void 0;y&&(g.status=be.success,g.transactions=y.transactions.map(m=>Xt.fromObject(m))),o=g;break}case Ae.INDEX_TRANSACTION:{if(u&&this.has("onIndexTransactionBinary")){c=await this.emit("onIndexTransactionBinary",await this.chainChannelHelper.boxIndexTransactionArg(n));break}const g=Po.fromObject({status:be.busy}),y=u&&this.has("onQueryTransaction")?await this.emit("onIndexTransaction",await this.chainChannelHelper.boxIndexTransactionArg(n)):void 0;y&&(g.status=be.success,g.tIndexes=y.tIndexes.map(m=>hs.fromObject(m))),o=g;break}case Ae.DOWNLOAD_TRANSACTION:{if(u&&this.has("onDownloadTransactionBinary")){c=await this.emit("onDownloadTransactionBinary",await this.chainChannelHelper.boxDownloadTransactionArg(n));break}const g=xo.fromObject({status:be.busy}),y=u&&this.has("onDownloadTransaction")?await this.emit("onDownloadTransaction",await this.chainChannelHelper.boxDownloadTransactionArg(n)):void 0;y&&(g.status=be.success,g.transactions=y.transactions.map(m=>Xt.fromObject(m))),o=g;break}case Ae.NEW_TRANSACTION:{const g=ps.fromObject({status:be.busy}),y=this.has("onNewTransaction")?await this.emit("onNewTransaction",await this.chainChannelHelper.boxNewTransactionArg(n)):void 0;y&&(g.status=be.success,g.minFee=y.minFee,g.newTrsStatus=y.newTrsStatus,g.refuseReason=y.refuseReason,g.errorCode=y.errorCode,g.errorMessage=y.errorMessage),o=g;break}case Ae.OPEN_BLOB:{const g=_i.fromObject({status:be.busy}),y=await this.chainChannelHelper.boxOpenBlobArg(n),m=this.has("onOpenBlob")?await this.emit("onOpenBlob",y):await this.blobHelper.open(y);m&&(g.status=be.success,g.descriptor=m.descriptor,g.contentType=m.contentType),o=g;break}case Ae.READ_BLOB:{const g=Aa.fromObject({status:be.busy}),y=await this.chainChannelHelper.boxReadBlobArg(n),m=this.has("onReadBlob")?await this.emit("onReadBlob",y):await this.blobHelper.read(y);m&&(g.status=be.success,g.chunkBuffer=m.chunkBuffer),o=g;break}case Ae.CLOSE_BLOB:{const g=nh.fromObject({status:be.busy}),y=await this.chainChannelHelper.boxCloseBlobArg(n);(this.has("onCloseBlob")?await this.emit("onCloseBlob",y):await this.blobHelper.close(y))&&(g.status=be.success),o=g;break}case Ae.QUERY_BLOCK:{if(u&&this.has("onQueryBlockBinary")){c=await this.emit("onQueryBlockBinary",this.chainChannelHelper.boxQueryBlockArg(n));break}const g=ko.fromObject({status:be.busy}),y=u&&this.has("onQueryBlock")?await this.emit("onQueryBlock",this.chainChannelHelper.boxQueryBlockArg(n)):void 0;if(y&&y.block!==void 0){g.status=be.success;const m=y.block;if(m){const d=new Proxy(It.fromObject(m),{get(I,T,S){return T==="transactions"||T==="transactionBufferList"?[]:Reflect.get(I,T,S)}});g.someBlock=pi.fromObject({block:d})}}o=g;break}case Ae.NEW_BLOCK:{const g=Lo.fromObject({status:be.busy}),y=this.chainChannelHelper.boxNewBlockArg(n);this._maybeHeight=y.height,this.has("onNewBlock")&&await this.emit("onNewBlock",y)&&(g.status=be.success),o=g;break}case Ae.GET_PEER_INFO:{const g=Mo.fromObject({status:be.busy}),y=this.has("onGetPeerInfo")?await this.emit("onGetPeerInfo",this.chainChannelHelper.boxGetPeerInfoArg(n)):void 0;y&&y.peerInfo&&(g.status=be.success,g.peerInfo=qr.fromObject(y.peerInfo)),o=g;break}case Ae.QUERY_TINDEX:{const g=Co.fromObject({status:be.busy}),y=this.has("onQueryTindexes")?await this.emit("onQueryTindexes",await this.chainChannelHelper.boxQueryTransactionArg(n)):void 0;y&&(g.status=be.success,g.tIndexes=y.tIndexes),o=g;break}case Ae.GET_TRANSACTIONINBLOCK:{const g=Ro.fromObject({status:be.busy}),y=this.has("onGetTransactionInBlocks")?await this.emit("onGetTransactionInBlocks",await this.chainChannelHelper.boxGetTransactionInBlockArg(n)):void 0;y&&(g.status=be.success,g.transactionInBlocks=y.transactionInBlocks.map(m=>Xt.fromObject(m))),o=g;break}case Ae.QUERY_TRANSACTION_RETURN:case Ae.INDEX_TRANSACTION_RETURN:case Ae.DOWNLOAD_TRANSACTION_RETURN:case Ae.NEW_TRANSACTION_RETURN:case Ae.QUERY_BLOCK_RETURN:case Ae.NEW_BLOCK_RETURN:case Ae.GET_PEER_INFO_RETURN:case Ae.OPEN_BLOB_RETURN:case Ae.READ_BLOB_RETURN:case Ae.CLOSE_BLOB_RETURN:case Ae.QUERY_TINDEX_RETURN:case Ae.GET_TRANSACTIONINBLOCK_RETURN:case Ae.RESPONSE:{const g=Gs.get(t);if(g===void 0){if(t!==0)tb(new CA(a.ONMESSAGE_GET_INVALID_REQ_ID,{req_id:t}));else if(r===Ae.NEW_TRANSACTION_RETURN){const{status:y}=this.chainChannelHelper.boxNewTransactionReturn(n);y===be.busy&&(this._busyNewTransaction=this.timeHelper.now())}return}g.resolve(n);break}case Ae.REFUSE:{const g=Gs.get(t);if(g!==void 0){g.reject(new $r(a.REQUEST_LIMIT));return}this.close("chain channel refuse accpet data.");return}default:throw new vA(a.INVALID_MESSAGE_CMD,{cmd:r})}}catch(u){const g=l(Qt.fromObject({status:be.error}),u);throw await this.postChainChannelMessage(t,Oh.get(r)||Ae.RESPONSE,Qt.encode(g).finish()),u}if(c){await this.postChainChannelMessage(t,Oh.get(r)||Ae.RESPONSE,c);return}o&&await this.postChainChannelMessage(t,Oh.get(r)||Ae.RESPONSE,o.constructor.encode(o).finish())}catch(t){this.emit("handleMessageError",{handleName:"onMessage",error:t})}})}};p([k("bfchain-core:TransactionCore"),h("design:type",Object)],Ks.prototype,"transactionCore",void 0),p([k(re),h("design:type",re)],Ks.prototype,"config",void 0),p([k(Re),h("design:type",Re)],Ks.prototype,"baseHelper",void 0),p([k(xt),h("design:type",xt)],Ks.prototype,"timeHelper",void 0),p([k(Fe),h("design:type",Fe)],Ks.prototype,"chainChannelHelper",void 0),p([k(Ii),h("design:type",Ii)],Ks.prototype,"blobHelper",void 0),Ks=p([Wi(),Se(0,k(Xh.ENDPOINT)),Se(1,k(Xh.REFUSETIME,{optional:!0})),h("design:paramtypes",[Object,Object])],Ks);var sb=class extends Kt{constructor(e){super(),this.filter=e}match(e){return this.filter===void 0||this.filter(e)}},ib=class{constructor(){this._queue=new Set}get size(){return this._queue.size}enqueue(e){const t=new sb(e);return this._queue.add(t),t}dequeue(e){for(const t of this._queue)if(t.match(e))return t.resolve(e),this._queue.delete(t),t}},_y,Ay,Iy,Ey,Ty;Z("channel","chainChannelGroup");var vh=class{constructor(){this._inQueneTaskMap=new Map,this._generateQueneTask=(e,t)=>{const r=this._doRequest(e,t).then(n=>(r.resolved=r.finished=!0,this._inQueneTaskMap.has(e)&&this._retCCMap.set(n,e),n),n=>{throw r.rejected=r.finished=!0,this._inQueneTaskMap.has(e)&&this._retCCMap.set(n,e),n});return r},this._retCCMap=new Map}addChainChannel(e,t){return this._inQueneTaskMap.has(e)||this._inQueneTaskMap.set(e,this._generateQueneTask(e,t)),this.helper.wrapAborterOptions(H_(this._inQueneTaskMap.values()),t,{chainChannel:e})}removeChainChannel(e){return this._inQueneTaskMap.delete(e)}removeChainChannelByResult(e){const t=this._retCCMap.get(e);return t?this.removeChainChannel(t):!1}getChainChannelByResult(e){return this._retCCMap.get(e)}finish(){this._inQueneTaskMap.clear(),this._retCCMap.clear()}},yu={QUERY:Symbol("query"),SORT:Symbol("sort")},mu=_y=class extends vh{constructor(e,t){super(),this.query=e,this.sort=t}_doRequest(e,t){return e.queryTransactions(this.query,this.sort,t)}static create(e,t,r){return At(_y,new je([[yu.QUERY,t],[yu.SORT,r]],e))}};p([k(Fe),h("design:type",Fe)],mu.prototype,"helper",void 0),mu=_y=p([Wi(),Se(0,k(yu.QUERY)),Se(1,k(yu.SORT,{optional:!0})),h("design:paramtypes",[Object,Object])],mu);var _u={QUERY:Symbol("query"),SORT:Symbol("sort")},Au=Ay=class extends vh{constructor(e,t){super(),this.query=e,this.sort=t}_doRequest(e,t){return e.indexTransactions(this.query,this.sort,t)}static create(e,t,r){return At(Ay,new je([[_u.QUERY,t],[_u.SORT,r]],e))}};p([k(Fe),h("design:type",Fe)],Au.prototype,"helper",void 0),Au=Ay=p([Wi(),Se(0,k(_u.QUERY)),Se(1,k(_u.SORT,{optional:!0})),h("design:paramtypes",[Object,Object])],Au);var HA={TINDEXES:Symbol("tIndexes")},Iu=Iy=class extends vh{constructor(e){super(),this.tIndexes=e}_doRequest(e,t){return e.downloadTransactions(this.tIndexes,t)}static create(e,t){return At(Iy,new je([[HA.TINDEXES,t]],e))}};p([k(Fe),h("design:type",Fe)],Iu.prototype,"helper",void 0),Iu=Iy=p([Wi(),Se(0,k(HA.TINDEXES)),h("design:paramtypes",[Array])],Iu);var kA={QUERY:Symbol("query")},Eu=Ey=class extends vh{constructor(e){super(),this.query=e}_doRequest(e,t){return e.queryBlock(this.query,t)}getTimeoutExceptionInfo(){return["[TIMEOUT]: queryBlock({query}).",{query:this.query}]}_getFinishInfo(){return{message:"finish queryBlock from other chainChannel"}}static create(e,t,r){return At(Ey,new je([[kA.QUERY,t]],e))}};p([k(Fe),h("design:type",Fe)],Eu.prototype,"helper",void 0),Eu=Ey=p([Wi(),Se(0,k(kA.QUERY)),h("design:paramtypes",[Object])],Eu);var LA={QUERY:Symbol("query")},Sy=Ty=class extends vh{constructor(e){super(),this.query=e}_doRequest(e,t){return e.queryTransactionInBlocks(this.query,t)}getTimeoutExceptionInfo(){return["queryTransactionInBlocks({query} / {sort}) timeout.",{query:JSON.stringify(this.query)}]}_getFinishInfo(){return{message:"finish queryTransactionInBlocks from other chainChannel"}}static create(e,t,r){return At(Ty,new je([[LA.QUERY,t]],e))}};p([k(Fe),h("design:type",Fe)],Sy.prototype,"helper",void 0),Sy=Ty=p([Wi(),Se(0,k(LA.QUERY)),h("design:paramtypes",[Object])],Sy);var{error:by}=Z("channel","IntSet"),ab=class{constructor(e){this._src=e,this._end=1/0,this._maybeEnd=-1/0,this._srcIte=this._src[Symbol.iterator](),this._rl=[]}setEnd(e){this._end=e,this._maybeEnd=e}_previewSrcNext(){const e=this._cachedSrcNext||(this._cachedSrcNext=this._srcIte.next());if(e.done===!1)return this._maybeEnd=e.value;this._end=this._maybeEnd}_srcNext(){const e=this._previewSrcNext();return e!==void 0&&(this._cachedSrcNext=void 0),e}getSerialRangeSet(e){let t=-1/0,r=0;const n=this._rl[Symbol.iterator]();let s=n.next();if(s.done===!1){if(t=s.value,r=1,r>=e)return{start:t,length:r};delete this._rl[t];do{if(s=n.next(),s.done)break;const i=s.value;if(i-r===t){if(delete this._rl[i],++r,r>=e)return{start:t,length:r}}else return{start:t,length:r}}while(!0)}if(t===-1/0){const i=this._srcNext();if(i===void 0)return;if(t=i,r=1,r>=e)return{start:t,length:r}}do{const i=this._previewSrcNext();if(i===void 0)return{start:t,length:r};if(i-r===t){if(this._cachedSrcNext=void 0,++r,r>=e)break}else break}while(!0);return{start:t,length:r}}getRangeSet(e){let t=0;const r=[];do{const n=this.getSerialRangeSet(e);if(n===void 0||(r[r.length]=n,t+=n.length,t>=e))break}while(!0);return r}recycle(e){if(Number.isInteger(e)===!1){by("num:%o is not an integer",e);return}const t=this._previewSrcNext();if(t!==void 0){if(e>t){by("num:%d large then the next integer:%d",e,this._end);return}}else if(e>this._end){by("num:%d large then the end:%d",e,this._end);return}this.recycleUnSafe(e)}recycleUnSafe(e){this._rl[e]=e}recycleManyUnsafe(e){for(const t of e)this._rl[t]=t}},{AbortException:Tu,InterruptedException:ob,error:ec,success:MA,info:cb,warn:Ch,log:DA,TimeOutException:Rh,IdempotentException:tc}=Z("channel","chainChannelGroup"),Ph={GROUP_NAME:Symbol("groupName"),CHANNEL_LIST:Symbol("channelList"),OPTIONS:Symbol("options")},Mt=class extends xA{constructor(e,t="",r){super(),this.groupName=t,this._ccBlobSupportAlgorithms=Gt.from({creater:n=>{const s=cs.from({afterDelete:()=>{s.size===0&&this._ccBlobSupportAlgorithms.delete(n)}});return s}}),this._initBlobSupportAlgorithmsBinding=!1,this.chainChannelSet=new Set,this.options={},this._parallelTasksMap=new Map,this._workCountWM=new Ga(n=>0),this._DAWCLWM=new WeakMap,this._maybeHeight=1,this._lastConsensusVersion=1,r&&Object.assign(this.options,r);for(const n of e)this.addChainChannel_(n,this.options)}get canQueryTransactions(){for(const e of this.chainChannelSet)if(e.canQueryTransactions)return!0;return!1}get canIndexTransaction(){for(const e of this.chainChannelSet)if(e.canIndexTransactions)return!0;return!1}get canDownloadTransaction(){for(const e of this.chainChannelSet)if(e.canDownloadTransactions)return!0;return!1}get blobSupportAlgorithms(){var e;const t=this._ccBlobSupportAlgorithms;if(this._initBlobSupportAlgorithmsBinding===!1){this._initBlobSupportAlgorithmsBinding=!0;for(const r of this.chainChannelSet)for(const n of r.blobSupportAlgorithms)t.forceGet(n).add(r);this._chainChannelEvents.on("addChainChannel",r=>{for(const n of r.blobSupportAlgorithms)t.forceGet(n).add(r);this._blobSupportAlgorithms=void 0}),this._chainChannelEvents.on("removeChainChannel",r=>{for(const n of r.blobSupportAlgorithms)t.forceGet(n).delete(r);this._blobSupportAlgorithms=void 0})}return(e=this._blobSupportAlgorithms)!==null&&e!==void 0?e:this._blobSupportAlgorithms=[...t.keys()]}get canQueryBlock(){for(const e of this.chainChannelSet)if(e.canQueryBlock)return!0;return!1}get canBroadcastTransaction(){for(const e of this.chainChannelSet)if(e.canBroadcastTransaction)return!0;return!1}get canBroadcastBlock(){for(const e of this.chainChannelSet)if(e.canBroadcastBlock)return!0;return!1}get limitQueryTransactions(){let e=0;for(const t of this.chainChannelSet){const{limitQueryTransactions:r}=t;r>e&&(e=r)}return e}get limitIndexTransactions(){let e=0;for(const t of this.chainChannelSet){const{limitIndexTransactions:r}=t;r>e&&(e=r)}return e}get limitDownloadTransactions(){let e=0;for(const t of this.chainChannelSet){const{limitDownloadTransactions:r}=t;r>e&&(e=r)}return e}getApiMaybeQueueTime(e){let t=1/0;for(let r of this.chainChannelSet)if(t=Math.min(r.getApiMaybeQueueTime(e),t),t===0)break;return t}get canQueryTindex(){for(const e of this.chainChannelSet)if(e.canQueryTindex)return!0;return!1}get canGetTransactionInBlock(){for(const e of this.chainChannelSet)if(e.canGetTransactionInBlock)return!0;return!1}bfOnInit(){let e=this._maybeHeight;for(const t of this.chainChannelSet)e=Math.max(t.maybeHeight,e);this._tryChangeMaybeHeight(e)}bfAfterInit(){this._initMaybeHeightWatcher()}get size(){return this.chainChannelSet.size}forEach(e){let t=0;for(const r of this.chainChannelSet)e(r,t++)}include(e){return this.chainChannelSet.has(e)}[Symbol.iterator](){return this.chainChannelSet[Symbol.iterator]()}$requestParallelTask(e,t={}){let r=this._parallelTasksMap.get(e);if(r)return r;const{channelFirewall:n=()=>!0,abortWhenNoChainChannel:s}=t,i=this._workCountWM,{taskResponseCmd:o}=t,c=o!==void 0?(v,$)=>v.delay*i.forceGet(v)+v.getApiMaybeQueueTime(o)-($.delay*i.forceGet($)+$.getApiMaybeQueueTime(o)):(v,$)=>v.delay*i.forceGet(v)-$.delay*i.forceGet($),l=new Set([...this.chainChannelSet.values()].filter(n).sort(c)),u=new Set,g=new ib,y=new Set,m=()=>l.size>0,d=(v={})=>{if(s&&this.size===0)throw new Tu(a.TASK_ABORT,{task_id:e});const $=v?.filter;for(const L of l)if($===void 0||$(L))return L;const D=g.enqueue($);return w(),D.promise},I=v=>(i.set(v,i.forceGet(v)-1),u.delete(v)?(b(v),!0):!1),T=v=>(i.set(v,i.forceGet(v)+1),u.has(v)?!1:(u.add(v),l.delete(v),w(),!0)),S=async(v={},$)=>{const{autoFreeChainChannel:D=!0}=v,L=await d(v);T(L);const z={chainChannel:L,autoFreeChainChannel:D};try{return await $(z)}finally{z.autoFreeChainChannel&&I(L)}},w=()=>{const v=5e3-Math.min(g.size/u.size,1)*4e3;if(u.size>y.size){const $=xs(v,()=>{y.delete($);for(const D of l)if(g.dequeue(D)!==void 0)return;if(u.size!==0){let D=Math.floor(u.size*Math.random());for(const L of u)D--<=0&&I(L)}});y.add($)}},b=v=>{n(v)===!0&&g.dequeue(v)===void 0&&l.add(v)};this.onAddChainChannel(b);const R=v=>{u.delete(v),l.delete(v),i.delete(v),w()};return this.onRemoveChainChannel(R),r={freeChainChannels:l,busyChainChannels:u,chainChannelWaiterQueue:g,tiTasks:y,onDestroy:()=>{l.clear(),u.clear();for(const v of y)k_(v);y.clear(),this.offAddChainChannel(b),this.offRemoveChainChannel(R)},helpers:{hasFreeChainChannel:m,getFreeChainChannel:d,freeChainChannel:I,busyChainChannel:T,requestChainChannel:S},refs:new Set},this._parallelTasksMap.set(e,r),r}$startParallelTask(e,t={}){return this.$requestParallelTask(e,t).helpers}$releaseParallelTask(e){const t=this._parallelTasksMap.get(e);if(!t)return!1;this._parallelTasksMap.delete(e),t.onDestroy()}async wrapParallelTask(e,t="unknowParallelTask",r={}){const n=this.$requestParallelTask(t,r);n.refs.add(e);try{return await e(n.helpers)}finally{n.refs.delete(e),n.refs.size===0&&this.$releaseParallelTask(t)}}wrapCbParallelTask(e,t="unknowParallelTask",r={}){const n=this.$requestParallelTask(t,r);return n.refs.add(e),e(n.helpers,()=>{n.refs.delete(e),n.refs.size===0&&this.$releaseParallelTask(t)})}async*wrapAgParallelTask(e,t="unknowParallelTask",r={}){const n=this.$requestParallelTask(t,r);n.refs.add(e);try{return yield*e(n.helpers)}finally{n.refs.delete(e),n.refs.size===0&&this.$releaseParallelTask(t)}}queryTransactionsVerbose(e,t,r,n){const{offset:s,limit:i,...o}=e,c=o.signature?1:i||1/0,l=`Group(${this.groupName}) queryTransactions-${Date.now()+Math.random()}`,u=r?.channelFilter||(()=>!0),{requestChainChannel:g}=this.$startParallelTask(l,{channelFirewall:b=>b.canQueryTransactions&&u(b),abortWhenNoChainChannel:r?.abortWhenNoChainChannel,taskResponseCmd:Ae.QUERY_TRANSACTION_RETURN});let y=()=>!0;{const b=e.maxHeight;typeof b=="number"&&(y=R=>R.maybeHeight>=b)}const m=r&&this.helper.parserAborterOptions(r,{channelGroup:this}),d=n||new fr,I=m&&m.promise;if(I){fa(I,void 0,d.reject);const b=(R,v)=>(dl(I,void 0,d.reject),v());d.on("done",b),d.on("error",b)}const T={timeout:(b,R)=>`peer(${R.address}) queryTransactions(<offset:${b.data.offset},limit:${b.data.limit}>) timeout.
[query:]${JSON.stringify(b.requester.query)}
[sort:]${JSON.stringify(b.requester.sort)}`},S=Gt.from({transformKey:b=>`${b.offset}-${b.limit}`,creater:b=>{const R=mu.create(this.moduleMap,{...o,...b},t);return{requester:R,options:new xh(T,b,R,this.helper.getChainChannelTimeout,m)}}}),w=r?.queryUnitLength||(i?Math.ceil(i/(this.chainChannelSet.size||1)):100);return(async()=>{let b=Promise.resolve(),R=c+s;const v=M=>{R=M,D()};let $;const D=()=>{$&&($.resolve(),$=void 0)};let L=-1;d.on("requestAll",(M,F)=>(D(),L=1/0,F()));let z=0;d.on("requestItem",(M,F)=>{const K=z+s;return K>L&&(L=K,D()),F()});const Y=(M,F)=>{let K=0;return b=b.then(async()=>{do if(await g({autoFreeChainChannel:!1,filter:y},async X=>{var ye,Te;d.push({type:"success",value:`(${X.chainChannel.address})`});const le=Math.min(X.chainChannel.limitQueryTransactions,F),{requester:ge,options:N}=S.forceGet({offset:M,limit:le});x.resolve(le);try{const oe=Date.now(),pe=await ge.addChainChannel(X.chainChannel,N),xe=Date.now()-oe;if(pe.status===be.success)return d.push({type:"success",value:`(${X.chainChannel.address}) +${xe}ms`}),pe.transactions.forEach((ce,q)=>{const ee=M-s+q;d.canPush(d.list.length-z+ee)&&(z+=1,d.push({type:"result",value:ce}))}),pe.transactions.length<le?(v(M),X.autoFreeChainChannel=!0,!0):(ge.finish(),X.autoFreeChainChannel=!0,!0);if(pe.status===be.busy)return d.push({type:"info",value:`(${X.chainChannel.address}) +${xe}ms`}),ge.removeChainChannelByResult(pe),K++,!1;if(pe.status===be.error)throw d.push({type:"warn",value:`(${X.chainChannel.address}): ${(ye=pe.error)===null||ye===void 0?void 0:ye.message} +${xe}ms`}),ge.removeChainChannelByResult(pe),pe.error;if(pe.status===be.idempotentError){d.push({type:"warn",value:`(${X.chainChannel.address}): ${(Te=pe.error)===null||Te===void 0?void 0:Te.message} +${xe}ms`}),ge.removeChainChannelByResult(pe);const ce=pe.error;throw new tc(ce.message,ce.detail,ce.CODE)}Qg(pe.status)}catch(oe){if(ge.removeChainChannelByResult(oe),Tu.is(oe)||d.is_done)throw d.push({type:"info",value:""}),oe;return Rh.is(oe)||(tc.is(oe)?Ch("",oe.message):ec(oe,"[GROUP]:",this.groupName,"[QUERY]:",e,"[OFFSET]:",M,"[TIMES]:",K)),d.push({type:"info",value:`${K}`}),K++>100}}))break;while(!0)},X=>x.reject(X)),x.promise};let x;const H=Math.min(w,c);for(let M=0,F=H;M<c;M+=F){const K=M+s;for(;K>L&&!(K>=R);)$||($=new Kt,await $.promise);if(K>=R||(x=new Kt,F=await Y(K,H),M+F>c&&(F=c-M,F<=0)))break}await b,await d.done()})().catch(d.reject).finally(()=>{this.$releaseParallelTask(l)}),d}queryTransactions(e,t,r,n=new fr){return Nf(this.queryTransactionsVerbose(e,t,r),n,s=>s.type==="result"?{filter:!0,map:s.value}:{filter:!1}),n}indexTransactionsVerbose(e,t,r,n){const{offset:s,limit:i,...o}=e,c=o.signature?1:i||1/0,l=`Group(${this.groupName}) indexTransactions-${Date.now()+Math.random()}`,u=r?.channelFilter||(()=>!0),{requestChainChannel:g}=this.$startParallelTask(l,{channelFirewall:b=>b.canIndexTransactions&&u(b),abortWhenNoChainChannel:r?.abortWhenNoChainChannel,taskResponseCmd:Ae.INDEX_TRANSACTION_RETURN});let y;{const b=e.maxHeight;typeof b=="number"&&(y=R=>R.maybeHeight>=b)}const m=r&&this.helper.parserAborterOptions(r,{channelGroup:this}),d=n||new fr,I=m&&m.promise;if(I){fa(I,void 0,d.reject);const b=(R,v)=>(dl(I,void 0,d.reject),v());d.on("done",b),d.on("error",b)}const T={timeout:(b,R)=>`peer(${R.address}) indexTransactions(<offset:${b.data.offset},limit:${b.data.limit}>) timeout.
[query:]${JSON.stringify(b.requester.query)}
[sort:]${JSON.stringify(b.requester.sort)}`},S=Gt.from({transformKey:b=>`${b.offset}-${b.limit}`,creater:b=>{const R=Au.create(this.moduleMap,{...o,...b},t);return{requester:R,options:new xh(T,b,R,this.helper.getChainChannelTimeout,m)}}}),w=r?.queryUnitLength||(i?Math.ceil(i/(this.chainChannelSet.size||1)):100);return(async()=>{let b=Promise.resolve(),R=c+s;const v=M=>{R=M,D()};let $;const D=()=>{$&&($.resolve(),$=void 0)};let L=-1;d.on("requestAll",(M,F)=>(D(),L=1/0,F()));let z=0;d.on("requestItem",(M,F)=>{const K=z+s;return K>L&&(L=K,D()),F()});const Y=(M,F)=>{let K=0;return b=b.then(async()=>{do if(await g({autoFreeChainChannel:!1,filter:y},async X=>{var ye,Te;d.push({type:"success",value:`(${X.chainChannel.address})`});const le=Math.min(X.chainChannel.limitQueryTransactions,F),{requester:ge,options:N}=S.forceGet({offset:M,limit:le});x.resolve(le);try{const oe=Date.now(),pe=await ge.addChainChannel(X.chainChannel,N),xe=Date.now()-oe;if(pe.status===be.success)return d.push({type:"success",value:`(${X.chainChannel.address}) +${xe}ms`}),pe.tIndexes.forEach((ce,q)=>{const ee=M-s+q;d.canPush(d.list.length-z+ee)&&(z+=1,d.push({type:"result",value:ce}))}),pe.tIndexes.length<le?(v(M),X.autoFreeChainChannel=!0,!0):(ge.finish(),X.autoFreeChainChannel=!0,!0);if(pe.status===be.busy)return d.push({type:"info",value:`(${X.chainChannel.address}) +${xe}ms`}),ge.removeChainChannelByResult(pe),K++,!1;if(pe.status===be.error)throw d.push({type:"warn",value:`(${X.chainChannel.address}): ${(ye=pe.error)===null||ye===void 0?void 0:ye.message} +${xe}ms`}),ge.removeChainChannelByResult(pe),pe.error;if(pe.status===be.idempotentError){d.push({type:"warn",value:`(${X.chainChannel.address}): ${(Te=pe.error)===null||Te===void 0?void 0:Te.message} +${xe}ms`}),ge.removeChainChannelByResult(pe);const ce=pe.error;throw new tc(ce.message,ce.detail,ce.CODE)}Qg(pe.status)}catch(oe){if(ge.removeChainChannelByResult(oe),Tu.is(oe)||d.is_done)throw d.push({type:"info",value:""}),oe;return Rh.is(oe)||(tc.is(oe)?Ch("",oe.message):ec(oe,"[GROUP]:",this.groupName,"[QUERY]:",e,"[OFFSET]:",M,"[TIMES]:",K)),d.push({type:"info",value:`${K}`}),K++>100}}))break;while(!0)},X=>x.reject(X)),x.promise};let x;const H=Math.min(w,c);for(let M=0,F=H;M<c;M+=F){const K=M+s;for(;K>L&&!(K>=R);)$||($=new Kt,await $.promise);if(K>=R||(x=new Kt,F=await Y(K,H),M+F>c&&(F=c-M,F<=0)))break}await b,await d.done()})().catch(d.reject).finally(()=>{this.$releaseParallelTask(l)}),d}indexTransactions(e,t,r,n=new fr){return Nf(this.indexTransactionsVerbose(e,t,r),n,s=>s.type==="result"?{filter:!0,map:s.value}:{filter:!1}),n}_formatHiList(e){const t=[],r=new Gt(c=>t.length+1);for(const c of e.slice().sort((l,u)=>l.height-u.height)){const l=r.forceGet(c.height)+c.tIndex;t[l]=l}const n=[];t.forEach(c=>n[n.length]=c);const s=new ab(n),i=[];for(const c of r)i[i.length]={height:c[0],baseIndex:c[1]};let o=0;return s.getRangeSet(1/0).map(c=>{const l=i.findIndex(d=>d.baseIndex>c.start,o);o=l===-1?i.length-1:l-1;const u=i[o],g=u.height,y=c.start-u.baseIndex,m=c.length;return{height:g,tIndex:y,length:m}})}downloadTransactionsVerbose(e,t,r){const n=Math.min(Math.ceil((this.limitDownloadTransactions||1)/Math.SQRT2),1),s=new Map,i=(T,S)=>{s.set(`${T}-${S}`,{height:T,tIndex:S})};for(const T of e)if(T.length>1)for(let S=0;S<T.length;++S)i(T.height,T.tIndex+S);else i(T.height,T.tIndex);const o=[...s.values()],c=o.length,l=t&&this.helper.parserAborterOptions(t,{channelGroup:this}),u=r||new fr,g=`Group(${this.groupName}) downloadTransactions-${Date.now()+Math.random()}`,y=t?.channelFilter||(()=>!0),{requestChainChannel:m}=this.$startParallelTask(g,{channelFirewall:T=>T.canDownloadTransactions&&y(T),abortWhenNoChainChannel:t?.abortWhenNoChainChannel,taskResponseCmd:Ae.DOWNLOAD_TRANSACTION_RETURN}),d={timeout:(T,S)=>`peer(${S.address}) downloadTransactions(<${T.data.map(w=>`${w.height}/${w.tIndex}:${w.length}`).join(",")}) timeout.`},I=Gt.from({transformKey:T=>T.map(S=>`${S.height}/${S.tIndex}:${S.length}`).join(","),creater:T=>{const S=Iu.create(this.moduleMap,T);return{requester:S,options:new xh(d,T,S,this.helper.getChainChannelTimeout,l)}}});return(async()=>{let T;const S=()=>{T&&(T.resolve(),T=void 0)};let w=u.requestProcess;u.on("requestAll",(v,$)=>(S(),w=1/0,$())),u.on("requestItem",(v,$)=>(v>=w&&(w=v+1,S()),$()));let b=0;const R=async()=>{do{const v=o.slice(b,b+=n);if(v.length===0)break;const $=this._formatHiList(v),D=v.length,L=v[v.length-1].height;let z=0;for(;!await m({filter:Y=>Y.maybeHeight>=L},async Y=>{var x,H;u.push({type:"success",value:`(${Y.chainChannel.address})`});const{requester:M,options:F}=I.forceGet($);try{const K=Date.now(),X=await M.addChainChannel(Y.chainChannel,F),ye=Date.now()-K;if(X.status===be.success){if(u.push({type:"success",value:`(${Y.chainChannel.address}) +${ye}ms`}),X.transactions.length<D)return M.removeChainChannelByResult(X),z++,!1;{const Te=X.transactions.map(le=>({tib:le,hiIndex:o.findIndex(ge=>ge.height===le.height&&ge.tIndex===le.tIndex)})).sort((le,ge)=>le.hiIndex-ge.hiIndex);for(const le of Te)u.canPush(u.list.length)&&u.push({type:"result",value:le.tib});return!0}}else{if(X.status===be.busy)return u.push({type:"info",value:`(${Y.chainChannel.address}) +${ye}ms`}),M.removeChainChannelByResult(X),z++,!1;if(X.status===be.error)throw u.push({type:"warn",value:`(${Y.chainChannel.address}): ${(x=X.error)===null||x===void 0?void 0:x.message} +${ye}ms`}),M.removeChainChannelByResult(X),X.error;if(X.status===be.idempotentError){u.push({type:"warn",value:`(${Y.chainChannel.address}): ${(H=X.error)===null||H===void 0?void 0:H.message} +${ye}ms`}),M.removeChainChannelByResult(X);const Te=X.error;throw new tc(Te.message,Te.detail,Te.CODE)}}Qg(X.status)}catch(K){if(M.removeChainChannelByResult(K),Tu.is(K)||u.is_done)throw u.push({type:"info",value:""}),K;return Rh.is(K)||(tc.is(K)?Ch("",K.message):ec(K,"[GROUP]:",this.groupName,"[TINDEXES]:",v,"[TIMES]:",z)),u.push({type:"info",value:`${z}`}),z++>100}}););}while(!0)};for(let v=0;v<c;v+=n){for(;v>=w;)T||(T=new Kt),await T.promise;await R()}await u.done()})().finally(()=>{this.$releaseParallelTask(g)}),u}downloadTransactions(e,t,r=new fr){return Nf(this.downloadTransactionsVerbose(e,t),r,n=>n.type==="result"?{filter:!0,map:n.value}:{filter:!1}),r}async broadcastTransaction(e,t,r){let n;const s=this.timeHelper.now(),i=[];let o;try{let u=[];if(t&&t.directAddress&&t.directAddress.size>0){const m=t.directAddress;for(const d of this.chainChannelSet.values())m.has(d.address)&&u.push(d)}else u=[...this.chainChannelSet.values()];let g=r&&await r.emit("startBroadcasting",{chainChannelList:u});if(g&&g.break)return[];const y=new vT(t&&t.max_parallel_num);o=t&&this.helper.parserAborterOptions(t,{channelGroup:this});for(const m of u)y.addTaskExecutor(async()=>{const d=n||(n=await m.initBroadcastTransactionArg(e,{timeout:T=>this.helper.getChainChannelTimeout(T.chainChannel),rejected:o?.promise}));let I;try{const T=-m.calcDiffTimeToTargetTime(this.timeHelper.getTimeByTimestamp(e.timestamp));if(T>0){if(DA("chainChannel(%s) seems in feature. need wait %dms then broadcast.",m.address,T),o&&o.sleepTime>0&&T+m.delay/2>o.sleepTime){DA("chainChannel(%s) need wait too much time, so skip in resultList."),xs(T,async()=>{try{I={error:!1,result:await m._requestWithBinaryData(...d),chainChannel:m}}catch(S){I={error:!0,result:S,chainChannel:m}}r&&await r.emit("broadcasted",I)});return}await xs(T)}i.push(I={error:!1,result:await m._requestWithBinaryData(...d),chainChannel:m})}catch(T){i.push(I={error:!0,result:T,chainChannel:m})}r&&(g=await r.emit("broadcasted",I))});for await(const m of y.yieldResults({ignoreError:!0}))if(g&&g.break)break;o?.resolve(void 0)}catch(u){o?.reject(u)}finally{const u=this.timeHelper.now();r&&r.emit("endBroadcast",{duraction:u-s})}let c=0,l=0;return i.forEach(u=>{u.error?l+=1:c+=1}),(c===0&&l>0?ec:MA)("chainChannelGroup(%s) broadcasted Transaction(%s), successed: %d, fail: %d",this.groupName,this.transactionHelper.getTypeName(e.type),c,l,e.asset),i}async fastBroadcastTransaction(e,t,r){let n,s=[];if(t&&t.directAddress&&t.directAddress.size>0){const u=t.directAddress;for(const g of this.chainChannelSet.values())u.has(g.address)&&s.push(g)}else for(const u of this.chainChannelSet.values())u.canBroadcastTransaction&&s.push(u);let i=r&&await r.emit("startBroadcasting",{chainChannelList:s}),o=0;if(i&&i.break)return o;const c=this.timeHelper.now();for(const u of s)if(!u.isRefusePushNewTransaction){n||(n=await u.initBroadcastTransactionArg(e));try{o++,await u._sendWithBinaryData(n[0],n[1])}catch{}}const l=this.timeHelper.now();return r&&r.emit("endBroadcast",{duraction:l-c}),o}async queryBlock(e,t,r){if(typeof e.height=="number"){const u=e.height;if(![...this.chainChannelSet.values()].find(g=>g.maybeHeight>=u))return}const n=`Group(${this.groupName}) queryBlock-${Date.now()+Math.random()}`,{requestChainChannel:s}=this.$startParallelTask(n,{channelFirewall:t?.channelFilter,abortWhenNoChainChannel:t?.abortWhenNoChainChannel,taskResponseCmd:Ae.QUERY_BLOCK_RETURN}),i=t&&this.helper.parserAborterOptions(t,{channelGroup:this});let o=!1;const c=i?.promise;let l;if(c){const u=g=>{Ch(g),o=!0};fa(c,void 0,u),l=()=>{dl(c,void 0,u)}}try{const u=Math.min(Math.max(this.size,2),5),g=Eu.create(this.moduleMap,e),y={rejected:c,timeout:T=>this.helper.getChainChannelTimeout(T.chainChannel)};{const T=new Gt(S=>new Rh(a.QUERY_BLOCK_FROM_PEER_TIMEOUT,{query:JSON.stringify(g.query),peerId:S.address}));y.timeoutException=S=>T.forceGet(S.chainChannel)}let m=0,d,I=()=>!0;{const T=e.height;typeof T=="number"&&(I=S=>S.maybeHeight>=T)}do{if(o)return;await s({autoFreeChainChannel:!1,filter:I},async T=>{var S,w;try{const b=await g.addChainChannel(T.chainChannel,y);if(b.status===be.error)throw g.removeChainChannelByResult(b),b.error;if(b.status===be.busy)throw g.removeChainChannelByResult(b),void 0;if(d=(S=b.someBlock)===null||S===void 0?void 0:S.block,!d){const R=(w=g.getChainChannelByResult(b))===null||w===void 0?void 0:w.maybeHeight;if(R&&R>=this.maybeHeight){o=!0;return}}g.finish()}catch(b){if(o)return;if(g.removeChainChannelByResult(b),b&&Ch(b),m+=1,m>=u){o=!0;return}}})}while(!d);return d}finally{this.$releaseParallelTask(n),l&&l()}}findBlock(e,t){return this.queryBlock(e,t)}async broadcastBlock(e,t){let r,n=[];if(t&&t.directAddress&&t.directAddress.size>0){const l=t.directAddress;for(const u of this.chainChannelSet.values())l.has(u.address)&&n.push(u)}else n=[...this.chainChannelSet.values()];const s=t&&this.helper.parserAborterOptions(t,{channelGroup:this}),i=await Promise.all(n.map(l=>(r||(r=l.initBroadcastBlockArg(e,{timeout:u=>this.helper.getChainChannelTimeout(u.chainChannel),rejected:s?.promise})),{chainChannel:l,result:l._requestWithBinaryData(...r)})));let o=0,c=0;return await Promise.all(i.map(async l=>{try{(await l.result).error?c+=1:o+=1}catch{c+=1}})),(o===0&&c>0?ec:MA)("chainChannelGroup(%s) broadcasted Block(%d), successed: %d, fail: %d",this.groupName,e.height,o,c),i}async fastBroadcastBlock(e,t){let r,n=[];if(t&&t.directAddress&&t.directAddress.size>0){const i=t.directAddress;for(const o of this.chainChannelSet.values())i.has(o.address)&&n.push(o)}else for(const i of this.chainChannelSet.values())i.canBroadcastBlock&&n.push(i);let s=0;for(const i of n){r||(r=i.initBroadcastBlockArg(e));try{s++,await i._sendWithBinaryData(r[0],r[1])}catch{}}return s}addChainChannel(e,t=this.options){return this.chainChannelSet.has(e)?!1:(this.addChainChannel_(e,t),this._chainChannelEvents.emit("addChainChannel",e),!0)}addChainChannels(e){let t=0,r=0;const n="size"in e?e:[e];for(const s of n)this.addChainChannel(s)?t+=1:r+=1;return{ADD:t,FAIL:r}}removeChainChannel(e){e.offEmit(this._eventFollower);const t=this._DAWCLWM.get(e);return t&&(this._DAWCLWM.delete(e),t()),this.chainChannelSet.delete(e)?(this._chainChannelEvents.emit("removeChainChannel",e),!0):!1}get _chainChannelEvents(){return new mn}get onAddChainChannel(){return this._chainChannelEvents.on.bind(this._chainChannelEvents,"addChainChannel")}get offAddChainChannel(){return this._chainChannelEvents.off.bind(this._chainChannelEvents,"addChainChannel")}get onRemoveChainChannel(){return this._chainChannelEvents.on.bind(this._chainChannelEvents,"removeChainChannel")}get offRemoveChainChannel(){return this._chainChannelEvents.off.bind(this._chainChannelEvents,"removeChainChannel")}_eventFollower(e){return this.emit(e.eventname,e.args)}addChainChannel_(e,t=this.options){if(this.chainChannelSet.add(e),!t.disableAutoRemove){const r=e.onClose(n=>{ob.is(n)?cb("channel auto removed in [%s], reason:",this.groupName,n.message):ec("channel auto removed in [%s], reason:",this.groupName,n),this.removeChainChannel(e)});this._DAWCLWM.set(e,r)}e.onEmit(this._eventFollower)}destroy(){for(const e of this.chainChannelSet)this.removeChainChannel(e)}get maybeHeight(){return this._maybeHeight}get lastConsensusVersion(){return this._lastConsensusVersion}get onMaybeHeightChanged(){return this._chainChannelEvents.on.bind(this._chainChannelEvents,"maybeHeightChanged")}get offMaybeHeightChanged(){return this._chainChannelEvents.off.bind(this._chainChannelEvents,"maybeHeightChanged")}_tryChangeMaybeHeight(e,t){this._maybeHeight!==e&&(this._maybeHeight=e,this._chainChannelEvents.emit("maybeHeightChanged",e,t))}_tryChangeConsensusVersion(e){this._lastConsensusVersion!==e&&(this._lastConsensusVersion=e,this._chainChannelEvents.emit("consensusVersionChanged",e))}_initMaybeHeightWatcher(){const e=(r,n)=>(r.height>this._maybeHeight&&this._tryChangeMaybeHeight(r.height,r.version),n());let t=this._maybeHeight;for(const r of this.chainChannelSet)t=Math.max(r.maybeHeight,t);this._tryChangeMaybeHeight(t),this._chainChannelEvents.on("addChainChannel",r=>{this._maybeHeight<r.maybeHeight&&this._tryChangeMaybeHeight(r.maybeHeight),this._lastConsensusVersion<r.lastConsensusVersion&&this._tryChangeConsensusVersion(r.lastConsensusVersion),r.on("onNewBlock",e)}),this._chainChannelEvents.on("removeChainChannel",r=>{if(r.off("onNewBlock",e),r.maybeHeight<this._maybeHeight)return;let n=1;for(const s of this.chainChannelSet)if(n=Math.max(s.maybeHeight,n),n>=r.maybeHeight)return;this._tryChangeMaybeHeight(n)})}};p([k(Re),h("design:type",Re)],Mt.prototype,"baseHelper",void 0),p([k(re),h("design:type",re)],Mt.prototype,"config",void 0),p([k(je),h("design:type",je)],Mt.prototype,"moduleMap",void 0),p([k(xt),h("design:type",xt)],Mt.prototype,"timeHelper",void 0),p([k(Fe),h("design:type",Fe)],Mt.prototype,"helper",void 0),p([k(_e),h("design:type",_e)],Mt.prototype,"transactionHelper",void 0),p([k(Ii),h("design:type",Ii)],Mt.prototype,"blobHelper",void 0),p([Me,h("design:type",Function),h("design:paramtypes",[Object,Object,Object,Object]),h("design:returntype",void 0)],Mt.prototype,"queryTransactions",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object,Object,Object,fr]),h("design:returntype",void 0)],Mt.prototype,"indexTransactionsVerbose",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object,Object,Object,Object]),h("design:returntype",void 0)],Mt.prototype,"indexTransactions",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object,Object,fr]),h("design:returntype",void 0)],Mt.prototype,"downloadTransactionsVerbose",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object,Object,Object]),h("design:returntype",void 0)],Mt.prototype,"downloadTransactions",null),p([ie,h("design:type",Object),h("design:paramtypes",[])],Mt.prototype,"_chainChannelEvents",null),p([ie,h("design:type",Function),h("design:paramtypes",[])],Mt.prototype,"onAddChainChannel",null),p([ie,h("design:type",Function),h("design:paramtypes",[])],Mt.prototype,"onRemoveChainChannel",null),p([ie,h("design:type",Function),h("design:paramtypes",[])],Mt.prototype,"offRemoveChainChannel",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],Mt.prototype,"_eventFollower",null),p([ie,h("design:type",Function),h("design:paramtypes",[])],Mt.prototype,"onMaybeHeightChanged",null),p([ie,h("design:type",Function),h("design:paramtypes",[])],Mt.prototype,"offMaybeHeightChanged",null),Mt=p([Wi(),Se(0,k(Ph.CHANNEL_LIST)),Se(1,k(Ph.GROUP_NAME,{optional:!0})),Se(2,k(Ph.OPTIONS,{optional:!0})),h("design:paramtypes",[Object,Object,Object])],Mt);var xh=class{constructor(e,t,r,n,s){this.exmBuilder=e,this.data=t,this.requester=r,this.getChainChannelTimeout=n,this.resultPo=s}get _exm(){return new Gt(e=>new Rh(this.exmBuilder.timeout(this,e)))}timeoutException(e){return this._exm.forceGet(e.chainChannel)}timeout(e){return this.getChainChannelTimeout(e.chainChannel)}get rejected(){var e;return(e=this.resultPo)===null||e===void 0?void 0:e.promise}};p([ie,h("design:type",Object),h("design:paramtypes",[])],xh.prototype,"_exm",null),p([Me,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",void 0)],xh.prototype,"timeoutException",null);var wy=class{constructor(e){this.moduleMap=e,this._groupNameAcc=1}registryChannel(e,t=Ks,r=this.moduleMap,n=1e3){return At(t,new je([[Xh.ENDPOINT,e],[Xh.REFUSETIME,n]],r))}groupChannel(e,t=`G${this._groupNameAcc++}`,r=Mt){const{moduleMap:n}=this;return At(r,new je([[Ph.CHANNEL_LIST,e],[Ph.GROUP_NAME,t]],n))}};wy=p([j(),h("design:paramtypes",[je])],wy);var ze=Uint8Array,Ny=Uint16Array,Su=Int32Array,Bh=Float64Array;function bu(e,t,r,n){const s=n[0]&255|(n[1]&255)<<8|(n[2]&255)<<16|(n[3]&255)<<24,i=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,o=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,c=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,l=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24,u=n[4]&255|(n[5]&255)<<8|(n[6]&255)<<16|(n[7]&255)<<24,g=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,y=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,m=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,d=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,I=n[8]&255|(n[9]&255)<<8|(n[10]&255)<<16|(n[11]&255)<<24,T=r[16]&255|(r[17]&255)<<8|(r[18]&255)<<16|(r[19]&255)<<24,S=r[20]&255|(r[21]&255)<<8|(r[22]&255)<<16|(r[23]&255)<<24,w=r[24]&255|(r[25]&255)<<8|(r[26]&255)<<16|(r[27]&255)<<24,b=r[28]&255|(r[29]&255)<<8|(r[30]&255)<<16|(r[31]&255)<<24,R=n[12]&255|(n[13]&255)<<8|(n[14]&255)<<16|(n[15]&255)<<24;let v=s,$=i,D=o,L=c,z=l,Y=u,x=g,H=y,M=m,F=d,K=I,X=T,ye=S,Te=w,le=b,ge=R,N;for(let oe=0;oe<20;oe+=2)N=v+ye|0,z^=N<<7|N>>>25,N=z+v|0,M^=N<<9|N>>>23,N=M+z|0,ye^=N<<13|N>>>19,N=ye+M|0,v^=N<<18|N>>>14,N=Y+$|0,F^=N<<7|N>>>25,N=F+Y|0,Te^=N<<9|N>>>23,N=Te+F|0,$^=N<<13|N>>>19,N=$+Te|0,Y^=N<<18|N>>>14,N=K+x|0,le^=N<<7|N>>>25,N=le+K|0,D^=N<<9|N>>>23,N=D+le|0,x^=N<<13|N>>>19,N=x+D|0,K^=N<<18|N>>>14,N=ge+X|0,L^=N<<7|N>>>25,N=L+ge|0,H^=N<<9|N>>>23,N=H+L|0,X^=N<<13|N>>>19,N=X+H|0,ge^=N<<18|N>>>14,N=v+L|0,$^=N<<7|N>>>25,N=$+v|0,D^=N<<9|N>>>23,N=D+$|0,L^=N<<13|N>>>19,N=L+D|0,v^=N<<18|N>>>14,N=Y+z|0,x^=N<<7|N>>>25,N=x+Y|0,H^=N<<9|N>>>23,N=H+x|0,z^=N<<13|N>>>19,N=z+H|0,Y^=N<<18|N>>>14,N=K+F|0,X^=N<<7|N>>>25,N=X+K|0,M^=N<<9|N>>>23,N=M+X|0,F^=N<<13|N>>>19,N=F+M|0,K^=N<<18|N>>>14,N=ge+le|0,ye^=N<<7|N>>>25,N=ye+ge|0,Te^=N<<9|N>>>23,N=Te+ye|0,le^=N<<13|N>>>19,N=le+Te|0,ge^=N<<18|N>>>14;v=v+s|0,$=$+i|0,D=D+o|0,L=L+c|0,z=z+l|0,Y=Y+u|0,x=x+g|0,H=H+y|0,M=M+m|0,F=F+d|0,K=K+I|0,X=X+T|0,ye=ye+S|0,Te=Te+w|0,le=le+b|0,ge=ge+R|0,e[0]=v>>>0&255,e[1]=v>>>8&255,e[2]=v>>>16&255,e[3]=v>>>24&255,e[4]=$>>>0&255,e[5]=$>>>8&255,e[6]=$>>>16&255,e[7]=$>>>24&255,e[8]=D>>>0&255,e[9]=D>>>8&255,e[10]=D>>>16&255,e[11]=D>>>24&255,e[12]=L>>>0&255,e[13]=L>>>8&255,e[14]=L>>>16&255,e[15]=L>>>24&255,e[16]=z>>>0&255,e[17]=z>>>8&255,e[18]=z>>>16&255,e[19]=z>>>24&255,e[20]=Y>>>0&255,e[21]=Y>>>8&255,e[22]=Y>>>16&255,e[23]=Y>>>24&255,e[24]=x>>>0&255,e[25]=x>>>8&255,e[26]=x>>>16&255,e[27]=x>>>24&255,e[28]=H>>>0&255,e[29]=H>>>8&255,e[30]=H>>>16&255,e[31]=H>>>24&255,e[32]=M>>>0&255,e[33]=M>>>8&255,e[34]=M>>>16&255,e[35]=M>>>24&255,e[36]=F>>>0&255,e[37]=F>>>8&255,e[38]=F>>>16&255,e[39]=F>>>24&255,e[40]=K>>>0&255,e[41]=K>>>8&255,e[42]=K>>>16&255,e[43]=K>>>24&255,e[44]=X>>>0&255,e[45]=X>>>8&255,e[46]=X>>>16&255,e[47]=X>>>24&255,e[48]=ye>>>0&255,e[49]=ye>>>8&255,e[50]=ye>>>16&255,e[51]=ye>>>24&255,e[52]=Te>>>0&255,e[53]=Te>>>8&255,e[54]=Te>>>16&255,e[55]=Te>>>24&255,e[56]=le>>>0&255,e[57]=le>>>8&255,e[58]=le>>>16&255,e[59]=le>>>24&255,e[60]=ge>>>0&255,e[61]=ge>>>8&255,e[62]=ge>>>16&255,e[63]=ge>>>24&255}function Oy(e,t,r,n){const s=n[0]&255|(n[1]&255)<<8|(n[2]&255)<<16|(n[3]&255)<<24,i=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,o=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,c=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,l=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24,u=n[4]&255|(n[5]&255)<<8|(n[6]&255)<<16|(n[7]&255)<<24,g=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,y=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,m=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,d=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,I=n[8]&255|(n[9]&255)<<8|(n[10]&255)<<16|(n[11]&255)<<24,T=r[16]&255|(r[17]&255)<<8|(r[18]&255)<<16|(r[19]&255)<<24,S=r[20]&255|(r[21]&255)<<8|(r[22]&255)<<16|(r[23]&255)<<24,w=r[24]&255|(r[25]&255)<<8|(r[26]&255)<<16|(r[27]&255)<<24,b=r[28]&255|(r[29]&255)<<8|(r[30]&255)<<16|(r[31]&255)<<24,R=n[12]&255|(n[13]&255)<<8|(n[14]&255)<<16|(n[15]&255)<<24;let v=s,$=i,D=o,L=c,z=l,Y=u,x=g,H=y,M=m,F=d,K=I,X=T,ye=S,Te=w,le=b,ge=R,N;for(let oe=0;oe<20;oe+=2)N=v+ye|0,z^=N<<7|N>>>25,N=z+v|0,M^=N<<9|N>>>23,N=M+z|0,ye^=N<<13|N>>>19,N=ye+M|0,v^=N<<18|N>>>14,N=Y+$|0,F^=N<<7|N>>>25,N=F+Y|0,Te^=N<<9|N>>>23,N=Te+F|0,$^=N<<13|N>>>19,N=$+Te|0,Y^=N<<18|N>>>14,N=K+x|0,le^=N<<7|N>>>25,N=le+K|0,D^=N<<9|N>>>23,N=D+le|0,x^=N<<13|N>>>19,N=x+D|0,K^=N<<18|N>>>14,N=ge+X|0,L^=N<<7|N>>>25,N=L+ge|0,H^=N<<9|N>>>23,N=H+L|0,X^=N<<13|N>>>19,N=X+H|0,ge^=N<<18|N>>>14,N=v+L|0,$^=N<<7|N>>>25,N=$+v|0,D^=N<<9|N>>>23,N=D+$|0,L^=N<<13|N>>>19,N=L+D|0,v^=N<<18|N>>>14,N=Y+z|0,x^=N<<7|N>>>25,N=x+Y|0,H^=N<<9|N>>>23,N=H+x|0,z^=N<<13|N>>>19,N=z+H|0,Y^=N<<18|N>>>14,N=K+F|0,X^=N<<7|N>>>25,N=X+K|0,M^=N<<9|N>>>23,N=M+X|0,F^=N<<13|N>>>19,N=F+M|0,K^=N<<18|N>>>14,N=ge+le|0,ye^=N<<7|N>>>25,N=ye+ge|0,Te^=N<<9|N>>>23,N=Te+ye|0,le^=N<<13|N>>>19,N=le+Te|0,ge^=N<<18|N>>>14;e[0]=v>>>0&255,e[1]=v>>>8&255,e[2]=v>>>16&255,e[3]=v>>>24&255,e[4]=Y>>>0&255,e[5]=Y>>>8&255,e[6]=Y>>>16&255,e[7]=Y>>>24&255,e[8]=K>>>0&255,e[9]=K>>>8&255,e[10]=K>>>16&255,e[11]=K>>>24&255,e[12]=ge>>>0&255,e[13]=ge>>>8&255,e[14]=ge>>>16&255,e[15]=ge>>>24&255,e[16]=x>>>0&255,e[17]=x>>>8&255,e[18]=x>>>16&255,e[19]=x>>>24&255,e[20]=H>>>0&255,e[21]=H>>>8&255,e[22]=H>>>16&255,e[23]=H>>>24&255,e[24]=M>>>0&255,e[25]=M>>>8&255,e[26]=M>>>16&255,e[27]=M>>>24&255,e[28]=F>>>0&255,e[29]=F>>>8&255,e[30]=F>>>16&255,e[31]=F>>>24&255}var Ca=new ze([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function pb(e,t,r,n,s,i,o){const c=new ze(16),l=new ze(64);let u,g;for(g=0;g<16;g++)c[g]=0;for(g=0;g<8;g++)c[g]=i[g];for(;s>=64;){for(bu(l,c,o,Ca),g=0;g<64;g++)e[t+g]=r[n+g]^l[g];for(u=1,g=8;g<16;g++)u=u+(c[g]&255)|0,c[g]=u&255,u>>>=8;s-=64,t+=64,n+=64}if(s>0)for(bu(l,c,o,Ca),g=0;g<s;g++)e[t+g]=r[n+g]^l[g];return 0}function hb(e,t,r,n,s){const i=new ze(16),o=new ze(64);let c,l;for(l=0;l<16;l++)i[l]=0;for(l=0;l<8;l++)i[l]=n[l];for(;r>=64;){for(bu(o,i,s,Ca),l=0;l<64;l++)e[t+l]=o[l];for(c=1,l=8;l<16;l++)c=c+(i[l]&255)|0,i[l]=c&255,c>>>=8;r-=64,t+=64}if(r>0)for(bu(o,i,s,Ca),l=0;l<r;l++)e[t+l]=o[l];return 0}function lb(e,t,r,n,s){const i=new ze(32),o=new ze(8);Oy(i,n,s,Ca);for(let c=0;c<8;c++)o[c]=n[c+16];return hb(e,t,r,o,i)}function FA(e,t,r,n,s,i,o){const c=new ze(32),l=new ze(8);Oy(c,i,o,Ca);for(let u=0;u<8;u++)l[u]=i[u+16];return pb(e,t,r,n,s,l,c)}function ub(e){const t=new Ny(10),r=new Ny(8);let n,s,i,o,c,l,u,g;return n=e[0]&255|(e[1]&255)<<8,t[0]=n&8191,s=e[2]&255|(e[3]&255)<<8,t[1]=(n>>>13|s<<3)&8191,i=e[4]&255|(e[5]&255)<<8,t[2]=(s>>>10|i<<6)&7939,o=e[6]&255|(e[7]&255)<<8,t[3]=(i>>>7|o<<9)&8191,c=e[8]&255|(e[9]&255)<<8,t[4]=(o>>>4|c<<12)&255,t[5]=c>>>1&8190,l=e[10]&255|(e[11]&255)<<8,t[6]=(c>>>14|l<<2)&8191,u=e[12]&255|(e[13]&255)<<8,t[7]=(l>>>11|u<<5)&8065,g=e[14]&255|(e[15]&255)<<8,t[8]=(u>>>8|g<<8)&8191,t[9]=g>>>5&127,r[0]=e[16]&255|(e[17]&255)<<8,r[1]=e[18]&255|(e[19]&255)<<8,r[2]=e[20]&255|(e[21]&255)<<8,r[3]=e[22]&255|(e[23]&255)<<8,r[4]=e[24]&255|(e[25]&255)<<8,r[5]=e[26]&255|(e[27]&255)<<8,r[6]=e[28]&255|(e[29]&255)<<8,r[7]=e[30]&255|(e[31]&255)<<8,{buffer:new ze(16),r:t,h:new Ny(10),pad:r,leftover:0,fin:0}}function vy(e,t,r,n){const s=e.fin?0:2048;let i,o,c,l,u,g,y,m,d,I,T,S,w,b,R,v,$,D,L;const{h:z,r:Y}=e;let x=z[0],H=z[1],M=z[2],F=z[3],K=z[4],X=z[5],ye=z[6],Te=z[7],le=z[8],ge=z[9];const N=Y[0],oe=Y[1],pe=Y[2],xe=Y[3],ce=Y[4],q=Y[5],ee=Y[6],ae=Y[7],se=Y[8],we=Y[9];for(;n>=16;)i=t[r+0]&255|(t[r+1]&255)<<8,x+=i&8191,o=t[r+2]&255|(t[r+3]&255)<<8,H+=(i>>>13|o<<3)&8191,c=t[r+4]&255|(t[r+5]&255)<<8,M+=(o>>>10|c<<6)&8191,l=t[r+6]&255|(t[r+7]&255)<<8,F+=(c>>>7|l<<9)&8191,u=t[r+8]&255|(t[r+9]&255)<<8,K+=(l>>>4|u<<12)&8191,X+=u>>>1&8191,g=t[r+10]&255|(t[r+11]&255)<<8,ye+=(u>>>14|g<<2)&8191,y=t[r+12]&255|(t[r+13]&255)<<8,Te+=(g>>>11|y<<5)&8191,m=t[r+14]&255|(t[r+15]&255)<<8,le+=(y>>>8|m<<8)&8191,ge+=m>>>5|s,d=0,I=d,I+=x*N,I+=H*(5*we),I+=M*(5*se),I+=F*(5*ae),I+=K*(5*ee),d=I>>>13,I&=8191,I+=X*(5*q),I+=ye*(5*ce),I+=Te*(5*xe),I+=le*(5*pe),I+=ge*(5*oe),d+=I>>>13,I&=8191,T=d,T+=x*oe,T+=H*N,T+=M*(5*we),T+=F*(5*se),T+=K*(5*ae),d=T>>>13,T&=8191,T+=X*(5*ee),T+=ye*(5*q),T+=Te*(5*ce),T+=le*(5*xe),T+=ge*(5*pe),d+=T>>>13,T&=8191,S=d,S+=x*pe,S+=H*oe,S+=M*N,S+=F*(5*we),S+=K*(5*se),d=S>>>13,S&=8191,S+=X*(5*ae),S+=ye*(5*ee),S+=Te*(5*q),S+=le*(5*ce),S+=ge*(5*xe),d+=S>>>13,S&=8191,w=d,w+=x*xe,w+=H*pe,w+=M*oe,w+=F*N,w+=K*(5*we),d=w>>>13,w&=8191,w+=X*(5*se),w+=ye*(5*ae),w+=Te*(5*ee),w+=le*(5*q),w+=ge*(5*ce),d+=w>>>13,w&=8191,b=d,b+=x*ce,b+=H*xe,b+=M*pe,b+=F*oe,b+=K*N,d=b>>>13,b&=8191,b+=X*(5*we),b+=ye*(5*se),b+=Te*(5*ae),b+=le*(5*ee),b+=ge*(5*q),d+=b>>>13,b&=8191,R=d,R+=x*q,R+=H*ce,R+=M*xe,R+=F*pe,R+=K*oe,d=R>>>13,R&=8191,R+=X*N,R+=ye*(5*we),R+=Te*(5*se),R+=le*(5*ae),R+=ge*(5*ee),d+=R>>>13,R&=8191,v=d,v+=x*ee,v+=H*q,v+=M*ce,v+=F*xe,v+=K*pe,d=v>>>13,v&=8191,v+=X*oe,v+=ye*N,v+=Te*(5*we),v+=le*(5*se),v+=ge*(5*ae),d+=v>>>13,v&=8191,$=d,$+=x*ae,$+=H*ee,$+=M*q,$+=F*ce,$+=K*xe,d=$>>>13,$&=8191,$+=X*pe,$+=ye*oe,$+=Te*N,$+=le*(5*we),$+=ge*(5*se),d+=$>>>13,$&=8191,D=d,D+=x*se,D+=H*ae,D+=M*ee,D+=F*q,D+=K*ce,d=D>>>13,D&=8191,D+=X*xe,D+=ye*pe,D+=Te*oe,D+=le*N,D+=ge*(5*we),d+=D>>>13,D&=8191,L=d,L+=x*we,L+=H*se,L+=M*ae,L+=F*ee,L+=K*q,d=L>>>13,L&=8191,L+=X*ce,L+=ye*xe,L+=Te*pe,L+=le*oe,L+=ge*N,d+=L>>>13,L&=8191,d=(d<<2)+d|0,d=d+I|0,I=d&8191,d=d>>>13,T+=d,x=I,H=T,M=S,F=w,K=b,X=R,ye=v,Te=$,le=D,ge=L,r+=16,n-=16;z[0]=x,z[1]=H,z[2]=M,z[3]=F,z[4]=K,z[5]=X,z[6]=ye,z[7]=Te,z[8]=le,z[9]=ge}function gb(e,t,r){const n=new ze(10);let s,i,o,c;const{buffer:l,h:u,pad:g,leftover:y}=e;if(y){for(c=y,l[c++]=1;c<16;c++)l[c]=0;e.fin=1,vy(e,l,0,16)}for(s=u[1]>>>13,u[1]&=8191,c=2;c<10;c++)u[c]+=s,s=u[c]>>>13,u[c]&=8191;for(u[0]+=s*5,s=u[0]>>>13,u[0]&=8191,u[1]+=s,s=u[1]>>>13,u[1]&=8191,u[2]+=s,n[0]=u[0]+5,s=n[0]>>>13,n[0]&=8191,c=1;c<10;c++)n[c]=u[c]+s,s=n[c]>>>13,n[c]&=8191;for(n[9]-=8192,i=(s^1)-1,c=0;c<10;c++)n[c]&=i;for(i=~i,c=0;c<10;c++)u[c]=u[c]&i|n[c];for(u[0]=(u[0]|u[1]<<13)&65535,u[1]=(u[1]>>>3|u[2]<<10)&65535,u[2]=(u[2]>>>6|u[3]<<7)&65535,u[3]=(u[3]>>>9|u[4]<<4)&65535,u[4]=(u[4]>>>12|u[5]<<1|u[6]<<14)&65535,u[5]=(u[6]>>>2|u[7]<<11)&65535,u[6]=(u[7]>>>5|u[8]<<8)&65535,u[7]=(u[8]>>>8|u[9]<<5)&65535,o=u[0]+g[0],u[0]=o&65535,c=1;c<8;c++)o=(u[c]+g[c]|0)+(o>>>16)|0,u[c]=o&65535;t[r+0]=u[0]>>>0&255,t[r+1]=u[0]>>>8&255,t[r+2]=u[1]>>>0&255,t[r+3]=u[1]>>>8&255,t[r+4]=u[2]>>>0&255,t[r+5]=u[2]>>>8&255,t[r+6]=u[3]>>>0&255,t[r+7]=u[3]>>>8&255,t[r+8]=u[4]>>>0&255,t[r+9]=u[4]>>>8&255,t[r+10]=u[5]>>>0&255,t[r+11]=u[5]>>>8&255,t[r+12]=u[6]>>>0&255,t[r+13]=u[6]>>>8&255,t[r+14]=u[7]>>>0&255,t[r+15]=u[7]>>>8&255}function fb(e,t,r,n){let s,i;const{buffer:o}=e;if(e.leftover){for(i=16-e.leftover,i>n&&(i=n),s=0;s<i;s++)o[e.leftover+s]=t[r+s];if(n-=i,r+=i,e.leftover+=i,e.leftover<16)return;vy(e,o,0,16),e.leftover=0}if(n>=16&&(i=n-n%16,vy(e,t,r,i),r+=i,n-=i),n){for(s=0;s<n;s++)o[e.leftover+s]=t[r+s];e.leftover+=n}}function db(e,t,r){ic(e,t,r),JA(r,t);const n=new ze(32+e.length),s=new ze(n.length);for(let i=0;i<e.length;i++)n[i+32]=e[i];return mb(s,n,n.length,t,r),s.subarray(16)}function yb(e,t,r){ic(e,t,r),JA(r,t);const n=new ze(16+e.length),s=new ze(n.length);for(let i=0;i<e.length;i++)n[i+16]=e[i];if(!(n.length<32||_b(s,n,n.length,t,r)!==0))return s.subarray(32)}function mb(e,t,r,n,s){if(r<32)return-1;FA(e,0,t,0,r,n,s),UA(e,16,e,32,r-32,e);for(let i=0;i<16;i++)e[i]=0;return 0}function _b(e,t,r,n,s){const i=new ze(32);if(r<32||(lb(i,0,32,n,s),Ab(t,16,t,32,r-32,i)!==0))return-1;FA(e,0,t,0,r,n,s);for(let o=0;o<32;o++)e[o]=0;return 0}function UA(e,t,r,n,s,i){const o=ub(i);return fb(o,r,n,s),gb(o,e,t),0}function Ab(e,t,r,n,s,i){const o=new ze(16);return UA(o,0,r,n,s,i),Pb(e,t,o,0)}function Oe(e){const t=new Bh(16);return e&&t.set(e),t}var Ib=new ze(16),Eb=new ze(32);Eb[0]=9;var Cy=Oe(),rc=Oe([1]),Tb=Oe([56129,1]),Sb=Oe([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),bb=Oe([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),$A=Oe([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),VA=Oe([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),wb=Oe([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function Kn(e,t,r){for(let n=0;n<16;n++)e[n]=t[n]+r[n]}function jn(e,t,r){for(let n=0;n<16;n++)e[n]=t[n]-r[n]}function Ye(e,t,r){let n,s,i=0,o=0,c=0,l=0,u=0,g=0,y=0,m=0,d=0,I=0,T=0,S=0,w=0,b=0,R=0,v=0,$=0,D=0,L=0,z=0,Y=0,x=0,H=0,M=0,F=0,K=0,X=0,ye=0,Te=0,le=0,ge=0,N=r[0],oe=r[1],pe=r[2],xe=r[3],ce=r[4],q=r[5],ee=r[6],ae=r[7],se=r[8],we=r[9],De=r[10],Ke=r[11],et=r[12],mt=r[13],_t=r[14],zt=r[15];n=t[0],i+=n*N,o+=n*oe,c+=n*pe,l+=n*xe,u+=n*ce,g+=n*q,y+=n*ee,m+=n*ae,d+=n*se,I+=n*we,T+=n*De,S+=n*Ke,w+=n*et,b+=n*mt,R+=n*_t,v+=n*zt,n=t[1],o+=n*N,c+=n*oe,l+=n*pe,u+=n*xe,g+=n*ce,y+=n*q,m+=n*ee,d+=n*ae,I+=n*se,T+=n*we,S+=n*De,w+=n*Ke,b+=n*et,R+=n*mt,v+=n*_t,$+=n*zt,n=t[2],c+=n*N,l+=n*oe,u+=n*pe,g+=n*xe,y+=n*ce,m+=n*q,d+=n*ee,I+=n*ae,T+=n*se,S+=n*we,w+=n*De,b+=n*Ke,R+=n*et,v+=n*mt,$+=n*_t,D+=n*zt,n=t[3],l+=n*N,u+=n*oe,g+=n*pe,y+=n*xe,m+=n*ce,d+=n*q,I+=n*ee,T+=n*ae,S+=n*se,w+=n*we,b+=n*De,R+=n*Ke,v+=n*et,$+=n*mt,D+=n*_t,L+=n*zt,n=t[4],u+=n*N,g+=n*oe,y+=n*pe,m+=n*xe,d+=n*ce,I+=n*q,T+=n*ee,S+=n*ae,w+=n*se,b+=n*we,R+=n*De,v+=n*Ke,$+=n*et,D+=n*mt,L+=n*_t,z+=n*zt,n=t[5],g+=n*N,y+=n*oe,m+=n*pe,d+=n*xe,I+=n*ce,T+=n*q,S+=n*ee,w+=n*ae,b+=n*se,R+=n*we,v+=n*De,$+=n*Ke,D+=n*et,L+=n*mt,z+=n*_t,Y+=n*zt,n=t[6],y+=n*N,m+=n*oe,d+=n*pe,I+=n*xe,T+=n*ce,S+=n*q,w+=n*ee,b+=n*ae,R+=n*se,v+=n*we,$+=n*De,D+=n*Ke,L+=n*et,z+=n*mt,Y+=n*_t,x+=n*zt,n=t[7],m+=n*N,d+=n*oe,I+=n*pe,T+=n*xe,S+=n*ce,w+=n*q,b+=n*ee,R+=n*ae,v+=n*se,$+=n*we,D+=n*De,L+=n*Ke,z+=n*et,Y+=n*mt,x+=n*_t,H+=n*zt,n=t[8],d+=n*N,I+=n*oe,T+=n*pe,S+=n*xe,w+=n*ce,b+=n*q,R+=n*ee,v+=n*ae,$+=n*se,D+=n*we,L+=n*De,z+=n*Ke,Y+=n*et,x+=n*mt,H+=n*_t,M+=n*zt,n=t[9],I+=n*N,T+=n*oe,S+=n*pe,w+=n*xe,b+=n*ce,R+=n*q,v+=n*ee,$+=n*ae,D+=n*se,L+=n*we,z+=n*De,Y+=n*Ke,x+=n*et,H+=n*mt,M+=n*_t,F+=n*zt,n=t[10],T+=n*N,S+=n*oe,w+=n*pe,b+=n*xe,R+=n*ce,v+=n*q,$+=n*ee,D+=n*ae,L+=n*se,z+=n*we,Y+=n*De,x+=n*Ke,H+=n*et,M+=n*mt,F+=n*_t,K+=n*zt,n=t[11],S+=n*N,w+=n*oe,b+=n*pe,R+=n*xe,v+=n*ce,$+=n*q,D+=n*ee,L+=n*ae,z+=n*se,Y+=n*we,x+=n*De,H+=n*Ke,M+=n*et,F+=n*mt,K+=n*_t,X+=n*zt,n=t[12],w+=n*N,b+=n*oe,R+=n*pe,v+=n*xe,$+=n*ce,D+=n*q,L+=n*ee,z+=n*ae,Y+=n*se,x+=n*we,H+=n*De,M+=n*Ke,F+=n*et,K+=n*mt,X+=n*_t,ye+=n*zt,n=t[13],b+=n*N,R+=n*oe,v+=n*pe,$+=n*xe,D+=n*ce,L+=n*q,z+=n*ee,Y+=n*ae,x+=n*se,H+=n*we,M+=n*De,F+=n*Ke,K+=n*et,X+=n*mt,ye+=n*_t,Te+=n*zt,n=t[14],R+=n*N,v+=n*oe,$+=n*pe,D+=n*xe,L+=n*ce,z+=n*q,Y+=n*ee,x+=n*ae,H+=n*se,M+=n*we,F+=n*De,K+=n*Ke,X+=n*et,ye+=n*mt,Te+=n*_t,le+=n*zt,n=t[15],v+=n*N,$+=n*oe,D+=n*pe,L+=n*xe,z+=n*ce,Y+=n*q,x+=n*ee,H+=n*ae,M+=n*se,F+=n*we,K+=n*De,X+=n*Ke,ye+=n*et,Te+=n*mt,le+=n*_t,ge+=n*zt,i+=38*$,o+=38*D,c+=38*L,l+=38*z,u+=38*Y,g+=38*x,y+=38*H,m+=38*M,d+=38*F,I+=38*K,T+=38*X,S+=38*ye,w+=38*Te,b+=38*le,R+=38*ge,s=1,n=i+s+65535,s=Math.floor(n/65536),i=n-s*65536,n=o+s+65535,s=Math.floor(n/65536),o=n-s*65536,n=c+s+65535,s=Math.floor(n/65536),c=n-s*65536,n=l+s+65535,s=Math.floor(n/65536),l=n-s*65536,n=u+s+65535,s=Math.floor(n/65536),u=n-s*65536,n=g+s+65535,s=Math.floor(n/65536),g=n-s*65536,n=y+s+65535,s=Math.floor(n/65536),y=n-s*65536,n=m+s+65535,s=Math.floor(n/65536),m=n-s*65536,n=d+s+65535,s=Math.floor(n/65536),d=n-s*65536,n=I+s+65535,s=Math.floor(n/65536),I=n-s*65536,n=T+s+65535,s=Math.floor(n/65536),T=n-s*65536,n=S+s+65535,s=Math.floor(n/65536),S=n-s*65536,n=w+s+65535,s=Math.floor(n/65536),w=n-s*65536,n=b+s+65535,s=Math.floor(n/65536),b=n-s*65536,n=R+s+65535,s=Math.floor(n/65536),R=n-s*65536,n=v+s+65535,s=Math.floor(n/65536),v=n-s*65536,i+=s-1+37*(s-1),s=1,n=i+s+65535,s=Math.floor(n/65536),i=n-s*65536,n=o+s+65535,s=Math.floor(n/65536),o=n-s*65536,n=c+s+65535,s=Math.floor(n/65536),c=n-s*65536,n=l+s+65535,s=Math.floor(n/65536),l=n-s*65536,n=u+s+65535,s=Math.floor(n/65536),u=n-s*65536,n=g+s+65535,s=Math.floor(n/65536),g=n-s*65536,n=y+s+65535,s=Math.floor(n/65536),y=n-s*65536,n=m+s+65535,s=Math.floor(n/65536),m=n-s*65536,n=d+s+65535,s=Math.floor(n/65536),d=n-s*65536,n=I+s+65535,s=Math.floor(n/65536),I=n-s*65536,n=T+s+65535,s=Math.floor(n/65536),T=n-s*65536,n=S+s+65535,s=Math.floor(n/65536),S=n-s*65536,n=w+s+65535,s=Math.floor(n/65536),w=n-s*65536,n=b+s+65535,s=Math.floor(n/65536),b=n-s*65536,n=R+s+65535,s=Math.floor(n/65536),R=n-s*65536,n=v+s+65535,s=Math.floor(n/65536),v=n-s*65536,i+=s-1+37*(s-1),e[0]=i,e[1]=o,e[2]=c,e[3]=l,e[4]=u,e[5]=g,e[6]=y,e[7]=m,e[8]=d,e[9]=I,e[10]=T,e[11]=S,e[12]=w,e[13]=b,e[14]=R,e[15]=v}function zn(e,t){Ye(e,t,t)}function Ci(e,t){for(let r=0;r<16;r++)e[r]=t[r]|0}function Ry(e){let t,r,n=1;for(t=0;t<16;t++)r=e[t]+n+65535,n=Math.floor(r/65536),e[t]=r-n*65536;e[0]+=n-1+37*(n-1)}function nc(e,t,r){let n,s=~(r-1);for(let i=0;i<16;i++)n=s&(e[i]^t[i]),e[i]^=n,t[i]^=n}function sc(e,t){const r=Oe(),n=Oe();let s,i,o;for(s=0;s<16;s++)n[s]=t[s];for(Ry(n),Ry(n),Ry(n),i=0;i<2;i++){for(r[0]=n[0]-65517,s=1;s<15;s++)r[s]=n[s]-65535-(r[s-1]>>16&1),r[s-1]&=65535;r[15]=n[15]-32767-(r[14]>>16&1),o=r[15]>>16&1,r[14]&=65535,nc(n,r,1-o)}for(s=0;s<16;s++)e[2*s]=n[s]&255,e[2*s+1]=n[s]>>8}function GA(e,t){const r=new ze(32),n=new ze(32);return sc(r,e),sc(n,t),XA(r,0,n,0)}function KA(e){const t=new ze(32);return sc(t,e),t[0]&1}function jA(e,t){for(let r=0;r<16;r++)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}function Py(e,t){const r=Oe();let n;for(n=0;n<16;n++)r[n]=t[n];for(n=253;n>=0;n--)zn(r,r),n!==2&&n!==4&&Ye(r,r,t);for(n=0;n<16;n++)e[n]=r[n]}function Nb(e,t,r){const n=new ze(32),s=new Bh(80),i=Oe(),o=Oe(),c=Oe(),l=Oe(),u=Oe(),g=Oe();let y,m;for(m=0;m<31;m++)n[m]=t[m];for(n[31]=t[31]&127|64,n[0]&=248,jA(s,r),m=0;m<16;m++)o[m]=s[m],l[m]=i[m]=c[m]=0;for(i[0]=l[0]=1,m=254;m>=0;--m)y=n[m>>>3]>>>(m&7)&1,nc(i,o,y),nc(c,l,y),Kn(u,i,c),jn(i,i,c),Kn(c,o,l),jn(o,o,l),zn(l,u),zn(g,i),Ye(i,c,i),Ye(c,o,u),Kn(u,i,c),jn(i,i,c),zn(o,i),jn(c,l,g),Ye(i,c,Tb),Kn(i,i,l),Ye(c,c,i),Ye(i,l,g),Ye(l,o,s),zn(o,u),nc(i,o,y),nc(c,l,y);for(m=0;m<16;m++)s[m+16]=i[m],s[m+32]=c[m],s[m+48]=o[m],s[m+64]=l[m];const d=s.subarray(32),I=s.subarray(16);return Py(d,d),Ye(I,I,d),sc(e,I),0}function Ob(e,t,r,n){const s=zA(r,n);return db(e,t,s)}function zA(e,t){ic(e,t),Rb(e,t);const r=new ze(32);return Cb(r,e,t),r}function vb(e,t,r,n){const s=zA(r,n);return yb(e,t,s)}function Cb(e,t,r){const n=new ze(32);return Nb(n,r,t),Oy(e,Ib,n,Ca)}function JA(e,t){if(e.length!==32)throw new Error("bad key size");if(t.length!==24)throw new Error("bad nonce size")}function Rb(e,t){if(e.length!==32)throw new Error("bad public key size");if(t.length!==32)throw new Error("bad secret key size")}function ic(...e){for(const t of e)if(!(t instanceof Uint8Array))throw new TypeError("unexpected type, use ByteArray")}function YA(e,t,r,n,s){let i,o=0;for(i=0;i<s;i++)o|=e[t+i]^r[n+i];return(1&o-1>>>8)-1}function Pb(e,t,r,n){return YA(e,t,r,n,16)}function XA(e,t,r,n){return YA(e,t,r,n,32)}function ac(e,t,r){const n=new Su(8),s=new Su(8),i=new ze(256);let o,c=r;for(n[0]=1779033703,n[1]=3144134277,n[2]=1013904242,n[3]=2773480762,n[4]=1359893119,n[5]=2600822924,n[6]=528734635,n[7]=1541459225,s[0]=4089235720,s[1]=2227873595,s[2]=4271175723,s[3]=1595750129,s[4]=2917565137,s[5]=725511199,s[6]=4215389547,s[7]=327033209,qA(n,s,t,r),r%=128,o=0;o<r;o++)i[o]=t[c-r+o];for(i[r]=128,r=256-128*(r<112?1:0),i[r-9]=0,WA(i,r-8,c/536870912|0,c<<3),qA(n,s,i,r),o=0;o<8;o++)WA(e,8*o,n[o],s[o]);return 0}var QA=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function qA(e,t,r,n){const s=new Su(16),i=new Su(16);let o,c,l,u,g,y,m,d,I,T,S,w,b,R,v,$,D,L,z,Y,x,H,M,F,K,X,ye=e[0],Te=e[1],le=e[2],ge=e[3],N=e[4],oe=e[5],pe=e[6],xe=e[7],ce=t[0],q=t[1],ee=t[2],ae=t[3],se=t[4],we=t[5],De=t[6],Ke=t[7],et=0;for(;n>=128;){for(z=0;z<16;z++)Y=8*z+et,s[z]=r[Y+0]<<24|r[Y+1]<<16|r[Y+2]<<8|r[Y+3],i[z]=r[Y+4]<<24|r[Y+5]<<16|r[Y+6]<<8|r[Y+7];for(z=0;z<80;z++)if(o=ye,c=Te,l=le,u=ge,g=N,y=oe,m=pe,d=xe,I=ce,T=q,S=ee,w=ae,b=se,R=we,v=De,$=Ke,x=xe,H=Ke,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=(N>>>14|se<<18)^(N>>>18|se<<14)^(se>>>9|N<<23),H=(se>>>14|N<<18)^(se>>>18|N<<14)^(N>>>9|se<<23),M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,x=N&oe^~N&pe,H=se&we^~se&De,M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,x=QA[z*2],H=QA[z*2+1],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,x=s[z%16],H=i[z%16],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,D=K&65535|X<<16,L=M&65535|F<<16,x=D,H=L,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=(ye>>>28|ce<<4)^(ce>>>2|ye<<30)^(ce>>>7|ye<<25),H=(ce>>>28|ye<<4)^(ye>>>2|ce<<30)^(ye>>>7|ce<<25),M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,x=ye&Te^ye&le^Te&le,H=ce&q^ce&ee^q&ee,M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,d=K&65535|X<<16,$=M&65535|F<<16,x=u,H=w,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=D,H=L,M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,u=K&65535|X<<16,w=M&65535|F<<16,Te=o,le=c,ge=l,N=u,oe=g,pe=y,xe=m,ye=d,q=I,ee=T,ae=S,se=w,we=b,De=R,Ke=v,ce=$,z%16===15)for(Y=0;Y<16;Y++)x=s[Y],H=i[Y],M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=s[(Y+9)%16],H=i[(Y+9)%16],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,D=s[(Y+1)%16],L=i[(Y+1)%16],x=(D>>>1|L<<31)^(D>>>8|L<<24)^D>>>7,H=(L>>>1|D<<31)^(L>>>8|D<<24)^(L>>>7|D<<25),M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,D=s[(Y+14)%16],L=i[(Y+14)%16],x=(D>>>19|L<<13)^(L>>>29|D<<3)^D>>>6,H=(L>>>19|D<<13)^(D>>>29|L<<3)^(L>>>6|D<<26),M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,s[Y]=K&65535|X<<16,i[Y]=M&65535|F<<16;x=ye,H=ce,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=e[0],H=t[0],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,e[0]=ye=K&65535|X<<16,t[0]=ce=M&65535|F<<16,x=Te,H=q,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=e[1],H=t[1],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,e[1]=Te=K&65535|X<<16,t[1]=q=M&65535|F<<16,x=le,H=ee,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=e[2],H=t[2],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,e[2]=le=K&65535|X<<16,t[2]=ee=M&65535|F<<16,x=ge,H=ae,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=e[3],H=t[3],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,e[3]=ge=K&65535|X<<16,t[3]=ae=M&65535|F<<16,x=N,H=se,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=e[4],H=t[4],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,e[4]=N=K&65535|X<<16,t[4]=se=M&65535|F<<16,x=oe,H=we,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=e[5],H=t[5],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,e[5]=oe=K&65535|X<<16,t[5]=we=M&65535|F<<16,x=pe,H=De,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=e[6],H=t[6],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,e[6]=pe=K&65535|X<<16,t[6]=De=M&65535|F<<16,x=xe,H=Ke,M=H&65535,F=H>>>16,K=x&65535,X=x>>>16,x=e[7],H=t[7],M+=H&65535,F+=H>>>16,K+=x&65535,X+=x>>>16,F+=M>>>16,K+=F>>>16,X+=K>>>16,e[7]=xe=K&65535|X<<16,t[7]=Ke=M&65535|F<<16,et+=128,n-=128}return n}function WA(e,t,r,n){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=r&255,e[t+4]=n>>24&255,e[t+5]=n>>16&255,e[t+6]=n>>8&255,e[t+7]=n&255}function xb(e,t){if(ic(e,t),t.length!==64)throw new Error("bad secret key size");const r=new ze(64+e.length);return Mb(r,e,e.length,t),r}function Bb(e,t){const r=xb(e,t),n=new ze(64);for(let s=0;s<n.length;s++)n[s]=r[s];return n}function Hb(e,t,r){if(ic(e,t,r),t.length!==64)throw new Error("bad signature size");if(r.length!==32)throw new Error("bad public key size");const n=new ze(64+e.length),s=new ze(64+e.length);return n.set(t),n.set(e,64),Db(s,n,n.length,r)>=0}function kb(e){if(ic(e),e.length!==32)throw new Error("bad seed size");const t=new ze(32),r=new ze(64);for(let n=0;n<32;n++)r[n]=e[n];return Lb(t,r),{publicKey:t,secretKey:r}}function Lb(e,t,r){const n=new ze(64),s=[Oe(),Oe(),Oe(),Oe()];let i;for(ac(n,t,32),n[0]&=248,n[31]&=127,n[31]|=64,xy(s,n),By(e,s),i=0;i<32;i++)t[i+32]=e[i];return 0}function Mb(e,t,r,n){const s=new ze(64),i=new ze(64),o=new ze(64),c=new Bh(64),l=[Oe(),Oe(),Oe(),Oe()];let u,g;ac(s,n,32),s[0]&=248,s[31]&=127,s[31]|=64;const y=r+64;for(u=0;u<r;u++)e[64+u]=t[u];for(u=0;u<32;u++)e[32+u]=s[32+u];for(ac(o,e.subarray(32),r+32),Hy(o),xy(l,o),By(e,l),u=32;u<64;u++)e[u]=n[u];for(ac(i,e,r+64),Hy(i),u=0;u<64;u++)c[u]=0;for(u=0;u<32;u++)c[u]=o[u];for(u=0;u<32;u++)for(g=0;g<32;g++)c[u+g]+=i[u]*s[g];return tI(e.subarray(32),c),y}function Db(e,t,r,n){const s=new ze(32),i=new ze(64),o=[Oe(),Oe(),Oe(),Oe()],c=[Oe(),Oe(),Oe(),Oe()];let l,u;if(u=-1,r<64||eI(c,n))return-1;for(l=0;l<r;l++)e[l]=t[l];for(l=0;l<32;l++)e[l+32]=n[l];if(ac(i,e,r),Hy(i),ZA(o,c,i),xy(c,t.subarray(32)),Ly(o,c),By(s,o),r-=64,XA(t,0,s,0)){for(l=0;l<r;l++)e[l]=0;return-1}for(l=0;l<r;l++)e[l]=t[l+64];return u=r,u}function xy(e,t){const r=[Oe(),Oe(),Oe(),Oe()];Ci(r[0],$A),Ci(r[1],VA),Ci(r[2],rc),Ye(r[3],$A,VA),ZA(e,r,t)}function ZA(e,t,r){let n,s;for(Ci(e[0],Cy),Ci(e[1],rc),Ci(e[2],rc),Ci(e[3],Cy),s=255;s>=0;--s)n=r[s/8|0]>>(s&7)&1,rI(e,t,n),Ly(t,e),Ly(e,e),rI(e,t,n)}function By(e,t){const r=Oe(),n=Oe(),s=Oe();Py(s,t[2]),Ye(r,t[0],s),Ye(n,t[1],s),sc(e,n),e[31]^=KA(r)<<7}function eI(e,t){const r=Oe(),n=Oe(),s=Oe(),i=Oe(),o=Oe(),c=Oe(),l=Oe();return Ci(e[2],rc),jA(e[1],t),zn(s,e[1]),Ye(i,s,Sb),jn(s,s,e[2]),Kn(i,e[2],i),zn(o,i),zn(c,o),Ye(l,c,o),Ye(r,l,s),Ye(r,r,i),Fb(r,r),Ye(r,r,s),Ye(r,r,i),Ye(r,r,i),Ye(e[0],r,i),zn(n,e[0]),Ye(n,n,i),GA(n,s)&&Ye(e[0],e[0],wb),zn(n,e[0]),Ye(n,n,i),GA(n,s)?-1:(KA(e[0])===t[31]>>7&&jn(e[0],Cy,e[0]),Ye(e[3],e[0],e[1]),0)}function Hy(e){const t=new Bh(64);let r;for(r=0;r<64;r++)t[r]=e[r];for(r=0;r<64;r++)e[r]=0;tI(e,t)}var ky=new Bh([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function tI(e,t){let r,n,s,i;for(n=63;n>=32;--n){for(r=0,s=n-32,i=n-12;s<i;++s)t[s]+=r-16*t[n]*ky[s-(n-32)],r=Math.floor((t[s]+128)/256),t[s]-=r*256;t[s]+=r,t[n]=0}for(r=0,s=0;s<32;s++)t[s]+=r-(t[31]>>4)*ky[s],r=t[s]>>8,t[s]&=255;for(s=0;s<32;s++)t[s]-=r*ky[s];for(n=0;n<32;n++)t[n+1]+=t[n]>>8,e[n]=t[n]&255}function Ly(e,t){const r=Oe(),n=Oe(),s=Oe(),i=Oe(),o=Oe(),c=Oe(),l=Oe(),u=Oe(),g=Oe();jn(r,e[1],e[0]),jn(g,t[1],t[0]),Ye(r,r,g),Kn(n,e[0],e[1]),Kn(g,t[0],t[1]),Ye(n,n,g),Ye(s,e[3],t[3]),Ye(s,s,bb),Ye(i,e[2],t[2]),Kn(i,i,i),jn(o,n,r),jn(c,i,s),Kn(l,i,s),Kn(u,n,r),Ye(e[0],o,c),Ye(e[1],u,l),Ye(e[2],l,c),Ye(e[3],o,u)}function rI(e,t,r){for(let n=0;n<4;n++)nc(e[n],t[n],r)}function Fb(e,t){const r=Oe();let n;for(n=0;n<16;n++)r[n]=t[n];for(n=250;n>=0;n--)zn(r,r),n!==1&&Ye(r,r,t);for(n=0;n<16;n++)e[n]=r[n]}var Ub={create(e){const t=kb(e);return{secretKey:dr.from(t.secretKey),publicKey:dr.from(t.publicKey)}},detached_sign(e,t){return dr.from(Bb(e,t))},detached_verify(e,t,r){return Hb(e,t,r)},box(e,t,r,n=new Uint8Array(24)){return{encryptedMessage:Ob(e,n,t,r),nonce:n}},open(e,t,r,n){return vb(e,t,r,n)||!1}};function $b(e){let t=new Uint8Array(32),r=[Oe(),Oe(),Oe(),Oe()],n=Oe(),s=Oe();if(eI(r,e))throw new TypeError("invalid public key");let i=r[1];return Kn(n,rc,i),jn(s,rc,i),Py(s,s),Ye(n,n,s),sc(t,n),t}function Vb(e){let t=new Uint8Array(64),r=new Uint8Array(32),n;for(ac(t,e,32),t[0]&=248,t[31]&=127,t[31]|=64,n=0;n<32;n++)r[n]=t[n];for(n=0;n<64;n++)t[n]=0;return r}var Gb={convertPublicKey:$b,convertSecretKey:Vb},nI=class{createRemark(e){return uc.fromObject({remark:e})}};nI=p([j()],nI);var Kb={CURRENT_HEIGHT:Symbol("currentHeight")},Ra=class{constructor(e=0){this.currentHeight=e,this.emitter=new mn,this.emitter.on("height",t=>{const r=this.currentHeight;this.currentHeight=t,this.emitter.emit("heightChanged",{oldHeight:r,newHeight:t})})}changeHeight(e){this.emitter.emit("height",e)}onHeightChanged(e){this.emitter.on("heightChanged",e)}planAfterHeight(e,t,r){let n=0;this.emitter.on("heightChanged",({newHeight:s,oldHeight:i})=>{s>i?s>=e&&n!==1&&(t(),n=1):s<e&&n!==0&&(r(),n=0)}),this.currentHeight>=e&&(t(),n=1)}get version(){return this._version}};p([k(re),h("design:type",re)],Ra.prototype,"config",void 0),p([k(Ih),h("design:type",Ih)],Ra.prototype,"block",void 0),p([k("blockGetterHelper",{optional:!0,dynamics:!0}),h("design:type",Object)],Ra.prototype,"blockGetterHelper",void 0),Ra=p([j({group:!0}),Se(0,k(Kb.CURRENT_HEIGHT,{optional:!0})),h("design:paramtypes",[Number])],Ra);var My=class extends gl{constructor(e,t){super(),this.moduleMap=e,this.config=t,this._consensusVersionAndHeightMap=new Map,this._lastConsensusVersion=1,this._lastPatchEffectiveHeight=1,this._patchVersionMap=new Gt(()=>0)}bfAfterInit(){this._isPatchReady=this._installPatchs().then(()=>{this._isPatchReady=void 0})}get lastConsensusVersion(){return this._lastConsensusVersion}get lastPatchEffectiveHeight(){return this._lastPatchEffectiveHeight}_installPatch(e){At(e,this.moduleMap)}async getPatchEffectiveAfterHeightByVersion(e){let t=0;if(e<=1)return 0;await this._isPatchReady;for(const[r,n]of this._consensusVersionAndHeightMap.entries()){if(e===r)return n;t=n}return t}async changeHeight(e){await this._isPatchReady;const t=this.moduleMap.groupGet(Ra);for(const r of t)r.changeHeight(e)}async _installPatchs(){const e=[...this.moduleMap.groupGet(Ra)];e.sort((n,s)=>n.version-s.version);const t=new Gt(n=>e.filter(s=>s.name===n).sort((s,i)=>i.version-s.version)[0].version),r=new mn;this.config.version;try{for(const n of e){r.emit("progress",n);const s=this._patchVersionMap.forceGet(n.name);if(s<n.version){this._consensusVersionAndHeightMap.set(n.consensusVersion,n.patchEffectiveAfterHeight);const i=t.forceGet(n.name);await n.upgradeHandler(s,i),this._patchVersionMap.set(n.name,n.version),this._lastConsensusVersion<n.consensusVersion&&(this._lastConsensusVersion=n.consensusVersion),this._lastPatchEffectiveHeight<n.patchEffectiveAfterHeight&&(this._lastPatchEffectiveHeight=n.patchEffectiveAfterHeight)}}r.emit("done")}catch(n){this.emit("error",n),r.emit("error",n)}this.config.version}};My=p([j(),h("design:paramtypes",[je,re])],My);var Hh=class{constructor(e,t,r,n,s,i,o,c,l,u,g,y,m,d,I,T,S,w,b,R,v,$,D,L,z,Y,x,H){this.config=e,this.cryptoHelper=t,this.keypairHelper=r,this.ed2curveHelper=n,this.Buffer=s,this.base58Helper=i,this.jsbiHelper=o,this.asymmetricHelper=c,this.accountBaseHelper=l,this.transactionHelper=u,this.blockHelper=g,this.parityBitHelper=y,this.baseHelper=m,this.chainAssetInfoHelper=d,this.migrateCertificateHelper=I,this.registerChainCertificateHelper=T,this.complexTransactionLogicHelper=S,this.configMap=w,this.block=b,this.blockLogicVerifier=R,this.blockTicker=v,this.transaction=$,this.transactionLogicVerifier=D,this.channel=L,this.time=z,this.moduleMap=Y,this.patchInstaller=x,this.i18N=H,this.i18N.addErrorCodeList("BFCHAIN-CORE",a,DE)}};Hh=p([j(),Se(1,k("cryptoHelper")),Se(2,k("keypairHelper")),Se(3,k("ed2curveHelper")),Se(4,k("Buffer")),h("design:paramtypes",[re,Object,Object,Object,Object,wl,St,_r,de,_e,ht,bl,Re,Le,Fs,Cl,Nr,yr,Ih,ly,dy,kt,$s,wy,xt,je,My,Yg])],Hh);function sI(e,t=new je,r){["config","Buffer","cryptoHelper","keypairHelper","ed2curveHelper","blockGetterHelper","blobSha256Reader","blobSha256Writer","TIME_SPEED"].forEach(s=>{t.has(s)||t.set(s,e[s])});let n=t.get("configMap");return n||(n=new yr,t.set("configMap",n)),n.set(e.config.magic,e.config),r&&r.forEach(s=>{At(s,t)}),t.set("BFChainCoreFactory",sI),At(Hh,t)}var cn=class{constructor(){this.defaultDiffHeight=20}async _createSomeTransaction(e,t,r,n,s){const{transactionCore:i,timeHelper:o,config:c,accountBaseHelper:l}=this,u=await l.createSecretKeypair(t.mainSecret);let g;t.paySecret&&(g=await this.accountBaseHelper.createSecondSecretKeypair(t.mainSecret,t.paySecret));const y=await this.transactionCore.getTransactionTypeFromTransactionFactoryConstructor(e),m=await l.getAddressFromPublicKey(u.publicKey),d=u.publicKey.toString("hex"),I=r.applyBlockHeight||1,T=g&&g.publicKey.toString("hex"),S=r.fromMagic||c.magic,w=r.toMagic||c.magic,b={...this.customTrsRemark,...r.remark||{}};let R,v=0;const $=[];r.recipientId&&(typeof r.recipientId=="string"?R=r.recipientId:(v=r.recipientId.type,$.push(...r.recipientId.range)));let D;r.effectiveBlockHeight?D=await this.checkEffectiveBlockHeight(r.effectiveBlockHeight,I):D=await this.calcEffectiveBlockHeight(I);const L=(Y,x=!0)=>i.createTransaction(e,{version:this.config.version,type:y,senderId:m,senderPublicKey:d,senderSecondPublicKey:T,recipientId:R||void 0,range:$,rangeType:v,fee:Y,timestamp:r.timestamp||(r.timestamp=o.getTimestamp()),dappid:r.dappid||void 0,lns:r.lns||void 0,sourceIP:r.sourceIP||void 0,fromMagic:S,toMagic:w,applyBlockHeight:I,effectiveBlockHeight:D,remark:b,storage:s},n,u,g,this.config);let z=r.fee;if(z.startsWith("AUTO")){const Y=[];(r.fee.startsWith("AUTO:")?r.fee.slice(5).split(","):[]).forEach(F=>{const K=F[0];K==="*"?Y.push({type:"mul",rate:parseFloat(F.slice(1))||1}):K===">"&&Y.push({type:"max",value:BigInt(F.slice(1))})});let x="1";const{maxTransactionSize:H,minTransactionFeePerByte:M}=this.config;if(y===this.transactionHelper.GIFT_ASSET){const{totalGrabableTimes:F}=n.giftAsset;x=this.jsbiHelper.multiplyCeilFraction(H*(F+1),M).toString()}else if(y===this.transactionHelper.TRUST_ASSET){const{numberOfSignFor:F}=n.trustAsset;x=this.jsbiHelper.multiplyCeilFraction(H*(F+1),M).toString()}else if(y===this.transactionHelper.GIFT_ANY){const{totalGrabableTimes:F}=n.giftAny;x=this.jsbiHelper.multiplyCeilFraction(H*(F+1),M).toString()}z=this.calcTransactionFee(await L(x,!0),{modes:Y})}return await L(z)}createSignatureTransaction(e,t,r){return this._createSomeTransaction(Rl,e,t,r)}createTransferAssetTransaction(e,t,r){return this._createSomeTransaction(xl,e,t,r,{key:"assetType",value:r.transferAsset.assetType})}createTransferAnyTransaction(e,t,r,n=!1){return this._createSomeTransaction(Bl,e,t,r,n?void 0:{key:"assetType",value:r.transferAny.assetType})}createIssueEntityFactoryTransaction(e,t,r){return this._createSomeTransaction($l,e,t,r,{key:"factoryId",value:r.issueEntityFactory.factoryId})}createIssueEntityTransaction(e,t,r){return this._createSomeTransaction(Vl,e,t,r,{key:"entityId",value:r.issueEntity.entityId})}createIssueEntityMultiTransaction(e,t,r){return this._createSomeTransaction(Kl,e,t,r,{key:"factoryId",value:r.issueEntityMulti.entityFactory.factoryId})}createToExchangeAnyTransaction(e,t,r){return this._createSomeTransaction(lh,e,t,r)}createBeExchangeAnyTransaction(e,t,r){return this._createSomeTransaction(Gl,e,t,r,{key:"transactionSignature",value:r.beExchangeAny.transactionSignature})}createToExchangeAnyMultiTransaction(e,t,r){return this._createSomeTransaction(jl,e,t,r)}createBeExchangeAnyMultiTransaction(e,t,r){return this._createSomeTransaction(zl,e,t,r,{key:"transactionSignature",value:r.beExchangeAnyMulti.transactionSignature})}createGiftAnyTransaction(e,t,r){return this._createSomeTransaction(hh,e,t,r,{key:"assetType",value:r.giftAny.assetType})}createGrabAnyTransaction(e,t,r){return this._createSomeTransaction(Dl,e,t,r,{key:"transactionSignature",value:r.grabAny.transactionSignature})}createDestoryAssetTransaction(e,t,r){return this._createSomeTransaction(Hl,e,t,r,{key:"assetType",value:r.destroyAsset.assetType})}calcTransactionFee(e,t={}){const{minTransactionFeePerByte:r=this.config.minTransactionFeePerByte,modes:n}=t;let s=e.getBytes().length,i=e.fee;do{const o=this.jsbiHelper.multiplyCeilFraction(s,r),c=o.toString();if(c.length<=i.length){let l=o;if(n)for(const g of n)g.type==="mul"?l=this.jsbiHelper.multiplyCeil(l,g.rate):g.type==="max"&&g.value>l&&(l=g.value);const u=BigInt(e.fee);return(u>l?u>o?u:o:l).toString()}s+=c.length-i.length,i=c}while(!0)}calcEffectiveBlockHeight(e){return this.checkEffectiveBlockHeight(e+this.defaultDiffHeight,e)}checkEffectiveBlockHeight(e,t){const r=t+this.config.maxApplyAndConfirmedBlockHeightDiff,n=t+this.config.blockPerRound*2;return e<n&&(e=n),e>r?r:e}};p([k("customTrsRemark",{optional:!0,dynamics:!0}),h("design:type",Object)],cn.prototype,"customTrsRemark",void 0),p([k(kt),h("design:type",kt)],cn.prototype,"transactionCore",void 0),p([k(_e),h("design:type",_e)],cn.prototype,"transactionHelper",void 0),p([k(xt),h("design:type",xt)],cn.prototype,"timeHelper",void 0),p([k(re),h("design:type",re)],cn.prototype,"config",void 0),p([k(Fs),h("design:type",Fs)],cn.prototype,"migrateCertificateHelper",void 0),p([k(St),h("design:type",St)],cn.prototype,"jsbiHelper",void 0),p([k(fl),h("design:type",fl)],cn.prototype,"flagsHelper",void 0),p([k(de),h("design:type",de)],cn.prototype,"accountBaseHelper",void 0),cn=p([j()],cn);var wu=class extends cn{async createTransferTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createTransferAssetTransaction(t,s,{transferAsset:{sourceChainName:n.sourceChainName||this.config.chainName,sourceChainMagic:n.sourceChainMagic,assetType:n.assetType,amount:n.amount}})).toJSON()}async getTransferTransactionMinFee(e){const{transaction:t,assetInfo:r}=e,n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:await this.accountBaseHelper.getAddressFromSecret(`secrets:${Date.now()}-getRecipientId`),remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight},i=await this.createTransferAssetTransaction(n,s,{transferAsset:{sourceChainName:r.sourceChainName||this.config.chainName,sourceChainMagic:r.sourceChainMagic,assetType:r.assetType,amount:r.amount}}),o=(this.transactionHelper.calcTransactionMinFeeByBytes(i,i.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(2))}async createSignatureTransactionJSON(e,t){const r=await this.accountBaseHelper.getPublicKeyStringFromSecondSecret(e.mainSecret,t.newPaySecret);return(await this.createSignatureTransaction(e,{fee:t.fee,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight},{signature:{publicKey:r}})).toJSON()}async getSignatureTransactionMinFee(e){const t={mainSecret:`secrets:${Date.now()}`,paySecret:"1"+e.newPaySecret},r=await this.accountBaseHelper.getPublicKeyStringFromSecondSecret(t.mainSecret,e.newPaySecret),n=await this.createSignatureTransaction(t,{fee:"1",applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},{signature:{publicKey:r}}),s=(this.transactionHelper.calcTransactionMinFeeByBytes(n,n.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(n)).toString();return String(BigInt(s)*BigInt(2))}async createCertificateTransferTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createTransferAnyTransaction(t,s,{transferAny:{...n,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,parentAssetType:G.CERTIFICATE}})).toJSON()}async createEntityTransferTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createTransferAnyTransaction(t,s,{transferAny:{...n,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,parentAssetType:G.ENTITY}})).toJSON()}async createEntityTransferTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"1",recipientId:await this.accountBaseHelper.getAddressFromSecret(`secrets:${Date.now()}-getRecipientId`),remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},s=await this.createTransferAnyTransaction(r,n,{transferAny:{...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,parentAssetType:G.ENTITY}}),i=(this.transactionHelper.calcTransactionMinFeeByBytes(s,s.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(s)).toString();return String(BigInt(i)*BigInt(12)/BigInt(10))}async createDestoryAssetTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createDestoryAssetTransaction(t,s,{destroyAsset:{sourceChainName:n.sourceChainName||this.config.chainName,sourceChainMagic:n.sourceChainMagic,assetType:n.assetType,amount:n.amount}})).toJSON()}async getDestoryAssetTransactionMinFee(e){const{transaction:t,assetInfo:r}=e,n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:await this.accountBaseHelper.getAddressFromSecret(`secrets:${Date.now()}-getRecipientId`),remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight},i=await this.createDestoryAssetTransaction(n,s,{destroyAsset:{sourceChainName:r.sourceChainName||this.config.chainName,sourceChainMagic:r.sourceChainMagic,assetType:r.assetType,amount:r.amount}}),o=(this.transactionHelper.calcTransactionMinFeeByBytes(i,i.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(2))}};wu=p([j()],wu);var Nu=class extends cn{async createIssueEntityFactoryTransactionJSON(e,t,r){const n={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight,recipientId:t.recipientId},s={...r,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName};return(await this.createIssueEntityFactoryTransaction(e,n,{issueEntityFactory:s})).toJSON()}async getCreateIssueEntityFactoryTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight,recipientId:e.recipientId},s={...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},i=await this.createIssueEntityFactoryTransaction(r,n,{issueEntityFactory:s}),o=(this.transactionHelper.calcTransactionMinFeeByBytes(i,i.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(105)/BigInt(100))}async createIssueEntityTransactionJSON(e,t,r){const n={...r.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...r,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},i={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight,recipientId:t.recipientId};return(await this.createIssueEntityTransaction(e,i,{issueEntity:s})).toJSON()}async getCreateIssueEntityTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={...t.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},i={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight,recipientId:e.recipientId},o=await this.createIssueEntityTransaction(r,i,{issueEntity:s}),c=(this.transactionHelper.calcTransactionMinFeeByBytes(o,o.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(o)).toString();return String(BigInt(c)*BigInt(105)/BigInt(100))}async createIssueEntityMultiTransactionJSON(e,t,r){const n={...r.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...r,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},i={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight,recipientId:t.recipientId};return(await this.createIssueEntityMultiTransaction(e,i,{issueEntityMulti:s})).toJSON()}async getCreateIssueEntityMultiTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={...t.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},i={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight,recipientId:e.recipientId},o=await this.createIssueEntityMultiTransaction(r,i,{issueEntityMulti:s}),c=(this.transactionHelper.calcTransactionMinFeeByMulti(o,o.asset.issueEntityMulti.entityStructList.length)+this.transactionHelper.calcTransactionBlobFee(o)).toString();return String(BigInt(c)*BigInt(105)/BigInt(100))}async createToExchangeAnyTransactionJSON(e,t,r){const n={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createToExchangeAnyTransaction(e,n,{toExchangeAny:{...r,cipherPublicKeys:[]}})).toJSON()}async getCreateToExchangeAnyTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},s=await this.createToExchangeAnyTransaction(r,n,{toExchangeAny:{...t,cipherPublicKeys:[]}}),i=(this.transactionHelper.calcTransactionMinFeeByBytes(s,s.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(s)).toString();return String(BigInt(i)*BigInt(105)/BigInt(100))}async createBeExchangeAnyTransactionJSON(e,t,r,n){const s={fee:t.fee,recipientId:t.recipientId,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createBeExchangeAnyTransaction(e,s,{beExchangeAny:{...r,exchangeAny:{...n,cipherPublicKeys:[]}}})).toJSON()}async getCreateBeExchangeAnyTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:e.recipientId,remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},i=await this.createBeExchangeAnyTransaction(n,s,{beExchangeAny:{...t,exchangeAny:{...r,cipherPublicKeys:[]}}}),o=(this.transactionHelper.calcTransactionMinFeeByBytes(i,i.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(105)/BigInt(100))}async createToExchangeAnyMultiTransactionJSON(e,t,r,n){const s={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createToExchangeAnyMultiTransaction(e,s,{toExchangeAnyMulti:{cipherPublicKeys:[],toExchangeAssets:r,beExchangeAsset:n}})).toJSON()}async getCreateToExchangeAnyMultiTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},i=await this.createToExchangeAnyMultiTransaction(n,s,{toExchangeAnyMulti:{cipherPublicKeys:[],toExchangeAssets:t,beExchangeAsset:r}}),o=(this.transactionHelper.calcTransactionMinFeeByMulti(i,i.asset.toExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(105)/BigInt(100))}async createBeExchangeAnyMultiTransactionJSON(e,t,r,n){const s={fee:t.fee,recipientId:t.recipientId,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createBeExchangeAnyMultiTransaction(e,s,{beExchangeAnyMulti:{transactionSignature:t.transactionSignature,toExchangeAssets:r,beExchangeAsset:n}})).toJSON()}async getCreateBeExchangeAnyMultiTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:e.recipientId,remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},i=await this.createBeExchangeAnyMultiTransaction(n,s,{beExchangeAnyMulti:{transactionSignature:e.transactionSignature,toExchangeAssets:t,beExchangeAsset:r}}),o=(this.transactionHelper.calcTransactionMinFeeByMulti(i,i.asset.beExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(i)).toString();return String(BigInt(o)*BigInt(105)/BigInt(100))}async createGiftAnyTransactionJSON(e,t,r){const n={recipientId:{type:1,range:[t.recipientId]},fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createGiftAnyTransaction(e,n,{giftAny:{...r,cipherPublicKeys:[]}})).toJSON()}async getCreateGiftAnyTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"AUTO",recipientId:{type:1,range:[e.recipientId]},remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},s=await this.createGiftAnyTransaction(r,n,{giftAny:{...t,cipherPublicKeys:[]}});let i=this.transactionHelper.calcTransactionMinFeeByBytes(s,s.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(s);const o=BigInt(s.fee);return o>i&&(i=o),String(i*BigInt(105)/BigInt(100))}async createGrabAnyTransactionJSON(e,t,r,n){const s={fee:t.fee,recipientId:t.recipientId,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createGrabAnyTransaction(e,s,{grabAny:{...r,giftAny:{...n,cipherPublicKeys:[]}}})).toJSON()}async getCreateGrabAnyTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"AUTO",recipientId:e.recipientId,remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},i=await this.createGrabAnyTransaction(n,s,{grabAny:{...t,giftAny:{...r,cipherPublicKeys:[]}}});let o=this.transactionHelper.calcTransactionMinFeeByBytes(i,i.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(i);const c=BigInt(i.fee);return c>o&&(o=c),String(o*BigInt(105)/BigInt(100))}};Nu=p([j()],Nu);var jb="BTGMetaBundleCore";pn.BTGMetaBundleCore=class extends mn{constructor(e){super(),this.moduleMap=e,this._init_task=new Kt}accountBaseHelper(){return this.bfchainCore.accountBaseHelper}keypairHelper(){return this.bfchainCore.keypairHelper}config(){return this.bfchainCore.config}getMagic(){return this.bfchainCore.config.magic}getAssetType(){return this.bfchainCore.config.assetType}getChainName(){return this.bfchainCore.config.chainName}afterInit(){return this._init_task.promise}async bfOnInit(){try{this._init_task.resolve()}catch(e){this._init_task.reject(e)}}},p([k(Hh),h("design:type",Hh)],pn.BTGMetaBundleCore.prototype,"bfchainCore",void 0),p([k(wu),h("design:type",wu)],pn.BTGMetaBundleCore.prototype,"transactionController",void 0),p([k(Nu),h("design:type",Nu)],pn.BTGMetaBundleCore.prototype,"exchangeTransactionCtrl",void 0),pn.BTGMetaBundleCore=p([j(jb),h("design:paramtypes",[je])],pn.BTGMetaBundleCore);var iI=new Map,zb=async(e,t,r={})=>{const n=e.magic;let s=iI.get(n);if(s)return s;const i=new je,o=sI({config:new re(e,"bfchain-bundle"),Buffer:Jn.Buffer,cryptoHelper:t,keypairHelper:Ub,ed2curveHelper:Gb},i);return i.set("Buffer",Jn.Buffer),i.set("customTrsRemark",r),iI.set(n,s=At(pn.BTGMetaBundleCore,o.moduleMap)),s};pn.setup=zb}}),Qb=Xb();const mw=Qb.setup;export{Qb as default,mw as setup};
