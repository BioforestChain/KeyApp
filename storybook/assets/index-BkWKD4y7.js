import{o as l,n as c,b as w,s as h}from"./schemas-CO8_C8zP.js";const d={INTERNAL_ERROR:-32603};function u(r,e,t){const n=new Error(e);return n.code=r,n.data=t,n}class g{handlers=new Map;on(e,t){let n=this.handlers.get(e);n||(n=new Set,this.handlers.set(e,n)),n.add(t)}off(e,t){const n=this.handlers.get(e);n&&(n.delete(t),n.size===0&&this.handlers.delete(e))}emit(e,...t){const n=this.handlers.get(e);n&&n.forEach(i=>{try{i(...t)}catch(s){console.error("[bio-sdk] Error in event handler:",s)}})}removeAllListeners(e){e?this.handlers.delete(e):this.handlers.clear()}}class E{events=new g;pendingRequests=new Map;requestIdCounter=0;connected=!1;targetOrigin;constructor(e="*"){this.targetOrigin=e,this.setupMessageListener(),this.connect()}setupMessageListener(){window.addEventListener("message",this.handleMessage.bind(this))}handleMessage(e){const t=e.data;!t||typeof t!="object"||(t.type==="bio_response"?this.handleResponse(t):t.type==="bio_event"&&this.handleEvent(t))}handleResponse(e){const t=this.pendingRequests.get(e.id);if(t)if(this.pendingRequests.delete(e.id),e.success)t.resolve(e.result);else{const n=e.error??{code:d.INTERNAL_ERROR,message:"Unknown error"};t.reject(u(n.code,n.message,n.data))}}handleEvent(e){this.events.emit(e.event,...e.args),e.event==="connect"?this.connected=!0:e.event==="disconnect"&&(this.connected=!1)}connect(){this.postMessage({type:"bio_request",id:this.generateId(),method:"bio_connect",params:[]})}generateId(){return`bio_${Date.now()}_${++this.requestIdCounter}`}postMessage(e){if(window.parent===window){console.warn("[bio-sdk] Not running in iframe, postMessage will not work");return}window.parent.postMessage(e,this.targetOrigin)}async request(e){const t=this.generateId();return new Promise((n,i)=>{this.pendingRequests.set(t,{resolve:n,reject:i}),this.postMessage({type:"bio_request",id:t,method:e.method,params:e.params}),setTimeout(()=>{this.pendingRequests.has(t)&&(this.pendingRequests.delete(t),i(u(d.INTERNAL_ERROR,"Request timeout")))},300*1e3)})}on(e,t){this.events.on(e,t)}off(e,t){this.events.off(e,t)}isConnected(){return this.connected}}class R{events=new g;pendingRequests=new Map;requestIdCounter=0;connected=!1;currentChainId=null;accounts=[];targetOrigin;isMetaMask=!1;isKeyApp=!0;constructor(e="*"){this.targetOrigin=e,this.setupMessageListener()}setupMessageListener(){window.addEventListener("message",this.handleMessage.bind(this))}handleMessage(e){const t=e.data;!t||typeof t!="object"||(t.type==="eth_response"?this.handleResponse(t):t.type==="eth_event"&&this.handleEvent(t))}handleResponse(e){const t=this.pendingRequests.get(e.id);if(t)if(this.pendingRequests.delete(e.id),e.success)t.resolve(e.result);else{const n=e.error??{code:d.INTERNAL_ERROR,message:"Unknown error"};t.reject(u(n.code,n.message,n.data))}}handleEvent(e){if(this.events.emit(e.event,...e.args),e.event==="connect"){this.connected=!0;const t=e.args[0];this.currentChainId=t?.chainId??null}else e.event==="disconnect"?(this.connected=!1,this.accounts=[]):e.event==="chainChanged"?this.currentChainId=e.args[0]:e.event==="accountsChanged"&&(this.accounts=e.args[0])}generateId(){return`eth_${Date.now()}_${++this.requestIdCounter}`}postMessage(e){window.parent!==window&&window.parent.postMessage(e,this.targetOrigin)}async request(e){const{method:t,params:n}=e,i=Array.isArray(n)?n:n?[n]:[],s=this.generateId();return new Promise((a,o)=>{this.pendingRequests.set(s,{resolve:a,reject:o}),this.postMessage({type:"eth_request",id:s,method:t,params:i}),setTimeout(()=>{this.pendingRequests.has(s)&&(this.pendingRequests.delete(s),o(u(d.INTERNAL_ERROR,"Request timeout")))},300*1e3)})}on(e,t){return this.events.on(e,t),this}off(e,t){return this.events.off(e,t),this}removeListener(e,t){return this.off(e,t)}once(e,t){const n=(...i)=>{this.off(e,n),t(...i)};return this.on(e,n),this}isConnected(){return this.connected}get chainId(){return this.currentChainId}get selectedAddress(){return this.accounts[0]??null}async enable(){return this.request({method:"eth_requestAccounts"})}send(e,t){return this.request({method:e,params:t})}sendAsync(e,t){this.request({method:e.method,params:e.params}).then(n=>t(null,{result:n})).catch(n=>t(n))}}function b(r="*"){if(typeof window>"u")throw new Error("[EthereumProvider] Cannot initialize: window is not defined");if(window.ethereum)return window.ethereum;const e=new R(r);return window.ethereum=e,e}class _{events=new g;pendingRequests=new Map;requestIdCounter=0;targetOrigin;constructor(e="*"){this.targetOrigin=e,this.setupMessageListener()}setupMessageListener(){window.addEventListener("message",this.handleMessage.bind(this))}handleMessage(e){const t=e.data;!t||typeof t!="object"||(t.type==="tron_response"?this.handleResponse(t):t.type==="tron_event"&&this.handleEvent(t))}handleResponse(e){const t=this.pendingRequests.get(e.id);if(t)if(this.pendingRequests.delete(e.id),e.success)t.resolve(e.result);else{const n=e.error??{code:d.INTERNAL_ERROR,message:"Unknown error"};t.reject(u(n.code,n.message,n.data))}}handleEvent(e){this.events.emit(e.event,...e.args)}generateId(){return`tron_${Date.now()}_${++this.requestIdCounter}`}postMessage(e){window.parent!==window&&window.parent.postMessage(e,this.targetOrigin)}async request(e){const{method:t,params:n}=e,i=Array.isArray(n)?n:n!==void 0?[n]:[],s=this.generateId();return new Promise((a,o)=>{this.pendingRequests.set(s,{resolve:a,reject:o}),this.postMessage({type:"tron_request",id:s,method:t,params:i}),setTimeout(()=>{this.pendingRequests.has(s)&&(this.pendingRequests.delete(s),o(u(d.INTERNAL_ERROR,"Request timeout")))},300*1e3)})}on(e,t){return this.events.on(e,t),this}off(e,t){return this.events.off(e,t),this}}class A{tronLink;_ready=!1;_defaultAddress={base58:"",hex:""};trx;constructor(e){this.tronLink=e,this.trx=new y(e),e.on("accountsChanged",t=>{if(Array.isArray(t)&&t.length>0){const n=t[0];this._defaultAddress=n,this._ready=!0}else this._defaultAddress={base58:"",hex:""},this._ready=!1})}get ready(){return this._ready}get defaultAddress(){return this._defaultAddress}setAddress(e){this._defaultAddress=e,this._ready=!0}isAddress(e){return e.startsWith("T")?e.length===34:e.startsWith("41")?e.length===42:!1}address={toHex:e=>e,fromHex:e=>e}}class y{tronLink;constructor(e){this.tronLink=e}async sign(e){return this.tronLink.request({method:"tron_signTransaction",params:e})}async sendRawTransaction(e){return this.tronLink.request({method:"tron_sendRawTransaction",params:e})}async getBalance(e){return this.tronLink.request({method:"tron_getBalance",params:e})}async getAccount(e){return this.tronLink.request({method:"tron_getAccount",params:e})}}function I(r="*"){if(typeof window>"u")throw new Error("[TronProvider] Cannot initialize: window is not defined");if(window.tronLink&&window.tronWeb)return{tronLink:window.tronLink,tronWeb:window.tronWeb};const e=new _(r),t=new A(e);return window.tronLink=e,window.tronWeb=t,{tronLink:e,tronWeb:t}}const p="__biochainAndroidFocusBlurLoopGuardState__";function v(r,e){return r instanceof HTMLElement?!!(r===document.body||r===document.documentElement||e&&r instanceof HTMLIFrameElement):!1}function L(r){return/android/i.test(r)}function q(){if(typeof navigator>"u")return!1;const r=navigator,e=r.userAgentData?.platform;return e&&/android/i.test(e)?!0:L(r.userAgent)}function M(r={}){if(typeof window>"u"||typeof document>"u")return()=>{};const e=window,t=e[p];if(t)return t.restore;if(!(r.isAndroid??q)())return()=>{};const i=r.blockIframeElement??!0,s=HTMLElement.prototype.blur;let a=!1;const o=f=>{v(document.activeElement,i)&&(f.stopImmediatePropagation(),f.stopPropagation())};window.addEventListener("blur",o,!0),window.addEventListener("focus",o,!0),HTMLElement.prototype.blur=function(){if(!v(this,i)&&!a){a=!0;try{s.call(this)}finally{queueMicrotask(()=>{a=!1})}}};const m=()=>{window.removeEventListener("blur",o,!0),window.removeEventListener("focus",o,!0),HTMLElement.prototype.blur=s,delete e[p]};return e[p]={restore:m},m}const C={ethereum:1,binance:56},T=Object.fromEntries(Object.entries(C).map(([r,e])=>[e,r])),k={ETH:"ethereum",BSC:"binance",TRON:"tron",BFMCHAIN:"bfmeta",BFCHAIN:"bfchain",eth:"ethereum",bsc:"binance",tron:"tron",bfmchain:"bfmeta",bfchain:"bfchain"};function S(r){return`0x${r.toString(16)}`}function O(r){if(!r.startsWith("0x"))throw new Error(`Invalid hex chain ID: ${r}`);return parseInt(r,16)}function W(r){const e=O(r);return T[e]??null}function D(r){return k[r]??r.toLowerCase()}const N=l({top:c().min(0),right:c().min(0),bottom:c().min(0),left:c().min(0)}),P=l({safeAreaInsets:N,platform:w(["web","dweb","ios","android"]).optional(),locale:h().optional(),direction:w(["ltr","rtl"]).optional()}),H=l({name:h().min(1),version:h().min(1),build:h().optional()});l({version:c().min(1),env:P,host:H,updatedAt:h(),theme:l({colorMode:w(["light","dark"]).optional()}).optional()}).passthrough();function x(r="*"){if(typeof window>"u")throw new Error("[BioSDK] Cannot initialize: window is not defined");if(window.bio)return window.bio;const e=new E(r);return window.bio=e,e}if(typeof window<"u"){M();const r=()=>{x(),b(),I()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r()}export{C as E,W as g,D as n,O as p,S as t};
