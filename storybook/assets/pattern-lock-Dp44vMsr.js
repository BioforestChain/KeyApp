import{r as s,j as a}from"./iframe-d96jbflr.js";import{c as M}from"./utils-4perknFd.js";import{u as ce}from"./useTranslation-ClTwWhs-.js";function ie({value:u,onChange:d,onComplete:D,minPoints:m=4,disabled:p=!1,error:x=!1,success:W=!1,className:G,size:l=3,"data-testid":H}){const{t:v}=ce("security"),R=s.useRef(null),J=s.useRef(null),y=H??void 0,[b,O]=s.useState(!1),[o,k]=s.useState(()=>u??[]),h=s.useRef(u??[]),[L,A]=s.useState(null),[c,$]=s.useState(!1),[Y,T]=s.useState(1),[Q,I]=s.useState([]),P=s.useRef(x),V=s.useRef(!1),X=l*l;s.useEffect(()=>{u!==void 0&&(k(u),h.current=u)},[u]);const B=s.useCallback(()=>{c&&(V.current=!0,I([]),$(!1),T(1))},[c]),q=s.useCallback(e=>{if(e.length===0||c)return;V.current=!1,I([...e]),$(!0),T(1);const n=Date.now(),t=800,r=()=>{if(V.current)return;const i=Date.now()-n,f=Math.min(i/t,1),oe=1-f;T(oe),f<1?requestAnimationFrame(r):(I([]),$(!1),T(1))};requestAnimationFrame(r)},[c]);s.useEffect(()=>{if(x&&!P.current){const e=h.current.length>0?[...h.current]:[...o];q(e)}P.current=x},[x,o,q]);const N=s.useMemo(()=>{const e=[];for(let n=0;n<X;n++){const t=Math.floor(n/l),r=n%l;e.push({x:(r+.5)/l*100,y:(t+.5)/l*100,index:n})}return e},[l,X]),C=s.useCallback((e,n)=>{if(!R.current)return null;const t=R.current.getBoundingClientRect();return{x:(e-t.left)/t.width*100,y:(n-t.top)/t.height*100}},[]),S=s.useCallback((e,n,t=!1)=>{const r=t?100/l/3:100/l/2;for(const i of N)if(Math.sqrt((e-i.x)**2+(n-i.y)**2)<r)return i.index;return null},[N,l]),w=s.useCallback((e,n)=>{if(p)return;c&&B();const t=C(e,n);if(!t)return;const r=S(t.x,t.y);r!==null&&(O(!0),k([r]),h.current=[r],A(t),d?.([r]))},[p,c,B,C,S,d]),E=s.useCallback((e,n)=>{if(!b||p)return;const t=C(e,n);if(!t)return;A(t);const r=S(t.x,t.y,!0);if(r!==null&&!o.includes(r)){const i=[...o,r];k(i),h.current=i,d?.(i)}},[b,p,C,S,o,d]),g=s.useCallback(()=>{if(b){O(!1),A(null);const e=h.current;e.length>0&&e.length<m?(q(e),k([]),h.current=[],d?.([])):e.length>=m&&D?.(e)}},[b,m,q,d,D]),Z=s.useCallback(e=>{e.preventDefault(),w(e.clientX,e.clientY)},[w]),z=s.useCallback(e=>{E(e.clientX,e.clientY)},[E]),ee=s.useCallback(()=>{g()},[g]),te=s.useCallback(()=>{g()},[g]),F=s.useRef(w),K=s.useRef(E),U=s.useRef(g);s.useEffect(()=>{F.current=w,K.current=E,U.current=g},[w,E,g]),s.useEffect(()=>{const e=R.current;if(!e)return;const n=i=>{i.preventDefault();const f=i.touches[0];f&&F.current(f.clientX,f.clientY)},t=i=>{i.preventDefault();const f=i.touches[0];f&&K.current(f.clientX,f.clientY)},r=()=>{U.current()};return e.addEventListener("touchstart",n,{passive:!1}),e.addEventListener("touchmove",t,{passive:!1}),e.addEventListener("touchend",r),()=>{e.removeEventListener("touchstart",n),e.removeEventListener("touchmove",t),e.removeEventListener("touchend",r)}},[]);const ne=s.useCallback((e,n)=>{if(!p&&(e.key===" "||e.key==="Enter")){e.preventDefault();const t=o.includes(n);let r;if(t)if(o[o.length-1]===n)r=o.slice(0,-1);else return;else r=[...o,n];k(r),h.current=r,d?.(r)}},[p,o,d]),se=s.useCallback(()=>{k([]),h.current=[],d?.([])},[d]),re=s.useCallback(e=>x||c?e?"fill-destructive":"fill-primary/30":e?"fill-primary":"fill-primary/30",[x,c]),ae=x||c?"stroke-destructive":"stroke-primary",j=c?Q:o,_=s.useMemo(()=>{if(j.length<2&&!L)return"";let n=j.map(t=>N[t]).filter(t=>t!==void 0).map((t,r)=>`${r===0?"M":"L"} ${t.x} ${t.y}`).join(" ");return b&&L&&j.length>0&&!c&&(n+=` L ${L.x} ${L.y}`),n},[j,N,b,L,c]);return a.jsxs("div",{className:M("space-y-4",G),"data-testid":y,children:[a.jsxs("div",{ref:R,className:M("relative aspect-square w-full max-w-[280px] mx-auto select-none touch-none","rounded-2xl bg-muted/30 p-4",p&&"opacity-50 cursor-not-allowed"),"data-testid":y?`${y}-grid`:void 0,onMouseDown:Z,onMouseMove:z,onMouseUp:ee,onMouseLeave:te,role:"group","aria-label":v("patternLock.gridLabel",{size:l}),children:[a.jsxs("svg",{ref:J,className:"absolute inset-4 pointer-events-none",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid meet",children:[_&&a.jsx("path",{d:_,fill:"none",className:M(ae,"transition-colors"),strokeWidth:"3",strokeLinecap:"round",style:c?{opacity:Y}:void 0,strokeLinejoin:"round"}),N.map(e=>{const n=j.includes(e.index),t=j.indexOf(e.index),r=c&&n?Y:1;return a.jsxs("g",{style:r<1?{opacity:r}:void 0,children:[n&&a.jsx("circle",{cx:e.x,cy:e.y,r:"8",className:M("transition-all duration-150",x?"fill-destructive/20":"fill-primary/20")}),a.jsx("circle",{cx:e.x,cy:e.y,r:n?5:4,className:M(re(n),"transition-all duration-150")}),n&&a.jsx("text",{x:e.x,y:e.y,textAnchor:"middle",dominantBaseline:"central",className:"fill-primary-foreground text-[6px] font-bold pointer-events-none","aria-hidden":"true",children:t+1})]},e.index)})]}),a.jsx("div",{className:"absolute inset-4 grid gap-0",style:{gridTemplateColumns:`repeat(${l}, 1fr)`},"aria-hidden":"false",children:N.map(e=>{const n=o.includes(e.index),t=o.indexOf(e.index);return a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("input",{type:"checkbox","data-testid":y?`${y}-node-${e.index}`:void 0,checked:n,disabled:p,onChange:()=>{},onKeyDown:r=>ne(r,e.index),className:"sr-only peer","aria-label":v("patternLock.nodeLabel",{row:Math.floor(e.index/l)+1,col:e.index%l+1,order:n?t+1:void 0})}),a.jsx("div",{className:"absolute size-12 rounded-full peer-focus-visible:ring-2 peer-focus-visible:ring-ring peer-focus-visible:ring-offset-2"})]},e.index)})})]}),a.jsx("div",{className:"text-center h-5",children:x||c?a.jsx("p",{className:"text-destructive text-sm",children:v("patternLock.error")}):o.length===0?a.jsx("p",{className:"text-muted-foreground text-sm",children:v("patternLock.hint",{min:m})}):o.length<m?a.jsx("p",{className:"text-muted-foreground text-sm",children:v("patternLock.needMore",{current:o.length,min:m})}):W?a.jsx("p",{className:"text-primary text-sm font-medium",children:v("patternLock.success")}):a.jsx("p",{className:"text-primary text-sm",children:v("patternLock.valid",{count:o.length})})}),a.jsx("div",{className:"h-5",children:o.length>0&&!p&&!c&&a.jsx("button",{type:"button",onClick:se,"data-testid":y?`${y}-clear`:void 0,className:"mx-auto block text-sm text-muted-foreground hover:text-foreground transition-colors",children:v("patternLock.clear")})})]})}function fe(u){return u.join("-")}function me(u,d=4){return u.length<d||new Set(u).size!==u.length?!1:u.every(m=>m>=0&&m<=8)}ie.__docgenInfo={description:`九宫格图案锁组件

可访问性设计：
- 每个节点本质上是一个 checkbox
- 支持键盘导航 (Tab + Space/Enter)
- 支持屏幕阅读器
- 触摸和鼠标手势用于快速选择`,methods:[],displayName:"PatternLock",props:{value:{required:!1,tsType:{name:"Array",elements:[{name:"number"}],raw:"number[]"},description:"当前选中的图案 (节点索引数组, 0-8)"},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(pattern: number[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"number"}],raw:"number[]"},name:"pattern"}],return:{name:"void"}}},description:"图案变化回调"},onComplete:{required:!1,tsType:{name:"signature",type:"function",raw:"(pattern: number[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"number"}],raw:"number[]"},name:"pattern"}],return:{name:"void"}}},description:"图案完成回调 (松开手指时触发)"},minPoints:{required:!1,tsType:{name:"number"},description:"最少需要连接的点数",defaultValue:{value:"4",computed:!1}},disabled:{required:!1,tsType:{name:"boolean"},description:"是否禁用",defaultValue:{value:"false",computed:!1}},error:{required:!1,tsType:{name:"boolean"},description:"错误状态",defaultValue:{value:"false",computed:!1}},success:{required:!1,tsType:{name:"boolean"},description:"成功状态",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"额外的 className"},size:{required:!1,tsType:{name:"number"},description:"网格大小 (默认 3x3)",defaultValue:{value:"3",computed:!1}},"data-testid":{required:!1,tsType:{name:"string"},description:"测试 ID"}}};export{ie as P,me as i,fe as p};
