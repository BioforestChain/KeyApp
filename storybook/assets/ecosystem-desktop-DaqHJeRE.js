import{r,j as e,u as _,w as ve}from"./iframe-Kk7PKd4n.js";import{b as ae,S as be,a as Y}from"./swiper-B_oYc_C_.js";import{u as we,C as Ne}from"./swiper-sync-context-BzdxBHaR.js";import{a as z,f as je,b as ke,c as _e,d as Ie,e as Se,g as Ae,M as Me}from"./my-apps-page-2pHWoME2.js";import{c as k}from"./utils-4perknFd.js";import{B as Te}from"./button-B4YvZqLZ.js";import{u as F}from"./useTranslation-BAv9mhc7.js";import{I as Ce}from"./IconSearch-CxQHVihT.js";import{I as Re}from"./IconChevronRight-Bp120il-.js";import{I as pe}from"./IconApps-BBYmf364.js";import{I as Pe}from"./IconSparkles-DRVaP6lL.js";import{M as qe}from"./miniapp-splash-screen-BHVRhSzt.js";import{b as W,d as T,q as Ee,t as De,g as Le,v as We,w as ze,x as He,y as Oe,z as $e,A as Be,B as Fe,C as Ve,E as Ge,e as Q,F as Ue,G as Xe,H as Ke,I as Ye,J as G}from"./index-B2iuY2e9.js";import{r as Je}from"./index-C5VmK4Co.js";import{i as Qe}from"./config-HmZ3kn8E.js";import{e as se,w as ne}from"./window-stack-BPi_p-h9.js";import{I as Ze}from"./IconDots-CWhHuyfe.js";import{c as ee}from"./createReactComponent-CDyGl8aX.js";import{A as et}from"./index-BjZOihpA.js";import{m as P}from"./proxy-AnWsGfoZ.js";import"./item-DV5xUtOH.js";import{a as ie}from"./chain-icon-BrLPdU3y.js";const tt=[["path",{d:"M21 12a9 9 0 1 1 -18 0a9 9 0 0 1 18 0z",key:"svg-0"}],["path",{d:"M8 11.503a2.5 2.5 0 1 0 4 2v-3a2.5 2.5 0 1 1 4 2",key:"svg-1"}]],at=ee("outline","brand-miniprogram","BrandMiniprogram",tt);const st=[["path",{d:"M12 4l-8 4l8 4l8 -4l-8 -4",key:"svg-0"}],["path",{d:"M4 12l8 4l8 -4",key:"svg-1"}],["path",{d:"M4 16l8 4l8 -4",key:"svg-2"}]],nt=ee("outline","stack-2","Stack2",st);const it=[["path",{d:"M12 7a5 5 0 1 1 -4.995 5.217l-.005 -.217l.005 -.217a5 5 0 0 1 4.995 -4.783z",key:"svg-0"}]],rt=ee("filled","point-filled","PointFilled",it);function ot({swiper:t,extendParams:a,on:i}){a({parallax:{enabled:!1}});const n="[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y], [data-swiper-parallax-opacity], [data-swiper-parallax-scale]",p=(s,d)=>{const{rtl:l}=t,g=l?-1:1,c=s.getAttribute("data-swiper-parallax")||"0";let u=s.getAttribute("data-swiper-parallax-x"),x=s.getAttribute("data-swiper-parallax-y");const y=s.getAttribute("data-swiper-parallax-scale"),h=s.getAttribute("data-swiper-parallax-opacity"),b=s.getAttribute("data-swiper-parallax-rotate");if(u||x?(u=u||"0",x=x||"0"):t.isHorizontal()?(u=c,x="0"):(x=c,u="0"),u.indexOf("%")>=0?u=`${parseInt(u,10)*d*g}%`:u=`${u*d*g}px`,x.indexOf("%")>=0?x=`${parseInt(x,10)*d}%`:x=`${x*d}px`,typeof h<"u"&&h!==null){const w=h-(h-1)*(1-Math.abs(d));s.style.opacity=w}let I=`translate3d(${u}, ${x}, 0px)`;if(typeof y<"u"&&y!==null){const w=y-(y-1)*(1-Math.abs(d));I+=` scale(${w})`}if(b&&typeof b<"u"&&b!==null){const w=b*d*-1;I+=` rotate(${w}deg)`}s.style.transform=I},o=()=>{const{el:s,slides:d,progress:l,snapGrid:g,isElement:c}=t,u=ae(s,n);t.isElement&&u.push(...ae(t.hostEl,n)),u.forEach(x=>{p(x,l)}),d.forEach((x,y)=>{let h=x.progress;t.params.slidesPerGroup>1&&t.params.slidesPerView!=="auto"&&(h+=Math.ceil(y/2)-l*(g.length-1)),h=Math.min(Math.max(h,-1),1),x.querySelectorAll(`${n}, [data-swiper-parallax-rotate]`).forEach(b=>{p(b,h)})})},f=(s=t.params.speed)=>{const{el:d,hostEl:l}=t,g=[...d.querySelectorAll(n)];t.isElement&&g.push(...l.querySelectorAll(n)),g.forEach(c=>{let u=parseInt(c.getAttribute("data-swiper-parallax-duration"),10)||s;s===0&&(u=0),c.style.transitionDuration=`${u}ms`})};i("beforeInit",()=>{t.params.parallax.enabled&&(t.params.watchSlidesProgress=!0,t.originalParams.watchSlidesProgress=!0)}),i("init",()=>{t.params.parallax.enabled&&o()}),i("setTranslate",()=>{t.params.parallax.enabled&&o()}),i("setTransition",(s,d)=>{t.params.parallax.enabled&&f(d)})}const lt="_discoverPage_1xkto_2",ct="_discoverHeader_1xkto_7",re={discoverPage:lt,discoverHeader:ct};function dt(t){const a=new Date;return t("common:date.format",{month:a.getMonth()+1,day:a.getDate(),weekday:t(`common:weekdays.${a.getDay()}`)})}const oe=["from-violet-500 to-purple-600","from-orange-500 to-red-500","from-emerald-500 to-teal-500","from-pink-500 to-rose-500","from-blue-500 to-cyan-500"];function pt(t,a=0){return t.themeColor||oe[a%oe.length]}function le({app:t,onTap:a}){const{t:i}=F("ecosystem"),n=t.themeColor||"from-violet-600 via-purple-600 to-indigo-700";return e.jsxs("button",{onClick:a,className:k("group relative w-full overflow-hidden rounded-3xl text-left","shadow-xl shadow-black/10 dark:shadow-black/30","transition-all duration-300 ease-out active:scale-[0.98]","hover:shadow-2xl hover:shadow-black/20"),children:[e.jsx("div",{className:k("absolute inset-0 bg-gradient-to-br",n)}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_30%_-20%,rgba(255,255,255,0.3),transparent_50%)]"}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_70%_120%,rgba(0,0,0,0.2),transparent_50%)]"}),e.jsxs("div",{className:"@container relative flex min-h-[300px] flex-col p-6",children:[e.jsxs("div",{className:"mb-auto flex items-center gap-2 text-xs font-semibold tracking-wider text-white/80 uppercase",children:[e.jsx(Pe,{className:"size-4"}),i("discover.featured")]}),e.jsx("div",{className:"mt-auto",children:e.jsxs("div",{className:"flex items-end gap-4 @sm:gap-5",children:[e.jsx(z,{src:t.icon,name:t.name,size:"xl",glass:!0,className:"@sm:!size-24 @sm:!rounded-[24px]"}),e.jsxs("div",{className:"min-w-0 flex-1 pb-1",children:[e.jsx("h2",{className:"mb-1.5 text-2xl leading-tight font-bold text-white @sm:text-3xl",children:t.name}),e.jsx("p",{className:"line-clamp-2 text-sm leading-relaxed text-white/75 @sm:text-base",children:t.longDescription?.split(`
`)[0]||t.description})]})]})})]})]})}function ut({app:t,onTap:a,fallbackColorIndex:i=0}){const n=pt(t,i);return e.jsxs("button",{onClick:a,className:k("relative w-44 shrink-0 overflow-hidden rounded-2xl text-left","shadow-lg transition-all duration-200 active:scale-[0.96]","snap-start scroll-ml-5"),children:[e.jsx("div",{className:k("absolute inset-0 bg-gradient-to-br",n)}),e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_80%_-10%,rgba(255,255,255,0.25),transparent_40%)]"}),e.jsxs("div",{className:"relative flex h-[160px] flex-col p-4",children:[e.jsx(z,{src:t.icon,name:t.name,size:"lg",customSize:56,glass:!0,className:"mb-auto"}),e.jsxs("div",{children:[e.jsx("h3",{className:"truncate text-base font-bold text-white",children:t.name}),e.jsx("p",{className:"mt-0.5 truncate text-xs text-white/70",children:t.description})]})]})]})}function mt({app:t,onTap:a,onOpen:i,rank:n,showRank:p=!1}){const{t:o}=F("ecosystem");return e.jsxs("div",{className:"flex items-center gap-3 py-3",children:[p&&n!==void 0&&e.jsx("span",{className:"text-muted-foreground/50 w-6 text-center text-lg font-bold",children:n}),e.jsx("button",{onClick:a,className:"shrink-0",children:e.jsx(z,{src:t.icon,name:t.name,size:"lg",customSize:64,shadow:"sm"})}),e.jsxs("button",{onClick:a,className:"min-w-0 flex-1 text-left",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("h3",{className:"truncate font-semibold",children:t.name}),t.beta&&e.jsx("span",{className:"rounded bg-amber-100 px-1.5 py-0.5 text-[10px] font-semibold text-amber-600 dark:bg-amber-900/40 dark:text-amber-400",children:o("common:beta")})]}),e.jsx("p",{className:"text-muted-foreground mt-0.5 truncate text-xs",children:t.description})]}),e.jsx(Te,{size:"sm",variant:"secondary",className:"h-8 shrink-0 rounded-full px-5 text-xs font-bold",onClick:f=>{f.stopPropagation(),i()},children:o("discover.get")})]})}function ft({message:t}){return e.jsxs("div",{className:"flex flex-col items-center justify-center px-5 py-20 text-center",children:[e.jsx("div",{className:"bg-muted mb-4 flex size-20 items-center justify-center rounded-full",children:e.jsx(pe,{className:"text-muted-foreground size-10",stroke:1.5})}),e.jsx("h2",{className:"mb-1 text-lg font-semibold",children:t})]})}const ue=r.forwardRef(function({apps:a,featuredApp:i,featuredApps:n,recommendedApps:p,hotApps:o,onAppDetail:f,onAppOpen:s},d){const{t:l}=F(["ecosystem","common"]),g=r.useRef(null);return r.useImperativeHandle(d,()=>({focusSearch:()=>{g.current?.focus()}})),e.jsxs("div",{className:k(re.discoverPage,"scrollbar-none h-full overflow-y-auto"),children:[e.jsxs("header",{className:k(re.discoverHeader,"sticky top-0 z-10 px-5 pt-12 pb-4"),children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("p",{className:"text-foreground text-sm font-medium",children:dt(l)})}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"text-muted-foreground absolute top-1/2 left-4 size-5 -translate-y-1/2",stroke:1.5}),e.jsx("input",{ref:g,type:"text",placeholder:l("discover.searchPlaceholder"),className:k("bg-muted/60 w-full rounded-xl py-3 pr-4 pl-12","placeholder:text-muted-foreground/60 text-base","focus:ring-primary/30 focus:ring-2 focus:outline-none","transition-all duration-200")})]})]}),e.jsxs("div",{className:"space-y-8",children:[a.length===0?e.jsx(ft,{message:l("discover.empty")}):e.jsxs(e.Fragment,{children:[i&&e.jsx("section",{className:"px-5",children:e.jsx(le,{app:i,onTap:()=>f(i)})}),p.length>0&&e.jsxs("section",{children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between px-5",children:[e.jsx("h2",{className:"text-xl font-bold",children:l("discover.recommended")}),e.jsxs("button",{className:"text-primary flex items-center text-sm font-medium",children:[l("discover.viewAll"),e.jsx(Re,{className:"size-4"})]})]}),e.jsx("div",{className:k("flex gap-3 overflow-x-auto px-5 pb-3","snap-x snap-mandatory scroll-smooth","[-ms-overflow-style:none] [scrollbar-width:none] [&::-webkit-scrollbar]:hidden"),children:p.map((c,u)=>e.jsx(ut,{app:c,onTap:()=>f(c),fallbackColorIndex:u},c.id))})]}),e.jsxs("section",{className:"px-5",children:[e.jsx("h2",{className:"mb-3 text-xl font-bold",children:l("discover.hotApps")}),e.jsx("div",{className:"bg-card divide-y rounded-2xl border",children:o.map((c,u)=>e.jsx("div",{className:"px-4",children:e.jsx(mt,{app:c,rank:u+1,showRank:!0,onTap:()=>f(c),onOpen:()=>s(c)})},c.id))})]}),n.length>1&&e.jsx("section",{className:"px-5",children:e.jsx(le,{app:n[1],onTap:()=>f(n[1])})})]}),e.jsx("div",{className:"h-[var(--tab-bar-height)]"})]})]})});ue.__docgenInfo={description:"",methods:[{name:"focusSearch",docblock:null,modifiers:[],params:[],returns:null}],displayName:"DiscoverPage",props:{apps:{required:!0,tsType:{name:"Array",elements:[{name:"MiniappManifest"}],raw:"MiniappManifest[]"},description:""},featuredApp:{required:!1,tsType:{name:"MiniappManifest"},description:""},featuredApps:{required:!0,tsType:{name:"Array",elements:[{name:"MiniappManifest"}],raw:"MiniappManifest[]"},description:""},recommendedApps:{required:!0,tsType:{name:"Array",elements:[{name:"MiniappManifest"}],raw:"MiniappManifest[]"},description:""},hotApps:{required:!0,tsType:{name:"Array",elements:[{name:"MiniappManifest"}],raw:"MiniappManifest[]"},description:""},onAppDetail:{required:!0,tsType:{name:"signature",type:"function",raw:"(app: MiniappManifest) => void",signature:{arguments:[{type:{name:"MiniappManifest"},name:"app"}],return:{name:"void"}}},description:""},onAppOpen:{required:!0,tsType:{name:"signature",type:"function",raw:"(app: MiniappManifest) => void",signature:{arguments:[{type:{name:"MiniappManifest"},name:"app"}],return:{name:"void"}}},description:""}}};const ht=["color-dodge","hard-light"],gt=["rainbow","vivid"],xt=1e4;function yt(t){return t==="dark"?!0:t==="light"||typeof window>"u"?!1:window.matchMedia("(prefers-color-scheme: dark)").matches}function ce(t){return t[Math.floor(Math.random()*t.length)]}function vt(){const t=new Date,a=new Date(t);return a.setHours(t.getHours()+1,0,0,0),a.getTime()-t.getTime()}function me({className:t,children:a,variant:i}){const n=_(ve,l=>l.theme),p=yt(n),[o,f]=r.useState(!1),s=r.useMemo(()=>({dark:ce(ht),light:ce(gt)}),[]),d=i??(p?s.dark:s.light);return r.useEffect(()=>{let l,g;const c=()=>{f(!0),l=setTimeout(()=>f(!1),xt)},u=()=>{const x=vt();g=setTimeout(()=>{c(),u()},x)};return u(),()=>{clearTimeout(l),clearTimeout(g)}},[]),e.jsxs("div",{className:k("ios-wallpaper relative h-full w-full",`ios-wallpaper--${d}`,o&&"ios-wallpaper--animating",t),children:[d==="hard-light"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ios-wallpaper__stars"}),e.jsx("div",{className:"ios-wallpaper__glow"}),e.jsx("div",{className:"ios-wallpaper__highlight"})]}),a]})}me.__docgenInfo={description:"",methods:[],displayName:"IOSWallpaper",props:{className:{required:!1,tsType:{name:"string"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},variant:{required:!1,tsType:{name:"union",raw:"'color-dodge' | 'hard-light' | 'rainbow' | 'vivid'",elements:[{name:"literal",value:"'color-dodge'"},{name:"literal",value:"'hard-light'"},{name:"literal",value:"'rainbow'"},{name:"literal",value:"'vivid'"}]},description:""}}};function fe({className:t}){const{t:a}=F("ecosystem"),i=_(T,W.hasRunningApps),n=r.useCallback(p=>{if(p){Ee(p);return}De()},[]);return e.jsx("div",{ref:n,className:k("relative h-full w-full","bg-transparent",t),"data-testid":"app-stack-page","data-has-apps":i,children:!i&&e.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center opacity-0",children:e.jsx("p",{className:"text-muted-foreground text-sm",children:a("stack.title")})})})}fe.__docgenInfo={description:"",methods:[],displayName:"AppStackPage",props:{className:{required:!1,tsType:{name:"string"},description:""}}};const bt="_widgetContainer_1vhap_7",wt="_capsule_1vhap_32",Nt="_themeDark_1vhap_46",jt="_themeLight_1vhap_54",kt="_themeAuto_1vhap_62",_t="_button_1vhap_78",It="_icon_1vhap_99",St="_divider_1vhap_104",At="_closeIcon_1vhap_116",Mt="_closeIconInner_1vhap_129",M={widgetContainer:bt,capsule:wt,themeDark:Nt,themeLight:jt,themeAuto:kt,button:_t,icon:It,divider:St,closeIcon:At,closeIconInner:Mt},he=r.forwardRef(function({theme:a="auto",actionIcon:i,onAction:n,onClose:p,visible:o=!0,className:f},s){const{t:d}=F("ecosystem");if(!o)return null;const l=a==="dark"?M.themeDark:a==="light"?M.themeLight:M.themeAuto;return e.jsx("div",{className:M.widgetContainer,children:e.jsxs("div",{ref:s,className:k(M.capsule,l,f),"data-testid":"miniapp-capsule",children:[e.jsx("button",{type:"button",onClick:n,className:M.button,"aria-label":d("capsule.more"),children:i??e.jsx(Ze,{className:M.icon,stroke:1.5})}),e.jsx("div",{className:M.divider}),e.jsx("button",{type:"button",onClick:p,className:M.button,"aria-label":d("capsule.close"),children:e.jsx("div",{className:M.closeIcon,children:e.jsx(rt,{className:M.closeIconInner})})})]})})});he.__docgenInfo={description:"",methods:[],displayName:"MiniappCapsule",props:{theme:{required:!1,tsType:{name:"CapsuleTheme"},description:"胶囊主题",defaultValue:{value:"'auto'",computed:!1}},actionIcon:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:"多功能按钮的自定义图标"},onAction:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"多功能按钮点击回调"},onClose:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"关闭按钮点击回调"},visible:{required:!1,tsType:{name:"boolean"},description:"是否显示",defaultValue:{value:"true",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"自定义类名"}}};const Tt="_window_p5x05_5",Ct="_windowInner_p5x05_11",Rt="_contentLayer_p5x05_29",Pt="_blending_p5x05_36",qt="_splashBgLayer_p5x05_43",Et="_iframeLayer_p5x05_51",Dt="_animating_p5x05_63",Lt="_capsuleLayer_p5x05_72",C={window:Tt,windowInner:Ct,contentLayer:Rt,blending:Pt,splashBgLayer:qt,iframeLayer:Et,animating:Dt,capsuleLayer:Lt},Wt={open:{opacity:1},closed:{opacity:0}},zt={show:{opacity:1},hide:{opacity:0}},J={top:{zIndex:10,opacity:1,pointerEvents:"auto"},bottom:{zIndex:0,opacity:0,pointerEvents:"none"}};function Ht(t,a,i){return{visible:!i&&t!=="background"&&t!=="preparing",interactive:t==="active"&&a&&!i}}function Ot({className:t}){const a=_(T,W.getPresentations),i=_(T,W.getFocusedAppId),n=_(T,W.getVisualConfig),p=Le(n);return a.length===0?null:e.jsx(e.Fragment,{children:a.filter(o=>o.state!=="hidden").map(o=>e.jsx($t,{appId:o.appId,presentation:o,motionPresets:p,className:t,isFocused:o.appId===i},o.appId))})}function $t({appId:t,presentation:a,motionPresets:i,className:n,isFocused:p}){const o=r.useRef(null),f=r.useRef(null),[s,d]=r.useState(null),l=r.useRef(!1),g=r.useRef(null),c=_(T,S=>S.apps.get(t)??null),u=_(T,S=>{const A=S.apps.get(t);return A?.state==="launching"||A?.state==="splash"||A?.state==="closing"}),x=We(a.desktop,t),y=ze(a.desktop,t),h=y,b=x==="lost"||!y;r.useLayoutEffect(()=>{if(!c){d(null),l.current=!1;return}if(c.state==="preparing"){d(null),l.current=!1;return}if(a.state==="dismissing"||c.state==="closing"){if(l.current)return;d(c),g.current=a.transitionId,l.current=!0,requestAnimationFrame(()=>d(null));return}l.current=!1,d(c)},[c?.appId,c?.state,a.state,a.transitionId]),r.useEffect(()=>{s&&a.state==="presenting"&&a.transitionKind==="present"&&a.transitionId&&He(t,a.transitionId)},[t,s,a.state,a.transitionKind,a.transitionId]);const I=r.useRef("closed");s?.flow&&(I.current=s.flow);const w=s?s.flow:I.current,H=r.useCallback(()=>{s?.appId&&Oe(s.appId)},[s?.appId]),N=je[w],O=ke[w],$=Ie[w],q=_e[w],V=Ae[w],U=Se[w],X=w==="opening"||w==="closing",B=Ht(s?.state,p,b),j=r.useMemo(()=>({appId:s?.appId??"",name:s?.manifest.name??"",icon:s?.manifest.icon??"",themeColor:s?.manifest.themeColorFrom??280}),[s?.appId,s?.manifest.name,s?.manifest.icon,s?.manifest.themeColorFrom]);r.useEffect(()=>{y&&(o.current&&$e(o.current),f.current&&Be(f.current))},[y]),r.useEffect(()=>{const S=s?.containerHandle,A=f.current;if(!S||!A)return;const R=S.element;R.parentElement!==A&&A.appendChild(R),S.setMountTarget?.(A),R.style.display==="none"&&(R.style.display="")},[s?.containerHandle,s?.appId,s?.state,y]);const K=r.useCallback(()=>{Fe(t)},[t]),m=r.useCallback(()=>{Ve(t)},[t]),v=!b&&Qe("sharedLayout");if(!h)return null;const E=e.jsx(et,{initial:!1,onExitComplete:()=>{const S=g.current;S&&Ge(t,S),g.current=null,I.current="closed"},children:s&&e.jsx("div",{ref:o,className:k(C.window,u&&C.animating,n),style:{zIndex:a.zOrder,display:B.visible?void 0:"none",pointerEvents:B.interactive?"auto":"none"},inert:!B.interactive||void 0,"data-testid":"miniapp-window","data-app-id":s.appId,"data-slot-lost":b?"true":void 0,children:e.jsxs(P.div,{className:C.windowInner,variants:Wt,initial:!1,animate:N,onLayoutAnimationComplete:H,...v&&j.appId?{layoutId:`miniapp:${j.appId}:container`,"data-layoutid":`miniapp:${j.appId}:container`}:{},transition:i.sharedLayout,"data-flow":w,children:[e.jsxs(P.div,{className:k(C.contentLayer,X&&C.blending),...v&&j.appId?{layoutId:`miniapp:${j.appId}:inner`,"data-layoutid":`miniapp:${j.appId}:inner`}:{},transition:i.sharedLayout,children:[e.jsx(P.div,{className:C.splashBgLayer,variants:J,initial:!1,animate:O,"data-animate":O,children:e.jsx(qe,{appId:j.appId,app:{name:j.name,icon:j.icon,themeColor:j.themeColor},visible:!0,showIcon:!1,showSpinner:!1,onClose:m})}),e.jsx(P.div,{ref:f,className:C.iframeLayer,variants:J,initial:!1,animate:q,"data-animate":q})]}),e.jsx(P.div,{className:"absolute inset-0 flex items-center justify-center",variants:J,initial:!1,animate:$,"aria-hidden":$!=="top",children:e.jsx(P.div,{className:"size-30 items-center justify-center",...v&&V&&j.appId?{layoutId:`miniapp:${j.appId}:logo`,"data-layoutid":`miniapp:${j.appId}:logo`}:{},transition:i.sharedLayout,children:e.jsx(z,{src:j.icon,name:j.name,size:"2xl"})})}),e.jsx("div",{className:C.capsuleLayer,children:e.jsx(P.div,{variants:zt,initial:!1,animate:U,children:e.jsx(he,{visible:!0,theme:s?.ctx.capsuleTheme??"auto",onAction:()=>{},onClose:K})})})]})})});return Je.createPortal(E,h)}Ot.__docgenInfo={description:"",methods:[],displayName:"MiniappWindow",props:{className:{required:!1,tsType:{name:"string"},description:""}}};const Bt="_indicator_1e4mv_5",Ft="_iconWrapper_1e4mv_24",Vt="_icon_1e4mv_24",Gt="_dots_1e4mv_54",Ut="_dot_1e4mv_54",Xt="_dotActive_1e4mv_73",L={indicator:Bt,iconWrapper:Ft,icon:Vt,dots:Gt,dot:Ut,dotActive:Xt},de=["discover","mine","stack"],Kt={discover:pe,mine:at,stack:nt},Yt={discover:"发现",mine:"我的",stack:"堆栈"};function Jt({activePage:t,onPageChange:a,hasRunningApps:i,className:n}){const p=_(Q,h=>h.activeSubPage),o=_(Q,h=>h.availableSubPages),f=_(T,W.hasRunningApps),s=t??p,d=i??f,l=r.useMemo(()=>o?.length?o:d?de:de.filter(h=>h!=="stack"),[o,d]),g=l.indexOf(s),c=r.useCallback(()=>{const h=(g+1)%l.length;return l[h]},[g,l]),u=r.useCallback(()=>{const h=c();h&&a?.(h)},[c,a]),x=Kt[s],y=Yt[s];return e.jsxs("button",{type:"button",onClick:u,className:k(L.indicator,n),"aria-label":`当前：${y}，点击切换`,"data-testid":"ecosystem-tab-indicator",children:[e.jsx("div",{className:L.iconWrapper,children:e.jsx(x,{className:L.icon,stroke:1.5})}),e.jsx("div",{className:L.dots,children:l.map((h,b)=>e.jsx("span",{className:k(L.dot,b===g&&L.dotActive)},h))})]})}Jt.__docgenInfo={description:"",methods:[],displayName:"EcosystemTabIndicator",props:{activePage:{required:!1,tsType:{name:"EcosystemSubPage"},description:"当前页面（可选，默认从 store 读取）"},onPageChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(page: EcosystemSubPage) => void",signature:{arguments:[{type:{name:"EcosystemSubPage"},name:"page"}],return:{name:"void"}}},description:"切换页面回调（可选，用于外部控制）"},hasRunningApps:{required:!1,tsType:{name:"boolean"},description:"是否有运行中的应用（可选，默认从 store 读取）"},className:{required:!1,tsType:{name:"string"},description:"自定义类名"}}};function Qt(t){return t.length<=14?t:`${t.slice(0,6)}...${t.slice(-4)}`}function Zt({title:t,description:a,appName:i,appIcon:n,chainId:p,walletInfo:o}){return o?e.jsx("div",{className:"border-border border-b px-4 pb-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx(z,{src:n,name:i||"App",size:"sm",shadow:"sm"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"truncate text-sm font-semibold",children:t}),a&&e.jsx("p",{className:"text-muted-foreground truncate text-xs",children:a})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium",children:o.name}),e.jsx("p",{className:"text-muted-foreground text-xs font-mono",children:Qt(o.address)})]}),e.jsx(ie,{chainId:o.chainId})]})]})}):e.jsx("div",{className:"border-border border-b px-4 pb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{src:n,name:i||"App",size:"md",shadow:"sm"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"truncate text-base font-semibold",children:t}),a&&e.jsx("p",{className:"text-muted-foreground truncate text-sm",children:a})]}),p&&e.jsx(ie,{chainId:p})]})})}Zt.__docgenInfo={description:"",methods:[],displayName:"MiniappSheetHeader",props:{title:{required:!0,tsType:{name:"string"},description:"Sheet 标题"},description:{required:!1,tsType:{name:"string"},description:"描述文本 (可选)"},appName:{required:!1,tsType:{name:"string"},description:"来源小程序名称"},appIcon:{required:!1,tsType:{name:"string"},description:"来源小程序图标 URL"},chainId:{required:!1,tsType:{name:"string"},description:"请求的链 ID (可选，传入时显示 ChainBadge，当有 walletInfo 时会被忽略)"},walletInfo:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  /** 钱包名称 */
  name: string
  /** 钱包地址 */
  address: string
  /** 链 ID */
  chainId: string
}`,signature:{properties:[{key:"name",value:{name:"string",required:!0},description:"钱包名称"},{key:"address",value:{name:"string",required:!0},description:"钱包地址"},{key:"chainId",value:{name:"string",required:!0},description:"链 ID"}]}},description:"钱包信息 (可选，传入时在右侧显示钱包名+地址+链)"}}};function ea({hasRunningApps:t,onSwipeUp:a,onTap:i,swipeThreshold:n=30,velocityThreshold:p=.3,children:o,className:f}){const s=r.useRef(null);r.useEffect(()=>{const g=s.current;if(!g)return;const c=g;c.hasRunningApps=t,c.swipeThreshold=n,c.velocityThreshold=p},[t,n,p]);const d=r.useCallback(()=>{a?.()},[a]),l=r.useCallback(()=>{i?.()},[i]);return r.useEffect(()=>{const g=se.on("home:swipe-up",d),c=se.on("home:tap",l);return()=>{g(),c()}},[d,l]),e.jsx("ecosystem-home-button",{ref:s,className:f,"has-running-apps":t||void 0,"swipe-threshold":n,"velocity-threshold":p,children:o})}ea.__docgenInfo={description:`React wrapper for the native Home Button Web Component

This component wraps the ecosystem-home-button custom element
and provides React-friendly props and callbacks.

@example
\`\`\`tsx
<HomeButtonWrapper
  hasRunningApps={hasRunningApps}
  onSwipeUp={() => openStackView()}
>
  <TabButton icon={EcosystemIcon} />
</HomeButtonWrapper>
\`\`\``,methods:[],displayName:"HomeButtonWrapper",props:{hasRunningApps:{required:!0,tsType:{name:"boolean"},description:"Whether there are running apps (enables swipe gesture)"},onSwipeUp:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"Callback when swipe up is detected"},onTap:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"Callback when button is tapped"},swipeThreshold:{required:!1,tsType:{name:"number"},description:"Swipe threshold in pixels (default: 30)",defaultValue:{value:"30",computed:!1}},velocityThreshold:{required:!1,tsType:{name:"number"},description:"Velocity threshold in px/ms (default: 0.3)",defaultValue:{value:"0.3",computed:!1}},children:{required:!0,tsType:{name:"ReactNode"},description:"Children to render inside the button"},className:{required:!1,tsType:{name:"string"},description:"Additional class name"}}};function ge({desktop:t,className:a,style:i}){return e.jsx("ecosystem-window-stack",{desktop:t,class:a,style:i})}ge.__docgenInfo={description:`React wrapper for the native WindowStack Web Component

This component wraps the ecosystem-window-stack custom element.
The WindowStack auto-registers with windowStackManager in its connectedCallback,
so no useEffect is needed here.

@example
\`\`\`tsx
// In your desktop page component
<WindowStackWrapper desktop="mine" />
\`\`\`

Then in the miniapp runtime:
\`\`\`ts
import { windowStackManager } from '@biochain/ecosystem-native';

// Synchronously get or create a slot
const slot = windowStackManager.getOrCreateSlot('mine', appId);
\`\`\``,methods:[],displayName:"WindowStackWrapper",props:{desktop:{required:!0,tsType:{name:"union",raw:"'mine' | 'stack'",elements:[{name:"literal",value:"'mine'"},{name:"literal",value:"'stack'"}]},description:"Which desktop this stack belongs to ('mine' or 'stack')"},className:{required:!1,tsType:{name:"string"},description:"Additional class name"},style:{required:!1,tsType:{name:"ReactCSSProperties",raw:"React.CSSProperties"},description:"Additional styles"}}};function Z({desktop:t}){const a=r.useRef(null);return r.useEffect(()=>{const i=a.current;if(i)return Ue(t,i),()=>Xe(t)},[t]),r.useEffect(()=>{const i=f=>{f.desktop===t&&Ke(t,f.appId,f.element)},n=(f,s)=>{s===t&&Ye(t,f)},p=ne.onSlotCreated(i),o=ne.onSlotRemoved(n);return()=>{p(),o()}},[t]),e.jsx("div",{ref:a,className:"absolute left-0 right-0 top-0 z-20",style:{bottom:"var(--tab-bar-height)",pointerEvents:"none"},"aria-hidden":!0,"data-testid":"miniapp-window-stack",children:e.jsx(ge,{desktop:t,style:{display:"block",width:"100%",height:"100%"}})})}Z.__docgenInfo={description:`MiniappWindowStack

一个统一的"窗口堆栈层"覆盖网格：
- 由 slide 决定布局（本组件只提供 slot 容器）
- slot 统一叠放在同一 grid cell（1 / 1）

重构说明：
- 使用 Lit Web Component (WindowStackWrapper) 实现同步 slot 创建
- 消除了 React 异步渲染导致的竞态条件
- slot 现在由 windowStackManager.getOrCreateSlot() 同步创建
- desktop 必须通过 prop 传入，确保首次渲染就能注册 WindowStack`,methods:[],displayName:"MiniappWindowStack",props:{desktop:{required:!0,tsType:{name:"MiniappTargetDesktop"},description:"指定该 stack 属于哪个桌面，必须传入"}}};const xe="-38.2%",ta=3,aa=`${100+(ta-1)*Math.abs(parseFloat(xe))}%`,sa=r.forwardRef(function(a,i){const{showDiscoverPage:n=!0,showStackPage:p="auto",initialPage:o,apps:f,myApps:s,featuredApps:d=[],recommendedApps:l=[],hotApps:g=[],onAppOpen:c,onAppDetail:u,onAppRemove:x}=a,y=r.useRef(null),h=r.useRef(null),b=r.useRef("mine"),I=_(T,m=>{if(m.presentations.size===0)return null;const v=Array.from(m.presentations.values()).filter(D=>D.state!=="hidden");if(v.length===0)return null;const E=m.focusedAppId??m.activeAppId,A=(E?m.presentations.get(E):null)?.desktop??(E?m.apps.get(E)?.manifest.targetDesktop??null:null),R=D=>D==="stack"?"stack":"mine";if(A)return R(A);const ye=v.reduce((D,te)=>te.zOrder>D.zOrder?te:D);return R(ye.desktop)}),w=_(T,W.hasRunningStackApps),H=p==="auto"?w:p,N=r.useMemo(()=>{const m=[];return n&&m.push("discover"),m.push("mine"),H&&m.push("stack"),m},[n,H]),O=N.length,$=_(Q,m=>m.activeSubPage),q=r.useMemo(()=>{const m=o??$??(n?"discover":"mine"),v=N.indexOf(m);return v>=0?v:0},[o,$,n,N]),{onSwiper:V,onSlideChange:U}=we("ecosystem-main","ecosystem-indicator",{initialIndex:q,onSlideChange:m=>{const v=N[m.activeIndex]??"mine";b.current=v,G.setActiveSubPage(v)}}),X=r.useCallback(m=>{y.current=m,V(m);const v=N[q]??"mine";b.current=v,G.setAvailableSubPages(N)},[V,N,q]);r.useEffect(()=>{G.setAvailableSubPages(N)},[N]),r.useEffect(()=>{if(!I||b.current===I)return;const m=N.indexOf(I);m<0||y.current?.slideTo(m)},[I,N]);const B=r.useCallback((m,v)=>{G.setSwiperProgress(v*(O-1))},[O]),j=r.useCallback(()=>{if(!n)return;const m=N.indexOf("discover");m>=0&&(y.current?.slideTo(m),setTimeout(()=>h.current?.focusSearch(),300))},[n,N]);r.useImperativeHandle(i,()=>({slideTo:m=>{const v=N.indexOf(m);v>=0&&y.current?.slideTo(v)},focusSearch:()=>{n&&h.current?.focusSearch()},getCurrentPage:()=>b.current,getSwiper:()=>y.current}),[N,n]);const K=d[0];return e.jsx("div",{className:"bg-background relative h-full",children:e.jsxs(be,{className:"h-full w-full",modules:[ot,Ne],parallax:!0,onSwiper:X,onSlideChange:U,onProgress:B,resistanceRatio:.5,children:[e.jsx("div",{className:"absolute inset-y-0 left-0 z-0",style:{width:aa},"data-swiper-parallax":xe,children:e.jsx(me,{className:"h-full w-full"})}),n&&e.jsx(Y,{className:"!h-full !overflow-hidden",children:e.jsx("div",{className:"relative z-10 h-full",children:e.jsx(ue,{ref:h,apps:f,featuredApp:K,featuredApps:d,recommendedApps:l,hotApps:g,onAppDetail:u,onAppOpen:c})})}),e.jsx(Y,{className:"!h-full !overflow-hidden",children:e.jsxs("div",{className:"relative z-10 h-full","data-ecosystem-subpage":"mine",children:[e.jsx(Me,{apps:s,showSearch:n,onSearchClick:j,onAppOpen:c,onAppDetail:u,onAppRemove:x}),e.jsx(Z,{desktop:"mine"})]})}),H&&e.jsx(Y,{className:"!h-full !overflow-hidden",children:e.jsxs("div",{className:"relative z-10 h-full","data-ecosystem-subpage":"stack",children:[e.jsx(fe,{}),e.jsx(Z,{desktop:"stack"})]})})]})})});sa.__docgenInfo={description:"",methods:[{name:"slideTo",docblock:null,modifiers:[],params:[{name:"page",optional:!1,type:{name:"EcosystemSubPage",alias:"EcosystemSubPage"}}],returns:null},{name:"focusSearch",docblock:null,modifiers:[],params:[],returns:null},{name:"getCurrentPage",docblock:null,modifiers:[],params:[],returns:null},{name:"getSwiper",docblock:null,modifiers:[],params:[],returns:null}],displayName:"EcosystemDesktop",props:{showDiscoverPage:{required:!1,tsType:{name:"boolean"},description:"是否显示发现页（默认 true）"},showStackPage:{required:!1,tsType:{name:"union",raw:"boolean | 'auto'",elements:[{name:"boolean"},{name:"literal",value:"'auto'"}]},description:"是否显示应用堆栈页（默认 'auto'，根据是否有运行中的应用自动判断）"},initialPage:{required:!1,tsType:{name:"EcosystemSubPage"},description:"初始页面（默认根据配置自动选择）"},apps:{required:!0,tsType:{name:"Array",elements:[{name:"MiniappManifest"}],raw:"MiniappManifest[]"},description:"所有应用列表"},myApps:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ app: MiniappManifest; lastUsed: number }",signature:{properties:[{key:"app",value:{name:"MiniappManifest",required:!0}},{key:"lastUsed",value:{name:"number",required:!0}}]}}],raw:"Array<{ app: MiniappManifest; lastUsed: number }>"},description:"我的应用（带最后使用时间）"},featuredApps:{required:!1,tsType:{name:"Array",elements:[{name:"MiniappManifest"}],raw:"MiniappManifest[]"},description:"精选应用"},recommendedApps:{required:!1,tsType:{name:"Array",elements:[{name:"MiniappManifest"}],raw:"MiniappManifest[]"},description:"推荐应用"},hotApps:{required:!1,tsType:{name:"Array",elements:[{name:"MiniappManifest"}],raw:"MiniappManifest[]"},description:"热门应用"},onAppOpen:{required:!0,tsType:{name:"signature",type:"function",raw:"(app: MiniappManifest) => void",signature:{arguments:[{type:{name:"MiniappManifest"},name:"app"}],return:{name:"void"}}},description:"打开应用"},onAppDetail:{required:!0,tsType:{name:"signature",type:"function",raw:"(app: MiniappManifest) => void",signature:{arguments:[{type:{name:"MiniappManifest"},name:"app"}],return:{name:"void"}}},description:"查看应用详情"},onAppRemove:{required:!0,tsType:{name:"signature",type:"function",raw:"(appId: string) => void",signature:{arguments:[{type:{name:"string"},name:"appId"}],return:{name:"void"}}},description:"移除应用"}}};export{sa as E,ea as H,at as I,he as M,Jt as a,Ot as b,Zt as c};
