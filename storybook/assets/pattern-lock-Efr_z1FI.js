import{r as s,j as a}from"./iframe-BNKLbH-6.js";import{c as M}from"./utils-4perknFd.js";import{u as ie}from"./useTranslation-CSaUSbgP.js";function le({value:u,onChange:d,onComplete:A,minPoints:p=4,disabled:x=!1,error:m=!1,success:W=!1,errorText:G,className:H,size:l=3,"data-testid":J}){const{t:v}=ie("security"),T=s.useRef(null),Q=s.useRef(null),y=J??void 0,[b,P]=s.useState(!1),[o,k]=s.useState(()=>u??[]),h=s.useRef(u??[]),[L,$]=s.useState(null),[c,I]=s.useState(!1),[X,R]=s.useState(1),[Z,V]=s.useState([]),O=s.useRef(m),Y=s.useRef(!1),B=l*l;s.useEffect(()=>{u!==void 0&&(k(u),h.current=u)},[u]);const q=s.useCallback(()=>{c&&(Y.current=!0,V([]),I(!1),R(1))},[c]),C=s.useCallback(e=>{if(e.length===0||c)return;Y.current=!1,V([...e]),I(!0),R(1);const n=Date.now(),t=800,r=()=>{if(Y.current)return;const i=Date.now()-n,f=Math.min(i/t,1),ce=1-f;R(ce),f<1?requestAnimationFrame(r):(V([]),I(!1),R(1))};requestAnimationFrame(r)},[c]);s.useEffect(()=>{if(m&&!O.current){const e=h.current.length>0?[...h.current]:[...o];C(e)}!m&&O.current&&q(),O.current=m},[q,m,o,C]);const N=s.useMemo(()=>{const e=[];for(let n=0;n<B;n++){const t=Math.floor(n/l),r=n%l;e.push({x:(r+.5)/l*100,y:(t+.5)/l*100,index:n})}return e},[l,B]),S=s.useCallback((e,n)=>{if(!T.current)return null;const t=T.current.getBoundingClientRect();return{x:(e-t.left)/t.width*100,y:(n-t.top)/t.height*100}},[]),D=s.useCallback((e,n,t=!1)=>{const r=t?100/l/3:100/l/2;for(const i of N)if(Math.sqrt((e-i.x)**2+(n-i.y)**2)<r)return i.index;return null},[N,l]),w=s.useCallback((e,n)=>{if(x)return;c&&q();const t=S(e,n);if(!t)return;const r=D(t.x,t.y);r!==null&&(P(!0),k([r]),h.current=[r],$(t),d?.([r]))},[x,c,q,S,D,d]),E=s.useCallback((e,n)=>{if(!b||x)return;const t=S(e,n);if(!t)return;$(t);const r=D(t.x,t.y,!0);if(r!==null&&!o.includes(r)){const i=[...o,r];k(i),h.current=i,d?.(i)}},[b,x,S,D,o,d]),g=s.useCallback(()=>{if(b){P(!1),$(null);const e=h.current;e.length>0&&e.length<p?(C(e),k([]),h.current=[],d?.([])):e.length>=p&&A?.(e)}},[b,p,C,d,A]),z=s.useCallback(e=>{e.preventDefault(),w(e.clientX,e.clientY)},[w]),ee=s.useCallback(e=>{E(e.clientX,e.clientY)},[E]),te=s.useCallback(()=>{g()},[g]),ne=s.useCallback(()=>{g()},[g]),F=s.useRef(w),K=s.useRef(E),U=s.useRef(g);s.useEffect(()=>{F.current=w,K.current=E,U.current=g},[w,E,g]),s.useEffect(()=>{const e=T.current;if(!e)return;const n=i=>{i.preventDefault();const f=i.touches[0];f&&F.current(f.clientX,f.clientY)},t=i=>{i.preventDefault();const f=i.touches[0];f&&K.current(f.clientX,f.clientY)},r=()=>{U.current()};return e.addEventListener("touchstart",n,{passive:!1}),e.addEventListener("touchmove",t,{passive:!1}),e.addEventListener("touchend",r),()=>{e.removeEventListener("touchstart",n),e.removeEventListener("touchmove",t),e.removeEventListener("touchend",r)}},[]);const se=s.useCallback((e,n)=>{if(!x&&(e.key===" "||e.key==="Enter")){e.preventDefault();const t=o.includes(n);let r;if(t)if(o[o.length-1]===n)r=o.slice(0,-1);else return;else r=[...o,n];k(r),h.current=r,d?.(r)}},[x,o,d]),re=s.useCallback(()=>{k([]),h.current=[],d?.([])},[d]),ae=s.useCallback(e=>m||c?e?"fill-destructive":"fill-primary/30":e?"fill-primary":"fill-primary/30",[m,c]),oe=m||c?"stroke-destructive":"stroke-primary",j=c?Z:o,_=s.useMemo(()=>{if(j.length<2&&!L)return"";let n=j.map(t=>N[t]).filter(t=>t!==void 0).map((t,r)=>`${r===0?"M":"L"} ${t.x} ${t.y}`).join(" ");return b&&L&&j.length>0&&!c&&(n+=` L ${L.x} ${L.y}`),n},[j,N,b,L,c]);return a.jsxs("div",{className:M("space-y-4",H),"data-testid":y,children:[a.jsxs("div",{ref:T,className:M("relative aspect-square w-full max-w-[280px] mx-auto select-none touch-none","rounded-2xl bg-muted/30 p-4",x&&"opacity-50 cursor-not-allowed"),"data-testid":y?`${y}-grid`:void 0,onMouseDown:z,onMouseMove:ee,onMouseUp:te,onMouseLeave:ne,role:"group","aria-label":v("patternLock.gridLabel",{size:l}),children:[a.jsxs("svg",{ref:Q,className:"absolute inset-4 pointer-events-none",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid meet",children:[_&&a.jsx("path",{d:_,fill:"none",className:M(oe,"transition-colors"),strokeWidth:"3",strokeLinecap:"round",style:c?{opacity:X}:void 0,strokeLinejoin:"round"}),N.map(e=>{const n=j.includes(e.index),t=j.indexOf(e.index),r=c&&n?X:1;return a.jsxs("g",{style:r<1?{opacity:r}:void 0,children:[n&&a.jsx("circle",{cx:e.x,cy:e.y,r:"8",className:M("transition-all duration-150",m?"fill-destructive/20":"fill-primary/20")}),a.jsx("circle",{cx:e.x,cy:e.y,r:n?5:4,className:M(ae(n),"transition-all duration-150")}),n&&a.jsx("text",{x:e.x,y:e.y,textAnchor:"middle",dominantBaseline:"central",className:"fill-primary-foreground text-[6px] font-bold pointer-events-none","aria-hidden":"true",children:t+1})]},e.index)})]}),a.jsx("div",{className:"absolute inset-4 grid gap-0",style:{gridTemplateColumns:`repeat(${l}, 1fr)`},"aria-hidden":"false",children:N.map(e=>{const n=o.includes(e.index),t=o.indexOf(e.index);return a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx("input",{type:"checkbox","data-testid":y?`${y}-node-${e.index}`:void 0,checked:n,disabled:x,onChange:()=>{},onKeyDown:r=>se(r,e.index),className:"sr-only peer","aria-label":v("patternLock.nodeLabel",{row:Math.floor(e.index/l)+1,col:e.index%l+1,order:n?t+1:void 0})}),a.jsx("div",{className:"absolute size-12 rounded-full peer-focus-visible:ring-2 peer-focus-visible:ring-ring peer-focus-visible:ring-offset-2"})]},e.index)})})]}),a.jsx("div",{className:"text-center h-5",children:m?a.jsx("p",{className:"text-destructive text-sm",children:G??v("patternLock.error")}):o.length===0?a.jsx("p",{className:"text-muted-foreground text-sm",children:v("patternLock.hint",{min:p})}):o.length<p?a.jsx("p",{className:"text-muted-foreground text-sm",children:v("patternLock.needMore",{current:o.length,min:p})}):W?a.jsx("p",{className:"text-primary text-sm font-medium",children:v("patternLock.success")}):a.jsx("p",{className:"text-primary text-sm",children:v("patternLock.valid",{count:o.length})})}),a.jsx("div",{className:"h-5",children:o.length>0&&!x&&!c&&a.jsx("button",{type:"button",onClick:re,"data-testid":y?`${y}-clear`:void 0,className:"mx-auto block text-sm text-muted-foreground hover:text-foreground transition-colors",children:v("patternLock.clear")})})]})}function me(u){return u.join("-")}function pe(u,d=4){return u.length<d||new Set(u).size!==u.length?!1:u.every(p=>p>=0&&p<=8)}le.__docgenInfo={description:`九宫格图案锁组件

可访问性设计：
- 每个节点本质上是一个 checkbox
- 支持键盘导航 (Tab + Space/Enter)
- 支持屏幕阅读器
- 触摸和鼠标手势用于快速选择`,methods:[],displayName:"PatternLock",props:{value:{required:!1,tsType:{name:"Array",elements:[{name:"number"}],raw:"number[]"},description:"当前选中的图案 (节点索引数组, 0-8)"},onChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(pattern: number[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"number"}],raw:"number[]"},name:"pattern"}],return:{name:"void"}}},description:"图案变化回调"},onComplete:{required:!1,tsType:{name:"signature",type:"function",raw:"(pattern: number[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"number"}],raw:"number[]"},name:"pattern"}],return:{name:"void"}}},description:"图案完成回调 (松开手指时触发)"},minPoints:{required:!1,tsType:{name:"number"},description:"最少需要连接的点数",defaultValue:{value:"4",computed:!1}},disabled:{required:!1,tsType:{name:"boolean"},description:"是否禁用",defaultValue:{value:"false",computed:!1}},error:{required:!1,tsType:{name:"boolean"},description:"错误状态",defaultValue:{value:"false",computed:!1}},success:{required:!1,tsType:{name:"boolean"},description:"成功状态",defaultValue:{value:"false",computed:!1}},errorText:{required:!1,tsType:{name:"string"},description:"错误提示文案（可选，覆盖默认错误文案）"},className:{required:!1,tsType:{name:"string"},description:"额外的 className"},size:{required:!1,tsType:{name:"number"},description:"网格大小 (默认 3x3)",defaultValue:{value:"3",computed:!1}},"data-testid":{required:!1,tsType:{name:"string"},description:"测试 ID"}}};export{le as P,pe as i,me as p};
