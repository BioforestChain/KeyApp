import{n as b,e as v}from"./swiper-DK5F_JhY.js";import{r as d,j as C}from"./iframe-CHpnNFF-.js";function N({swiper:t,extendParams:f,on:a}){f({controller:{control:void 0,inverse:!1,by:"slide"}}),t.controller={control:void 0};function m(i,n){const l=(function(){let s,o,p;return(T,g)=>{for(o=-1,s=T.length;s-o>1;)p=s+o>>1,T[p]<=g?o=p:s=p;return s}})();this.x=i,this.y=n,this.lastIndex=i.length-1;let e,r;return this.interpolate=function(s){return s?(r=l(this.x,s),e=r-1,(s-this.x[e])*(this.y[r]-this.y[e])/(this.x[r]-this.x[e])+this.y[e]):0},this}function y(i){t.controller.spline=t.params.loop?new m(t.slidesGrid,i.slidesGrid):new m(t.snapGrid,i.snapGrid)}function S(i,n){const l=t.controller.control;let e,r;const h=t.constructor;function s(o){if(o.destroyed)return;const p=t.rtlTranslate?-t.translate:t.translate;t.params.controller.by==="slide"&&(y(o),r=-t.controller.spline.interpolate(-p)),(!r||t.params.controller.by==="container")&&(e=(o.maxTranslate()-o.minTranslate())/(t.maxTranslate()-t.minTranslate()),(Number.isNaN(e)||!Number.isFinite(e))&&(e=1),r=(p-t.minTranslate())*e+o.minTranslate()),t.params.controller.inverse&&(r=o.maxTranslate()-r),o.updateProgress(r),o.setTranslate(r,t),o.updateActiveIndex(),o.updateSlidesClasses()}if(Array.isArray(l))for(let o=0;o<l.length;o+=1)l[o]!==n&&l[o]instanceof h&&s(l[o]);else l instanceof h&&n!==l&&s(l)}function u(i,n){const l=t.constructor,e=t.controller.control;let r;function h(s){s.destroyed||(s.setTransition(i,t),i!==0&&(s.transitionStart(),s.params.autoHeight&&b(()=>{s.updateAutoHeight()}),v(s.wrapperEl,()=>{e&&s.transitionEnd()})))}if(Array.isArray(e))for(r=0;r<e.length;r+=1)e[r]!==n&&e[r]instanceof l&&h(e[r]);else e instanceof l&&n!==e&&h(e)}function c(){t.controller.control&&t.controller.spline&&(t.controller.spline=void 0,delete t.controller.spline)}a("beforeInit",()=>{if(typeof window<"u"&&(typeof t.params.controller.control=="string"||t.params.controller.control instanceof HTMLElement)){(typeof t.params.controller.control=="string"?[...document.querySelectorAll(t.params.controller.control)]:[t.params.controller.control]).forEach(n=>{if(t.controller.control||(t.controller.control=[]),n&&n.swiper)t.controller.control.push(n.swiper);else if(n){const l=`${t.params.eventsPrefix}init`,e=r=>{t.controller.control.push(r.detail[0]),t.update(),n.removeEventListener(l,e)};n.addEventListener(l,e)}});return}t.controller.control=t.params.controller.control}),a("update",()=>{c()}),a("resize",()=>{c()}),a("observerUpdate",()=>{c()}),a("setTranslate",(i,n,l)=>{!t.controller.control||t.controller.control.destroyed||t.controller.setTranslate(n,l)}),a("setTransition",(i,n,l)=>{!t.controller.control||t.controller.control.destroyed||t.controller.setTransition(n,l)}),Object.assign(t.controller,{setTranslate:S,setTransition:u})}const x=d.createContext(null);function E({children:t}){const f=d.useRef(new Map),a=d.useRef(new Set),m=d.useCallback(()=>{a.current.forEach(c=>c())},[]),y=d.useCallback((c,i)=>{f.current.set(c,i),m()},[m]),S=d.useCallback(c=>{f.current.delete(c),m()},[m]),u=d.useCallback(c=>(a.current.add(c),()=>a.current.delete(c)),[]);return C.jsx(x.Provider,{value:{swipersRef:f,listenersRef:a,register:y,unregister:S,subscribe:u},children:t})}function P(t,f){const a=d.useContext(x);if(!a)throw new Error("useSwiperMember must be used within SwiperSyncProvider");const[m,y]=d.useState(()=>{const u=a.swipersRef.current.get(f);return u&&!u.destroyed?u:void 0}),S=d.useCallback(u=>{a.register(t,u)},[a,t]);return d.useEffect(()=>{const u=()=>{const c=a.swipersRef.current.get(f),i=c&&!c.destroyed?c:void 0;y(n=>n!==i?i:n)};return u(),a.subscribe(u)},[a,f]),{onSwiper:S,controlledSwiper:m}}E.__docgenInfo={description:"Swiper 同步 Provider",methods:[],displayName:"SwiperSyncProvider",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""}}};export{N as C,E as S,P as u};
