import{g as m,b as w,e as c,f as h,B as y,h as C,i as v}from"./index-Ar-6A-5n.js";import{j as O,c as S,a as x}from"./index-Ar-6A-5n.js";import"./chain-config-DqVXGLIz.js";import{A as d}from"./amount-BQsqQYGO.js";import"./index-D0E7N0oa.js";import"./schemas-BX8BzOgD.js";import"./bioforest-uXX5qE5N.js";import"./preload-helper-PPVm8Dsz.js";import"./iframe-Cctxta_P.js";import"./address-format-DY2duW3A.js";async function B(l){const{mnemonic:t,chainConfigs:e,selectedChainIds:n,accountIndex:i=0}=l,a=new Map(e.map(s=>[s.id,s])),o=new TextEncoder().encode(t),r=[];for(const s of n){const f=a.get(s);if(!f){console.warn(`[deriveWalletChainAddresses] Chain config not found: ${s}`);continue}const p=m(s);if(!p.supportsDeriveAddress)throw new Error(`Chain "${s}" (${f.chainKind}) does not support address derivation`);const u=p.deriveAddress;if(!u)throw new Error(`Chain "${s}" deriveAddress method not available`);const g=await u(o,i);r.push({chainId:s,address:g})}return r}class R{chainId;config=null;apiUrl="";apiPath="";constructor(t){this.chainId=t}getConfig(){if(!this.config){const t=w.getConfig(this.chainId);if(!t)throw new c(h.CHAIN_NOT_FOUND,`Chain config not found: ${this.chainId}`);this.config=t;const e=w.getBiowalletApi(t.id);this.apiUrl=e?.endpoint??"",this.apiPath=e?.path??t.id}return this.config}getChainInfo(){const t=this.getConfig(),e={chainId:t.id,name:t.name,symbol:t.symbol,decimals:t.decimals,blockTime:10,confirmations:1};return t.explorer?.url&&(e.explorerUrl=t.explorer.url),e}async getBlockHeight(){if(this.getConfig(),!this.apiUrl)return 0n;try{const t=await fetch(`${this.apiUrl}/wallet/${this.apiPath}/lastblock`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new c(h.NETWORK_ERROR,`Failed to fetch block height: ${t.status}`);const e=await t.json();if(!e.success)throw new c(h.NETWORK_ERROR,"API returned success=false");return BigInt(e.result.height)}catch(t){throw t instanceof c?t:new c(h.NETWORK_ERROR,"Failed to fetch block height",void 0,t instanceof Error?t:void 0)}}async getGasPrice(){const t=this.getConfig(),{decimals:e,symbol:n}=t;if(!this.apiUrl){const i=d.fromRaw("1000",e,n);return{slow:i,standard:i.mul(2),fast:i.mul(5),lastUpdated:Date.now()}}try{const i=await fetch(`${this.apiUrl}/wallet/${this.apiPath}/blockAveFee`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new c(h.NETWORK_ERROR,`Failed to fetch fee info: ${i.status}`);const a=await i.json();if(!a.success){const s=d.fromRaw("1000",e,n);return{slow:s,standard:s.mul(2),fast:s.mul(5),lastUpdated:Date.now()}}const o=d.fromRaw(a.result.minFee,e,n),r=d.fromRaw(a.result.avgFee,e,n);return{slow:o,standard:r.gt(o)?r:o,fast:r.mul(2).gt(o)?r.mul(2):o.mul(2),lastUpdated:Date.now()}}catch(i){if(i instanceof c)throw i;const a=d.fromRaw("1000",e,n);return{slow:a,standard:a.mul(2),fast:a.mul(5),lastUpdated:Date.now()}}}async healthCheck(){if(this.getConfig(),!this.apiUrl)return{isHealthy:!1,latency:0,blockHeight:0n,isSyncing:!1,lastUpdated:Date.now()};const t=Date.now();try{const e=await fetch(`${this.apiUrl}/wallet/${this.apiPath}/lastblock`,{method:"GET",headers:{"Content-Type":"application/json"}}),n=Date.now()-t;if(!e.ok)return{isHealthy:!1,latency:n,blockHeight:0n,isSyncing:!1,lastUpdated:Date.now()};const i=await e.json();return{isHealthy:i.success,latency:n,blockHeight:i.success?BigInt(i.result.height):0n,isSyncing:!1,lastUpdated:Date.now()}}catch{return{isHealthy:!1,latency:Date.now()-t,blockHeight:0n,isSyncing:!1,lastUpdated:Date.now()}}}}class U{chainId;chainType="bioforest";identity;asset;transaction;chain;staking=null;initialized=!1;constructor(t){this.chainId=t,this.identity=new y(t),this.asset=new C(t),this.transaction=new v(t),this.chain=new R(t)}async initialize(){this.initialized||(this.initialized=!0)}dispose(){this.initialized=!1}}function P(l){return new U(l)}export{U as BioforestAdapter,h as ChainErrorCodes,O as ChainProvider,c as ChainServiceError,S as clearProviderCache,P as createBioforestAdapter,x as createChainProvider,B as deriveWalletChainAddresses,m as getChainProvider};
