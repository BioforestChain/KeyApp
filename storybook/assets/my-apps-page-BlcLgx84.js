import{r as s,j as e,u as A,L as ie}from"./iframe-Cr_UN5ps.js";import{c as d}from"./utils-4perknFd.js";import{I as le}from"./IconApps-9d_8kao3.js";import{I as ce}from"./IconSparkles-H0hZ4IOC.js";import{I as de}from"./IconLock-CmKRURTf.js";import{u as D}from"./useTranslation-CFi8Ka59.js";import{I as ue}from"./IconSearch-2-5ZusLn.js";import{f as me,h as pe,d as C,b as Z,g as fe,i as ge,j as he,k as xe}from"./index-CqAM5tj-.js";import{I as be}from"./IconDownload-bhHuzUzR.js";import{c as H}from"./createReactComponent-T6tanagy.js";import{I as ve}from"./IconTrash-DpmdX-vp.js";import{m as q}from"./proxy-CgfTp22h.js";const ye=[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 9h.01",key:"svg-1"}],["path",{d:"M11 12h1v4h1",key:"svg-2"}]],we=H("outline","info-circle","InfoCircle",ye);const je=[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]],ke=H("outline","player-play","PlayerPlay",je),Ie={xs:{size:32,radius:7},sm:{size:40,radius:9},md:{size:48,radius:10},lg:{size:60,radius:13},xl:{size:80,radius:18},"2xl":{size:120,radius:27}},K=s.forwardRef(function({src:a,name:u="App",size:h="md",customSize:r,badge:m="none",shadow:o=!1,border:f=!0,glass:l=!1,loading:c=!1,disabled:i=!1,className:y,onClick:v},M){const[R,P]=s.useState(!1),[L,w]=s.useState(!1),E=Ie[h],x=r??E.size,j=r?Math.round(r*.22):E.radius,k=o===!0||o==="md"?"shadow-lg shadow-black/10 dark:shadow-black/30":o==="sm"?"shadow-md shadow-black/5 dark:shadow-black/20":o==="lg"?"shadow-xl shadow-black/15 dark:shadow-black/40":"",I=!a||R,_=Math.max(16,x*.3),W=-_*.2;return e.jsxs("div",{ref:M,className:d("relative inline-flex shrink-0",v&&"cursor-pointer",i&&"pointer-events-none opacity-50",y),style:{width:x,height:x},onClick:v,role:v?"button":void 0,tabIndex:v?0:void 0,children:[e.jsxs("div",{className:d("relative size-full overflow-hidden",f&&!l&&"ring-1 ring-black/5 dark:ring-white/10",k,l&&"bg-white/20 backdrop-blur-md",!l&&!I&&"bg-muted",I&&"from-muted to-muted/60 bg-gradient-to-br"),style:{borderRadius:j,...l?{boxShadow:`
                inset 0 1px 1px rgba(255,255,255,0.6),
                inset 0 -1px 1px rgba(0,0,0,0.1),
                0 0 0 1.5px rgba(255,255,255,0.4),
                0 4px 12px rgba(0,0,0,0.15)
              `}:{}},children:[c&&e.jsx("div",{className:"bg-muted/80 absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"border-primary animate-spin rounded-full border-2 border-t-transparent",style:{width:x*.4,height:x*.4}})}),a&&!R&&e.jsx("img",{src:a,alt:u,className:d("size-full object-cover transition-opacity duration-200",!L&&"opacity-0"),onLoad:()=>w(!0),onError:()=>P(!0),draggable:!1}),l&&e.jsx("div",{className:"pointer-events-none absolute inset-0",style:{borderRadius:j,background:"linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0.1) 40%, transparent 60%)"}}),I&&!c&&e.jsx("div",{className:"flex size-full items-center justify-center",children:e.jsx(le,{className:"text-muted-foreground/60",style:{width:x*.5,height:x*.5},stroke:1.5})})]}),m!=="none"&&e.jsx(Ne,{type:m,size:_,offset:W})]})});function Ne({type:n,size:a,offset:u}){const r={beta:{label:"β",bg:"bg-amber-500",color:"text-white"},new:{icon:ce,bg:"bg-blue-500",color:"text-white"},update:{label:"!",bg:"bg-red-500",color:"text-white"}}[n];return e.jsx("div",{className:d("absolute flex items-center justify-center rounded-full","ring-background ring-2",r.bg,r.color),style:{width:a,height:a,top:u,right:u,fontSize:a*.6,fontWeight:700},children:"icon"in r?e.jsx(r.icon,{style:{width:a*.65,height:a*.65},stroke:2}):r.label})}K.__docgenInfo={description:"",methods:[],displayName:"MiniappIcon",props:{src:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:"图标 URL"},name:{required:!1,tsType:{name:"string"},description:"应用名称（用于 alt 和占位符）",defaultValue:{value:"'App'",computed:!1}},size:{required:!1,tsType:{name:"union",raw:"keyof typeof MINIAPP_ICON_SIZES",elements:[{name:"literal",value:"xs"},{name:"literal",value:"sm"},{name:"literal",value:"md"},{name:"literal",value:"lg"},{name:"literal",value:"xl"},{name:"literal",value:"'2xl'"}]},description:"图标尺寸",defaultValue:{value:"'md'",computed:!1}},customSize:{required:!1,tsType:{name:"number"},description:"自定义尺寸（覆盖 size）"},badge:{required:!1,tsType:{name:"union",raw:"'beta' | 'new' | 'update' | 'none'",elements:[{name:"literal",value:"'beta'"},{name:"literal",value:"'new'"},{name:"literal",value:"'update'"},{name:"literal",value:"'none'"}]},description:"徽章类型",defaultValue:{value:"'none'",computed:!1}},shadow:{required:!1,tsType:{name:"union",raw:"boolean | 'sm' | 'md' | 'lg'",elements:[{name:"boolean"},{name:"literal",value:"'sm'"},{name:"literal",value:"'md'"},{name:"literal",value:"'lg'"}]},description:"是否显示阴影",defaultValue:{value:"false",computed:!1}},border:{required:!1,tsType:{name:"boolean"},description:"是否显示边框",defaultValue:{value:"true",computed:!1}},glass:{required:!1,tsType:{name:"boolean"},description:"是否为玻璃态背景（用于深色/渐变背景上）",defaultValue:{value:"false",computed:!1}},loading:{required:!1,tsType:{name:"boolean"},description:"加载状态",defaultValue:{value:"false",computed:!1}},disabled:{required:!1,tsType:{name:"boolean"},description:"禁用状态",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"自定义类名"},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"点击事件"}}};const Te={sm:{icon:24,lock:14},md:{icon:32,lock:18},lg:{icon:40,lock:22}},J=s.forwardRef(function({src:a,name:u="Source",size:h="md",className:r},m){const{icon:o,lock:f}=Te[h],l=Math.round(o*.22);return a?e.jsx("div",{ref:m,className:d("bg-muted shrink-0 overflow-hidden","ring-border/50 ring-1",r),style:{width:o,height:o,borderRadius:l},children:e.jsx("img",{src:a,alt:u,className:"size-full object-cover",draggable:!1})}):e.jsx("div",{ref:m,className:d("flex shrink-0 items-center justify-center","bg-emerald-500/10 text-emerald-600 dark:text-emerald-400","ring-1 ring-emerald-500/20",r),style:{width:o,height:o,borderRadius:l},children:e.jsx(de,{size:f,stroke:2})})});J.__docgenInfo={description:"",methods:[],displayName:"SourceIcon",props:{src:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:"图标 URL"},name:{required:!1,tsType:{name:"string"},description:"订阅源名称",defaultValue:{value:"'Source'",computed:!1}},size:{required:!1,tsType:{name:"union",raw:"'sm' | 'md' | 'lg'",elements:[{name:"literal",value:"'sm'"},{name:"literal",value:"'md'"},{name:"literal",value:"'lg'"}]},description:"尺寸",defaultValue:{value:"'md'",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"自定义类名"}}};function Q({onClick:n,className:a}){const{t:u}=D("common");return e.jsxs("button",{onClick:n,className:d("flex items-center justify-center gap-2","bg-muted/50 backdrop-blur-sm","h-9 w-full max-w-[200px] rounded-full","text-muted-foreground text-sm font-medium","transition-all duration-200","active:scale-95 active:bg-muted/70",a),children:[e.jsx(ue,{className:"size-4",stroke:2}),e.jsx("span",{children:u("search")})]})}Q.__docgenInfo={description:"",methods:[],displayName:"IOSSearchCapsule",props:{onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};const He={closed:"closed",opening:"open",splash:"open",opened:"open",backgrounding:"open",backgrounded:"closed",foregrounding:"open",closing:"open"},Ke={closed:"gone",opening:"top",splash:"top",opened:"bottom",backgrounding:"bottom",backgrounded:"gone",foregrounding:"bottom",closing:"bottom"},Je={closed:"gone",opening:"bottom",splash:"bottom",opened:"top",backgrounding:"top",backgrounded:"gone",foregrounding:"top",closing:"top"},Qe={closed:"gone",opening:"top",splash:"top",opened:"gone",backgrounding:"gone",backgrounded:"gone",foregrounding:"gone",closing:"top"},Xe={closed:"hide",opening:"show",splash:"show",opened:"show",backgrounding:"show",backgrounded:"hide",foregrounding:"show",closing:"show"},Se={closed:"show",opening:"hide",splash:"hide",opened:"hide",backgrounding:"hide",backgrounded:"show",foregrounding:"hide",closing:"hide"},en={closed:!1,opening:!0,splash:!1,opened:!1,backgrounding:!1,backgrounded:!1,foregrounding:!1,closing:!0};function Me(n){return!n||n==="preparing"?"closed":n==="launching"?"opening":n==="splash"?"splash":n==="active"?"opened":n==="background"?"backgrounded":"closing"}const Re="_iconWrapper_1j22y_7",_e="_iconPopover_1j22y_12",ze="_iconButton_1j22y_56",Ae="_backdropClickArea_1j22y_78",Ce="_contextMenu_1j22y_83",S={iconWrapper:Re,iconPopover:_e,iconButton:ze,backdropClickArea:Ae,contextMenu:Ce};function qe({app:n,onTap:a,onOpen:u,onDetail:h,onRemove:r}){const{t:m}=D("common"),o=s.useRef(null),f=s.useRef(null),l=s.useRef(null),c=s.useRef(null),i=s.useRef(!1),[y,v]=s.useState(!1),[M,R]=s.useState({top:0,left:0}),P=A(C,t=>t.apps.get(n.id)?.state??null),L=A(C,Z.getVisualConfig),w=fe(L),x=A(C,Z.getFocusedAppId)===n.id,j=A(C,t=>t.presentations.get(n.id)?.state??null),k=Me(P),I=x&&(k==="opening"||k==="splash")?"elevated":"normal",_=Se[k],b=j===null||j==="presenting"||j==="dismissing"?{container:`miniapp:${n.id}:container`,logo:`miniapp:${n.id}:logo`,inner:`miniapp:${n.id}:inner`}:null,X={normal:{zIndex:0,pointerEvents:"auto"},elevated:{zIndex:50,pointerEvents:"none"}},ee={show:{opacity:1,scale:1},hide:{opacity:0,scale:.6}};s.useEffect(()=>(o.current&&ge(n.id,o.current),f.current&&he(n.id,f.current),()=>{xe(n.id)}),[n.id]);const V=s.useRef(null),N=s.useRef(null),z=s.useRef(null),$=()=>{const t=o.current,g=f.current;if(!t||!g)return;const p=t.getBoundingClientRect(),O=224,re=180,U=16;let B=p.top-re-U,T=p.left+p.width/2-O/2;T<16&&(T=16),T+O>window.innerWidth-16&&(T=window.innerWidth-O-16),B<16&&(B=p.bottom+U),R({top:B,left:T}),V.current=t.animate([{position:"fixed",top:`${p.top}px`,left:`${p.left}px`,margin:"0",inset:"auto",zIndex:"50"}],{duration:0,fill:"forwards"}),N.current=g.animate([{transform:"scale(1) translateY(0)",filter:"drop-shadow(0 0 0 transparent)"},{transform:"scale(1.08) translateY(-4px)",filter:"drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3))"}],{duration:200,easing:"cubic-bezier(0.34, 1.56, 0.64, 1)",fill:"forwards"}),t.showPopover(),v(!0),requestAnimationFrame(()=>{const G=l.current;G&&(z.current=G.animate([{opacity:0,transform:"scale(0.85) translateY(8px)"},{opacity:1,transform:"scale(1) translateY(0)"}],{duration:250,easing:"cubic-bezier(0.34, 1.56, 0.64, 1)",fill:"forwards"}))})},Y=()=>{const t=o.current,g=f.current,p=l.current;t&&(g&&(N.current?.cancel(),N.current=g.animate([{transform:"scale(1.08) translateY(-4px)",filter:"drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3))"},{transform:"scale(1) translateY(0)",filter:"drop-shadow(0 0 0 transparent)"}],{duration:150,easing:"ease-out",fill:"forwards"})),p&&(z.current=p.animate([{opacity:1,transform:"scale(1) translateY(0)"},{opacity:0,transform:"scale(0.9) translateY(4px)"}],{duration:150,easing:"ease-out",fill:"forwards"})),setTimeout(()=>{t.hidePopover(),v(!1),V.current?.cancel(),N.current?.cancel(),z.current?.cancel(),V.current=null,N.current=null,z.current=null},150))};s.useEffect(()=>{const t=o.current;if(!t)return;const g=p=>{v(p.newState==="open")};return t.addEventListener("toggle",g),()=>t.removeEventListener("toggle",g)},[]);const ne=()=>{i.current=!1,c.current=setTimeout(()=>{i.current=!0,$()},500)},te=()=>{c.current&&(clearTimeout(c.current),c.current=null)},ae=t=>{c.current&&(clearTimeout(c.current),c.current=null),i.current||(t.preventDefault(),a())},oe=t=>{t.preventDefault(),$()},se=t=>{Y(),t()},F=[{icon:ke,label:m("ecosystem.menu.open"),action:u},{icon:we,label:m("ecosystem.menu.detail"),action:h},{icon:ve,label:m("ecosystem.menu.remove"),action:r,destructive:!0}];return e.jsxs("div",{className:d(S.iconWrapper,"flex flex-col items-center gap-1.5 p-2"),children:[e.jsxs("div",{ref:o,popover:"manual",className:S.iconPopover,children:[y&&e.jsx("div",{className:d("fixed inset-0",S.backdropClickArea),style:{zIndex:-1},onClick:Y}),e.jsx("button",{className:d(S.iconButton,"touch-manipulation select-none","transition-all duration-200 ease-out","active:scale-95"),onClick:a,onTouchStart:ne,onTouchMove:te,onTouchEnd:ae,onContextMenu:oe,"data-testid":`ios-app-icon-${n.id}`,children:e.jsx(ie,{inherit:"id",children:e.jsxs(q.div,{...b?{layoutId:b.container,"data-layoutid":b.container}:{},transition:w.sharedLayout,variants:X,initial:!1,animate:I,className:"relative",style:{width:68,height:68,borderRadius:16},children:[e.jsx(q.div,{...b?{layoutId:b.inner,"data-layoutid":b.inner}:{},transition:w.sharedLayout,className:"absolute inset-0 flex items-center justify-center"}),e.jsx(q.div,{ref:f,...b?{layoutId:b.logo,"data-layoutid":b.logo}:{},transition:w.sharedLayout,className:"absolute inset-0 flex size-15 items-center justify-center",children:e.jsx(K,{src:n.icon,name:n.name,size:"lg",shadow:!0})}),e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(q.div,{variants:ee,initial:!1,animate:_,transition:w.uiFast,style:{transformOrigin:"100% 0%"},children:e.jsx(J,{src:n.sourceIcon,name:n.sourceName,size:"sm"})})})]})})}),y&&e.jsx("div",{ref:l,className:d(S.contextMenu,"fixed w-56"),style:{top:M.top,left:M.left},"data-testid":`context-menu-${n.id}`,children:e.jsxs("div",{className:"bg-popover/95 overflow-hidden rounded-2xl border border-white/10 shadow-2xl shadow-black/40 backdrop-blur-xl",children:[e.jsxs("div",{className:"border-b border-white/10 px-4 py-3",children:[e.jsx("h3",{className:"truncate text-sm font-semibold",children:n.name}),e.jsx("p",{className:"text-muted-foreground mt-0.5 truncate text-xs",children:n.description})]}),e.jsx("div",{className:"py-1",children:F.map((t,g)=>e.jsxs("button",{onClick:()=>se(t.action),className:d("flex w-full items-center gap-3 px-4 py-2.5","text-sm font-medium","transition-colors duration-100","active:bg-white/10",t.destructive?"text-red-500 dark:text-red-400":"text-foreground",g===F.length-1&&"mt-1 border-t border-white/10 pt-2.5"),children:[e.jsx(t.icon,{className:"size-5",stroke:1.5}),e.jsx("span",{children:t.label})]},t.label))})]})})]}),e.jsx("span",{className:"text-foreground/90 line-clamp-2 max-w-[72px] text-center text-[11px] leading-tight font-medium",children:n.name})]})}function Pe(){const{t:n}=D("common");return e.jsxs("div",{className:"flex flex-col items-center justify-center px-5 py-20 text-center",children:[e.jsx("div",{className:"bg-muted/50 mb-4 flex size-20 items-center justify-center rounded-full",children:e.jsx(be,{className:"text-muted-foreground size-10",stroke:1.5})}),e.jsx("h2",{className:"mb-1 text-lg font-semibold",children:n("ecosystem.noAppsUsed")}),e.jsx("p",{className:"text-muted-foreground text-sm",children:n("ecosystem.goToDiscover")})]})}function Le({apps:n,showSearch:a=!0,onSearchClick:u,onAppOpen:h,onAppDetail:r,onAppRemove:m}){const l=Math.ceil(n.length/24),c=s.useRef(null);return s.useEffect(()=>{const i=c.current;if(i)return me("mine",i),()=>pe("mine")},[]),e.jsx("div",{ref:c,className:"my-apps-page h-full",children:e.jsxs("div",{className:"relative z-10 h-full overflow-y-auto",children:[a?e.jsx("div",{className:"flex justify-center px-5 pt-14 pb-6",children:e.jsx(Q,{onClick:u})}):e.jsx("div",{className:"pt-14"}),n.length===0?e.jsx(Pe,{}):e.jsxs("div",{className:"px-4 pb-8",children:[e.jsx("div",{className:"grid justify-items-center gap-y-4",style:{gridTemplateColumns:"repeat(4, minmax(0, 1fr))"},children:n.map(({app:i})=>e.jsx(qe,{app:i,onTap:()=>h(i),onOpen:()=>h(i),onDetail:()=>r(i),onRemove:()=>m(i.id)},i.id))}),l>1&&e.jsx("div",{className:"mt-6 flex justify-center gap-1.5",children:Array.from({length:l}).map((i,y)=>e.jsx("div",{className:d("size-2 rounded-full transition-colors",y===0?"bg-foreground/80":"bg-foreground/20")},y))})]}),e.jsx("div",{className:"h-[var(--tab-bar-height)]"})]})})}Le.__docgenInfo={description:"",methods:[],displayName:"MyAppsPage",props:{apps:{required:!0,tsType:{name:"Array",elements:[{name:"signature",type:"object",raw:"{ app: MiniappManifest; lastUsed: number }",signature:{properties:[{key:"app",value:{name:"MiniappManifest",required:!0}},{key:"lastUsed",value:{name:"number",required:!0}}]}}],raw:"Array<{ app: MiniappManifest; lastUsed: number }>"},description:""},showSearch:{required:!1,tsType:{name:"boolean"},description:"是否显示搜索框（默认 true，关闭发现页时应设为 false）",defaultValue:{value:"true",computed:!1}},onSearchClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onAppOpen:{required:!0,tsType:{name:"signature",type:"function",raw:"(app: MiniappManifest) => void",signature:{arguments:[{type:{name:"MiniappManifest"},name:"app"}],return:{name:"void"}}},description:""},onAppDetail:{required:!0,tsType:{name:"signature",type:"function",raw:"(app: MiniappManifest) => void",signature:{arguments:[{type:{name:"MiniappManifest"},name:"app"}],return:{name:"void"}}},description:""},onAppRemove:{required:!0,tsType:{name:"signature",type:"function",raw:"(appId: string) => void",signature:{arguments:[{type:{name:"string"},name:"appId"}],return:{name:"void"}}},description:""}}};export{we as I,Le as M,K as a,Ke as b,Je as c,Qe as d,Xe as e,He as f,en as g};
