import{o as c,n as h,b as p,s as u}from"./schemas-CO8_C8zP.js";const o={INTERNAL_ERROR:-32603};function a(s,e,t){const n=new Error(e);return n.code=s,n.data=t,n}class f{handlers=new Map;on(e,t){let n=this.handlers.get(e);n||(n=new Set,this.handlers.set(e,n)),n.add(t)}off(e,t){const n=this.handlers.get(e);n&&(n.delete(t),n.size===0&&this.handlers.delete(e))}emit(e,...t){const n=this.handlers.get(e);n&&n.forEach(i=>{try{i(...t)}catch(r){console.error("[bio-sdk] Error in event handler:",r)}})}removeAllListeners(e){e?this.handlers.delete(e):this.handlers.clear()}}class w{events=new f;pendingRequests=new Map;requestIdCounter=0;connected=!1;targetOrigin;constructor(e="*"){this.targetOrigin=e,this.setupMessageListener(),this.connect()}setupMessageListener(){window.addEventListener("message",this.handleMessage.bind(this))}handleMessage(e){const t=e.data;!t||typeof t!="object"||(t.type==="bio_response"?this.handleResponse(t):t.type==="bio_event"&&this.handleEvent(t))}handleResponse(e){const t=this.pendingRequests.get(e.id);if(t)if(this.pendingRequests.delete(e.id),e.success)t.resolve(e.result);else{const n=e.error??{code:o.INTERNAL_ERROR,message:"Unknown error"};t.reject(a(n.code,n.message,n.data))}}handleEvent(e){this.events.emit(e.event,...e.args),e.event==="connect"?this.connected=!0:e.event==="disconnect"&&(this.connected=!1)}connect(){this.postMessage({type:"bio_request",id:this.generateId(),method:"bio_connect",params:[]})}generateId(){return`bio_${Date.now()}_${++this.requestIdCounter}`}postMessage(e){if(window.parent===window){console.warn("[bio-sdk] Not running in iframe, postMessage will not work");return}window.parent.postMessage(e,this.targetOrigin)}async request(e){const t=this.generateId();return new Promise((n,i)=>{this.pendingRequests.set(t,{resolve:n,reject:i}),this.postMessage({type:"bio_request",id:t,method:e.method,params:e.params}),setTimeout(()=>{this.pendingRequests.has(t)&&(this.pendingRequests.delete(t),i(a(o.INTERNAL_ERROR,"Request timeout")))},300*1e3)})}on(e,t){this.events.on(e,t)}off(e,t){this.events.off(e,t)}isConnected(){return this.connected}}class g{events=new f;pendingRequests=new Map;requestIdCounter=0;connected=!1;currentChainId=null;accounts=[];targetOrigin;isMetaMask=!1;isKeyApp=!0;constructor(e="*"){this.targetOrigin=e,this.setupMessageListener()}setupMessageListener(){window.addEventListener("message",this.handleMessage.bind(this))}handleMessage(e){const t=e.data;!t||typeof t!="object"||(t.type==="eth_response"?this.handleResponse(t):t.type==="eth_event"&&this.handleEvent(t))}handleResponse(e){const t=this.pendingRequests.get(e.id);if(t)if(this.pendingRequests.delete(e.id),e.success)t.resolve(e.result);else{const n=e.error??{code:o.INTERNAL_ERROR,message:"Unknown error"};t.reject(a(n.code,n.message,n.data))}}handleEvent(e){if(this.events.emit(e.event,...e.args),e.event==="connect"){this.connected=!0;const t=e.args[0];this.currentChainId=t?.chainId??null}else e.event==="disconnect"?(this.connected=!1,this.accounts=[]):e.event==="chainChanged"?this.currentChainId=e.args[0]:e.event==="accountsChanged"&&(this.accounts=e.args[0])}generateId(){return`eth_${Date.now()}_${++this.requestIdCounter}`}postMessage(e){window.parent!==window&&window.parent.postMessage(e,this.targetOrigin)}async request(e){const{method:t,params:n}=e,i=Array.isArray(n)?n:n?[n]:[],r=this.generateId();return new Promise((l,d)=>{this.pendingRequests.set(r,{resolve:l,reject:d}),this.postMessage({type:"eth_request",id:r,method:t,params:i}),setTimeout(()=>{this.pendingRequests.has(r)&&(this.pendingRequests.delete(r),d(a(o.INTERNAL_ERROR,"Request timeout")))},300*1e3)})}on(e,t){return this.events.on(e,t),this}off(e,t){return this.events.off(e,t),this}removeListener(e,t){return this.off(e,t)}once(e,t){const n=(...i)=>{this.off(e,n),t(...i)};return this.on(e,n),this}isConnected(){return this.connected}get chainId(){return this.currentChainId}get selectedAddress(){return this.accounts[0]??null}async enable(){return this.request({method:"eth_requestAccounts"})}send(e,t){return this.request({method:e,params:t})}sendAsync(e,t){this.request({method:e.method,params:e.params}).then(n=>t(null,{result:n})).catch(n=>t(n))}}function m(s="*"){if(typeof window>"u")throw new Error("[EthereumProvider] Cannot initialize: window is not defined");if(window.ethereum)return window.ethereum;const e=new g(s);return window.ethereum=e,e}class R{events=new f;pendingRequests=new Map;requestIdCounter=0;targetOrigin;constructor(e="*"){this.targetOrigin=e,this.setupMessageListener()}setupMessageListener(){window.addEventListener("message",this.handleMessage.bind(this))}handleMessage(e){const t=e.data;!t||typeof t!="object"||(t.type==="tron_response"?this.handleResponse(t):t.type==="tron_event"&&this.handleEvent(t))}handleResponse(e){const t=this.pendingRequests.get(e.id);if(t)if(this.pendingRequests.delete(e.id),e.success)t.resolve(e.result);else{const n=e.error??{code:o.INTERNAL_ERROR,message:"Unknown error"};t.reject(a(n.code,n.message,n.data))}}handleEvent(e){this.events.emit(e.event,...e.args)}generateId(){return`tron_${Date.now()}_${++this.requestIdCounter}`}postMessage(e){window.parent!==window&&window.parent.postMessage(e,this.targetOrigin)}async request(e){const{method:t,params:n}=e,i=Array.isArray(n)?n:n!==void 0?[n]:[],r=this.generateId();return new Promise((l,d)=>{this.pendingRequests.set(r,{resolve:l,reject:d}),this.postMessage({type:"tron_request",id:r,method:t,params:i}),setTimeout(()=>{this.pendingRequests.has(r)&&(this.pendingRequests.delete(r),d(a(o.INTERNAL_ERROR,"Request timeout")))},300*1e3)})}on(e,t){return this.events.on(e,t),this}off(e,t){return this.events.off(e,t),this}}class v{tronLink;_ready=!1;_defaultAddress={base58:"",hex:""};trx;constructor(e){this.tronLink=e,this.trx=new _(e),e.on("accountsChanged",t=>{if(Array.isArray(t)&&t.length>0){const n=t[0];this._defaultAddress=n,this._ready=!0}else this._defaultAddress={base58:"",hex:""},this._ready=!1})}get ready(){return this._ready}get defaultAddress(){return this._defaultAddress}setAddress(e){this._defaultAddress=e,this._ready=!0}isAddress(e){return e.startsWith("T")?e.length===34:e.startsWith("41")?e.length===42:!1}address={toHex:e=>e,fromHex:e=>e}}class _{tronLink;constructor(e){this.tronLink=e}async sign(e){return this.tronLink.request({method:"tron_signTransaction",params:e})}async sendRawTransaction(e){return this.tronLink.request({method:"tron_sendRawTransaction",params:e})}async getBalance(e){return this.tronLink.request({method:"tron_getBalance",params:e})}async getAccount(e){return this.tronLink.request({method:"tron_getAccount",params:e})}}function E(s="*"){if(typeof window>"u")throw new Error("[TronProvider] Cannot initialize: window is not defined");if(window.tronLink&&window.tronWeb)return{tronLink:window.tronLink,tronWeb:window.tronWeb};const e=new R(s),t=new v(e);return window.tronLink=e,window.tronWeb=t,{tronLink:e,tronWeb:t}}const b={ethereum:1,binance:56},y=Object.fromEntries(Object.entries(b).map(([s,e])=>[e,s])),q={ETH:"ethereum",BSC:"binance",TRON:"tron",BFMCHAIN:"bfmeta",BFCHAIN:"bfchain",eth:"ethereum",bsc:"binance",tron:"tron",bfmchain:"bfmeta",bfchain:"bfchain"};function O(s){return`0x${s.toString(16)}`}function A(s){if(!s.startsWith("0x"))throw new Error(`Invalid hex chain ID: ${s}`);return parseInt(s,16)}function N(s){const e=A(s);return y[e]??null}function k(s){return q[s]??s.toLowerCase()}const I=c({top:h().min(0),right:h().min(0),bottom:h().min(0),left:h().min(0)}),M=c({safeAreaInsets:I,platform:p(["web","dweb","ios","android"]).optional(),locale:u().optional(),direction:p(["ltr","rtl"]).optional()}),L=c({name:u().min(1),version:u().min(1),build:u().optional()});c({version:h().min(1),env:M,host:L,updatedAt:u(),theme:c({colorMode:p(["light","dark"]).optional()}).optional()}).passthrough();function C(s="*"){if(typeof window>"u")throw new Error("[BioSDK] Cannot initialize: window is not defined");if(window.bio)return window.bio;const e=new w(s);return window.bio=e,e}if(typeof window<"u"){const s=()=>{C(),m(),E()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",s):s()}export{b as E,N as g,k as n,A as p,O as t};
