import{r as p}from"./iframe-DTpQIzq1.js";import{b,a as C,E as T,d as h,e as F}from"./useRenderElement-C1xkhfI3.js";import{u as w,a as B,F as R,P as A,c as a,b as P,g as U}from"./composite-xO1Che9I.js";import{u as y}from"./useBaseUiId-DvXQ5IFd.js";function k(e,t){const n=p.useRef(null);return p.useCallback(r=>{e!==void 0&&(n.current!==null&&(t.context.triggerElements.delete(n.current),n.current=null),r!==null&&(n.current=e,t.context.triggerElements.add(e,r)))},[t,e])}function V(e,t,n,r){const s=n.useState("isMountedByTrigger",e),c=k(e,n),g=C(u=>{c(u),u!==null&&n.select("open")&&n.select("activeTriggerId")==null&&n.update({activeTriggerId:e,activeTriggerElement:u,...r})});return b(()=>{s&&n.update({activeTriggerElement:t.current,...r})},[s,n,t,...Object.values(r)]),{registerTrigger:g,isMountedByThisTrigger:s}}function W(e){const t=e.useState("open");b(()=>{if(t&&!e.select("activeTriggerId")&&e.context.triggerElements.size===1){const n=e.context.triggerElements.entries().next();if(!n.done){const[r,s]=n.value;e.update({activeTriggerId:r,activeTriggerElement:s})}}},[t,e])}function Y(e,t,n){const{mounted:r,setMounted:s,transitionStatus:c}=w(e);t.useSyncedValues({mounted:r,transitionStatus:c});const g=C(()=>{s(!1),t.update({activeTriggerId:null,activeTriggerElement:null,mounted:!1}),n?.(),t.context.onOpenChangeComplete?.(!1)}),u=t.useState("preventUnmountingOnClose");return B({enabled:!u,open:e,ref:t.context.popupRef,onComplete(){e||g()}}),{forceUnmount:g,transitionStatus:c}}function N(){return new R({open:!1,floatingElement:null,referenceElement:null,triggerElements:new A,floatingId:"",nested:!1,noEmit:!1,onOpenChange:void 0})}function _(){return{open:!1,mounted:!1,transitionStatus:"idle",floatingRootContext:N(),preventUnmountingOnClose:!1,payload:void 0,activeTriggerId:null,activeTriggerElement:null,popupElement:null,positionerElement:null,activeTriggerProps:T,inactiveTriggerProps:T,popupProps:T}}const q={open:a(e=>e.open),mounted:a(e=>e.mounted),transitionStatus:a(e=>e.transitionStatus),floatingRootContext:a(e=>e.floatingRootContext),preventUnmountingOnClose:a(e=>e.preventUnmountingOnClose),payload:a(e=>e.payload),activeTriggerId:a(e=>e.activeTriggerId),activeTriggerElement:a(e=>e.mounted?e.activeTriggerElement:null),isTriggerActive:a((e,t)=>t!==void 0&&e.activeTriggerId===t),isOpenedByTrigger:a((e,t)=>t!==void 0&&e.activeTriggerId===t&&e.open),isMountedByTrigger:a((e,t)=>t!==void 0&&e.activeTriggerId===t&&e.mounted),triggerProps:a((e,t)=>t?e.activeTriggerProps:e.inactiveTriggerProps),popupProps:a(e=>e.popupProps),popupElement:a(e=>e.popupElement),positionerElement:a(e=>e.positionerElement)};function G(e){const{popupStore:t,noEmit:n=!1,treatPopupAsFloatingElement:r=!1,onOpenChange:s}=e,c=y(),g=P()!=null,u=t.useState("open"),o=t.useState("activeTriggerElement"),m=t.useState(r?"popupElement":"positionerElement"),d=t.context.triggerElements,l=h(()=>new R({open:u,referenceElement:o,floatingElement:m,triggerElements:d,onOpenChange:s,floatingId:c,nested:g,noEmit:n})).current;return b(()=>{const i={open:u,floatingId:c,referenceElement:o,floatingElement:m};F(o)&&(i.domReferenceElement=o),l.update(i)},[u,c,o,m,l]),l.context.onOpenChange=s,l.context.nested=g,l.context.noEmit=n,l}const $=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function H(e,t={}){const n="rootStore"in e?e.rootStore:e,r=n.useState("open"),s=n.useState("floatingId"),c=n.useState("domReferenceElement"),g=n.useState("floatingElement"),{enabled:u=!0,role:o="dialog"}=t,m=y(),d=c?.id||m,l=p.useMemo(()=>U(g)?.id||s,[g,s]),i=$.get(o)??o,v=P()!=null,E=p.useMemo(()=>i==="tooltip"||o==="label"?T:{"aria-haspopup":i==="alertdialog"?"dialog":i,"aria-expanded":"false",...i==="listbox"&&{role:"combobox"},...i==="menu"&&v&&{role:"menuitem"},...o==="select"&&{"aria-autocomplete":"none"},...o==="combobox"&&{"aria-autocomplete":"list"}},[i,v,o]),S=p.useMemo(()=>i==="tooltip"||o==="label"?{[`aria-${o==="label"?"labelledby":"describedby"}`]:r?l:void 0}:{...E,"aria-expanded":r?"true":"false","aria-controls":r?l:void 0,...i==="menu"&&{id:d}},[i,l,r,d,o,E]),x=p.useMemo(()=>{const f={id:l,...i&&{role:i}};return i==="tooltip"||o==="label"?f:{...f,...i==="menu"&&{"aria-labelledby":d}}},[i,l,d,o]),I=p.useCallback(({active:f,selected:O})=>{const M={role:"option",...f&&{id:`${l}-fui-option`}};switch(o){case"select":case"combobox":return{...M,"aria-selected":O}}return{}},[l,o]);return p.useMemo(()=>u?{reference:S,floating:x,item:I,trigger:E}:{},[u,S,x,E,I])}export{Y as a,G as b,H as c,_ as d,V as e,q as p,W as u};
