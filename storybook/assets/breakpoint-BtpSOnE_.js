import{t as m}from"./schemas-jh0dXz-I.js";const a=[];class l{constructor(t){this.def=t}middlewares=[];use(t){return this.middlewares.push(t),this}static useGlobal(t){a.push(t)}static clearGlobal(){a.length=0}impl(t){const e={},i=this.middlewares;for(const[r,s]of Object.entries(this.def.members)){const n=t[r];if(s.type==="api")e[r]=this.wrapApi(r,s,n,i);else if(s.type==="get")e[r]=this.wrapGet(r,s,n,i);else if(s.type==="set")e[r]=this.wrapSet(r,s,n,i);else if(s.type==="getset"){const o=n;e[r]={get:this.wrapGet(r,s,o.get,i),set:this.wrapSet(r,s,o.set,i)}}else s.type==="stream"?e[r]=this.wrapStream(r,s,n,i):s.type==="method"&&(e[r]=this.wrapMethod(r,s,n,i))}return e}wrapApi(t,e,i,r){return async s=>{const n={service:this.def.name,member:t,type:"api",input:s,meta:e},o=[...a,...r];return this.runMiddlewares(n,o,()=>i(s))}}wrapGet(t,e,i,r){return async()=>{const s={service:this.def.name,member:t,type:"get",input:void 0,meta:e},n=[...a,...r];return this.runMiddlewares(s,n,()=>i())}}wrapSet(t,e,i,r){return async s=>{const n={service:this.def.name,member:t,type:"set",input:s,meta:e},o=[...a,...r];return this.runMiddlewares(n,o,()=>i(s))}}wrapStream(t,e,i,r){const s=this;return async function*(){const n={service:s.def.name,member:t,type:"stream",input:void 0,meta:e},o=[...a,...r];await s.runMiddlewares(n,o,async()=>{}),yield*i()}}wrapMethod(t,e,i,r){return async(...s)=>{const n={service:this.def.name,member:t,type:"method",input:s,meta:e},o=[...a,...r];return this.runMiddlewares(n,o,()=>i(...s))}}async runMiddlewares(t,e,i){let r=0;const s=async()=>{if(r<e.length){const n=e[r++];return n(t,s)}return i()};return s()}get Type(){throw new Error("Type is for type inference only")}}class u{constructor(t){this.name=t}_description;_members={};description(t){return this._description=t,this}api(t,e,i){const r=e&&typeof e=="object"&&"input"in e,s=r?e.input:e,n=r?e.output:i,o=r?e.description:void 0;return this._members[t]={type:"api",name:t,description:o,input:s,output:n},this}get(t,e){return this._members[t]={type:"get",name:t,description:e.description,schema:e.type},this}set(t,e){return this._members[t]={type:"set",name:t,description:e.description,schema:e.type},this}getset(t,e){return this._members[t]={type:"getset",name:t,description:e.description,schema:e.type},this}stream(t,e){return this._members[t]={type:"stream",name:t,description:e.description,yield:e.yield,return:e.return},this}method(t,e,i){if(e&&typeof e=="object"&&"args"in e){const s=e;this._members[t]={type:"method",name:t,description:s.description,args:s.args,output:s.output,async:s.async??!0}}else{const s=e;this._members[t]={type:"method",name:t,description:void 0,args:m([s]),output:i,async:!1}}return this}build(){return new l({name:this.name,description:this._description,members:this._members})}}function g(c,t){const e=new u(c);return t(e).build()}const d="mock-devtools",h="breakpoints",p=new Map,y=[];async function w(){try{const c=await b(),i=c.transaction(d,"readonly").objectStore(d).get(h),r=await new Promise((s,n)=>{i.onsuccess=()=>s(i.result),i.onerror=()=>n(i.error)});if(c.close(),r){p.clear();for(const s of r)p.set(f(s.service,s.method),s)}}catch{}}function b(){return new Promise((c,t)=>{const e=indexedDB.open("MockDevTools",1);e.onerror=()=>t(e.error),e.onsuccess=()=>c(e.result),e.onupgradeneeded=()=>{const i=e.result;i.objectStoreNames.contains(d)||i.createObjectStore(d)}})}w().then(()=>{y.forEach(c=>c())});function f(c,t){return`${c}.${t}`}export{g as d};
