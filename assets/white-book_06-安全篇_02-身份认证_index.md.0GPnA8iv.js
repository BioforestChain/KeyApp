import{_ as s,c as t,o as n,ag as i}from"./chunks/framework.B0we9iV-.js";const k=JSON.parse('{"title":"身份认证","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/06-安全篇/02-身份认证/index.md","filePath":"white-book/06-安全篇/02-身份认证/index.md"}'),l={name:"white-book/06-安全篇/02-身份认证/index.md"};function e(p,a,d,r,h,o){return n(),t("div",null,[...a[0]||(a[0]=[i(`<h1 id="身份认证" tabindex="-1">身份认证 <a class="header-anchor" href="#身份认证" aria-label="Permalink to &quot;身份认证&quot;">​</a></h1><blockquote><p>定义用户身份验证机制规范</p></blockquote><hr><h2 id="认证类型说明" tabindex="-1">认证类型说明 <a class="header-anchor" href="#认证类型说明" aria-label="Permalink to &quot;认证类型说明&quot;">​</a></h2><p>本应用涉及两种不同的认证概念，<strong>必须</strong>明确区分：</p><h3 id="钱包锁-wallet-lock" tabindex="-1">钱包锁 (Wallet Lock) <a class="header-anchor" href="#钱包锁-wallet-lock" aria-label="Permalink to &quot;钱包锁 (Wallet Lock)&quot;">​</a></h3><table tabindex="0"><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td><strong>作用域</strong></td><td>本地应用层面</td></tr><tr><td><strong>用途</strong></td><td>加密存储在设备上的助记词/私钥</td></tr><tr><td><strong>存储位置</strong></td><td>不存储，仅用于派生加密密钥</td></tr><tr><td><strong>设置时机</strong></td><td>创建/导入钱包时设置</td></tr><tr><td><strong>使用场景</strong></td><td>解锁钱包、查看助记词、导出私钥</td></tr><tr><td><strong>是否可修改</strong></td><td>是（需验证原图案）</td></tr><tr><td><strong>与链的关系</strong></td><td>无关，纯本地</td></tr><tr><td><strong>是否必需</strong></td><td>取决于平台能力（见下方说明）</td></tr><tr><td><strong>实现形式</strong></td><td>九宫格图案锁 (3x3 Pattern Lock)</td></tr></tbody></table><blockquote><p><strong>关于必要性</strong>：钱包锁的本质是<strong>应用级加密保护</strong>。如果设备提供了原生的安全存储（如 iOS Keychain with Secure Enclave、Android Keystore with TEE），理论上可以不需要用户设置钱包锁，直接使用硬件级加密。目前为了实现 Web 适配器而要求设置。</p></blockquote><h3 id="交易密码-二次签名-pay-password-second-signature" tabindex="-1">交易密码 / 二次签名 (Pay Password / Second Signature) <a class="header-anchor" href="#交易密码-二次签名-pay-password-second-signature" aria-label="Permalink to &quot;交易密码 / 二次签名 (Pay Password / Second Signature)&quot;">​</a></h3><table tabindex="0"><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td><strong>作用域</strong></td><td>链上层面（仅 BioForest 链）</td></tr><tr><td><strong>用途</strong></td><td>交易的二次签名，防止私钥泄露后资产被盗</td></tr><tr><td><strong>存储位置</strong></td><td>链上存储 <code>secondPublicKey</code></td></tr><tr><td><strong>设置时机</strong></td><td>用户主动设置（可选）</td></tr><tr><td><strong>使用场景</strong></td><td>每次转账时需要额外输入</td></tr><tr><td><strong>是否可修改</strong></td><td>否（链上不可变）</td></tr><tr><td><strong>与链的关系</strong></td><td>链上记录，交易需要 <code>signSignature</code> 字段</td></tr></tbody></table><h3 id="关系图" tabindex="-1">关系图 <a class="header-anchor" href="#关系图" aria-label="Permalink to &quot;关系图&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                         用户视角                                │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                                                                 │</span></span>
<span class="line"><span>│  创建钱包 ──► 设置【钱包锁图案】──► 加密助记词存储到设备        │</span></span>
<span class="line"><span>│                                                                 │</span></span>
<span class="line"><span>│  设置二次签名 ──► 设置【安全密码】──► 链上记录 secondPublicKey  │</span></span>
<span class="line"><span>│                                                                 │</span></span>
<span class="line"><span>│  转账时:                                                        │</span></span>
<span class="line"><span>│    1. 绘制【钱包锁图案】解锁助记词                              │</span></span>
<span class="line"><span>│    2. 如有二次签名，还需输入【安全密码】                        │</span></span>
<span class="line"><span>│                                                                 │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────┘</span></span></code></pre></div><h3 id="开发注意事项" tabindex="-1">开发注意事项 <a class="header-anchor" href="#开发注意事项" aria-label="Permalink to &quot;开发注意事项&quot;">​</a></h3><ul><li><strong>MUST</strong> 在 UI 中使用不同的术语区分两者</li><li><strong>MUST NOT</strong> 混淆 <code>walletLock/patternKey</code> 和 <code>twoStepSecret</code> 变量命名</li><li><strong>SHOULD</strong> 钱包锁使用图案锁组件，安全密码使用密码输入框</li><li><strong>SHOULD</strong> 检查 <code>secondPublicKey</code> 存在时才请求安全密码</li></ul><hr><h2 id="认证方式" tabindex="-1">认证方式 <a class="header-anchor" href="#认证方式" aria-label="Permalink to &quot;认证方式&quot;">​</a></h2><table tabindex="0"><thead><tr><th>方式</th><th>场景</th><th>安全级别</th><th>便捷性</th></tr></thead><tbody><tr><td>图案锁</td><td>首次解锁、敏感操作</td><td>高</td><td>中</td></tr><tr><td>生物识别</td><td>日常解锁、快捷支付</td><td>高</td><td>高</td></tr></tbody></table><hr><h2 id="应用锁规范" tabindex="-1">应用锁规范 <a class="header-anchor" href="#应用锁规范" aria-label="Permalink to &quot;应用锁规范&quot;">​</a></h2><h3 id="锁定状态" tabindex="-1">锁定状态 <a class="header-anchor" href="#锁定状态" aria-label="Permalink to &quot;锁定状态&quot;">​</a></h3><table tabindex="0"><thead><tr><th>状态</th><th>说明</th></tr></thead><tbody><tr><td>locked</td><td>已锁定，需要认证</td></tr><tr><td>unlocked</td><td>已解锁，可正常使用</td></tr></tbody></table><h3 id="状态数据" tabindex="-1">状态数据 <a class="header-anchor" href="#状态数据" aria-label="Permalink to &quot;状态数据&quot;">​</a></h3><table tabindex="0"><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>isLocked</td><td>boolean</td><td>当前锁定状态</td></tr><tr><td>isWalletLockEnabled</td><td>boolean</td><td>是否启用钱包锁</td></tr><tr><td>isBiometricEnabled</td><td>boolean</td><td>是否启用生物识别</td></tr><tr><td>lastUnlockTime</td><td>timestamp</td><td>上次解锁时间</td></tr><tr><td>autoLockTimeout</td><td>number</td><td>自动锁定时间（分钟）</td></tr></tbody></table><h3 id="解锁流程" tabindex="-1">解锁流程 <a class="header-anchor" href="#解锁流程" aria-label="Permalink to &quot;解锁流程&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户打开应用</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>检查是否启用锁定</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ├── 未启用 ──► 直接进入</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    └── 已启用</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         ▼</span></span>
<span class="line"><span>    检查生物识别是否可用</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         ├── 可用 ──► 提示指纹/面容解锁</span></span>
<span class="line"><span>         │            │</span></span>
<span class="line"><span>         │            ├── 成功 ──► 解锁</span></span>
<span class="line"><span>         │            │</span></span>
<span class="line"><span>         │            └── 失败 ──► 回退图案锁</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         └── 不可用 ──► 显示图案锁</span></span>
<span class="line"><span>                        │</span></span>
<span class="line"><span>                        ├── 正确 ──► 解锁</span></span>
<span class="line"><span>                        │</span></span>
<span class="line"><span>                        └── 错误 ──► 显示错误 + 重试</span></span></code></pre></div><hr><h2 id="自动锁定规范" tabindex="-1">自动锁定规范 <a class="header-anchor" href="#自动锁定规范" aria-label="Permalink to &quot;自动锁定规范&quot;">​</a></h2><h3 id="触发条件" tabindex="-1">触发条件 <a class="header-anchor" href="#触发条件" aria-label="Permalink to &quot;触发条件&quot;">​</a></h3><table tabindex="0"><thead><tr><th>条件</th><th>说明</th><th>可配置</th></tr></thead><tbody><tr><td>超时无操作</td><td>设定时间内无用户活动</td><td>是</td></tr><tr><td>应用切后台</td><td>应用进入后台</td><td>是</td></tr><tr><td>屏幕锁定</td><td>设备屏幕锁定</td><td>否</td></tr></tbody></table><h3 id="超时选项" tabindex="-1">超时选项 <a class="header-anchor" href="#超时选项" aria-label="Permalink to &quot;超时选项&quot;">​</a></h3><table tabindex="0"><thead><tr><th>选项</th><th>默认</th></tr></thead><tbody><tr><td>1 分钟</td><td></td></tr><tr><td>5 分钟</td><td>✓</td></tr><tr><td>15 分钟</td><td></td></tr><tr><td>30 分钟</td><td></td></tr><tr><td>从不</td><td></td></tr></tbody></table><h3 id="活动监听" tabindex="-1">活动监听 <a class="header-anchor" href="#活动监听" aria-label="Permalink to &quot;活动监听&quot;">​</a></h3><p>以下用户活动 SHOULD 重置超时计时器：</p><ul><li>触摸/点击事件</li><li>滚动事件</li><li>键盘输入</li><li>导航操作</li></ul><hr><h2 id="生物识别认证规范" tabindex="-1">生物识别认证规范 <a class="header-anchor" href="#生物识别认证规范" aria-label="Permalink to &quot;生物识别认证规范&quot;">​</a></h2><h3 id="支持类型" tabindex="-1">支持类型 <a class="header-anchor" href="#支持类型" aria-label="Permalink to &quot;支持类型&quot;">​</a></h3><table tabindex="0"><thead><tr><th>类型</th><th>平台</th></tr></thead><tbody><tr><td>指纹 (Touch ID)</td><td>iOS, Android</td></tr><tr><td>面容 (Face ID)</td><td>iOS</td></tr><tr><td>指纹 (Fingerprint)</td><td>Android</td></tr></tbody></table><h3 id="启用流程" tabindex="-1">启用流程 <a class="header-anchor" href="#启用流程" aria-label="Permalink to &quot;启用流程&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户进入安全设置</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>开启&quot;生物识别解锁&quot;</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>验证钱包锁图案 ← 确保用户是钱包所有者</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ├── 图案错误 ──► 显示错误</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    └── 图案正确</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         ▼</span></span>
<span class="line"><span>    检查设备生物识别可用性</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         ├── 不可用 ──► 显示提示</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         └── 可用</span></span>
<span class="line"><span>              │</span></span>
<span class="line"><span>              ▼</span></span>
<span class="line"><span>         验证生物识别</span></span>
<span class="line"><span>              │</span></span>
<span class="line"><span>              ├── 成功 ──► 启用功能</span></span>
<span class="line"><span>              │</span></span>
<span class="line"><span>              └── 失败 ──► 显示错误</span></span></code></pre></div><h3 id="认证要求" tabindex="-1">认证要求 <a class="header-anchor" href="#认证要求" aria-label="Permalink to &quot;认证要求&quot;">​</a></h3><ul><li><strong>MUST</strong> 启用前验证钱包锁图案</li><li><strong>MUST</strong> 检查设备是否支持生物识别</li><li><strong>MUST</strong> 提供回退到图案锁的选项</li><li><strong>SHOULD</strong> 显示生物识别类型名称</li><li><strong>SHOULD</strong> 记录启用状态到安全存储</li></ul><hr><h2 id="转账确认规范" tabindex="-1">转账确认规范 <a class="header-anchor" href="#转账确认规范" aria-label="Permalink to &quot;转账确认规范&quot;">​</a></h2><h3 id="确认层级" tabindex="-1">确认层级 <a class="header-anchor" href="#确认层级" aria-label="Permalink to &quot;确认层级&quot;">​</a></h3><table tabindex="0"><thead><tr><th>操作</th><th>认证要求</th></tr></thead><tbody><tr><td>查看余额</td><td>无需认证</td></tr><tr><td>查看地址</td><td>无需认证</td></tr><tr><td>小额转账</td><td>生物识别</td></tr><tr><td>大额转账</td><td>图案锁</td></tr><tr><td>查看助记词</td><td>图案锁</td></tr><tr><td>删除钱包</td><td>图案锁</td></tr></tbody></table><h3 id="确认流程" tabindex="-1">确认流程 <a class="header-anchor" href="#确认流程" aria-label="Permalink to &quot;确认流程&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户发起转账</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>判断金额级别</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ├── 大额（&gt;阈值）──► 强制图案锁验证</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    └── 小额</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         ▼</span></span>
<span class="line"><span>    检查生物识别是否启用</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         ├── 已启用 ──► 生物识别验证</span></span>
<span class="line"><span>         │            │</span></span>
<span class="line"><span>         │            ├── 成功 ──► 执行转账</span></span>
<span class="line"><span>         │            │</span></span>
<span class="line"><span>         │            └── 失败 ──► 回退图案锁</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         └── 未启用 ──► 图案锁验证</span></span></code></pre></div><h3 id="大额阈值配置" tabindex="-1">大额阈值配置 <a class="header-anchor" href="#大额阈值配置" aria-label="Permalink to &quot;大额阈值配置&quot;">​</a></h3><ul><li><strong>SHOULD</strong> 支持用户自定义阈值</li><li><strong>SHOULD</strong> 按币种设置不同阈值</li><li><strong>MAY</strong> 提供建议阈值</li></ul><hr><h2 id="图案锁验证规范" tabindex="-1">图案锁验证规范 <a class="header-anchor" href="#图案锁验证规范" aria-label="Permalink to &quot;图案锁验证规范&quot;">​</a></h2><h3 id="验证方式" tabindex="-1">验证方式 <a class="header-anchor" href="#验证方式" aria-label="Permalink to &quot;验证方式&quot;">​</a></h3><p>通过尝试解密钱包助记词验证图案：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户绘制图案</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>使用图案派生解密密钥</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>尝试解密助记词</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ├── 解密失败 ──► 图案错误</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    └── 解密成功 ──► 图案正确</span></span></code></pre></div><h3 id="安全要求" tabindex="-1">安全要求 <a class="header-anchor" href="#安全要求" aria-label="Permalink to &quot;安全要求&quot;">​</a></h3><ul><li><strong>MUST</strong> 使用 AES-GCM 的认证标签验证</li><li><strong>MUST NOT</strong> 存储图案哈希值</li><li><strong>MUST NOT</strong> 在日志中记录图案</li><li><strong>SHOULD</strong> 限制连续错误次数</li><li><strong>MUST</strong> 最少连接 4 个点</li></ul><hr><h2 id="安全设置页面规范" tabindex="-1">安全设置页面规范 <a class="header-anchor" href="#安全设置页面规范" aria-label="Permalink to &quot;安全设置页面规范&quot;">​</a></h2><h3 id="设置项" tabindex="-1">设置项 <a class="header-anchor" href="#设置项" aria-label="Permalink to &quot;设置项&quot;">​</a></h3><table tabindex="0"><thead><tr><th>设置</th><th>类型</th><th>依赖</th></tr></thead><tbody><tr><td>钱包锁</td><td>开关</td><td>-</td></tr><tr><td>生物识别解锁</td><td>开关</td><td>钱包锁已启用</td></tr><tr><td>自动锁定时间</td><td>选择</td><td>钱包锁已启用</td></tr><tr><td>后台锁定</td><td>开关</td><td>钱包锁已启用</td></tr><tr><td>修改钱包锁</td><td>按钮</td><td>-</td></tr></tbody></table><h3 id="依赖关系" tabindex="-1">依赖关系 <a class="header-anchor" href="#依赖关系" aria-label="Permalink to &quot;依赖关系&quot;">​</a></h3><ul><li>生物识别解锁 <strong>MUST</strong> 在钱包锁启用后才能开启</li><li>关闭钱包锁 <strong>MUST</strong> 同时关闭生物识别</li><li>自动锁定时间 <strong>SHOULD</strong> 在钱包锁关闭时禁用</li></ul><hr><h2 id="钱包锁验证-ui-模式" tabindex="-1">钱包锁验证 UI 模式 <a class="header-anchor" href="#钱包锁验证-ui-模式" aria-label="Permalink to &quot;钱包锁验证 UI 模式&quot;">​</a></h2><p>本应用提供两种钱包锁验证的 UI 模式，需要根据使用场景选择合适的模式：</p><h3 id="页面级别验证-full-page" tabindex="-1">页面级别验证 (Full Page) <a class="header-anchor" href="#页面级别验证-full-page" aria-label="Permalink to &quot;页面级别验证 (Full Page)&quot;">​</a></h3><p><strong>适用场景：</strong></p><ul><li>验证是<strong>主要流程的一部分</strong>，用户预期会进入一个新页面</li><li>验证后有<strong>后续操作</strong>需要在同一页面完成</li><li>需要<strong>更多上下文信息</strong>展示</li></ul><p><strong>具体场景：</strong></p><table tabindex="0"><thead><tr><th>页面</th><th>说明</th></tr></thead><tbody><tr><td>修改钱包锁</td><td>验证当前图案 → 设置新图案（两步流程在同一页面）</td></tr><tr><td>管理钱包网络</td><td>选择网络 → 验证图案 → 保存（多步骤流程）</td></tr><tr><td>查看助记词</td><td>验证后需要在页面内展示助记词</td></tr></tbody></table><p><strong>UI 特征：</strong></p><ul><li>全屏页面，有返回按钮</li><li>可以有多个步骤</li><li>支持复杂的状态展示</li></ul><h3 id="底部抽屉验证-bottom-sheet" tabindex="-1">底部抽屉验证 (Bottom Sheet) <a class="header-anchor" href="#底部抽屉验证-bottom-sheet" aria-label="Permalink to &quot;底部抽屉验证 (Bottom Sheet)&quot;">​</a></h3><p><strong>适用场景：</strong></p><ul><li>验证是<strong>即时确认</strong>，用户只需要验证身份即可</li><li>验证后<strong>立即执行操作</strong>并关闭</li><li>需要<strong>保持上下文</strong>，不离开当前页面</li></ul><p><strong>具体场景：</strong></p><table tabindex="0"><thead><tr><th>场景</th><th>说明</th></tr></thead><tbody><tr><td>转账确认</td><td>用户在转账页面，弹出验证后执行转账</td></tr><tr><td>删除钱包</td><td>在钱包详情页，确认删除操作</td></tr><tr><td>二次签名设置</td><td>验证身份后立即执行链上操作</td></tr></tbody></table><p><strong>UI 特征：</strong></p><ul><li>底部弹出，支持手势关闭</li><li>单一步骤，验证成功后自动关闭</li><li>保持父页面可见</li></ul><h3 id="选择决策树" tabindex="-1">选择决策树 <a class="header-anchor" href="#选择决策树" aria-label="Permalink to &quot;选择决策树&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>需要钱包锁验证？</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>验证后是否有后续操作？</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ├── 是 ──► 验证后需要停留在页面操作？</span></span>
<span class="line"><span>    │         │</span></span>
<span class="line"><span>    │         ├── 是 ──► 使用【页面级别验证】</span></span>
<span class="line"><span>    │         │</span></span>
<span class="line"><span>    │         └── 否 ──► 使用【底部抽屉验证】</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    └── 否（即时确认）──► 使用【底部抽屉验证】</span></span></code></pre></div><h3 id="实现组件" tabindex="-1">实现组件 <a class="header-anchor" href="#实现组件" aria-label="Permalink to &quot;实现组件&quot;">​</a></h3><table tabindex="0"><thead><tr><th>模式</th><th>组件</th><th>路径</th></tr></thead><tbody><tr><td>页面级别</td><td><code>PatternLock</code></td><td>直接在页面中使用</td></tr><tr><td>底部抽屉</td><td><code>WalletLockConfirmJob</code></td><td><code>@/stackflow/activities/sheets</code></td></tr></tbody></table><h3 id="使用示例" tabindex="-1">使用示例 <a class="header-anchor" href="#使用示例" aria-label="Permalink to &quot;使用示例&quot;">​</a></h3><p><strong>页面级别验证：</strong></p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 在页面组件中直接使用 PatternLock</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PatternLock</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{pattern}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onChange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{setPattern}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onComplete</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{handleVerify}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{verifyError}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/&gt;</span></span></code></pre></div><p><strong>底部抽屉验证：</strong></p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置回调并推送 Sheet</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { setWalletLockConfirmCallback } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@/stackflow/activities/sheets&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setWalletLockConfirmCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">patternKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> isValid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> verifyPattern</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(encryptedMnemonic, patternKey);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isValid) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 执行操作</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> doSomething</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isValid;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WalletLockConfirmJob&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;验证钱包锁&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> });</span></span></code></pre></div><hr><h2 id="错误处理规范" tabindex="-1">错误处理规范 <a class="header-anchor" href="#错误处理规范" aria-label="Permalink to &quot;错误处理规范&quot;">​</a></h2><h3 id="认证错误" tabindex="-1">认证错误 <a class="header-anchor" href="#认证错误" aria-label="Permalink to &quot;认证错误&quot;">​</a></h3><table tabindex="0"><thead><tr><th>错误类型</th><th>处理方式</th></tr></thead><tbody><tr><td>图案错误</td><td>显示错误动画 + 清空输入</td></tr><tr><td>生物识别取消</td><td>显示图案锁</td></tr><tr><td>生物识别失败</td><td>提示重试或使用图案锁</td></tr><tr><td>生物识别锁定</td><td>强制使用图案锁</td></tr></tbody></table><h3 id="错误次数限制" tabindex="-1">错误次数限制 <a class="header-anchor" href="#错误次数限制" aria-label="Permalink to &quot;错误次数限制&quot;">​</a></h3><ul><li><strong>SHOULD</strong> 连续错误后增加延迟</li><li><strong>SHOULD</strong> 错误次数过多时临时锁定</li><li><strong>MAY</strong> 支持错误通知（邮件/推送）</li></ul><hr><h2 id="本章小结" tabindex="-1">本章小结 <a class="header-anchor" href="#本章小结" aria-label="Permalink to &quot;本章小结&quot;">​</a></h2><ul><li>支持图案锁和生物识别两种认证方式</li><li>自动锁定保护用户资产安全</li><li>生物识别提升日常使用便捷性</li><li>分层安全：日常操作用生物识别，敏感操作要图案锁</li><li>完善的错误处理和回退机制</li></ul>`,98)])])}const g=s(l,[["render",e]]);export{k as __pageData,g as default};
