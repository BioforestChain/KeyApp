import{_ as e,c as o,o as i,ag as t}from"./chunks/framework.B0we9iV-.js";const p=JSON.parse('{"title":"02. MiniApp 交易金额语义标准（Raw Amount Standard）","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/11-DApp-Guide/02-Connectivity/02-Amount-Semantics-Standard.md","filePath":"white-book/11-DApp-Guide/02-Connectivity/02-Amount-Semantics-Standard.md"}'),l={name:"white-book/11-DApp-Guide/02-Connectivity/02-Amount-Semantics-Standard.md"};function r(d,a,n,c,h,s){return i(),o("div",null,[...a[0]||(a[0]=[t('<h1 id="_02-miniapp-交易金额语义标准-raw-amount-standard" tabindex="-1">02. MiniApp 交易金额语义标准（Raw Amount Standard） <a class="header-anchor" href="#_02-miniapp-交易金额语义标准-raw-amount-standard" aria-label="Permalink to &quot;02. MiniApp 交易金额语义标准（Raw Amount Standard）&quot;">​</a></h1><blockquote><p>Last Updated: 2026-02-12<br> Status: Active（生态升级基线）</p></blockquote><p>本文定义 MiniApp 与 KeyApp 交互中所有“链上金额字段”的统一语义，避免“展示金额与真实广播金额不一致”的高风险问题。</p><hr><h2 id="_1-统一规则-必须遵守" tabindex="-1">1. 统一规则（必须遵守） <a class="header-anchor" href="#_1-统一规则-必须遵守" aria-label="Permalink to &quot;1. 统一规则（必须遵守）&quot;">​</a></h2><h3 id="_1-1-金额字段一律使用-raw-最小单位整数" tabindex="-1">1.1 金额字段一律使用 raw（最小单位整数） <a class="header-anchor" href="#_1-1-金额字段一律使用-raw-最小单位整数" aria-label="Permalink to &quot;1.1 金额字段一律使用 raw（最小单位整数）&quot;">​</a></h3><ul><li><code>amount</code> 必须是 <strong>十进制整数字符串</strong>（<code>^\\d+$</code>）</li><li>表示链最小单位（如 USDT 8 位精度时，<code>1000000000</code> 表示 <code>10.00000000</code>）</li><li>禁止传入格式化小数字符串（例如 <code>10.00000000</code>）</li></ul><h3 id="_1-2-展示与签名-广播职责分离" tabindex="-1">1.2 展示与签名/广播职责分离 <a class="header-anchor" href="#_1-2-展示与签名-广播职责分离" aria-label="Permalink to &quot;1.2 展示与签名/广播职责分离&quot;">​</a></h3><ul><li>展示层：根据 <code>decimals</code> 把 raw 转为人类可读金额</li><li>交易层：签名与广播始终使用 raw</li><li>严禁在显示修复时改动实际广播语义</li></ul><h3 id="_1-3-适用接口-第一批" tabindex="-1">1.3 适用接口（第一批） <a class="header-anchor" href="#_1-3-适用接口-第一批" aria-label="Permalink to &quot;1.3 适用接口（第一批）&quot;">​</a></h3><ul><li><code>bio_sendTransaction.params.amount</code></li><li><code>bio_createTransaction.params.amount</code></li><li><code>bio_destroyAsset.params.amount</code></li></ul><hr><h2 id="_2-风险背景-为什么必须统一" tabindex="-1">2. 风险背景（为什么必须统一） <a class="header-anchor" href="#_2-风险背景-为什么必须统一" aria-label="Permalink to &quot;2. 风险背景（为什么必须统一）&quot;">​</a></h2><p>当调用方把 raw 当 formatted，或 Host 把 formatted 当 raw，会导致：</p><ul><li>面板显示金额被放大/缩小（误导用户）</li><li>签名/广播金额与用户预期不一致</li><li>后端入库与链上数据出现语义冲突（含重复提交与对账困难）</li></ul><p>这是高风险交易语义问题，不是纯 UI 问题。</p><hr><h2 id="_3-当前审计结论-keyapp-内置应用" tabindex="-1">3. 当前审计结论（KeyApp 内置应用） <a class="header-anchor" href="#_3-当前审计结论-keyapp-内置应用" aria-label="Permalink to &quot;3. 当前审计结论（KeyApp 内置应用）&quot;">​</a></h2><h3 id="_3-1-已符合或基本符合" tabindex="-1">3.1 已符合或基本符合 <a class="header-anchor" href="#_3-1-已符合或基本符合" aria-label="Permalink to &quot;3.1 已符合或基本符合&quot;">​</a></h3><ul><li><code>xin.dweb.rwahub</code>：调用 <code>bio_sendTransaction</code> 前使用整数运算构造 raw（BigInt 路径）</li><li><code>xin.dweb.biobridge</code>（forge/redemption 主路径）：在有精度上下文时将用户输入转换为 raw 再调用</li></ul><h3 id="_3-2-需升级" tabindex="-1">3.2 需升级 <a class="header-anchor" href="#_3-2-需升级" aria-label="Permalink to &quot;3.2 需升级&quot;">​</a></h3><ul><li><code>xin.dweb.teleport</code>：当前 <code>bio_createTransaction</code> 调用路径仍可能传格式化小数字符串（示例：补 <code>.0</code>）</li></ul><h3 id="_3-3-host-侧需对齐项" tabindex="-1">3.3 Host 侧需对齐项 <a class="header-anchor" href="#_3-3-host-侧需对齐项" aria-label="Permalink to &quot;3.3 Host 侧需对齐项&quot;">​</a></h3><ul><li><code>bio_sendTransaction</code> 已按 raw 语义处理（现状）</li><li><code>bio_destroyAsset</code> 对话框仍存在 formatted 假设（需要改为 raw 语义）</li><li><code>bio_createTransaction</code> 当前存在“自动识别 raw/formatted”路径（应收敛为单一 raw 语义）</li></ul><hr><h2 id="_4-升级计划-执行顺序" tabindex="-1">4. 升级计划（执行顺序） <a class="header-anchor" href="#_4-升级计划-执行顺序" aria-label="Permalink to &quot;4. 升级计划（执行顺序）&quot;">​</a></h2><h3 id="phase-0-标准冻结-立即" tabindex="-1">Phase 0：标准冻结（立即） <a class="header-anchor" href="#phase-0-标准冻结-立即" aria-label="Permalink to &quot;Phase 0：标准冻结（立即）&quot;">​</a></h3><ul><li>白皮书明确 raw-only 规则（本文）</li><li>对外同步“禁止 formatted amount”</li></ul><h3 id="phase-1-host-收敛-优先" tabindex="-1">Phase 1：Host 收敛（优先） <a class="header-anchor" href="#phase-1-host-收敛-优先" aria-label="Permalink to &quot;Phase 1：Host 收敛（优先）&quot;">​</a></h3><ul><li><code>bio_destroyAsset</code> 切换为 raw 解析与展示</li><li><code>bio_createTransaction</code> 去除双语义自动判断，统一 raw-only</li><li>参数不合规时统一返回 <code>INVALID_PARAMS</code></li></ul><h3 id="phase-2-内置应用对齐" tabindex="-1">Phase 2：内置应用对齐 <a class="header-anchor" href="#phase-2-内置应用对齐" aria-label="Permalink to &quot;Phase 2：内置应用对齐&quot;">​</a></h3><ul><li>升级 <code>xin.dweb.teleport</code>，确保传入 raw</li><li>回归验证 <code>biobridge</code>、<code>rwahub</code> 多笔交易流程</li></ul><h3 id="phase-3-生态外部应用迁移" tabindex="-1">Phase 3：生态外部应用迁移 <a class="header-anchor" href="#phase-3-生态外部应用迁移" aria-label="Permalink to &quot;Phase 3：生态外部应用迁移&quot;">​</a></h3><ul><li>发布迁移窗口和截止版本</li><li>要求每个应用提交“amount 字段转换点”自检清单</li><li>逐步开启严格校验（不再接收 formatted）</li></ul><hr><h2 id="_5-测试与验收基线" tabindex="-1">5. 测试与验收基线 <a class="header-anchor" href="#_5-测试与验收基线" aria-label="Permalink to &quot;5. 测试与验收基线&quot;">​</a></h2><h3 id="_5-1-最小验收样例" tabindex="-1">5.1 最小验收样例 <a class="header-anchor" href="#_5-1-最小验收样例" aria-label="Permalink to &quot;5.1 最小验收样例&quot;">​</a></h3><ul><li>输入 <code>amount=&quot;1000000000&quot;</code>, <code>decimals=8</code>：展示 <code>10.00000000</code></li><li>输入 <code>amount=&quot;10.00000000&quot;</code>：直接 <code>INVALID_PARAMS</code>（严格模式）</li><li>广播上链金额必须保持 <code>raw=1000000000</code></li></ul><h3 id="_5-2-回归重点" tabindex="-1">5.2 回归重点 <a class="header-anchor" href="#_5-2-回归重点" aria-label="Permalink to &quot;5.2 回归重点&quot;">​</a></h3><ul><li>多笔交易队列（FIFO，不互相覆盖）</li><li>手势/支付密码步骤下金额不漂移</li><li>广播失败时状态文案与实际阶段一致</li></ul><hr><h2 id="_6-迁移沟通模板-摘要" tabindex="-1">6. 迁移沟通模板（摘要） <a class="header-anchor" href="#_6-迁移沟通模板-摘要" aria-label="Permalink to &quot;6. 迁移沟通模板（摘要）&quot;">​</a></h2><p>对生态方统一口径：</p><ol><li><code>amount</code> 改为 raw 整数字符串</li><li>UI 层自行处理 formatted ↔ raw</li><li>不再依赖 Host 自动兼容 formatted</li></ol><p>完整可执行提示词见：<code>/.chat/2026-02-12-miniapp-amount-raw-upgrade-plan.md</code></p>',45)])])}const m=e(l,[["render",r]]);export{p as __pageData,m as default};
