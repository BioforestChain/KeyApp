import{_ as a,c as s,o as n,ag as d}from"./chunks/framework.B0we9iV-.js";const b=JSON.parse('{"title":"监控告警篇","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/09-部署篇/04-监控告警/index.md","filePath":"white-book/09-部署篇/04-监控告警/index.md"}'),e={name:"white-book/09-部署篇/04-监控告警/index.md"};function r(p,t,l,i,h,o){return n(),s("div",null,[...t[0]||(t[0]=[d(`<h1 id="监控告警篇" tabindex="-1">监控告警篇 <a class="header-anchor" href="#监控告警篇" aria-label="Permalink to &quot;监控告警篇&quot;">​</a></h1><blockquote><p>定义应用埋点、指标监控和异常告警规范</p></blockquote><hr><h2 id="监控体系" tabindex="-1">监控体系 <a class="header-anchor" href="#监控体系" aria-label="Permalink to &quot;监控体系&quot;">​</a></h2><h3 id="监控层次" tabindex="-1">监控层次 <a class="header-anchor" href="#监控层次" aria-label="Permalink to &quot;监控层次&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                    业务监控                              │</span></span>
<span class="line"><span>│              用户行为、功能使用、转化率                    │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                    性能监控                              │</span></span>
<span class="line"><span>│            加载时间、响应时间、帧率、内存                  │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                    稳定性监控                            │</span></span>
<span class="line"><span>│              错误率、崩溃率、异常上报                      │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│                    可用性监控                            │</span></span>
<span class="line"><span>│              网络状态、服务可用性、节点健康                │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────┘</span></span></code></pre></div><hr><h2 id="埋点规范" tabindex="-1">埋点规范 <a class="header-anchor" href="#埋点规范" aria-label="Permalink to &quot;埋点规范&quot;">​</a></h2><h3 id="事件命名规范" tabindex="-1">事件命名规范 <a class="header-anchor" href="#事件命名规范" aria-label="Permalink to &quot;事件命名规范&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{namespace}_{action}_{target}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>示例:</span></span>
<span class="line"><span>wallet_create_success</span></span>
<span class="line"><span>wallet_create_fail</span></span>
<span class="line"><span>transfer_submit_click</span></span>
<span class="line"><span>transfer_confirm_success</span></span></code></pre></div><h3 id="事件分类" tabindex="-1">事件分类 <a class="header-anchor" href="#事件分类" aria-label="Permalink to &quot;事件分类&quot;">​</a></h3><table tabindex="0"><thead><tr><th>类型</th><th>前缀</th><th>说明</th></tr></thead><tbody><tr><td>页面浏览</td><td>page_</td><td>页面展示</td></tr><tr><td>用户行为</td><td>action_</td><td>点击、滑动等</td></tr><tr><td>业务事件</td><td>biz_</td><td>业务流程节点</td></tr><tr><td>系统事件</td><td>sys_</td><td>系统级事件</td></tr><tr><td>错误事件</td><td>error_</td><td>异常和错误</td></tr></tbody></table><h3 id="核心埋点列表" tabindex="-1">核心埋点列表 <a class="header-anchor" href="#核心埋点列表" aria-label="Permalink to &quot;核心埋点列表&quot;">​</a></h3><h4 id="钱包相关" tabindex="-1">钱包相关 <a class="header-anchor" href="#钱包相关" aria-label="Permalink to &quot;钱包相关&quot;">​</a></h4><table tabindex="0"><thead><tr><th>事件名</th><th>触发时机</th><th>参数</th></tr></thead><tbody><tr><td>wallet_create_start</td><td>开始创建钱包</td><td>-</td></tr><tr><td>wallet_create_success</td><td>创建成功</td><td>wallet_count</td></tr><tr><td>wallet_create_fail</td><td>创建失败</td><td>error_code</td></tr><tr><td>wallet_import_start</td><td>开始导入</td><td>import_type</td></tr><tr><td>wallet_import_success</td><td>导入成功</td><td>chain_count</td></tr><tr><td>wallet_import_fail</td><td>导入失败</td><td>error_code</td></tr><tr><td>wallet_backup_view</td><td>查看助记词</td><td>-</td></tr><tr><td>wallet_backup_verify</td><td>验证备份</td><td>success</td></tr><tr><td>wallet_delete</td><td>删除钱包</td><td>-</td></tr></tbody></table><h4 id="转账相关" tabindex="-1">转账相关 <a class="header-anchor" href="#转账相关" aria-label="Permalink to &quot;转账相关&quot;">​</a></h4><table tabindex="0"><thead><tr><th>事件名</th><th>触发时机</th><th>参数</th></tr></thead><tbody><tr><td>transfer_start</td><td>进入转账页</td><td>chain_id</td></tr><tr><td>transfer_scan_qr</td><td>扫码填充地址</td><td>-</td></tr><tr><td>transfer_paste_address</td><td>粘贴地址</td><td>-</td></tr><tr><td>transfer_submit</td><td>提交转账</td><td>amount, chain_id</td></tr><tr><td>transfer_confirm</td><td>确认转账</td><td>-</td></tr><tr><td>transfer_success</td><td>转账成功</td><td>tx_hash, duration</td></tr><tr><td>transfer_fail</td><td>转账失败</td><td>error_code</td></tr></tbody></table><h4 id="认证相关" tabindex="-1">认证相关 <a class="header-anchor" href="#认证相关" aria-label="Permalink to &quot;认证相关&quot;">​</a></h4><table tabindex="0"><thead><tr><th>事件名</th><th>触发时机</th><th>参数</th></tr></thead><tbody><tr><td>auth_pattern_attempt</td><td>图案验证尝试</td><td>-</td></tr><tr><td>auth_pattern_success</td><td>图案验证成功</td><td>-</td></tr><tr><td>auth_pattern_fail</td><td>图案验证失败</td><td>attempt_count</td></tr><tr><td>auth_biometric_attempt</td><td>生物识别尝试</td><td>type</td></tr><tr><td>auth_biometric_success</td><td>生物识别成功</td><td>type</td></tr><tr><td>auth_biometric_fail</td><td>生物识别失败</td><td>type, reason</td></tr></tbody></table><h3 id="埋点数据结构" tabindex="-1">埋点数据结构 <a class="header-anchor" href="#埋点数据结构" aria-label="Permalink to &quot;埋点数据结构&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>TrackEvent {</span></span>
<span class="line"><span>  // 必需字段</span></span>
<span class="line"><span>  eventName: string</span></span>
<span class="line"><span>  timestamp: number</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 用户标识（匿名化）</span></span>
<span class="line"><span>  sessionId: string</span></span>
<span class="line"><span>  deviceId: string</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 环境信息</span></span>
<span class="line"><span>  platform: string</span></span>
<span class="line"><span>  appVersion: string</span></span>
<span class="line"><span>  osVersion: string</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 事件参数</span></span>
<span class="line"><span>  params?: object</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 性能数据</span></span>
<span class="line"><span>  duration?: number</span></span>
<span class="line"><span>}</span></span></code></pre></div><hr><h2 id="性能指标" tabindex="-1">性能指标 <a class="header-anchor" href="#性能指标" aria-label="Permalink to &quot;性能指标&quot;">​</a></h2><h3 id="关键指标定义" tabindex="-1">关键指标定义 <a class="header-anchor" href="#关键指标定义" aria-label="Permalink to &quot;关键指标定义&quot;">​</a></h3><table tabindex="0"><thead><tr><th>指标</th><th>计算方式</th><th>告警阈值</th></tr></thead><tbody><tr><td>FCP P95</td><td>首次内容绘制 95 分位</td><td>&gt; 2s</td></tr><tr><td>LCP P95</td><td>最大内容绘制 95 分位</td><td>&gt; 3s</td></tr><tr><td>API P95</td><td>API 响应时间 95 分位</td><td>&gt; 3s</td></tr><tr><td>Error Rate</td><td>错误数/总请求数</td><td>&gt; 1%</td></tr><tr><td>Crash Rate</td><td>崩溃会话/总会话</td><td>&gt; 0.1%</td></tr></tbody></table><h3 id="性能数据采集" tabindex="-1">性能数据采集 <a class="header-anchor" href="#性能数据采集" aria-label="Permalink to &quot;性能数据采集&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>PerformanceMetric {</span></span>
<span class="line"><span>  name: string           // 指标名</span></span>
<span class="line"><span>  value: number          // 指标值</span></span>
<span class="line"><span>  unit: string           // 单位</span></span>
<span class="line"><span>  tags: object           // 标签</span></span>
<span class="line"><span>  timestamp: number</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="采集的性能数据" tabindex="-1">采集的性能数据 <a class="header-anchor" href="#采集的性能数据" aria-label="Permalink to &quot;采集的性能数据&quot;">​</a></h3><table tabindex="0"><thead><tr><th>数据</th><th>采集时机</th><th>说明</th></tr></thead><tbody><tr><td>页面加载时间</td><td>页面 load</td><td>FCP, LCP, TTI</td></tr><tr><td>API 响应时间</td><td>请求完成</td><td>每个 API</td></tr><tr><td>长任务</td><td>performance observer</td><td>&gt; 50ms 的任务</td></tr><tr><td>内存使用</td><td>定时采集</td><td>每分钟</td></tr><tr><td>帧率</td><td>动画/滚动时</td><td>低于 50fps 时</td></tr></tbody></table><hr><h2 id="错误监控" tabindex="-1">错误监控 <a class="header-anchor" href="#错误监控" aria-label="Permalink to &quot;错误监控&quot;">​</a></h2><h3 id="错误采集" tabindex="-1">错误采集 <a class="header-anchor" href="#错误采集" aria-label="Permalink to &quot;错误采集&quot;">​</a></h3><table tabindex="0"><thead><tr><th>错误类型</th><th>采集方式</th></tr></thead><tbody><tr><td>JS 异常</td><td>window.onerror</td></tr><tr><td>Promise 异常</td><td>unhandledrejection</td></tr><tr><td>资源加载失败</td><td>error 事件</td></tr><tr><td>API 错误</td><td>请求拦截器</td></tr><tr><td>业务错误</td><td>手动上报</td></tr></tbody></table><h3 id="错误数据结构" tabindex="-1">错误数据结构 <a class="header-anchor" href="#错误数据结构" aria-label="Permalink to &quot;错误数据结构&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ErrorReport {</span></span>
<span class="line"><span>  // 错误信息</span></span>
<span class="line"><span>  type: string</span></span>
<span class="line"><span>  message: string</span></span>
<span class="line"><span>  stack?: string</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 上下文</span></span>
<span class="line"><span>  page: string</span></span>
<span class="line"><span>  action?: string</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 用户信息</span></span>
<span class="line"><span>  sessionId: string</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 环境</span></span>
<span class="line"><span>  platform: string</span></span>
<span class="line"><span>  appVersion: string</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 时间</span></span>
<span class="line"><span>  timestamp: number</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="错误聚合规则" tabindex="-1">错误聚合规则 <a class="header-anchor" href="#错误聚合规则" aria-label="Permalink to &quot;错误聚合规则&quot;">​</a></h3><table tabindex="0"><thead><tr><th>聚合维度</th><th>说明</th></tr></thead><tbody><tr><td>错误类型 + 消息</td><td>同类错误合并</td></tr><tr><td>页面</td><td>按页面分组</td></tr><tr><td>版本</td><td>按应用版本分组</td></tr><tr><td>时间窗口</td><td>5 分钟窗口</td></tr></tbody></table><hr><h2 id="告警规则" tabindex="-1">告警规则 <a class="header-anchor" href="#告警规则" aria-label="Permalink to &quot;告警规则&quot;">​</a></h2><h3 id="告警级别" tabindex="-1">告警级别 <a class="header-anchor" href="#告警级别" aria-label="Permalink to &quot;告警级别&quot;">​</a></h3><table tabindex="0"><thead><tr><th>级别</th><th>说明</th><th>响应时间</th></tr></thead><tbody><tr><td>P0 Critical</td><td>核心功能不可用</td><td>立即</td></tr><tr><td>P1 Major</td><td>重要功能受影响</td><td>30 分钟</td></tr><tr><td>P2 Minor</td><td>次要功能异常</td><td>4 小时</td></tr><tr><td>P3 Warning</td><td>预警，暂无影响</td><td>24 小时</td></tr></tbody></table><h3 id="告警规则配置" tabindex="-1">告警规则配置 <a class="header-anchor" href="#告警规则配置" aria-label="Permalink to &quot;告警规则配置&quot;">​</a></h3><table tabindex="0"><thead><tr><th>指标</th><th>P0 阈值</th><th>P1 阈值</th><th>P2 阈值</th></tr></thead><tbody><tr><td>Error Rate</td><td>&gt; 5%</td><td>&gt; 2%</td><td>&gt; 1%</td></tr><tr><td>Crash Rate</td><td>&gt; 1%</td><td>&gt; 0.5%</td><td>&gt; 0.1%</td></tr><tr><td>API P95</td><td>&gt; 10s</td><td>&gt; 5s</td><td>&gt; 3s</td></tr><tr><td>转账失败率</td><td>&gt; 10%</td><td>&gt; 5%</td><td>&gt; 2%</td></tr></tbody></table><h3 id="告警抑制" tabindex="-1">告警抑制 <a class="header-anchor" href="#告警抑制" aria-label="Permalink to &quot;告警抑制&quot;">​</a></h3><table tabindex="0"><thead><tr><th>规则</th><th>说明</th></tr></thead><tbody><tr><td>相同告警 5 分钟内不重复</td><td>避免告警风暴</td></tr><tr><td>恢复后自动关闭</td><td>自愈处理</td></tr><tr><td>静默时间段</td><td>维护窗口</td></tr></tbody></table><hr><h2 id="数据上报" tabindex="-1">数据上报 <a class="header-anchor" href="#数据上报" aria-label="Permalink to &quot;数据上报&quot;">​</a></h2><h3 id="上报策略" tabindex="-1">上报策略 <a class="header-anchor" href="#上报策略" aria-label="Permalink to &quot;上报策略&quot;">​</a></h3><table tabindex="0"><thead><tr><th>数据类型</th><th>上报方式</th><th>频率</th></tr></thead><tbody><tr><td>埋点事件</td><td>批量上报</td><td>每 30s 或 20 条</td></tr><tr><td>性能数据</td><td>批量上报</td><td>每 60s</td></tr><tr><td>错误数据</td><td>即时上报</td><td>P0/P1 错误</td></tr><tr><td>心跳数据</td><td>定时上报</td><td>每 5 分钟</td></tr></tbody></table><h3 id="上报数据结构" tabindex="-1">上报数据结构 <a class="header-anchor" href="#上报数据结构" aria-label="Permalink to &quot;上报数据结构&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ReportPayload {</span></span>
<span class="line"><span>  // 批次信息</span></span>
<span class="line"><span>  batchId: string</span></span>
<span class="line"><span>  reportTime: number</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 设备信息</span></span>
<span class="line"><span>  deviceInfo: DeviceInfo</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 数据</span></span>
<span class="line"><span>  events?: TrackEvent[]</span></span>
<span class="line"><span>  metrics?: PerformanceMetric[]</span></span>
<span class="line"><span>  errors?: ErrorReport[]</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="上报失败处理" tabindex="-1">上报失败处理 <a class="header-anchor" href="#上报失败处理" aria-label="Permalink to &quot;上报失败处理&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>上报失败</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>存入本地队列</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>等待下次上报（最多重试 3 次）</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ├── 成功 ──► 清除队列</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    └── 仍失败 ──► 丢弃旧数据（保留最近 100 条）</span></span></code></pre></div><hr><h2 id="用户隐私" tabindex="-1">用户隐私 <a class="header-anchor" href="#用户隐私" aria-label="Permalink to &quot;用户隐私&quot;">​</a></h2><h3 id="数据脱敏" tabindex="-1">数据脱敏 <a class="header-anchor" href="#数据脱敏" aria-label="Permalink to &quot;数据脱敏&quot;">​</a></h3><table tabindex="0"><thead><tr><th>数据类型</th><th>脱敏方式</th></tr></thead><tbody><tr><td>钱包地址</td><td>保留前 6 + 后 4 位</td></tr><tr><td>交易金额</td><td>不采集具体金额</td></tr><tr><td>设备 ID</td><td>哈希后存储</td></tr><tr><td>IP 地址</td><td>不采集</td></tr></tbody></table><h3 id="采集开关" tabindex="-1">采集开关 <a class="header-anchor" href="#采集开关" aria-label="Permalink to &quot;采集开关&quot;">​</a></h3><ul><li><strong>MUST</strong> 提供关闭数据采集的选项</li><li><strong>MUST</strong> 首次使用时告知用户</li><li><strong>SHOULD</strong> 允许用户查看采集的数据</li><li><strong>MUST NOT</strong> 采集敏感信息</li></ul><hr><h2 id="dashboard-指标" tabindex="-1">Dashboard 指标 <a class="header-anchor" href="#dashboard-指标" aria-label="Permalink to &quot;Dashboard 指标&quot;">​</a></h2><h3 id="核心看板" tabindex="-1">核心看板 <a class="header-anchor" href="#核心看板" aria-label="Permalink to &quot;核心看板&quot;">​</a></h3><table tabindex="0"><thead><tr><th>指标</th><th>说明</th><th>更新频率</th></tr></thead><tbody><tr><td>DAU</td><td>日活用户数</td><td>实时</td></tr><tr><td>新增用户</td><td>当日新创建钱包</td><td>实时</td></tr><tr><td>转账成功率</td><td>成功/总数</td><td>实时</td></tr><tr><td>API 可用性</td><td>成功请求占比</td><td>实时</td></tr><tr><td>错误趋势</td><td>错误数时间序列</td><td>1 分钟</td></tr></tbody></table><h3 id="业务看板" tabindex="-1">业务看板 <a class="header-anchor" href="#业务看板" aria-label="Permalink to &quot;业务看板&quot;">​</a></h3><table tabindex="0"><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td>创建钱包转化率</td><td>完成创建/开始创建</td></tr><tr><td>转账完成率</td><td>确认/发起</td></tr><tr><td>功能使用分布</td><td>各功能使用占比</td></tr><tr><td>链使用分布</td><td>各链交易占比</td></tr></tbody></table><hr><h2 id="本章小结" tabindex="-1">本章小结 <a class="header-anchor" href="#本章小结" aria-label="Permalink to &quot;本章小结&quot;">​</a></h2><ul><li>四层监控体系：业务、性能、稳定性、可用性</li><li>统一的埋点命名和数据结构规范</li><li>分级告警机制，快速响应问题</li><li>批量上报 + 本地缓存保证数据不丢失</li><li>严格的用户隐私保护</li></ul>`,68)])])}const u=a(e,[["render",r]]);export{b as __pageData,u as default};
