import{_ as n,c as t,o as l,ag as a,j as s}from"./chunks/framework.B0we9iV-.js";const g=JSON.parse('{"title":"链服务实现规范","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/04-服务篇/02-链服务/实现规范/index.md","filePath":"white-book/04-服务篇/02-链服务/实现规范/index.md"}'),e={name:"white-book/04-服务篇/02-链服务/实现规范/index.md"};function h(p,i,k,d,r,o){return l(),t("div",null,[...i[0]||(i[0]=[a(`<h1 id="链服务实现规范" tabindex="-1">链服务实现规范 <a class="header-anchor" href="#链服务实现规范" aria-label="Permalink to &quot;链服务实现规范&quot;">​</a></h1><blockquote><p>各链适配器的具体实现要求</p></blockquote><hr><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>本文档定义各链适配器的实现规范，补充接口定义中未涵盖的链特有逻辑。</p><hr><h2 id="架构层次" tabindex="-1">架构层次 <a class="header-anchor" href="#架构层次" aria-label="Permalink to &quot;架构层次&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                    chain-adapter                        │</span></span>
<span class="line"><span>│              (统一的链适配器接口)                        │</span></span>
<span class="line"><span>└────────────────────────┬────────────────────────────────┘</span></span>
<span class="line"><span>                         │</span></span>
<span class="line"><span>         ┌───────────────┴───────────────┐</span></span>
<span class="line"><span>         │                               │</span></span>
<span class="line"><span>         ▼                               ▼</span></span>
<span class="line"><span>┌─────────────────────┐       ┌─────────────────────┐</span></span>
<span class="line"><span>│  内部依赖 (SDK)      │       │  外部依赖 (API)      │</span></span>
<span class="line"><span>│  services/*-sdk/    │       │  apis/bnqkl_wallet/ │</span></span>
<span class="line"><span>├─────────────────────┤       ├─────────────────────┤</span></span>
<span class="line"><span>│ • 密钥派生           │       │ • 余额查询          │</span></span>
<span class="line"><span>│ • 交易构建           │       │ • 区块信息          │</span></span>
<span class="line"><span>│ • 交易签名           │       │ • 交易广播          │</span></span>
<span class="line"><span>│ • 密码验证           │       │ • 交易历史          │</span></span>
<span class="line"><span>│ (本地计算)           │       │ (网络请求)          │</span></span>
<span class="line"><span>└─────────────────────┘       └─────────────────────┘</span></span></code></pre></div><p><strong>内部依赖</strong> (<code>services/bioforest-sdk/</code>)：</p><ul><li>链核心逻辑的本地实现</li><li>不可替换，是 chain-adapter 的底层支柱</li><li><strong>必须自主完备</strong>：对外暴露完整 API，内部封装外部依赖</li><li>其他 service 只能依赖内部 SDK，不能直接依赖外部 API</li></ul><p><strong>外部依赖</strong> (<code>apis/bnqkl_wallet/</code>)：</p><ul><li>第三方 API 服务的封装</li><li>可替换（如切换 RPC 节点）</li><li><strong>只被内部 SDK 使用</strong>，不被其他 service 直接依赖</li></ul><hr><h2 id="适配器架构" tabindex="-1">适配器架构 <a class="header-anchor" href="#适配器架构" aria-label="Permalink to &quot;适配器架构&quot;">​</a></h2><h3 id="基础接口" tabindex="-1">基础接口 <a class="header-anchor" href="#基础接口" aria-label="Permalink to &quot;基础接口&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IChainAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> chainId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> chainType</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChainConfigType</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // &#39;bioforest&#39; | &#39;evm&#39; | &#39;bip39&#39; | &#39;custom&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 核心服务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> identity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IIdentityService</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> asset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IAssetService</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ITransactionService</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> chain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IChainService</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 可选服务</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  readonly</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> staking</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IStakingService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 生命周期</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  initialize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChainConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  dispose</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="适配器注册" tabindex="-1">适配器注册 <a class="header-anchor" href="#适配器注册" aria-label="Permalink to &quot;适配器注册&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IAdapterRegistry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  register</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChainConfigType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">factory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AdapterFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">chainId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IChainAdapter</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  hasAdapter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">chainId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AdapterFactory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChainConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IChainAdapter</span></span></code></pre></div><hr><h2 id="bioforest-链" tabindex="-1">BioForest 链 <a class="header-anchor" href="#bioforest-链" aria-label="Permalink to &quot;BioForest 链&quot;">​</a></h2><p>适用于：BFMeta, CCChain, PMChain, BFChainV2, BTGMeta, BIWMeta, ETHMeta, Malibu</p><h3 id="密钥派生" tabindex="-1">密钥派生 <a class="header-anchor" href="#密钥派生" aria-label="Permalink to &quot;密钥派生&quot;">​</a></h3><table tabindex="0"><thead><tr><th>项目</th><th>规范</th></tr></thead><tbody><tr><td>算法</td><td>Ed25519</td></tr><tr><td>种子生成</td><td>SHA256(secret) → 32 bytes</td></tr><tr><td>地址格式</td><td>{prefix} + Base58Check(RIPEMD160(SHA256(publicKey)))</td></tr><tr><td>默认前缀</td><td><code>b</code></td></tr></tbody></table><h3 id="交易类型" tabindex="-1">交易类型 <a class="header-anchor" href="#交易类型" aria-label="Permalink to &quot;交易类型&quot;">​</a></h3><table tabindex="0"><thead><tr><th>类型</th><th>用途</th><th>手续费基准</th></tr></thead><tbody><tr><td>转账</td><td>原生代币/资产转移</td><td>动态（链上查询）</td></tr><tr><td>设置交易密码</td><td>启用二次签名</td><td>固定</td></tr><tr><td>资产销毁</td><td>销毁代币</td><td>动态</td></tr></tbody></table><h3 id="交易密码-二次签名" tabindex="-1">交易密码（二次签名） <a class="header-anchor" href="#交易密码-二次签名" aria-label="Permalink to &quot;交易密码（二次签名）&quot;">​</a></h3><p>BioForest 链支持可选的交易密码机制：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>交易创建流程:</span></span>
<span class="line"><span>1. 检查地址是否启用交易密码</span></span>
<span class="line"><span>2. 如已启用，签名时需提供 paySecret</span></span>
<span class="line"><span>3. 交易体包含 signSignature 字段</span></span></code></pre></div><h3 id="api-端点" tabindex="-1">API 端点 <a class="header-anchor" href="#api-端点" aria-label="Permalink to &quot;API 端点&quot;">​</a></h3><table tabindex="0"><thead><tr><th>接口</th><th>路径</th><th>说明</th></tr></thead><tbody><tr><td>余额查询</td><td><code>/wallet/{chain}/address/balance</code></td><td>查询地址余额</td></tr><tr><td>地址信息</td><td><code>/wallet/{chain}/address/info</code></td><td>查询地址详情（含二次签名状态）</td></tr><tr><td>交易广播</td><td><code>/wallet/{chain}/transactions/broadcast</code></td><td>广播签名交易</td></tr><tr><td>交易查询</td><td><code>/wallet/{chain}/transactions/query</code></td><td>查询历史交易</td></tr><tr><td>手续费查询</td><td><code>/wallet/{chain}/blockAveFee</code></td><td>获取建议手续费</td></tr></tbody></table><h3 id="特殊处理" tabindex="-1">特殊处理 <a class="header-anchor" href="#特殊处理" aria-label="Permalink to &quot;特殊处理&quot;">​</a></h3><ul><li><strong>MUST</strong> 检查地址是否冻结（isFreezed）</li><li><strong>MUST</strong> 处理交易密码验证</li><li><strong>SHOULD</strong> 缓存区块高度用于交易构建</li></ul><h3 id="sdk-集成" tabindex="-1">SDK 集成 <a class="header-anchor" href="#sdk-集成" aria-label="Permalink to &quot;SDK 集成&quot;">​</a></h3><p>BioForest 链使用 <code>@bfchain/core</code> SDK 进行交易创建和签名。SDK 采用源代码集成 + 延迟加载架构。</p><h4 id="目录结构" tabindex="-1">目录结构 <a class="header-anchor" href="#目录结构" aria-label="Permalink to &quot;目录结构&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">src</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">services</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bioforest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sdk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├── index.ts              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// SDK 高层 API（公开接口）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├── types.ts              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 类型定义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">├── genesis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">block.json    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创世块配置（~544KB，延迟加载）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">└── internal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             // SDK 核心实现（从 @btgmeta-bundle 迁移）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ├── index.ts          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// setup() 入口函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ├── core</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             // 核心类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    │   ├── @type.ts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    │   ├── const.ts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    │   └── core.ts       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// BTGMetaBundleCore 类</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    └── transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 交易控制器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ├── @type.ts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ├── index.ts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ├── controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">base.ts  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 基础交易控制器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ├── core.ts             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 核心交易逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        └── exchange.ts         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 交换交易逻辑</span></span></code></pre></div><h4 id="延迟加载架构" tabindex="-1">延迟加载架构 <a class="header-anchor" href="#延迟加载架构" aria-label="Permalink to &quot;延迟加载架构&quot;">​</a></h4><p>SDK 体积较大（~1MB），<strong>MUST</strong> 使用 <code>await import()</code> 延迟加载，避免影响首屏性能：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ 错误：静态导入会打包进主 bundle</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { setup } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./internal&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ 正确：动态导入，按需加载</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getBioforestCore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">BioforestChainBundleCore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">genesis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./internal&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./genesis-block.json&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(genesis.default, cryptoHelper, customRemark)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="构建产物分析" tabindex="-1">构建产物分析 <a class="header-anchor" href="#构建产物分析" aria-label="Permalink to &quot;构建产物分析&quot;">​</a></h4><table tabindex="0"><thead><tr><th>Chunk</th><th>大小</th><th>加载时机</th></tr></thead><tbody><tr><td>index.js</td><td>~1.3MB</td><td>首屏加载</td></tr><tr><td>bioforest-sdk-internal.js</td><td>~983KB</td><td>创建交易时延迟加载</td></tr><tr><td>genesis-block.js</td><td>~544KB</td><td>创建交易时延迟加载</td></tr></tbody></table><h4 id="依赖关系" tabindex="-1">依赖关系 <a class="header-anchor" href="#依赖关系" aria-label="Permalink to &quot;依赖关系&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@bfchain/core         # BioForest 链核心库（npm 包）</span></span>
<span class="line"><span>├── @bfchain/util     # 工具函数</span></span>
<span class="line"><span>└── buffer            # Buffer polyfill（已在 vite.config.ts 全局配置）</span></span></code></pre></div><h4 id="关键函数" tabindex="-1">关键函数 <a class="header-anchor" href="#关键函数" aria-label="Permalink to &quot;关键函数&quot;">​</a></h4><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 高层 API（src/services/bioforest-sdk/index.ts）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createTransferTransaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params)   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 创建转账交易</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">broadcastTransaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rpcUrl, tx)    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 广播交易</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAddressInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rpcUrl, address)     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取地址信息（含二次签名状态）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">verifyPayPassword</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(secret, pay, pk)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 验证交易密码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setPayPassword</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params)              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置交易密码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 底层 API（通过 getBioforestCore() 获取）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">core.transactionController.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createTransferTransactionJSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">core.transactionController.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createSignatureTransactionJSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">core.transactionController.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getTransferTransactionMinFee</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">core.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">accountBaseHelper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createSecondSecretKeypairV2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><h3 id="交易密码流程" tabindex="-1">交易密码流程 <a class="header-anchor" href="#交易密码流程" aria-label="Permalink to &quot;交易密码流程&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户发起转账</span></span>
<span class="line"><span>       │</span></span>
<span class="line"><span>       ▼</span></span>
<span class="line"><span>getAddressInfo() 检查 secondPublicKey</span></span>
<span class="line"><span>       │</span></span>
<span class="line"><span>       ├─ 无 secondPublicKey → 直接签名</span></span>
<span class="line"><span>       │</span></span>
<span class="line"><span>       └─ 有 secondPublicKey → 需要交易密码</span></span>
<span class="line"><span>              │</span></span>
<span class="line"><span>              ▼</span></span>
<span class="line"><span>       用户输入交易密码</span></span>
<span class="line"><span>              │</span></span>
<span class="line"><span>              ▼</span></span>
<span class="line"><span>       verifyPayPassword() 验证</span></span>
<span class="line"><span>              │</span></span>
<span class="line"><span>              ├─ 失败 → 提示错误</span></span>
<span class="line"><span>              │</span></span>
<span class="line"><span>              └─ 成功 → 使用 paySecret 签名</span></span>
<span class="line"><span>                     │</span></span>
<span class="line"><span>                     ▼</span></span>
<span class="line"><span>              createTransferTransaction()</span></span>
<span class="line"><span>                     │</span></span>
<span class="line"><span>                     ▼</span></span>
<span class="line"><span>              broadcastTransaction()</span></span></code></pre></div><hr><h2 id="evm-链" tabindex="-1">EVM 链 <a class="header-anchor" href="#evm-链" aria-label="Permalink to &quot;EVM 链&quot;">​</a></h2><p>适用于：Ethereum, BSC, Polygon 等 EVM 兼容链</p><h3 id="密钥派生-1" tabindex="-1">密钥派生 <a class="header-anchor" href="#密钥派生-1" aria-label="Permalink to &quot;密钥派生&quot;">​</a></h3>`,51),s("table",{tabindex:"0"},[s("thead",null,[s("tr",null,[s("th",null,"项目"),s("th",null,"规范")])]),s("tbody",null,[s("tr",null,[s("td",null,"算法"),s("td",null,"secp256k1")]),s("tr",null,[s("td",null,"派生路径"),s("td",{index:""},"m/44'/60'/0'/0/")]),s("tr",null,[s("td",null,"地址格式"),s("td",null,"0x + Keccak256(publicKey)[12:32]")]),s("tr",null,[s("td",null,"Checksum"),s("td",null,"EIP-55 大小写校验")])])],-1),a(`<h3 id="gas-估算" tabindex="-1">Gas 估算 <a class="header-anchor" href="#gas-估算" aria-label="Permalink to &quot;Gas 估算&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GasEstimate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  gasLimit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bigint</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 执行上限</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  gasPrice</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bigint</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Legacy 模式</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  maxFeePerGas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bigint</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // EIP-1559 模式</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  maxPriorityFeePerGas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bigint</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="手续费档位" tabindex="-1">手续费档位 <a class="header-anchor" href="#手续费档位" aria-label="Permalink to &quot;手续费档位&quot;">​</a></h3><table tabindex="0"><thead><tr><th>档位</th><th>说明</th><th>时间预估</th></tr></thead><tbody><tr><td>slow</td><td>基础价格 × 1.0</td><td>~1 分钟</td></tr><tr><td>standard</td><td>基础价格 × 1.5</td><td>~30 秒</td></tr><tr><td>fast</td><td>基础价格 × 2.0</td><td>~15 秒</td></tr></tbody></table><h3 id="代币转账-erc-20" tabindex="-1">代币转账（ERC-20） <a class="header-anchor" href="#代币转账-erc-20" aria-label="Permalink to &quot;代币转账（ERC-20）&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 构建 transfer(to, amount) 调用数据</span></span>
<span class="line"><span>2. 估算 Gas（合约调用通常 ~65,000）</span></span>
<span class="line"><span>3. 设置 to = 合约地址</span></span>
<span class="line"><span>4. 设置 value = 0</span></span>
<span class="line"><span>5. 设置 data = 编码后的调用数据</span></span></code></pre></div><h3 id="特殊处理-1" tabindex="-1">特殊处理 <a class="header-anchor" href="#特殊处理-1" aria-label="Permalink to &quot;特殊处理&quot;">​</a></h3><ul><li><strong>MUST</strong> 自动检测 EIP-1559 支持</li><li><strong>MUST</strong> 正确处理 nonce 冲突</li><li><strong>SHOULD</strong> 预留 20% Gas 余量</li></ul><hr><h2 id="tron-链" tabindex="-1">Tron 链 <a class="header-anchor" href="#tron-链" aria-label="Permalink to &quot;Tron 链&quot;">​</a></h2><h3 id="密钥派生-2" tabindex="-1">密钥派生 <a class="header-anchor" href="#密钥派生-2" aria-label="Permalink to &quot;密钥派生&quot;">​</a></h3>`,11),s("table",{tabindex:"0"},[s("thead",null,[s("tr",null,[s("th",null,"项目"),s("th",null,"规范")])]),s("tbody",null,[s("tr",null,[s("td",null,"算法"),s("td",null,"secp256k1")]),s("tr",null,[s("td",null,"派生路径"),s("td",{index:""},"m/44'/195'/0'/0/")]),s("tr",null,[s("td",null,"地址格式"),s("td",null,"Base58Check(0x41 + Keccak256(publicKey)[12:32])")]),s("tr",null,[s("td",null,"地址前缀"),s("td",null,"T")])])],-1),a(`<h3 id="资源模型" tabindex="-1">资源模型 <a class="header-anchor" href="#资源模型" aria-label="Permalink to &quot;资源模型&quot;">​</a></h3><p>Tron 使用带宽和能量而非 Gas：</p><table tabindex="0"><thead><tr><th>资源</th><th>用途</th><th>获取方式</th></tr></thead><tbody><tr><td>带宽</td><td>普通交易</td><td>免费额度 / 冻结 TRX</td></tr><tr><td>能量</td><td>智能合约</td><td>冻结 TRX</td></tr></tbody></table><h3 id="手续费估算" tabindex="-1">手续费估算 <a class="header-anchor" href="#手续费估算" aria-label="Permalink to &quot;手续费估算&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TronFeeEstimate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  bandwidth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     // 所需带宽</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  energy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 所需能量（合约调用）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  feeLimit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bigint</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // 最大费用（SUN）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  activationFee</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bigint</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 地址激活费（1.1 TRX）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="地址激活" tabindex="-1">地址激活 <a class="header-anchor" href="#地址激活" aria-label="Permalink to &quot;地址激活&quot;">​</a></h3><ul><li><strong>MUST</strong> 检查目标地址是否已激活</li><li><strong>MUST</strong> 未激活地址首次转入需额外 1.1 TRX</li><li><strong>SHOULD</strong> 在 UI 提示用户激活费用</li></ul><h3 id="trc-20-转账" tabindex="-1">TRC-20 转账 <a class="header-anchor" href="#trc-20-转账" aria-label="Permalink to &quot;TRC-20 转账&quot;">​</a></h3><p>类似 ERC-20，但需注意：</p><ul><li>能量消耗通常 10,000-30,000</li><li>需预估 feeLimit 防止失败</li></ul><hr><h2 id="bitcoin-链" tabindex="-1">Bitcoin 链 <a class="header-anchor" href="#bitcoin-链" aria-label="Permalink to &quot;Bitcoin 链&quot;">​</a></h2><h3 id="密钥派生-3" tabindex="-1">密钥派生 <a class="header-anchor" href="#密钥派生-3" aria-label="Permalink to &quot;密钥派生&quot;">​</a></h3><table tabindex="0"><thead><tr><th>项目</th><th>规范</th></tr></thead><tbody><tr><td>算法</td><td>secp256k1</td></tr><tr><td>派生路径</td><td>m/44&#39;/0&#39;/0&#39;/0/{index} (Legacy)</td></tr><tr><td>地址格式</td><td>P2PKH (1xxx), P2WPKH (bc1xxx)</td></tr></tbody></table><h3 id="utxo-模型" tabindex="-1">UTXO 模型 <a class="header-anchor" href="#utxo-模型" aria-label="Permalink to &quot;UTXO 模型&quot;">​</a></h3><p>Bitcoin 使用 UTXO（未花费交易输出）模型：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> UTXO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  txid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  vout</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bigint</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // satoshi</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  scriptPubKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  txHex</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 某些钱包需要完整交易</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="交易构建" tabindex="-1">交易构建 <a class="header-anchor" href="#交易构建" aria-label="Permalink to &quot;交易构建&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 获取地址所有 UTXO</span></span>
<span class="line"><span>2. 选择足够的 UTXO（需覆盖金额 + 手续费）</span></span>
<span class="line"><span>3. 构建交易输入</span></span>
<span class="line"><span>4. 构建交易输出（收款地址 + 找零地址）</span></span>
<span class="line"><span>5. 签名所有输入</span></span>
<span class="line"><span>6. 广播交易</span></span></code></pre></div><h3 id="手续费估算-1" tabindex="-1">手续费估算 <a class="header-anchor" href="#手续费估算-1" aria-label="Permalink to &quot;手续费估算&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 手续费 = 交易大小(vbytes) × 费率(sat/vB)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> estimatedSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> inputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 148</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> outputs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 34</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fee</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> estimatedSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> feeRate</span></span></code></pre></div><h3 id="特殊处理-2" tabindex="-1">特殊处理 <a class="header-anchor" href="#特殊处理-2" aria-label="Permalink to &quot;特殊处理&quot;">​</a></h3><ul><li><strong>MUST</strong> 正确处理 UTXO 选择</li><li><strong>MUST</strong> 计算找零输出</li><li><strong>SHOULD</strong> 支持 RBF（Replace-By-Fee）</li></ul><hr><h2 id="错误处理" tabindex="-1">错误处理 <a class="header-anchor" href="#错误处理" aria-label="Permalink to &quot;错误处理&quot;">​</a></h2><h3 id="通用错误码" tabindex="-1">通用错误码 <a class="header-anchor" href="#通用错误码" aria-label="Permalink to &quot;通用错误码&quot;">​</a></h3><table tabindex="0"><thead><tr><th>错误码</th><th>说明</th></tr></thead><tbody><tr><td>CHAIN_NOT_SUPPORTED</td><td>不支持的链类型</td></tr><tr><td>NETWORK_ERROR</td><td>网络请求失败</td></tr><tr><td>INSUFFICIENT_BALANCE</td><td>余额不足</td></tr><tr><td>INSUFFICIENT_FEE</td><td>手续费不足</td></tr><tr><td>INVALID_ADDRESS</td><td>地址格式错误</td></tr><tr><td>TRANSACTION_REJECTED</td><td>交易被拒绝</td></tr></tbody></table><h3 id="链特有错误" tabindex="-1">链特有错误 <a class="header-anchor" href="#链特有错误" aria-label="Permalink to &quot;链特有错误&quot;">​</a></h3><table tabindex="0"><thead><tr><th>链</th><th>错误码</th><th>说明</th></tr></thead><tbody><tr><td>BioForest</td><td>ADDRESS_FROZEN</td><td>地址已冻结</td></tr><tr><td>BioForest</td><td>PAYSECRET_REQUIRED</td><td>需要交易密码</td></tr><tr><td>Tron</td><td>ADDRESS_NOT_ACTIVATED</td><td>地址未激活</td></tr><tr><td>Tron</td><td>ENERGY_INSUFFICIENT</td><td>能量不足</td></tr><tr><td>EVM</td><td>NONCE_TOO_LOW</td><td>Nonce 冲突</td></tr><tr><td>Bitcoin</td><td>UTXO_INSUFFICIENT</td><td>可用 UTXO 不足</td></tr></tbody></table><hr><h2 id="参考实现" tabindex="-1">参考实现 <a class="header-anchor" href="#参考实现" aria-label="Permalink to &quot;参考实现&quot;">​</a></h2><p>参考 mpay 项目中的实现：</p><table tabindex="0"><thead><tr><th>链</th><th>文件路径</th></tr></thead><tbody><tr><td>BFMeta</td><td><code>libs/wallet-base/services/wallet/bfmeta/</code></td></tr><tr><td>Ethereum</td><td><code>libs/wallet-base/services/wallet/ethereum/</code></td></tr><tr><td>Tron</td><td><code>libs/wallet-base/services/wallet/tron/</code></td></tr><tr><td>BSC</td><td><code>libs/wallet-base/services/wallet/binance/</code></td></tr><tr><td>Bitcoin</td><td><code>libs/wallet-base/services/wallet/bitcoin/</code></td></tr></tbody></table>`,33)])])}const y=n(e,[["render",h]]);export{g as __pageData,y as default};
