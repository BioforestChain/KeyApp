import{_ as a,c as i,o as t,ag as s}from"./chunks/framework.B0we9iV-.js";const u=JSON.parse('{"title":"Bitcoin Provider (UTXO)","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/02-Driver-Ref/03-UTXO/01-BTC-Provider.md","filePath":"white-book/02-Driver-Ref/03-UTXO/01-BTC-Provider.md"}'),o={name:"white-book/02-Driver-Ref/03-UTXO/01-BTC-Provider.md"};function r(n,e,l,d,c,h){return t(),i("div",null,[...e[0]||(e[0]=[s(`<h1 id="bitcoin-provider-utxo" tabindex="-1">Bitcoin Provider (UTXO) <a class="header-anchor" href="#bitcoin-provider-utxo" aria-label="Permalink to &quot;Bitcoin Provider (UTXO)&quot;">​</a></h1><blockquote><p><strong>Code Source</strong>: <a href="https://github.com/BioforestChain/KeyApp/blob/main/src/services/chain-adapter/providers/btcwallet-provider.ts" target="_blank" rel="noreferrer"><code>src/services/chain-adapter/providers/btcwallet-provider.ts</code></a></p></blockquote><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The <code>BtcWalletProvider</code> implements the <code>ApiProvider</code> interface for Bitcoin-like UTXO chains. It relies on a Blockbook-compatible backend API (btcwallet) to fetch balances and transaction history.</p><h2 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h2><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    A[ChainProvider] --&gt; B[BtcWalletProvider]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    B --&gt; C[Blockbook API]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    C --&gt; D[Bitcoin Node]</span></span></code></pre></div><h2 id="implementation-details" tabindex="-1">Implementation Details <a class="header-anchor" href="#implementation-details" aria-label="Permalink to &quot;Implementation Details&quot;">​</a></h2><h3 id="class-structure" tabindex="-1">Class Structure <a class="header-anchor" href="#class-structure" aria-label="Permalink to &quot;Class Structure&quot;">​</a></h3><ul><li><strong>Class</strong>: <code>BtcWalletProvider</code></li><li><strong>Implements</strong>: <code>ApiProvider</code></li><li><strong>Location</strong>: <a href="https://github.com/BioforestChain/KeyApp/blob/main/src/services/chain-adapter/providers/btcwallet-provider.ts" target="_blank" rel="noreferrer"><code>src/services/chain-adapter/providers/btcwallet-provider.ts</code></a></li></ul><h3 id="key-features" tabindex="-1">Key Features <a class="header-anchor" href="#key-features" aria-label="Permalink to &quot;Key Features&quot;">​</a></h3><ol><li><p><strong>Native Balance</strong>:</p><ul><li>Fetches balance via <code>/api/v2/address/{address}</code>.</li><li>Combines <code>balance</code> (confirmed) and <code>unconfirmedBalance</code>.</li><li>Caching: 60 seconds.</li></ul></li><li><p><strong>Transaction History</strong>:</p><ul><li>Fetches history via <code>/api/v2/address/{address}?details=txs</code>.</li><li>Parses inputs (<code>vin</code>) and outputs (<code>vout</code>) to determine direction and net value.</li><li>Supports pagination (limit).</li><li>Caching: 5 minutes.</li></ul></li></ol><h3 id="data-models" tabindex="-1">Data Models <a class="header-anchor" href="#data-models" aria-label="Permalink to &quot;Data Models&quot;">​</a></h3><h4 id="blockbook-response-schemas" tabindex="-1">Blockbook Response Schemas <a class="header-anchor" href="#blockbook-response-schemas" aria-label="Permalink to &quot;Blockbook Response Schemas&quot;">​</a></h4><ul><li><code>BlockbookAddressInfoSchema</code>: Contains balance and transaction list.</li><li><code>BlockbookTxSchema</code>: Detailed transaction info (inputs, outputs, block height).</li></ul><h4 id="logic-direction-value" tabindex="-1">Logic: Direction &amp; Value <a class="header-anchor" href="#logic-direction-value" aria-label="Permalink to &quot;Logic: Direction &amp; Value&quot;">​</a></h4><p>The provider calculates the net value change for the user&#39;s address to determine the transaction direction:</p><ul><li><strong>Incoming (<code>in</code>)</strong>: Net value &gt; 0.</li><li><strong>Outgoing (<code>out</code>)</strong>: Net value &lt; 0.</li><li><strong>Self (<code>self</code>)</strong>: Net value = 0 (e.g., consolidation).</li></ul><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> inSum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sumValues</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tx.vin, address)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> outSum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sumValues</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tx.vout, address)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> net</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> outSum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> inSum</span></span></code></pre></div><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h2><ul><li><strong>Type</strong>: <code>btcwallet-v1</code></li><li><strong>Endpoint</strong>: URL of the Blockbook API (e.g., <code>https://btc.bioforest.io</code>).</li><li><strong>Chain ID</strong>: Passed during initialization to fetch symbol and decimals.</li></ul><h2 id="caching-strategy" tabindex="-1">Caching Strategy <a class="header-anchor" href="#caching-strategy" aria-label="Permalink to &quot;Caching Strategy&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Data</th><th>TTL</th><th>Invalidation Tags</th></tr></thead><tbody><tr><td>Balance</td><td>60s</td><td><code>balance:{chainId}:{address}</code></td></tr><tr><td>History</td><td>5m</td><td><code>txhistory:{chainId}:{address}</code></td></tr></tbody></table><h2 id="error-handling" tabindex="-1">Error Handling <a class="header-anchor" href="#error-handling" aria-label="Permalink to &quot;Error Handling&quot;">​</a></h2><ul><li>Validates API responses using Zod schemas (<code>BlockbookErrorSchema</code>, <code>BlockbookAddressInfoSchema</code>).</li><li>Throws specific errors for API failures or invalid data.</li></ul><h2 id="future-improvements" tabindex="-1">Future Improvements <a class="header-anchor" href="#future-improvements" aria-label="Permalink to &quot;Future Improvements&quot;">​</a></h2><ul><li>[ ] Support for XPUB derived addresses.</li><li>[ ] Fee estimation via Blockbook.</li><li>[ ] Raw transaction broadcasting.</li></ul>`,26)])])}const k=a(o,[["render",r]]);export{u as __pageData,k as default};
