import{_ as a,c as t,o as r,ag as o}from"./chunks/framework.B0we9iV-.js";const u=JSON.parse('{"title":"Tron Provider (TVM)","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/02-Driver-Ref/04-TVM/01-Tron-Provider.md","filePath":"white-book/02-Driver-Ref/04-TVM/01-Tron-Provider.md"}'),i={name:"white-book/02-Driver-Ref/04-TVM/01-Tron-Provider.md"};function s(n,e,l,c,d,h){return r(),t("div",null,[...e[0]||(e[0]=[o(`<h1 id="tron-provider-tvm" tabindex="-1">Tron Provider (TVM) <a class="header-anchor" href="#tron-provider-tvm" aria-label="Permalink to &quot;Tron Provider (TVM)&quot;">​</a></h1><blockquote><p><strong>Code Source</strong>: <code>src/services/chain-adapter/providers/tronwallet-provider.effect.ts</code><strong>API Spec</strong>: <code>docs/white-book/99-Appendix/05-API-Providers.md#波场-api</code></p></blockquote><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The <code>TronWalletProviderEffect</code> implements the <code>ApiProvider</code> interface for the Tron blockchain. It interacts with <code>tronwallet-v1</code> (walletapi.bfmeta) to handle native (TRX) and TRC20 token operations.</p><h2 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h2><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    A[ChainProvider] --&gt; B[TronWalletProvider]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    B --&gt; C[TronWallet API]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    C --&gt; D[Tron Node]</span></span></code></pre></div><h2 id="implementation-details" tabindex="-1">Implementation Details <a class="header-anchor" href="#implementation-details" aria-label="Permalink to &quot;Implementation Details&quot;">​</a></h2><h3 id="class-structure" tabindex="-1">Class Structure <a class="header-anchor" href="#class-structure" aria-label="Permalink to &quot;Class Structure&quot;">​</a></h3><ul><li><strong>Class</strong>: <code>TronWalletProviderEffect</code></li><li><strong>Implements</strong>: <code>ApiProvider</code></li><li><strong>Location</strong>: <code>src/services/chain-adapter/providers/tronwallet-provider.effect.ts</code></li></ul><h3 id="key-features" tabindex="-1">Key Features <a class="header-anchor" href="#key-features" aria-label="Permalink to &quot;Key Features&quot;">​</a></h3><ol><li><p><strong>Native Balance</strong>:</p><ul><li>Fetches TRX balance via <code>/wallet/tron/balance</code>.</li><li>Supports Base58 + Hex address conversion.</li><li>Caching handled by <code>httpFetchCached</code>.</li></ul></li><li><p><strong>Transaction History</strong>:</p><ul><li>Aggregates data from two endpoints: <ul><li>Native: <code>/wallet/tron/trans/common/history</code></li><li>TRC20: <code>/wallet/tron/trans/trc20/history</code></li></ul></li><li>Merges and sorts transactions by timestamp.</li><li>Deduplicates native transactions triggered by TRC20 transfers.</li></ul></li><li><p><strong>Token Balances (Local Mix)</strong>:</p><ul><li>Uses <code>/wallet/tron/contract/tokens</code> to obtain TRC20 contract list (TTL cache).</li><li>Batches balances via <code>/wallet/tron/account/balance/v2</code> with <code>contracts[]</code>.</li><li>Mixes native + TRC20 balances into a single output list.</li></ul></li><li><p><strong>Create &amp; Broadcast</strong>:</p><ul><li>Native transfer uses <code>/wallet/tron/trans/create</code> + <code>/wallet/tron/trans/broadcast</code></li><li>TRC20 transfer uses <code>/wallet/tron/trans/contract</code> + <code>/wallet/tron/trans/trc20/broadcast</code></li></ul></li></ol><h3 id="address-handling" tabindex="-1">Address Handling <a class="header-anchor" href="#address-handling" aria-label="Permalink to &quot;Address Handling&quot;">​</a></h3><p>Tron uses a dual-format address system. The provider includes utilities for conversion:</p><ul><li><strong>Base58 (T-address)</strong>: User-friendly format (e.g., <code>T9yD14Nj9j7...</code>).</li><li><strong>Hex</strong>: Internal format used by the API (starts with <code>41...</code>).</li></ul><p>Utilities:</p><ul><li><code>tronAddressToHex(address)</code>: Converts Base58 to Hex.</li><li><code>tronHexToAddress(address)</code>: Converts Hex to Base58.</li></ul><h3 id="data-models" tabindex="-1">Data Models <a class="header-anchor" href="#data-models" aria-label="Permalink to &quot;Data Models&quot;">​</a></h3><h4 id="response-schemas" tabindex="-1">Response Schemas <a class="header-anchor" href="#response-schemas" aria-label="Permalink to &quot;Response Schemas&quot;">​</a></h4><ul><li><code>TronNativeTxSchema</code>: Standard TRX transfers.</li><li><code>TronTrc20TxSchema</code>: Token transfers (USDT, etc.).</li><li><code>TronHistorySchema</code>: Wrapper for API responses.</li></ul><h4 id="logic-trc20-vs-native" tabindex="-1">Logic: TRC20 vs Native <a class="header-anchor" href="#logic-trc20-vs-native" aria-label="Permalink to &quot;Logic: TRC20 vs Native&quot;">​</a></h4><p>TRC20 transfers often generate a corresponding native transaction record. The provider intelligently merges them:</p><ol><li>Fetches both Native and TRC20 history.</li><li>Maps TRC20 transfers by Transaction ID (<code>txID</code>).</li><li>Iterates through Native transactions: <ul><li>If a matching TRC20 record exists, it takes precedence (richer data).</li><li>If not, it&#39;s treated as a standard TRX transfer.</li></ul></li><li>Appends any remaining orphan TRC20 transfers.</li></ol><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h2><ul><li><strong>Type</strong>: <code>tronwallet-v1</code></li><li><strong>Endpoint</strong>: URL of the TronWallet API proxy.</li><li><strong>Chain ID</strong>: Passed during initialization.</li></ul><h2 id="caching-strategy" tabindex="-1">Caching Strategy <a class="header-anchor" href="#caching-strategy" aria-label="Permalink to &quot;Caching Strategy&quot;">​</a></h2><p>Caching is controlled by <code>httpFetchCached</code> and depends on source usage and <code>forceRefresh</code>.</p><h2 id="error-handling" tabindex="-1">Error Handling <a class="header-anchor" href="#error-handling" aria-label="Permalink to &quot;Error Handling&quot;">​</a></h2><ul><li><strong>Schema Validation</strong>: Ensures API responses match expected schemas.</li><li><strong>Upstream Errors</strong>: Non-2xx responses throw <code>HttpError</code>.</li></ul><h2 id="reference" tabindex="-1">Reference <a class="header-anchor" href="#reference" aria-label="Permalink to &quot;Reference&quot;">​</a></h2><ul><li>Legacy service: <code>/Users/kzf/Dev/bioforestChain/legacy-apps/libs/wallet-base/services/wallet/tron/tron.service.ts</code></li></ul><h2 id="future-improvements" tabindex="-1">Future Improvements <a class="header-anchor" href="#future-improvements" aria-label="Permalink to &quot;Future Improvements&quot;">​</a></h2><ul><li>[ ] TRC10 token support.</li><li>[ ] Energy/Bandwidth estimation.</li><li>[ ] Smart contract interaction beyond TRC20.</li></ul>`,32)])])}const g=a(i,[["render",s]]);export{u as __pageData,g as default};
