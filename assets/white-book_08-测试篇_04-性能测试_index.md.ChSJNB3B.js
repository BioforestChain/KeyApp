import{_ as a,c as s,o as n,ag as d}from"./chunks/framework.B0we9iV-.js";const b=JSON.parse('{"title":"性能测试规范","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/08-测试篇/04-性能测试/index.md","filePath":"white-book/08-测试篇/04-性能测试/index.md"}'),l={name:"white-book/08-测试篇/04-性能测试/index.md"};function e(i,t,r,h,p,o){return n(),s("div",null,[...t[0]||(t[0]=[d(`<h1 id="性能测试规范" tabindex="-1">性能测试规范 <a class="header-anchor" href="#性能测试规范" aria-label="Permalink to &quot;性能测试规范&quot;">​</a></h1><blockquote><p>定义性能测试策略、指标和自动化方案</p></blockquote><hr><h2 id="性能测试类型" tabindex="-1">性能测试类型 <a class="header-anchor" href="#性能测试类型" aria-label="Permalink to &quot;性能测试类型&quot;">​</a></h2><table tabindex="0"><thead><tr><th>类型</th><th>目的</th><th>执行时机</th></tr></thead><tbody><tr><td>基准测试</td><td>建立性能基线</td><td>版本发布前</td></tr><tr><td>回归测试</td><td>检测性能退化</td><td>每次 PR</td></tr><tr><td>负载测试</td><td>验证并发能力</td><td>重大变更后</td></tr><tr><td>压力测试</td><td>找到性能瓶颈</td><td>定期执行</td></tr></tbody></table><hr><h2 id="关键性能指标" tabindex="-1">关键性能指标 <a class="header-anchor" href="#关键性能指标" aria-label="Permalink to &quot;关键性能指标&quot;">​</a></h2><h3 id="加载性能" tabindex="-1">加载性能 <a class="header-anchor" href="#加载性能" aria-label="Permalink to &quot;加载性能&quot;">​</a></h3><table tabindex="0"><thead><tr><th>指标</th><th>目标值</th><th>测量工具</th></tr></thead><tbody><tr><td>FCP (首次内容绘制)</td><td>&lt; 1.5s</td><td>Lighthouse</td></tr><tr><td>LCP (最大内容绘制)</td><td>&lt; 2.5s</td><td>Lighthouse</td></tr><tr><td>TTI (可交互时间)</td><td>&lt; 3.5s</td><td>Lighthouse</td></tr><tr><td>TBT (总阻塞时间)</td><td>&lt; 300ms</td><td>Lighthouse</td></tr><tr><td>CLS (累积布局偏移)</td><td>&lt; 0.1</td><td>Lighthouse</td></tr></tbody></table><h3 id="运行时性能" tabindex="-1">运行时性能 <a class="header-anchor" href="#运行时性能" aria-label="Permalink to &quot;运行时性能&quot;">​</a></h3><table tabindex="0"><thead><tr><th>指标</th><th>目标值</th><th>测量方式</th></tr></thead><tbody><tr><td>页面切换</td><td>&lt; 300ms</td><td>自定义计时</td></tr><tr><td>列表滚动 FPS</td><td>60fps</td><td>Performance Observer</td></tr><tr><td>内存峰值</td><td>&lt; 200MB</td><td>Performance.memory</td></tr><tr><td>长任务</td><td>&lt; 50ms</td><td>Long Tasks API</td></tr></tbody></table><h3 id="关键操作性能" tabindex="-1">关键操作性能 <a class="header-anchor" href="#关键操作性能" aria-label="Permalink to &quot;关键操作性能&quot;">​</a></h3><table tabindex="0"><thead><tr><th>操作</th><th>目标时间</th><th>说明</th></tr></thead><tbody><tr><td>钱包列表渲染</td><td>&lt; 100ms</td><td>10 个钱包</td></tr><tr><td>余额刷新</td><td>&lt; 2s</td><td>网络请求</td></tr><tr><td>交易签名</td><td>&lt; 200ms</td><td>本地计算</td></tr><tr><td>二维码识别</td><td>&lt; 100ms</td><td>扫码延迟</td></tr></tbody></table><hr><h2 id="自动化性能测试" tabindex="-1">自动化性能测试 <a class="header-anchor" href="#自动化性能测试" aria-label="Permalink to &quot;自动化性能测试&quot;">​</a></h2><h3 id="lighthouse-ci-配置" tabindex="-1">Lighthouse CI 配置 <a class="header-anchor" href="#lighthouse-ci-配置" aria-label="Permalink to &quot;Lighthouse CI 配置&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>LighthouseCI {</span></span>
<span class="line"><span>  collect: {</span></span>
<span class="line"><span>    url: [&#39;/&#39;, &#39;/wallet&#39;, &#39;/send&#39;, &#39;/settings&#39;]</span></span>
<span class="line"><span>    numberOfRuns: 3</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  assert: {</span></span>
<span class="line"><span>    assertions: {</span></span>
<span class="line"><span>      &#39;first-contentful-paint&#39;: [&#39;error&#39;, {maxNumericValue: 1500}]</span></span>
<span class="line"><span>      &#39;largest-contentful-paint&#39;: [&#39;error&#39;, {maxNumericValue: 2500}]</span></span>
<span class="line"><span>      &#39;interactive&#39;: [&#39;error&#39;, {maxNumericValue: 3500}]</span></span>
<span class="line"><span>      &#39;cumulative-layout-shift&#39;: [&#39;error&#39;, {maxNumericValue: 0.1}]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="运行时性能测试" tabindex="-1">运行时性能测试 <a class="header-anchor" href="#运行时性能测试" aria-label="Permalink to &quot;运行时性能测试&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>性能测试用例结构：</span></span>
<span class="line"><span>describe(&#39;Performance&#39;, () =&gt; {</span></span>
<span class="line"><span>  benchmark(&#39;wallet list render&#39;, () =&gt; {</span></span>
<span class="line"><span>    // 渲染 10 个钱包卡片</span></span>
<span class="line"><span>    // 断言: 渲染时间 &lt; 100ms</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  benchmark(&#39;transaction list scroll&#39;, () =&gt; {</span></span>
<span class="line"><span>    // 滚动 100 条交易</span></span>
<span class="line"><span>    // 断言: 帧率 &gt; 55fps</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span>})</span></span></code></pre></div><hr><h2 id="性能回归检测" tabindex="-1">性能回归检测 <a class="header-anchor" href="#性能回归检测" aria-label="Permalink to &quot;性能回归检测&quot;">​</a></h2><h3 id="ci-集成" tabindex="-1">CI 集成 <a class="header-anchor" href="#ci-集成" aria-label="Permalink to &quot;CI 集成&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>PR 提交</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>构建应用</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>运行 Lighthouse</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>对比基线数据</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ├── 性能提升 ──► 通过 + 标记改进</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ├── 无显著变化 ──► 通过</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    └── 性能下降</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         ├── &lt; 10% ──► 警告</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         └── &gt; 10% ──► 阻止合并</span></span></code></pre></div><h3 id="基线管理" tabindex="-1">基线管理 <a class="header-anchor" href="#基线管理" aria-label="Permalink to &quot;基线管理&quot;">​</a></h3><table tabindex="0"><thead><tr><th>环境</th><th>更新频率</th><th>存储位置</th></tr></thead><tbody><tr><td>开发环境</td><td>每次发布</td><td>CI artifacts</td></tr><tr><td>生产环境</td><td>每周</td><td>监控系统</td></tr></tbody></table><hr><h2 id="性能测试场景" tabindex="-1">性能测试场景 <a class="header-anchor" href="#性能测试场景" aria-label="Permalink to &quot;性能测试场景&quot;">​</a></h2><h3 id="场景-1-冷启动" tabindex="-1">场景 1: 冷启动 <a class="header-anchor" href="#场景-1-冷启动" aria-label="Permalink to &quot;场景 1: 冷启动&quot;">​</a></h3><p><strong>测试步骤：</strong></p><ol><li>清除所有缓存</li><li>打开应用</li><li>测量至首屏可见</li></ol><p><strong>验证点：</strong></p><ul><li>FCP &lt; 1.5s</li><li>TTI &lt; 3.5s</li><li>无布局抖动</li></ul><h3 id="场景-2-热启动" tabindex="-1">场景 2: 热启动 <a class="header-anchor" href="#场景-2-热启动" aria-label="Permalink to &quot;场景 2: 热启动&quot;">​</a></h3><p><strong>测试步骤：</strong></p><ol><li>应用已缓存</li><li>打开应用</li><li>测量至首屏可见</li></ol><p><strong>验证点：</strong></p><ul><li>FCP &lt; 0.5s</li><li>TTI &lt; 1s</li></ul><h3 id="场景-3-大数据量" tabindex="-1">场景 3: 大数据量 <a class="header-anchor" href="#场景-3-大数据量" aria-label="Permalink to &quot;场景 3: 大数据量&quot;">​</a></h3><p><strong>测试步骤：</strong></p><ol><li>创建 10 个钱包</li><li>每个钱包 5 条链</li><li>渲染钱包列表</li></ol><p><strong>验证点：</strong></p><ul><li>列表渲染 &lt; 200ms</li><li>滚动流畅 (60fps)</li><li>内存 &lt; 150MB</li></ul><h3 id="场景-4-弱网环境" tabindex="-1">场景 4: 弱网环境 <a class="header-anchor" href="#场景-4-弱网环境" aria-label="Permalink to &quot;场景 4: 弱网环境&quot;">​</a></h3><p><strong>测试步骤：</strong></p><ol><li>模拟 3G 网络 (750kb/s, 400ms RTT)</li><li>刷新余额</li><li>测量完成时间</li></ol><p><strong>验证点：</strong></p><ul><li>显示加载状态</li><li>超时处理正确</li><li>不阻塞用户操作</li></ul><h3 id="场景-5-频繁操作" tabindex="-1">场景 5: 频繁操作 <a class="header-anchor" href="#场景-5-频繁操作" aria-label="Permalink to &quot;场景 5: 频繁操作&quot;">​</a></h3><p><strong>测试步骤：</strong></p><ol><li>快速切换 10 个钱包</li><li>测量响应时间和内存</li></ol><p><strong>验证点：</strong></p><ul><li>切换响应 &lt; 100ms</li><li>无内存泄漏</li><li>无页面卡顿</li></ul><hr><h2 id="包体积监控" tabindex="-1">包体积监控 <a class="header-anchor" href="#包体积监控" aria-label="Permalink to &quot;包体积监控&quot;">​</a></h2><h3 id="bundle-分析" tabindex="-1">Bundle 分析 <a class="header-anchor" href="#bundle-分析" aria-label="Permalink to &quot;Bundle 分析&quot;">​</a></h3><table tabindex="0"><thead><tr><th>检查项</th><th>阈值</th><th>动作</th></tr></thead><tbody><tr><td>总 JS (gzip)</td><td>&gt; 400KB</td><td>阻止</td></tr><tr><td>单 chunk</td><td>&gt; 50KB</td><td>警告</td></tr><tr><td>新增依赖</td><td>&gt; 20KB</td><td>审查</td></tr></tbody></table><h3 id="依赖审计" tabindex="-1">依赖审计 <a class="header-anchor" href="#依赖审计" aria-label="Permalink to &quot;依赖审计&quot;">​</a></h3><ul><li><strong>MUST</strong> 每次 PR 检查新增依赖大小</li><li><strong>SHOULD</strong> 大依赖必须说明理由</li><li><strong>SHOULD</strong> 寻找更小的替代方案</li></ul><hr><h2 id="性能测试环境" tabindex="-1">性能测试环境 <a class="header-anchor" href="#性能测试环境" aria-label="Permalink to &quot;性能测试环境&quot;">​</a></h2><h3 id="设备矩阵" tabindex="-1">设备矩阵 <a class="header-anchor" href="#设备矩阵" aria-label="Permalink to &quot;设备矩阵&quot;">​</a></h3><table tabindex="0"><thead><tr><th>设备类型</th><th>配置</th><th>用途</th></tr></thead><tbody><tr><td>低端 Android</td><td>Moto G4, 慢 4G</td><td>最低性能基准</td></tr><tr><td>中端 Android</td><td>Pixel 3a</td><td>主要目标用户</td></tr><tr><td>iPhone SE</td><td>iOS 14</td><td>iOS 低端</td></tr><tr><td>iPhone 13</td><td>iOS 16</td><td>iOS 标准</td></tr></tbody></table><h3 id="网络条件" tabindex="-1">网络条件 <a class="header-anchor" href="#网络条件" aria-label="Permalink to &quot;网络条件&quot;">​</a></h3><table tabindex="0"><thead><tr><th>类型</th><th>下载</th><th>上传</th><th>RTT</th></tr></thead><tbody><tr><td>4G</td><td>9Mbps</td><td>1.5Mbps</td><td>170ms</td></tr><tr><td>3G</td><td>750Kbps</td><td>250Kbps</td><td>400ms</td></tr><tr><td>慢 3G</td><td>400Kbps</td><td>400Kbps</td><td>2000ms</td></tr><tr><td>离线</td><td>0</td><td>0</td><td>∞</td></tr></tbody></table><hr><h2 id="性能优化建议" tabindex="-1">性能优化建议 <a class="header-anchor" href="#性能优化建议" aria-label="Permalink to &quot;性能优化建议&quot;">​</a></h2><h3 id="检测到问题时" tabindex="-1">检测到问题时 <a class="header-anchor" href="#检测到问题时" aria-label="Permalink to &quot;检测到问题时&quot;">​</a></h3><table tabindex="0"><thead><tr><th>问题</th><th>可能原因</th><th>优化方向</th></tr></thead><tbody><tr><td>FCP 过慢</td><td>首屏 JS 过大</td><td>代码分割</td></tr><tr><td>LCP 过慢</td><td>图片/字体加载</td><td>预加载/压缩</td></tr><tr><td>TTI 过慢</td><td>主线程阻塞</td><td>Web Worker</td></tr><tr><td>CLS 过高</td><td>动态内容</td><td>预留空间</td></tr><tr><td>滚动卡顿</td><td>重渲染</td><td>虚拟列表</td></tr><tr><td>内存泄漏</td><td>订阅未清理</td><td>清理 effect</td></tr></tbody></table><hr><h2 id="本章小结" tabindex="-1">本章小结 <a class="header-anchor" href="#本章小结" aria-label="Permalink to &quot;本章小结&quot;">​</a></h2><ul><li>定义明确的性能指标和目标值</li><li>自动化性能测试集成到 CI</li><li>性能回归检测阻止退化合并</li><li>多设备、多网络条件测试覆盖</li><li>问题检测后有明确优化方向</li></ul>`,71)])])}const u=a(l,[["render",e]]);export{b as __pageData,u as default};
