import{_ as t,c as s,o as e,ag as n}from"./chunks/framework.B0we9iV-.js";const b=JSON.parse('{"title":"IShareService 分享服务","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/04-服务篇/03-平台服务/IShareService.md","filePath":"white-book/04-服务篇/03-平台服务/IShareService.md"}'),l={name:"white-book/04-服务篇/03-平台服务/IShareService.md"};function r(i,a,d,p,h,o){return e(),s("div",null,[...a[0]||(a[0]=[n(`<h1 id="ishareservice-分享服务" tabindex="-1">IShareService 分享服务 <a class="header-anchor" href="#ishareservice-分享服务" aria-label="Permalink to &quot;IShareService 分享服务&quot;">​</a></h1><p>分享服务提供跨平台的内容分享能力，支持文本、链接、图片等多种内容类型。</p><h2 id="接口定义" tabindex="-1">接口定义 <a class="header-anchor" href="#接口定义" aria-label="Permalink to &quot;接口定义&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>IShareService {</span></span>
<span class="line"><span>  // 分享</span></span>
<span class="line"><span>  share(data: ShareData): Promise&lt;ShareResult&gt;</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 能力查询</span></span>
<span class="line"><span>  canShare(data: ShareData): Promise&lt;boolean&gt;</span></span>
<span class="line"><span>  getSupportedTypes(): Promise&lt;string[]&gt;</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 特定分享</span></span>
<span class="line"><span>  shareText(text: string, title?: string): Promise&lt;ShareResult&gt;</span></span>
<span class="line"><span>  shareUrl(url: string, title?: string): Promise&lt;ShareResult&gt;</span></span>
<span class="line"><span>  shareFile(file: ShareFile): Promise&lt;ShareResult&gt;</span></span>
<span class="line"><span>  shareImage(image: ImageData): Promise&lt;ShareResult&gt;</span></span>
<span class="line"><span>}</span></span></code></pre></div><h2 id="数据模型" tabindex="-1">数据模型 <a class="header-anchor" href="#数据模型" aria-label="Permalink to &quot;数据模型&quot;">​</a></h2><h3 id="sharedata" tabindex="-1">ShareData <a class="header-anchor" href="#sharedata" aria-label="Permalink to &quot;ShareData&quot;">​</a></h3><table tabindex="0"><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>title</td><td>string</td><td>否</td><td>分享标题</td></tr><tr><td>text</td><td>string</td><td>否</td><td>分享文本</td></tr><tr><td>url</td><td>string</td><td>否</td><td>分享链接</td></tr><tr><td>files</td><td>ShareFile[]</td><td>否</td><td>分享文件列表</td></tr></tbody></table><h3 id="sharefile" tabindex="-1">ShareFile <a class="header-anchor" href="#sharefile" aria-label="Permalink to &quot;ShareFile&quot;">​</a></h3><table tabindex="0"><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>是</td><td>文件名</td></tr><tr><td>type</td><td>string</td><td>是</td><td>MIME 类型</td></tr><tr><td>data</td><td>Blob</td><td>是</td><td>文件数据</td></tr></tbody></table><h3 id="shareresult" tabindex="-1">ShareResult <a class="header-anchor" href="#shareresult" aria-label="Permalink to &quot;ShareResult&quot;">​</a></h3><table tabindex="0"><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>success</td><td>boolean</td><td>是否成功</td></tr><tr><td>target</td><td>string</td><td>分享目标应用</td></tr><tr><td>error</td><td>Error</td><td>错误信息</td></tr></tbody></table><h2 id="功能规范" tabindex="-1">功能规范 <a class="header-anchor" href="#功能规范" aria-label="Permalink to &quot;功能规范&quot;">​</a></h2><h3 id="通用分享" tabindex="-1">通用分享 <a class="header-anchor" href="#通用分享" aria-label="Permalink to &quot;通用分享&quot;">​</a></h3><p><strong>share(data: ShareData)</strong></p><ul><li>MUST 调用系统分享面板</li><li>MUST 支持至少一种内容类型</li><li>MUST 在用户取消时返回相应状态</li><li>SHOULD 支持同时分享多种内容</li></ul><h3 id="能力查询" tabindex="-1">能力查询 <a class="header-anchor" href="#能力查询" aria-label="Permalink to &quot;能力查询&quot;">​</a></h3><p><strong>canShare(data: ShareData)</strong></p><ul><li>MUST 在不触发 UI 的情况下检查分享能力</li><li>MUST 准确反映平台支持情况</li><li>SHOULD 考虑当前内容类型的兼容性</li></ul><h3 id="文本分享" tabindex="-1">文本分享 <a class="header-anchor" href="#文本分享" aria-label="Permalink to &quot;文本分享&quot;">​</a></h3><p><strong>shareText(text: string)</strong></p><ul><li>MUST 支持纯文本分享</li><li>MUST 支持长文本（&gt;10KB）</li><li>SHOULD 自动识别文本中的 URL</li></ul><h2 id="使用场景" tabindex="-1">使用场景 <a class="header-anchor" href="#使用场景" aria-label="Permalink to &quot;使用场景&quot;">​</a></h2><h3 id="_1-分享收款地址" tabindex="-1">1. 分享收款地址 <a class="header-anchor" href="#_1-分享收款地址" aria-label="Permalink to &quot;1. 分享收款地址&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户点击分享按钮</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>构建 ShareData {</span></span>
<span class="line"><span>  title: &quot;我的收款地址&quot;,</span></span>
<span class="line"><span>  text: address,</span></span>
<span class="line"><span>  url: deepLink</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>调用 share(data)</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>用户选择分享目标</span></span></code></pre></div><h3 id="_2-分享交易凭证" tabindex="-1">2. 分享交易凭证 <a class="header-anchor" href="#_2-分享交易凭证" aria-label="Permalink to &quot;2. 分享交易凭证&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>交易完成</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>生成交易截图</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>调用 shareImage(screenshot)</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>用户分享到社交平台</span></span></code></pre></div><h3 id="_3-分享收款二维码" tabindex="-1">3. 分享收款二维码 <a class="header-anchor" href="#_3-分享收款二维码" aria-label="Permalink to &quot;3. 分享收款二维码&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户点击分享二维码</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>生成二维码图片</span></span>
<span class="line"><span>  ↓</span></span>
<span class="line"><span>调用 shareFile({</span></span>
<span class="line"><span>  name: &quot;qrcode.png&quot;,</span></span>
<span class="line"><span>  type: &quot;image/png&quot;,</span></span>
<span class="line"><span>  data: qrBlob</span></span>
<span class="line"><span>})</span></span></code></pre></div><h2 id="平台适配" tabindex="-1">平台适配 <a class="header-anchor" href="#平台适配" aria-label="Permalink to &quot;平台适配&quot;">​</a></h2><table tabindex="0"><thead><tr><th>平台</th><th>实现方式</th><th>文件支持</th></tr></thead><tbody><tr><td>Web</td><td>Web Share API</td><td>部分</td></tr><tr><td>DWEB</td><td>dweb.share API</td><td>完整</td></tr><tr><td>iOS</td><td>UIActivityViewController</td><td>完整</td></tr><tr><td>Android</td><td>Intent.ACTION_SEND</td><td>完整</td></tr></tbody></table><h2 id="降级策略" tabindex="-1">降级策略 <a class="header-anchor" href="#降级策略" aria-label="Permalink to &quot;降级策略&quot;">​</a></h2><p>当 Web Share API 不可用时：</p><ol><li><strong>复制到剪贴板</strong> - 最基本的降级</li><li><strong>生成分享链接</strong> - 用户手动复制</li><li><strong>显示二维码</strong> - 供其他设备扫描</li></ol><h2 id="错误处理" tabindex="-1">错误处理 <a class="header-anchor" href="#错误处理" aria-label="Permalink to &quot;错误处理&quot;">​</a></h2><table tabindex="0"><thead><tr><th>错误类型</th><th>说明</th><th>处理方式</th></tr></thead><tbody><tr><td>NotSupported</td><td>平台不支持分享</td><td>使用降级策略</td></tr><tr><td>UserCancelled</td><td>用户取消分享</td><td>静默处理</td></tr><tr><td>PermissionDenied</td><td>无分享权限</td><td>提示用户授权</td></tr><tr><td>InvalidContent</td><td>内容格式无效</td><td>检查并修正内容</td></tr></tbody></table><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h2><ol><li><strong>预检查分享能力</strong> - 使用 canShare 隐藏不支持的分享选项</li><li><strong>提供降级方案</strong> - 确保所有平台都有可用的分享方式</li><li><strong>优化分享内容</strong> - 根据目标平台优化文本长度</li><li><strong>处理取消操作</strong> - 用户取消不应视为错误</li></ol>`,37)])])}const u=t(l,[["render",r]]);export{b as __pageData,u as default};
