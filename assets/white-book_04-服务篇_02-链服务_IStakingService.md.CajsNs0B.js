import{_ as s,c as n,o as p,ag as e}from"./chunks/framework.B0we9iV-.js";const b=JSON.parse('{"title":"IStakingService 质押服务","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/04-服务篇/02-链服务/IStakingService.md","filePath":"white-book/04-服务篇/02-链服务/IStakingService.md"}'),l={name:"white-book/04-服务篇/02-链服务/IStakingService.md"};function t(i,a,c,d,r,o){return p(),n("div",null,[...a[0]||(a[0]=[e(`<h1 id="istakingservice-质押服务" tabindex="-1">IStakingService 质押服务 <a class="header-anchor" href="#istakingservice-质押服务" aria-label="Permalink to &quot;IStakingService 质押服务&quot;">​</a></h1><blockquote><p>代币质押操作（可选服务）</p></blockquote><hr><h2 id="职责" tabindex="-1">职责 <a class="header-anchor" href="#职责" aria-label="Permalink to &quot;职责&quot;">​</a></h2><p>管理代币质押、解除质押、领取奖励等操作。</p><p><strong>注意</strong>：此服务为可选服务，仅支持质押功能的链需要实现。</p><hr><h2 id="接口定义" tabindex="-1">接口定义 <a class="header-anchor" href="#接口定义" aria-label="Permalink to &quot;接口定义&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>IStakingService {</span></span>
<span class="line"><span>  // 获取质押信息</span></span>
<span class="line"><span>  getStakingInfo(address: Address): StakingInfo</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 获取可用验证者列表</span></span>
<span class="line"><span>  getValidators(options?: ValidatorOptions): Validator[]</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 质押</span></span>
<span class="line"><span>  stake(params: StakeParams): UnsignedTransaction</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 解除质押</span></span>
<span class="line"><span>  unstake(params: UnstakeParams): UnsignedTransaction</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 领取奖励</span></span>
<span class="line"><span>  claimRewards(address: Address, validator?: Address): UnsignedTransaction</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 重新委托（更换验证者）</span></span>
<span class="line"><span>  redelegate(params: RedelegateParams): UnsignedTransaction</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 获取质押 APY</span></span>
<span class="line"><span>  getStakingAPY(): number</span></span>
<span class="line"><span>}</span></span></code></pre></div><hr><h2 id="数据结构" tabindex="-1">数据结构 <a class="header-anchor" href="#数据结构" aria-label="Permalink to &quot;数据结构&quot;">​</a></h2><h3 id="stakinginfo" tabindex="-1">StakingInfo <a class="header-anchor" href="#stakinginfo" aria-label="Permalink to &quot;StakingInfo&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>StakingInfo {</span></span>
<span class="line"><span>  // 总览</span></span>
<span class="line"><span>  totalStaked: bigint           // 总质押量</span></span>
<span class="line"><span>  totalRewards: bigint          // 待领取奖励</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 委托详情</span></span>
<span class="line"><span>  delegations: Delegation[]</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 解绑中</span></span>
<span class="line"><span>  unbonding: UnbondingEntry[]</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 汇总</span></span>
<span class="line"><span>  availableBalance: bigint      // 可用余额</span></span>
<span class="line"><span>  stakingRatio: number          // 质押占比</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Delegation {</span></span>
<span class="line"><span>  validator: ValidatorInfo</span></span>
<span class="line"><span>  amount: bigint</span></span>
<span class="line"><span>  rewards: bigint</span></span>
<span class="line"><span>  startTime: number</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>UnbondingEntry {</span></span>
<span class="line"><span>  validator: ValidatorInfo</span></span>
<span class="line"><span>  amount: bigint</span></span>
<span class="line"><span>  completionTime: number        // 完成时间戳</span></span>
<span class="line"><span>  remainingTime: number         // 剩余秒数</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="validator" tabindex="-1">Validator <a class="header-anchor" href="#validator" aria-label="Permalink to &quot;Validator&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Validator {</span></span>
<span class="line"><span>  address: Address</span></span>
<span class="line"><span>  name: string</span></span>
<span class="line"><span>  description?: string</span></span>
<span class="line"><span>  website?: string</span></span>
<span class="line"><span>  logoUri?: string</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 状态</span></span>
<span class="line"><span>  status: &#39;active&#39; | &#39;inactive&#39; | &#39;jailed&#39;</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // 指标</span></span>
<span class="line"><span>  commission: number            // 佣金比例 (0-1)</span></span>
<span class="line"><span>  votingPower: bigint           // 投票权重</span></span>
<span class="line"><span>  delegatorCount: number        // 委托人数</span></span>
<span class="line"><span>  uptime: number                // 在线率 (0-1)</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  // APY（扣除佣金后）</span></span>
<span class="line"><span>  estimatedAPY: number</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ValidatorOptions {</span></span>
<span class="line"><span>  status?: &#39;active&#39; | &#39;all&#39;</span></span>
<span class="line"><span>  sortBy?: &#39;votingPower&#39; | &#39;commission&#39; | &#39;apy&#39;</span></span>
<span class="line"><span>  limit?: number</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="stakeparams" tabindex="-1">StakeParams <a class="header-anchor" href="#stakeparams" aria-label="Permalink to &quot;StakeParams&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>StakeParams {</span></span>
<span class="line"><span>  from: Address</span></span>
<span class="line"><span>  validator: Address</span></span>
<span class="line"><span>  amount: bigint</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>UnstakeParams {</span></span>
<span class="line"><span>  from: Address</span></span>
<span class="line"><span>  validator: Address</span></span>
<span class="line"><span>  amount: bigint</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>RedelegateParams {</span></span>
<span class="line"><span>  from: Address</span></span>
<span class="line"><span>  srcValidator: Address</span></span>
<span class="line"><span>  dstValidator: Address</span></span>
<span class="line"><span>  amount: bigint</span></span>
<span class="line"><span>}</span></span></code></pre></div><hr><h2 id="质押流程" tabindex="-1">质押流程 <a class="header-anchor" href="#质押流程" aria-label="Permalink to &quot;质押流程&quot;">​</a></h2><h3 id="质押" tabindex="-1">质押 <a class="header-anchor" href="#质押" aria-label="Permalink to &quot;质押&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 用户选择验证者</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>2. 输入质押金额</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>3. stake() 构建交易</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>4. 签名并广播</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>5. 等待确认</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>6. 质押生效（下一个 epoch）</span></span></code></pre></div><h3 id="解除质押" tabindex="-1">解除质押 <a class="header-anchor" href="#解除质押" aria-label="Permalink to &quot;解除质押&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 选择要解除的委托</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>2. 输入解除金额</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>3. unstake() 构建交易</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>4. 签名并广播</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>5. 进入解绑期（通常 7-28 天）</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>6. 解绑完成，资金可用</span></span></code></pre></div><hr><h2 id="解绑期规范" tabindex="-1">解绑期规范 <a class="header-anchor" href="#解绑期规范" aria-label="Permalink to &quot;解绑期规范&quot;">​</a></h2><table tabindex="0"><thead><tr><th>链</th><th>解绑期</th><th>说明</th></tr></thead><tbody><tr><td>BFM</td><td>7 天</td><td></td></tr><tr><td>Cosmos 系</td><td>21 天</td><td></td></tr><tr><td>Ethereum</td><td>可变</td><td>取决于退出队列</td></tr></tbody></table><hr><h2 id="验证者选择建议" tabindex="-1">验证者选择建议 <a class="header-anchor" href="#验证者选择建议" aria-label="Permalink to &quot;验证者选择建议&quot;">​</a></h2><p>向用户展示时 <strong>SHOULD</strong> 排序和过滤：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>推荐验证者 = </span></span>
<span class="line"><span>  status == &#39;active&#39; &amp;&amp;</span></span>
<span class="line"><span>  commission &lt; 10% &amp;&amp;</span></span>
<span class="line"><span>  uptime &gt; 99% &amp;&amp;</span></span>
<span class="line"><span>  sortBy(estimatedAPY, desc)</span></span></code></pre></div><hr><h2 id="风险提示" tabindex="-1">风险提示 <a class="header-anchor" href="#风险提示" aria-label="Permalink to &quot;风险提示&quot;">​</a></h2><p>质押操作 <strong>MUST</strong> 向用户展示以下风险：</p><table tabindex="0"><thead><tr><th>风险</th><th>说明</th></tr></thead><tbody><tr><td>解绑期</td><td>解除质押需等待 X 天</td></tr><tr><td>惩罚风险</td><td>验证者作恶可能导致本金损失</td></tr><tr><td>价格风险</td><td>质押期间代币价格可能波动</td></tr></tbody></table><hr><h2 id="错误码" tabindex="-1">错误码 <a class="header-anchor" href="#错误码" aria-label="Permalink to &quot;错误码&quot;">​</a></h2><table tabindex="0"><thead><tr><th>错误码</th><th>说明</th></tr></thead><tbody><tr><td>VALIDATOR_NOT_FOUND</td><td>验证者不存在</td></tr><tr><td>VALIDATOR_INACTIVE</td><td>验证者不活跃</td></tr><tr><td>INSUFFICIENT_STAKE</td><td>质押金额不足最小要求</td></tr><tr><td>UNBONDING_LIMIT</td><td>解绑数量达到上限</td></tr><tr><td>ALREADY_DELEGATED</td><td>已委托给该验证者</td></tr><tr><td>REDELEGATE_COOLING</td><td>重新委托冷却中</td></tr></tbody></table>`,37)])])}const g=s(l,[["render",t]]);export{b as __pageData,g as default};
