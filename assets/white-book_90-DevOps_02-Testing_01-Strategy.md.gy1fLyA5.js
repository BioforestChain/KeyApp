import{_ as i,c as t,o as a,ag as n}from"./chunks/framework.B0we9iV-.js";const o=JSON.parse('{"title":"测试策略","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/90-DevOps/02-Testing/01-Strategy.md","filePath":"white-book/90-DevOps/02-Testing/01-Strategy.md"}'),h={name:"white-book/90-DevOps/02-Testing/01-Strategy.md"};function l(e,s,p,k,d,r){return a(),t("div",null,[...s[0]||(s[0]=[n(`<h1 id="测试策略" tabindex="-1">测试策略 <a class="header-anchor" href="#测试策略" aria-label="Permalink to &quot;测试策略&quot;">​</a></h1><blockquote><p>分层测试、覆盖率目标、Storybook + Vitest 集成</p></blockquote><hr><h2 id="测试环境的本质区别" tabindex="-1">测试环境的本质区别 <a class="header-anchor" href="#测试环境的本质区别" aria-label="Permalink to &quot;测试环境的本质区别&quot;">​</a></h2><p><strong>Storybook v10 的核心价值：与 Vitest 深度融合，为组件测试提供真实浏览器环境。</strong></p><table tabindex="0"><thead><tr><th>环境</th><th>技术栈</th><th>特点</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>jsdom/happy-dom</strong></td><td>Vitest 单元测试</td><td>虚拟 DOM，快速但非真实浏览器</td><td>纯逻辑、算法、工具函数</td></tr><tr><td><strong>真实浏览器 (Storybook)</strong></td><td>Storybook + Vitest</td><td>真实渲染、真实 CSS、真实事件</td><td>组件渲染、复杂交互、样式验证</td></tr><tr><td><strong>真实浏览器 (E2E)</strong></td><td>Playwright</td><td>完整应用实例</td><td>端到端用户流程</td></tr></tbody></table><h3 id="为什么需要三层测试" tabindex="-1">为什么需要三层测试？ <a class="header-anchor" href="#为什么需要三层测试" aria-label="Permalink to &quot;为什么需要三层测试？&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>jsdom/happy-dom 的局限性：</span></span>
<span class="line"><span>├── 不支持真实 CSS 计算 (layout、动画)</span></span>
<span class="line"><span>├── 不支持某些 Web API (ResizeObserver、IntersectionObserver)</span></span>
<span class="line"><span>└── 事件模型与真实浏览器有差异</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Storybook 组件测试的价值：</span></span>
<span class="line"><span>├── 在真实 Chromium 中渲染组件</span></span>
<span class="line"><span>├── 验证 CSS 样式、动画、响应式布局</span></span>
<span class="line"><span>├── 测试真实的用户交互</span></span>
<span class="line"><span>└── 每个 Story 自动成为冒烟测试</span></span>
<span class="line"><span></span></span>
<span class="line"><span>E2E 与组件测试的区别：</span></span>
<span class="line"><span>├── E2E 测试完整应用流程 (页面导航、状态持久化)</span></span>
<span class="line"><span>├── 组件测试聚焦单个组件的隔离行为</span></span>
<span class="line"><span>└── 组件测试更快、更稳定、更容易定位问题</span></span></code></pre></div><hr><h2 id="测试分层" tabindex="-1">测试分层 <a class="header-anchor" href="#测试分层" aria-label="Permalink to &quot;测试分层&quot;">​</a></h2><table tabindex="0"><thead><tr><th>层级</th><th>工具</th><th>文件模式</th><th>测试内容</th><th>运行频率</th></tr></thead><tbody><tr><td>单元测试</td><td>Vitest (jsdom)</td><td><code>*.test.ts</code></td><td>业务逻辑、工具函数、Hooks</td><td>每次提交</td></tr><tr><td>组件测试</td><td>Storybook + Vitest</td><td><code>*.stories.tsx</code></td><td>组件渲染、交互</td><td>每次提交</td></tr><tr><td>E2E 测试</td><td>Playwright</td><td><code>e2e/*.spec.ts</code></td><td>完整用户流程</td><td>PR / 发布前</td></tr></tbody></table><hr><h2 id="测试命令" tabindex="-1">测试命令 <a class="header-anchor" href="#测试命令" aria-label="Permalink to &quot;测试命令&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              # 单元测试 (*.test.ts)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:storybook</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Storybook 组件测试 (*.stories.tsx)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:all</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # 运行所有测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test:coverage</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # 单元测试 + 覆盖率报告</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> e2e</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               # E2E 测试</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> e2e:ui</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # E2E 测试 (带 UI)</span></span></code></pre></div><hr><h2 id="storybook-vitest-集成" tabindex="-1">Storybook + Vitest 集成 <a class="header-anchor" href="#storybook-vitest-集成" aria-label="Permalink to &quot;Storybook + Vitest 集成&quot;">​</a></h2><p>项目使用 <code>@storybook/addon-vitest</code> 将 Stories 作为测试用例运行。</p><h3 id="测试类型对比" tabindex="-1">测试类型对比 <a class="header-anchor" href="#测试类型对比" aria-label="Permalink to &quot;测试类型对比&quot;">​</a></h3><table tabindex="0"><thead><tr><th>文件类型</th><th>测试内容</th><th>运行环境</th><th>价值</th></tr></thead><tbody><tr><td><code>*.test.ts</code></td><td>纯逻辑/函数</td><td>jsdom (快)</td><td>验证业务逻辑正确性</td></tr><tr><td><code>*.stories.tsx</code> (无 play)</td><td>组件能否渲染</td><td>真实浏览器</td><td>冒烟测试，防止渲染崩溃</td></tr><tr><td><code>*.stories.tsx</code> (有 play)</td><td>用户交互流程</td><td>真实浏览器</td><td>集成测试</td></tr></tbody></table><h3 id="story-编写规范" tabindex="-1">Story 编写规范 <a class="header-anchor" href="#story-编写规范" aria-label="Permalink to &quot;Story 编写规范&quot;">​</a></h3><p><strong>基础 Story (自动冒烟测试)：</strong></p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Story</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  args: { value: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>带交互测试的 Story：</strong></p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { within, userEvent, expect } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;storybook/test&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Interactive</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Story</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  play</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">canvasElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> canvas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> within</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvasElement)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getByRole</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;textbox&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userEvent.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(input, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(canvas.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getByText</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBeInTheDocument</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="何时使用-play-函数" tabindex="-1">何时使用 play 函数 <a class="header-anchor" href="#何时使用-play-函数" aria-label="Permalink to &quot;何时使用 play 函数&quot;">​</a></h3><table tabindex="0"><thead><tr><th>场景</th><th>是否需要 play</th></tr></thead><tbody><tr><td>纯展示组件</td><td>否 - 自动冒烟测试足够</td></tr><tr><td>复杂交互 (手势、拖拽)</td><td>是</td></tr><tr><td>表单验证流程</td><td>是</td></tr><tr><td>状态机组件</td><td>是</td></tr><tr><td>已有 *.test.ts 覆盖的逻辑</td><td>否 - 避免重复</td></tr></tbody></table><hr><h2 id="覆盖率目标" tabindex="-1">覆盖率目标 <a class="header-anchor" href="#覆盖率目标" aria-label="Permalink to &quot;覆盖率目标&quot;">​</a></h2><table tabindex="0"><thead><tr><th>类型</th><th>目标</th></tr></thead><tbody><tr><td>语句覆盖</td><td>≥ 70%</td></tr><tr><td>分支覆盖</td><td>≥ 70%</td></tr><tr><td>函数覆盖</td><td>≥ 70%</td></tr><tr><td>行覆盖</td><td>≥ 70%</td></tr></tbody></table><hr><h2 id="测试优先级" tabindex="-1">测试优先级 <a class="header-anchor" href="#测试优先级" aria-label="Permalink to &quot;测试优先级&quot;">​</a></h2><table tabindex="0"><thead><tr><th>优先级</th><th>测试内容</th><th>说明</th></tr></thead><tbody><tr><td><strong>P0</strong></td><td>密钥生成/派生、加密/解密、签名验证</td><td>安全关键</td></tr><tr><td><strong>P1</strong></td><td>钱包创建/导入、转账流程</td><td>核心功能</td></tr><tr><td><strong>P2</strong></td><td>余额查询、交易历史</td><td>重要功能</td></tr><tr><td><strong>P3</strong></td><td>设置、语言切换</td><td>辅助功能</td></tr></tbody></table><hr><h2 id="测试命名规范" tabindex="-1">测试命名规范 <a class="header-anchor" href="#测试命名规范" aria-label="Permalink to &quot;测试命名规范&quot;">​</a></h2><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">describe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;WalletStore&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  describe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;addWallet&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;should add wallet to list&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {})</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;should set as current wallet&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {})</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    it</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;should persist to localStorage&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="命名约束" tabindex="-1">命名约束 <a class="header-anchor" href="#命名约束" aria-label="Permalink to &quot;命名约束&quot;">​</a></h3><table tabindex="0"><thead><tr><th>约束级别</th><th>要求</th></tr></thead><tbody><tr><td><strong>MUST</strong></td><td>describe 描述模块/函数名</td></tr><tr><td><strong>MUST</strong></td><td>it 描述预期行为 (should...)</td></tr><tr><td><strong>SHOULD</strong></td><td>按功能分组</td></tr><tr><td><strong>SHOULD</strong></td><td>测试边界条件</td></tr></tbody></table><hr><h2 id="mock-规范" tabindex="-1">Mock 规范 <a class="header-anchor" href="#mock-规范" aria-label="Permalink to &quot;Mock 规范&quot;">​</a></h2><h3 id="api-mock-msw" tabindex="-1">API Mock (MSW) <a class="header-anchor" href="#api-mock-msw" aria-label="Permalink to &quot;API Mock (MSW)&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { http, HttpResponse } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;msw&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> handlers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  http.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/api/balance&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpResponse.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">json</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ balance: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1000000000&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><h3 id="服务-mock" tabindex="-1">服务 Mock <a class="header-anchor" href="#服务-mock" aria-label="Permalink to &quot;服务 Mock&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">vi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mock</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@/services/wallet&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  walletService: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    getBalance: vi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mockResolvedValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1000000000&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}))</span></span></code></pre></div><h3 id="mock-约束" tabindex="-1">Mock 约束 <a class="header-anchor" href="#mock-约束" aria-label="Permalink to &quot;Mock 约束&quot;">​</a></h3><table tabindex="0"><thead><tr><th>约束级别</th><th>要求</th></tr></thead><tbody><tr><td><strong>MUST</strong></td><td>Mock 外部 API</td></tr><tr><td><strong>SHOULD</strong></td><td>测试完整前端栈</td></tr><tr><td><strong>SHOULD</strong></td><td>使用 MSW 而非直接 mock fetch</td></tr></tbody></table><hr><h2 id="选择器规范" tabindex="-1">选择器规范 <a class="header-anchor" href="#选择器规范" aria-label="Permalink to &quot;选择器规范&quot;">​</a></h2><table tabindex="0"><thead><tr><th>约束级别</th><th>要求</th></tr></thead><tbody><tr><td><strong>MUST</strong></td><td>使用 <code>data-testid</code> 作为稳定选择器</td></tr><tr><td><strong>SHOULD</strong></td><td>优先使用语义化选择器 (getByRole, getByLabelText)</td></tr><tr><td><strong>MUST NOT</strong></td><td>依赖 CSS 类名或内部实现细节</td></tr></tbody></table><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ✅ Good</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> data-testid</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;submit-btn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Submit&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">screen.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getByTestId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;submit-btn&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">screen.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getByRole</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;button&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Submit&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ❌ Bad</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> className</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;btn-primary&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;Submit&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">querySelector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.btn-primary&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><hr><h2 id="ci-集成" tabindex="-1">CI 集成 <a class="header-anchor" href="#ci-集成" aria-label="Permalink to &quot;CI 集成&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .github/workflows/ci.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">jobs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    steps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm test:run</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm test:storybook</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm e2e:ci</span></span></code></pre></div><table tabindex="0"><thead><tr><th>步骤</th><th>说明</th></tr></thead><tbody><tr><td>test:run</td><td>单元测试 (jsdom)</td></tr><tr><td>test:storybook</td><td>Storybook 组件测试 (chromium)</td></tr><tr><td>e2e:ci</td><td>E2E 集成测试</td></tr></tbody></table><hr><h2 id="相关文档" tabindex="-1">相关文档 <a class="header-anchor" href="#相关文档" aria-label="Permalink to &quot;相关文档&quot;">​</a></h2><ul><li><a href="./../01-Build/README.html">构建配置</a></li><li><a href="./../03-Release/02-Deployment.html">部署机制</a></li><li><a href="./../../08-Security-Ref/04-Security-Audit.html">安全审计</a></li></ul>`,56)])])}const g=i(h,[["render",l]]);export{o as __pageData,g as default};
