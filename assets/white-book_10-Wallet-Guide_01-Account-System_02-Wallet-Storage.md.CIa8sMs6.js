import{_ as i,c as a,o as n,ag as l}from"./chunks/framework.B0we9iV-.js";const c=JSON.parse('{"title":"02. 安全存储 (Wallet Storage)","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/10-Wallet-Guide/01-Account-System/02-Wallet-Storage.md","filePath":"white-book/10-Wallet-Guide/01-Account-System/02-Wallet-Storage.md"}'),e={name:"white-book/10-Wallet-Guide/01-Account-System/02-Wallet-Storage.md"};function t(h,s,p,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="_02-安全存储-wallet-storage" tabindex="-1">02. 安全存储 (Wallet Storage) <a class="header-anchor" href="#_02-安全存储-wallet-storage" aria-label="Permalink to &quot;02. 安全存储 (Wallet Storage)&quot;">​</a></h1><p>KeyApp 的钱包存储层采用 <strong>IndexedDB</strong> 进行持久化，并结合 <strong>Web Crypto API</strong> 进行敏感数据加密。</p><h2 id="数据模型" tabindex="-1">数据模型 <a class="header-anchor" href="#数据模型" aria-label="Permalink to &quot;数据模型&quot;">​</a></h2><h3 id="_1-walleterinfo-用户全局信息" tabindex="-1">1. WalleterInfo (用户全局信息) <a class="header-anchor" href="#_1-walleterinfo-用户全局信息" aria-label="Permalink to &quot;1. WalleterInfo (用户全局信息)&quot;">​</a></h3><p>存储用户的全局配置和状态。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WalleterInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  activeWalletId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 当前选中的钱包</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  biometricEnabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 是否开启生物识别</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  walletLockEnabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 是否开启钱包锁</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  agreementAccepted</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_2-walletinfo-钱包实体" tabindex="-1">2. WalletInfo (钱包实体) <a class="header-anchor" href="#_2-walletinfo-钱包实体" aria-label="Permalink to &quot;2. WalletInfo (钱包实体)&quot;">​</a></h3><p>仅存储钱包的元数据和<strong>加密后的</strong>敏感信息。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WalletInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** 密钥类型: mnemonic (BIP39) | arbitrary (Raw Key) */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  keyType</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> WalletKeyType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** 主链和主地址 */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  primaryChain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  primaryAddress</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * 加密后的助记词</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * Key: 使用 Wallet Lock (用户密码) 加密的 AES 密钥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  encryptedMnemonic</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EncryptedData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * 加密后的 Wallet Lock</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * Key: 使用助记词派生的密钥</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   * 用途: 用于生物识别解锁或验证密码正确性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  encryptedWalletLock</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> EncryptedData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-chainaddressinfo-链地址" tabindex="-1">3. ChainAddressInfo (链地址) <a class="header-anchor" href="#_3-chainaddressinfo-链地址" aria-label="Permalink to &quot;3. ChainAddressInfo (链地址)&quot;">​</a></h3><p>存储派生出的多链地址及其资产状态。</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChainAddressInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** 复合主键: \`{walletId}:{chainId}\` */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  addressKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  walletId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  chain</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  address</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  publicKey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  /** 资产列表 (Token List) */</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  assets</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AssetInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="加密机制" tabindex="-1">加密机制 <a class="header-anchor" href="#加密机制" aria-label="Permalink to &quot;加密机制&quot;">​</a></h2><p>KeyApp 采用了双重加密机制，确保安全性与易用性的平衡。</p><h3 id="_1-钱包锁-wallet-lock" tabindex="-1">1. 钱包锁 (Wallet Lock) <a class="header-anchor" href="#_1-钱包锁-wallet-lock" aria-label="Permalink to &quot;1. 钱包锁 (Wallet Lock)&quot;">​</a></h3><ul><li><strong>定义</strong>: 用户设置的支付密码 (6位数字或复杂密码)。</li><li><strong>用途</strong>: 加密 <code>mnemonic</code>。</li><li><strong>存储</strong>: 不直接存储。内存中仅在解锁期间保留。</li></ul><h3 id="_2-助记词-mnemonic" tabindex="-1">2. 助记词 (Mnemonic) <a class="header-anchor" href="#_2-助记词-mnemonic" aria-label="Permalink to &quot;2. 助记词 (Mnemonic)&quot;">​</a></h3><ul><li><strong>用途</strong>: 派生私钥，同时也用于加密 <code>Wallet Lock</code> (作为验证机制)。</li></ul><h3 id="_3-互解验证" tabindex="-1">3. 互解验证 <a class="header-anchor" href="#_3-互解验证" aria-label="Permalink to &quot;3. 互解验证&quot;">​</a></h3><p>系统存储了 <code>Encrypted(Mnemonic, Key=Lock)</code> 和 <code>Encrypted(Lock, Key=Mnemonic)</code>。</p><ul><li>当用户输入密码时，尝试解密 Mnemonic。如果解密成功且校验和通过，说明密码正确。</li><li>这种设计允许系统验证密码，而无需明文存储密码。</li></ul><h2 id="数据库架构-indexeddb" tabindex="-1">数据库架构 (IndexedDB) <a class="header-anchor" href="#数据库架构-indexeddb" aria-label="Permalink to &quot;数据库架构 (IndexedDB)&quot;">​</a></h2><p>使用 <code>idb</code> 库操作 IndexedDB。</p><ul><li><strong>Database Name</strong>: <code>keyapp_wallet_db</code></li><li><strong>Stores</strong>: <ul><li><code>walleter</code>: 单例 store，存储 <code>WalleterInfo</code>。</li><li><code>wallets</code>: 存储 <code>WalletInfo</code>，主键 <code>id</code>。</li><li><code>addresses</code>: 存储 <code>ChainAddressInfo</code>，主键 <code>addressKey</code>，索引 <code>walletId</code>。</li></ul></li></ul><p>这种分离设计使得我们可以快速加载钱包列表 (<code>wallets</code>)，而无需加载庞大的资产数据 (<code>addresses</code>)。</p>`,25)])])}const g=i(e,[["render",t]]);export{c as __pageData,g as default};
