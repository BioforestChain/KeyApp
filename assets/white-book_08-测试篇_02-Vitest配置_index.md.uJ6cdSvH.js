import{_ as a,c as s,o as e,ag as n}from"./chunks/framework.B0we9iV-.js";const g=JSON.parse('{"title":"单元测试规范","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/08-测试篇/02-Vitest配置/index.md","filePath":"white-book/08-测试篇/02-Vitest配置/index.md"}'),r={name:"white-book/08-测试篇/02-Vitest配置/index.md"};function l(o,t,i,d,h,c){return e(),s("div",null,[...t[0]||(t[0]=[n(`<h1 id="单元测试规范" tabindex="-1">单元测试规范 <a class="header-anchor" href="#单元测试规范" aria-label="Permalink to &quot;单元测试规范&quot;">​</a></h1><blockquote><p>定义单元测试和组件测试要求</p></blockquote><hr><h2 id="测试分类" tabindex="-1">测试分类 <a class="header-anchor" href="#测试分类" aria-label="Permalink to &quot;测试分类&quot;">​</a></h2><table tabindex="0"><thead><tr><th>测试类型</th><th>测试目标</th><th>运行环境</th></tr></thead><tbody><tr><td>单元测试</td><td>函数、工具类、Store</td><td>JSDOM/Node</td></tr><tr><td>组件测试</td><td>UI 组件渲染和交互</td><td>JSDOM/Browser</td></tr><tr><td>Storybook 测试</td><td>Story 组件行为</td><td>Browser</td></tr></tbody></table><hr><h2 id="测试覆盖率要求" tabindex="-1">测试覆盖率要求 <a class="header-anchor" href="#测试覆盖率要求" aria-label="Permalink to &quot;测试覆盖率要求&quot;">​</a></h2><table tabindex="0"><thead><tr><th>模块类型</th><th>覆盖率要求</th></tr></thead><tbody><tr><td>工具函数</td><td>≥90%</td></tr><tr><td>服务层</td><td>≥80%</td></tr><tr><td>Store</td><td>≥80%</td></tr><tr><td>组件</td><td>≥70%</td></tr><tr><td>页面</td><td>≥60%</td></tr></tbody></table><hr><h2 id="测试环境规范" tabindex="-1">测试环境规范 <a class="header-anchor" href="#测试环境规范" aria-label="Permalink to &quot;测试环境规范&quot;">​</a></h2><h3 id="全局-setup-要求" tabindex="-1">全局 Setup 要求 <a class="header-anchor" href="#全局-setup-要求" aria-label="Permalink to &quot;全局 Setup 要求&quot;">​</a></h3><ul><li><strong>MUST</strong> 每个测试后清理 DOM</li><li><strong>MUST</strong> Mock localStorage 和 sessionStorage</li><li><strong>MUST</strong> Mock crypto API</li><li><strong>SHOULD</strong> Mock 网络请求</li><li><strong>SHOULD</strong> 重置所有 Store 状态</li></ul><h3 id="mock-策略" tabindex="-1">Mock 策略 <a class="header-anchor" href="#mock-策略" aria-label="Permalink to &quot;Mock 策略&quot;">​</a></h3><table tabindex="0"><thead><tr><th>依赖</th><th>Mock 方式</th></tr></thead><tbody><tr><td>localStorage</td><td>内存 Map 实现</td></tr><tr><td>crypto.getRandomValues</td><td>伪随机生成</td></tr><tr><td>fetch</td><td>Mock Server 或 vi.fn()</td></tr><tr><td>平台 API</td><td>模拟实现</td></tr></tbody></table><hr><h2 id="单元测试规范-1" tabindex="-1">单元测试规范 <a class="header-anchor" href="#单元测试规范-1" aria-label="Permalink to &quot;单元测试规范&quot;">​</a></h2><h3 id="函数测试" tabindex="-1">函数测试 <a class="header-anchor" href="#函数测试" aria-label="Permalink to &quot;函数测试&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>测试结构：</span></span>
<span class="line"><span>describe(&#39;[模块名]&#39;, () =&gt; {</span></span>
<span class="line"><span>  describe(&#39;[函数名]&#39;, () =&gt; {</span></span>
<span class="line"><span>    it(&#39;should [预期行为] when [条件]&#39;, () =&gt; {</span></span>
<span class="line"><span>      // Arrange - 准备</span></span>
<span class="line"><span>      // Act - 执行</span></span>
<span class="line"><span>      // Assert - 断言</span></span>
<span class="line"><span>    })</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span>})</span></span></code></pre></div><h3 id="测试命名规范" tabindex="-1">测试命名规范 <a class="header-anchor" href="#测试命名规范" aria-label="Permalink to &quot;测试命名规范&quot;">​</a></h3><ul><li><strong>MUST</strong> 使用 <code>should ... when ...</code> 格式</li><li><strong>MUST</strong> 描述预期行为而非实现细节</li><li><strong>SHOULD</strong> 每个测试只验证一个行为</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>示例：</span></span>
<span class="line"><span>✓ should return formatted address when address is valid</span></span>
<span class="line"><span>✓ should throw error when address is invalid</span></span>
<span class="line"><span>✗ should call formatAddress function</span></span></code></pre></div><hr><h2 id="store-测试规范" tabindex="-1">Store 测试规范 <a class="header-anchor" href="#store-测试规范" aria-label="Permalink to &quot;Store 测试规范&quot;">​</a></h2><h3 id="测试要点" tabindex="-1">测试要点 <a class="header-anchor" href="#测试要点" aria-label="Permalink to &quot;测试要点&quot;">​</a></h3><ul><li><strong>MUST</strong> 测试初始状态</li><li><strong>MUST</strong> 测试每个 Action 的状态变化</li><li><strong>MUST</strong> 测试边界条件</li><li><strong>SHOULD</strong> 测试持久化逻辑</li><li><strong>SHOULD</strong> 测试派生状态</li></ul><h3 id="测试模式" tabindex="-1">测试模式 <a class="header-anchor" href="#测试模式" aria-label="Permalink to &quot;测试模式&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>测试结构：</span></span>
<span class="line"><span>describe(&#39;[Store名]&#39;, () =&gt; {</span></span>
<span class="line"><span>  beforeEach(() =&gt; {</span></span>
<span class="line"><span>    // 重置 Store 到初始状态</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  describe(&#39;[Action名]&#39;, () =&gt; {</span></span>
<span class="line"><span>    it(&#39;should update state correctly&#39;, () =&gt; {</span></span>
<span class="line"><span>      // 执行 Action</span></span>
<span class="line"><span>      // 验证状态变化</span></span>
<span class="line"><span>    })</span></span>
<span class="line"><span>  })</span></span>
<span class="line"><span>})</span></span></code></pre></div><hr><h2 id="组件测试规范" tabindex="-1">组件测试规范 <a class="header-anchor" href="#组件测试规范" aria-label="Permalink to &quot;组件测试规范&quot;">​</a></h2><h3 id="测试要点-1" tabindex="-1">测试要点 <a class="header-anchor" href="#测试要点-1" aria-label="Permalink to &quot;测试要点&quot;">​</a></h3><ul><li><strong>MUST</strong> 测试组件渲染</li><li><strong>MUST</strong> 测试用户交互</li><li><strong>MUST</strong> 测试 Props 变化</li><li><strong>SHOULD</strong> 测试错误状态</li><li><strong>SHOULD</strong> 测试加载状态</li><li><strong>MAY</strong> 测试可访问性</li></ul><h3 id="查询优先级" tabindex="-1">查询优先级 <a class="header-anchor" href="#查询优先级" aria-label="Permalink to &quot;查询优先级&quot;">​</a></h3><p>按以下顺序选择元素查询方式：</p><ol><li><strong>getByRole</strong> - 优先使用（可访问性）</li><li><strong>getByLabelText</strong> - 表单元素</li><li><strong>getByPlaceholderText</strong> - 输入框</li><li><strong>getByText</strong> - 文本内容</li><li><strong>getByTestId</strong> - 最后手段</li></ol><h3 id="用户交互测试" tabindex="-1">用户交互测试 <a class="header-anchor" href="#用户交互测试" aria-label="Permalink to &quot;用户交互测试&quot;">​</a></h3><ul><li><strong>MUST</strong> 使用 userEvent 模拟真实用户行为</li><li><strong>MUST NOT</strong> 直接调用 onChange 等回调</li><li><strong>SHOULD</strong> 等待异步操作完成</li></ul><hr><h2 id="异步测试规范" tabindex="-1">异步测试规范 <a class="header-anchor" href="#异步测试规范" aria-label="Permalink to &quot;异步测试规范&quot;">​</a></h2><h3 id="等待策略" tabindex="-1">等待策略 <a class="header-anchor" href="#等待策略" aria-label="Permalink to &quot;等待策略&quot;">​</a></h3><table tabindex="0"><thead><tr><th>场景</th><th>方法</th></tr></thead><tbody><tr><td>元素出现</td><td>waitFor / findBy*</td></tr><tr><td>元素消失</td><td>waitForElementToBeRemoved</td></tr><tr><td>状态更新</td><td>act()</td></tr><tr><td>API 响应</td><td>waitFor</td></tr></tbody></table><h3 id="超时配置" tabindex="-1">超时配置 <a class="header-anchor" href="#超时配置" aria-label="Permalink to &quot;超时配置&quot;">​</a></h3><ul><li><strong>SHOULD</strong> 设置合理的超时时间</li><li><strong>MUST</strong> 避免过长的超时导致测试慢</li><li><strong>SHOULD</strong> 默认超时 1000ms，特殊场景最多 5000ms</li></ul><hr><h2 id="mock-规范" tabindex="-1">Mock 规范 <a class="header-anchor" href="#mock-规范" aria-label="Permalink to &quot;Mock 规范&quot;">​</a></h2><h3 id="service-mock" tabindex="-1">Service Mock <a class="header-anchor" href="#service-mock" aria-label="Permalink to &quot;Service Mock&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Mock 结构：</span></span>
<span class="line"><span>vi.mock(&#39;@/services/[service-name]&#39;, () =&gt; ({</span></span>
<span class="line"><span>  [methodName]: vi.fn().mockResolvedValue(mockData)</span></span>
<span class="line"><span>}))</span></span></code></pre></div><h3 id="外部依赖-mock" tabindex="-1">外部依赖 Mock <a class="header-anchor" href="#外部依赖-mock" aria-label="Permalink to &quot;外部依赖 Mock&quot;">​</a></h3><table tabindex="0"><thead><tr><th>依赖类型</th><th>Mock 位置</th></tr></thead><tbody><tr><td>全局 API</td><td>setup 文件</td></tr><tr><td>服务层</td><td>测试文件顶部</td></tr><tr><td>组件 Props</td><td>测试用例内</td></tr></tbody></table><hr><h2 id="运行测试规范" tabindex="-1">运行测试规范 <a class="header-anchor" href="#运行测试规范" aria-label="Permalink to &quot;运行测试规范&quot;">​</a></h2><h3 id="命令规范" tabindex="-1">命令规范 <a class="header-anchor" href="#命令规范" aria-label="Permalink to &quot;命令规范&quot;">​</a></h3><table tabindex="0"><thead><tr><th>命令</th><th>用途</th></tr></thead><tbody><tr><td>test</td><td>运行单元测试（watch 模式）</td></tr><tr><td>test:run</td><td>运行单元测试（单次）</td></tr><tr><td>test:storybook</td><td>运行 Storybook 测试</td></tr><tr><td>test:all</td><td>运行所有测试</td></tr><tr><td>test:coverage</td><td>生成覆盖率报告</td></tr></tbody></table><h3 id="ci-运行要求" tabindex="-1">CI 运行要求 <a class="header-anchor" href="#ci-运行要求" aria-label="Permalink to &quot;CI 运行要求&quot;">​</a></h3><ul><li><strong>MUST</strong> 在 CI 中以非 watch 模式运行</li><li><strong>MUST</strong> 生成覆盖率报告</li><li><strong>SHOULD</strong> 设置覆盖率阈值检查</li><li><strong>SHOULD</strong> 并行运行测试加速</li></ul><hr><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h2><ol><li><strong>独立性</strong> - 每个测试独立运行，不依赖其他测试</li><li><strong>可重复</strong> - 多次运行结果一致</li><li><strong>快速</strong> - 单个测试应在 100ms 内完成</li><li><strong>清晰</strong> - 测试失败时能快速定位问题</li><li><strong>真实</strong> - 尽量模拟真实用户行为</li></ol><hr><h2 id="本章小结" tabindex="-1">本章小结 <a class="header-anchor" href="#本章小结" aria-label="Permalink to &quot;本章小结&quot;">​</a></h2><ul><li>测试分为单元测试、组件测试、Storybook 测试</li><li>明确各模块覆盖率要求</li><li>使用 AAA 模式组织测试代码</li><li>遵循查询优先级选择元素</li><li>使用 userEvent 模拟真实交互</li></ul>`,60)])])}const b=a(r,[["render",l]]);export{g as __pageData,b as default};
