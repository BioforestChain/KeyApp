import{_ as a,c as i,o as n,ag as t}from"./chunks/framework.B0we9iV-.js";const c=JSON.parse('{"title":"链配置管理服务","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/04-服务篇/07-链配置管理/index.md","filePath":"white-book/04-服务篇/07-链配置管理/index.md"}'),h={name:"white-book/04-服务篇/07-链配置管理/index.md"};function l(e,s,p,d,r,k){return n(),i("div",null,[...s[0]||(s[0]=[t(`<h1 id="链配置管理服务" tabindex="-1">链配置管理服务 <a class="header-anchor" href="#链配置管理服务" aria-label="Permalink to &quot;链配置管理服务&quot;">​</a></h1><blockquote><p>定义多链配置的获取、存储和管理规范</p></blockquote><hr><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>链配置管理服务负责管理应用支持的区块链网络配置。支持三种配置来源：内置默认、订阅源、手动添加。</p><hr><h2 id="配置来源" tabindex="-1">配置来源 <a class="header-anchor" href="#配置来源" aria-label="Permalink to &quot;配置来源&quot;">​</a></h2><h3 id="优先级规则" tabindex="-1">优先级规则 <a class="header-anchor" href="#优先级规则" aria-label="Permalink to &quot;优先级规则&quot;">​</a></h3><p>当多个来源存在相同 <code>id</code> 的配置时，按以下优先级合并：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>手动添加 (manual) &gt; 订阅源 (subscription) &gt; 内置默认 (default)</span></span></code></pre></div><h3 id="来源说明" tabindex="-1">来源说明 <a class="header-anchor" href="#来源说明" aria-label="Permalink to &quot;来源说明&quot;">​</a></h3><table tabindex="0"><thead><tr><th>来源</th><th>说明</th><th>可删除</th></tr></thead><tbody><tr><td>default</td><td>内置于应用的默认配置</td><td>否</td></tr><tr><td>subscription</td><td>从订阅 URL 获取的配置</td><td>切换订阅源时清除</td></tr><tr><td>manual</td><td>用户手动添加的配置</td><td>是</td></tr></tbody></table><hr><h2 id="订阅源管理" tabindex="-1">订阅源管理 <a class="header-anchor" href="#订阅源管理" aria-label="Permalink to &quot;订阅源管理&quot;">​</a></h2><h3 id="订阅-url-规范" tabindex="-1">订阅 URL 规范 <a class="header-anchor" href="#订阅-url-规范" aria-label="Permalink to &quot;订阅 URL 规范&quot;">​</a></h3><ul><li><strong>MUST</strong> 支持 <code>default</code> 作为特殊值，表示仅使用内置配置</li><li><strong>MUST</strong> 验证 URL 使用 <code>http://</code> 或 <code>https://</code> 协议</li><li><strong>SHOULD</strong> 支持 ETag 进行条件请求，避免重复下载</li></ul><h3 id="订阅刷新机制" tabindex="-1">订阅刷新机制 <a class="header-anchor" href="#订阅刷新机制" aria-label="Permalink to &quot;订阅刷新机制&quot;">​</a></h3><table tabindex="0"><thead><tr><th>触发条件</th><th>行为</th></tr></thead><tbody><tr><td>应用启动</td><td>检查 lastUpdated，超过刷新间隔则刷新</td></tr><tr><td>用户手动刷新</td><td>强制刷新，忽略 ETag</td></tr><tr><td>切换订阅 URL</td><td>清除旧订阅数据，获取新数据</td></tr></tbody></table><h3 id="刷新流程" tabindex="-1">刷新流程 <a class="header-anchor" href="#刷新流程" aria-label="Permalink to &quot;刷新流程&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>1. 检查当前订阅 URL</span></span>
<span class="line"><span>   │</span></span>
<span class="line"><span>   ├─ URL = &quot;default&quot; → 跳过，使用内置配置</span></span>
<span class="line"><span>   │</span></span>
<span class="line"><span>   └─ URL 有效 → 发起 HTTP GET 请求</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         ├─ 带 If-None-Match: {etag}（如有）</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         ├─ 响应 304 → 使用缓存数据</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         ├─ 响应 200 → 解析并存储新配置</span></span>
<span class="line"><span>         │</span></span>
<span class="line"><span>         └─ 错误 → 使用缓存数据 + 显示错误提示</span></span></code></pre></div><h3 id="订阅响应格式" tabindex="-1">订阅响应格式 <a class="header-anchor" href="#订阅响应格式" aria-label="Permalink to &quot;订阅响应格式&quot;">​</a></h3><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;lastUpdate&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2024-01-15T00:00:00Z&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;chains&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* ChainConfig */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* ChainConfig */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>或直接返回配置数组：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* ChainConfig */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* ChainConfig */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><hr><h2 id="链配置结构" tabindex="-1">链配置结构 <a class="header-anchor" href="#链配置结构" aria-label="Permalink to &quot;链配置结构&quot;">​</a></h2><h3 id="chainconfig-schema" tabindex="-1">ChainConfig Schema <a class="header-anchor" href="#chainconfig-schema" aria-label="Permalink to &quot;ChainConfig Schema&quot;">​</a></h3><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChainConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 必需字段</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              // 唯一标识，格式: /^[a-z0-9-]+$/</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  version</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         // 配置版本，格式: &quot;major.minor&quot;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  chainKind</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChainKind</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 链类型（严格枚举，不支持 custom）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // 显示名称</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  symbol</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // 原生代币符号</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  decimals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 原生代币精度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 可选字段</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  icon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           // 图标 URL</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         // 地址前缀（bioforest 链使用）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  rpcUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         // RPC 端点</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  explorerUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 区块浏览器 URL</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 运行时字段（不存储在配置源中）</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  enabled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 用户是否启用</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  source</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChainConfigSource</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 配置来源</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChainKind</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;bioforest&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;evm&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;bitcoin&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;tron&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ChainConfigSource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;default&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;subscription&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;manual&#39;</span></span></code></pre></div><h3 id="版本兼容性" tabindex="-1">版本兼容性 <a class="header-anchor" href="#版本兼容性" aria-label="Permalink to &quot;版本兼容性&quot;">​</a></h3><table tabindex="0"><thead><tr><th>版本 major</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td>当前支持的版本</td></tr><tr><td>2+</td><td>未来扩展，需要应用升级</td></tr></tbody></table><p>当配置的 major 版本高于应用支持的版本时：</p><ul><li><strong>MUST</strong> 显示警告提示</li><li><strong>MUST</strong> 禁用该链的启用开关</li><li><strong>SHOULD</strong> 提示用户升级应用</li></ul><hr><h2 id="链类型说明" tabindex="-1">链类型说明 <a class="header-anchor" href="#链类型说明" aria-label="Permalink to &quot;链类型说明&quot;">​</a></h2><h3 id="bioforest" tabindex="-1">bioforest <a class="header-anchor" href="#bioforest" aria-label="Permalink to &quot;bioforest&quot;">​</a></h3><p>BioForest 生态链，使用 Ed25519 密钥派生：</p><table tabindex="0"><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>prefix</td><td>地址前缀，默认 &quot;b&quot;</td></tr><tr><td>decimals</td><td>通常为 8</td></tr></tbody></table><p><strong>支持的链</strong>: BFMeta, CCChain, PMChain, BFChainV2, BTGMeta, BIWMeta, ETHMeta, Malibu</p><h3 id="evm" tabindex="-1">evm <a class="header-anchor" href="#evm" aria-label="Permalink to &quot;evm&quot;">​</a></h3><p>EVM 兼容链，使用 BIP44 派生（coin type 60）：</p><table tabindex="0"><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>rpcUrl</td><td>RPC 端点（必需用于交易）</td></tr><tr><td>explorerUrl</td><td>区块浏览器 URL</td></tr><tr><td>chainId</td><td>EVM chain ID（可从 RPC 获取）</td></tr></tbody></table><p><strong>支持的链</strong>: Ethereum, BSC, Polygon 等</p><h3 id="bitcoin" tabindex="-1">bitcoin <a class="header-anchor" href="#bitcoin" aria-label="Permalink to &quot;bitcoin&quot;">​</a></h3><p>Bitcoin 网络，使用 BIP84 派生（Native SegWit）：</p><table tabindex="0"><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>decimals</td><td>8</td></tr><tr><td>地址格式</td><td><code>bc1q...</code> (Native SegWit P2WPKH)</td></tr></tbody></table><p><strong>派生路径</strong>: <code>m/84&#39;/0&#39;/account&#39;/0/index</code></p><h3 id="tron" tabindex="-1">tron <a class="header-anchor" href="#tron" aria-label="Permalink to &quot;tron&quot;">​</a></h3><p>Tron 网络，使用 BIP44 派生（coin type 195）：</p><table tabindex="0"><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td>decimals</td><td>6</td></tr><tr><td>地址格式</td><td><code>T...</code> (Base58Check)</td></tr></tbody></table><p><strong>派生路径</strong>: <code>m/44&#39;/195&#39;/account&#39;/0/index</code></p><hr><h2 id="严格类型验证" tabindex="-1">严格类型验证 <a class="header-anchor" href="#严格类型验证" aria-label="Permalink to &quot;严格类型验证&quot;">​</a></h2><p>从版本 2.0.0 起，<code>chainKind</code> 采用严格枚举验证：</p><ul><li><strong>MUST</strong> 使用 <code>bioforest</code>、<code>evm</code>、<code>bitcoin</code>、<code>tron</code> 之一</li><li><strong>MUST NOT</strong> 使用 <code>custom</code> 或 <code>bip39</code>（已废弃）</li><li>未知类型将导致配置加载失败，而不是静默降级</li></ul><hr><h2 id="用户操作" tabindex="-1">用户操作 <a class="header-anchor" href="#用户操作" aria-label="Permalink to &quot;用户操作&quot;">​</a></h2><h3 id="启用-禁用链" tabindex="-1">启用/禁用链 <a class="header-anchor" href="#启用-禁用链" aria-label="Permalink to &quot;启用/禁用链&quot;">​</a></h3><ul><li>用户可以启用或禁用任何链</li><li>禁用的链 <strong>MUST NOT</strong> 出现在链选择器中</li><li>禁用状态存储在本地偏好设置中</li></ul><h3 id="手动添加链" tabindex="-1">手动添加链 <a class="header-anchor" href="#手动添加链" aria-label="Permalink to &quot;手动添加链&quot;">​</a></h3><ol><li>用户输入 JSON 格式的链配置</li><li>支持单个对象或数组</li><li>验证 JSON 格式和必需字段</li><li>如果 <code>id</code> 已存在，提示用户确认替换</li></ol><h3 id="删除手动链" tabindex="-1">删除手动链 <a class="header-anchor" href="#删除手动链" aria-label="Permalink to &quot;删除手动链&quot;">​</a></h3><ul><li>仅 <code>source: manual</code> 的链可以删除</li><li>删除后恢复到订阅源或默认配置（如有）</li></ul><hr><h2 id="存储规范" tabindex="-1">存储规范 <a class="header-anchor" href="#存储规范" aria-label="Permalink to &quot;存储规范&quot;">​</a></h2><h3 id="indexeddb-结构" tabindex="-1">IndexedDB 结构 <a class="header-anchor" href="#indexeddb-结构" aria-label="Permalink to &quot;IndexedDB 结构&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Store</th><th>Key</th><th>内容</th></tr></thead><tbody><tr><td>chain_configs</td><td><code>{source}:{id}</code></td><td>链配置记录</td></tr><tr><td>chain_preferences</td><td><code>enabledMap</code></td><td>启用状态映射</td></tr><tr><td>chain_preferences</td><td><code>subscriptionMeta</code></td><td>订阅元数据</td></tr></tbody></table><h3 id="数据迁移" tabindex="-1">数据迁移 <a class="header-anchor" href="#数据迁移" aria-label="Permalink to &quot;数据迁移&quot;">​</a></h3><p>当应用升级需要修改存储结构时：</p><ul><li><strong>MUST</strong> 提供向后兼容的读取逻辑</li><li><strong>SHOULD</strong> 在首次启动时执行迁移</li></ul><hr><h2 id="错误处理" tabindex="-1">错误处理 <a class="header-anchor" href="#错误处理" aria-label="Permalink to &quot;错误处理&quot;">​</a></h2><table tabindex="0"><thead><tr><th>错误场景</th><th>处理方式</th></tr></thead><tbody><tr><td>订阅 URL 无效</td><td>拒绝保存，提示格式错误</td></tr><tr><td>订阅请求超时</td><td>使用缓存数据，显示警告</td></tr><tr><td>订阅响应解析失败</td><td>使用缓存数据，记录错误日志</td></tr><tr><td>手动 JSON 格式错误</td><td>拒绝添加，提示具体错误</td></tr></tbody></table><hr><h2 id="接口定义" tabindex="-1">接口定义 <a class="header-anchor" href="#接口定义" aria-label="Permalink to &quot;接口定义&quot;">​</a></h2><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 初始化服务，加载所有配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">initialize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChainConfigSnapshot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置订阅 URL</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSubscriptionUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url: string): </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChainConfigSnapshot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 刷新订阅</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">refreshSubscription</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(): </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: FetchSubscriptionResult; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">snapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: ChainConfigSnapshot }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 添加手动配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addManualConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(input: string </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> object): </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChainConfigSnapshot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置链启用状态</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setChainEnabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id: string, enabled: boolean): </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Promise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ChainConfigSnapshot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 获取启用的链列表</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getEnabledChains</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(snapshot: ChainConfigSnapshot): ChainConfig[]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 根据 ID 获取链配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getChainById</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(snapshot: ChainConfigSnapshot, id: string): ChainConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span></span></code></pre></div><hr><h2 id="与其他服务的关系" tabindex="-1">与其他服务的关系 <a class="header-anchor" href="#与其他服务的关系" aria-label="Permalink to &quot;与其他服务的关系&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────┐</span></span>
<span class="line"><span>│  ChainConfigService │</span></span>
<span class="line"><span>└──────────┬──────────┘</span></span>
<span class="line"><span>           │ 提供链配置</span></span>
<span class="line"><span>           ▼</span></span>
<span class="line"><span>┌─────────────────────┐</span></span>
<span class="line"><span>│  AdapterRegistry    │ ← 根据 type 选择适配器</span></span>
<span class="line"><span>└──────────┬──────────┘</span></span>
<span class="line"><span>           │</span></span>
<span class="line"><span>     ┌─────┴─────┐</span></span>
<span class="line"><span>     ▼           ▼</span></span>
<span class="line"><span>┌─────────┐ ┌─────────┐</span></span>
<span class="line"><span>│BFMAdapter│ │EVMAdapter│</span></span>
<span class="line"><span>└─────────┘ └─────────┘</span></span></code></pre></div><hr><h2 id="安全考虑" tabindex="-1">安全考虑 <a class="header-anchor" href="#安全考虑" aria-label="Permalink to &quot;安全考虑&quot;">​</a></h2><ul><li><strong>MUST NOT</strong> 在日志中输出完整的 rpcUrl（可能含 API Key）</li><li><strong>SHOULD</strong> 验证 rpcUrl 指向可信域名</li><li><strong>MAY</strong> 提供 RPC 端点健康检查</li></ul><hr><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><ul><li><a href="./../../附录/B-链网络列表/">附录 B: 链网络列表</a> - 预置链配置详情</li></ul>`,84)])])}const g=a(h,[["render",l]]);export{c as __pageData,g as default};
