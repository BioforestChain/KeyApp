import{_ as t,c as s,o as n,ag as e}from"./chunks/framework.B0we9iV-.js";const b=JSON.parse('{"title":"构建配置","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/09-部署篇/01-构建配置/index.md","filePath":"white-book/09-部署篇/01-构建配置/index.md"}'),d={name:"white-book/09-部署篇/01-构建配置/index.md"};function l(r,a,i,h,p,o){return n(),s("div",null,[...a[0]||(a[0]=[e(`<h1 id="构建配置" tabindex="-1">构建配置 <a class="header-anchor" href="#构建配置" aria-label="Permalink to &quot;构建配置&quot;">​</a></h1><blockquote><p>定义构建系统和多目标构建规范</p></blockquote><hr><h2 id="构建目标" tabindex="-1">构建目标 <a class="header-anchor" href="#构建目标" aria-label="Permalink to &quot;构建目标&quot;">​</a></h2><table tabindex="0"><thead><tr><th>目标</th><th>输出目录</th><th>平台</th><th>说明</th></tr></thead><tbody><tr><td>Web</td><td>dist-web</td><td>浏览器</td><td>标准 Web 应用</td></tr><tr><td>DWEB</td><td>dist-dweb</td><td>Plaoc 容器</td><td>DWEB 应用</td></tr></tbody></table><hr><h2 id="构建配置规范" tabindex="-1">构建配置规范 <a class="header-anchor" href="#构建配置规范" aria-label="Permalink to &quot;构建配置规范&quot;">​</a></h2><h3 id="路径别名" tabindex="-1">路径别名 <a class="header-anchor" href="#路径别名" aria-label="Permalink to &quot;路径别名&quot;">​</a></h3><table tabindex="0"><thead><tr><th>别名</th><th>路径</th><th>说明</th></tr></thead><tbody><tr><td>@</td><td>/src</td><td>源码根目录</td></tr><tr><td>#biometric-impl</td><td>动态</td><td>生物识别实现</td></tr><tr><td>#storage-impl</td><td>动态</td><td>存储实现</td></tr><tr><td>#clipboard-impl</td><td>动态</td><td>剪贴板实现</td></tr></tbody></table><h3 id="平台实现切换" tabindex="-1">平台实现切换 <a class="header-anchor" href="#平台实现切换" aria-label="Permalink to &quot;平台实现切换&quot;">​</a></h3><p>通过环境变量切换平台特定实现：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>SERVICE_IMPL=web  → 使用 Web API 实现</span></span>
<span class="line"><span>SERVICE_IMPL=dweb → 使用 DWEB/Plaoc 实现</span></span></code></pre></div><h3 id="实现文件结构" tabindex="-1">实现文件结构 <a class="header-anchor" href="#实现文件结构" aria-label="Permalink to &quot;实现文件结构&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/services/platform/</span></span>
<span class="line"><span>├── biometric/</span></span>
<span class="line"><span>│   ├── types.ts      # 接口定义</span></span>
<span class="line"><span>│   ├── web.ts        # Web 实现</span></span>
<span class="line"><span>│   └── dweb.ts       # DWEB 实现</span></span>
<span class="line"><span>├── storage/</span></span>
<span class="line"><span>│   ├── types.ts</span></span>
<span class="line"><span>│   ├── web.ts</span></span>
<span class="line"><span>│   └── dweb.ts</span></span>
<span class="line"><span>└── clipboard/</span></span>
<span class="line"><span>    ├── types.ts</span></span>
<span class="line"><span>    ├── web.ts</span></span>
<span class="line"><span>    └── dweb.ts</span></span></code></pre></div><hr><h2 id="环境变量规范" tabindex="-1">环境变量规范 <a class="header-anchor" href="#环境变量规范" aria-label="Permalink to &quot;环境变量规范&quot;">​</a></h2><h3 id="变量命名" tabindex="-1">变量命名 <a class="header-anchor" href="#变量命名" aria-label="Permalink to &quot;变量命名&quot;">​</a></h3><table tabindex="0"><thead><tr><th>前缀</th><th>用途</th><th>暴露给客户端</th></tr></thead><tbody><tr><td>VITE_</td><td>客户端可用变量</td><td>是</td></tr><tr><td>BUILD_</td><td>构建时变量</td><td>否</td></tr><tr><td>无前缀</td><td>服务端/构建变量</td><td>否</td></tr></tbody></table><h3 id="必需变量" tabindex="-1">必需变量 <a class="header-anchor" href="#必需变量" aria-label="Permalink to &quot;必需变量&quot;">​</a></h3><table tabindex="0"><thead><tr><th>变量</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>VITE_API_URL</td><td>API 基础 URL</td><td><a href="https://api.example.com" target="_blank" rel="noreferrer">https://api.example.com</a></td></tr><tr><td>SERVICE_IMPL</td><td>平台实现</td><td>web / dweb</td></tr></tbody></table><h3 id="环境文件" tabindex="-1">环境文件 <a class="header-anchor" href="#环境文件" aria-label="Permalink to &quot;环境文件&quot;">​</a></h3><table tabindex="0"><thead><tr><th>文件</th><th>用途</th></tr></thead><tbody><tr><td>.env</td><td>所有环境</td></tr><tr><td>.env.local</td><td>本地覆盖（git 忽略）</td></tr><tr><td>.env.development</td><td>开发环境</td></tr><tr><td>.env.production</td><td>生产环境</td></tr></tbody></table><hr><h2 id="构建输出规范" tabindex="-1">构建输出规范 <a class="header-anchor" href="#构建输出规范" aria-label="Permalink to &quot;构建输出规范&quot;">​</a></h2><h3 id="代码分割策略" tabindex="-1">代码分割策略 <a class="header-anchor" href="#代码分割策略" aria-label="Permalink to &quot;代码分割策略&quot;">​</a></h3><table tabindex="0"><thead><tr><th>分割类型</th><th>规则</th></tr></thead><tbody><tr><td>路由分割</td><td>每个路由独立 chunk</td></tr><tr><td>供应商分割</td><td>node_modules 独立 chunk</td></tr><tr><td>按需加载</td><td>大型库动态导入</td></tr></tbody></table><h3 id="文件命名规范" tabindex="-1">文件命名规范 <a class="header-anchor" href="#文件命名规范" aria-label="Permalink to &quot;文件命名规范&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>资产命名：</span></span>
<span class="line"><span>assets/[name]-[hash:8].[ext]</span></span>
<span class="line"><span></span></span>
<span class="line"><span>JS 命名：</span></span>
<span class="line"><span>[name]-[hash:8].js</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CSS 命名：</span></span>
<span class="line"><span>[name]-[hash:8].css</span></span></code></pre></div><h3 id="source-map" tabindex="-1">Source Map <a class="header-anchor" href="#source-map" aria-label="Permalink to &quot;Source Map&quot;">​</a></h3><table tabindex="0"><thead><tr><th>环境</th><th>Source Map</th></tr></thead><tbody><tr><td>开发</td><td>inline</td></tr><tr><td>生产</td><td>hidden-source-map</td></tr></tbody></table><hr><h2 id="构建命令规范" tabindex="-1">构建命令规范 <a class="header-anchor" href="#构建命令规范" aria-label="Permalink to &quot;构建命令规范&quot;">​</a></h2><h3 id="标准命令" tabindex="-1">标准命令 <a class="header-anchor" href="#标准命令" aria-label="Permalink to &quot;标准命令&quot;">​</a></h3><table tabindex="0"><thead><tr><th>命令</th><th>用途</th></tr></thead><tbody><tr><td>build</td><td>构建默认目标（Web）</td></tr><tr><td>build:web</td><td>构建 Web 版本</td></tr><tr><td>build:dweb</td><td>构建 DWEB 版本</td></tr><tr><td>build:all</td><td>构建所有目标</td></tr><tr><td>preview</td><td>预览构建结果</td></tr></tbody></table><h3 id="构建流程" tabindex="-1">构建流程 <a class="header-anchor" href="#构建流程" aria-label="Permalink to &quot;构建流程&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>清理输出目录</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>类型检查</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>编译 TypeScript</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>打包资源</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>代码分割</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>压缩优化</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>生成 Source Map</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>输出到目标目录</span></span></code></pre></div><hr><h2 id="优化策略" tabindex="-1">优化策略 <a class="header-anchor" href="#优化策略" aria-label="Permalink to &quot;优化策略&quot;">​</a></h2><h3 id="包体积优化" tabindex="-1">包体积优化 <a class="header-anchor" href="#包体积优化" aria-label="Permalink to &quot;包体积优化&quot;">​</a></h3><ul><li><strong>MUST</strong> Tree Shaking 移除未使用代码</li><li><strong>MUST</strong> 压缩 JS/CSS</li><li><strong>SHOULD</strong> 图片压缩和格式优化</li><li><strong>SHOULD</strong> 按需加载大型库</li></ul><h3 id="分析工具" tabindex="-1">分析工具 <a class="header-anchor" href="#分析工具" aria-label="Permalink to &quot;分析工具&quot;">​</a></h3><ul><li><strong>SHOULD</strong> 使用包体积分析工具</li><li><strong>SHOULD</strong> 在 CI 中检查包体积变化</li><li><strong>MAY</strong> 设置包体积预算告警</li></ul><h3 id="包体积预算" tabindex="-1">包体积预算 <a class="header-anchor" href="#包体积预算" aria-label="Permalink to &quot;包体积预算&quot;">​</a></h3><table tabindex="0"><thead><tr><th>类型</th><th>预算</th></tr></thead><tbody><tr><td>首屏 JS</td><td>&lt;200KB (gzip)</td></tr><tr><td>首屏 CSS</td><td>&lt;50KB (gzip)</td></tr><tr><td>单个路由 chunk</td><td>&lt;100KB (gzip)</td></tr><tr><td>总资源</td><td>&lt;1MB (gzip)</td></tr></tbody></table><hr><h2 id="构建缓存" tabindex="-1">构建缓存 <a class="header-anchor" href="#构建缓存" aria-label="Permalink to &quot;构建缓存&quot;">​</a></h2><h3 id="缓存策略" tabindex="-1">缓存策略 <a class="header-anchor" href="#缓存策略" aria-label="Permalink to &quot;缓存策略&quot;">​</a></h3><table tabindex="0"><thead><tr><th>资源类型</th><th>缓存策略</th></tr></thead><tbody><tr><td>带 hash 的资源</td><td>长期缓存（1年）</td></tr><tr><td>index.html</td><td>不缓存</td></tr><tr><td>Service Worker</td><td>不缓存</td></tr></tbody></table><h3 id="缓存头配置" tabindex="-1">缓存头配置 <a class="header-anchor" href="#缓存头配置" aria-label="Permalink to &quot;缓存头配置&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 带 hash 的资源</span></span>
<span class="line"><span>Cache-Control: public, max-age=31536000, immutable</span></span>
<span class="line"><span></span></span>
<span class="line"><span># HTML 入口</span></span>
<span class="line"><span>Cache-Control: no-cache, no-store, must-revalidate</span></span></code></pre></div><hr><h2 id="多环境配置" tabindex="-1">多环境配置 <a class="header-anchor" href="#多环境配置" aria-label="Permalink to &quot;多环境配置&quot;">​</a></h2><h3 id="环境差异" tabindex="-1">环境差异 <a class="header-anchor" href="#环境差异" aria-label="Permalink to &quot;环境差异&quot;">​</a></h3><table tabindex="0"><thead><tr><th>配置项</th><th>开发</th><th>预发布</th><th>生产</th></tr></thead><tbody><tr><td>API URL</td><td>localhost</td><td>staging.api</td><td>api</td></tr><tr><td>Source Map</td><td>inline</td><td>hidden</td><td>hidden</td></tr><tr><td>压缩</td><td>否</td><td>是</td><td>是</td></tr><tr><td>调试工具</td><td>启用</td><td>启用</td><td>禁用</td></tr></tbody></table><h3 id="配置切换" tabindex="-1">配置切换 <a class="header-anchor" href="#配置切换" aria-label="Permalink to &quot;配置切换&quot;">​</a></h3><ul><li><strong>MUST</strong> 通过环境变量切换配置</li><li><strong>MUST NOT</strong> 在代码中硬编码环境配置</li><li><strong>SHOULD</strong> 验证环境变量存在性</li></ul><hr><h2 id="ci-cd-集成" tabindex="-1">CI/CD 集成 <a class="header-anchor" href="#ci-cd-集成" aria-label="Permalink to &quot;CI/CD 集成&quot;">​</a></h2><h3 id="构建检查" tabindex="-1">构建检查 <a class="header-anchor" href="#构建检查" aria-label="Permalink to &quot;构建检查&quot;">​</a></h3><ul><li><strong>MUST</strong> 类型检查通过</li><li><strong>MUST</strong> 测试通过</li><li><strong>MUST</strong> 构建成功</li><li><strong>SHOULD</strong> 包体积在预算内</li><li><strong>SHOULD</strong> 无安全漏洞依赖</li></ul><h3 id="构建产物" tabindex="-1">构建产物 <a class="header-anchor" href="#构建产物" aria-label="Permalink to &quot;构建产物&quot;">​</a></h3><table tabindex="0"><thead><tr><th>产物</th><th>用途</th></tr></thead><tbody><tr><td>dist-web/</td><td>Web 部署</td></tr><tr><td>dist-dweb/</td><td>DWEB 打包</td></tr><tr><td>stats.html</td><td>包分析报告</td></tr><tr><td>coverage/</td><td>测试覆盖率</td></tr></tbody></table><hr><h2 id="本章小结" tabindex="-1">本章小结 <a class="header-anchor" href="#本章小结" aria-label="Permalink to &quot;本章小结&quot;">​</a></h2><ul><li>支持多目标构建（Web/DWEB）</li><li>通过环境变量切换平台实现</li><li>代码分割优化首屏加载</li><li>设置包体积预算控制质量</li><li>合理的缓存策略提升性能</li></ul>`,65)])])}const u=t(d,[["render",l]]);export{b as __pageData,u as default};
