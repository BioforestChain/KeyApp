import{_ as i,c as a,o as t,ag as s}from"./chunks/framework.B0we9iV-.js";const k=JSON.parse('{"title":"Bitcoin Provider (UTXO)","description":"","frontmatter":{},"headers":[],"relativePath":"white-book/02-Driver-Ref/03-UTXO/01-BTC-Provider.md","filePath":"white-book/02-Driver-Ref/03-UTXO/01-BTC-Provider.md"}'),o={name:"white-book/02-Driver-Ref/03-UTXO/01-BTC-Provider.md"};function l(r,e,n,d,h,c){return t(),a("div",null,[...e[0]||(e[0]=[s(`<h1 id="bitcoin-provider-utxo" tabindex="-1">Bitcoin Provider (UTXO) <a class="header-anchor" href="#bitcoin-provider-utxo" aria-label="Permalink to &quot;Bitcoin Provider (UTXO)&quot;">​</a></h1><blockquote><p><strong>Code Source</strong>: <code>src/services/chain-adapter/providers/btcwallet-provider.effect.ts</code></p></blockquote><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The <code>BtcWalletProviderEffect</code> implements the <code>ApiProvider</code> interface for Bitcoin-like UTXO chains. It relies on a Blockbook-compatible backend API (btcwallet) to fetch balances, transaction history, and single-transaction detail. It also uses Blockbook endpoints for fee estimation, UTXO collection, and raw-transaction broadcast.</p><h2 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to &quot;Architecture&quot;">​</a></h2><div class="language-mermaid vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">graph TD</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    A[ChainProvider] --&gt; B[BtcWalletProviderEffect]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    B --&gt; C[btcwallet-v1 (Blockbook Proxy)]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    C --&gt; D[Bitcoin Node]</span></span></code></pre></div><h2 id="implementation-details" tabindex="-1">Implementation Details <a class="header-anchor" href="#implementation-details" aria-label="Permalink to &quot;Implementation Details&quot;">​</a></h2><h3 id="class-structure" tabindex="-1">Class Structure <a class="header-anchor" href="#class-structure" aria-label="Permalink to &quot;Class Structure&quot;">​</a></h3><ul><li><strong>Class</strong>: <code>BtcWalletProviderEffect</code></li><li><strong>Implements</strong>: <code>ApiProvider</code></li><li><strong>Location</strong>: <code>src/services/chain-adapter/providers/btcwallet-provider.effect.ts</code></li></ul><h3 id="key-features" tabindex="-1">Key Features <a class="header-anchor" href="#key-features" aria-label="Permalink to &quot;Key Features&quot;">​</a></h3><ol><li><p><strong>Native Balance</strong>:</p><ul><li>Fetches address info via <code>/api/v2/address/{address}?details=txs</code>.</li><li>Balance derived from Blockbook <code>balance</code> field.</li><li>Cache: TTL 5s (browser cache).</li></ul></li><li><p><strong>Transaction History</strong>:</p><ul><li>Uses the same address info endpoint (<code>details=txs</code>) and maps <code>vin/vout</code>.</li><li>Cache: TTL 5s (browser cache).</li></ul></li><li><p><strong>Single Transaction Detail</strong>:</p><ul><li>Fetches <code>/api/v2/tx/{txid}</code> and maps to standard <code>TransactionOutput</code>.</li><li>Cache: TTL 5s (browser cache).</li></ul></li><li><p><strong>Fee Estimate / UTXO / Broadcast</strong>:</p><ul><li>Fee estimate: <code>/api/v2/estimatefee/{blocks}</code></li><li>UTXO list: <code>/api/v2/utxo/{address}</code></li><li>Broadcast raw tx: <code>/api/v2/sendtx/{hex}</code></li></ul></li></ol><h3 id="data-models" tabindex="-1">Data Models <a class="header-anchor" href="#data-models" aria-label="Permalink to &quot;Data Models&quot;">​</a></h3><h4 id="blockbook-response-schemas-proxy" tabindex="-1">Blockbook Response Schemas (Proxy) <a class="header-anchor" href="#blockbook-response-schemas-proxy" aria-label="Permalink to &quot;Blockbook Response Schemas (Proxy)&quot;">​</a></h4><p>btcwallet 使用 Blockbook 代理，所有请求通过 walletapi POST 代理执行：</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">POST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wallet</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">btc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">blockbook</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">body</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/api/v2/address/{address}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><h4 id="logic-direction-value" tabindex="-1">Logic: Direction &amp; Value <a class="header-anchor" href="#logic-direction-value" aria-label="Permalink to &quot;Logic: Direction &amp; Value&quot;">​</a></h4><p>The provider calculates the net value change for the user&#39;s address to determine the transaction direction:</p><ul><li><strong>Incoming (<code>in</code>)</strong>: Net value &gt; 0.</li><li><strong>Outgoing (<code>out</code>)</strong>: Net value &lt; 0.</li><li><strong>Self (<code>self</code>)</strong>: Net value = 0 (e.g., consolidation).</li></ul><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> inSum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sumValues</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tx.vin, address)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> outSum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sumValues</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tx.vout, address)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> net</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> outSum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> inSum</span></span></code></pre></div><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h2><ul><li><strong>Type</strong>: <code>btcwallet-v1</code></li><li><strong>Endpoint</strong>: URL of the Blockbook API (e.g., <code>https://btc.bioforest.io</code>).</li><li><strong>Chain ID</strong>: Passed during initialization to fetch symbol and decimals.</li></ul><h2 id="caching-strategy-httpfetchcached" tabindex="-1">Caching Strategy (httpFetchCached) <a class="header-anchor" href="#caching-strategy-httpfetchcached" aria-label="Permalink to &quot;Caching Strategy (httpFetchCached)&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Data</th><th>Strategy</th><th>TTL</th></tr></thead><tbody><tr><td>Address Info / History</td><td>ttl</td><td>5s</td></tr><tr><td>Transaction Detail</td><td>ttl</td><td>5s</td></tr><tr><td>UTXO</td><td>ttl</td><td>15s</td></tr><tr><td>Estimate Fee</td><td>ttl</td><td>30s</td></tr></tbody></table><h2 id="error-handling" tabindex="-1">Error Handling <a class="header-anchor" href="#error-handling" aria-label="Permalink to &quot;Error Handling&quot;">​</a></h2><ul><li>Validates API responses using Zod schemas (<code>BlockbookErrorSchema</code>, <code>BlockbookAddressInfoSchema</code>).</li><li>Throws specific errors for API failures or invalid data.</li></ul><h2 id="future-improvements" tabindex="-1">Future Improvements <a class="header-anchor" href="#future-improvements" aria-label="Permalink to &quot;Future Improvements&quot;">​</a></h2><ul><li>[ ] Support for XPUB derived addresses.</li><li>[ ] Enhanced fee strategy (multi-target).</li></ul>`,27)])])}const u=i(o,[["render",l]]);export{k as __pageData,u as default};
