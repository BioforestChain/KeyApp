"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function h(i,e,t,r){var n=arguments.length,s=n<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(i,e,t,r);else for(var a=i.length-1;a>=0;a--)(o=i[a])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s}function Oe(i,e){return function(t,r){e(t,r,i)}}function u(i,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,e)}const $m=new WeakMap;function Ys(i,e,t){if(!t||typeof t.value!="function")throw new TypeError(`Only methods can be decorated with @cacheBytesGetter. <${e}> is not a method!`);const r=t.value,n=function(...s){if(Object.isFrozen(this)){const a=JSON.stringify(s);let p=$m.get(this);p||(p=new Map,$m.set(this,p));let l=p.get(a);return l||(l=r.apply(this,s),p.set(a,l)),l}return r.apply(this,s)};return t.value=n,t}var Um=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ho(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var YA={};(function(i){var e=i;e.length=function(a){var p=a.length;if(!p)return 0;for(var l=0;--p%4>1&&a.charAt(p)==="=";)++l;return Math.ceil(a.length*3)/4-l};for(var t=new Array(64),r=new Array(123),n=0;n<64;)r[t[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;e.encode=function(a,p,l){for(var f=null,g=[],d=0,y=0,m;p<l;){var E=a[p++];switch(y){case 0:g[d++]=t[E>>2],m=(E&3)<<4,y=1;break;case 1:g[d++]=t[m|E>>4],m=(E&15)<<2,y=2;break;case 2:g[d++]=t[m|E>>6],g[d++]=t[E&63],y=0;break}d>8191&&((f||(f=[])).push(String.fromCharCode.apply(String,g)),d=0)}return y&&(g[d++]=t[m],g[d++]=61,y===1&&(g[d++]=61)),f?(d&&f.push(String.fromCharCode.apply(String,g.slice(0,d))),f.join("")):String.fromCharCode.apply(String,g.slice(0,d))};var s="invalid encoding";e.decode=function(a,p,l){for(var f=l,g=0,d,y=0;y<a.length;){var m=a.charCodeAt(y++);if(m===61&&g>1)break;if((m=r[m])===void 0)throw Error(s);switch(g){case 0:d=m,g=1;break;case 1:p[l++]=d<<2|(m&48)>>4,d=m,g=2;break;case 2:p[l++]=(d&15)<<4|(m&60)>>2,d=m,g=3;break;case 3:p[l++]=(d&3)<<6|m,g=0;break}}if(g===1)throw Error(s);return l-f},e.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}})(YA);const Jf=ho(YA);let En;try{if(typeof WebAssembly=="object"){const i="AGFzbQEAAAABDQJgAAF/YAR/f39/AX8DBwYAAQEBAQEGBgF/AUEACwcyBgNtdWwAAQVkaXZfcwACBWRpdl91AAMFcmVtX3MABAVyZW1fdQAFCGdldF9oaWdoAAAKvwEGBAAjAAskAQF+IACtIAGtQiCGhCACrSADrUIghoR+IgRCIIenJAAgBKcLJAEBfiAArSABrUIghoQgAq0gA61CIIaEfyIEQiCHpyQAIASnCyQBAX4gAK0gAa1CIIaEIAKtIAOtQiCGhIAiBEIgh6ckACAEpwskAQF+IACtIAGtQiCGhCACrSADrUIghoSBIgRCIIenJAAgBKcLJAEBfiAArSABrUIghoQgAq0gA61CIIaEgiIEQiCHpyQAIASnCw==",e=new Uint8Array(Jf.length(i));Jf.decode(i,e,0),En=new WebAssembly.Instance(new WebAssembly.Module(e),{}).exports}}catch{}let jt=class ge{constructor(e,t,r){this.__isLong__=!0,this.low=e|0,this.high=t|0,this.unsigned=!!r}static isLong(e){return(e&&e.__isLong__)===!0}static fromInt(e,t){var r,n,s;return t?(e>>>=0,(s=0<=e&&e<256)&&(n=this._UINT_CACHE[e],n)?n:(r=this.fromBits(e,(e|0)<0?-1:0,!0),s&&(this._UINT_CACHE[e]=r),r)):(e|=0,(s=-128<=e&&e<128)&&(n=this._INT_CACHE[e],n)?n:(r=this.fromBits(e,e<0?-1:0,!1),s&&(this._INT_CACHE[e]=r),r))}static fromNumber(e,t){if(isNaN(e))return t?ge.UZERO:ge.ZERO;if(t){if(e<0)return ge.UZERO;if(e>=QA)return ge.MAX_UNSIGNED_VALUE}else{if(e<=-Gm)return ge.MIN_VALUE;if(e+1>=Gm)return ge.MAX_VALUE}return e<0?this.fromNumber(-e,t).neg():this.fromBits(e%qo|0,e/qo|0,t)}static fromBits(e,t,r){return new ge(e,t,r)}static fromString(e,t,r){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return ge.ZERO;if(typeof t=="number"?(r=t,t=!1):t=!!t,r=r||10,r<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return this.fromString(e.substring(1),t,r).neg();for(var s=this.fromNumber(ah(r,8)),o=ge.ZERO,a=0;a<e.length;a+=8){var p=Math.min(8,e.length-a),l=parseInt(e.substring(a,a+p),r);if(p<8){var f=this.fromNumber(ah(r,p));o=o.mul(f).add(this.fromNumber(l))}else o=o.mul(s),o=o.add(this.fromNumber(l))}return o.unsigned=t,o}static fromValue(e,t){return typeof e=="number"?this.fromNumber(e,t):typeof e=="string"?this.fromString(e,t):this.fromBits(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){return this.unsigned?(this.high>>>0)*qo+(this.low>>>0):this.high*qo+(this.low>>>0)}toString(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ge.MIN_VALUE)){var t=ge.fromNumber(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=ge.fromNumber(ah(e,6),this.unsigned),o=this,a="";;){var p=o.div(s),l=o.sub(p.mul(s)).toInt()>>>0,f=l.toString(e);if(o=p,o.isZero())return f+a;for(;f.length<6;)f="0"+f;a=""+f+a}}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){if(this.isNegative())return this.eq(ge.MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1}isZero(){return this.high===0&&this.low===0}isNegative(){return!this.unsigned&&this.high<0}isPositive(){return this.unsigned||this.high>=0}isOdd(){return(this.low&1)===1}isEven(){return(this.low&1)===0}equals(e){return ge.isLong(e)||(e=ge.fromValue(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low}notEquals(e){return!this.eq(e)}lessThan(e){return this.comp(e)<0}lessThanOrEqual(e){return this.comp(e)<=0}greaterThan(e){return this.comp(e)>0}greaterThanOrEqual(e){return this.comp(e)>=0}compare(e){if(ge.isLong(e)||(e=ge.fromValue(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1}negate(){return!this.unsigned&&this.eq(ge.MIN_VALUE)?ge.MIN_VALUE:this.not().add(ge.ONE)}add(e){ge.isLong(e)||(e=ge.fromValue(e));var t=this.high>>>16,r=this.high&65535,n=this.low>>>16,s=this.low&65535,o=e.high>>>16,a=e.high&65535,p=e.low>>>16,l=e.low&65535,f=0,g=0,d=0,y=0;return y+=s+l,d+=y>>>16,y&=65535,d+=n+p,g+=d>>>16,d&=65535,g+=r+a,f+=g>>>16,g&=65535,f+=t+o,f&=65535,ge.fromBits(d<<16|y,f<<16|g,this.unsigned)}subtract(e){return ge.isLong(e)||(e=ge.fromValue(e)),this.add(e.neg())}multiply(e){if(this.isZero())return ge.ZERO;if(ge.isLong(e)||(e=ge.fromValue(e)),En){var t=En.mul(this.low,this.high,e.low,e.high);return ge.fromBits(t,En.get_high(),this.unsigned)}if(e.isZero())return ge.ZERO;if(this.eq(ge.MIN_VALUE))return e.isOdd()?ge.MIN_VALUE:ge.ZERO;if(e.eq(ge.MIN_VALUE))return this.isOdd()?ge.MIN_VALUE:ge.ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(zm)&&e.lt(zm))return ge.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,n=this.high&65535,s=this.low>>>16,o=this.low&65535,a=e.high>>>16,p=e.high&65535,l=e.low>>>16,f=e.low&65535,g=0,d=0,y=0,m=0;return m+=o*f,y+=m>>>16,m&=65535,y+=s*f,d+=y>>>16,y&=65535,y+=o*l,d+=y>>>16,y&=65535,d+=n*f,g+=d>>>16,d&=65535,d+=s*l,g+=d>>>16,d&=65535,d+=o*p,g+=d>>>16,d&=65535,g+=r*f+n*l+s*p+o*a,g&=65535,ge.fromBits(y<<16|m,g<<16|d,this.unsigned)}divide(e){if(ge.isLong(e)||(e=ge.fromValue(e)),e.isZero())throw Error("division by zero");if(En){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?En.div_u:En.div_s)(this.low,this.high,e.low,e.high);return ge.fromBits(t,En.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ge.UZERO:ge.ZERO;var r,n,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ge.UZERO;if(e.gt(this.shru(1)))return ge.UONE;s=ge.UZERO}else{if(this.eq(ge.MIN_VALUE)){if(e.eq(ge.ONE)||e.eq(ge.NEG_ONE))return ge.MIN_VALUE;if(e.eq(ge.MIN_VALUE))return ge.ONE;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(ge.ZERO)?e.isNegative()?ge.ONE:ge.NEG_ONE:(n=this.sub(e.mul(r)),s=r.add(n.div(e)),s)}else if(e.eq(ge.MIN_VALUE))return this.unsigned?ge.UZERO:ge.ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=ge.ZERO}for(n=this;n.gte(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),p=a<=48?1:ah(2,a-48),l=ge.fromNumber(r),f=l.mul(e);f.isNegative()||f.gt(n);)r-=p,l=ge.fromNumber(r,this.unsigned),f=l.mul(e);l.isZero()&&(l=ge.ONE),s=s.add(l),n=n.sub(f)}return s}modulo(e){if(ge.isLong(e)||(e=ge.fromValue(e)),En){var t=(this.unsigned?En.rem_u:En.rem_s)(this.low,this.high,e.low,e.high);return ge.fromBits(t,En.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))}not(){return ge.fromBits(~this.low,~this.high,this.unsigned)}and(e){return ge.isLong(e)||(e=ge.fromValue(e)),ge.fromBits(this.low&e.low,this.high&e.high,this.unsigned)}or(e){return ge.isLong(e)||(e=ge.fromValue(e)),ge.fromBits(this.low|e.low,this.high|e.high,this.unsigned)}xor(e){return ge.isLong(e)||(e=ge.fromValue(e)),ge.fromBits(this.low^e.low,this.high^e.high,this.unsigned)}shiftLeft(e){return ge.isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ge.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ge.fromBits(0,this.low<<e-32,this.unsigned)}shiftRight(e){return ge.isLong(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ge.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ge.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)}shiftRightUnsigned(e){if(ge.isLong(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return ge.fromBits(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?ge.fromBits(t,0,this.unsigned):ge.fromBits(t>>>e-32,0,this.unsigned)}toSigned(){return this.unsigned?ge.fromBits(this.low,this.high,!1):this}toUnsigned(){return this.unsigned?this:ge.fromBits(this.low,this.high,!0)}toBytes(e){return e?this.toBytesLE():this.toBytesBE()}toBytesLE(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]}toBytesBE(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]}static fromBytes(e,t,r){return r?ge.fromBytesLE(e,t):this.fromBytesBE(e,t)}static fromBytesLE(e,t){return new ge(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)}static fromBytesBE(e,t){return new ge(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}};jt._INT_CACHE=Object.create(null);jt._UINT_CACHE=Object.create(null);jt.ZERO=jt.fromInt(0);jt.UZERO=jt.fromInt(0,!0);jt.ONE=jt.fromInt(1);jt.UONE=jt.fromInt(1,!0);jt.NEG_ONE=jt.fromInt(-1);jt.MAX_VALUE=jt.fromBits(-1,2147483647,!1);jt.MAX_UNSIGNED_VALUE=jt.fromBits(-1,-1,!0);jt.MIN_VALUE=jt.fromBits(0,-2147483648,!1);const ah=Math.pow,Km=65536,hI=1<<24,qo=Km*Km,QA=qo*qo,Gm=QA/2,zm=jt.fromInt(hI),ze=jt.prototype;ze.eqz=ze.isZero;ze.eq=ze.equals;ze.neq=ze.notEquals;ze.ne=ze.notEquals;ze.lt=ze.lessThan;ze.lte=ze.lessThanOrEqual;ze.le=ze.lessThanOrEqual;ze.gt=ze.greaterThan;ze.gte=ze.greaterThanOrEqual;ze.ge=ze.greaterThanOrEqual;ze.comp=ze.compare;ze.neg=ze.negate;ze.sub=ze.subtract;ze.mul=ze.multiply;ze.div=ze.divide;ze.mod=ze.modulo;ze.rem=ze.modulo;ze.shl=ze.shiftLeft;ze.shr=ze.shiftRight;ze.shru=ze.shiftRightUnsigned;ze.shr_u=ze.shiftRightUnsigned;var as={},Vu={};Vu.byteLength=gI;Vu.toByteArray=yI;Vu.fromByteArray=AI;var cs=[],In=[],uI=typeof Uint8Array<"u"?Uint8Array:Array,rf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Co=0,fI=rf.length;Co<fI;++Co)cs[Co]=rf[Co],In[rf.charCodeAt(Co)]=Co;In["-".charCodeAt(0)]=62;In["_".charCodeAt(0)]=63;function WA(i){var e=i.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=i.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function gI(i){var e=WA(i),t=e[0],r=e[1];return(t+r)*3/4-r}function dI(i,e,t){return(e+t)*3/4-t}function yI(i){var e,t=WA(i),r=t[0],n=t[1],s=new uI(dI(i,r,n)),o=0,a=n>0?r-4:r,p;for(p=0;p<a;p+=4)e=In[i.charCodeAt(p)]<<18|In[i.charCodeAt(p+1)]<<12|In[i.charCodeAt(p+2)]<<6|In[i.charCodeAt(p+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return n===2&&(e=In[i.charCodeAt(p)]<<2|In[i.charCodeAt(p+1)]>>4,s[o++]=e&255),n===1&&(e=In[i.charCodeAt(p)]<<10|In[i.charCodeAt(p+1)]<<4|In[i.charCodeAt(p+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function mI(i){return cs[i>>18&63]+cs[i>>12&63]+cs[i>>6&63]+cs[i&63]}function _I(i,e,t){for(var r,n=[],s=e;s<t;s+=3)r=(i[s]<<16&16711680)+(i[s+1]<<8&65280)+(i[s+2]&255),n.push(mI(r));return n.join("")}function AI(i){for(var e,t=i.length,r=t%3,n=[],s=16383,o=0,a=t-r;o<a;o+=s)n.push(_I(i,o,o+s>a?a:o+s));return r===1?(e=i[t-1],n.push(cs[e>>2]+cs[e<<4&63]+"==")):r===2&&(e=(i[t-2]<<8)+i[t-1],n.push(cs[e>>10]+cs[e>>4&63]+cs[e<<2&63]+"=")),n.join("")}var sy={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */sy.read=function(i,e,t,r,n){var s,o,a=n*8-r-1,p=(1<<a)-1,l=p>>1,f=-7,g=t?n-1:0,d=t?-1:1,y=i[e+g];for(g+=d,s=y&(1<<-f)-1,y>>=-f,f+=a;f>0;s=s*256+i[e+g],g+=d,f-=8);for(o=s&(1<<-f)-1,s>>=-f,f+=r;f>0;o=o*256+i[e+g],g+=d,f-=8);if(s===0)s=1-l;else{if(s===p)return o?NaN:(y?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-l}return(y?-1:1)*o*Math.pow(2,s-r)};sy.write=function(i,e,t,r,n,s){var o,a,p,l=s*8-n-1,f=(1<<l)-1,g=f>>1,d=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=r?0:s-1,m=r?1:-1,E=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=f):(o=Math.floor(Math.log(e)/Math.LN2),e*(p=Math.pow(2,-o))<1&&(o--,p*=2),o+g>=1?e+=d/p:e+=d*Math.pow(2,1-g),e*p>=2&&(o++,p/=2),o+g>=f?(a=0,o=f):o+g>=1?(a=(e*p-1)*Math.pow(2,n),o=o+g):(a=e*Math.pow(2,g-1)*Math.pow(2,n),o=0));n>=8;i[t+y]=a&255,y+=m,a/=256,n-=8);for(o=o<<n|a,l+=n;l>0;i[t+y]=o&255,y+=m,o/=256,l-=8);i[t+y-m]|=E*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(i){const e=Vu,t=sy,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;i.Buffer=a,i.SlowBuffer=b,i.INSPECT_MAX_BYTES=50;const n=2147483647;i.kMaxLength=n,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const S=new Uint8Array(1),_={foo:function(){return 42}};return Object.setPrototypeOf(_,Uint8Array.prototype),Object.setPrototypeOf(S,_),S.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(S){if(S>n)throw new RangeError('The value "'+S+'" is invalid for option "size"');const _=new Uint8Array(S);return Object.setPrototypeOf(_,a.prototype),_}function a(S,_,I){if(typeof S=="number"){if(typeof _=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return g(S)}return p(S,_,I)}a.poolSize=8192;function p(S,_,I){if(typeof S=="string")return d(S,_);if(ArrayBuffer.isView(S))return m(S);if(S==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof S);if(gn(S,ArrayBuffer)||S&&gn(S.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(gn(S,SharedArrayBuffer)||S&&gn(S.buffer,SharedArrayBuffer)))return E(S,_,I);if(typeof S=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const x=S.valueOf&&S.valueOf();if(x!=null&&x!==S)return a.from(x,_,I);const k=T(S);if(k)return k;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof S[Symbol.toPrimitive]=="function")return a.from(S[Symbol.toPrimitive]("string"),_,I);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof S)}a.from=function(S,_,I){return p(S,_,I)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l(S){if(typeof S!="number")throw new TypeError('"size" argument must be of type number');if(S<0)throw new RangeError('The value "'+S+'" is invalid for option "size"')}function f(S,_,I){return l(S),S<=0?o(S):_!==void 0?typeof I=="string"?o(S).fill(_,I):o(S).fill(_):o(S)}a.alloc=function(S,_,I){return f(S,_,I)};function g(S){return l(S),o(S<0?0:w(S)|0)}a.allocUnsafe=function(S){return g(S)},a.allocUnsafeSlow=function(S){return g(S)};function d(S,_){if((typeof _!="string"||_==="")&&(_="utf8"),!a.isEncoding(_))throw new TypeError("Unknown encoding: "+_);const I=C(S,_)|0;let x=o(I);const k=x.write(S,_);return k!==I&&(x=x.slice(0,k)),x}function y(S){const _=S.length<0?0:w(S.length)|0,I=o(_);for(let x=0;x<_;x+=1)I[x]=S[x]&255;return I}function m(S){if(gn(S,Uint8Array)){const _=new Uint8Array(S);return E(_.buffer,_.byteOffset,_.byteLength)}return y(S)}function E(S,_,I){if(_<0||S.byteLength<_)throw new RangeError('"offset" is outside of buffer bounds');if(S.byteLength<_+(I||0))throw new RangeError('"length" is outside of buffer bounds');let x;return _===void 0&&I===void 0?x=new Uint8Array(S):I===void 0?x=new Uint8Array(S,_):x=new Uint8Array(S,_,I),Object.setPrototypeOf(x,a.prototype),x}function T(S){if(a.isBuffer(S)){const _=w(S.length)|0,I=o(_);return I.length===0||S.copy(I,0,0,_),I}if(S.length!==void 0)return typeof S.length!="number"||Fi(S.length)?o(0):y(S);if(S.type==="Buffer"&&Array.isArray(S.data))return y(S.data)}function w(S){if(S>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return S|0}function b(S){return+S!=S&&(S=0),a.alloc(+S)}a.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==a.prototype},a.compare=function(_,I){if(gn(_,Uint8Array)&&(_=a.from(_,_.offset,_.byteLength)),gn(I,Uint8Array)&&(I=a.from(I,I.offset,I.byteLength)),!a.isBuffer(_)||!a.isBuffer(I))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===I)return 0;let x=_.length,k=I.length;for(let $=0,Z=Math.min(x,k);$<Z;++$)if(_[$]!==I[$]){x=_[$],k=I[$];break}return x<k?-1:k<x?1:0},a.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(_,I){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return a.alloc(0);let x;if(I===void 0)for(I=0,x=0;x<_.length;++x)I+=_[x].length;const k=a.allocUnsafe(I);let $=0;for(x=0;x<_.length;++x){let Z=_[x];if(gn(Z,Uint8Array))$+Z.length>k.length?(a.isBuffer(Z)||(Z=a.from(Z)),Z.copy(k,$)):Uint8Array.prototype.set.call(k,Z,$);else if(a.isBuffer(Z))Z.copy(k,$);else throw new TypeError('"list" argument must be an Array of Buffers');$+=Z.length}return k};function C(S,_){if(a.isBuffer(S))return S.length;if(ArrayBuffer.isView(S)||gn(S,ArrayBuffer))return S.byteLength;if(typeof S!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof S);const I=S.length,x=arguments.length>2&&arguments[2]===!0;if(!x&&I===0)return 0;let k=!1;for(;;)switch(_){case"ascii":case"latin1":case"binary":return I;case"utf8":case"utf-8":return lc(S).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I*2;case"hex":return I>>>1;case"base64":return oh(S).length;default:if(k)return x?-1:lc(S).length;_=(""+_).toLowerCase(),k=!0}}a.byteLength=C;function N(S,_,I){let x=!1;if((_===void 0||_<0)&&(_=0),_>this.length||((I===void 0||I>this.length)&&(I=this.length),I<=0)||(I>>>=0,_>>>=0,I<=_))return"";for(S||(S="utf8");;)switch(S){case"hex":return Ae(this,_,I);case"utf8":case"utf-8":return D(this,_,I);case"ascii":return ue(this,_,I);case"latin1":case"binary":return Ee(this,_,I);case"base64":return U(this,_,I);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,_,I);default:if(x)throw new TypeError("Unknown encoding: "+S);S=(S+"").toLowerCase(),x=!0}}a.prototype._isBuffer=!0;function O(S,_,I){const x=S[_];S[_]=S[I],S[I]=x}a.prototype.swap16=function(){const _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let I=0;I<_;I+=2)O(this,I,I+1);return this},a.prototype.swap32=function(){const _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let I=0;I<_;I+=4)O(this,I,I+3),O(this,I+1,I+2);return this},a.prototype.swap64=function(){const _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let I=0;I<_;I+=8)O(this,I,I+7),O(this,I+1,I+6),O(this,I+2,I+5),O(this,I+3,I+4);return this},a.prototype.toString=function(){const _=this.length;return _===0?"":arguments.length===0?D(this,0,_):N.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(_){if(!a.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:a.compare(this,_)===0},a.prototype.inspect=function(){let _="";const I=i.INSPECT_MAX_BYTES;return _=this.toString("hex",0,I).replace(/(.{2})/g,"$1 ").trim(),this.length>I&&(_+=" ... "),"<Buffer "+_+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(_,I,x,k,$){if(gn(_,Uint8Array)&&(_=a.from(_,_.offset,_.byteLength)),!a.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(I===void 0&&(I=0),x===void 0&&(x=_?_.length:0),k===void 0&&(k=0),$===void 0&&($=this.length),I<0||x>_.length||k<0||$>this.length)throw new RangeError("out of range index");if(k>=$&&I>=x)return 0;if(k>=$)return-1;if(I>=x)return 1;if(I>>>=0,x>>>=0,k>>>=0,$>>>=0,this===_)return 0;let Z=$-k,xe=x-I;const it=Math.min(Z,xe),yt=this.slice(k,$),Bt=_.slice(I,x);for(let mt=0;mt<it;++mt)if(yt[mt]!==Bt[mt]){Z=yt[mt],xe=Bt[mt];break}return Z<xe?-1:xe<Z?1:0};function R(S,_,I,x,k){if(S.length===0)return-1;if(typeof I=="string"?(x=I,I=0):I>2147483647?I=2147483647:I<-2147483648&&(I=-2147483648),I=+I,Fi(I)&&(I=k?0:S.length-1),I<0&&(I=S.length+I),I>=S.length){if(k)return-1;I=S.length-1}else if(I<0)if(k)I=0;else return-1;if(typeof _=="string"&&(_=a.from(_,x)),a.isBuffer(_))return _.length===0?-1:F(S,_,I,x,k);if(typeof _=="number")return _=_&255,typeof Uint8Array.prototype.indexOf=="function"?k?Uint8Array.prototype.indexOf.call(S,_,I):Uint8Array.prototype.lastIndexOf.call(S,_,I):F(S,[_],I,x,k);throw new TypeError("val must be string, number or Buffer")}function F(S,_,I,x,k){let $=1,Z=S.length,xe=_.length;if(x!==void 0&&(x=String(x).toLowerCase(),x==="ucs2"||x==="ucs-2"||x==="utf16le"||x==="utf-16le")){if(S.length<2||_.length<2)return-1;$=2,Z/=2,xe/=2,I/=2}function it(Bt,mt){return $===1?Bt[mt]:Bt.readUInt16BE(mt*$)}let yt;if(k){let Bt=-1;for(yt=I;yt<Z;yt++)if(it(S,yt)===it(_,Bt===-1?0:yt-Bt)){if(Bt===-1&&(Bt=yt),yt-Bt+1===xe)return Bt*$}else Bt!==-1&&(yt-=yt-Bt),Bt=-1}else for(I+xe>Z&&(I=Z-xe),yt=I;yt>=0;yt--){let Bt=!0;for(let mt=0;mt<xe;mt++)if(it(S,yt+mt)!==it(_,mt)){Bt=!1;break}if(Bt)return yt}return-1}a.prototype.includes=function(_,I,x){return this.indexOf(_,I,x)!==-1},a.prototype.indexOf=function(_,I,x){return R(this,_,I,x,!0)},a.prototype.lastIndexOf=function(_,I,x){return R(this,_,I,x,!1)};function z(S,_,I,x){I=Number(I)||0;const k=S.length-I;x?(x=Number(x),x>k&&(x=k)):x=k;const $=_.length;x>$/2&&(x=$/2);let Z;for(Z=0;Z<x;++Z){const xe=parseInt(_.substr(Z*2,2),16);if(Fi(xe))return Z;S[I+Z]=xe}return Z}function K(S,_,I,x){return Oo(lc(_,S.length-I),S,I,x)}function B(S,_,I,x){return Oo(tf(_),S,I,x)}function M(S,_,I,x){return Oo(oh(_),S,I,x)}function V(S,_,I,x){return Oo(hc(_,S.length-I),S,I,x)}a.prototype.write=function(_,I,x,k){if(I===void 0)k="utf8",x=this.length,I=0;else if(x===void 0&&typeof I=="string")k=I,x=this.length,I=0;else if(isFinite(I))I=I>>>0,isFinite(x)?(x=x>>>0,k===void 0&&(k="utf8")):(k=x,x=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const $=this.length-I;if((x===void 0||x>$)&&(x=$),_.length>0&&(x<0||I<0)||I>this.length)throw new RangeError("Attempt to write outside buffer bounds");k||(k="utf8");let Z=!1;for(;;)switch(k){case"hex":return z(this,_,I,x);case"utf8":case"utf-8":return K(this,_,I,x);case"ascii":case"latin1":case"binary":return B(this,_,I,x);case"base64":return M(this,_,I,x);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,_,I,x);default:if(Z)throw new TypeError("Unknown encoding: "+k);k=(""+k).toLowerCase(),Z=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function U(S,_,I){return _===0&&I===S.length?e.fromByteArray(S):e.fromByteArray(S.slice(_,I))}function D(S,_,I){I=Math.min(S.length,I);const x=[];let k=_;for(;k<I;){const $=S[k];let Z=null,xe=$>239?4:$>223?3:$>191?2:1;if(k+xe<=I){let it,yt,Bt,mt;switch(xe){case 1:$<128&&(Z=$);break;case 2:it=S[k+1],(it&192)===128&&(mt=($&31)<<6|it&63,mt>127&&(Z=mt));break;case 3:it=S[k+1],yt=S[k+2],(it&192)===128&&(yt&192)===128&&(mt=($&15)<<12|(it&63)<<6|yt&63,mt>2047&&(mt<55296||mt>57343)&&(Z=mt));break;case 4:it=S[k+1],yt=S[k+2],Bt=S[k+3],(it&192)===128&&(yt&192)===128&&(Bt&192)===128&&(mt=($&15)<<18|(it&63)<<12|(yt&63)<<6|Bt&63,mt>65535&&mt<1114112&&(Z=mt))}}Z===null?(Z=65533,xe=1):Z>65535&&(Z-=65536,x.push(Z>>>10&1023|55296),Z=56320|Z&1023),x.push(Z),k+=xe}return ae(x)}const W=4096;function ae(S){const _=S.length;if(_<=W)return String.fromCharCode.apply(String,S);let I="",x=0;for(;x<_;)I+=String.fromCharCode.apply(String,S.slice(x,x+=W));return I}function ue(S,_,I){let x="";I=Math.min(S.length,I);for(let k=_;k<I;++k)x+=String.fromCharCode(S[k]&127);return x}function Ee(S,_,I){let x="";I=Math.min(S.length,I);for(let k=_;k<I;++k)x+=String.fromCharCode(S[k]);return x}function Ae(S,_,I){const x=S.length;(!_||_<0)&&(_=0),(!I||I<0||I>x)&&(I=x);let k="";for(let $=_;$<I;++$)k+=q[S[$]];return k}function P(S,_,I){const x=S.slice(_,I);let k="";for(let $=0;$<x.length-1;$+=2)k+=String.fromCharCode(x[$]+x[$+1]*256);return k}a.prototype.slice=function(_,I){const x=this.length;_=~~_,I=I===void 0?x:~~I,_<0?(_+=x,_<0&&(_=0)):_>x&&(_=x),I<0?(I+=x,I<0&&(I=0)):I>x&&(I=x),I<_&&(I=_);const k=this.subarray(_,I);return Object.setPrototypeOf(k,a.prototype),k};function ee(S,_,I){if(S%1!==0||S<0)throw new RangeError("offset is not uint");if(S+_>I)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(_,I,x){_=_>>>0,I=I>>>0,x||ee(_,I,this.length);let k=this[_],$=1,Z=0;for(;++Z<I&&($*=256);)k+=this[_+Z]*$;return k},a.prototype.readUintBE=a.prototype.readUIntBE=function(_,I,x){_=_>>>0,I=I>>>0,x||ee(_,I,this.length);let k=this[_+--I],$=1;for(;I>0&&($*=256);)k+=this[_+--I]*$;return k},a.prototype.readUint8=a.prototype.readUInt8=function(_,I){return _=_>>>0,I||ee(_,1,this.length),this[_]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(_,I){return _=_>>>0,I||ee(_,2,this.length),this[_]|this[_+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(_,I){return _=_>>>0,I||ee(_,2,this.length),this[_]<<8|this[_+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(_,I){return _=_>>>0,I||ee(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(_,I){return _=_>>>0,I||ee(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},a.prototype.readBigUInt64LE=ie(function(_){_=_>>>0,rt(_,"offset");const I=this[_],x=this[_+7];(I===void 0||x===void 0)&&st(_,this.length-8);const k=I+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24,$=this[++_]+this[++_]*2**8+this[++_]*2**16+x*2**24;return BigInt(k)+(BigInt($)<<BigInt(32))}),a.prototype.readBigUInt64BE=ie(function(_){_=_>>>0,rt(_,"offset");const I=this[_],x=this[_+7];(I===void 0||x===void 0)&&st(_,this.length-8);const k=I*2**24+this[++_]*2**16+this[++_]*2**8+this[++_],$=this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+x;return(BigInt(k)<<BigInt(32))+BigInt($)}),a.prototype.readIntLE=function(_,I,x){_=_>>>0,I=I>>>0,x||ee(_,I,this.length);let k=this[_],$=1,Z=0;for(;++Z<I&&($*=256);)k+=this[_+Z]*$;return $*=128,k>=$&&(k-=Math.pow(2,8*I)),k},a.prototype.readIntBE=function(_,I,x){_=_>>>0,I=I>>>0,x||ee(_,I,this.length);let k=I,$=1,Z=this[_+--k];for(;k>0&&($*=256);)Z+=this[_+--k]*$;return $*=128,Z>=$&&(Z-=Math.pow(2,8*I)),Z},a.prototype.readInt8=function(_,I){return _=_>>>0,I||ee(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},a.prototype.readInt16LE=function(_,I){_=_>>>0,I||ee(_,2,this.length);const x=this[_]|this[_+1]<<8;return x&32768?x|4294901760:x},a.prototype.readInt16BE=function(_,I){_=_>>>0,I||ee(_,2,this.length);const x=this[_+1]|this[_]<<8;return x&32768?x|4294901760:x},a.prototype.readInt32LE=function(_,I){return _=_>>>0,I||ee(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},a.prototype.readInt32BE=function(_,I){return _=_>>>0,I||ee(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},a.prototype.readBigInt64LE=ie(function(_){_=_>>>0,rt(_,"offset");const I=this[_],x=this[_+7];(I===void 0||x===void 0)&&st(_,this.length-8);const k=this[_+4]+this[_+5]*2**8+this[_+6]*2**16+(x<<24);return(BigInt(k)<<BigInt(32))+BigInt(I+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24)}),a.prototype.readBigInt64BE=ie(function(_){_=_>>>0,rt(_,"offset");const I=this[_],x=this[_+7];(I===void 0||x===void 0)&&st(_,this.length-8);const k=(I<<24)+this[++_]*2**16+this[++_]*2**8+this[++_];return(BigInt(k)<<BigInt(32))+BigInt(this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+x)}),a.prototype.readFloatLE=function(_,I){return _=_>>>0,I||ee(_,4,this.length),t.read(this,_,!0,23,4)},a.prototype.readFloatBE=function(_,I){return _=_>>>0,I||ee(_,4,this.length),t.read(this,_,!1,23,4)},a.prototype.readDoubleLE=function(_,I){return _=_>>>0,I||ee(_,8,this.length),t.read(this,_,!0,52,8)},a.prototype.readDoubleBE=function(_,I){return _=_>>>0,I||ee(_,8,this.length),t.read(this,_,!1,52,8)};function ye(S,_,I,x,k,$){if(!a.isBuffer(S))throw new TypeError('"buffer" argument must be a Buffer instance');if(_>k||_<$)throw new RangeError('"value" argument is out of bounds');if(I+x>S.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(_,I,x,k){if(_=+_,I=I>>>0,x=x>>>0,!k){const xe=Math.pow(2,8*x)-1;ye(this,_,I,x,xe,0)}let $=1,Z=0;for(this[I]=_&255;++Z<x&&($*=256);)this[I+Z]=_/$&255;return I+x},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(_,I,x,k){if(_=+_,I=I>>>0,x=x>>>0,!k){const xe=Math.pow(2,8*x)-1;ye(this,_,I,x,xe,0)}let $=x-1,Z=1;for(this[I+$]=_&255;--$>=0&&(Z*=256);)this[I+$]=_/Z&255;return I+x},a.prototype.writeUint8=a.prototype.writeUInt8=function(_,I,x){return _=+_,I=I>>>0,x||ye(this,_,I,1,255,0),this[I]=_&255,I+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(_,I,x){return _=+_,I=I>>>0,x||ye(this,_,I,2,65535,0),this[I]=_&255,this[I+1]=_>>>8,I+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(_,I,x){return _=+_,I=I>>>0,x||ye(this,_,I,2,65535,0),this[I]=_>>>8,this[I+1]=_&255,I+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(_,I,x){return _=+_,I=I>>>0,x||ye(this,_,I,4,4294967295,0),this[I+3]=_>>>24,this[I+2]=_>>>16,this[I+1]=_>>>8,this[I]=_&255,I+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(_,I,x){return _=+_,I=I>>>0,x||ye(this,_,I,4,4294967295,0),this[I]=_>>>24,this[I+1]=_>>>16,this[I+2]=_>>>8,this[I+3]=_&255,I+4};function De(S,_,I,x,k){Ye(_,x,k,S,I,7);let $=Number(_&BigInt(4294967295));S[I++]=$,$=$>>8,S[I++]=$,$=$>>8,S[I++]=$,$=$>>8,S[I++]=$;let Z=Number(_>>BigInt(32)&BigInt(4294967295));return S[I++]=Z,Z=Z>>8,S[I++]=Z,Z=Z>>8,S[I++]=Z,Z=Z>>8,S[I++]=Z,I}function ce(S,_,I,x,k){Ye(_,x,k,S,I,7);let $=Number(_&BigInt(4294967295));S[I+7]=$,$=$>>8,S[I+6]=$,$=$>>8,S[I+5]=$,$=$>>8,S[I+4]=$;let Z=Number(_>>BigInt(32)&BigInt(4294967295));return S[I+3]=Z,Z=Z>>8,S[I+2]=Z,Z=Z>>8,S[I+1]=Z,Z=Z>>8,S[I]=Z,I+8}a.prototype.writeBigUInt64LE=ie(function(_,I=0){return De(this,_,I,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=ie(function(_,I=0){return ce(this,_,I,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(_,I,x,k){if(_=+_,I=I>>>0,!k){const it=Math.pow(2,8*x-1);ye(this,_,I,x,it-1,-it)}let $=0,Z=1,xe=0;for(this[I]=_&255;++$<x&&(Z*=256);)_<0&&xe===0&&this[I+$-1]!==0&&(xe=1),this[I+$]=(_/Z>>0)-xe&255;return I+x},a.prototype.writeIntBE=function(_,I,x,k){if(_=+_,I=I>>>0,!k){const it=Math.pow(2,8*x-1);ye(this,_,I,x,it-1,-it)}let $=x-1,Z=1,xe=0;for(this[I+$]=_&255;--$>=0&&(Z*=256);)_<0&&xe===0&&this[I+$+1]!==0&&(xe=1),this[I+$]=(_/Z>>0)-xe&255;return I+x},a.prototype.writeInt8=function(_,I,x){return _=+_,I=I>>>0,x||ye(this,_,I,1,127,-128),_<0&&(_=255+_+1),this[I]=_&255,I+1},a.prototype.writeInt16LE=function(_,I,x){return _=+_,I=I>>>0,x||ye(this,_,I,2,32767,-32768),this[I]=_&255,this[I+1]=_>>>8,I+2},a.prototype.writeInt16BE=function(_,I,x){return _=+_,I=I>>>0,x||ye(this,_,I,2,32767,-32768),this[I]=_>>>8,this[I+1]=_&255,I+2},a.prototype.writeInt32LE=function(_,I,x){return _=+_,I=I>>>0,x||ye(this,_,I,4,2147483647,-2147483648),this[I]=_&255,this[I+1]=_>>>8,this[I+2]=_>>>16,this[I+3]=_>>>24,I+4},a.prototype.writeInt32BE=function(_,I,x){return _=+_,I=I>>>0,x||ye(this,_,I,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[I]=_>>>24,this[I+1]=_>>>16,this[I+2]=_>>>8,this[I+3]=_&255,I+4},a.prototype.writeBigInt64LE=ie(function(_,I=0){return De(this,_,I,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=ie(function(_,I=0){return ce(this,_,I,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Q(S,_,I,x,k,$){if(I+x>S.length)throw new RangeError("Index out of range");if(I<0)throw new RangeError("Index out of range")}function se(S,_,I,x,k){return _=+_,I=I>>>0,k||Q(S,_,I,4),t.write(S,_,I,x,23,4),I+4}a.prototype.writeFloatLE=function(_,I,x){return se(this,_,I,!0,x)},a.prototype.writeFloatBE=function(_,I,x){return se(this,_,I,!1,x)};function oe(S,_,I,x,k){return _=+_,I=I>>>0,k||Q(S,_,I,8),t.write(S,_,I,x,52,8),I+8}a.prototype.writeDoubleLE=function(_,I,x){return oe(this,_,I,!0,x)},a.prototype.writeDoubleBE=function(_,I,x){return oe(this,_,I,!1,x)},a.prototype.copy=function(_,I,x,k){if(!a.isBuffer(_))throw new TypeError("argument should be a Buffer");if(x||(x=0),!k&&k!==0&&(k=this.length),I>=_.length&&(I=_.length),I||(I=0),k>0&&k<x&&(k=x),k===x||_.length===0||this.length===0)return 0;if(I<0)throw new RangeError("targetStart out of bounds");if(x<0||x>=this.length)throw new RangeError("Index out of range");if(k<0)throw new RangeError("sourceEnd out of bounds");k>this.length&&(k=this.length),_.length-I<k-x&&(k=_.length-I+x);const $=k-x;return this===_&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(I,x,k):Uint8Array.prototype.set.call(_,this.subarray(x,k),I),$},a.prototype.fill=function(_,I,x,k){if(typeof _=="string"){if(typeof I=="string"?(k=I,I=0,x=this.length):typeof x=="string"&&(k=x,x=this.length),k!==void 0&&typeof k!="string")throw new TypeError("encoding must be a string");if(typeof k=="string"&&!a.isEncoding(k))throw new TypeError("Unknown encoding: "+k);if(_.length===1){const Z=_.charCodeAt(0);(k==="utf8"&&Z<128||k==="latin1")&&(_=Z)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(I<0||this.length<I||this.length<x)throw new RangeError("Out of range index");if(x<=I)return this;I=I>>>0,x=x===void 0?this.length:x>>>0,_||(_=0);let $;if(typeof _=="number")for($=I;$<x;++$)this[$]=_;else{const Z=a.isBuffer(_)?_:a.from(_,k),xe=Z.length;if(xe===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for($=0;$<x-I;++$)this[$+I]=Z[$%xe]}return this};const le={};function pe(S,_,I){le[S]=class extends I{constructor(){super(),Object.defineProperty(this,"message",{value:_.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${S}]`,this.stack,delete this.name}get code(){return S}set code(k){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:k,writable:!0})}toString(){return`${this.name} [${S}]: ${this.message}`}}}pe("ERR_BUFFER_OUT_OF_BOUNDS",function(S){return S?`${S} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),pe("ERR_INVALID_ARG_TYPE",function(S,_){return`The "${S}" argument must be of type number. Received type ${typeof _}`},TypeError),pe("ERR_OUT_OF_RANGE",function(S,_,I){let x=`The value of "${S}" is out of range.`,k=I;return Number.isInteger(I)&&Math.abs(I)>2**32?k=Ce(String(I)):typeof I=="bigint"&&(k=String(I),(I>BigInt(2)**BigInt(32)||I<-(BigInt(2)**BigInt(32)))&&(k=Ce(k)),k+="n"),x+=` It must be ${_}. Received ${k}`,x},RangeError);function Ce(S){let _="",I=S.length;const x=S[0]==="-"?1:0;for(;I>=x+4;I-=3)_=`_${S.slice(I-3,I)}${_}`;return`${S.slice(0,I)}${_}`}function Fe(S,_,I){rt(_,"offset"),(S[_]===void 0||S[_+I]===void 0)&&st(_,S.length-(I+1))}function Ye(S,_,I,x,k,$){if(S>I||S<_){const Z=typeof _=="bigint"?"n":"";let xe;throw $>3?_===0||_===BigInt(0)?xe=`>= 0${Z} and < 2${Z} ** ${($+1)*8}${Z}`:xe=`>= -(2${Z} ** ${($+1)*8-1}${Z}) and < 2 ** ${($+1)*8-1}${Z}`:xe=`>= ${_}${Z} and <= ${I}${Z}`,new le.ERR_OUT_OF_RANGE("value",xe,S)}Fe(x,k,$)}function rt(S,_){if(typeof S!="number")throw new le.ERR_INVALID_ARG_TYPE(_,"number",S)}function st(S,_,I){throw Math.floor(S)!==S?(rt(S,I),new le.ERR_OUT_OF_RANGE(I||"offset","an integer",S)):_<0?new le.ERR_BUFFER_OUT_OF_BOUNDS:new le.ERR_OUT_OF_RANGE(I||"offset",`>= ${I?1:0} and <= ${_}`,S)}const qe=/[^+/0-9A-Za-z-_]/g;function ef(S){if(S=S.split("=")[0],S=S.trim().replace(qe,""),S.length<2)return"";for(;S.length%4!==0;)S=S+"=";return S}function lc(S,_){_=_||1/0;let I;const x=S.length;let k=null;const $=[];for(let Z=0;Z<x;++Z){if(I=S.charCodeAt(Z),I>55295&&I<57344){if(!k){if(I>56319){(_-=3)>-1&&$.push(239,191,189);continue}else if(Z+1===x){(_-=3)>-1&&$.push(239,191,189);continue}k=I;continue}if(I<56320){(_-=3)>-1&&$.push(239,191,189),k=I;continue}I=(k-55296<<10|I-56320)+65536}else k&&(_-=3)>-1&&$.push(239,191,189);if(k=null,I<128){if((_-=1)<0)break;$.push(I)}else if(I<2048){if((_-=2)<0)break;$.push(I>>6|192,I&63|128)}else if(I<65536){if((_-=3)<0)break;$.push(I>>12|224,I>>6&63|128,I&63|128)}else if(I<1114112){if((_-=4)<0)break;$.push(I>>18|240,I>>12&63|128,I>>6&63|128,I&63|128)}else throw new Error("Invalid code point")}return $}function tf(S){const _=[];for(let I=0;I<S.length;++I)_.push(S.charCodeAt(I)&255);return _}function hc(S,_){let I,x,k;const $=[];for(let Z=0;Z<S.length&&!((_-=2)<0);++Z)I=S.charCodeAt(Z),x=I>>8,k=I%256,$.push(k),$.push(x);return $}function oh(S){return e.toByteArray(ef(S))}function Oo(S,_,I,x){let k;for(k=0;k<x&&!(k+I>=_.length||k>=S.length);++k)_[k+I]=S[k];return k}function gn(S,_){return S instanceof _||S!=null&&S.constructor!=null&&S.constructor.name!=null&&S.constructor.name===_.name}function Fi(S){return S!==S}const q=function(){const S="0123456789abcdef",_=new Array(256);for(let I=0;I<16;++I){const x=I*16;for(let k=0;k<16;++k)_[x+k]=S[I]+S[k]}return _}();function ie(S){return typeof BigInt>"u"?fe:S}function fe(){throw new Error("BigInt not supported")}})(as);var EI=II;function II(i,e){for(var t=new Array(arguments.length-1),r=0,n=2,s=!0;n<arguments.length;)t[r++]=arguments[n++];return new Promise(function(a,p){t[r]=function(f){if(s)if(s=!1,f)p(f);else{for(var g=new Array(arguments.length-1),d=0;d<g.length;)g[d++]=arguments[d];a.apply(null,g)}};try{i.apply(e||null,t)}catch(l){s&&(s=!1,p(l))}})}const TI=ho(EI);var SI=$u;function $u(){this._listeners={}}$u.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};$u.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this};$u.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};const wI=ho(SI);var bI=jm(jm);function jm(i){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function n(p,l,f){e[0]=p,l[f]=t[0],l[f+1]=t[1],l[f+2]=t[2],l[f+3]=t[3]}function s(p,l,f){e[0]=p,l[f]=t[3],l[f+1]=t[2],l[f+2]=t[1],l[f+3]=t[0]}i.writeFloatLE=r?n:s,i.writeFloatBE=r?s:n;function o(p,l){return t[0]=p[l],t[1]=p[l+1],t[2]=p[l+2],t[3]=p[l+3],e[0]}function a(p,l){return t[3]=p[l],t[2]=p[l+1],t[1]=p[l+2],t[0]=p[l+3],e[0]}i.readFloatLE=r?o:a,i.readFloatBE=r?a:o}():function(){function e(r,n,s,o){var a=n<0?1:0;if(a&&(n=-n),n===0)r(1/n>0?0:2147483648,s,o);else if(isNaN(n))r(2143289344,s,o);else if(n>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(n<11754943508222875e-54)r((a<<31|Math.round(n/1401298464324817e-60))>>>0,s,o);else{var p=Math.floor(Math.log(n)/Math.LN2),l=Math.round(n*Math.pow(2,-p)*8388608)&8388607;r((a<<31|p+127<<23|l)>>>0,s,o)}}i.writeFloatLE=e.bind(null,Jm),i.writeFloatBE=e.bind(null,Ym);function t(r,n,s){var o=r(n,s),a=(o>>31)*2+1,p=o>>>23&255,l=o&8388607;return p===255?l?NaN:a*(1/0):p===0?a*1401298464324817e-60*l:a*Math.pow(2,p-150)*(l+8388608)}i.readFloatLE=t.bind(null,Qm),i.readFloatBE=t.bind(null,Wm)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function n(p,l,f){e[0]=p,l[f]=t[0],l[f+1]=t[1],l[f+2]=t[2],l[f+3]=t[3],l[f+4]=t[4],l[f+5]=t[5],l[f+6]=t[6],l[f+7]=t[7]}function s(p,l,f){e[0]=p,l[f]=t[7],l[f+1]=t[6],l[f+2]=t[5],l[f+3]=t[4],l[f+4]=t[3],l[f+5]=t[2],l[f+6]=t[1],l[f+7]=t[0]}i.writeDoubleLE=r?n:s,i.writeDoubleBE=r?s:n;function o(p,l){return t[0]=p[l],t[1]=p[l+1],t[2]=p[l+2],t[3]=p[l+3],t[4]=p[l+4],t[5]=p[l+5],t[6]=p[l+6],t[7]=p[l+7],e[0]}function a(p,l){return t[7]=p[l],t[6]=p[l+1],t[5]=p[l+2],t[4]=p[l+3],t[3]=p[l+4],t[2]=p[l+5],t[1]=p[l+6],t[0]=p[l+7],e[0]}i.readDoubleLE=r?o:a,i.readDoubleBE=r?a:o}():function(){function e(r,n,s,o,a,p){var l=o<0?1:0;if(l&&(o=-o),o===0)r(0,a,p+n),r(1/o>0?0:2147483648,a,p+s);else if(isNaN(o))r(0,a,p+n),r(2146959360,a,p+s);else if(o>17976931348623157e292)r(0,a,p+n),r((l<<31|2146435072)>>>0,a,p+s);else{var f;if(o<22250738585072014e-324)f=o/5e-324,r(f>>>0,a,p+n),r((l<<31|f/4294967296)>>>0,a,p+s);else{var g=Math.floor(Math.log(o)/Math.LN2);g===1024&&(g=1023),f=o*Math.pow(2,-g),r(f*4503599627370496>>>0,a,p+n),r((l<<31|g+1023<<20|f*1048576&1048575)>>>0,a,p+s)}}}i.writeDoubleLE=e.bind(null,Jm,0,4),i.writeDoubleBE=e.bind(null,Ym,4,0);function t(r,n,s,o,a){var p=r(o,a+n),l=r(o,a+s),f=(l>>31)*2+1,g=l>>>20&2047,d=4294967296*(l&1048575)+p;return g===2047?d?NaN:f*(1/0):g===0?f*5e-324*d:f*Math.pow(2,g-1075)*(d+4503599627370496)}i.readDoubleLE=t.bind(null,Qm,0,4),i.readDoubleBE=t.bind(null,Wm,4,0)}(),i}function Jm(i,e,t){e[t]=i&255,e[t+1]=i>>>8&255,e[t+2]=i>>>16&255,e[t+3]=i>>>24}function Ym(i,e,t){e[t]=i>>>24,e[t+1]=i>>>16&255,e[t+2]=i>>>8&255,e[t+3]=i&255}function Qm(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24)>>>0}function Wm(i,e){return(i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3])>>>0}const NI=ho(bI);var qA={};(function(i){var e=i;e.length=function(r){for(var n=0,s=0,o=0;o<r.length;++o)s=r.charCodeAt(o),s<128?n+=1:s<2048?n+=2:(s&64512)===55296&&(r.charCodeAt(o+1)&64512)===56320?(++o,n+=4):n+=3;return n},e.read=function(r,n,s){var o=s-n;if(o<1)return"";for(var a=null,p=[],l=0,f;n<s;)f=r[n++],f<128?p[l++]=f:f>191&&f<224?p[l++]=(f&31)<<6|r[n++]&63:f>239&&f<365?(f=((f&7)<<18|(r[n++]&63)<<12|(r[n++]&63)<<6|r[n++]&63)-65536,p[l++]=55296+(f>>10),p[l++]=56320+(f&1023)):p[l++]=(f&15)<<12|(r[n++]&63)<<6|r[n++]&63,l>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,p)),l=0);return a?(l&&a.push(String.fromCharCode.apply(String,p.slice(0,l))),a.join("")):String.fromCharCode.apply(String,p.slice(0,l))},e.write=function(r,n,s){for(var o=s,a,p,l=0;l<r.length;++l)a=r.charCodeAt(l),a<128?n[s++]=a:a<2048?(n[s++]=a>>6|192,n[s++]=a&63|128):(a&64512)===55296&&((p=r.charCodeAt(l+1))&64512)===56320?(a=65536+((a&1023)<<10)+(p&1023),++l,n[s++]=a>>18|240,n[s++]=a>>12&63|128,n[s++]=a>>6&63|128,n[s++]=a&63|128):(n[s++]=a>>12|224,n[s++]=a>>6&63|128,n[s++]=a&63|128);return s-o}})(qA);const xI=ho(qA);var OI=CI;function CI(i,e,t){var r=t||8192,n=r>>>1,s=null,o=r;return function(p){if(p<1||p>n)return i(p);o+p>r&&(s=i(r),o=0);var l=e.call(s,o,o+=p);return o&7&&(o=(o|7)+1),l}}const RI=ho(OI);function XA(i,e,t=!1){for(let r=Object.keys(e),n=0;n<r.length;++n)(i[r[n]]===void 0||!t)&&(i[r[n]]=e[r[n]]);return i}function qm(i){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&XA(this,r)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return i}}),e.prototype.toString=function(){return this.name+": "+this.message},e}const He={asPromise:TI,base64:Jf,EventEmitter:wI,float:NI,utf8:xI,pool:RI,emptyArray:Object.freeze?Object.freeze([]):[],emptyBytes:new Uint8Array,emptyObject:Object.freeze?Object.freeze({}):{},isInteger:Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e},isString:function(e){return typeof e=="string"||e instanceof String},isObject:function(e){return e&&typeof e=="object"},get isset(){return this.isSet},isSet(i,e){var t=i[e];return t!=null&&i.hasOwnProperty(e)?typeof t!="object"||(Array.isArray(t)?t.length:Object.keys(t).length)>0:!1},Buffer:function(){return as.Buffer.prototype.utf8Write?as.Buffer:null}(),newBuffer:function(e){return typeof e=="number"?He.Buffer?He._Buffer_allocUnsafe(e):new He.Array(e):He.Buffer?He._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)},Array:typeof Uint8Array<"u"?Uint8Array:Array,Long:jt,key2Re:/^true|false|0|1$/,key32Re:/^-?(?:0|[1-9][0-9]*)$/,key64Re:/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,merge:XA,lcFirst(i){return i.charAt(0).toLowerCase()+i.substring(1)},newError:qm,ProtocolError:qm("ProtocolError"),oneOfGetter:function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var n=Object.keys(this),s=n.length-1;s>-1;--s)if(t[n[s]]===1&&this[n[s]]!==void 0&&this[n[s]]!==null)return n[s]}},oneOfSetter:function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},toJSONOptions:{longs:String,enums:String,bytes:String,json:!0},_Buffer_from:null,_Buffer_allocUnsafe:null,_configure2:function(){var i=He.Buffer;if(!i){He._Buffer_from=He._Buffer_allocUnsafe=null;return}He._Buffer_from=i.from!==Uint8Array.from&&i.from||function(t,r){return new i(t,r)},He._Buffer_allocUnsafe=i.allocUnsafe||function(t){return new i(t)}},isReservedId:function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},isReservedName:function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1}};let ch;class Ms{constructor(e,t){if(this.name=e,this.options=t,this.resolved=!1,this.comment=null,this.filename=null,!He.isString(e))throw TypeError("name must be a string");if(t&&!He.isObject(t))throw TypeError("options must be an object");this.options=t,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}static _configure(e,t,r,n){ch=e}get root(){let e=this;for(;;)if(e&&e.parent)e=e.parent;else return e}get fullName(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}onAdd(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof ch&&t._handleAdd(this)}onRemove(e){var t=e.root;t instanceof ch&&t._handleRemove(this),this.parent=null,this.resolved=!1}resolve(){return this.resolved?this:(this.root instanceof ch&&(this.resolved=!0),this)}getOption(e){if(this.options)return this.options[e]}setOption(e,t,r=!1){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this}setOptions(e,t=!1){if(e)for(let r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this}toString(){const e=Ms.className,t=this.fullName;return t.length?e+" "+t:e}}Ms.className="ReflectionObject";var PI=iy;function iy(i,e){typeof i=="string"&&(e=i,i=void 0);var t=[];function r(s){if(typeof s!="string"){var o=n();if(iy.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),p=new Array(a.length+1),l=new Array(a.length),f=0;f<a.length;)p[f]=a[f],l[f]=s[a[f++]];return p[f]=o,Function.apply(null,p).apply(null,l)}return Function(o)()}for(var g=new Array(arguments.length-1),d=0;d<g.length;)g[d]=arguments[++d];if(d=0,s=s.replace(/%([%dfijs])/g,function(m,E){var T=g[d++];switch(E){case"d":case"f":return String(Number(T));case"i":return String(Math.floor(T));case"j":return JSON.stringify(T);case"s":return String(T)}return"%"}),d!==g.length)throw Error("parameter count mismatch");return t.push(s),r}function n(s){return"function "+(s||e||"")+"("+(i&&i.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=n,r}iy.verbose=!1;const BI=ho(PI);class Kt{constructor(e,t){this.lo=e>>>0,this.hi=t>>>0}static fromNumber(e){if(e===0)return ji;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new Kt(r,n)}static from(e){if(typeof e=="number")return Kt.fromNumber(e);if(He.isString(e))if(He.Long)e=He.Long.fromString(e);else return Kt.fromNumber(parseInt(e,10));const t=e;return t.low||t.high?new Kt(t.low>>>0,t.high>>>0):ji}toNumber(e=!1){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296}toLong(e=!1){return He.Long?new He.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}}static fromHash(e){if(e===Kt.zeroHash)return ji;const t=String.prototype.charCodeAt;return new Kt((t.call(e,0)|t.call(e,1)<<8|t.call(e,2)<<16|t.call(e,3)<<24)>>>0,(t.call(e,4)|t.call(e,5)<<8|t.call(e,6)<<16|t.call(e,7)<<24)>>>0)}toHash(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)}zzEncode(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}}Kt.zeroHash="\0\0\0\0\0\0\0\0";const ji=Kt.zero=new Kt(0,0);ji.toNumber=function(){return 0};ji.zzEncode=ji.zzDecode=function(){return this};ji.length=function(){return 1};Kt.zeroHash;const Xm={};let Zm,e_,t_,MI=0;const ra={_configure:function(i,e,t){Zm=i,e_=e,t_=t},decorateType:function(i,e){const t=e||i.name;if(i.hasOwnProperty("$type")||i.$type&&i.$type.name===t)return e&&i.$type.name!==e&&(this.decorateRoot.remove(i.$type),i.$type.name=e,this.decorateRoot.add(i.$type)),i.$type;const r=i.$type,n=new t_(t);return this.decorateRoot.add(n),r&&(Object.setPrototypeOf(n.fields,r.fields),n.oneofs={},r.oneofs||(r.oneofs={}),Object.setPrototypeOf(n.oneofs,r.oneofs)),n.ctor=i,Object.defineProperty(i,"$type",{value:n,enumerable:!1}),Object.defineProperty(i.prototype,"$type",{value:n,enumerable:!1}),n},decorateEnum:function(i){if(i.$type)return i.$type;const e=new Zm("Enum"+MI++,i);return this.decorateRoot.add(e),Object.defineProperty(i,"$type",{value:e,enumerable:!1}),e},get decorateRoot(){return Xm.decorated||(Xm.decorated=new e_)}},vI=/\\/g,LI=/"/g,DI=/_([a-z])/g,Ne=Object.assign(ra,He,{codegen:BI,LongBits:Kt,longToHash(i){return i?Kt.from(i).toHash():Kt.zeroHash},longFromHash(i,e=!1){var t=Kt.fromHash(i);return He.Long?He.Long.fromBits(t.lo,t.hi,e):t.toNumber(!!e)},compareFieldsById(i,e){return i.id-e.id},toArray(i){if(i){for(var e=Object.keys(i),t=new Array(e.length),r=0;r<e.length;)t[r]=i[e[r++]];return t}return[]},toObject(i){const e={};let t=0;for(;t<i.length;){var r=i[t++],n=i[t++];n!==void 0&&(e[r]=n)}return e},isReserved(i){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(i)},safeProp(i){return!/^[$\w_]+$/.test(i)||this.isReserved(i)?'["'+i.replace(vI,"\\\\").replace(LI,'\\"')+'"]':"."+i},ucFirst(i){return i.charAt(0).toUpperCase()+i.substring(1)},camelCase(i){return i.substring(0,1)+i.substring(1).replace(DI,function(e,t){return t.toUpperCase()})}});let Br=class ZA extends Ms{constructor(e,t,r,n,s){if(super(e,r),t&&typeof t!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.keys=[],this.comment=n,this.comments=s||{},this.reserved=void 0,t)for(var o=Object.keys(t),a=0;a<o.length;++a){var p=o[a],l=t[p];typeof l=="number"&&(this.values[p]=l,this.valuesById[l]=p,this.keys.push(p))}}lookupType(e){throw new Error("Method not implemented.")}lookup(){throw new Error("Method not implemented.")}get(){throw new Error("Method not implemented.")}static fromJSON(e,t){const r=new ZA(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r}toJSON(e){const t=e?!!e.keepComments:!1;return Ne.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])}add(e,t,r){if(!Ne.isString(e))throw TypeError("name must be a string");if(!Ne.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e,this.keys.push(e);return this.comments[e]=r,this}remove(e){if(!Ne.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this}isReservedId(e){return Ne.isReservedId(this.reserved,e)}isReservedName(e){return Ne.isReservedName(this.reserved,e)}};Br.className="Enum";const kI=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Jl(i,e=0){let t=0;const r={};for(e|=0;t<i.length;)r[kI[t+e]]=i[t++];return r}const Xo=Jl([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),HI=Jl([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",He.emptyBytes,null]),eE=Jl([0,0,0,1,1],7),oy=Jl([0,0,0,5,5,0,0,0,1,1,0,2],2),ay=Jl([1,5,0,0,0,5,5,0,0,0,1,1,0]),FI=/^required|optional|repeated$/;let nf;class ls extends Ms{constructor(e,t,r,n,s,o,a){if(Ne.isObject(n)?(a=s,o=n,n=s=void 0):Ne.isObject(s)&&(a=o,o=s,s=void 0),super(e,o),!Ne.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!Ne.isString(r))throw TypeError("type must be a string");if(n!==void 0&&!FI.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(s!==void 0&&!Ne.isString(s))throw TypeError("extend must be a string");this.rule=n&&n!=="optional"?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.optional=n==="optional",this.required=n==="required"||!this.optional,this.repeated=n==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Ne.Long?eE[r]!==void 0:!1,this.bytes=r==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=a}add(e,t,r){throw new Error("Method not implemented.")}lookupType(e,t,r){throw new Error("Method not implemented.")}lookup(e,t,r){throw new Error("Method not implemented.")}get(e,t,r){throw new Error("Method not implemented.")}static fromJSON(e,t){return new A(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)}get packed(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}setOption(e,t,r=!1){return e==="packed"&&(this._packed=null),super.setOption(e,t,r)}toJSON(e){const t=e?!!e.keepComments:!1;return Ne.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])}resolve(){if(this.resolved)return this;(this.typeDefault=HI[this.type])===void 0&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof nf?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]);const e=this.options&&this.options.default!=null;if(e&&(this.typeDefault=this.options.default,this.resolvedType instanceof Br&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof Br))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Ne.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){let t;Ne.base64.test(this.typeDefault)?Ne.base64.decode(this.typeDefault,t=Ne.newBuffer(Ne.base64.length(this.typeDefault)),0):Ne.utf8.write(this.typeDefault,t=Ne.newBuffer(Ne.utf8.length(this.typeDefault)),0),this.typeDefault=t}return this.map?this.defaultValue=Ne.emptyObject:this.repeated?this.defaultValue=Ne.emptyArray:!e&&this.optional?this.defaultValue=void 0:this.defaultValue==null&&(this.defaultValue=this.typeDefault),this.parent instanceof nf&&(this.parent.ctor.prototype[this.name]=this.defaultValue),super.resolve()}static _configure(e){nf=e}}ls.className="Field";let A=class tE extends ls{static d(e,t,r,n){let s;typeof t=="function"?s=ra.decorateType(t).name:typeof t=="object"?s=ra.decorateEnum(t).name:s=t;const o=Symbol.for("field");return function(p,l){const f=p.constructor;(f[o]||(f[o]=[])).push(new tE(l,e,s,r,{default:n}))}}},Ro,Po,r_;class kt extends Ms{constructor(e,t){super(e,t),this._nestedArray=null}static fromJSON(e,t){return new kt(e,t.options).addJSON(t.nested)}static arrayToJSON(e,t){if(!(e&&e.length))return;const r={};for(let n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}static isReservedId(e,t){return Ne.isReservedId(e,t)}static isReservedName(e,t){return Ne.isReservedName(e,t)}get nestedArray(){return this._nestedArray||(this._nestedArray=Ne.toArray(this.nested))}toJSON(e){return Ne.toObject(["options",this.options,"nested",kt.arrayToJSON(this.nestedArray,e)])}addJSON(e){if(e)for(let t=Object.keys(e),r=0,n;r<t.length;++r)n=e[t[r]],this.add((n.fields!==void 0?Ro.fromJSON:n.values!==void 0?Po.fromJSON:n.id!==void 0?r_.fromJSON:kt.fromJSON)(t[r],n));return this}get(e){return this.nested&&this.nested[e]||null}getEnum(e){if(this.nested&&this.nested[e]instanceof Po)return this.nested[e].values;throw Error("no such enum: "+e)}add(e){if(!(e instanceof ls&&e.extend!==void 0||e instanceof Ro||e instanceof Po||e instanceof kt))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{const t=this.get(e.name);if(t)if(t instanceof kt&&e instanceof kt&&!(t instanceof Ro)){const r=t.nestedArray;for(let n=0;n<r.length;++n)e.add(r[n]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),this._nestedArray=null,this}remove(e){if(!(e instanceof Ms))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return this.nested&&(delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0)),e.onRemove(this),this._nestedArray=null,this}define(e,t){if(typeof e=="string")e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");let r=this;for(;e.length>0;){let n=e.shift();if(r.nested&&r.nested[n]){if(r=r.nested[n],!(r instanceof kt))throw Error("path conflicts with non-namespace objects")}else r.add(r=new kt(n))}return t&&r.addJSON(t),r}resolveAll(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof kt?e[t++].resolveAll():e[t++].resolve();return this.resolve()}lookup(e,t,r=!1){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Ne.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);let n=this.get(e[0]);if(n){if(e.length===1){if(!t||t.indexOf(n.constructor)>-1)return n}else if(n instanceof kt&&(n=n.lookup(e.slice(1),t,!0)))return n}else for(let s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof kt&&(n=this._nestedArray[s].lookup(e,t,!0)))return n;return this.parent===null||r?null:this.parent.lookup(e,t)}lookupType(e){var t=this.lookup(e,[Ro]);if(!t)throw Error("no such type: "+e);return t}lookupEnum(e){var t=this.lookup(e,[Po]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t}lookupTypeOrEnum(e){const t=this.lookup(e,[Ro,Po]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t}static _configure(e,t,r){Ro=e,Po=t,r_=r}}kt.className="Namespace";class Bs extends Ms{constructor(e,t,r,n){if(Array.isArray(t)||(r=t,t=void 0),super(e,r),!(t===void 0||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=n}lookup(e,t,r){throw new Error("Method not implemented.")}lookupType(e,t,r){throw new Error("Method not implemented.")}get(e){throw new Error("Method not implemented.")}static fromJSON(e,t){return new Bs(e,t.oneof,t.options,t.comment)}toJSON(e){var t=e?!!e.keepComments:!1;return Ne.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])}add(e){const t=this;if(!(e instanceof ls))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=t,n_(t),this}remove(e){if(!(e instanceof ls))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this}onAdd(e){super.onAdd(e);for(var t=0;t<this.oneof.length;++t){var r=e.get(this.oneof[t]);r&&!r.partOf&&(r.partOf=this,this.fieldsArray.push(r))}n_(this)}onRemove(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);super.onRemove(e)}static d(...e){let t=new Array(arguments.length),r=0;for(;r<arguments.length;)t[r]=arguments[r++];const n=Symbol.for("field");return function(o,a){const p=o.constructor;(p[n]||(p[n]=[])).push(new Bs(a,t)),Object.defineProperty(o,a,{get:Ne.oneOfGetter(t),set:Ne.oneOfSetter(t)})}}}Bs.className="OneOf";function n_(i){if(i.parent)for(let e=0;e<i.fieldsArray.length;++e)i.fieldsArray[e].parent||i.parent.add(i.fieldsArray[e])}const ph=/^[A-Z]/;let s_;class gi extends kt{constructor(e){super("",e),this.deferred=[],this.files=[]}static fromJSON(e,t){return t||(t=new gi),e.options&&t.setOptions(e.options),t.addJSON(e.nested)}resolveAll(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return super.resolveAll()}_handleAdd(e){const t=e;if(e instanceof ls)e.extend!==void 0&&!e.extensionField&&(i_(this,e)||this.deferred.push(e));else if(e instanceof Br)ph.test(e.name)&&(t.parent[e.name]=e.values);else if(!(e instanceof Bs)){if(e instanceof s_)for(var r=0;r<this.deferred.length;)i_(this,this.deferred[r])?this.deferred.splice(r,1):++r;for(var n=0;n<t.nestedArray.length;++n)this._handleAdd(t._nestedArray[n]);ph.test(e.name)&&(t.parent[e.name]=e)}}_handleRemove(e){const t=e;if(e instanceof ls){if(e.extend!==void 0)if(e.extensionField)t.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var r=this.deferred.indexOf(e);r>-1&&this.deferred.splice(r,1)}}else if(e instanceof Br)ph.test(e.name)&&delete t.parent[e.name];else if(e instanceof kt){const s=e;for(var n=0;n<e.nestedArray.length;++n)this._handleRemove(s._nestedArray[n]);ph.test(e.name)&&delete s.parent[e.name]}}static _configure(e){s_=e}}gi.className="Root";function i_(i,e){const t=e.parent.lookup(e.extend);if(t){const r=new A(e.fullName,e.id,e.type,e.rule,void 0,e.options);return r.declaringField=e,e.extensionField=r,t.add(r),!0}return!1}class Er extends ls{constructor(e,t,r,n,s,o){if(super(e,t,n,void 0,void 0,s,o),this.map=!0,!Ne.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}static fromJSON(e,t){return new Er(e,t.id,t.keyType,t.type,t.options,t.comment)}toJSON(e){const t=e?!!e.keepComments:!1;return Ne.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])}resolve(){if(this.resolved)return this;if(oy[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return super.resolve()}static d(e,t,r){let n;typeof r=="function"?n=ra.decorateType(r).name:typeof r=="object"?n=ra.decorateEnum(r).name:n=r;var s=Symbol.for("field");return function(a,p){const l=a.constructor;var f=l[s]||(l[s]=[]);f.push(new Er(p,e,t,n))}}}Er.className="MapField";class Y{constructor(e){if(e){const t=Object.keys(e);for(const r of t)this[r]=e[r]}}getBytes(){return this.$type.encode(this).finish()}static create(e){return this.$type.create(e)}static encode(e,t){return this.$type.encode(e,t)}static encodeDelimited(e,t){return this.$type.encodeDelimited(e,t)}static decode(e){return this.$type.decode(e)}static decodeDelimited(e){return this.$type.decodeDelimited(e)}static verify(e){return this.$type.verify(e)}static fromObject(e){return this.$type.fromObject(e)}static toObject(e,t=He.toJSONOptions){return this.$type.toObject(e,t)}toObject(){return this.$type.toObject(this,He.toJSONOptions)}toJSON(){return this.$type.toObject(this,{defaults:!0})}clone(){return this.$type.decode(this.$type.encode(this).finish())}}let rE;const VI=He.utf8;function kn(i,e){return new RangeError("index out of range: "+i.pos+" + "+(e||1)+" > "+i.len)}const o_=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new sn(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new sn(e);throw Error("illegal buffer")};class sn{constructor(e){this.pos=0,this.uint32=function(){let r=4294967295;return function(){if(r=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(r=(r|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(r=(r|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(r=(r|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(r=(r|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return r;if((this.pos+=5)>this.len)throw this.pos=this.len,kn(this,10);return r}}(),this._slice=He.Array.prototype.subarray||He.Array.prototype.slice,this.buf=e,this.len=e.length}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw kn(this,4);return vh(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw kn(this,4);return vh(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw kn(this,4);var e=He.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw kn(this,4);var e=He.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw kn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){const n=this.buf.constructor;return new n(0)}return this._slice.call(this.buf,t,r)}string(){const e=this.bytes();return VI.read(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw kn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw kn(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this}static _configure(e){rE=e;const t=He.Long?"toLong":"toNumber";He.merge(sn.prototype,{int64:function(){return sf.call(this)[t](!1)},uint64:function(){return sf.call(this)[t](!0)},sint64:function(){return sf.call(this).zzDecode()[t](!1)},fixed64:function(){return a_.call(this)[t](!0)},sfixed64:function(){return a_.call(this)[t](!1)}})}}sn.create=He.Buffer?function(e){return(sn.create=function(r){return He.Buffer.isBuffer(r)?new rE(r):o_(r)})(e)}:o_;function vh(i,e){return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0}function sf(){var i=new Kt(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(i.lo=(i.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return i;if(i.lo=(i.lo|(this.buf[this.pos]&127)<<28)>>>0,i.hi=(i.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return i;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw kn(this);if(i.lo=(i.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return i}return i.lo=(i.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,i}if(this.len-this.pos>4){for(;e<5;++e)if(i.hi=(i.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return i}else for(;e<5;++e){if(this.pos>=this.len)throw kn(this);if(i.hi=(i.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return i}throw Error("invalid varint encoding")}function a_(){if(this.pos+8>this.len)throw kn(this,8);return new Kt(vh(this.buf,this.pos+=4),vh(this.buf,this.pos+=4))}let nE;class Sc{constructor(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}fn(e,t,r){}}function of(){}class $I{constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}class $n{constructor(){this.len=0,this.head=new Sc(of,0,0),this.tail=this.head,this.states=null}static alloc(e){return new He.Array(e)}_push(e,t,r){return this.tail=this.tail.next=new Sc(e,t,r),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new UI((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(cf,10,Kt.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){var t=Kt.from(e);return this._push(cf,t.length(),t)}int64(e){return this.uint64(e)}sint64(e){var t=Kt.from(e).zzEncode();return this._push(cf,t.length(),t)}bool(e){return this._push(af,1,e?1:0)}fixed32(e){return this._push(pf,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){var t=Kt.from(e);return this._push(pf,4,t.lo)._push(pf,4,t.hi)}sfixed64(e){return this.fixed64(e)}float(e){return this._push(He.float.writeFloatLE,4,e)}double(e){return this._push(He.float.writeDoubleLE,8,e)}bytes(e){var t=e.length>>>0;if(!t)return this._push(af,1,0);if(He.isString(e)){var r=$n.alloc(t=He.base64.length(e));He.base64.decode(e,r,0),e=r}return this.uint32(t)._push(KI,t,e)}string(e){var t=He.utf8.length(e);return t?this.uint32(t)._push(He.utf8.write,t,e):this._push(af,1,0)}fork(){return this.states=new $I(this),this.head=this.tail=new Sc(of,0,0),this.len=0,this}reset(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Sc(of,0,0),this.len=0),this}ldelim(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this}finish(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t}static _configure(e){nE=e}}$n.create=He.Buffer?function(){return($n.create=function(){return new nE})()}:function(){return new $n};He.Array!==Array&&($n.alloc=He.pool($n.alloc,He.Array.prototype.subarray));function af(i,e,t){e[t]=i&255}function c_(i,e,t){for(;i>127;)e[t++]=i&127|128,i>>>=7;e[t]=i}class UI extends Sc{constructor(e,t){super(c_,e,t),this.len=e,this.next=void 0,this.val=t}fn(e,t,r){return c_(e,t,r)}}function cf(i,e,t){for(;i.hi;)e[t++]=i.lo&127|128,i.lo=(i.lo>>>7|i.hi<<25)>>>0,i.hi>>>=7;for(;i.lo>127;)e[t++]=i.lo&127|128,i.lo=i.lo>>>7;e[t++]=i.lo}function pf(i,e,t){e[t]=i&255,e[t+1]=i>>>8&255,e[t+2]=i>>>16&255,e[t+3]=i>>>24}function KI(i,e,t){e.set(i,t)}function p_(i,e,t,r){return e.resolvedType.group?i("%s&&types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):i("%s&&types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,t,r,(e.id<<3|2)>>>0)}function GI(i){var e=Ne.codegen(["m","w"],i.name+"$encode")("if(!w)")("w=Writer.create()"),t,r=i.fieldsArray.slice().sort(Ne.compareFieldsById);if(i._fieldsArray instanceof Array)for(let n=0;n<r.length;++n){const s=r[n].resolve(),o=i._fieldsArray.indexOf(s),a=s.resolvedType instanceof Br?"int32":s.type,p=Xo[a];if(t="m"+Ne.safeProp(s.name),s.map)e("if(%s!=null){",t)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|oy[s.keyType],s.keyType),p===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,t):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|p,a,t),e("}")("}");else if(s.repeated)e("if(%s!=null&&%s.length){",t,t),s.packed&&ay[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",a,t)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",t),p===void 0?p_(e,s,o,t+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|p)>>>0,a,t)),e("}");else if(a==="bytes")e("if(%s!=null&&%s.length)",t,t),e("w.uint32(%i).%s(%s)",(s.id<<3|p)>>>0,a,t);else{if(a.endsWith("64"))if(s.defaultValue){const{unsigned:l,high:f,low:g}=s.defaultValue;e(`if(${t}!=null && 
                   (  ${l}!==${t}.unsigned
                   || ${f}!==${t}.high
                   || ${g}!==${t}.low
                   )
                 )`)}else e(`if(${t}!=null)`);else e("if(%s!=null&&%s!==%j)",t,t,s.defaultValue);p===void 0?p_(e,s,o,t):e("w.uint32(%i).%s(%s)",(s.id<<3|p)>>>0,a,t)}}return e("return w")}function zI(i){return"missing required '"+i.name+"'"}function jI(i){var e=Ne.codegen(["r","l"],i.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(i.fieldsArray.filter(function(a){return a.map}).length?",k":"")),t=0;if(i._fieldsArray instanceof Array){for(;t<i.fieldsArray.length;++t){var r=i._fieldsArray[t].resolve();r.repeated?e("%s=[]","m"+Ne.safeProp(r.name)):r.map&&e("%s={}","m"+Ne.safeProp(r.name))}for(e("while(r.pos<c){")("var t=r.uint32()"),i.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){"),t=0;t<i.fieldsArray.length;++t){var r=i._fieldsArray[t].resolve(),n=r.resolvedType instanceof Br?"int32":r.type,s="m"+Ne.safeProp(r.name);e("case %i:",r.id);const p=r.resolvedType;r.map?(e("r.skip().pos++")("k=r.%s()",r.keyType)("r.pos++"),eE[r.keyType]!==void 0?Xo[n]===void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',s,t):e('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',s,n):Xo[n]===void 0?e("%s[k]=types[%i].decode(r,r.uint32())",s,t):e("%s[k]=r.%s()",s,n)):r.repeated?(ay[n]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,n)("}else"),Xo[n]===void 0?e(p.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,n)):Xo[n]===void 0?e(p.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,n),e("break")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<i._fieldsArray.length;++t){var o=i._fieldsArray[t];o.required&&e("if(m.%s==null)",o.name)("throw util.ProtocolError(%j,{instance:m})",zI(o))}}return e("return m")}function Sn(i,e){return i.name+": "+e+(i.repeated&&e!=="array"?"[]":i.map&&e!=="object"?"{k:"+i.keyType+"}":"")+" expected"}function lf(i,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof Br){i("switch(%s){",r)("default:")("return%j",Sn(e,"enum value"));for(var n=Object.keys(e.resolvedType.values),s=0;s<n.length;++s)i("case %i:",e.resolvedType.values[n[s]]);i("break")("}")}else i("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":i("if(!util.isInteger(%s))",r)("return%j",Sn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":i("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",Sn(e,"integer|Long"));break;case"float":case"double":i('if(typeof %s!=="number")',r)("return%j",Sn(e,"number"));break;case"bool":i('if(typeof %s!=="boolean")',r)("return%j",Sn(e,"boolean"));break;case"string":i("if(!util.isString(%s))",r)("return%j",Sn(e,"string"));break;case"bytes":i('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",Sn(e,"buffer"));break}return i}function JI(i,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":i("if(!util.key32Re.test(%s))",t)("return%j",Sn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":i("if(!util.key64Re.test(%s))",t)("return%j",Sn(e,"integer|Long key"));break;case"bool":i("if(!util.key2Re.test(%s))",t)("return%j",Sn(e,"boolean key"));break}return i}function YI(i){var e=Ne.codegen(["m"],i.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=i.oneofsArray,r={};if(t.length&&e("var p={}"),i._fieldsArray instanceof Array)for(var n=0;n<i.fieldsArray.length;++n){var s=i._fieldsArray[n].resolve(),o="m"+Ne.safeProp(s.name);if(s.optional&&e("if(%s!=null){",o),s.map)e("if(!util.isObject(%s))",o)("return%j",Sn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),JI(e,s,"k[i]"),lf(e,s,n,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",Sn(s,"array"))("for(var i=0;i<%s.length;++i){",o),lf(e,s,n,o+"[i]")("}");else{if(s.partOf){var a=Ne.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}lf(e,s,n,o)}s.optional&&e("}")}return e("return null")}function lh(i,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof Br){i("switch(d%s){",r);let n=e.resolvedType.values,s=e.resolvedType.keys,o=0;for(;o<s.length;++o)e.repeated&&n[s[o]]===e.typeDefault&&i("default:"),i("case%j:",s[o])("case %i:",n[s[o]])("m%s=%j",r,n[s[o]])("break");i("}")}else i('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i]._ctor.fromObject(d%s)",r,t,r);else{let n=!1;switch(e.type){case"double":case"float":i("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":i("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":i("m%s=d%s|0",r,r);break;case"uint64":n=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":i("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,n)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,n?"true":"");break;case"bytes":i('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length)",r)("m%s=d%s",r,r);break;case"string":i("m%s=String(d%s)",r,r);break;case"bool":i("m%s=Boolean(d%s)",r,r);break}}return i}function hf(i,e,t,r){if(e.resolvedType)e.resolvedType instanceof Br?i("d%s=o.enums===String?types[%i].values[m%s]:m%s",r,t,r,r):i("d%s=types[%i].toObject(m%s,o)",r,t,r);else{let n=!1;switch(e.type){case"double":case"float":i("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":n=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":i('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,n?"true":"",r);break;case"bytes":i("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:i("d%s=m%s",r,r);break}}return i}const l_={fromObject(i){const e=i.fieldsArray,t=Ne.codegen(["d"],i.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!e.length)return t("return new this.ctor");t("var m=new this.ctor");for(let r=0;r<e.length;++r){const n=e[r].resolve(),s=Ne.safeProp(n.name);n.map?(t("m%s={}",s)("if(d%s){",s)('if(typeof d%s!=="object")',s)("throw TypeError(%j)",n.fullName+": object expected")("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",s),lh(t,n,r,s+"[ks[i]]")("}")("}")):n.repeated?(t("m%s=[]",s)("if(d%s){",s)("if(!Array.isArray(d%s))",s)("throw TypeError(%j)",n.fullName+": array expected")("for(var i=0;i<d%s.length;++i){",s),lh(t,n,r,s+"[i]")("}")("}")):n.resolvedType instanceof Br?lh(t,n,r,s):(n.resolvedType&&n.required&&(t("if(d%s==null)",s),t("d%s={}",s)),t("if(d%s!=null){",s),lh(t,n,r,s),t("}"))}return t("return m")},toObject(i){const e=i.fieldsArray.slice().sort(Ne.compareFieldsById);if(!e.length)return Ne.codegen()("return {}");const t=Ne.codegen(["m","o"],i.name+"$toObject")("if(!o)")("o={}")("var d={}"),r=[],n=[],s=[];let o=0;for(;o<e.length;++o)e[o].partOf||(e[o].resolve().repeated?r:e[o].map?n:s).push(e[o]);if(r.length){for(t("if(o.arrays||o.defaults){"),o=0;o<r.length;++o)t("d%s=[]",Ne.safeProp(r[o].name));t("}")}if(n.length){for(t("if(o.objects||o.defaults){"),o=0;o<n.length;++o)t("d%s={}",Ne.safeProp(n[o].name));t("}")}if(s.length){for(t("if(o.defaults){"),o=0;o<s.length;++o){const p=s[o],l=Ne.safeProp(p.name);if(p.resolvedType instanceof Br)t("d%s=o.enums===String?%j:%j",l,p.resolvedType.valuesById[p.typeDefault],p.typeDefault);else if(p.long)t("if(util.Long){")("var n=new util.Long(%i,%i,%j)",p.typeDefault.low,p.typeDefault.high,p.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",l)("}else")("d%s=o.longs===String?%j:%i",l,p.typeDefault.toString(),p.typeDefault.toNumber());else if(p.bytes){const f="["+Array.prototype.slice.call(p.typeDefault).join(",")+"]";t("if(o.bytes===String)d%s=%j",l,String.fromCharCode.apply(String,p.typeDefault))("else{")("d%s=%s",l,f)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",l,l)("}")}else t("d%s=%j",l,p.typeDefault)}t("}")}let a=!1;for(o=0;o<e.length;++o){let p=e[o],l=i._fieldsArray.indexOf(p),f=Ne.safeProp(p.name);p.map?(a||(a=!0,t("var ks2")),t("if(m%s&&(ks2=Object.keys(m%s)).length){",f,f)("d%s={}",f)("for(var j=0;j<ks2.length;++j){"),hf(t,p,l,f+"[ks2[j]]")("}")):p.repeated?(t("if(m%s&&m%s.length){",f,f)("d%s=[]",f)("for(var j=0;j<m%s.length;++j){",f),hf(t,p,l,f+"[j]")("}")):(t("if(m%s!=null&&m.hasOwnProperty(%j)){",f,p.name),hf(t,p,l,f),p.partOf&&t("if(o.oneofs)")("d%s=%j",Ne.safeProp(p.partOf.name),p.name)),t("}")}return t("return d")}},h_=Symbol("bindThisProps");function $e(i,e,t){if(!t||typeof t.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${e}> is not a method!`);return{configurable:!0,get(){let r=this[h_];if(r&&r.has(e))return t.value;const n=t.value.bind(this);return Object.defineProperty(this,e,{value:n,configurable:!0,writable:!0}),r||(r=this[h_]=new Set),r.add(e),n}}}const u_=Symbol("CACHE_GETTER_KEYS_STORE");function sE(i){let e=Reflect.get(i,u_);return e||(e=new Map,Reflect.set(i,u_,e)),e}function QI(i,e){const t=sE(i);let r=t.get(e);return r||(r=Symbol(`[${typeof e}]${String(e)}`),t.set(e,r)),r}function ne(i,e,t){if(typeof t.get!="function")throw new TypeError(`property ${String(e)} must has an getter function.`);const r=t.get,n=QI(i,e),s=function(){if(n in this)return this[n].value;{const o=r.call(this),a={target:this,value:o,sourceFun:r};if(this[n]=a,t.set===void 0)try{Object.defineProperty(this,e,{value:o,writable:!1,configurable:!0,enumerable:t.enumerable})}catch(p){console.error(p)}return o}};return Reflect.set(s,"source_fun",r),t.get=s,t}function WI(i){const e=sE(i);for(const[t,r]of e)qI(i,t,r)}function qI(i,e,t){const r=Reflect.get(i,t);return r===void 0||Reflect.deleteProperty(r.target,t)!==!1&&(Reflect.deleteProperty(r.target,e),!0)}class uf{constructor(e=Math.random().toString(36).slice(2)){this.pid=e,this.CLASS_PROTO_ARRAYDATA_POOL=new Map,this.PA_ID_VALUE=0,this.PA_ID_KEY=Symbol(`@PAID:${e}`)}get(e,t){const r=new Set,n=this.CLASS_PROTO_ARRAYDATA_POOL.get(t);if(n)do if(e.hasOwnProperty(this.PA_ID_KEY)){const s=n.get(e[this.PA_ID_KEY]);if(s)for(const o of s)r.add(o)}while(e=Object.getPrototypeOf(e));return r}add(e,t,r){let n=this.CLASS_PROTO_ARRAYDATA_POOL.get(t);n||(n=new Map,this.CLASS_PROTO_ARRAYDATA_POOL.set(t,n));const s=e.hasOwnProperty(this.PA_ID_KEY)?e[this.PA_ID_KEY]:e[this.PA_ID_KEY]=Symbol(`@PAID:${this.pid}#${this.PA_ID_VALUE++}`);let o=n.get(s);o?o.push(r):(o=[r],n.set(s,o))}remove(e,t,r){const n=this.CLASS_PROTO_ARRAYDATA_POOL.get(t);if(n)do{if(!e.hasOwnProperty(this.PA_ID_KEY))break;const s=e[this.PA_ID_KEY],o=n.get(s);if(!o)return;const a=o.indexOf(r);if(a!==-1)return void o.splice(a,1)}while(e=Object.getPrototypeOf(e))}}h([$e,u("design:type",Function),u("design:paramtypes",[Object,Object]),u("design:returntype",void 0)],uf.prototype,"get",null),h([$e,u("design:type",Function),u("design:paramtypes",[Object,Object,Object]),u("design:returntype",void 0)],uf.prototype,"add",null),h([$e,u("design:type",Function),u("design:paramtypes",[Object,Object,Object]),u("design:returntype",void 0)],uf.prototype,"remove",null);const Yf=i=>{};var XI=(i=>(i[i.WAIT_RESULT_RETURN=0]="WAIT_RESULT_RETURN",i[i.NO_WAIT_EXEC_TIME=1]="NO_WAIT_EXEC_TIME",i))(XI||{});class v extends kt{constructor(e,t){super(e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}get fieldsById(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}get fieldsArray(){var e=this._fieldsArray;if(!e){e=[];for(var t in this.fields)e.push(this.fields[t]);this._fieldsArray=e}return e}get oneofsArray(){var e=this._oneofsArray;if(!e){e=[];for(var t in this.oneofs)e.push(this.oneofs[t]);this._oneofsArray=e}return e}get ctor(){return this._ctor||(this.ctor=v.generateConstructor(this)())}set ctor(e){const t=e.prototype;t instanceof Y||((e.prototype=new Y).constructor=e,Ne.merge(e.prototype,t)),e.$type=this,Ne.merge(e,Y,!0),this._ctor=e;let r=0;if(this._fieldsArray)for(;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();const n={};if(this._oneofsArray)for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:Ne.oneOfGetter(this._oneofsArray[r].oneof),set:Ne.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}static generateConstructor(e){for(var t=Ne.codegen(["p"],e.name),r=0,n;r<e.fieldsArray.length;++r)(n=e._fieldsArray[r]).map?t("this%s={}",Ne.safeProp(n.name)):n.repeated&&t("this%s=[]",Ne.safeProp(n.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")}static fromJSON(e,t){const r=new v(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;let n=Object.keys(t.fields),s=0;for(;s<n.length;++s)r.add((typeof t.fields[n[s]].keyType<"u"?Er.fromJSON:A.fromJSON)(n[s],t.fields[n[s]]));if(t.oneofs)for(n=Object.keys(t.oneofs),s=0;s<n.length;++s)r.add(Bs.fromJSON(n[s],t.oneofs[n[s]]));if(t.nested)for(n=Object.keys(t.nested),s=0;s<n.length;++s){const o=t.nested[n[s]];r.add((o.id!==void 0?A.fromJSON:o.fields!==void 0?v.fromJSON:o.values!==void 0?Br.fromJSON:kt.fromJSON)(n[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r}toJSON(e){const t=super.toJSON(e),r=e?!!e.keepComments:!1;return Ne.toObject(["options",t&&t.options||void 0,"oneofs",kt.arrayToJSON(this.oneofsArray,e),"fields",kt.arrayToJSON(this.fieldsArray.filter(function(n){return!n.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])}resolveAll(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return super.resolveAll()}get(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null}add(e){const t=this;if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof ls&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=t,e.onAdd(t),hh(this)}return e instanceof Bs?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(t),hh(this)):super.add(e)}remove(e){const t=this;if(e instanceof ls&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(t),hh(this)}if(e instanceof Bs){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(t),hh(this)}return super.remove(e)}isReservedId(e){return kt.isReservedId(this.reserved,e)}isReservedName(e){return kt.isReservedName(this.reserved,e)}create(e){return new this.ctor(e)}get _types(){if(!this._fieldsArray)throw new ReferenceError;const e=[];for(const t of this._fieldsArray)e.push(t.resolve().resolvedType);return e}setup(){const e=this;this.fullName;for(var t=[],r=0;r<this.fieldsArray.length;++r){const s=this._fieldsArray;t.push(s[r].resolve().resolvedType)}const n=GI;return this.encode=n(e)({Writer:$n,types:t,util:Ne}),this.decode=jI(e)({Reader:sn,types:t,util:Ne}),this.verify=YI(e)({types:t,util:Ne}),this.fromObject=l_.fromObject(e)({types:t,util:Ne}),this}encode(e,t){return this.setup().encode(e,t)}encodeDelimited(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()}decode(e,t){return this.setup().decode(e,t)}decodeDelimited(e){return e instanceof sn||(e=sn.create(e)),this.decode(e,e.uint32())}verify(e){return this.setup().verify(e)}fromObject(e){return this.setup().fromObject(e)}get toObject(){return l_.toObject(this)({types:this._types,util:Ne})}static d(e){const t=Symbol.for("field");return function(n){const s=ra.decorateType(n,e),o=n[t];if(o)for(let a=0,p;p=o[a];a+=1)s.add(p);delete n[t]}}}v.className="Type";h([ne,u("design:type",Object),u("design:paramtypes",[])],v.prototype,"toObject",null);function hh(i){return i._fieldsById=i._fieldsArray=i._oneofsArray=null,Reflect.deleteProperty(i,"encode"),Reflect.deleteProperty(i,"decode"),Reflect.deleteProperty(i,"verify"),i}class iE extends sn{constructor(e){super(e)}string(){const e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}}He.Buffer&&(iE.prototype._slice=He.Buffer.prototype.slice);const xh=He.Buffer;class cy extends $n{constructor(){super()}static alloc(e){return(cy.alloc=He._Buffer_allocUnsafe)(e)}bytes(e){He.isString(e)&&(e=He._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(ZI,t,e),this}string(e){var t=xh.byteLength(e);return this.uint32(t),t&&this._push(eT,t,e),this}}var ZI=xh&&xh.prototype instanceof Uint8Array&&xh.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]};function eT(i,e,t){i.length<40?He.utf8.write(i,e,t):e.utf8Write(i,t)}var ff=/[\s{}=;:[\],'"()<>]/g,tT=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,rT=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,nT=/^ *[*/]+ */,sT=/^\s*\*?\/*/,iT=/\n/g,oT=/\s/,aT=/\\(.?)/g,cT={0:"\0",r:"\r",n:`
`,t:"	"};function oE(i){return i.replace(aT,function(e,t){switch(t){case"\\":case"":return t;default:return cT[t]||""}})}aE.unescape=oE;function aE(i,e){i=i.toString();var t=0,r=i.length,n=1,s=null,o=null,a=0,p=!1,l=[],f=null;function g(R){return Error("illegal "+R+" (line "+n+")")}function d(){var R=f==="'"?rT:tT;R.lastIndex=t-1;var F=R.exec(i);if(!F)throw g("string");return t=R.lastIndex,b(f),f=null,oE(F[1])}function y(R){return i.charAt(R)}function m(R,F){s=i.charAt(R++),a=n,p=!1;var z;e?z=2:z=3;var K=R-z,B;do if(--K<0||(B=i.charAt(K))===`
`){p=!0;break}while(B===" "||B==="	");for(var M=i.substring(R,F).split(iT),V=0;V<M.length;++V)M[V]=M[V].replace(e?sT:nT,"").trim();o=M.join(`
`).trim()}function E(R){var F=T(R),z=i.substring(R,F),K=/^\s*\/{1,2}/.test(z);return K}function T(R){for(var F=R;F<r&&y(F)!==`
`;)F++;return F}function w(){if(l.length>0)return l.shift();if(f)return d();var R,F,z,K,B;do{if(t===r)return null;for(R=!1;oT.test(z=y(t));)if(z===`
`&&++n,++t===r)return null;if(y(t)==="/"){if(++t===r)throw g("comment");if(y(t)==="/")if(e){if(K=t,B=!1,E(t)){B=!0;do{if(t=T(t),t===r)break;t++}while(E(t))}else t=Math.min(r,T(t)+1);B&&m(K,t),n++,R=!0}else{for(B=y(K=t+1)==="/";y(++t)!==`
`;)if(t===r)return null;++t,B&&m(K,t-1),++n,R=!0}else if((z=y(t))==="*"){K=t+1,B=e||y(K)==="*";do{if(z===`
`&&++n,++t===r)throw g("comment");F=z,z=y(t)}while(F!=="*"||z!=="/");++t,B&&m(K,t-2),R=!0}else return"/"}}while(R);var M=t;ff.lastIndex=0;var V=ff.test(y(M++));if(!V)for(;M<r&&!ff.test(y(M));)++M;var U=i.substring(t,t=M);return(U==='"'||U==="'")&&(f=U),U}function b(R){l.push(R)}function C(){if(!l.length){var R=w();if(R===null)return null;b(R)}return l[0]}function N(R,F=!1){var z=C(),K=z===R;if(K)return w(),!0;if(!F)throw g("token '"+z+"', '"+R+"' expected");return!1}function O(R){var F=null;return R===void 0?a===n-1&&(e||s==="*"||p)&&(F=o):(a<R&&C(),a===R&&!p&&(e||s==="/")&&(F=o)),F}return Object.defineProperty({next:w,peek:C,push:b,skip:N,cmnt:O},"line",{get:function(){return n}})}Object.defineProperty(pi,"filename",{value:null});pi.defaults={keepCase:!1};var pT=/^[1-9][0-9]*$/,lT=/^-?[1-9][0-9]*$/,hT=/^0[x][0-9a-fA-F]+$/,uT=/^-?0[x][0-9a-fA-F]+$/,fT=/^0[0-7]+$/,gT=/^-?0[0-7]+$/,dT=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,ei=/^[a-zA-Z_][a-zA-Z_0-9]*$/,ti=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,yT=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function pi(i,e,t){e instanceof gi||(t=e,e=new gi),t||(t=pi.defaults);var r=aE(i,t.alternateCommentMode||!1),n=r.next,s=r.push,o=r.peek,a=r.skip,p=r.cmnt,l=!0,f,g,d,y,m=!1,E=e,T=t.keepCase?function(Q){return Q}:Ne.camelCase;function w(Q,se,oe){var le=Object.getOwnPropertyDescriptor(pi,"filename");return oe||Object.defineProperty(pi,"filename",{value:null}),Error("illegal "+(se||"token")+" '"+Q+"' ("+(le?le+", ":"")+"line "+r.line+")")}function b(){var Q=[],se;do{if((se=n())!=='"'&&se!=="'")throw w(se);Q.push(n()),a(se),se=o()}while(se==='"'||se==="'");return Q.join("")}function C(Q){var se=n();switch(se){case"'":case'"':return s(se),b();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return O(se,!0)}catch{if(Q&&ti.test(se))return se;throw w(se,"value")}}function N(Q,se){var oe,le;do se&&((oe=o())==='"'||oe==="'")?Q.push(b()):Q.push([le=R(n()),a("to",!0)?R(n()):le]);while(a(",",!0));a(";")}function O(Q,se){var oe=1;switch(Q.charAt(0)==="-"&&(oe=-1,Q=Q.substring(1)),Q){case"inf":case"INF":case"Inf":return oe*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(pT.test(Q))return oe*parseInt(Q,10);if(hT.test(Q))return oe*parseInt(Q,16);if(fT.test(Q))return oe*parseInt(Q,8);if(dT.test(Q))return oe*parseFloat(Q);throw w(Q,"number",se)}function R(Q,se){switch(Q){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!se&&Q.charAt(0)==="-")throw w(Q,"id");if(lT.test(Q))return parseInt(Q,10);if(uT.test(Q))return parseInt(Q,16);if(gT.test(Q))return parseInt(Q,8);throw w(Q,"id")}function F(){if(f!==void 0)throw w("package");if(f=n(),!ti.test(f))throw w(f,"name");E=E.define(f),a(";")}function z(){var Q=o(),se;switch(Q){case"weak":se=d||(d=[]),n();break;case"public":n();default:se=g||(g=[]);break}Q=b(),a(";"),se.push(Q)}function K(){if(a("="),y=b(),m=y==="proto3",!m&&y!=="proto2")throw w(y,"syntax");a(";")}function B(Q,se){switch(se){case"option":return Ae(Q,se),a(";"),!0;case"message":return V(Q,se),!0;case"enum":return ue(Q,se),!0;case"extend":return De(Q,se),!0}return!1}function M(Q,se,oe){var le=r.line;if(Q&&(Q.comment=p(),Q.filename=Object.getOwnPropertyDescriptor(pi,"filename")),a("{",!0)){for(var pe;(pe=n())!=="}";)se(pe);a(";",!0)}else oe&&oe(),a(";"),Q&&typeof Q.comment!="string"&&(Q.comment=p(le))}function V(Q,se){if(!ei.test(se=n()))throw w(se,"type name");var oe=new v(se);M(oe,function(pe){if(!B(oe,pe))switch(pe){case"map":W(oe);break;case"required":case"optional":case"repeated":U(oe,pe);break;case"oneof":ae(oe,pe);break;case"extensions":N(oe.extensions||(oe.extensions=[]));break;case"reserved":N(oe.reserved||(oe.reserved=[]),!0);break;default:if(!m||!ti.test(pe))throw w(pe);s(pe),U(oe,"optional");break}}),Q.add(oe)}function U(Q,se,oe){var le=n();if(le==="group"){D(Q,se);return}if(!ti.test(le))throw w(le,"type");var pe=n();if(!ei.test(pe))throw w(pe,"name");pe=T(pe),a("=");var Ce=new A(pe,R(n()),le,se,oe);M(Ce,function(Ye){if(Ye==="option")Ae(Ce,Ye),a(";");else throw w(Ye)},function(){ye(Ce)}),Q.add(Ce),!m&&Ce.repeated&&(ay[le]!==void 0||Xo[le]===void 0)&&Ce.setOption("packed",!1,!0)}function D(Q,se){var oe=n();if(!ei.test(oe))throw w(oe,"name");var le=Ne.lcFirst(oe);oe===le&&(oe=Ne.ucFirst(oe)),a("=");var pe=R(n()),Ce=new v(oe);Ce.group=!0;var Fe=new A(le,pe,oe,se);Fe.filename=Object.getOwnPropertyDescriptor(pi,"filename"),M(Ce,function(rt){switch(rt){case"option":Ae(Ce,rt),a(";");break;case"required":case"optional":case"repeated":U(Ce,rt);break;default:throw w(rt)}}),Q.add(Ce).add(Fe)}function W(Q,se){a("<");var oe=n();if(oy[oe]===void 0)throw w(oe,"type");a(",");var le=n();if(!ti.test(le))throw w(le,"type");a(">");var pe=n();if(!ei.test(pe))throw w(pe,"name");a("=");var Ce=new Er(T(pe),R(n()),oe,le);M(Ce,function(Ye){if(Ye==="option")Ae(Ce,Ye),a(";");else throw w(Ye)},function(){ye(Ce)}),Q.add(Ce)}function ae(Q,se){if(!ei.test(se=n()))throw w(se,"name");var oe=new Bs(T(se));M(oe,function(pe){pe==="option"?(Ae(oe,pe),a(";")):(s(pe),U(oe,"optional"))}),Q.add(oe)}function ue(Q,se){if(!ei.test(se=n()))throw w(se,"name");var oe=new Br(se);M(oe,function(pe){switch(pe){case"option":Ae(oe,pe),a(";");break;case"reserved":N(oe.reserved||(oe.reserved=[]),!0);break;default:Ee(oe,pe)}}),Q.add(oe)}function Ee(Q,se){if(!ei.test(se))throw w(se,"name");a("=");var oe=R(n(),!0),le={};M(le,function(Ce){if(Ce==="option")Ae(le,Ce),a(";");else throw w(Ce)},function(){ye(le)}),Q.add(se,oe,le.comment)}function Ae(Q,se){var oe=a("(",!0);if(!ti.test(se=n()))throw w(se,"name");var le=se;oe&&(a(")"),le="("+le+")",se=o(),yT.test(se)&&(le+=se,n())),a("="),P(Q,le)}function P(Q,se){if(a("{",!0))do{if(!ei.test(ce=n()))throw w(ce,"name");o()==="{"?P(Q,se+"."+ce):(a(":"),o()==="{"?P(Q,se+"."+ce):ee(Q,se+"."+ce,C(!0))),a(",",!0)}while(!a("}",!0));else ee(Q,se,C(!0))}function ee(Q,se,oe){Q.setOption&&Q.setOption(se,oe)}function ye(Q){if(a("[",!0)){do Ae(Q,"option");while(a(",",!0));a("]")}return Q}function De(Q,se){if(!ti.test(se=n()))throw w(se,"reference");var oe=se;M(null,function(pe){switch(pe){case"required":case"repeated":case"optional":U(Q,pe,oe);break;default:if(!m||!ti.test(pe))throw w(pe);s(pe),U(Q,"optional",oe);break}})}for(var ce;(ce=n())!==null;)switch(ce){case"package":if(!l)throw w(ce);F();break;case"import":if(!l)throw w(ce);z();break;case"syntax":if(!l)throw w(ce);K();break;case"option":if(!l)throw w(ce);Ae(E,ce),a(";");break;default:if(B(E,ce)){l=!1;continue}throw w(ce)}return Object.defineProperty(pi,"filename",{value:null}),{package:f,imports:g,weakImports:d,syntax:y,root:e}}Ne._configure(Br,gi,v);Ne._configure2();Ms._configure(gi);kt._configure(v,Br,A);gi._configure(v);A._configure(v);sn._configure(iE);$n._configure(cy);const py=Ne.Long;let Mr=class extends Y{toJSON(){return{numerator:this.numerator,denominator:this.denominator}}};h([A.d(1,"int32"),u("design:type",Number)],Mr.prototype,"numerator",void 0);h([A.d(2,"int32"),u("design:type",Number)],Mr.prototype,"denominator",void 0);Mr=h([v.d("Fraction")],Mr);let lr=class extends Y{toJSON(){return{numerator:this.numerator,denominator:this.denominator}}};h([A.d(1,"string"),u("design:type",String)],lr.prototype,"numerator",void 0);h([A.d(2,"string"),u("design:type",String)],lr.prototype,"denominator",void 0);lr=h([v.d("FractionBigIntModel")],lr);let na=class extends Y{toJSON(){return{start:this.start,end:this.end}}};h([A.d(1,"uint32"),u("design:type",Number)],na.prototype,"start",void 0);h([A.d(2,"uint32"),u("design:type",Number)],na.prototype,"end",void 0);na=h([v.d("Range")],na);let sa=class extends Y{toJSON(){return{prevWeight:this.prevWeight,nextWeight:this.nextWeight}}};h([A.d(1,"string"),u("design:type",String)],sa.prototype,"prevWeight",void 0);h([A.d(2,"string"),u("design:type",String)],sa.prototype,"nextWeight",void 0);sa=h([v.d("RateModel")],sa);class uo{constructor(e,t){this._hm=e,this._m=new Map(t(e))}set(e,t){return this._m.set(e,t),this._hm[e]=t,this}delete(e){return delete this._hm[e],this._m.delete(e)}clear(){for(const e in this._hm)delete this._hm[e];return this._m.clear()}toJSON(){const e={};for(const t of this._m.entries()){const r=t[1];e[t[0]]=r&&typeof r.toJSON=="function"?r.toJSON():r}return e}get has(){return this._m.has.bind(this._m)}get get(){return this._m.get.bind(this._m)}get size(){return this._m.size}get[Symbol.iterator](){return this._m[Symbol.iterator].bind(this._m)}get entries(){return this._m.entries.bind(this._m)}get keys(){return this._m.keys.bind(this._m)}get values(){return this._m.values.bind(this._m)}get[Symbol.toStringTag](){return"TypedMap"}}h([ne,u("design:type",Object),u("design:paramtypes",[])],uo.prototype,"has",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],uo.prototype,"get",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],uo.prototype,Symbol.iterator,null);h([ne,u("design:type",Object),u("design:paramtypes",[])],uo.prototype,"entries",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],uo.prototype,"keys",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],uo.prototype,"values",null);class Bi extends uo{constructor(e){super(e,t=>Object.entries(t))}}class Yl{constructor(e){this._l=e,this._s=new Set(e)}add(e){return this._s.has(e)||(this._l.push(e),this._s.add(e)),this}delete(e){if(this._s.delete(e)){const t=this._l.indexOf(e);return this._l.splice(t,1),!0}return!1}clear(){this._s.clear(),this._l.length=0}get has(){return this._s.has.bind(this._s)}get size(){return this._s.size}get[Symbol.iterator](){return this._s[Symbol.iterator].bind(this._s)}get entries(){return this._s.entries.bind(this._s)}get keys(){return this._s.keys.bind(this._s)}get values(){return this._s.values.bind(this._s)}get[Symbol.toStringTag](){return"TypedSet"}}h([ne,u("design:type",Object),u("design:paramtypes",[])],Yl.prototype,"has",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Yl.prototype,Symbol.iterator,null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Yl.prototype,"entries",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Yl.prototype,"keys",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Yl.prototype,"values",null);let vc=class extends Y{get remarkMap(){return this._remarkMap||(this._remarkMap=new Bi(this.remark)),this._remarkMap}toJSON(){return{remark:this.remark}}getBytes(){return this.$type.encode(this).finish()}};h([Er.d(1,"string","string"),u("design:type",Object)],vc.prototype,"remark",void 0);h([Ys,u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",void 0)],vc.prototype,"getBytes",null);vc=h([v.d("TemplateRemark")],vc);const Qf=new WeakMap,mT=new Uint8Array,Lh=[],Dh=Object.create({});for(let i=0;i<256;i++){const e=i.toString(16).padStart(2,"0");Lh[i]=e,Dh[e]=i,Dh[e.toUpperCase()]=i}const Wf=[];{const i=new Uint16Array(1),e=new Uint8Array(i.buffer);for(const t of Lh)for(const r of Lh)e[0]=Dh[t],e[1]=Dh[r],Wf[i[0]]=t+r}const wc=new Uint8Array(40),f_=new Uint16Array(wc.buffer);function _T(i){const e=i.length>>1;let t="";if(wc.length>=i.length){wc.set(i,0);for(let r=0;r<e;r++)t+=Wf[f_[r]]}else{let r=0;do{const n=Math.min(wc.length,i.length-r);for(let o=0;o<n;++o)wc[o]=i[o+r];const s=n>>1;for(let o=0;o<s;o++)t+=Wf[f_[o]];r+=n}while(r<i.length)}return e<<1!==i.length&&(t+=Lh[i[i.length-1]]),t}function cE(i){const e=new Uint8Array(i.length>>1);let t=0,r=0;for(;r<e.length;){let n=i.charCodeAt(t++);n<=57?n=n-48<<4:n<=70?n=n-55<<4:n<=102&&(n=n-87<<4);let s=i.charCodeAt(t++);s<=57?s-=48:s<=70?s-=55:s<=102&&(s-=87),e[r++]=n+s}return e}function ly(i){if(!i)return"";let e;return i.length===i.byteLength&&(e=Qf.get(i),typeof e=="string")||(e=_T(i),Qf.set(i,e)),e}const Me=ly;function pE(i){if(!i)return mT;const e=cE(i);return Qf.set(e,i),e}const he=pE;var Xa;let lt=Xa=class extends Y{get publicKey(){return Me(this.publicKeyBuffer)}set publicKey(e){this.publicKeyBuffer=he(e)}get signature(){return Me(this.signatureBuffer)}set signature(e){this.signatureBuffer=he(e)}get secondPublicKey(){return this.secondPublicKeyBuffer&&Me(this.secondPublicKeyBuffer)||void 0}set secondPublicKey(e){this.secondPublicKeyBuffer=he(e)}get signSignature(){return this.signSignatureBuffer&&Me(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=he(e)}toJSON(){const e={publicKey:this.publicKey,signature:this.signature};return this.secondPublicKey&&(e.secondPublicKey=this.secondPublicKey),this.signSignature&&(e.signSignature=this.signSignature),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.publicKey&&(t.publicKey=e.publicKey),e.signature&&(t.signature=e.signature),e.secondPublicKey&&(t.secondPublicKey=e.secondPublicKey),e.signSignature&&(t.signSignature=e.signSignature)),t}};lt.INC=1;h([A.d(Xa.INC++,"bytes"),u("design:type",Uint8Array)],lt.prototype,"publicKeyBuffer",void 0);h([A.d(Xa.INC++,"bytes"),u("design:type",Uint8Array)],lt.prototype,"signatureBuffer",void 0);h([A.d(Xa.INC++,"bytes"),u("design:type",Uint8Array)],lt.prototype,"secondPublicKeyBuffer",void 0);h([A.d(Xa.INC++,"bytes"),u("design:type",Uint8Array)],lt.prototype,"signSignatureBuffer",void 0);lt=Xa=h([v.d("AccountSignatureModel")],lt);let qt=class extends Y{toJSON(){return{taxCollector:this.taxCollector,taxAssetPrealnum:this.taxAssetPrealnum}}};h([A.d(1,"string"),u("design:type",String)],qt.prototype,"taxCollector",void 0);h([A.d(2,"string"),u("design:type",String)],qt.prototype,"taxAssetPrealnum",void 0);qt=h([v.d("TaxInformationModel")],qt);var kh;(function(i){i.TESTNET="c",i.MAINNET="b"})(kh||(kh={}));const lE="100000000";var g_;(function(i){i[i.CHAIN=2]="CHAIN",i[i.DAPP=4]="DAPP",i[i.LNS=8]="LNS"})(g_||(g_={}));const Hh={ENDPOINT:Symbol("endpoint"),REFUSETIME:Symbol("refuseTime")};var L;(function(i){i[i.DAPP=1]="DAPP",i[i.LOCATION_NAME=2]="LOCATION_NAME",i[i.ENTITY=3]="ENTITY",i[i.ASSETS=5]="ASSETS",i[i.CERTIFICATE=6]="CERTIFICATE"})(L||(L={}));var Zo;(function(i){i.ACCOUNT_PARTICIPATION="accountParticipation",i.ACCOUNT_POSSESS_MAIN_ASSETS="accountPossessMainAssets",i.ACCOUNT_NUMBER_OF_TRANSACTION_IN_BLOCK="accountNumberOfTransactionInBlock",i.BLOCK_HEIGHT="blockHeight"})(Zo||(Zo={}));var Yt;(function(i){i.ADD="+",i.SUBTRACT="-",i.MULTIPLY="*",i.DIVIDE="/",i.POWER="**",i.MODULAR="%"})(Yt||(Yt={}));var bt;(function(i){i.LEFT_BRACKET="(",i.RIGHT_BRACKET=")"})(bt||(bt={}));const Bo=[Zo.ACCOUNT_PARTICIPATION,Zo.ACCOUNT_POSSESS_MAIN_ASSETS,Zo.ACCOUNT_NUMBER_OF_TRANSACTION_IN_BLOCK,Zo.BLOCK_HEIGHT],Mo=[Yt.ADD,Yt.SUBTRACT,Yt.MULTIPLY,Yt.DIVIDE,Yt.POWER,Yt.MODULAR],d_=[bt.LEFT_BRACKET,bt.RIGHT_BRACKET];var zi;(function(i){i[i.P_0=0]="P_0",i[i.P_1=1]="P_1",i[i.P_2=2]="P_2",i[i.P_3=3]="P_3",i[i.P_4=4]="P_4",i[i.P_5=5]="P_5",i[i.P_6=6]="P_6",i[i.P_7=7]="P_7",i[i.P_8=8]="P_8",i[i.P_9=9]="P_9",i.P_10="A",i.P_11="B",i.P_12="C",i.P_13="D",i.P_14="E",i.P_15="F",i.P_16="G",i.P_17="H",i.P_18="I",i.P_19="J",i.P_20="K",i.P_21="L",i.P_22="M",i.P_23="N",i.P_24="O",i.P_25="P",i.P_26="Q",i.P_27="R",i.P_28="S",i.P_29="T",i.P_30="U",i.P_31="V",i.P_32="W",i.P_33="X",i.P_34="Y",i.P_35="Z"})(zi||(zi={}));var Fh;(function(i){i.DIFFERENT_PRE_BLOCK_SIGNATURE="the previous block signature is inconsistent",i.GENERATE_BLOCK_FAIL="generate block fail",i.REPLY_BLOCK_FAIL="reply block fail"})(Fh||(Fh={}));class wt extends Map{constructor(e,t,r=s=>s,n){super(t),this.creater=e,this.transformKey=r,this._afterDelete=n}static from(e){return new wt(e.creater,e.entries,e.transformKey,e.afterDelete)}forceGet(e,t=this.creater){const r=this.transformKey(e);if(super.has(r))return super.get(r);const n=t(e,r);return super.set(r,n),n}tryGet(e){return this.get(this.transformKey(e))}trySet(e,t){return this.set(this.transformKey(e),t)}tryDelete(e){return this.delete(this.transformKey(e))}tryHas(e){return this.has(this.transformKey(e))}delete(e){const t=super.delete(e);return t&&this._afterDelete&&this._afterDelete(e),t}get[Symbol.toStringTag](){return"EasyMap"}static call(e,t,r,n,s){if(!(e instanceof wt))throw new TypeError("please use new keyword to create EasyMap instance.");const o=new wt(t,r,n,s),a=Object.getPrototypeOf(o),p=Object.getPrototypeOf(a),l=Object.getOwnPropertyDescriptors(p);for(const d in l)if(d!=="constructor"){const y=l[d];typeof y.value=="function"?y.value=y.value.bind(o):(typeof y.get=="function"&&(y.get=y.get.bind(o)),typeof y.set=="function"&&(y.set=y.set.bind(o))),Object.defineProperty(e,d,y)}const f=Object.getOwnPropertyDescriptors(a);for(const d in f)if(d!=="constructor"){const y=f[d];typeof y.value=="function"?y.value=y.value.bind(o):(typeof y.get=="function"&&(y.get=y.get.bind(o)),typeof y.set=="function"&&(y.set=y.set.bind(o))),Object.defineProperty(e,d,y)}const g=Object.getOwnPropertyDescriptors(o);for(const d in g)d!=="constructor"&&Object.defineProperty(e,d,{enumerable:!0,configurable:!0,get:()=>Reflect.get(o,d),set(y){Reflect.set(o,d,y)}});return e}}class ps extends WeakMap{constructor(e,t,r=s=>s,n){super(t),this.creater=e,this.transformKey=r,this._afterDelete=n}static from(e){return new ps(e.creater,e.entries,e.transformKey,e.afterDelete)}forceGet(e,t=this.creater){const r=this.transformKey(e);if(this.has(r))return this.get(r);const n=t(e,r);return this.set(r,n),n}tryGet(e){return this.get(this.transformKey(e))}trySet(e,t){return this.set(this.transformKey(e),t)}tryDelete(e){return this.delete(this.transformKey(e))}tryHas(e){return this.has(this.transformKey(e))}delete(e){const t=super.delete(e);return t&&this._afterDelete&&this._afterDelete(e),t}get[Symbol.toStringTag](){return"EasyWeakMap"}static call(e,t,r,n,s){if(!(e instanceof ps))throw new TypeError("please use new keyword to create EasyWeakMap instance.");const o=new ps(t,r,n,s),a=Object.getPrototypeOf(o),p=Object.getPrototypeOf(a),l=Object.getOwnPropertyDescriptors(p);for(const d in l)if(d!=="constructor"){const y=l[d];typeof y.value=="function"?y.value=y.value.bind(o):(typeof y.get=="function"&&(y.get=y.get.bind(o)),typeof y.set=="function"&&(y.set=y.set.bind(o))),Object.defineProperty(e,d,y)}const f=Object.getOwnPropertyDescriptors(a);for(const d in f)if(d!=="constructor"){const y=f[d];typeof y.value=="function"?y.value=y.value.bind(o):(typeof y.get=="function"&&(y.get=y.get.bind(o)),typeof y.set=="function"&&(y.set=y.set.bind(o))),Object.defineProperty(e,d,y)}const g=Object.getOwnPropertyDescriptors(o);for(const d in g)d!=="constructor"&&Object.defineProperty(e,d,{enumerable:!0,configurable:!0,get:()=>Reflect.get(o,d),set(y){Reflect.set(o,d,y)}});return e}}var Uu,Ct;const AT=new ps(i=>new Bi(i.remark)),ET=new ps(i=>{const e={},t="blob+sha256+hex://";for(const r in i.remark){const n=i.remark[r];if(n.startsWith(t)){const s=n.slice(t.length).split("?");if(s.length!==2)continue;try{const o=cE(s[0]);if(o.length===32){const a=s[1].split("=");if(a.length!==2||a[0]!=="size")continue;const p=Number(a[1]);if(Number.isNaN(p))continue;e[r]=["SHA256",s[0],o,p]}}catch{}}}return new Bi(e)});let hs=Uu=class extends Y{toJSON(){return{key:this.key,value:this.value}}};hs.INC=1;h([A.d(Uu.INC++,"string"),u("design:type",String)],hs.prototype,"key",void 0);h([A.d(Uu.INC++,"string"),u("design:type",String)],hs.prototype,"value",void 0);hs=Uu=h([v.d("TransactionBaseStorageModel")],hs);let Ie=Ct=class extends Y{get senderPublicKey(){return Me(this.senderPublicKeyBuffer)}set senderPublicKey(e){this.senderPublicKeyBuffer=he(e)}get senderSecondPublicKey(){return this.senderSecondPublicKeyBuffer&&Me(this.senderSecondPublicKeyBuffer)||void 0}set senderSecondPublicKey(e){this.senderSecondPublicKeyBuffer=he(e)}get signature(){return Me(this.signatureBuffer)}set signature(e){this.signatureBuffer=he(e)}get storageKey(){return this.storage&&this.storage.key}get storageValue(){return this.storage&&this.storage.value}get signSignature(){return this.signSignatureBuffer&&Me(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=he(e)}get remarkMap(){return AT.forceGet(this)}get blobMap(){return ET.forceGet(this)}get blobSize(){let e=0;const t=this.blobMap.values();for(const r of t)e+=r[3];return e}getBytes(e,t){const r={};e&&(r.signatureBuffer={value:null}),t&&(r.signSignatureBuffer={value:null});const n=Object.create(this,r);return this.$type.encode(n).finish()}toJSON(){const e={version:this.version,type:this.type,senderId:this.senderId,senderPublicKey:this.senderPublicKey,rangeType:this.rangeType,range:this.range,fee:this.fee,timestamp:this.timestamp,fromMagic:this.fromMagic,toMagic:this.toMagic,applyBlockHeight:this.applyBlockHeight,effectiveBlockHeight:this.effectiveBlockHeight,signature:this.signature,remark:this.remark,asset:this.asset.toJSON(),nonce:this.nonce};return this.recipientId&&(e.recipientId=this.recipientId),this.dappid&&(e.dappid=this.dappid),this.lns&&(e.lns=this.lns),this.sourceIP&&(e.sourceIP=this.sourceIP),this.senderSecondPublicKey&&(e.senderSecondPublicKey=this.senderSecondPublicKey),this.signSignature&&(e.signSignature=this.signSignature),this.storageKey&&(e.storageKey=this.storageKey),this.storageValue&&(e.storageValue=this.storageValue),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.senderPublicKey&&(t.senderPublicKey=e.senderPublicKey),e.senderSecondPublicKey&&(t.senderSecondPublicKey=e.senderSecondPublicKey),e.signature&&(t.signature=e.signature),e.signSignature&&(t.signSignature=e.signSignature),!t.storage&&typeof e.storageKey=="string"&&typeof e.storageValue=="string"&&(t.storage=new hs({key:e.storageKey,value:e.storageValue}))),t}};Ie.INC=1;h([A.d(Ct.INC++,"uint32"),u("design:type",Number)],Ie.prototype,"version",void 0);h([A.d(Ct.INC++,"string"),u("design:type",String)],Ie.prototype,"type",void 0);h([A.d(Ct.INC++,"string"),u("design:type",String)],Ie.prototype,"senderId",void 0);h([A.d(Ct.INC++,"bytes"),u("design:type",Uint8Array)],Ie.prototype,"senderPublicKeyBuffer",void 0);h([A.d(Ct.INC++,"bytes","optional"),u("design:type",Uint8Array)],Ie.prototype,"senderSecondPublicKeyBuffer",void 0);h([A.d(Ct.INC++,"string","optional"),u("design:type",String)],Ie.prototype,"recipientId",void 0);h([A.d(Ct.INC++,"uint32"),u("design:type",Number)],Ie.prototype,"rangeType",void 0);h([A.d(Ct.INC++,"string","repeated"),u("design:type",Array)],Ie.prototype,"range",void 0);h([A.d(Ct.INC++,"string"),u("design:type",String)],Ie.prototype,"fee",void 0);h([A.d(Ct.INC++,"uint32"),u("design:type",Number)],Ie.prototype,"timestamp",void 0);h([A.d(Ct.INC++,"string","optional"),u("design:type",String)],Ie.prototype,"dappid",void 0);h([A.d(Ct.INC++,"string","optional"),u("design:type",String)],Ie.prototype,"lns",void 0);h([A.d(Ct.INC++,"string","optional"),u("design:type",String)],Ie.prototype,"sourceIP",void 0);h([A.d(Ct.INC++,"string"),u("design:type",String)],Ie.prototype,"fromMagic",void 0);h([A.d(Ct.INC++,"string"),u("design:type",String)],Ie.prototype,"toMagic",void 0);h([A.d(Ct.INC++,"uint32"),u("design:type",Number)],Ie.prototype,"applyBlockHeight",void 0);h([A.d(Ct.INC++,"uint32"),u("design:type",Number)],Ie.prototype,"effectiveBlockHeight",void 0);h([A.d(Ct.INC++,"fixed32","required"),u("design:type",Number)],Ie.prototype,"nonce",void 0);h([A.d(Ct.INC++,"bytes"),u("design:type",Uint8Array)],Ie.prototype,"signatureBuffer",void 0);h([A.d(Ct.INC++,hs,"optional"),u("design:type",hs)],Ie.prototype,"storage",void 0);h([A.d(Ct.INC++,"bytes","optional"),u("design:type",Uint8Array)],Ie.prototype,"signSignatureBuffer",void 0);h([Er.d(Ct.INC++,"string","string"),u("design:type",Object)],Ie.prototype,"remark",void 0);h([Ys,u("design:type",Function),u("design:paramtypes",[Boolean,Boolean]),u("design:returntype",void 0)],Ie.prototype,"getBytes",null);Ie=Ct=h([v.d("Transaction")],Ie);let Lc=class extends Y{toJSON(){return{alias:this.alias}}};h([A.d(1,"string"),u("design:type",String)],Lc.prototype,"alias",void 0);Lc=h([v.d("UsernameModel")],Lc);let Dc=class extends Y{toJSON(){return{username:this.username.toJSON()}}};h([A.d(1,Lc),u("design:type",Lc)],Dc.prototype,"username",void 0);Dc=h([v.d("UsernameAssetModel")],Dc);let kc=class extends Y{get publicKey(){return Me(this.publicKeyBuffer)}set publicKey(e){this.publicKeyBuffer=he(e)}toJSON(){return{publicKey:this.publicKey}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.publicKey&&(t.publicKey=e.publicKey),t}};h([A.d(1,"bytes"),u("design:type",Uint8Array)],kc.prototype,"publicKeyBuffer",void 0);kc=h([v.d("SignatureModel")],kc);let Hc=class extends Y{toJSON(){return{signature:this.signature.toJSON()}}};h([A.d(1,kc),u("design:type",kc)],Hc.prototype,"signature",void 0);Hc=h([v.d("SignatureAssetModel")],Hc);let Vh=class extends Y{toJSON(){return{}}};Vh=h([v.d("DelegateAssetModel")],Vh);let Fc=class extends Y{toJSON(){return{equity:this.equity}}};h([A.d(1,"string"),u("design:type",String)],Fc.prototype,"equity",void 0);Fc=h([v.d("VoteModel")],Fc);let Vc=class extends Y{toJSON(){return{vote:this.vote.toJSON()}}};h([A.d(1,Fc),u("design:type",Fc)],Vc.prototype,"vote",void 0);Vc=h([v.d("VoteAssetModel")],Vc);let $h=class extends Y{toJSON(){return{}}};$h=h([v.d("AcceptVoteAssetModel")],$h);let Uh=class extends Y{toJSON(){return{}}};Uh=h([v.d("RejectVoteAssetModel")],Uh);var fo;let Yr=fo=class extends Y{toJSON(){const e={sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,dappid:this.dappid,type:this.type};return this.purchaseAsset&&(e.purchaseAsset=this.purchaseAsset),e}};Yr.INC=1;h([A.d(fo.INC++,"string"),u("design:type",String)],Yr.prototype,"sourceChainName",void 0);h([A.d(fo.INC++,"string"),u("design:type",String)],Yr.prototype,"sourceChainMagic",void 0);h([A.d(fo.INC++,"string"),u("design:type",String)],Yr.prototype,"dappid",void 0);h([A.d(fo.INC++,"uint32"),u("design:type",Number)],Yr.prototype,"type",void 0);h([A.d(fo.INC++,"string","optional"),u("design:type",String)],Yr.prototype,"purchaseAsset",void 0);Yr=fo=h([v.d("DAppModel")],Yr);let $c=class extends Y{toJSON(){return{dapp:this.dapp.toJSON()}}};h([A.d(1,Yr),u("design:type",Yr)],$c.prototype,"dapp",void 0);$c=h([v.d("DAppAssetModel")],$c);var hy;let ia=hy=class extends Y{toJSON(){return{dappAsset:this.dappAsset.toJSON()}}};ia.INC=1;h([A.d(hy.INC++,Yr),u("design:type",Yr)],ia.prototype,"dappAsset",void 0);ia=hy=h([v.d("DAppPurchasingModel")],ia);let Uc=class extends Y{toJSON(){return{dappPurchasing:this.dappPurchasing.toJSON()}}};h([A.d(1,ia),u("design:type",ia)],Uc.prototype,"dappPurchasing",void 0);Uc=h([v.d("DAppPurchasingAssetModel")],Uc);var Ql;let di=Ql=class extends Y{toJSON(){return{content:this.content,action:this.action,dapp:this.dapp.toJSON()}}};di.INC=1;h([A.d(Ql.INC++,"string"),u("design:type",String)],di.prototype,"content",void 0);h([A.d(Ql.INC++,"string"),u("design:type",String)],di.prototype,"action",void 0);h([A.d(Ql.INC++,Yr),u("design:type",Yr)],di.prototype,"dapp",void 0);di=Ql=h([v.d("MarkModel")],di);let Kc=class extends Y{toJSON(){return{mark:this.mark.toJSON()}}};h([A.d(1,di),u("design:type",di)],Kc.prototype,"mark",void 0);Kc=h([v.d("MarkAssetModel")],Kc);let yi=class extends Y{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,expectedIssuedAssets:this.expectedIssuedAssets}}};h([A.d(1,"string"),u("design:type",String)],yi.prototype,"sourceChainName",void 0);h([A.d(2,"string"),u("design:type",String)],yi.prototype,"sourceChainMagic",void 0);h([A.d(3,"string"),u("design:type",String)],yi.prototype,"assetType",void 0);h([A.d(4,"string"),u("design:type",String)],yi.prototype,"expectedIssuedAssets",void 0);yi=h([v.d("IssueAssetModel")],yi);let Gc=class extends Y{toJSON(){return{issueAsset:this.issueAsset.toJSON()}}};h([A.d(1,yi),u("design:type",yi)],Gc.prototype,"issueAsset",void 0);Gc=h([v.d("IssueAssetAssetModel")],Gc);let mi=class extends Y{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,amount:this.amount}}};h([A.d(1,"string"),u("design:type",String)],mi.prototype,"sourceChainName",void 0);h([A.d(2,"string"),u("design:type",String)],mi.prototype,"sourceChainMagic",void 0);h([A.d(3,"string"),u("design:type",String)],mi.prototype,"assetType",void 0);h([A.d(4,"string"),u("design:type",String)],mi.prototype,"amount",void 0);mi=h([v.d("TransferAssetModel")],mi);let zc=class extends Y{toJSON(){return{transferAsset:this.transferAsset.toJSON()}}};h([A.d(1,mi),u("design:type",mi)],zc.prototype,"transferAsset",void 0);zc=h([v.d("TransferAssetAssetModel")],zc);let _i=class extends Y{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,amount:this.amount}}};h([A.d(1,"string"),u("design:type",String)],_i.prototype,"sourceChainName",void 0);h([A.d(2,"string"),u("design:type",String)],_i.prototype,"sourceChainMagic",void 0);h([A.d(3,"string"),u("design:type",String)],_i.prototype,"assetType",void 0);h([A.d(4,"string"),u("design:type",String)],_i.prototype,"amount",void 0);_i=h([v.d("DestroyAssetModel")],_i);let jc=class extends Y{toJSON(){return{destroyAsset:this.destroyAsset.toJSON()}}};h([A.d(1,_i),u("design:type",_i)],jc.prototype,"destroyAsset",void 0);jc=h([v.d("DestroyAssetAssetModel")],jc);var Ss;const y_=new WeakMap;let Hr=Ss=class extends Y{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=y_.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Me(r))),t}set cipherPublicKeys(e){const t=e.map(r=>he(r));y_.set(t,e),this.cipherPublicKeysBuffer=t}toJSON(){const e={cipherPublicKeys:this.cipherPublicKeys,sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,assetType:this.assetType,amount:this.amount,totalGrabableTimes:this.totalGrabableTimes,giftDistributionRule:this.giftDistributionRule};return this.beginUnfrozenBlockHeight&&(e.beginUnfrozenBlockHeight=this.beginUnfrozenBlockHeight),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Hr.INC=1;h([A.d(Ss.INC++,"bytes","repeated"),u("design:type",Array)],Hr.prototype,"cipherPublicKeysBuffer",void 0);h([A.d(Ss.INC++,"string"),u("design:type",String)],Hr.prototype,"sourceChainMagic",void 0);h([A.d(Ss.INC++,"string"),u("design:type",String)],Hr.prototype,"sourceChainName",void 0);h([A.d(Ss.INC++,"string"),u("design:type",String)],Hr.prototype,"assetType",void 0);h([A.d(Ss.INC++,"string"),u("design:type",String)],Hr.prototype,"amount",void 0);h([A.d(Ss.INC++,"uint32"),u("design:type",Number)],Hr.prototype,"totalGrabableTimes",void 0);h([A.d(Ss.INC++,"uint32","optional"),u("design:type",Number)],Hr.prototype,"beginUnfrozenBlockHeight",void 0);h([A.d(Ss.INC++,"uint32"),u("design:type",Number)],Hr.prototype,"giftDistributionRule",void 0);Hr=Ss=h([v.d("GiftAssetModel")],Hr);let Jc=class extends Y{toJSON(){return{giftAsset:this.giftAsset.toJSON()}}};h([A.d(1,Hr),u("design:type",Hr)],Jc.prototype,"giftAsset",void 0);Jc=h([v.d("GiftAssetAssetModel")],Jc);var go;const gf=new WeakMap;let Un=go=class extends Y{get blockSignature(){return Me(this.blockSignatureBuffer)}set blockSignature(e){this.blockSignatureBuffer=he(e)}get transactionSignature(){return Me(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=he(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=lt.decode(e);return gf.set(t,e),t}set ciphertextSignature(e){if(e){let t=gf.get(e);t||(t=lt.encode(e).finish(),gf.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={blockSignature:this.blockSignature,transactionSignature:this.transactionSignature,amount:this.amount,giftAsset:this.giftAsset.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.blockSignature&&(t.blockSignature=e.blockSignature),e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=lt.fromObject(e.ciphertextSignature))),t}};Un.INC=1;h([A.d(go.INC++,"bytes"),u("design:type",Uint8Array)],Un.prototype,"blockSignatureBuffer",void 0);h([A.d(go.INC++,"bytes"),u("design:type",Uint8Array)],Un.prototype,"transactionSignatureBuffer",void 0);h([A.d(go.INC++,"string"),u("design:type",String)],Un.prototype,"amount",void 0);h([A.d(go.INC++,"bytes","optional"),u("design:type",Uint8Array)],Un.prototype,"ciphertextSignatureBuffer",void 0);h([A.d(go.INC++,Hr),u("design:type",Hr)],Un.prototype,"giftAsset",void 0);Un=go=h([v.d("GrabAssetModel")],Un);let Yc=class extends Y{toJSON(){return{grabAsset:this.grabAsset.toJSON()}}};h([A.d(1,Un),u("design:type",Un)],Yc.prototype,"grabAsset",void 0);Yc=h([v.d("GrabAssetAssetModel")],Yc);var Mi;let cn=Mi=class extends Y{toJSON(){return{trustees:this.trustees,numberOfSignFor:this.numberOfSignFor,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,amount:this.amount}}};cn.INC=1;h([A.d(Mi.INC++,"string","repeated"),u("design:type",Array)],cn.prototype,"trustees",void 0);h([A.d(Mi.INC++,"uint32"),u("design:type",Number)],cn.prototype,"numberOfSignFor",void 0);h([A.d(Mi.INC++,"string"),u("design:type",String)],cn.prototype,"sourceChainName",void 0);h([A.d(Mi.INC++,"string"),u("design:type",String)],cn.prototype,"sourceChainMagic",void 0);h([A.d(Mi.INC++,"string"),u("design:type",String)],cn.prototype,"assetType",void 0);h([A.d(Mi.INC++,"string"),u("design:type",String)],cn.prototype,"amount",void 0);cn=Mi=h([v.d("TrustAssetModel")],cn);let Qc=class extends Y{toJSON(){return{trustAsset:this.trustAsset.toJSON()}}};h([A.d(1,cn),u("design:type",cn)],Qc.prototype,"trustAsset",void 0);Qc=h([v.d("TrustAssetAssetModel")],Qc);var Za;let us=Za=class extends Y{get transactionSignature(){return Me(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=he(e)}getBytes(){const t=Object.create(this,{signatureBufferList:{value:null}});return this.$type.encode(t).finish()}toJSON(){return{transactionSignature:this.transactionSignature,trustSenderId:this.trustSenderId,trustRecipientId:this.trustRecipientId,trustAsset:this.trustAsset.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.transactionSignature&&(t.transactionSignature=e.transactionSignature),t}};us.INC=1;h([A.d(Za.INC++,"bytes"),u("design:type",Uint8Array)],us.prototype,"transactionSignatureBuffer",void 0);h([A.d(Za.INC++,"string"),u("design:type",String)],us.prototype,"trustSenderId",void 0);h([A.d(Za.INC++,"string"),u("design:type",String)],us.prototype,"trustRecipientId",void 0);h([A.d(Za.INC++,cn),u("design:type",cn)],us.prototype,"trustAsset",void 0);h([Ys,u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",void 0)],us.prototype,"getBytes",null);us=Za=h([v.d("SignForAssetModel")],us);let Wc=class extends Y{toJSON(){return{signForAsset:this.signForAsset.toJSON()}}};h([A.d(1,us),u("design:type",us)],Wc.prototype,"signForAsset",void 0);Wc=h([v.d("SignForAssetAssetModel")],Wc);var Xn;const df=new WeakMap;let hr=Xn=class extends Y{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=df.get(e);return t||(t=Object.freeze(e.map(r=>Me(r))),df.set(e,t)),t}set cipherPublicKeys(e){const t=[];for(const r of e)t.push(he(r));Object.isFrozen(e)&&df.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return{magic:this.toExchangeSource,chainName:this.toExchangeChainName,assetType:this.toExchangeAsset,amount:this.toExchangeNumber}}get be(){return{magic:this.beExchangeSource,chainName:this.beExchangeChainName,assetType:this.beExchangeAsset}}toJSON(){return{cipherPublicKeys:this.cipherPublicKeys,toExchangeSource:this.toExchangeSource,beExchangeSource:this.beExchangeSource,toExchangeChainName:this.toExchangeChainName,beExchangeChainName:this.beExchangeChainName,toExchangeAsset:this.toExchangeAsset,beExchangeAsset:this.beExchangeAsset,toExchangeNumber:this.toExchangeNumber,exchangeRate:this.exchangeRate.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};hr.INC=1;h([A.d(Xn.INC++,"bytes","repeated"),u("design:type",Array)],hr.prototype,"cipherPublicKeysBuffer",void 0);h([A.d(Xn.INC++,"string"),u("design:type",String)],hr.prototype,"toExchangeSource",void 0);h([A.d(Xn.INC++,"string"),u("design:type",String)],hr.prototype,"beExchangeSource",void 0);h([A.d(Xn.INC++,"string"),u("design:type",String)],hr.prototype,"toExchangeChainName",void 0);h([A.d(Xn.INC++,"string"),u("design:type",String)],hr.prototype,"beExchangeChainName",void 0);h([A.d(Xn.INC++,"string"),u("design:type",String)],hr.prototype,"toExchangeAsset",void 0);h([A.d(Xn.INC++,"string"),u("design:type",String)],hr.prototype,"beExchangeAsset",void 0);h([A.d(Xn.INC++,"string"),u("design:type",String)],hr.prototype,"toExchangeNumber",void 0);h([A.d(Xn.INC++,sa),u("design:type",sa)],hr.prototype,"exchangeRate",void 0);h([ne,u("design:type",Object),u("design:paramtypes",[])],hr.prototype,"to",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],hr.prototype,"be",null);hr=Xn=h([v.d("ToExchangeAssetModel")],hr);let qc=class extends Y{toJSON(){return{toExchangeAsset:this.toExchangeAsset.toJSON()}}};h([A.d(1,hr),u("design:type",hr)],qc.prototype,"toExchangeAsset",void 0);qc=h([v.d("ToExchangeAssetAssetModel")],qc);var yo;const yf=new WeakMap;let Kn=yo=class extends Y{get transactionSignature(){return Me(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=he(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=lt.decode(e);return yf.set(t,e),t}set ciphertextSignature(e){if(e){let t=yf.get(e);t||(t=lt.encode(e).finish(),yf.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}get to(){return{magic:this.exchangeAsset.toExchangeSource,chainName:this.exchangeAsset.toExchangeChainName,assetType:this.exchangeAsset.toExchangeAsset,amount:this.toExchangeNumber}}get be(){return{magic:this.exchangeAsset.beExchangeSource,chainName:this.exchangeAsset.beExchangeChainName,assetType:this.exchangeAsset.beExchangeAsset,amount:this.beExchangeNumber}}get exchangeRate(){return this.exchangeAsset.exchangeRate}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeNumber:this.toExchangeNumber,beExchangeNumber:this.beExchangeNumber,exchangeAsset:this.exchangeAsset.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=lt.fromObject(e.ciphertextSignature))),t}};Kn.INC=1;h([A.d(yo.INC++,"bytes"),u("design:type",Uint8Array)],Kn.prototype,"transactionSignatureBuffer",void 0);h([A.d(yo.INC++,"bytes","optional"),u("design:type",Uint8Array)],Kn.prototype,"ciphertextSignatureBuffer",void 0);h([A.d(yo.INC++,"string"),u("design:type",String)],Kn.prototype,"toExchangeNumber",void 0);h([A.d(yo.INC++,"string"),u("design:type",String)],Kn.prototype,"beExchangeNumber",void 0);h([A.d(yo.INC++,hr),u("design:type",hr)],Kn.prototype,"exchangeAsset",void 0);h([ne,u("design:type",Object),u("design:paramtypes",[])],Kn.prototype,"to",null);Kn=yo=h([v.d("BeExchangeAssetModel")],Kn);let Xc=class extends Y{toJSON(){return{beExchangeAsset:this.beExchangeAsset.toJSON()}}};h([A.d(1,Kn),u("design:type",Kn)],Xc.prototype,"beExchangeAsset",void 0);Xc=h([v.d("BeExchangeAssetAssetModel")],Xc);let Zc=class extends Y{toJSON(){return{migrateCertificate:this.migrateCertificate}}};h([A.d(1,"string"),u("design:type",String)],Zc.prototype,"migrateCertificate",void 0);Zc=h([v.d("EmigrateAssetModel")],Zc);let ep=class extends Y{toJSON(){return{emigrateAsset:this.emigrateAsset.toJSON()}}};h([A.d(1,Zc),u("design:type",Zc)],ep.prototype,"emigrateAsset",void 0);ep=h([v.d("EmigrateAssetAssetModel")],ep);let tp=class extends Y{toJSON(){return{migrateCertificate:this.migrateCertificate}}};h([A.d(1,"string"),u("design:type",String)],tp.prototype,"migrateCertificate",void 0);tp=h([v.d("ImmigrateAssetModel")],tp);let rp=class extends Y{toJSON(){return{immigrateAsset:this.immigrateAsset.toJSON()}}};h([A.d(1,tp),u("design:type",tp)],rp.prototype,"immigrateAsset",void 0);rp=h([v.d("ImmigrateAssetAssetModel")],rp);let Ai=class extends Y{toJSON(){return{name:this.name,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,operationType:this.operationType}}};h([A.d(1,"string"),u("design:type",String)],Ai.prototype,"name",void 0);h([A.d(2,"string"),u("design:type",String)],Ai.prototype,"sourceChainName",void 0);h([A.d(3,"string"),u("design:type",String)],Ai.prototype,"sourceChainMagic",void 0);h([A.d(4,"uint32"),u("design:type",Number)],Ai.prototype,"operationType",void 0);Ai=h([v.d("LocationNameInfo")],Ai);let np=class extends Y{toJSON(){return{locationName:this.locationName.toJSON()}}};h([A.d(1,Ai),u("design:type",Ai)],np.prototype,"locationName",void 0);np=h([v.d("LocationNameAssetModel")],np);let Yi=class extends Y{toJSON(){return{name:this.name,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic}}};h([A.d(1,"string"),u("design:type",String)],Yi.prototype,"name",void 0);h([A.d(2,"string"),u("design:type",String)],Yi.prototype,"sourceChainName",void 0);h([A.d(3,"string"),u("design:type",String)],Yi.prototype,"sourceChainMagic",void 0);Yi=h([v.d("SetLnsManagerModel")],Yi);let sp=class extends Y{toJSON(){return{lnsManager:this.lnsManager.toJSON()}}};h([A.d(1,Yi),u("design:type",Yi)],sp.prototype,"lnsManager",void 0);sp=h([v.d("SetLnsManagerAssetModel")],sp);let Ei=class extends Y{toJSON(){return{recordType:this.recordType,recordValue:this.recordValue}}};h([A.d(1,"int32"),u("design:type",Number)],Ei.prototype,"recordType",void 0);h([A.d(2,"string"),u("design:type",String)],Ei.prototype,"recordValue",void 0);Ei=h([v.d("LocationNameRecordInfo")],Ei);var vi;let Gn=vi=class extends Y{toJSON(){const e={name:this.name,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,operationType:this.operationType};return this.addRecord&&(e.addRecord=this.addRecord.toJSON()),this.deleteRecord&&(e.deleteRecord=this.deleteRecord.toJSON()),e}};Gn.INC=1;h([A.d(vi.INC++,"string"),u("design:type",String)],Gn.prototype,"name",void 0);h([A.d(vi.INC++,"string"),u("design:type",String)],Gn.prototype,"sourceChainName",void 0);h([A.d(vi.INC++,"string"),u("design:type",String)],Gn.prototype,"sourceChainMagic",void 0);h([A.d(vi.INC++,"uint32"),u("design:type",Number)],Gn.prototype,"operationType",void 0);h([A.d(vi.INC++,Ei,"optional"),u("design:type",Ei)],Gn.prototype,"addRecord",void 0);h([A.d(vi.INC++,Ei,"optional"),u("design:type",Ei)],Gn.prototype,"deleteRecord",void 0);Gn=vi=h([v.d("SetLnsRecordValueModel")],Gn);let ip=class extends Y{toJSON(){return{lnsRecordValue:this.lnsRecordValue.toJSON()}}};h([A.d(1,Gn),u("design:type",Gn)],ip.prototype,"lnsRecordValue",void 0);ip=h([v.d("SetLnsRecordValueAssetModel")],ip);var Pn;const m_=new WeakMap;let ur=Pn=class extends Y{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=m_.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Me(r))),t}set cipherPublicKeys(e){const t=e.map(r=>he(r));m_.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return{magic:this.toExchangeSource,chainName:this.toExchangeChainName,toExchangeAsset:this.toExchangeAsset,amount:this.exchangeDirection===1?this.exchangeNumber:void 0}}get be(){return{magic:this.beExchangeSource,chainName:this.beExchangeChainName,assetType:this.beExchangeAsset,amount:this.exchangeDirection===0?this.exchangeNumber:void 0}}toJSON(){return{cipherPublicKeys:this.cipherPublicKeys,toExchangeSource:this.toExchangeSource,beExchangeSource:this.beExchangeSource,toExchangeChainName:this.toExchangeChainName,beExchangeChainName:this.beExchangeChainName,toExchangeAsset:this.toExchangeAsset,beExchangeAsset:this.beExchangeAsset,exchangeNumber:this.exchangeNumber,exchangeAssetType:this.exchangeAssetType,exchangeDirection:this.exchangeDirection}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};ur.INC=1;h([A.d(Pn.INC++,"bytes","repeated"),u("design:type",Array)],ur.prototype,"cipherPublicKeysBuffer",void 0);h([A.d(Pn.INC++,"string"),u("design:type",String)],ur.prototype,"toExchangeSource",void 0);h([A.d(Pn.INC++,"string"),u("design:type",String)],ur.prototype,"beExchangeSource",void 0);h([A.d(Pn.INC++,"string"),u("design:type",String)],ur.prototype,"toExchangeChainName",void 0);h([A.d(Pn.INC++,"string"),u("design:type",String)],ur.prototype,"beExchangeChainName",void 0);h([A.d(Pn.INC++,"string"),u("design:type",String)],ur.prototype,"toExchangeAsset",void 0);h([A.d(Pn.INC++,"string"),u("design:type",String)],ur.prototype,"beExchangeAsset",void 0);h([A.d(Pn.INC++,"string"),u("design:type",String)],ur.prototype,"exchangeNumber",void 0);h([A.d(Pn.INC++,"uint32"),u("design:type",Number)],ur.prototype,"exchangeAssetType",void 0);h([A.d(Pn.INC++,"uint32"),u("design:type",Number)],ur.prototype,"exchangeDirection",void 0);h([ne,u("design:type",Object),u("design:paramtypes",[])],ur.prototype,"to",null);ur=Pn=h([v.d("ToExchangeSpecialAssetModel")],ur);let op=class extends Y{toJSON(){return{toExchangeSpecialAsset:this.toExchangeSpecialAsset.toJSON()}}};h([A.d(1,ur),u("design:type",ur)],op.prototype,"toExchangeSpecialAsset",void 0);op=h([v.d("ToExchangeSpecialAssetAssetModel")],op);var Wl;const mf=new WeakMap;let Ii=Wl=class extends Y{get transactionSignature(){return Me(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=he(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=lt.decode(e);return mf.set(t,e),t}set ciphertextSignature(e){if(e){let t=mf.get(e);t||(t=lt.encode(e).finish(),mf.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={transactionSignature:this.transactionSignature,exchangeSpecialAsset:this.exchangeSpecialAsset.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=lt.fromObject(e.ciphertextSignature))),t}};Ii.INC=1;h([A.d(Wl.INC++,"bytes"),u("design:type",Uint8Array)],Ii.prototype,"transactionSignatureBuffer",void 0);h([A.d(Wl.INC++,"bytes","optional"),u("design:type",Uint8Array)],Ii.prototype,"ciphertextSignatureBuffer",void 0);h([A.d(Wl.INC++,ur),u("design:type",ur)],Ii.prototype,"exchangeSpecialAsset",void 0);Ii=Wl=h([v.d("BeExchangeSpecialAssetModel")],Ii);let ap=class extends Y{toJSON(){return{beExchangeSpecialAsset:this.beExchangeSpecialAsset.toJSON()}}};h([A.d(1,Ii),u("design:type",Ii)],ap.prototype,"beExchangeSpecialAsset",void 0);ap=h([v.d("BeExchangeSpecialAssetAssetModel")],ap);let Kh=class extends Y{toJSON(){return{senderPaidFeeRate:this.senderPaidFeeRate.toJSON(),recipientPaidFeeRate:this.recipientPaidFeeRate.toJSON()}}};h([A.d(1,Mr),u("design:type",Mr)],Kh.prototype,"senderPaidFeeRate",void 0);h([A.d(2,Mr),u("design:type",Mr)],Kh.prototype,"recipientPaidFeeRate",void 0);Kh=h([v.d("FeeRateModel")],Kh);var Li;let Xt=Li=class extends Y{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,factoryId:this.factoryId,entityPrealnum:this.entityPrealnum,entityFrozenAssetPrealnum:this.entityFrozenAssetPrealnum,purchaseAssetPrealnum:this.purchaseAssetPrealnum}}};Xt.INC=1;h([A.d(Li.INC++,"string"),u("design:type",String)],Xt.prototype,"sourceChainName",void 0);h([A.d(Li.INC++,"string"),u("design:type",String)],Xt.prototype,"sourceChainMagic",void 0);h([A.d(Li.INC++,"string"),u("design:type",String)],Xt.prototype,"factoryId",void 0);h([A.d(Li.INC++,"string"),u("design:type",String)],Xt.prototype,"entityPrealnum",void 0);h([A.d(Li.INC++,"string"),u("design:type",String)],Xt.prototype,"entityFrozenAssetPrealnum",void 0);h([A.d(Li.INC++,"string"),u("design:type",String)],Xt.prototype,"purchaseAssetPrealnum",void 0);Xt=Li=h([v.d("IssueEntityFactoryModel")],Xt);let Qi=class extends Y{toJSON(){return{issueEntityFactory:this.issueEntityFactory.toJSON()}}};h([A.d(1,Xt),u("design:type",Xt)],Qi.prototype,"issueEntityFactory",void 0);Qi=h([v.d("IssueEntityFactoryAssetModel")],Qi);var mo;let fs=mo=class extends Y{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,entityId:this.entityId,entityFactoryPossessor:this.entityFactoryPossessor,entityFactory:this.entityFactory.toJSON()}}};fs.INC=1;h([A.d(mo.INC++,"string"),u("design:type",String)],fs.prototype,"sourceChainName",void 0);h([A.d(mo.INC++,"string"),u("design:type",String)],fs.prototype,"sourceChainMagic",void 0);h([A.d(mo.INC++,"string"),u("design:type",String)],fs.prototype,"entityId",void 0);h([A.d(mo.INC++,"string"),u("design:type",String)],fs.prototype,"entityFactoryPossessor",void 0);h([A.d(mo.INC++,Xt),u("design:type",Xt)],fs.prototype,"entityFactory",void 0);fs=mo=h([v.d("IssueEntityModel")],fs);let cp=class extends Y{toJSON(){return{issueEntity:this.issueEntity.toJSON()}}};h([A.d(1,fs),u("design:type",fs)],cp.prototype,"issueEntity",void 0);cp=h([v.d("IssueEntityAssetModel")],cp);var _o;let zn=_o=class extends Y{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,entityId:this.entityId,taxAssetPrealnum:this.taxAssetPrealnum,entityFactoryPossessor:this.entityFactoryPossessor,entityFactory:this.entityFactory.toJSON()}}};zn.INC=1;h([A.d(_o.INC++,"string"),u("design:type",String)],zn.prototype,"sourceChainName",void 0);h([A.d(_o.INC++,"string"),u("design:type",String)],zn.prototype,"sourceChainMagic",void 0);h([A.d(_o.INC++,"string"),u("design:type",String)],zn.prototype,"entityId",void 0);h([A.d(Xt.INC++,"string"),u("design:type",String)],zn.prototype,"taxAssetPrealnum",void 0);h([A.d(_o.INC++,"string"),u("design:type",String)],zn.prototype,"entityFactoryPossessor",void 0);h([A.d(_o.INC++,Xt),u("design:type",Xt)],zn.prototype,"entityFactory",void 0);zn=_o=h([v.d("IssueEntityV1Model")],zn);let pp=class extends Y{toJSON(){return{issueEntity:this.issueEntity.toJSON()}}};h([A.d(1,zn),u("design:type",zn)],pp.prototype,"issueEntity",void 0);pp=h([v.d("IssueEntityAssetV1Model")],pp);var Qs;let Nn=Qs=class extends Y{get transactionSignature(){return Me(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=he(e)}toJSON(){return{transactionSignature:this.transactionSignature,sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,entityId:this.entityId,entityFactoryApplicant:this.entityFactoryApplicant,entityFactoryPossessor:this.entityFactoryPossessor,entityFactory:this.entityFactory.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.transactionSignature&&(t.transactionSignature=e.transactionSignature),t}};Nn.INC=1;h([A.d(Qs.INC++,"bytes"),u("design:type",Uint8Array)],Nn.prototype,"transactionSignatureBuffer",void 0);h([A.d(Qs.INC++,"string"),u("design:type",String)],Nn.prototype,"sourceChainName",void 0);h([A.d(Qs.INC++,"string"),u("design:type",String)],Nn.prototype,"sourceChainMagic",void 0);h([A.d(Qs.INC++,"string"),u("design:type",String)],Nn.prototype,"entityId",void 0);h([A.d(Qs.INC++,"string"),u("design:type",String)],Nn.prototype,"entityFactoryApplicant",void 0);h([A.d(Qs.INC++,"string"),u("design:type",String)],Nn.prototype,"entityFactoryPossessor",void 0);h([A.d(Qs.INC++,Xt),u("design:type",Xt)],Nn.prototype,"entityFactory",void 0);Nn=Qs=h([v.d("DestroyEntityModel")],Nn);let lp=class extends Y{toJSON(){return{destroyEntity:this.destroyEntity.toJSON()}}};h([A.d(1,Nn),u("design:type",Nn)],lp.prototype,"destroyEntity",void 0);lp=h([v.d("DestroyEntityAssetModel")],lp);let gs=class extends Y{toJSON(){const e={sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,parentAssetType:this.parentAssetType,assetType:this.assetType,amount:this.amount};return this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};h([A.d(1,"string"),u("design:type",String)],gs.prototype,"sourceChainName",void 0);h([A.d(2,"string"),u("design:type",String)],gs.prototype,"sourceChainMagic",void 0);h([A.d(3,L),u("design:type",Number)],gs.prototype,"parentAssetType",void 0);h([A.d(4,"string"),u("design:type",String)],gs.prototype,"assetType",void 0);h([A.d(5,"string"),u("design:type",String)],gs.prototype,"amount",void 0);h([A.d(6,qt,"optional"),u("design:type",qt)],gs.prototype,"taxInformation",void 0);gs=h([v.d("TransferAnyModel")],gs);let hp=class extends Y{toJSON(){return{transferAny:this.transferAny.toJSON()}}};h([A.d(1,gs),u("design:type",gs)],hp.prototype,"transferAny",void 0);hp=h([v.d("TransferAnyAssetModel")],hp);var Bn;const __=new WeakMap;let Ir=Bn=class extends Y{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=__.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Me(r))),t}set cipherPublicKeys(e){const t=e.map(r=>he(r));__.set(t,e),this.cipherPublicKeysBuffer=t}toJSON(){const e={cipherPublicKeys:this.cipherPublicKeys,sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,parentAssetType:this.parentAssetType,assetType:this.assetType,amount:this.amount,totalGrabableTimes:this.totalGrabableTimes};return this.giftDistributionRule!==void 0&&(e.giftDistributionRule=this.giftDistributionRule),this.beginUnfrozenBlockHeight&&(e.beginUnfrozenBlockHeight=this.beginUnfrozenBlockHeight),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Ir.INC=1;h([A.d(Bn.INC++,"bytes","repeated"),u("design:type",Array)],Ir.prototype,"cipherPublicKeysBuffer",void 0);h([A.d(Bn.INC++,"string"),u("design:type",String)],Ir.prototype,"sourceChainMagic",void 0);h([A.d(Bn.INC++,"string"),u("design:type",String)],Ir.prototype,"sourceChainName",void 0);h([A.d(Bn.INC++,L),u("design:type",Number)],Ir.prototype,"parentAssetType",void 0);h([A.d(Bn.INC++,"string"),u("design:type",String)],Ir.prototype,"assetType",void 0);h([A.d(Bn.INC++,"string"),u("design:type",String)],Ir.prototype,"amount",void 0);h([A.d(Bn.INC++,"uint32"),u("design:type",Number)],Ir.prototype,"totalGrabableTimes",void 0);h([A.d(Bn.INC++,"uint32","optional"),u("design:type",Number)],Ir.prototype,"beginUnfrozenBlockHeight",void 0);h([A.d(Bn.INC++,"uint32","optional"),u("design:type",Number)],Ir.prototype,"giftDistributionRule",void 0);h([A.d(Bn.INC++,qt,"optional"),u("design:type",qt)],Ir.prototype,"taxInformation",void 0);Ir=Bn=h([v.d("GiftAnyModel")],Ir);let up=class extends Y{toJSON(){return{giftAny:this.giftAny.toJSON()}}};h([A.d(1,Ir),u("design:type",Ir)],up.prototype,"giftAny",void 0);up=h([v.d("GiftAnyAssetModel")],up);var Ao;const _f=new WeakMap;let ds=Ao=class extends Y{get blockSignature(){return Me(this.blockSignatureBuffer)}set blockSignature(e){this.blockSignatureBuffer=he(e)}get transactionSignature(){return Me(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=he(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=lt.decode(e);return _f.set(t,e),t}set ciphertextSignature(e){if(e){let t=_f.get(e);t||(t=lt.encode(e).finish(),_f.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={blockSignature:this.blockSignature,transactionSignature:this.transactionSignature,amount:this.amount,giftAny:this.giftAny.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.blockSignature&&(t.blockSignature=e.blockSignature),e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=lt.fromObject(e.ciphertextSignature))),t}};ds.INC=1;h([A.d(Ao.INC++,"bytes"),u("design:type",Uint8Array)],ds.prototype,"blockSignatureBuffer",void 0);h([A.d(Ao.INC++,"bytes"),u("design:type",Uint8Array)],ds.prototype,"transactionSignatureBuffer",void 0);h([A.d(Ao.INC++,"string"),u("design:type",String)],ds.prototype,"amount",void 0);h([A.d(Ao.INC++,"bytes","optional"),u("design:type",Uint8Array)],ds.prototype,"ciphertextSignatureBuffer",void 0);h([A.d(Ao.INC++,Ir),u("design:type",Ir)],ds.prototype,"giftAny",void 0);ds=Ao=h([v.d("GrabAnyModel")],ds);let fp=class extends Y{toJSON(){return{grabAny:this.grabAny.toJSON()}}};h([A.d(1,ds),u("design:type",ds)],fp.prototype,"grabAny",void 0);fp=h([v.d("GrabAnyAssetModel")],fp);var Ur;const A_=new WeakMap;let Ti=class extends Y{toJSON(){return{toExchangeAssetWeight:this.toExchangeAssetWeight,beExchangeAssetWeight:this.beExchangeAssetWeight}}};h([A.d(1,"string"),u("design:type",String)],Ti.prototype,"toExchangeAssetWeight",void 0);h([A.d(2,"string"),u("design:type",String)],Ti.prototype,"beExchangeAssetWeight",void 0);Ti=h([v.d("AssetExchangeWeightRatioModel")],Ti);let Ft=Ur=class extends Y{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=A_.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Me(r))),t}set cipherPublicKeys(e){const t=e.map(r=>he(r));A_.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return{magic:this.toExchangeSource,chainName:this.toExchangeChainName,toExchangeAssetType:this.toExchangeAssetType,toExchangeParentAssetType:this.toExchangeParentAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum}}get be(){return{magic:this.beExchangeSource,chainName:this.beExchangeChainName,beExchangeAssetType:this.beExchangeAssetType,beExchangeParentAssetType:this.beExchangeParentAssetType,beExchangeAssetPrealnum:this.beExchangeAssetPrealnum||"1"}}toJSON(){const e={cipherPublicKeys:this.cipherPublicKeys,toExchangeSource:this.toExchangeSource,beExchangeSource:this.beExchangeSource,toExchangeChainName:this.toExchangeChainName,beExchangeChainName:this.beExchangeChainName,toExchangeAssetType:this.toExchangeAssetType,beExchangeAssetType:this.beExchangeAssetType,toExchangeParentAssetType:this.toExchangeParentAssetType,beExchangeParentAssetType:this.beExchangeParentAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum};return this.beExchangeAssetPrealnum&&(e.beExchangeAssetPrealnum=this.beExchangeAssetPrealnum),this.assetExchangeWeightRatio&&(e.assetExchangeWeightRatio=this.assetExchangeWeightRatio.toJSON()),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Ft.INC=1;h([A.d(Ur.INC++,"bytes","repeated"),u("design:type",Array)],Ft.prototype,"cipherPublicKeysBuffer",void 0);h([A.d(Ur.INC++,"string"),u("design:type",String)],Ft.prototype,"toExchangeSource",void 0);h([A.d(Ur.INC++,"string"),u("design:type",String)],Ft.prototype,"beExchangeSource",void 0);h([A.d(Ur.INC++,"string"),u("design:type",String)],Ft.prototype,"toExchangeChainName",void 0);h([A.d(Ur.INC++,"string"),u("design:type",String)],Ft.prototype,"beExchangeChainName",void 0);h([A.d(Ur.INC++,L),u("design:type",Number)],Ft.prototype,"toExchangeParentAssetType",void 0);h([A.d(Ur.INC++,L),u("design:type",Number)],Ft.prototype,"beExchangeParentAssetType",void 0);h([A.d(Ur.INC++,"string"),u("design:type",String)],Ft.prototype,"toExchangeAssetType",void 0);h([A.d(Ur.INC++,"string"),u("design:type",String)],Ft.prototype,"beExchangeAssetType",void 0);h([A.d(Ur.INC++,"string"),u("design:type",String)],Ft.prototype,"toExchangeAssetPrealnum",void 0);h([A.d(Ur.INC++,"string","optional"),u("design:type",String)],Ft.prototype,"beExchangeAssetPrealnum",void 0);h([A.d(Ur.INC++,Ti,"optional"),u("design:type",Ti)],Ft.prototype,"assetExchangeWeightRatio",void 0);h([A.d(Ur.INC++,qt,"optional"),u("design:type",qt)],Ft.prototype,"taxInformation",void 0);h([ne,u("design:type",Object),u("design:paramtypes",[])],Ft.prototype,"to",null);Ft=Ur=h([v.d("ToExchangeAnyModel")],Ft);let gp=class extends Y{toJSON(){return{toExchangeAny:this.toExchangeAny.toJSON()}}};h([A.d(1,Ft),u("design:type",Ft)],gp.prototype,"toExchangeAny",void 0);gp=h([v.d("ToExchangeAnyAssetModel")],gp);var Eo;const Af=new WeakMap;let jn=Eo=class extends Y{get transactionSignature(){return Me(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=he(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=lt.decode(e);return Af.set(t,e),t}set ciphertextSignature(e){if(e){let t=Af.get(e);t||(t=lt.encode(e).finish(),Af.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum,beExchangeAssetPrealnum:this.beExchangeAssetPrealnum,exchangeAny:this.exchangeAny.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=lt.fromObject(e.ciphertextSignature))),t}};jn.INC=1;h([A.d(Eo.INC++,"bytes"),u("design:type",Uint8Array)],jn.prototype,"transactionSignatureBuffer",void 0);h([A.d(Eo.INC++,"bytes","optional"),u("design:type",Uint8Array)],jn.prototype,"ciphertextSignatureBuffer",void 0);h([A.d(Eo.INC++,"string"),u("design:type",String)],jn.prototype,"toExchangeAssetPrealnum",void 0);h([A.d(Eo.INC++,"string"),u("design:type",String)],jn.prototype,"beExchangeAssetPrealnum",void 0);h([A.d(Eo.INC++,Ft),u("design:type",Ft)],jn.prototype,"exchangeAny",void 0);h([A.d(Ft.INC++,qt,"optional"),u("design:type",qt)],jn.prototype,"taxInformation",void 0);jn=Eo=h([v.d("BeExchangeAnyModel")],jn);let dp=class extends Y{toJSON(){return{beExchangeAny:this.beExchangeAny.toJSON()}}};h([A.d(1,jn),u("design:type",jn)],dp.prototype,"beExchangeAny",void 0);dp=h([v.d("BeExchangeAnyAssetModel")],dp);var Io;let yp=class extends Y{toJSON(){return{entityId:this.entityId,taxAssetPrealnum:this.taxAssetPrealnum}}};h([A.d(1,"string"),u("design:type",String)],yp.prototype,"entityId",void 0);h([A.d(2,"string"),u("design:type",String)],yp.prototype,"taxAssetPrealnum",void 0);yp=h([v.d("EntityStructModel")],yp);let ys=Io=class extends Y{toJSON(){return{sourceChainName:this.sourceChainName,sourceChainMagic:this.sourceChainMagic,entityStructList:this.entityStructList.map(t=>t.toJSON()),entityFactoryPossessor:this.entityFactoryPossessor,entityFactory:this.entityFactory.toJSON()}}};ys.INC=1;h([A.d(Io.INC++,"string"),u("design:type",String)],ys.prototype,"sourceChainName",void 0);h([A.d(Io.INC++,"string"),u("design:type",String)],ys.prototype,"sourceChainMagic",void 0);h([A.d(Io.INC++,yp,"repeated"),u("design:type",Array)],ys.prototype,"entityStructList",void 0);h([A.d(Io.INC++,"string"),u("design:type",String)],ys.prototype,"entityFactoryPossessor",void 0);h([A.d(Io.INC++,Xt),u("design:type",Xt)],ys.prototype,"entityFactory",void 0);ys=Io=h([v.d("IssueEntityMultiV1Model")],ys);let mp=class extends Y{toJSON(){return{issueEntityMulti:this.issueEntityMulti.toJSON()}}};h([A.d(1,ys),u("design:type",ys)],mp.prototype,"issueEntityMulti",void 0);mp=h([v.d("IssueEntityMultiAssetV1Model")],mp);var Ws,To,ql;const E_=new WeakMap;let pn=Ws=class extends Y{toJSON(){const e={toExchangeSource:this.toExchangeSource,toExchangeChainName:this.toExchangeChainName,toExchangeParentAssetType:this.toExchangeParentAssetType,toExchangeAssetType:this.toExchangeAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum};return this.assetExchangeWeightRatio&&(e.assetExchangeWeightRatio=this.assetExchangeWeightRatio.toJSON()),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};pn.INC=1;h([A.d(Ws.INC++,"string"),u("design:type",String)],pn.prototype,"toExchangeSource",void 0);h([A.d(Ws.INC++,"string"),u("design:type",String)],pn.prototype,"toExchangeChainName",void 0);h([A.d(Ws.INC++,L),u("design:type",Number)],pn.prototype,"toExchangeParentAssetType",void 0);h([A.d(Ws.INC++,"string"),u("design:type",String)],pn.prototype,"toExchangeAssetType",void 0);h([A.d(Ws.INC++,"string"),u("design:type",String)],pn.prototype,"toExchangeAssetPrealnum",void 0);h([A.d(Ws.INC++,Ti,"optional"),u("design:type",Ti)],pn.prototype,"assetExchangeWeightRatio",void 0);h([A.d(Ws.INC++,qt,"optional"),u("design:type",qt)],pn.prototype,"taxInformation",void 0);pn=Ws=h([v.d("ToExchangeAssetV1Model")],pn);let ln=To=class extends Y{toJSON(){const e={beExchangeSource:this.beExchangeSource,beExchangeChainName:this.beExchangeChainName,beExchangeParentAssetType:this.beExchangeParentAssetType,beExchangeAssetType:this.beExchangeAssetType};return this.beExchangeAssetPrealnum&&(e.beExchangeAssetPrealnum=this.beExchangeAssetPrealnum),this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};ln.INC=1;h([A.d(To.INC++,"string"),u("design:type",String)],ln.prototype,"beExchangeSource",void 0);h([A.d(To.INC++,"string"),u("design:type",String)],ln.prototype,"beExchangeChainName",void 0);h([A.d(To.INC++,L),u("design:type",Number)],ln.prototype,"beExchangeParentAssetType",void 0);h([A.d(To.INC++,"string"),u("design:type",String)],ln.prototype,"beExchangeAssetType",void 0);h([A.d(To.INC++,"string","optional"),u("design:type",String)],ln.prototype,"beExchangeAssetPrealnum",void 0);h([A.d(pn.INC++,qt,"optional"),u("design:type",qt)],ln.prototype,"taxInformation",void 0);ln=To=h([v.d("BeExchangeAssetV1Model")],ln);let vs=ql=class extends Y{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=E_.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Me(r))),t}set cipherPublicKeys(e){const t=e.map(r=>he(r));E_.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return this.toExchangeAssets.map(e=>e.toJSON())}get be(){return this.beExchangeAsset.toJSON()}toJSON(){return{cipherPublicKeys:this.cipherPublicKeys,toExchangeAssets:this.toExchangeAssets.map(t=>t.toJSON()),beExchangeAsset:this.beExchangeAsset.toJSON()}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};vs.INC=1;h([A.d(ql.INC++,"bytes","repeated"),u("design:type",Array)],vs.prototype,"cipherPublicKeysBuffer",void 0);h([A.d(ql.INC++,pn,"repeated"),u("design:type",Array)],vs.prototype,"toExchangeAssets",void 0);h([A.d(ql.INC++,ln),u("design:type",ln)],vs.prototype,"beExchangeAsset",void 0);h([ne,u("design:type",Object),u("design:paramtypes",[])],vs.prototype,"to",null);vs=ql=h([v.d("ToExchangeAnyMultiModel")],vs);let _p=class extends Y{toJSON(){return{toExchangeAnyMulti:this.toExchangeAnyMulti.toJSON()}}};h([A.d(1,vs),u("design:type",vs)],_p.prototype,"toExchangeAnyMulti",void 0);_p=h([v.d("ToExchangeAnyMultiAssetModel")],_p);var ec;const Ef=new WeakMap;let Ls=ec=class extends Y{get transactionSignature(){return Me(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=he(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=lt.decode(e);return Ef.set(t,e),t}set ciphertextSignature(e){if(e){let t=Ef.get(e);t||(t=lt.encode(e).finish(),Ef.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeAssets:this.toExchangeAssets.map(t=>t.toJSON()),beExchangeAsset:this.beExchangeAsset.toJSON()};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=lt.fromObject(e.ciphertextSignature))),t}};Ls.INC=1;h([A.d(ec.INC++,"bytes"),u("design:type",Uint8Array)],Ls.prototype,"transactionSignatureBuffer",void 0);h([A.d(ec.INC++,"bytes","optional"),u("design:type",Uint8Array)],Ls.prototype,"ciphertextSignatureBuffer",void 0);h([A.d(ec.INC++,pn,"repeated"),u("design:type",Array)],Ls.prototype,"toExchangeAssets",void 0);h([A.d(ec.INC++,ln),u("design:type",ln)],Ls.prototype,"beExchangeAsset",void 0);Ls=ec=h([v.d("BeExchangeAnyMultiModel")],Ls);let Ap=class extends Y{toJSON(){return{beExchangeAnyMulti:this.beExchangeAnyMulti.toJSON()}}};h([A.d(1,Ls),u("design:type",Ls)],Ap.prototype,"beExchangeAnyMulti",void 0);Ap=h([v.d("BeExchangeAnyMultiAssetModel")],Ap);var Di,So,Xl;const I_=new WeakMap;let xn=Di=class extends Y{toJSON(){const e={toExchangeSource:this.toExchangeSource,toExchangeChainName:this.toExchangeChainName,toExchangeParentAssetType:this.toExchangeParentAssetType,toExchangeAssetType:this.toExchangeAssetType,toExchangeAssetPrealnum:this.toExchangeAssetPrealnum};return this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};xn.INC=1;h([A.d(Di.INC++,"string"),u("design:type",String)],xn.prototype,"toExchangeSource",void 0);h([A.d(Di.INC++,"string"),u("design:type",String)],xn.prototype,"toExchangeChainName",void 0);h([A.d(Di.INC++,L),u("design:type",Number)],xn.prototype,"toExchangeParentAssetType",void 0);h([A.d(Di.INC++,"string"),u("design:type",String)],xn.prototype,"toExchangeAssetType",void 0);h([A.d(Di.INC++,"string"),u("design:type",String)],xn.prototype,"toExchangeAssetPrealnum",void 0);h([A.d(Di.INC++,qt,"optional"),u("design:type",qt)],xn.prototype,"taxInformation",void 0);xn=Di=h([v.d("ToExchangeAssetV2Model")],xn);let Jn=So=class extends Y{toJSON(){const e={beExchangeSource:this.beExchangeSource,beExchangeChainName:this.beExchangeChainName,beExchangeParentAssetType:this.beExchangeParentAssetType,beExchangeAssetType:this.beExchangeAssetType,beExchangeAssetPrealnum:this.beExchangeAssetPrealnum};return this.taxInformation&&(e.taxInformation=this.taxInformation.toJSON()),e}};Jn.INC=1;h([A.d(So.INC++,"string"),u("design:type",String)],Jn.prototype,"beExchangeSource",void 0);h([A.d(So.INC++,"string"),u("design:type",String)],Jn.prototype,"beExchangeChainName",void 0);h([A.d(So.INC++,L),u("design:type",Number)],Jn.prototype,"beExchangeParentAssetType",void 0);h([A.d(So.INC++,"string"),u("design:type",String)],Jn.prototype,"beExchangeAssetType",void 0);h([A.d(So.INC++,"string"),u("design:type",String)],Jn.prototype,"beExchangeAssetPrealnum",void 0);h([A.d(xn.INC++,qt,"optional"),u("design:type",qt)],Jn.prototype,"taxInformation",void 0);Jn=So=h([v.d("BeExchangeAssetV2Model")],Jn);let Ds=Xl=class extends Y{get cipherPublicKeys(){const{cipherPublicKeysBuffer:e}=this;let t=I_.get(e);return t||(t=this.cipherPublicKeysBuffer.map(r=>Me(r))),t}set cipherPublicKeys(e){const t=e.map(r=>he(r));I_.set(t,e),this.cipherPublicKeysBuffer=t}get to(){return this.toExchangeAssets.map(e=>e.toJSON())}get be(){return this.beExchangeAssets.map(e=>e.toJSON())}toJSON(){return{cipherPublicKeys:this.cipherPublicKeys,toExchangeAssets:this.toExchangeAssets.map(t=>t.toJSON()),beExchangeAssets:this.beExchangeAssets.map(t=>t.toJSON())}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.cipherPublicKeys&&(t.cipherPublicKeys=e.cipherPublicKeys),t}};Ds.INC=1;h([A.d(Xl.INC++,"bytes","repeated"),u("design:type",Array)],Ds.prototype,"cipherPublicKeysBuffer",void 0);h([A.d(Xl.INC++,xn,"repeated"),u("design:type",Array)],Ds.prototype,"toExchangeAssets",void 0);h([A.d(Xl.INC++,Jn,"repeated"),u("design:type",Array)],Ds.prototype,"beExchangeAssets",void 0);h([ne,u("design:type",Object),u("design:paramtypes",[])],Ds.prototype,"to",null);Ds=Xl=h([v.d("ToExchangeAnyMultiAllModel")],Ds);let Ep=class extends Y{toJSON(){return{toExchangeAnyMultiAll:this.toExchangeAnyMultiAll.toJSON()}}};h([A.d(1,Ds),u("design:type",Ds)],Ep.prototype,"toExchangeAnyMultiAll",void 0);Ep=h([v.d("ToExchangeAnyMultiAllAssetModel")],Ep);var tc;const If=new WeakMap;let ks=tc=class extends Y{get transactionSignature(){return Me(this.transactionSignatureBuffer)}set transactionSignature(e){this.transactionSignatureBuffer=he(e)}get ciphertextSignature(){const{ciphertextSignatureBuffer:e}=this;if(!e)return;const t=lt.decode(e);return If.set(t,e),t}set ciphertextSignature(e){if(e){let t=If.get(e);t||(t=lt.encode(e).finish(),If.set(e,t)),this.ciphertextSignatureBuffer=t}else this.ciphertextSignatureBuffer=void 0}toJSON(){const e={transactionSignature:this.transactionSignature,toExchangeAssets:this.toExchangeAssets.map(t=>t.toJSON()),beExchangeAssets:this.beExchangeAssets.map(t=>t.toJSON())};return this.ciphertextSignature&&(e.ciphertextSignature=this.ciphertextSignature.toJSON()),e}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.transactionSignature&&(t.transactionSignature=e.transactionSignature),e.ciphertextSignature&&(t.ciphertextSignature=lt.fromObject(e.ciphertextSignature))),t}};ks.INC=1;h([A.d(tc.INC++,"bytes"),u("design:type",Uint8Array)],ks.prototype,"transactionSignatureBuffer",void 0);h([A.d(tc.INC++,"bytes","optional"),u("design:type",Uint8Array)],ks.prototype,"ciphertextSignatureBuffer",void 0);h([A.d(tc.INC++,xn,"repeated"),u("design:type",Array)],ks.prototype,"toExchangeAssets",void 0);h([A.d(tc.INC++,Jn,"repeated"),u("design:type",Array)],ks.prototype,"beExchangeAssets",void 0);ks=tc=h([v.d("BeExchangeAnyMultiAllModel")],ks);let Ip=class extends Y{toJSON(){return{beExchangeAnyMultiAll:this.beExchangeAnyMultiAll.toJSON()}}};h([A.d(1,ks),u("design:type",ks)],Ip.prototype,"beExchangeAnyMultiAll",void 0);Ip=h([v.d("BeExchangeAnyMultiAllAssetModel")],Ip);var rc;let Hs=rc=class extends Y{toJSON(){return{sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,certificateId:this.certificateId,type:this.type}}};Hs.INC=1;h([A.d(rc.INC++,"string"),u("design:type",String)],Hs.prototype,"sourceChainName",void 0);h([A.d(rc.INC++,"string"),u("design:type",String)],Hs.prototype,"sourceChainMagic",void 0);h([A.d(rc.INC++,"string"),u("design:type",String)],Hs.prototype,"certificateId",void 0);h([A.d(rc.INC++,"uint32"),u("design:type",Number)],Hs.prototype,"type",void 0);Hs=rc=h([v.d("IssueCertificateModel")],Hs);let Tp=class extends Y{toJSON(){return{issueCertificate:this.issueCertificate.toJSON()}}};h([A.d(1,Hs),u("design:type",Hs)],Tp.prototype,"issueCertificate",void 0);Tp=h([v.d("IssueCertificateAssetModel")],Tp);var nc;let Fs=nc=class extends Y{toJSON(){return{sourceChainMagic:this.sourceChainMagic,sourceChainName:this.sourceChainName,certificateId:this.certificateId,type:this.type}}};Fs.INC=1;h([A.d(nc.INC++,"string"),u("design:type",String)],Fs.prototype,"sourceChainName",void 0);h([A.d(nc.INC++,"string"),u("design:type",String)],Fs.prototype,"sourceChainMagic",void 0);h([A.d(nc.INC++,"string"),u("design:type",String)],Fs.prototype,"certificateId",void 0);h([A.d(nc.INC++,"uint32"),u("design:type",Number)],Fs.prototype,"type",void 0);Fs=nc=h([v.d("DestroyCertificateModel")],Fs);let Sp=class extends Y{toJSON(){return{destroyCertificate:this.destroyCertificate.toJSON()}}};h([A.d(1,Fs),u("design:type",Fs)],Sp.prototype,"destroyCertificate",void 0);Sp=h([v.d("DestroyCertificateAssetModel")],Sp);var uy;let wp=uy=class extends Ie{};h([A.d(uy.INC++,Dc),u("design:type",Dc)],wp.prototype,"asset",void 0);wp=uy=h([v.d("UsernameTransaction")],wp);var fy;let bp=fy=class extends Ie{};h([A.d(fy.INC++,Hc),u("design:type",Hc)],bp.prototype,"asset",void 0);bp=fy=h([v.d("SignatureTransaction")],bp);var gy;let Np=gy=class extends Ie{};h([A.d(gy.INC++,Vh),u("design:type",Vh)],Np.prototype,"asset",void 0);Np=gy=h([v.d("DelegateTransaction")],Np);var dy;let xp=dy=class extends Ie{};h([A.d(dy.INC++,Vc),u("design:type",Vc)],xp.prototype,"asset",void 0);xp=dy=h([v.d("VoteTransaction")],xp);var yy;let Op=yy=class extends Ie{};h([A.d(yy.INC++,$h),u("design:type",$h)],Op.prototype,"asset",void 0);Op=yy=h([v.d("AcceptVoteTransaction")],Op);var my;let Cp=my=class extends Ie{};h([A.d(my.INC++,Uh),u("design:type",Uh)],Cp.prototype,"asset",void 0);Cp=my=h([v.d("RejectVoteTransaction")],Cp);var _y;let Rp=_y=class extends Ie{};h([A.d(_y.INC++,$c),u("design:type",$c)],Rp.prototype,"asset",void 0);Rp=_y=h([v.d("DAppTransaction")],Rp);var Ay;let Pp=Ay=class extends Ie{};h([A.d(Ay.INC++,Uc),u("design:type",Uc)],Pp.prototype,"asset",void 0);Pp=Ay=h([v.d("DAppPurchasingTransaction")],Pp);var Ey;let Bp=Ey=class extends Ie{};h([A.d(Ey.INC++,Kc),u("design:type",Kc)],Bp.prototype,"asset",void 0);Bp=Ey=h([v.d("MarkTransaction")],Bp);var Iy;let Mp=Iy=class extends Ie{};h([A.d(Iy.INC++,Gc),u("design:type",Gc)],Mp.prototype,"asset",void 0);Mp=Iy=h([v.d("IssueAssetTransaction")],Mp);var Ty;let vp=Ty=class extends Ie{};h([A.d(Ty.INC++,zc),u("design:type",zc)],vp.prototype,"asset",void 0);vp=Ty=h([v.d("TransferAssetTransaction")],vp);var Sy;let Lp=Sy=class extends Ie{};h([A.d(Sy.INC++,jc),u("design:type",jc)],Lp.prototype,"asset",void 0);Lp=Sy=h([v.d("DestroyAssetTransaction")],Lp);var wy;let Dp=wy=class extends Ie{};h([A.d(wy.INC++,qc),u("design:type",qc)],Dp.prototype,"asset",void 0);Dp=wy=h([v.d("ToExchangeAssetTransaction")],Dp);var by;let kp=by=class extends Ie{};h([A.d(by.INC++,Xc),u("design:type",Xc)],kp.prototype,"asset",void 0);kp=by=h([v.d("BeExchangeAssetTransaction")],kp);var Ny;let oa=Ny=class extends Ie{};h([A.d(Ny.INC++,Jc),u("design:type",Jc)],oa.prototype,"asset",void 0);oa=Ny=h([v.d("GiftAssetTransaction")],oa);var xy;let Hp=xy=class extends Ie{};h([A.d(xy.INC++,Yc),u("design:type",Yc)],Hp.prototype,"asset",void 0);Hp=xy=h([v.d("GrabAssetTransaction")],Hp);var Oy;let Fp=Oy=class extends Ie{};h([A.d(Oy.INC++,Qc),u("design:type",Qc)],Fp.prototype,"asset",void 0);Fp=Oy=h([v.d("TrustAssetTransaction")],Fp);var Cy;let Vp=Cy=class extends Ie{};h([A.d(Cy.INC++,Wc),u("design:type",Wc)],Vp.prototype,"asset",void 0);Vp=Cy=h([v.d("SignForAssetTransaction")],Vp);var Ry;let $p=Ry=class extends Ie{};h([A.d(Ry.INC++,ep),u("design:type",ep)],$p.prototype,"asset",void 0);$p=Ry=h([v.d("EmigrateAssetTransaction")],$p);var Py;let Up=Py=class extends Ie{};h([A.d(Py.INC++,rp),u("design:type",rp)],Up.prototype,"asset",void 0);Up=Py=h([v.d("ImmigrateAssetTransaction")],Up);var By;let Kp=By=class extends Ie{};h([A.d(By.INC++,op),u("design:type",op)],Kp.prototype,"asset",void 0);Kp=By=h([v.d("ToExchangeSpecialAssetTransaction")],Kp);var My;let Gp=My=class extends Ie{};h([A.d(My.INC++,ap),u("design:type",ap)],Gp.prototype,"asset",void 0);Gp=My=h([v.d("BeExchangeSpecialAssetTransaction")],Gp);var vy;let zp=vy=class extends Ie{};h([A.d(vy.INC++,np),u("design:type",np)],zp.prototype,"asset",void 0);zp=vy=h([v.d("LocationNameTransaction")],zp);var Ly;let jp=Ly=class extends Ie{};h([A.d(Ly.INC++,sp),u("design:type",sp)],jp.prototype,"asset",void 0);jp=Ly=h([v.d("SetLnsManagerTransaction")],jp);var Dy;let Jp=Dy=class extends Ie{};h([A.d(Dy.INC++,ip),u("design:type",ip)],Jp.prototype,"asset",void 0);Jp=Dy=h([v.d("SetLnsRecordValueTransaction")],Jp);var ky;let Yp=ky=class extends Ie{};h([A.d(ky.INC++,Qi),u("design:type",Qi)],Yp.prototype,"asset",void 0);Yp=ky=h([v.d("IssueEntityFactoryTransaction")],Yp);var Hy;let Qp=Hy=class extends Ie{};h([A.d(Hy.INC++,Qi),u("design:type",Qi)],Qp.prototype,"asset",void 0);Qp=Hy=h([v.d("IssueEntityFactoryTransactionV1")],Qp);var Fy;let Gh=Fy=class extends Ie{};h([A.d(Fy.INC++,cp),u("design:type",cp)],Gh.prototype,"asset",void 0);Gh=Fy=h([v.d("IssueEntityTransaction")],Gh);var Vy;let Wp=Vy=class extends Ie{};h([A.d(Vy.INC++,pp),u("design:type",pp)],Wp.prototype,"asset",void 0);Wp=Vy=h([v.d("IssueEntityTransactionV1")],Wp);var $y;let qp=$y=class extends Ie{};h([A.d($y.INC++,lp),u("design:type",lp)],qp.prototype,"asset",void 0);qp=$y=h([v.d("DestroyEntityTransaction")],qp);var Uy;let Xp=Uy=class extends Ie{};h([A.d(Uy.INC++,hp),u("design:type",hp)],Xp.prototype,"asset",void 0);Xp=Uy=h([v.d("TransferAnyTransaction")],Xp);var Ky;let Zp=Ky=class extends Ie{};h([A.d(Ky.INC++,up),u("design:type",up)],Zp.prototype,"asset",void 0);Zp=Ky=h([v.d("GiftAnyTransaction")],Zp);var Gy;let el=Gy=class extends Ie{};h([A.d(Gy.INC++,fp),u("design:type",fp)],el.prototype,"asset",void 0);el=Gy=h([v.d("GrabAnyTransaction")],el);var zy;let tl=zy=class extends Ie{};h([A.d(zy.INC++,gp),u("design:type",gp)],tl.prototype,"asset",void 0);tl=zy=h([v.d("ToExchangeAnyTransaction")],tl);var jy;let rl=jy=class extends Ie{};h([A.d(jy.INC++,dp),u("design:type",dp)],rl.prototype,"asset",void 0);rl=jy=h([v.d("BeExchangeAnyTransaction")],rl);var Jy;let nl=Jy=class extends Ie{};h([A.d(Jy.INC++,mp),u("design:type",mp)],nl.prototype,"asset",void 0);nl=Jy=h([v.d("IssueEntityMultiTransactionV1")],nl);var Yy;let sl=Yy=class extends Ie{};h([A.d(Yy.INC++,_p),u("design:type",_p)],sl.prototype,"asset",void 0);sl=Yy=h([v.d("ToExchangeAnyMultiTransaction")],sl);var Qy;let il=Qy=class extends Ie{};h([A.d(Qy.INC++,Ap),u("design:type",Ap)],il.prototype,"asset",void 0);il=Qy=h([v.d("BeExchangeAnyMultiTransaction")],il);var Wy;let ol=Wy=class extends Ie{};h([A.d(Wy.INC++,Ep),u("design:type",Ep)],ol.prototype,"asset",void 0);ol=Wy=h([v.d("ToExchangeAnyMultiAllTransaction")],ol);var qy;let al=qy=class extends Ie{};h([A.d(qy.INC++,Ip),u("design:type",Ip)],al.prototype,"asset",void 0);al=qy=h([v.d("BeExchangeAnyMultiAllTransaction")],al);var Xy;let cl=Xy=class extends Ie{};h([A.d(Xy.INC++,Tp),u("design:type",Tp)],cl.prototype,"asset",void 0);cl=Xy=h([v.d("IssueCertificateTransaction")],cl);var Zy;let pl=Zy=class extends Ie{};h([A.d(Zy.INC++,Sp),u("design:type",Sp)],pl.prototype,"asset",void 0);pl=Zy=h([v.d("DestroyCertificateTransaction")],pl);class G{constructor(e,t){this.__code=e,this.__message=t}get code(){return this.__code}get message(){return this.__message}set message(e){this.__message=e}build(e){return e?this.__message.replace(/\{([^\\]+?)\}/g,(t,r)=>e[r]??t):this.__message}}const em=Symbol("InjectionToken"),qf=Symbol("SingletonToken"),hE=Symbol("GroupToken"),Xf=new WeakMap,uE=new WeakMap,zh=[];function IT(i){return uE.get(i)||zh[zh.length-1]}const fE="injectProps:afertInit",gE="injectProps:onInit";function dE(i){return i[em]}function yE(i){const e=new Set;let t=i;for(;;){const r=t[hE];if(!r)break;for(const n of r)e.add(n);if(t=Object.getPrototypeOf(t),!t)break}return e}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var T_;(function(i){(function(e){var t=typeof Um=="object"?Um:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=n(i);typeof t.Reflect>"u"?t.Reflect=i:r=n(t.Reflect,r),e(r);function n(s,o){return function(a,p){typeof s[a]!="function"&&Object.defineProperty(s,a,{configurable:!0,writable:!0,value:p}),o&&o(a,p)}}})(function(e){var t=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",n=r&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",s=r&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",a={__proto__:[]}instanceof Array,p=!o&&!a,l={create:o?function(){return Fi(Object.create(null))}:a?function(){return Fi({__proto__:null})}:function(){return Fi({})},has:p?function(q,ie){return t.call(q,ie)}:function(q,ie){return ie in q},get:p?function(q,ie){return t.call(q,ie)?q[ie]:void 0}:function(q,ie){return q[ie]}},f=Object.getPrototypeOf(Function),g=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",d=!g&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:oh(),y=!g&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Oo(),m=!g&&typeof WeakMap=="function"?WeakMap:gn(),E=new m;function T(q,ie,fe,S){if(ee(fe)){if(!Ce(q))throw new TypeError;if(!Ye(ie))throw new TypeError;return B(q,ie)}else{if(!Ce(q))throw new TypeError;if(!ce(ie))throw new TypeError;if(!ce(S)&&!ee(S)&&!ye(S))throw new TypeError;return ye(S)&&(S=void 0),fe=pe(fe),M(q,ie,fe,S)}}e("decorate",T);function w(q,ie){function fe(S,_){if(!ce(S))throw new TypeError;if(!ee(_)&&!rt(_))throw new TypeError;ue(q,ie,S,_)}return fe}e("metadata",w);function b(q,ie,fe,S){if(!ce(fe))throw new TypeError;return ee(S)||(S=pe(S)),ue(q,ie,fe,S)}e("defineMetadata",b);function C(q,ie,fe){if(!ce(ie))throw new TypeError;return ee(fe)||(fe=pe(fe)),U(q,ie,fe)}e("hasMetadata",C);function N(q,ie,fe){if(!ce(ie))throw new TypeError;return ee(fe)||(fe=pe(fe)),D(q,ie,fe)}e("hasOwnMetadata",N);function O(q,ie,fe){if(!ce(ie))throw new TypeError;return ee(fe)||(fe=pe(fe)),W(q,ie,fe)}e("getMetadata",O);function R(q,ie,fe){if(!ce(ie))throw new TypeError;return ee(fe)||(fe=pe(fe)),ae(q,ie,fe)}e("getOwnMetadata",R);function F(q,ie){if(!ce(q))throw new TypeError;return ee(ie)||(ie=pe(ie)),Ee(q,ie)}e("getMetadataKeys",F);function z(q,ie){if(!ce(q))throw new TypeError;return ee(ie)||(ie=pe(ie)),Ae(q,ie)}e("getOwnMetadataKeys",z);function K(q,ie,fe){if(!ce(ie))throw new TypeError;ee(fe)||(fe=pe(fe));var S=V(ie,fe,!1);if(ee(S)||!S.delete(q))return!1;if(S.size>0)return!0;var _=E.get(ie);return _.delete(fe),_.size>0||E.delete(ie),!0}e("deleteMetadata",K);function B(q,ie){for(var fe=q.length-1;fe>=0;--fe){var S=q[fe],_=S(ie);if(!ee(_)&&!ye(_)){if(!Ye(_))throw new TypeError;ie=_}}return ie}function M(q,ie,fe,S){for(var _=q.length-1;_>=0;--_){var I=q[_],x=I(ie,fe,S);if(!ee(x)&&!ye(x)){if(!ce(x))throw new TypeError;S=x}}return S}function V(q,ie,fe){var S=E.get(q);if(ee(S)){if(!fe)return;S=new d,E.set(q,S)}var _=S.get(ie);if(ee(_)){if(!fe)return;_=new d,S.set(ie,_)}return _}function U(q,ie,fe){var S=D(q,ie,fe);if(S)return!0;var _=hc(ie);return ye(_)?!1:U(q,_,fe)}function D(q,ie,fe){var S=V(ie,fe,!1);return ee(S)?!1:oe(S.has(q))}function W(q,ie,fe){var S=D(q,ie,fe);if(S)return ae(q,ie,fe);var _=hc(ie);if(!ye(_))return W(q,_,fe)}function ae(q,ie,fe){var S=V(ie,fe,!1);if(!ee(S))return S.get(q)}function ue(q,ie,fe,S){var _=V(fe,S,!0);_.set(q,ie)}function Ee(q,ie){var fe=Ae(q,ie),S=hc(q);if(S===null)return fe;var _=Ee(S,ie);if(_.length<=0)return fe;if(fe.length<=0)return _;for(var I=new y,x=[],k=0,$=fe;k<$.length;k++){var Z=$[k],xe=I.has(Z);xe||(I.add(Z),x.push(Z))}for(var it=0,yt=_;it<yt.length;it++){var Z=yt[it],xe=I.has(Z);xe||(I.add(Z),x.push(Z))}return x}function Ae(q,ie){var fe=[],S=V(q,ie,!1);if(ee(S))return fe;for(var _=S.keys(),I=qe(_),x=0;;){var k=lc(I);if(!k)return fe.length=x,fe;var $=ef(k);try{fe[x]=$}catch(Z){try{tf(I)}finally{throw Z}}x++}}function P(q){if(q===null)return 1;switch(typeof q){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return q===null?1:6;default:return 6}}function ee(q){return q===void 0}function ye(q){return q===null}function De(q){return typeof q=="symbol"}function ce(q){return typeof q=="object"?q!==null:typeof q=="function"}function Q(q,ie){switch(P(q)){case 0:return q;case 1:return q;case 2:return q;case 3:return q;case 4:return q;case 5:return q}var fe=ie===3?"string":ie===5?"number":"default",S=st(q,n);if(S!==void 0){var _=S.call(q,fe);if(ce(_))throw new TypeError;return _}return se(q,fe==="default"?"number":fe)}function se(q,ie){if(ie==="string"){var fe=q.toString;if(Fe(fe)){var S=fe.call(q);if(!ce(S))return S}var _=q.valueOf;if(Fe(_)){var S=_.call(q);if(!ce(S))return S}}else{var _=q.valueOf;if(Fe(_)){var S=_.call(q);if(!ce(S))return S}var I=q.toString;if(Fe(I)){var S=I.call(q);if(!ce(S))return S}}throw new TypeError}function oe(q){return!!q}function le(q){return""+q}function pe(q){var ie=Q(q,3);return De(ie)?ie:le(ie)}function Ce(q){return Array.isArray?Array.isArray(q):q instanceof Object?q instanceof Array:Object.prototype.toString.call(q)==="[object Array]"}function Fe(q){return typeof q=="function"}function Ye(q){return typeof q=="function"}function rt(q){switch(P(q)){case 3:return!0;case 4:return!0;default:return!1}}function st(q,ie){var fe=q[ie];if(fe!=null){if(!Fe(fe))throw new TypeError;return fe}}function qe(q){var ie=st(q,s);if(!Fe(ie))throw new TypeError;var fe=ie.call(q);if(!ce(fe))throw new TypeError;return fe}function ef(q){return q.value}function lc(q){var ie=q.next();return ie.done?!1:ie}function tf(q){var ie=q.return;ie&&ie.call(q)}function hc(q){var ie=Object.getPrototypeOf(q);if(typeof q!="function"||q===f||ie!==f)return ie;var fe=q.prototype,S=fe&&Object.getPrototypeOf(fe);if(S==null||S===Object.prototype)return ie;var _=S.constructor;return typeof _!="function"||_===q?ie:_}function oh(){var q={},ie=[],fe=function(){function x(k,$,Z){this._index=0,this._keys=k,this._values=$,this._selector=Z}return x.prototype["@@iterator"]=function(){return this},x.prototype[s]=function(){return this},x.prototype.next=function(){var k=this._index;if(k>=0&&k<this._keys.length){var $=this._selector(this._keys[k],this._values[k]);return k+1>=this._keys.length?(this._index=-1,this._keys=ie,this._values=ie):this._index++,{value:$,done:!1}}return{value:void 0,done:!0}},x.prototype.throw=function(k){throw this._index>=0&&(this._index=-1,this._keys=ie,this._values=ie),k},x.prototype.return=function(k){return this._index>=0&&(this._index=-1,this._keys=ie,this._values=ie),{value:k,done:!0}},x}();return function(){function x(){this._keys=[],this._values=[],this._cacheKey=q,this._cacheIndex=-2}return Object.defineProperty(x.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),x.prototype.has=function(k){return this._find(k,!1)>=0},x.prototype.get=function(k){var $=this._find(k,!1);return $>=0?this._values[$]:void 0},x.prototype.set=function(k,$){var Z=this._find(k,!0);return this._values[Z]=$,this},x.prototype.delete=function(k){var $=this._find(k,!1);if($>=0){for(var Z=this._keys.length,xe=$+1;xe<Z;xe++)this._keys[xe-1]=this._keys[xe],this._values[xe-1]=this._values[xe];return this._keys.length--,this._values.length--,k===this._cacheKey&&(this._cacheKey=q,this._cacheIndex=-2),!0}return!1},x.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=q,this._cacheIndex=-2},x.prototype.keys=function(){return new fe(this._keys,this._values,S)},x.prototype.values=function(){return new fe(this._keys,this._values,_)},x.prototype.entries=function(){return new fe(this._keys,this._values,I)},x.prototype["@@iterator"]=function(){return this.entries()},x.prototype[s]=function(){return this.entries()},x.prototype._find=function(k,$){return this._cacheKey!==k&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=k)),this._cacheIndex<0&&$&&(this._cacheIndex=this._keys.length,this._keys.push(k),this._values.push(void 0)),this._cacheIndex},x}();function S(x,k){return x}function _(x,k){return k}function I(x,k){return[x,k]}}function Oo(){return function(){function q(){this._map=new d}return Object.defineProperty(q.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),q.prototype.has=function(ie){return this._map.has(ie)},q.prototype.add=function(ie){return this._map.set(ie,ie),this},q.prototype.delete=function(ie){return this._map.delete(ie)},q.prototype.clear=function(){this._map.clear()},q.prototype.keys=function(){return this._map.keys()},q.prototype.values=function(){return this._map.values()},q.prototype.entries=function(){return this._map.entries()},q.prototype["@@iterator"]=function(){return this.keys()},q.prototype[s]=function(){return this.keys()},q}()}function gn(){var q=16,ie=l.create(),fe=S();return function(){function $(){this._key=S()}return $.prototype.has=function(Z){var xe=_(Z,!1);return xe!==void 0?l.has(xe,this._key):!1},$.prototype.get=function(Z){var xe=_(Z,!1);return xe!==void 0?l.get(xe,this._key):void 0},$.prototype.set=function(Z,xe){var it=_(Z,!0);return it[this._key]=xe,this},$.prototype.delete=function(Z){var xe=_(Z,!1);return xe!==void 0?delete xe[this._key]:!1},$.prototype.clear=function(){this._key=S()},$}();function S(){var $;do $="@@WeakMap@@"+k();while(l.has(ie,$));return ie[$]=!0,$}function _($,Z){if(!t.call($,fe)){if(!Z)return;Object.defineProperty($,fe,{value:l.create()})}return $[fe]}function I($,Z){for(var xe=0;xe<Z;++xe)$[xe]=Math.random()*255|0;return $}function x($){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array($)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array($)):I(new Uint8Array($),$):I(new Array($),$)}function k(){var $=x(q);$[6]=$[6]&79|64,$[8]=$[8]&191|128;for(var Z="",xe=0;xe<q;++xe){var it=$[xe];(xe===4||xe===6||xe===8)&&(Z+="-"),it<16&&(Z+="0"),Z+=it.toString(16).toLowerCase()}return Z}}function Fi(q){return q.__=void 0,delete q.__,q}})})(T_||(T_={}));function j(i,e){return t=>{let r,n,s;typeof i=="object"?(r=i.module_name,e=i,n=i.singleton):r=i,r===void 0&&(r=Symbol(t.name)),e&&(e.singleton!==void 0&&(n=e.singleton),e.group!==void 0&&(typeof e.group=="boolean"?e.group===!0&&(s=[r]):s=e.group instanceof Array?e.group:[e.group])),t[em]=r,t[qf]=!!n,s&&(t[hE]=s)}}var mE,_E,AE;const Zf=Symbol("module-map"),Oh=Symbol("mask-level"),eg=Symbol("mask-self");let et=class{constructor(i,e){this.parent=e,this[mE]="ModuleStroge",this[_E]=0,this[AE]=this,this._stroge=new Map(i),this.set(Zf,this)}clear(){return this._stroge.clear()}delete(i){return this._stroge.delete(i)}forEach(i,e){return this._stroge.forEach(i,e)}set(i,e){return this._stroge.set(i,e),this}get size(){return this._stroge.size}[Symbol.iterator](){return this._stroge[Symbol.iterator]()}entries(){return this._stroge.entries()}keys(){return this._stroge.keys()}values(){return this._stroge.values()}get(i){return!this.parent||this._stroge.has(i)?this._stroge.get(i):this.parent.get(i)}has(i){return!!this._stroge.has(i)||!!this.parent&&this.parent.has(i)}installMask(i){const e=n=>n===Zf&&i.get(n)===i?r:i.has(n)?i.get(n):this.get(n),t=n=>i.has(n)||this.has(n),r=new Proxy(this,{get:(n,s,o)=>s==="_mask"?i:s===Oh?this[Oh]+1:s===eg?this:s==="get"?e:s==="has"?t:Reflect.get(n,s,o)});return r}uninstallMask(i=1){i=Math.min(this[Oh],i);let e=this;for(let t=0;t<i;t+=1)e=this[eg];return e}groupInsert(i,e){(this._groupCollection||(this._groupCollection=new wt(t=>new Set))).forceGet(i).add(e)}groupGet(...i){let e;for(const t of i){let r;switch(typeof t){case"function":r=[...yE(t)];break;case"object":r=t;break;default:r=[t]}if(!(r instanceof Array))throw new TypeError;const n=this.groupsGet_(r);if(n)if(e)for(const s of n)e.add(s);else e=n;if(this.parent){const s=this.parent.groupsGet_(r);if(s)if(e)for(const o of s)e.add(o);else e=s}}return e||new Set}groupsGet_(i){let e;i=i.slice();let t=r=>!0;for(;;){const r=i.shift();if(r===void 0)break;e=new Set;for(const n of this.groupGet_(r))t(n)&&e.add(n);if(!e.size)break;{const n=e;t=s=>n.has(s)}}return e}groupGet_(i){const e=[];if(this._groupCollection){const t=this._groupCollection.get(i);t&&e.push(...t)}return this.parent&&e.push(...this.parent.groupGet_(i)),e}};mE=Symbol.toStringTag,_E=Oh,AE=eg,et=h([j(Zf),u("design:paramtypes",[Object,et])],et);const TT=new Map;function ST(i){for(;;){const e=Xf.get(i);if(e)return e;if((i=Object.getPrototypeOf(i))===Object.prototype||!i)break}return TT}function Ot(i,e=new et){const t=i[em],r=i[qf],n=yE(i);let s;if(r instanceof i?e.set(t,s=r):s=e.get(t),!s){const o=ST(i),a=Reflect.getMetadata("design:paramtypes",i),p=a?a.map((g,d)=>{const y=o&&o.get(d);if(y!==void 0){if(!(y.conf&&y.conf.optional)){if(!e.has(y.id))throw new ReferenceError(`Need Inject Module '${String(y.id)}' in ${String(t)}`)}return e.get(y.id)}return Ot(g,e)}):[];zh.push(e),s=new i(...p),zh.pop(),uE.set(s,e),r&&(i[qf]=s),t!==void 0&&e.set(t,s);for(const g of n)e.groupInsert(g,s);typeof s.bfOnInit=="function"&&s.bfOnInit();const l=Reflect.getMetadata(gE,i.prototype);if(l)for(const[g,d]of l)s[g]=Ot(d.injectModel,e);typeof s.bfAfterInit=="function"&&queueMicrotask(()=>{s.bfAfterInit()});const f=Reflect.getMetadata(fE,i.prototype);f&&queueMicrotask(()=>{for(const[g,d]of f)s[g]=Ot(d.injectModel,e)})}return s}function J(i,e){return(t,r,n)=>{if(typeof n!="number"){if(i===void 0)throw new ReferenceError("inject_moudle should not be empty");return bT(i,e)(t,r,n)}{const s=typeof i=="function"?dE(i):i;if(s!==void 0){const o=Xf.get(t)||new Map;Xf.set(t,o),o.set(n,{id:s,conf:e})}}}}var wT=(i=>(i[i.NO_RESOLVE=0]="NO_RESOLVE",i[i.ON_GETTER=1]="ON_GETTER",i[i.ON_INIT=2]="ON_INIT",i[i.AFTER_INIT=3]="AFTER_INIT",i))(wT||{});function S_(i,e){let t=Reflect.getMetadata(e,i);return t||(t=new Map,Reflect.metadata(e,t)(i)),t}function bT(i,e={}){const{dynamics:t,optional:r,autoResolve:n,writable:s=!0}=e;let o;o=n===!1?0:n===!0||n===void 0?1:n;const a=typeof i=="function"?dE(i):i;if(a===void 0)throw new TypeError("module name is undefined");return(p,l,f)=>{if(o!==0&&o!==1){if(typeof i!="function")throw new TypeError(`${p} could not resolve prop '${l}', inject_module not an function.`);o===3?S_(p,fE).set(l,{injectModel:i}):o===2&&S_(p,gE).set(l,{injectModel:i})}const g=E=>{const T=IT(E);if(!T)throw new ReferenceError(`instance of ${E.constructor.name} is not an instance which is created by Resolve`);return T},d=(E,T)=>{g(E).set(a,T)},y=E=>{const T=g(E);if(T.has(a))return T.get(a);if(o!==0&&typeof i=="function")return Ot(i,T);if(!r)throw new ReferenceError(`module of ${String(a)} must been Injected first.`)},m={configurable:!0,enumerable:!0};if(t)s&&(m.set=function(E){d(this,E)}),m.get=function(){return y(this)};else{const E=(T,w)=>{Object.defineProperty(T,l,{value:w,writable:s,configurable:!0,enumerable:!0})};s&&(m.set=function(T){d(this,T),E(this,T)}),m.get=function(){const T=y(this);return E(this,T),T}}Object.defineProperty(p,l,m)}}function wo(i){return e=>{}}var tg,Oc;(function(i){i.CHINESE="zh_CN.UTF-8",i.ENGLISH="en_US.UTF-8"})(Oc||(Oc={}));const EE=Symbol("errorCodeLang");let rg=tg=class{constructor(i=Oc.ENGLISH){this.__store=new Map,this.__checkLanguage(i),this.__lang=i}static from(i,e=new et){return Ot(tg,e.installMask(new et([[EE,i]])))}__checkLanguage(i){if(i!==Oc.CHINESE&&i!==Oc.ENGLISH)throw new Error(`Invalid lang type ${i}`)}getErrorCodeList(i){const e=this.__store.get(i);if(!e)throw new Error(`Failed to get error code list by ${i}`);return e.sourceErrorCodeList}formatErrorCodeList(i,e){const t=e.get(this.__lang);if(!t)return console.debug(`Translated error code list not found, language ${this.__lang}`),i;for(const r in i){const n=i[r];n.message=t[n.code]||n.message}return i}addErrorCodeList(i,e,t){this.formatErrorCodeList(e,t),this.__store.set(i,{sourceErrorCodeList:e,translatedErrorCodeListMap:t})}setLanguage(i){if(this.__lang!==i){this.__checkLanguage(i),this.__lang=i;for(const{sourceErrorCodeList:e,translatedErrorCodeListMap:t}of this.__store.values())this.formatErrorCodeList(e,t)}}};rg=tg=h([j(),Oe(0,J(EE,{optional:!0})),u("design:paramtypes",[String])],rg);const NT={"001-00001":"params {param} lost","001-00002":"{prop} in {target} is required","001-00003":"{prop} in {target} is invalid","001-00004":"{to_compare_prop} in {to_target} and {be_compare_prop} in {be_target} not match","001-00005":"{prop} in {target} should greater than {field}","001-00006":"{prop} in {target} should greater than or equals to {field}","001-00007":"{prop} in {target} should less than {field}","001-00008":"{prop} in {target} should less than or equals to {field}","001-00009":"{prop} in {target} should equals to {field}","001-00010":"{to_compare_prop} in {to_target} should be {be_compare_prop}","001-00011":"{to_compare_prop} in {to_target} should not be {be_compare_prop}","001-00012":"{prop} in {target} not exist","001-00013":"{prop} in {target} should not exist","001-00014":"Transaction fee is not enough, errorId {errorId}, minFee {minFee}","001-00015":"{prop} in {target} not in [{min}, {max}]","001-00016":"{prop} in {target} is over length {limit}","001-00017":"{prop} in {target} should not start with or end with {field}","001-00018":"{prop} in {target} not a string, value {value}","001-00019":"{prop} in {target} not a ip, value {value}","001-00020":"{prop} in {target} not a ipv4, value {value}","001-00021":"{prop} in {target} not a ipv6, value {value}","001-00022":"{prop} in {target} not a longitude-latitude, value {value}","001-00023":"{prop} in {target} not a longitude, value {value}","001-00024":"{prop} in {target} not a latitude, value {value}","001-00025":"{prop} in {target} not a address, value {value}","001-00026":"{prop} in {target} not a locationName, value {value}","001-00027":"{prop} in {target} not a dns, value {value}","001-00028":"{prop} in {target} not a email, value {value}","001-00029":"{prop} in {target} not a url, value {value}","001-00030":"Permission denied at operation {operationName}","001-00031":"{prop} in {target} should not inclue {value}","001-00032":"{prop} in {target} should inclue {value}","001-00033":"{prop} in {target} should not duplicate","001-00034":"{prop} in {target} already exist, errorId {errorId}","001-00035":"Genesis delegate not enough, at least {expected}, actual {actual}","001-00036":"{prop} in {target} should be an array","001-00037":"Invalid block generator, reason {reason}","001-00038":"transaction's porf of work verify fail","001-00039":"{prop} not found","001-00040":"{prop} is too large, reason {reason}, errorId {errorId}","001-00041":"{prop} length in {target} should less than {field}","001-00042":"{prop} length in {target} should less than or equals to {field}","001-00043":"{prop} length in {target} should greater than {field}","001-00044":"{prop} length in {target} should greater than or equals to {field}","001-00045":"{prop} length in {target} should equals to {field}","001-00046":"{prop} length in {target} should not equals to {field}","001-00047":"Invalid transaction base type: {base_type}","001-00048":"Invalid block constructor: {name}","001-00049":"Invalid block type: {type}","001-00050":"Custom transaction verify fail: {message}","001-00051":"Disabled create {trsName} Transaction","001-00052":"Disabled insert {trsName} Transaction","001-00053":"Transaction is in unchangable state","001-00054":"AssetStatistic index: {index} already in use","001-00055":"Invalid {taskLabel} signature","001-00056":"Invalid {taskLabel} signSignature","001-00057":"Invalid base type {base_type}","001-00058":"Unregistered TransactionFactory {factoryName}","001-00059":"Unregistered Transaction base type {trs_base}","001-00060":"Unregistered Transaction type {trs_key}","001-00061":"Invalid {taskLabel} fromAuthSignature","001-00062":"Invalid {taskLabel} fromAuthSignSignature","001-00063":"Invalid {taskLabel} toAuthSignature","001-00064":"Invalid {taskLabel} toAuthSignSignature","001-00065":"Invalid macro input type: {type}","001-00066":"{prop} in {target} already expired","001-11001":"{prop} in {target} lose","001-11002":"Account with address {address} was frozen, status {status}, errorId {errorId}","001-11003":"Transaction signSignature is required, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11004":"Transaction sender second secret have already change, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11005":"Transaction should not have senderSecondPublicKey, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11006":"Transaction should not have signSignature, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11007":"Invalid transaction({signature}) apply block height, reason {reason}","001-11008":"Invalid transaction({signature}) effective block height, reason {reason}","001-11009":"Invalid transaction from magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11010":"Invalid transaction to magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11011":"Invalid transaction timestamp, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}","001-11012":"DAppid is not exist, dappid {dappid}","001-11013":"DAppid is already exist, dappid {dappid}, errorId {errorId}","001-11014":"LocationName is not exist, locationName {locationName}, errorId {errorId}","001-11015":"LocationName is already exist, locationName {locationName}, errorId {errorId}","001-11016":"Entity factory is not exist, factoryId {factoryId}","001-11017":"Entity factory is already exist, factoryId {factoryId}, errorId {errorId}","001-11018":"Entity is not exist, entityId {entityId}","001-11019":"Entity is already exist, entityId {entityId}, errorId {errorId}","001-11020":"Unknow rangeType, rangeType {rangeType}","001-11021":"Invalid transaction byte length, reason {reason}","001-11022":"Need purchase dappid before use, dappid {dappid}","001-11023":"Need vote for dappid possessor before use, dappid {dappid}, errorId {errorId}","001-11024":"Verify transaction pow of work error, errorId {errorId}, reason {reason}","001-11025":"Can not delete locationName {locationName}, reason {reason}","001-11026":"Set locationName {locationName} manager field, reason {reason}, errorId {errorId}","001-11027":"Set locationName {locationName} recordValue field, reason {reason}, errorId {errorId}","001-11028":"Asset not enough, reason {reason}, errorId {errorId}","001-11029":"Account remain equity not enough, reason {reason}, errorId {errorId}","001-11030":"Frozen asset is not begin to unfrozen yet, frozenId {frozenId}","001-11031":"Frozen asset is already expiration, frozenId {frozenId}","001-11032":"Gift asset unfrozen time use up, frozenId {frozenId}","001-11033":"Username already exist, errorId {errorId}","001-11034":"Account with address {address} is already an delegate, errorId {errorId}","001-11035":"Account with address {address} is not an delegate, errorId {errorId}","001-11036":"Delegate with address {address} is already accept vote, errorId {errorId}","001-11037":"Delegate with address {address} is already reject vote, errorId {errorId}","001-11038":"{prop} in {target} is forbidden","001-11039":"Asset not exist, magic {magic} assetType {assetType}","001-11040":"Account with address {address} not dappid {dappid} possessor, errorId {errorId}","001-11041":"Account with address {address} not locationName {locationName} possessor, errorId {errorId}","001-11042":"Account with address {address} not entityId {entityId} possessor, errorId {errorId}","001-11043":"DAppid not frozen, dappid {dappid}","001-11044":"DAppid already frozen, dappid {dappid}","001-11045":"LocationName not frozen, locationName {locationName}","001-11046":"LocationName already frozen, locationName {locationName}","001-11047":"Entity not frozen, entityId {entityId}","001-11048":"Entity already frozen, entityId {entityId}","001-11049":"No need to purchase asset, type {type} asset {asset}","001-11050":"Only top level location name can exchange","001-11051":"Can not destroy entityId {entityId}, reason {reason}","001-11052":"Entity already destroy, entityId {entityId}","001-11053":"Asset is already migration, migrateCertificateId {migrateCertificateId}","001-11054":"{prop} in {target} not exist or expired","001-11055":"Transaction with signature {signature} is not an expected related transaction","001-11056":"Can not secondary transaction, reason {reason}","001-11057":"The register delegate quota is full in round {round}","001-11058":"Delegate can not migrate asset","001-11059":"You can only migrate main asset, {assetType} is not main asset {mainAsset}","001-11060":"Can not carry second publicKey","001-11061":"Can not carry second signature","001-11062":"Account participate vote recently","001-11063":"Account possess frozen asset","001-11064":"Need emigrate total asset, address {address}","001-11065":"Account possess asset expect chain asset","001-11066":"Account possess frozen asset expect chain asset","001-11067":"Account with address {address} can not be frozen, reason {reason}, errorId {errorId}","001-11068":"You can only trust main asset, {assetType} is not main asset {mainAsset}","001-11069":"Account already has a username, errorId {errorId}","001-11070":"Issue entity times use up, entityFactory {entityFactory}","001-11071":"Asset already exist, magic {magic} assetType {assetType}","001-11072":"Frozen asset with frozenAddress {frozenAddress} signature {signature} assetType {assetType} in blockChain not exist or expired","001-11073":"Not enough issue entity times, entityFactory {entityFactory}","001-11074":"Promise is not begin to resolve yet, promiseId {promiseId}","001-11075":"Certificate is not exist, certificateId {certificateId}","001-11076":"Certificate is already exist, certificateId {certificateId}, errorId {errorId}","001-11077":"Can not destroy certificate, certificateId {certificateId}, reason {reason}","001-11078":"Account with address {address} not certificate {certificateId} possessor, errorId {errorId}","001-11079":"Certificate not frozen, certificateId {certificateId}","001-11080":"Certificate already frozen, certificateId {certificateId}","001-11081":"Certificate already destroy, certificateId {certificateId}","001-12001":"Block signSignature is required, signature {signature} generatorAddress {generatorAddress} height {height}","001-12002":"Block generator second secret have already change, signature {signature} generatorAddress {generatorAddress} height {height}","001-12003":"Block should not have generatorSecondPublicKey, signature {signature} generatorAddress {generatorAddress} height {height}","001-12004":"Block should not have signSignature, signature {signature} generatorAddress {generatorAddress} height {height}","001-12005":"{variable} out of range","001-12006":"Failed to find nearest same block in one round, should not happen","001-12007":"GenesisBlock not match, the signature of genesisBlock and synchronized peer's genesisBlock's signature not equal","000-12008":"Falied to get blocks by range({minHeight}~{maxHeight})","001-22001":"Invalid params: {params}","001-22002":"Invalid params field: {field}","001-22003":"GenesisBlock maybe no equal","001-22004":"Invalid QueryBlockArg query params, no query conditions","001-22005":"QueryBlock ({query}) from peer({peerId}) timeout","001-22006":"ReqId reuse","001-22007":"ChainChannel closed","001-22008":"Refuse response query transaction","001-22009":"Refuse response index transaction","001-22010":"Refuse response download transaction","001-22011":"Refuse response broadcast transaction","001-22012":"Refuse response query block","001-22013":"Refuse response broadcast block","001-22014":"Message type error","001-22015":"OnMessage get invalid req_id: {req_id}","001-22016":"Request limit","001-22017":"Invalid message cmd","001-22018":"ChainChannel Timeout, cmd {cmd}","001-22019":"Task {task_id} abort because the free chainChannel size is zero","001-22020":"Refuse response open blob","001-22021":"Refuse response read blob","001-22022":"Refuse response close blob","001-23001":"blob({hash}) algorithm({algorithm}) is invalid","001-23002":"Fail to download blob({hash}) size({size})"},xT={"001-00001":" {param} ","001-00002":"{target}  {prop} ","001-00003":"{target}  {prop} ","001-00004":"{to_target}  {to_compare_prop}  {be_target}  {be_compare_prop} ","001-00005":"{target}  {prop}  {field}","001-00006":"{target}  {prop}  {field}","001-00007":"{target}  {prop}  {field}","001-00008":"{target}  {prop}  {field}","001-00009":"{target}  {prop}  {field}","001-00010":"{to_target}  {to_compare_prop}  {be_compare_prop}","001-00011":"{to_target}  {to_compare_prop}  {be_compare_prop}","001-00012":"{target}  {prop} ","001-00013":"{target}  {prop} ","001-00014":" id {errorId} {minFee}","001-00015":"{target}  {prop}  [{min}{max}] ","001-00016":"{target}  {prop}  {limit}","001-00017":"{target}  {prop}  {field} ","001-00018":"{target}  {prop}  {value}","001-00019":"{target}  {prop}  ip {value}","001-00020":"{target}  {prop}  ipv4 {value}","001-00021":"{target}  {prop}  ipv6 {value}","001-00022":"{target}  {prop}  {value}","001-00023":"{target}  {prop}  {value}","001-00024":"{target}  {prop}  {value}","001-00025":"{target}  {prop}  {value}","001-00026":"{target}  {prop}  {value}","001-00027":"{target}  {prop}  dns {value}","001-00028":"{target}  {prop}  email {value}","001-00029":"{target}  {prop}  url {value}","001-00030":" {operationName} ","001-00031":"{target}  {prop}  {value}","001-00032":"{target}  {prop}  {value}","001-00033":"{target}  {prop} ","001-00034":"{target}  {prop}  id {errorId}","001-00035":" {expected} {actual}","001-00036":"{target}  {prop} ","001-00037":" {reason}","001-00038":"","001-00039":"{prop} ","001-00040":"{prop}  {reason} id {errorId}","001-00041":"{target}  {prop}  {field}","001-00042":"{target}  {prop}  {field}","001-00043":"{target}  {prop}  {field}","001-00044":"{target}  {prop}  {field}","001-00045":"{target}  {prop}  {field}","001-00046":"{target}  {prop}  {field}","001-00047":"{base_type}","001-00048":"{name}","001-00049":"{type}","001-00050":"{message}","001-00051":" {trsName}","001-00052":" {trsName}","001-00053":"","001-00054":"{index} ","001-00055":" {taskLabel} signature","001-00056":" {taskLabel} signSignature","001-00057":" base type {base_type}","001-00058":" factory {factoryName}","001-00059":" base type {trs_base}","001-00060":" type {trs_key}","001-00061":" {taskLabel} fromAuthSignature","001-00062":" {taskLabel} fromAuthSignSignature","001-00063":" {taskLabel} toAuthSignature","001-00064":" {taskLabel} toAuthSignSignature","001-00065":": {type}","001-00066":"{target}  {prop} ","001-11001":"{target}  {prop} ","001-11002":" {address}  {status} id {errorId}","001-11003":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11004":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11005":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11006":" {signature}  {senderId}  {applyBlockHeight}  {type}","001-11007":"{signature} {reason}","001-11008":"{signature} {reason}","001-11009":" {reason} {signature}  {senderId}  {applyBlockHeight}  {type}","001-11010":" {reason} {signature}  {senderId}  {applyBlockHeight}  {type}","001-11011":" {reason} {signature}  {senderId}  {applyBlockHeight}  {type}","001-11012":"DAppid dappid {dappid}","001-11013":"DAppid dappid {dappid} id {errorId}","001-11014":" {locationName} id {errorId}","001-11015":" {locationName} id {errorId}","001-11016":"Entity factory factoryId {factoryId}","001-11017":"Entity factory factoryId {factoryId} id {errorId}","001-11018":"Entity entityId {entityId}","001-11019":"Entity entityId {entityId} id {errorId}","001-11020":" rangeTyperangeType {rangeType}","001-11021":" {reason}","001-11022":" dappid dappid {dappid}","001-11023":" dappid  dappid dappid {dappid} id {errorId}","001-11024":" id {errorId {reason}","001-11025":" {locationName} {reason}","001-11026":" {locationName}  {reason} id {errorId}","001-11027":" {locationName}  {reason} id {errorId}","001-11028":" {reason} id {errorId}","001-11029":" {reason} id {errorId}","001-11030":"frozenId {frozenId}","001-11031":"frozenId {frozenId}","001-11032":"frozenId {frozenId}","001-11033":" id {errorId}","001-11034":" {address}  id {errorId}","001-11035":" {address}  id {errorId}","001-11036":" {address}  id {errorId}","001-11037":" {address}  id {errorId}","001-11038":"{target}  {prop} ","001-11039":" {magic}  {assetType}","001-11040":" {address}  dappid {dappid}  id {errorId}","001-11041":" {address}  locationName {locationName}  id {errorId}","001-11042":" {address}  entityId {entityId}  id {errorId}","001-11043":"DAppid dappid {dappid}","001-11044":"DAppid dappid {dappid}","001-11045":" {locationName}","001-11046":" {locationName}","001-11047":"Entity EntityId {entityId}","001-11048":"Entity entityId {entityId}","001-11049":" {type} {asset}","001-11050":"","001-11051":" entityId {entityId} {reason}","001-11052":"Entity  entityId {entityId}","001-11053":" id {migrateCertificateId}","001-11054":"{target}  {prop} ","001-11055":" {signature} ","001-11056":" {reason}","001-11057":" {round} ","001-11058":"","001-11059":"{assetType}  {mainAsset}","001-11060":"","001-11061":"","001-11062":"","001-11063":"","001-11064":" {address}","001-11065":"","001-11066":"","001-11067":" {address}  {reason} id {errorId}","001-11068":"{assetType}  {mainAsset}","001-11069":" id {errorId}","001-11070":" entity entityFactory {entityFactory}","001-11071":" {magic}  {assetType}","001-11072":" frozenAddress {frozenAddress} signature {signature} assetType {assetType} ","001-11073":" entity entityFactory {entityFactory}","001-11074":"promiseId {promiseId}","001-11075":" certificateId {certificateId}","001-11076":"certificateId {certificateId} id {errorId}","001-11077":"certificateId {certificateId}reason {reason}","001-11078":" address {address}  {certificateId}  id {errorId}","001-11079":"certificateId {certificateId}","001-11080":"certificateId {certificateId}","001-11081":"certificateId {certificateId}","001-12001":" {signature}  {generatorAddress}  {height}","001-12002":" {signature}  {generatorAddress}  {height}","001-12003":" {signature}  {generatorAddress}  {height}","001-12004":" {signature}  {generatorAddress}  {height}","001-12005":"{variable} ","001-12006":"","001-12007":" signature  signature ","000-12008":"{minHeight}~{maxHeight}","001-22001":"{params}","001-22002":"{field}","001-22003":"","001-22004":" QueryBlockArg ","001-22005":" {peerId}  {query} ","001-22006":"ReqId ","001-22007":"ChainChannel ","001-22008":"","001-22009":"","001-22010":"","001-22011":"","001-22012":"","001-22013":"","001-22014":"Message ","001-22015":"OnMessage  req_id{req_id}","001-22016":"","001-22017":" message cmd","001-22018":"ChainChannel cmd {cmd}","001-22019":"Task {task_id}  chainChannel  0","001-22020":" blob","001-22021":" blob","001-22022":" blob","001-23001":"blob({hash})  algorithm({algorithm}) ","001-23002":" blob({hash}) size({size}) "},tm=new Map;tm.set("en_US.UTF-8",NT);tm.set("zh_CN.UTF-8",xT);const OT=tm,c={PARAM_LOST:new G("001-00001","params {param} lost"),PROP_IS_REQUIRE:new G("001-00002","{prop} in {target} is required"),PROP_IS_INVALID:new G("001-00003","{prop} in {target} is invalid"),NOT_MATCH:new G("001-00004","{to_compare_prop} in {to_target} and {be_compare_prop} in {be_target} not match"),PROP_SHOULD_GT_FIELD:new G("001-00005","{prop} in {target} should greater than {field}"),PROP_SHOULD_GTE_FIELD:new G("001-00006","{prop} in {target} should greater than or equals to {field}"),PROP_SHOULD_LT_FIELD:new G("001-00007","{prop} in {target} should less than {field}"),PROP_SHOULD_LTE_FIELD:new G("001-00008","{prop} in {target} should less than or equals to {field}"),PROP_SHOULD_EQ_FIELD:new G("001-00009","{prop} in {target} should equals to {field}"),SHOULD_BE:new G("001-00010","{to_compare_prop} in {to_target} should be {be_compare_prop}"),SHOULD_NOT_BE:new G("001-00011","{to_compare_prop} in {to_target} should not be {be_compare_prop}"),NOT_EXIST:new G("001-00012","{prop} in {target} not exist"),SHOULD_NOT_EXIST:new G("001-00013","{prop} in {target} should not exist"),TRANSACTION_FEE_NOT_ENOUGH:new G("001-00014","Transaction fee is not enough, errorId {errorId}, minFee {minFee}"),NOT_IN_EXPECTED_RANGE:new G("001-00015","{prop} in {target} not in [{min}, {max}]"),OVER_LENGTH:new G("001-00016","{prop} in {target} is over length {limit}"),SHOULD_NOT_START_WITH_OR_END_WITH:new G("001-00017","{prop} in {target} should not start with or end with {field}"),NOT_A_STRING:new G("001-00018","{prop} in {target} not a string, value {value}"),NOT_A_IP:new G("001-00019","{prop} in {target} not a ip, value {value}"),NOT_A_IPV4:new G("001-00020","{prop} in {target} not a ipv4, value {value}"),NOT_A_IPV6:new G("001-00021","{prop} in {target} not a ipv6, value {value}"),NOT_A_LONGITUDE_LATITUDE:new G("001-00022","{prop} in {target} not a longitude-latitude, value {value}"),NOT_A_LONGITUDE:new G("001-00023","{prop} in {target} not a longitude, value {value}"),NOT_A_LATITUDE:new G("001-00024","{prop} in {target} not a latitude, value {value}"),NOT_A_ADDRESS:new G("001-00025","{prop} in {target} not a address, value {value}"),NOT_A_LOCATION_NAME:new G("001-00026","{prop} in {target} not a locationName, value {value}"),NOT_A_DNS:new G("001-00027","{prop} in {target} not a dns, value {value}"),NOT_A_EMAIL:new G("001-00028","{prop} in {target} not a email, value {value}"),NOT_A_URL:new G("001-00029","{prop} in {target} not a url, value {value}"),PERMISSION_DENIED:new G("001-00030","Permission denied at operation {operationName}"),SHOULD_NOT_INCLUDE:new G("001-00031","{prop} in {target} should not inclue {value}"),SHOULD_INCLUDE:new G("001-00032","{prop} in {target} should inclue {value}"),SHOULD_NOT_DUPLICATE:new G("001-00033","{prop} in {target} should not duplicate"),ALREADY_EXIST:new G("001-00034","{prop} in {target} already exist, errorId {errorId}"),GENESIS_DELEGATE_NOT_ENOUGH:new G("001-00035","Genesis delegate not enough, at least {expected}, actual {actual}"),PROP_SHOULD_BE_ARRAY:new G("001-00036","{prop} in {target} should be an array"),INVALID_BLOCK_GENERATOR:new G("001-00037","Invalid block generator, reason {reason}"),TRAN_POW_VERIFY_FAIL:new G("001-00038","Transaction's porf of work verify fail"),NOT_FOUND:new G("001-00039","{prop} not found"),TOO_LARGE:new G("001-00040","{prop} is too large, reason {reason}, errorId {errorId}"),PROP_LENGTH_SHOULD_LT_FIELD:new G("001-00041","{prop} length in {target} should less than {field}"),PROP_LENGTH_SHOULD_LTE_FIELD:new G("001-00042","{prop} length in {target} should less than or equals to {field}"),PROP_LENGTH_SHOULD_GT_FIELD:new G("001-00043","{prop} length in {target} should greater than {field}"),PROP_LENGTH_SHOULD_GTE_FIELD:new G("001-00044","{prop} length in {target} should greater than or equals to {field}"),PROP_LENGTH_SHOULD_EQ_FIELD:new G("001-00045","{prop} length in {target} should equals to {field}"),PROP_LENGTH_SHOULD_NOT_EQ_FIELD:new G("001-00046","{prop} length in {target} should not equals to {field}"),INVALID_TRANSACTION_BASE_TYPE:new G("001-00047","Invalid transaction base type: {base_type}"),INVALID_BLOCK_CONSTRUCTOR:new G("001-00048","Invalid block constructor: {name}"),INVALID_BLOCK_TYPE:new G("001-00049","Invalid block type: {type}"),CUSTOM_TRANS_VERIFY_FAIL:new G("001-00050","Custom transaction verify fail: {message}"),DISABLED_CREATE_TRANSACTION:new G("001-00051","Disabled create {trsName} Transaction"),DISABLED_INSERT_TRANSACTION:new G("001-00052","Disabled insert {trsName} Transaction"),TRANSACTION_IS_IN_UNCHANGABLE_STATE:new G("001-00053","Transaction is in unchangable state"),ASSETSTATISTIC_INDEX_ALREADY_IN_USE:new G("001-00054","AssetStatistic index: {index} already in use"),INVALID_SIGNATURE:new G("001-00055","Invalid {taskLabel} signature"),INVALID_SIGNSIGNATURE:new G("001-00056","Invalid {taskLabel} signSignature"),INVALID_BASE_TYPE:new G("001-00057","Invalid base type {base_type}"),UNREGISTERED_TRANSACTION_FACTORY:new G("001-00058","Unregistered TransactionFactory {factoryName}"),UNREGISTERED_TRANSACTION_BASE_TYPE:new G("001-00059","Unregistered Transaction base type {trs_base}"),UNREGISTERED_TRANSACTION_TYPE:new G("001-00060","Unregistered Transaction type {trs_key}"),INVALID_FROMAUTHSIGNATURE:new G("001-00061","Invalid {taskLabel} fromAuthSignature"),INVALID_FROMAUTHSIGNSIGNATURE:new G("001-00062","Invalid {taskLabel} fromAuthSignSignature"),INVALID_TOAUTHSIGNATURE:new G("001-00063","Invalid {taskLabel} toAuthSignature"),INVALID_TOAUTHSIGNSIGNATURE:new G("001-00064","Invalid {taskLabel} toAuthSignSignature"),INVALID_MACRO_INPUT_TYPE:new G("001-00065","Invalid macro input type: {type}"),ALREADY_EXPIRED:new G("001-00066","{prop} in {target} already expired"),PROP_LOSE:new G("001-11001","{prop} in {target} lose"),ACCOUNT_FROZEN:new G("001-11002","Account with address {address} was frozen, status {status}, errorId {errorId}"),TRANSACTION_SIGN_SIGNATURE_IS_REQUIRED:new G("001-11003","Transaction signSignature is required, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),TRANSACTION_SENDER_SECOND_PUBLICKEY_ALREADY_CHANGE:new G("001-11004","Transaction sender second secret have already change, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),TRANSACTION_SHOULD_NOT_HAVE_SENDER_SECOND_PUBLICKEY:new G("001-11005","Transaction should not have senderSecondPublicKey, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),TRANSACTION_SHOULD_NOT_HAVE_SIGN_SIGNATURE:new G("001-11006","Transaction should not have signSignature, signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),INVALID_TRANSACTION_APPLY_BLOCK_HEIGHT:new G("001-11007","Invalid transaction({signature}) apply block height, reason {reason}"),INVALID_TRANSACTION_EFFECTIVE_BLOCK_HEIGHT:new G("001-11008","Invalid transaction({signature}) effective block height, reason {reason}"),INVALID_TRANSACTION_FROM_MAGIC:new G("001-11009","Invalid transaction from magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),INVALID_TRANSACTION_TO_MAGIC:new G("001-11010","Invalid transaction to magic, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),INVALID_TRANSACTION_TIMESTAMP:new G("001-11011","Invalid transaction timestamp, reason {reason} signature {signature} senderId {senderId} applyBlockHeight {applyBlockHeight} type {type}"),DAPPID_IS_NOT_EXIST:new G("001-11012","DAppid is not exist, dappid {dappid}"),DAPPID_IS_ALREADY_EXIST:new G("001-11013","DAppid is already exist, dappid {dappid}, errorId {errorId}"),LOCATION_NAME_IS_NOT_EXIST:new G("001-11014","LocationName is not exist, locationName {locationName}, errorId {errorId}"),LOCATION_NAME_IS_ALREADY_EXIST:new G("001-11015","LocationName is already exist, locationName {locationName}, errorId {errorId}"),ENTITY_FACTORY_IS_NOT_EXIST:new G("001-11016","Entity factory is not exist, factoryId {factoryId}"),ENTITY_FACTORY_IS_ALREADY_EXIST:new G("001-11017","Entity factory is already exist, factoryId {factoryId}, errorId {errorId}"),ENTITY_IS_NOT_EXIST:new G("001-11018","Entity is not exist, entityId {entityId}"),ENTITY_IS_ALREADY_EXIST:new G("001-11019","Entity is already exist, entityId {entityId}, errorId {errorId}"),UNKNOWN_RANGE_TYPE:new G("001-11020","Unknow rangeType, rangeType {rangeType}"),INVALID_TRANSACTION_BYTE_LENGTH:new G("001-11021","Invalid transaction byte length, reason {reason}"),NEED_PURCHASE_DAPPID_BEFORE_USE:new G("001-11022","Need purchase dappid before use, dappid {dappid}"),NEED_VOTE_FOR_DAPPID_POSSESSOR_BFCORE_USE:new G("001-11023","Need vote for dappid possessor before use, dappid {dappid}, errorId {errorId}"),VERIFY_TRANSACTION_POW_OF_WORK_ERROR:new G("001-11024","Verify transaction pow of work error, errorId {errorId}, reason {reason}"),CAN_NOT_DELETE_LOCATION_NAME:new G("001-11025","Can not delete locationName {locationName}, reason {reason}"),SET_LOCATION_NAME_MANAGER_FIELD:new G("001-11026","Set locationName {locationName} manager field, reason {reason}, errorId {errorId}"),SET_LOCATION_NAME_RECORD_VALUE_FIELD:new G("001-11027","Set locationName {locationName} recordValue field, reason {reason}, errorId {errorId}"),ASSET_NOT_ENOUGH:new G("001-11028","Asset not enough, reason {reason}, errorId {errorId}"),ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH:new G("001-11029","Account remain equity not enough, reason {reason}, errorId {errorId}"),NOT_BEGIN_UNFROZEN_YET:new G("001-11030","Frozen asset is not begin to unfrozen yet, frozenId {frozenId}"),FROZEN_ASSET_EXPIRATION:new G("001-11031","Frozen asset is already expiration, frozenId {frozenId}"),UNFROZEN_TIME_USE_UP:new G("001-11032","Gift asset unfrozen time use up, frozenId {frozenId}"),USERNAME_ALREADY_EXIST:new G("001-11033","Username already exist, errorId {errorId}"),ACCOUNT_IS_ALREADY_AN_DELEGATE:new G("001-11034","Account with address {address} is already an delegate, errorId {errorId}"),ACCOUNT_IS_NOT_AN_DELEGATE:new G("001-11035","Account with address {address} is not an delegate, errorId {errorId}"),DELEGATE_IS_ALREADY_ACCEPT_VOTE:new G("001-11036","Delegate with address {address} is already accept vote"),DELEGATE_IS_ALREADY_REJECT_VOTE:new G("001-11037","Delegate with address {address} is already reject vote, errorId {errorId}"),FORBIDDEN:new G("001-11038","{prop} in {target} is forbidden"),ASSET_NOT_EXIST:new G("001-11039","Asset not exist, magic {magic} assetType {assetType}"),ACCOUNT_NOT_DAPPID_POSSESSOR:new G("001-11040","Account with address {address} not dappid {dappid} possessor, errorId {errorId}"),ACCOUNT_NOT_LOCATION_NAME_POSSESSOR:new G("001-11041","Account with address {address} not locationName {locationName} possessor, errorId {errorId}"),ACCOUNT_NOT_ENTITY_POSSESSOR:new G("001-11042","Account with address {address} not entityId {entityId} possessor, errorId {errorId}"),DAPPID_NOT_FROZEN:new G("001-11043","DAppid not frozen, dappid {dappid}"),DAPPID_ALREADY_FROZEN:new G("001-11044","DAppid already frozen, dappid {dappid}"),LOCATION_NAME_NOT_FROZEN:new G("001-11045","LocationName not frozen, locationName {locationName}"),LOCATION_NAME_ALREADY_FROZEN:new G("001-11046","LocationName already frozen, locationName {locationName}"),ENTITY_NOT_FROZEN:new G("001-11047","Entity not frozen, entityId {entityId}"),ENTITY_ALREADY_FROZEN:new G("001-11048","Entity already frozen, entityId {entityId}"),NO_NEED_TO_PURCHASE_SPECIAL_ASSET:new G("001-11049","No need to purchase asset, type {type} asset {asset}"),ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE:new G("001-11050","Only top level location name can exchange"),CAN_NOT_DESTROY_ENTITY:new G("001-11051","Can not destroy entityId {entityId}, reason {reason}"),ENTITY_ALREADY_DESTROY:new G("001-11052","Entity already destroy, entityId {entityId}"),ASSET_IS_ALREADY_MIGRATION:new G("001-11053","Asset is already migration, migrateCertificateId {migrateCertificateId}"),NOT_EXIST_OR_EXPIRED:new G("001-11054","{prop} in {target} not exist or expired"),NOT_EXPECTED_RELATED_TRANSACTION:new G("001-11055","Transaction with signature {signature} is not an expected related transaction"),CAN_NOT_SECONDARY_TRANSACTION:new G("001-11056","Can not secondary transaction, reason {reason}"),REGISTER_DELEGTE_QUOTA_FULL:new G("001-11057","The register delegate quota is full in round {round}"),DELEGATE_CAN_NOT_MIGRATE_ASSET:new G("001-11058","Delegate can not migrate asset"),MIGRATE_MAIN_ASSET_ONLY:new G("001-11059","You can only migrate main asset, {assetType} is not main asset {mainAsset}"),CAN_NOT_CARRY_SECOND_PUBLICKEY:new G("001-11060","Can not carry second publicKey"),CAN_NOT_CARRY_SECOND_SIGNATURE:new G("001-11061","Can not carry second signature"),VOTE_RECENTLY:new G("001-11062","Account participate vote recently"),POSSESS_FROZEN_ASSET:new G("001-11063","Account possess frozen asset"),NEED_EMIGRATE_TOTAL_ASSET:new G("001-11064","Need emigrate total asset, address {address}"),POSSESS_ASSET_EXCEPT_CHAIN_ASSET:new G("001-11065","Account possess asset expect chain asset"),POSSESS_FROZEN_ASSET_EXCEPT_CHAIN_ASSET:new G("001-11066","Account possess frozen asset expect chain asset"),ACCOUNT_CAN_NOT_BE_FROZEN:new G("001-11067","Account with address {address} can not be frozen, reason {reason}, errorId {errorId}"),TRUST_MAIN_ASSET_ONLY:new G("001-11068","You can only trust main asset, {assetType} is not main asset {mainAsset}"),ACCOUNT_ALREADY_HAVE_USERNAME:new G("001-11069","Account already has a username, errorId {errorId}"),ISSUE_ENTITY_TIMES_USE_UP:new G("001-11070","Issue entity times use up, entityFactory {entityFactory}"),ASSET_ALREADY_EXIST:new G("001-11071","Asset already exist, magic {magic} assetType {assetType}"),FROZEN_ASSET_NOT_EXIST_OR_EXPIRED:new G("001-11072","Frozen asset with frozenAddress {frozenAddress} signature {signature} assetType {assetType} in blockChain not exist or expired"),NOT_ENOUGH_ISSUE_ENTITY_TIMES:new G("001-11073","Not enough issue entity times, entityFactory {entityFactory}"),NOT_BEGIN_RESOLVE_YET:new G("001-11074","Promise is not begin to resolve yet, promiseId {promiseId}"),CERTIFICATE_IS_NOT_EXIST:new G("001-11075","Certificate is not exist, certificateId {certificateId}"),CERTIFICATE_IS_ALREADY_EXIST:new G("001-11076","Certificate is already exist, certificateId {certificateId}, errorId {errorId}"),CAN_NOT_DESTROY_CERTIFICATE:new G("001-11077","Can not destroy certificate, certificateId {certificateId}, reason {reason}"),ACCOUNT_NOT_CERTIFICATE_POSSESSOR:new G("001-11078","Account with address {address} not certificate {certificateId} possessor, errorId {errorId}"),CERTIFICATE_NOT_FROZEN:new G("001-11079","Certificate not frozen, certificateId {certificateId}"),CERTIFICATE_ALREADY_FROZEN:new G("001-11080","Certificate already frozen, certificateId {certificateId}"),CERTIFICATE_ALREADY_DESTROY:new G("001-11081","Certificate already destroy, certificateId {certificateId}"),BLOCK_SIGN_SIGNATURE_IS_REQUIRED:new G("001-12001","Block signSignature is required, signature {signature} generatorAddress {generatorAddress} height {height}"),BLOCK_GENERATOR_SECOND_PUBLICKEY_ALREADY_CHANGE:new G("001-12002","Block generator second secret have already change, signature {signature} generatorAddress {generatorAddress} height {height}"),BLOCK_SHOULD_NOT_HAVE_GENERATOR_SECOND_PUBLICKEY:new G("001-12003","Block should not have generatorSecondPublicKey, signature {signature} generatorAddress {generatorAddress} height {height}"),BLOCK_SHOULD_NOT_HAVE_SIGN_SIGNATURE:new G("001-12004","Block should not have signSignature, signature {signature} generatorAddress {generatorAddress} height {height}"),OUT_OF_RANGE:new G("001-12005","{variable} out of range"),FAILED_TO_FIND_NEAREST_SAME_BLOCK_IN_ONE_ROUND:new G("001-12006","Failed to find nearest same block in one round, should not happen"),GENESIS_BLOCK_NOT_MATCH:new G("001-12007","GenesisBlock not match, the signature of genesisBlock and synchronized peer's genesisBlock's signature not equal"),FAILED_TO_GET_BLOCKS_BY_RANGE:new G("000-12008","Falied to get blocks by range({minHeight}~{maxHeight})"),INVALID_PARAMS:new G("001-22001","Invalid params: {params}"),INVALID_PARAMS_FIELD:new G("001-22002","Invalid params field: {field}"),GENESIS_BLOCK_MAYBE_NO_EQUAL:new G("001-22003","GenesisBlock maybe no equal"),INVALID_QUERYBLOCKARG_QUERY_PARAMS:new G("001-22004","Invalid QueryBlockArg query params, no query conditions"),QUERY_BLOCK_FROM_PEER_TIMEOUT:new G("001-22005","QueryBlock ({query}) from peer({peerId}) timeout"),REQID_REUSE:new G("001-22006","ReqId reuse"),CHAINCHANNEL_CLOSED:new G("001-22007","chainChannel closed"),REFUSE_RESPONSE_QUERY_TRANSACTION:new G("001-22008","Refuse response query transaction"),REFUSE_RESPONSE_INDEX_TRANSACTION:new G("001-22009","Refuse response index transaction"),REFUSE_RESPONSE_DOWNLOAD_TRANSACTION:new G("001-22010","Refuse response download transaction"),REFUSE_RESPONSE_BROADCAST_TRANSACTION:new G("001-22011","Refuse response broadcast transaction"),REFUSE_RESPONSE_QUERY_BLOCK:new G("001-22012","Refuse response query block"),REFUSE_RESPONSE_BROADCAST_BLOCK:new G("001-22013","Refuse response broadcast block"),MESSAGE_TYPE_ERROR:new G("001-22014","Message type error"),ONMESSAGE_GET_INVALID_REQ_ID:new G("001-22015","OnMessage get invalid req_id: {req_id}"),REQUEST_LIMIT:new G("001-22016","Request limit"),INVALID_MESSAGE_CMD:new G("001-22017","Invalid message cmd"),CHAINCHANNEL_TIMEOUT:new G("001-22018","ChainChannel Timeout, cmd {cmd}"),TASK_ABORT:new G("001-22019","Task {task_id} abort because the free chainChannel size is zero"),REFUSE_RESPONSE_OPEN_BLOB:new G("001-22020","Refuse response open blob"),REFUSE_RESPONSE_READ_BLOB:new G("001-22021","Refuse response read blob"),REFUSE_RESPONSE_CLOSE_BLOB:new G("001-22022","Refuse response close blob"),BLOB_ALGORITHM_IS_INVALID:new G("001-23001","blob({hash}) algorithm({algorithm}) is invalid"),FAIL_TO_DOWNLOAD_BLOB:new G("001-23002","Fail to download blob({hash}) size({size})")},CT=new Map,Zl=Error.captureStackTrace?i=>{const e={stack:""};return Error.captureStackTrace(e,i),e.stack}:Function("f",`
    let deep = 0;
    let caller = arguments.callee;
    do {
      if (caller.caller === f) {
        break;
      }
      deep += 1;
      caller = caller.caller;
      if (caller === null) {
        break;
      }
    } while (true);
    const stack = new Error().stack || "";
    const stackLineLine = stack.split('\\n');
    stackLineLine.splice(1, deep);
    return stackLineLine.join('\\n');
  `);class Ku extends Error{get name(){return this.constructor.name}static call(e,t){if(!(e instanceof Ku))throw new TypeError("please use new keyword to create CustomError instance.");return e.stack=Zl(e.constructor),e.message=t||"",e}}const Tf=()=>{},w_=Symbol("cog");function IE(i){for(const[e,t]of Object.entries(Object.getOwnPropertyDescriptors(i))){const r=t.get;r&&!r[w_]&&(t.get=()=>{const n=r();return Object.defineProperty(i,e,{value:n}),n},t.get[w_]=!0,Object.defineProperty(i,e,t))}return i}const TE=new Map;var RT=(i=>(i.BLOCKER="blocker",i.CRITICAL="critical",i.MAJOR="major",i.MINOR="minor",i))(RT||{});class nt extends Ku{constructor(e="",t,r,n){super(t?e instanceof G?e.build(t):e.replace(/\{([^\\]+?)\}/g,(a,p)=>t[p]??a):e instanceof G?e.message:e),this.detail=t;const s=this.constructor,{ERROR_CODE_MAP:o}=s;Object.defineProperties(this,{detail:{value:t,enumerable:!1,writable:!1},sourceMessage:{value:e,enumerable:!1,writable:!1},type:{value:s.TYPE,enumerable:!1,writable:!1},PLATFORM:{value:s.PLATFORM,enumerable:!1,writable:!1},CHANNEL:{value:s.CHANNEL,enumerable:!1,writable:!1},BUSINESS:{value:s.BUSINESS,enumerable:!1,writable:!1},MODULE:{value:s.MODULE,enumerable:!1,writable:!1},FILE:{value:s.FILE,enumerable:!1,writable:!1},CODE:{value:r??(e instanceof G?e.code:o.get(e)||o.get("unknown error")||""),enumerable:!1,writable:!1},SEVERIFY:{value:n||"major",enumerable:!1,writable:!1}})}get name(){return this.constructor.TYPE}static is(e){return!(!e||e.type!==this.TYPE)}}function PT(i,e,t,r,n,s){function o(a){return a.PLATFORM=i,a.CHANNEL=e,a.BUSINESS=t,a.MODULE=r,a.FILE=n,a.ERROR_CODE_MAP=s,Object.freeze(a),a}return IE({getException:o,get Exception(){const a=nt;return o(class extends a{})},get OutOfRangeException(){var a;return o(((a=class extends nt{}).TYPE="OutOfRangeException",a))},get ArgumentException(){var a;return o(((a=class extends nt{}).TYPE="ArgumentException",a))},get ArgumentIllegalException(){var a;return o(((a=class extends nt{}).TYPE="ArgumentIllegalException",a))},get ArgumentFormatException(){var a;return o(((a=class extends nt{}).TYPE="ArgumentFormatException",a))},get NoFoundException(){var a;return o(((a=class extends nt{}).TYPE="NoFoundException",a))},get ResponseException(){var a;return o(((a=class extends nt{}).TYPE="ResponseException",a))},get IOException(){var a;return o(((a=class extends nt{}).TYPE="IOException",a))},get NetworkIOException(){var a;return o(((a=class extends nt{}).TYPE="NetworkIOException",a))},get BusyIOException(){var a;return o(((a=class extends nt{}).TYPE="BusyIOException",a))},get DatebaseIOException(){var a;return o(((a=class extends nt{}).TYPE="DatebaseIOException",a))},get InterruptedException(){var a;return o(((a=class extends nt{}).TYPE="InterruptedException",a))},get IllegalStateException(){var a;return o(((a=class extends nt{}).TYPE="IllegalStateException",a))},get TimeOutException(){var a;return o(((a=class extends nt{}).TYPE="TimeOutException",a))},get BusyException(){var a;return o(((a=class extends nt{}).TYPE="BusyException",a))},get ConsensusException(){var a;return o(((a=class extends nt{}).TYPE="ConsensusException",a))},get AbortException(){var a;return o(((a=class extends nt{}).TYPE="AbortException",a))},get RefuseException(){var a;return o(((a=class extends nt{}).TYPE="RefuseException",a))}})}nt.TYPE="Exception",nt.PLATFORM="",nt.CHANNEL="",nt.BUSINESS="",nt.MODULE="",nt.FILE="",nt.CODE="",nt.SEVERIFY="major",nt.ERROR_CODE_MAP=TE,typeof Error.stackTraceLimit=="number"&&(Error.stackTraceLimit+=3);const aa=1e3,ca=60*aa,pa=60*ca,Wi=24*pa,BT=7*Wi,MT=365.25*Wi;function vT(i,e={}){switch(typeof i){case"string":if(i.length>0)return LT(i);break;case"number":if(isFinite(i))return e.long?kT(i):DT(i)}throw new Error(`val is not a non-empty string or a valid number. val=${JSON.stringify(i)}`)}function LT(i){const e=String(i);if(e.length>100)return;const t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;const r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*MT;case"weeks":case"week":case"w":return r*BT;case"days":case"day":case"d":return r*Wi;case"hours":case"hour":case"hrs":case"hr":case"h":return r*pa;case"minutes":case"minute":case"mins":case"min":case"m":return r*ca;case"seconds":case"second":case"secs":case"sec":case"s":return r*aa;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}function DT(i){const e=Math.abs(i);return e>=Wi?`${Math.round(i/Wi)}d`:e>=pa?`${Math.round(i/pa)}h`:e>=ca?`${Math.round(i/ca)}m`:e>=aa?`${Math.round(i/aa)}s`:`${i}ms`}function kT(i){const e=Math.abs(i);return e>=Wi?uh(i,e,Wi,"day"):e>=pa?uh(i,e,pa,"hour"):e>=ca?uh(i,e,ca,"minute"):e>=aa?uh(i,e,aa,"second"):`${i} ms`}function uh(i,e,t,r){const n=e>=1.5*t;return`${Math.round(i/t)} ${r}${n?"s":""}`}var b_,N_,x_,Jr;function HT(i){return i.source.slice(1,-1).replace(/\.\*\?$/,"*").replace(/\\/g,"")}function O_(i){const e=i[0]==="-";return{type:e?"disable":"enable",source:i,regexp:new RegExp("^"+i.substr(e?1:0).replace(/\*/g,".*?")+"$")}}function FT(i){return(i.type==="disable"?"-":"")+HT(i.regexp)}class VT{constructor(){this.namespaceFilters=[],this._levelFilter=e=>!0,this._createdDebugCache=new wt(e=>new bc(e,this)),this.setNamespaceFilter(this.load())}getNamespaceFilter(){return this.namespaceFilters.map(e=>e.source)}_resetInstancesEnabled(){for(const e of this._createdDebugCache.values()){e.forceSetEnabled(this.isEnabled(e.namespace,e.level));for(const t of e.scopePrinterMap.keys())t.enabled=this.levelFilter(t.level)}}setNamespaceFilter(e){e=typeof e=="string"?e:e.join(","),this.namespaceFilters.length=0;const t=[...new Set(e.split(/[\s,]+/))];for(const r of t)r&&this.namespaceFilters.push(O_(r));this._resetInstancesEnabled(),this.save(t.join(","))}addNamespaceFilter(e,t){this.removeNamespaceFilter(e),e=typeof e=="string"?O_(e):e,t===void 0||t>this.namespaceFilters.length-1||t<0?this.namespaceFilters.push(e):this.namespaceFilters.splice(t,0,e),this._resetInstancesEnabled(),this.save(this.getNamespaceFilter().join(","))}removeNamespaceFilter(e){const t=r=>r>=0&&r<this.namespaceFilters.length&&(this.namespaceFilters.splice(r,1),this._resetInstancesEnabled(),this.save(this.getNamespaceFilter().join(",")),!0);return typeof e=="number"?t(e):typeof e=="string"?t(this.namespaceFilters.findIndex(r=>r.source===e)):t(this.namespaceFilters.indexOf(e))||this.removeNamespaceFilter(FT(e))}get levelFilter(){return this._levelFilter}set levelFilter(e){this._levelFilter=e,this._resetInstancesEnabled()}isEnabled(e,t){if(!this.levelFilter(t))return!1;if(e[e.length-1]==="*")return!0;for(let r=this.namespaceFilters.length-1;r>=0;r--){const n=this.namespaceFilters[r];if(n.regexp.test(e))return n.type==="enable"}return!1}selectColor(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return this.colors[Math.abs(t)%this.colors.length]}getCreatedDebugs(){return this._createdDebugCache.values()}create(e){return this._createdDebugCache.forceGet(e)}destroy(e){return this._createdDebugCache.delete(e)}}class bc{constructor(e,t,r){this.namespace=e,this._creater=t,this.__prev=0,this.__curr=0,this._scope=new wt(a=>{const p=wt.from({creater:l=>({id:this._scopeIdAcc++,color:a,level:l,enabled:this._creater.levelFilter(l)}),afterDelete:()=>{p.size===0&&this._scope.delete(a)}});return p}),this._scopeIdAcc=0,this.scopePrinterMap=wt.from({creater:a=>this._printerBuilder(a)}),this.$enableDefaultFormatter=!1,typeof t.init=="function"&&t.init(this);let n=0,s=!1,o=!1;return r&&(r.enableTime!==void 0&&(s=r.enableTime),r.enableDuration!==void 0&&(o=r.enableDuration),r.level!==void 0&&(n=r.level)),this._config={useColors:this._creater.canUseColors(),enabled:this._creater.isEnabled(this.namespace,n),color:this._creater.selectColor(this.namespace),level:n,enableTime:s,enableDuration:o},this}get useColors(){return this._config.useColors}forceSetUseColors(e){this._config.useColors=e}get enabled(){return this._config.enabled}forceSetEnabled(e){this._config.enabled=e}get color(){return this._config.color}get level(){return this._config.level}get enableTime(){return this._config.enableTime}get enableDuration(){return this._config.enableDuration}getDiff(){return this._curr-this._prev}get _prev(){return this.__prev}get _curr(){return this.__curr||(this.__curr=Date.now())}_resetDiff(){this.__prev=this.__curr,this.__curr=0}getDuration(){return vT(this.getDiff())}get _dater(){return new Date}getTime(){return this._dater.setTime(Date.now()),this._dater.toLocaleTimeString()}destroy(){this._config.enabled=!1,this._creater.destroy(this.namespace)}get print(){return this.scopePrinterMap.forceGet(this._config)}createPrinter(e,t){const r=this._scope.forceGet(e).forceGet(t);return this.scopePrinterMap.forceGet(r)}deletePrinter(e,t){const r=this._scope.tryGet(e);if(r){const n=r.tryGet(t);if(n)return r.delete(t),this.scopePrinterMap.delete(n)}return!1}_printerBuilder(e){const{_creater:t}=this,r=()=>e.enabled&&this.enabled,n=(...s)=>{if(!r())return;this._resetDiff();let o=typeof s[0]!="string"?"%O":s.shift();if(this.$enableDefaultFormatter){let p=0;o=o.replace(/%([a-zA-Z%])/g,(l,f)=>{if(l==="%%")return l;const g=t.formatters[f];return typeof g=="function"&&(l=g(this,s[p]),s.splice(p,1),p--),p++,l})}const a=[o,...s];t.formatArgs(this,a,e),t.printArgs(this,a,e)};return Object.defineProperty(n,"enabled",{get:r}),n}}h([ne,u("design:type",Object),u("design:paramtypes",[])],bc.prototype,"_dater",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],bc.prototype,"print",null),h([$e,u("design:type",Function),u("design:paramtypes",[Object,typeof(b_=typeof BFChainUtilLogger<"u"&&BFChainUtilLogger.DebugLevel)=="function"?b_:Object]),u("design:returntype",typeof(N_=typeof BFChainUtilLogger<"u"&&BFChainUtilLogger.Pinter)=="function"?N_:Object)],bc.prototype,"createPrinter",null),h([$e,u("design:type",Function),u("design:paramtypes",[Object,typeof(x_=typeof BFChainUtilLogger<"u"&&BFChainUtilLogger.DebugLevel)=="function"?x_:Object]),u("design:returntype",Boolean)],bc.prototype,"deletePrinter",null),function(i){i[i.log=0]="log",i[i.info=1]="info",i[i.warn=2]="warn",i[i.trace=3]="trace",i[i.success=4]="success",i[i.error=5]="error"}(Jr||(Jr={}));class Rs extends VT{constructor(){super(...arguments),this.formatters={j(e,t){try{return JSON.stringify(t)}catch(r){return"[UnexpectedJSONParseError]: "+(r instanceof Error?r.message:r)}},t(e,t){let r;switch(typeof t){case"string":case"number":r=t;break;default:r=t instanceof Date?t:String(t)}return new Date(r).toLocaleString()},s:(e,t)=>String(t),d:(e,t)=>Number(t).toString()}}get colorTypeName(){return"browser"}get colors(){return"0000CC 0000FF 0033CC 0033FF 0066CC 0050c8 006080 005c99 006800 00681a 006733 00654c 006363 006179 3300CC 3300FF 3333CC 3232fb 2b55aa 274ec4 205f7e 1e5b97 1a6700 1a671a 196633 19644b 196262 186078 6600CC 6500fd 6633CC 5c2ee6 326500 326419 9100c2 8300da 842cb1 7928ca 496100 486018 b60000 b4002d b00058 a9007e 9f009f 9500ba a72a00 a62a2a a32951 9d2776 952595 8c23af 8c4600 8b4523 715400 70541c 5c5c00 5b5b17 b50024 b20047 ad0068 a70086 ac2200 ab2222 a82243 a42163 9f207f 981e98 973d00 973c1e 804d00 804d1a 6c5600 6c5616".split(" ").map(e=>"#"+e)}get storage(){try{return localStorage}catch{}}load(){let e;return e=this.storage&&this.storage.getItem("debug"),!e&&typeof process<"u"&&"env"in process&&(e={}.DEBUG),e||""}save(e){this.storage&&(e?this.storage.setItem("debug",e):this.storage.removeItem("debug"))}canUseColors(){return!0}static _getHtmlNamespace(e){let t=this._NamespaceWithToHtmlCache.get(e);return t===void 0&&(t=new this._namespaceCtor(e.namespace),this._NamespaceWithToHtmlCache.set(e,t)),t}static _getHtmlDuration(e){return new this._durationCtor(e)}formatArgs(e,t,r=e){const n="color: "+r.color;if(e.useColors){const s=[],o=Rs._getHtmlNamespace(e);o.buildHTML(n),e.enableTime?(t[0]=`[%s] %o %c${t[0]}`,s[s.length]=e.getTime(),s[s.length]=o):(t[0]=`%o ${t[0]}`,s[s.length]=o),t.splice(1,0,...s)}else t[0]=`${e.namespace} ${t[0]}`,e.enableTime&&(t[0]=`[${e.getTime()}] ${t[0]}`);if(e.enableDuration)if(e.useColors){const s=Rs._getHtmlDuration(e.getDiff());s.buildHTML(n),t[t.length]=s}else t.push(`+${e.getDuration()}`);return t}printArgs(e,t,r=e){switch(r.level){case Jr.log:console.log(...t);break;case Jr.info:console.info(...t);break;case Jr.warn:console.warn(...t);break;case Jr.trace:console.trace(...t);break;case Jr.success:console.info(...t);break;case Jr.error:console.error(...t)}}}Rs._NamespaceWithToHtmlCache=new WeakMap,Rs._namespaceCtor=new Function(`return class Namespace extends String {
    buildHTML(style) {
      if ((this.buildHTML.tmpStyle = style)) {
        this.buildHTML.tmpStyle = style;
        this.buildHTML.tmpHTML = \`<i class="logger-namespace" style="\${style}">\${this}ms</i>\`;
      }
    }
    toHTML() {
      return this.buildHTML.tmpHTML || this.toString();
    }
  }`)(),Rs._durationCtor=new Function(`return class Duration extends Number {
      buildHTML(style) {
        if ((this.buildHTML.tmpStyle = style)) {
          this.buildHTML.tmpStyle = style;
          this.buildHTML.tmpHTML = \`<i class="logger-duration" style="\${style}">+\${this}</i>\`;
        }
      }
      toHTML() {
        return this.buildHTML.tmpHTML || this.toString();
      }
    }`)(),h([ne,u("design:type",Object),u("design:paramtypes",[])],Rs.prototype,"colors",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Rs.prototype,"storage",null);const $T=()=>new Rs,UT=$T(),vo={log:"inherit",info:"inherit",trace:"inherit",success:"inherit",warn:"inherit",error:"inherit"};function Lo(i,e,t){const r=UT.create(i);return e===void 0?r.forceSetUseColors(!1):r.forceSetUseColors(!0),r.createPrinter(e==="inherit"?r.color:e,t)}function KT(i){return IE({get log(){return Lo(i,vo.log,Jr.log)},get info(){return Lo(i,vo.info,Jr.info)},get warn(){return Lo(i,vo.warn,Jr.warn)},get success(){return Lo(i,vo.success,Jr.success)},get trace(){return Lo(i,vo.trace,Jr.trace)},get error(){return Lo(i,vo.error,Jr.error)}})}const SE=!!(typeof process<"u"&&process&&process.versions&&process.versions.node),GT=typeof process<"u"&&(process.platform==="win32"||/^(msys|cygwin)$/.test(process.env&&{}.OSTYPE)),rm=(i,e)=>{try{return new Function(`return typeof ${i} === "${e}"`)()}catch{return!1}},wE=rm("cordova","object"),eh=rm("navigator","object"),zT=eh&&/Android/i.test(navigator.userAgent),jT=eh&&/iPhone|iPod|iPad/i.test(navigator.userAgent),nm=eh&&rm("document","object"),bE=eh&&!nm,Cs={getGlobalFlag(i,e=""){const t=this.global();return t[i]||t.process&&t.process.env&&t.process.env[i]||t.location&&t.location.href&&new URL(t.location.href).searchParams.get(i)||t.localStorage&&t.localStorage.getItem(i)||e},global(){const i=typeof globalThis=="object"?globalThis:typeof self=="object"?self.globalThis=self:typeof global=="object"?global.globalThis=global:Function("return this")();return this.global=()=>i,i},platformName(){if(SE)return"Nodejs";const i=zT?"Android":jT?"IOS":"unknown";return wE?"Cordova-"+i:nm?"WebMaster-"+i:bE?"WebWorker-"+i:"UNKNOWN"},getChannel:()=>"UNKNOWN",getBusiness:()=>"UNKNOWN"};var C_,Cc;function JT(i,e,t,r,n,s){let o=`${e.toLowerCase()}-${t.toLowerCase()}`;r&&(o+=`:${r}`),n&&(o+=`/${n}`);const a=KT(o),p=PT(i,e,t,r,n,s);return new Proxy({},{get:(l,f)=>l[f]||a[f]||p[f]})}function YT(i){const e=typeof i.platform=="string"?i.platform:Cs.getGlobalFlag("PLATFORM")||Cs.platformName(),t=typeof i.platform=="string"?i.platform:Cs.getGlobalFlag("CHANNEL")||Cs.getChannel(),r=typeof i.platform=="string"?i.platform:Cs.getGlobalFlag("BUSINESS")||Cs.getBusiness();return function(n,s,o){return JT(o.platformName||e,o.channelName||t,o.businessName||r,n,s,o.errorCodeMap)}}(function(i){i.PLATFORM="exception.platform",i.CHANNEL="exception.channel",i.BUSINESS="exception.business"})(Cc||(Cc={}));let Qo=class{constructor(i){this.moduleMap=i,this.platformName=void 0,this.channelName=void 0,this.businessName=void 0,this.exceptionGeneratorDefiner=YT({platform:this.platformName,channel:this.channelName,business:this.businessName})}};h([J(Cc.PLATFORM,{dynamics:!0,optional:!0}),u("design:type",String)],Qo.prototype,"platformName",void 0),h([J(Cc.CHANNEL,{dynamics:!0,optional:!0}),u("design:type",String)],Qo.prototype,"channelName",void 0),h([J(Cc.BUSINESS,{dynamics:!0,optional:!0}),u("design:type",String)],Qo.prototype,"businessName",void 0),Qo=h([j("bfchain-util:custom-exception",{singleton:!0}),u("design:paramtypes",[typeof(C_=et!==void 0&&et)=="function"?C_:Object])],Qo);const QT=Ot(Qo);function NE(i,e,t){return QT.exceptionGeneratorDefiner(i,e,Object.assign({errorCodeMap:TE,businessName:"util"},t))}let xE=class extends nt{};xE.TYPE="IdempotentException";function re(i,e){const t=NE(i,e,{errorCodeMap:CT,businessName:"core"});let r;return Object.create(t,{IdempotentException:{get(){return r??(r=t.getException(xE))}}})}var Gu;const{ArgumentFormatException:Sf,error:Tx,IllegalStateException:WT}=re("MODEL","transactionModel");var H;(function(i){i.SIGNATURE="BSE-01",i.DELEGATE="BSE-02",i.VOTE="BSE-03",i.USERNAME="BSE-04",i.ACCEPT_VOTE="BSE-05",i.REJECT_VOTE="BSE-06",i.DAPP="WOD-00",i.DAPP_PURCHASING="WOD-01",i.REGISTER_CHAIN="WOD-02",i.MARK="EXT-00",i.ISSUE_ASSET="AST-00",i.TRANSFER_ASSET="AST-01",i.DESTROY_ASSET="AST-02",i.GIFT_ASSET="AST-03",i.GRAB_ASSET="AST-04",i.TRUST_ASSET="AST-05",i.SIGN_FOR_ASSET="AST-06",i.EMIGRATE_ASSET="AST-07",i.IMMIGRATE_ASSET="AST-08",i.TO_EXCHANGE_ASSET="AST-09",i.BE_EXCHANGE_ASSET="AST-10",i.TO_EXCHANGE_SPECIAL_ASSET="AST-11",i.BE_EXCHANGE_SPECIAL_ASSET="AST-12",i.LOCATION_NAME="LNS-00",i.SET_LNS_RECORD_VALUE="LNS-01",i.SET_LNS_MANAGER="LNS-02",i.ISSUE_ENTITY_FACTORY="ETY-00",i.ISSUE_ENTITY="ETY-01",i.DESTROY_ENTITY="ETY-02",i.ISSUE_ENTITY_FACTORY_V1="ETY-03",i.ISSUE_ENTITY_MULTI="ETY-04",i.TRANSFER_ANY="AST-13",i.GIFT_ANY="AST-14",i.GRAB_ANY="AST-15",i.TO_EXCHANGE_ANY="ECA-00",i.BE_EXCHANGE_ANY="ECA-01",i.TO_EXCHANGE_ANY_MULTI="ECA-02",i.BE_EXCHANGE_ANY_MULTI="ECA-03",i.TO_EXCHANGE_ANY_MULTI_ALL="ECA-04",i.BE_EXCHANGE_ANY_MULTI_ALL="ECA-05",i.CUSTOM="CUS-00",i.MULTIPLE="MTP-00",i.PROMISE="PMS-00",i.PROMISE_RESOLVE="PMS-01",i.MACRO="MAC-00",i.MACRO_CALL="MAC-01",i.ISSUE_CERTIFICATE="CRT-00",i.DESTROY_CERTIFICATE="CRT-01"})(H||(H={}));const je=(()=>{const i=new Map,e=new Map;for(const n in H){const s=H[n];e.set(n,s),i.set(s,n)}const t=new Map,r=new Map;return[[H.USERNAME,wp],[H.SIGNATURE,bp],[H.DELEGATE,Np],[H.VOTE,xp],[H.ACCEPT_VOTE,Op],[H.REJECT_VOTE,Cp],[H.DAPP,Rp],[H.DAPP_PURCHASING,Pp],[H.MARK,Bp],[H.ISSUE_ASSET,Mp],[H.DESTROY_ASSET,Lp],[H.TRANSFER_ASSET,vp],[H.TO_EXCHANGE_ASSET,Dp],[H.BE_EXCHANGE_ASSET,kp],[H.GIFT_ASSET,oa],[H.GRAB_ASSET,Hp],[H.TRUST_ASSET,Fp],[H.SIGN_FOR_ASSET,Vp],[H.EMIGRATE_ASSET,$p],[H.IMMIGRATE_ASSET,Up],[H.TO_EXCHANGE_SPECIAL_ASSET,Kp],[H.BE_EXCHANGE_SPECIAL_ASSET,Gp],[H.LOCATION_NAME,zp],[H.SET_LNS_RECORD_VALUE,Jp],[H.SET_LNS_MANAGER,jp],[H.ISSUE_ENTITY_FACTORY,Yp],[H.ISSUE_ENTITY_FACTORY_V1,Qp],[H.ISSUE_ENTITY,Wp],[H.DESTROY_ENTITY,qp],[H.TRANSFER_ANY,Xp],[H.GIFT_ANY,Zp],[H.GRAB_ANY,el],[H.TO_EXCHANGE_ANY,tl],[H.BE_EXCHANGE_ANY,rl],[H.ISSUE_ENTITY_MULTI,nl],[H.TO_EXCHANGE_ANY_MULTI,sl],[H.BE_EXCHANGE_ANY_MULTI,il],[H.TO_EXCHANGE_ANY_MULTI_ALL,ol],[H.BE_EXCHANGE_ANY_MULTI_ALL,al],[H.ISSUE_CERTIFICATE,cl],[H.DESTROY_CERTIFICATE,pl]].forEach(([n,s])=>{t.set(n,s),r.set(s,n)}),{VK:i,KV:e,VM:t,MV:r,trsTypeToV(n){const s=n.indexOf("-",n.indexOf("-")+1);return n.substr(s+1)}}})(),wf=new WeakMap;let qi=Gu=class extends Y{get transaction(){let e=wf.get(this._trs_bytes);if(!e){const t=je.VM.get(this._trs_base_type);if(!t)throw new Sf(c.INVALID_TRANSACTION_BASE_TYPE,{base_type:this._trs_base_type});e=t.decode(this._trs_bytes),wf.set(this._trs_bytes,Object.freeze(e))}return e}set transaction(e){const t=je.trsTypeToV(e.type);if(!je.VK.has(t))throw new Sf(c.INVALID_TRANSACTION_BASE_TYPE,{base_type:t});if(Object.isFrozen(this))throw new WT(c.TRANSACTION_IS_IN_UNCHANGABLE_STATE);this._trs_base_type=t,this._trs_bytes=new Uint8Array(e.constructor.encode(e).finish()),Object.isFrozen(e)&&wf.set(this._trs_bytes,e)}static fromObject(e){const t=super.fromObject(e);if(e!==t){const r=e.transaction;if(r)if(r instanceof Y)t.transaction=r;else{const n=r.type;if(n){const s=je.trsTypeToV(n),o=je.VM.get(s);if(!o)throw new Sf(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.transaction=o.fromObject(r)}}}return t}toJSON(){return{transaction:this.transaction.toJSON()}}};qi.INC=1;h([A.d(Gu.INC++,"string"),u("design:type",String)],qi.prototype,"_trs_base_type",void 0);h([A.d(Gu.INC++,"bytes"),u("design:type",Uint8Array)],qi.prototype,"_trs_bytes",void 0);qi=Gu=h([v.d("SomeTransactionModel")],qi);var sc,zu,ki,jh;(function(i){i[i.SENDER=0]="SENDER",i[i.RECIPIENT=1]="RECIPIENT",i[i.ENTITY_FACTORY_APPLICANT=2]="ENTITY_FACTORY_APPLICANT",i[i.ENTITY_FACTORY_POSSESSOR=3]="ENTITY_FACTORY_POSSESSOR",i[i.ENTITY_APPLICANT=4]="ENTITY_APPLICANT",i[i.ENTITY_POSSESSOR=5]="ENTITY_POSSESSOR"})(jh||(jh={}));let Yn=sc=class extends Y{toJSON(){return{accountType:this.accountType,sourceChainMagic:this.sourceChainMagic,assetType:this.assetType,assetPrealnum:this.assetPrealnum}}getBytes(){const t=Object.create(this,{});return this.$type.encode(t).finish()}};Yn.INC=1;h([A.d(sc.INC++,"uint32"),u("design:type",Number)],Yn.prototype,"accountType",void 0);h([A.d(sc.INC++,"string"),u("design:type",String)],Yn.prototype,"sourceChainMagic",void 0);h([A.d(sc.INC++,"string"),u("design:type",String)],Yn.prototype,"assetType",void 0);h([A.d(sc.INC++,"string"),u("design:type",String)],Yn.prototype,"assetPrealnum",void 0);h([Ys,u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",void 0)],Yn.prototype,"getBytes",null);Yn=sc=h([v.d("TransactionAssetChangeModel")],Yn);let Xi=zu=class extends Y{toJSON(){return{remainAssetPrealnum:this.remainAssetPrealnum,frozenMainAssetPrealnum:this.frozenMainAssetPrealnum}}};Xi.INC=1;h([A.d(zu.INC++,"string"),u("design:type",String)],Xi.prototype,"remainAssetPrealnum",void 0);h([A.d(zu.INC++,"string"),u("design:type",String)],Xi.prototype,"frozenMainAssetPrealnum",void 0);Xi=zu=h([v.d("AssetPrealnumModel")],Xi);let Gt=ki=class extends qi{get signature(){return Me(this.signatureBuffer)}set signature(e){this.signatureBuffer=he(e)}get signSignature(){return this.signSignatureBuffer&&Me(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=he(e)}getBytes(e,t){const r={};e&&(r.signatureBuffer={value:null}),t&&(r.signSignatureBuffer={value:null});const n=Object.create(this,r);return this.$type.encode(n).finish()}toJSON(){const e={tIndex:this.tIndex,height:this.height,transactionAssetChanges:this.transactionAssetChanges.map(t=>t.toJSON()),signature:this.signature,transaction:this.transaction.toJSON()};return this.assetPrealnum&&(e.assetPrealnum=this.assetPrealnum.toJSON()),this.signSignature&&(e.signSignature=this.signSignature),e}static fromObject(e){const t=super.fromObject(e);return e!==t&&(e.signature&&(t.signature=e.signature),e.signSignature&&(t.signSignature=e.signSignature)),t}};h([A.d(ki.INC++,"uint32"),u("design:type",Number)],Gt.prototype,"tIndex",void 0);h([A.d(ki.INC++,"uint32"),u("design:type",Number)],Gt.prototype,"height",void 0);h([A.d(ki.INC++,Yn,"repeated"),u("design:type",Array)],Gt.prototype,"transactionAssetChanges",void 0);h([A.d(ki.INC++,Xi,"optional"),u("design:type",Xi)],Gt.prototype,"assetPrealnum",void 0);h([A.d(ki.INC++,"bytes"),u("design:type",Uint8Array)],Gt.prototype,"signatureBuffer",void 0);h([A.d(ki.INC++,"bytes","optional"),u("design:type",Uint8Array)],Gt.prototype,"signSignatureBuffer",void 0);h([Ys,u("design:type",Function),u("design:paramtypes",[Boolean,Boolean]),u("design:returntype",void 0)],Gt.prototype,"getBytes",null);Gt=ki=h([v.d("TransactionInBlock")],Gt);function sm(i,e,t){const r=[];for(const n in i)r[r.length]={sortKey:n,value:t(i[n])};r.sort((n,s)=>n.sortKey>s.sortKey?1:-1),e.clear();for(const n of r)e.set(n.sortKey,n.value);return e}var ic;let Qn=ic=class extends Y{toJSON(){return{changeAmount:this.changeAmount,changeCount:this.changeCount,moveAmount:this.moveAmount,transactionCount:this.transactionCount}}};Qn.INC=1;h([A.d(ic.INC++,"string","required","0"),u("design:type",String)],Qn.prototype,"changeAmount",void 0);h([A.d(ic.INC++,"uint32","required",0),u("design:type",Number)],Qn.prototype,"changeCount",void 0);h([A.d(ic.INC++,"string","required","0"),u("design:type",String)],Qn.prototype,"moveAmount",void 0);h([A.d(ic.INC++,"uint32","required",0),u("design:type",Number)],Qn.prototype,"transactionCount",void 0);Qn=ic=h([v.d("CountAndAmountStatisticModel")],Qn);var ju,im;let Zi=ju=class extends Y{get typeStatisticMap(){return this._typeStatisticMap||(this._typeStatisticMap=new Bi(this.typeStatisticHashMap))}toJSON(){return{typeStatisticHashMap:this.typeStatisticMap.toJSON(),total:this.total.toJSON()}}static fromObject(e){return e.total||(e=Object.create(e,{total:{}})),super.fromObject(e)}format(){return sm(this.typeStatisticHashMap,this.typeStatisticMap,e=>e),this}};Zi.INC=1;h([Er.d(ju.INC++,"string",Qn),u("design:type",Object)],Zi.prototype,"typeStatisticHashMap",void 0);h([A.d(ju.INC++,Qn),u("design:type",Qn)],Zi.prototype,"total",void 0);Zi=ju=h([v.d("AssetStatisticModel")],Zi);let eo=im=class extends Y{get assetTypeTypeStatisticMap(){return this._assetTypeTypeStatisticMap||(this._assetTypeTypeStatisticMap=new Bi(this.assetTypeTypeStatisticHashMap))}toJSON(){return{assetTypeTypeStatisticHashMap:this.assetTypeTypeStatisticMap.toJSON()}}format(){return sm(this.assetTypeTypeStatisticHashMap,this.assetTypeTypeStatisticMap,e=>e.format()),this}static fromObject(e){return super.fromObject(e)}};eo.INC=1;h([Er.d(im.INC++,"string",Zi),u("design:type",Object)],eo.prototype,"assetTypeTypeStatisticHashMap",void 0);eo=im=h([v.d("AssetTypeAssetStatisticModel")],eo);var bo;let On=bo=class extends Y{get magicAssetTypeTypeStatisticMap(){return this._magicAssetTypeTypeStatisticMap||(this._magicAssetTypeTypeStatisticMap=new Bi(this.magicAssetTypeTypeStatisticHashMap))}toJSON(){return{totalFee:this.totalFee,totalAsset:this.totalAsset,totalChainAsset:this.totalChainAsset,totalAccount:this.totalAccount,magicAssetTypeTypeStatisticHashMap:this.magicAssetTypeTypeStatisticMap.toJSON()}}getBytes(){return super.getBytes()}format(){return sm(this.magicAssetTypeTypeStatisticHashMap,this.magicAssetTypeTypeStatisticMap,e=>e.format()),this}};On.INC=1;h([A.d(bo.INC++,"string","required","0"),u("design:type",String)],On.prototype,"totalFee",void 0);h([A.d(bo.INC++,"string","required","0"),u("design:type",String)],On.prototype,"totalAsset",void 0);h([A.d(bo.INC++,"string","required","0"),u("design:type",String)],On.prototype,"totalChainAsset",void 0);h([A.d(bo.INC++,"uint32","required",0),u("design:type",Number)],On.prototype,"totalAccount",void 0);h([Er.d(bo.INC++,"string",eo),u("design:type",Object)],On.prototype,"magicAssetTypeTypeStatisticHashMap",void 0);h([Ys,u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",void 0)],On.prototype,"getBytes",null);On=bo=h([v.d("StatisticInfoModel")],On);var qs,ws;const qT=new ps(i=>new Bi(i.remark)),R_=new WeakMap,bf=new WeakMap;let ng=class extends Y{};h([A.d(1,"uint32"),u("design:type",Number)],ng.prototype,"version",void 0);ng=h([v.d("BlockVersionReader")],ng);let Cn=qs=class extends Y{get payloadHash(){return Me(this.payloadHashBuffer)}set payloadHash(e){this.payloadHashBuffer=he(e)}get blobSize(){return this.blobSizeLong.toNumber()}set blobSize(e){this.blobSizeLong=py.fromNumber(e,!0)}get totalAmount(){return this.statisticInfo.totalAsset||"0"}get totalFee(){return this.statisticInfo.totalFee||"0"}get transactionInBlocks(){const{transactionInBlockBufferList:e}=this;let t=R_.get(e);return t||(t=this.transactionInBlockBufferList.map(r=>{const n=Gt.decode(r);return bf.set(n,r),n})),t}set transactionInBlocks(e){const t=e.map(r=>{let n=bf.get(r);return n||(n=Gt.encode(r).finish(),bf.set(r,n)),n});R_.set(t,e),this.transactionInBlockBufferList=t}toJSON(){return{startTindex:this.startTindex,numberOfTransactions:this.numberOfTransactions,payloadHash:this.payloadHash,payloadLength:this.payloadLength,blobSize:this.blobSize,totalAmount:this.totalAmount,totalFee:this.totalFee,transactionInBlocks:this.transactionInBlocks.map(t=>t.toJSON()),statisticInfo:this.statisticInfo.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e){e.blobSize!==void 0&&(t.blobSize=e.blobSize),e.payloadHash&&(t.payloadHash=e.payloadHash);const r=[];if(e.transactionInBlocks){const n=e.transactionInBlocks;for(const s of n)r[r.length]=Gt.fromObject(s)}t.transactionInBlocks=r}return t}};Cn.INC=1;h([A.d(qs.INC++,"uint32"),u("design:type",Number)],Cn.prototype,"startTindex",void 0);h([A.d(qs.INC++,"uint32"),u("design:type",Number)],Cn.prototype,"numberOfTransactions",void 0);h([A.d(qs.INC++,"bytes"),u("design:type",Uint8Array)],Cn.prototype,"payloadHashBuffer",void 0);h([A.d(qs.INC++,"uint32"),u("design:type",Number)],Cn.prototype,"payloadLength",void 0);h([A.d(qs.INC++,"uint64"),u("design:type",Object)],Cn.prototype,"blobSizeLong",void 0);h([A.d(qs.INC++,On),u("design:type",On)],Cn.prototype,"statisticInfo",void 0);h([A.d(qs.INC++,"bytes","repeated"),u("design:type",Array)],Cn.prototype,"transactionInBlockBufferList",void 0);Cn=qs=h([v.d("BlockTransactionInfo")],Cn);let dt=ws=class extends Y{get signature(){return Me(this.signatureBuffer)}set signature(e){this.signatureBuffer=he(e)}get generatorPublicKey(){return Me(this.generatorPublicKeyBuffer)}set generatorPublicKey(e){this.generatorPublicKeyBuffer=he(e)}get generatorSecondPublicKey(){return this.generatorSecondPublicKeyBuffer&&Me(this.generatorSecondPublicKeyBuffer)||void 0}set generatorSecondPublicKey(e){this.generatorSecondPublicKeyBuffer=he(e)}get signSignature(){return this.signSignatureBuffer&&Me(this.signSignatureBuffer)||void 0}set signSignature(e){this.signSignatureBuffer=he(e)}get remarkMap(){return qT.forceGet(this)}get startTindex(){return this.transactionInfo.startTindex}get numberOfTransactions(){return this.transactionInfo.numberOfTransactions}get payloadHash(){return this.transactionInfo.payloadHash}get payloadLength(){return this.transactionInfo.payloadLength}get blobSize(){return this.transactionInfo.blobSize}get totalAmount(){return this.transactionInfo.totalAmount}get totalFee(){return this.transactionInfo.totalFee}get statisticInfo(){return this.transactionInfo.statisticInfo}get transactions(){return this.transactionInfo.transactionInBlocks}get roundOfflineGeneratersReadonlyMap(){const e=new Map;for(const t in this.roundOfflineGeneratersHashMap){const n=this.roundOfflineGeneratersHashMap[t].split(",");e.set(parseInt(t),n)}return e}get delay(){for(let e in this.roundOfflineGeneratersHashMap)return!0;return!1}getBytes(e,t,r){const n={};if(e&&(n.signatureBuffer={value:null}),t&&(n.signSignatureBuffer={value:null}),r){const o=this.transactionInfo;r===!0?n.transactionInfo={value:{startTindex:o.startTindex,numberOfTransactions:o.numberOfTransactions,payloadHashBuffer:o.payloadHashBuffer,payloadLength:o.payloadLength,blobSizeLong:o.blobSizeLong,statisticInfo:o.statisticInfo,transactionInBlockBufferList:[]}}:n.transactionInfo={value:{startTindex:o.startTindex,numberOfTransactions:r.length,payloadHashBuffer:o.payloadHashBuffer,payloadLength:o.payloadLength,blobSizeLong:o.blobSizeLong,statisticInfo:o.statisticInfo,transactionInBlockBufferList:r}}}const s=Object.create(this,n);return this.$type.encode(s).finish()}toJSON(){const e={version:this.version,height:this.height,blockSize:this.blockSize,timestamp:this.timestamp,signature:this.signature,generatorPublicKey:this.generatorPublicKey,generatorEquity:this.generatorEquity,previousBlockSignature:this.previousBlockSignature,reward:this.reward,magic:this.magic,blockParticipation:this.blockParticipation,remark:this.remark,asset:this.asset.toJSON(),transactionInfo:this.transactionInfo.toJSON(),roundOfflineGeneratersHashMap:this.roundOfflineGeneratersHashMap};return this.generatorSecondPublicKey&&(e.generatorSecondPublicKey=this.generatorSecondPublicKey),this.signSignature&&(e.signSignature=this.signSignature),e}static fromObject(e){const t=super.fromObject(e);return e.generatorPublicKey&&(t.generatorPublicKey=e.generatorPublicKey),e.generatorSecondPublicKey&&(t.generatorSecondPublicKey=e.generatorSecondPublicKey),e.signature&&(t.signature=e.signature),e.signSignature&&(t.signSignature=e.signSignature),t}};dt.INC=10;h([A.d(1,"uint32"),u("design:type",Number)],dt.prototype,"version",void 0);h([A.d(2,"uint32"),u("design:type",Number)],dt.prototype,"height",void 0);h([A.d(3,"bytes"),u("design:type",Uint8Array)],dt.prototype,"signatureBuffer",void 0);h([A.d(4,"uint32"),u("design:type",Number)],dt.prototype,"timestamp",void 0);h([A.d(5,"bytes"),u("design:type",Uint8Array)],dt.prototype,"generatorPublicKeyBuffer",void 0);h([A.d(6,"string"),u("design:type",String)],dt.prototype,"previousBlockSignature",void 0);h([A.d(7,"string"),u("design:type",String)],dt.prototype,"magic",void 0);h([A.d(8,"bytes","optional"),u("design:type",Uint8Array)],dt.prototype,"generatorSecondPublicKeyBuffer",void 0);h([A.d(9,"bytes","optional"),u("design:type",Uint8Array)],dt.prototype,"signSignatureBuffer",void 0);h([A.d(ws.INC++,"uint32"),u("design:type",Number)],dt.prototype,"blockSize",void 0);h([A.d(ws.INC++,"string"),u("design:type",String)],dt.prototype,"blockParticipation",void 0);h([A.d(ws.INC++,"string"),u("design:type",String)],dt.prototype,"generatorEquity",void 0);h([Er.d(ws.INC++,"string","string"),u("design:type",Object)],dt.prototype,"remark",void 0);h([A.d(ws.INC++,"string","required","0"),u("design:type",String)],dt.prototype,"reward",void 0);h([A.d(ws.INC++,Cn),u("design:type",Cn)],dt.prototype,"transactionInfo",void 0);h([A.d(ws.INC++,"bytes","repeated"),u("design:type",Array)],dt.prototype,"transactionBufferList",void 0);h([Er.d(ws.INC++,"uint32","string"),u("design:type",Object)],dt.prototype,"roundOfflineGeneratersHashMap",void 0);h([Ys,u("design:type",Function),u("design:paramtypes",[Boolean,Boolean,Object]),u("design:returntype",void 0)],dt.prototype,"getBytes",null);dt=ws=h([v.d("Block")],dt);let Jh=class extends Y{toJSON(){return{}}};Jh=h([v.d("CommonBlockAssetModel")],Jh);var Ju,oc;let la=Ju=class extends Y{toJSON(){return{address:this.address,equity:this.equity}}};la.INC=1;h([A.d(Ju.INC++,"string"),u("design:type",String)],la.prototype,"address",void 0);h([A.d(Ju.INC++,"string"),u("design:type",String)],la.prototype,"equity",void 0);la=Ju=h([v.d("NextRoundDelegateModel")],la);let Vs=oc=class extends Y{get nextRoundDelegateAddressList(){if(!this._next_round_delegate_address_list){this._next_round_delegate_address_list=[];for(const e of this.nextRoundDelegates)this._next_round_delegate_address_list.push(e.address)}return this._next_round_delegate_address_list}get nextRoundDelegateEquitieMap(){if(!this._equitie_map){this._equitie_map=new Map;for(const e of this.nextRoundDelegates)this._equitie_map.set(e.address,e.equity)}return this._equitie_map}get rate(){return this._rate||(this._rate=(BigInt(this.maxBeginBalance)/BigInt(this.maxTxCount||1)).toString()),this._rate}toJSON(){return{newDelegates:this.newDelegates,maxBeginBalance:this.maxBeginBalance,maxTxCount:this.maxTxCount,nextRoundDelegates:this.nextRoundDelegates.map(t=>t.toJSON()),rate:this.rate}}};Vs.INC=1;h([A.d(oc.INC++,"string","repeated"),u("design:type",Array)],Vs.prototype,"newDelegates",void 0);h([A.d(oc.INC++,"string"),u("design:type",String)],Vs.prototype,"maxBeginBalance",void 0);h([A.d(oc.INC++,"uint32"),u("design:type",Number)],Vs.prototype,"maxTxCount",void 0);h([A.d(oc.INC++,la,"repeated"),u("design:type",Array)],Vs.prototype,"nextRoundDelegates",void 0);Vs=oc=h([v.d("RoundDelegateModel")],Vs);var We;let ha=class extends Y{toJSON(){return{votePercent:this.votePercent.toJSON(),forgePercent:this.forgePercent.toJSON()}}};h([A.d(1,Mr),u("design:type",Mr)],ha.prototype,"votePercent",void 0);h([A.d(2,Mr),u("design:type",Mr)],ha.prototype,"forgePercent",void 0);ha=h([v.d("RewardPercentModel")],ha);let ua=class extends Y{toJSON(){return{heights:this.heights.slice(),rewards:this.rewards.slice()}}};h([A.d(1,"uint32","repeated"),u("design:type",Array)],ua.prototype,"heights",void 0);h([A.d(2,"string","repeated"),u("design:type",Array)],ua.prototype,"rewards",void 0);ua=h([v.d("RewardPerBlock")],ua);let fa=class extends Y{toJSON(){return{port:this.port,scan_peer_port:this.scan_peer_port}}};h([A.d(1,"uint32"),u("design:type",Number)],fa.prototype,"port",void 0);h([A.d(2,"uint32"),u("design:type",Number)],fa.prototype,"scan_peer_port",void 0);fa=h([v.d("PortsModel")],fa);let ga=class extends Y{toJSON(){return{growthFactor:this.growthFactor.toJSON(),participationRatio:this.participationRatio.toJSON()}}};h([A.d(1,lr),u("design:type",lr)],ga.prototype,"growthFactor",void 0);h([A.d(2,Mr),u("design:type",Mr)],ga.prototype,"participationRatio",void 0);ga=h([v.d("TransactionPowOfWorkConfigModel")],ga);let da=class extends Y{toJSON(){return{balanceWeight:this.balanceWeight,numberOfTransactionsWeight:this.numberOfTransactionsWeight}}};h([A.d(1,"uint32"),u("design:type",Number)],da.prototype,"balanceWeight",void 0);h([A.d(2,"uint32"),u("design:type",Number)],da.prototype,"numberOfTransactionsWeight",void 0);da=h([v.d("AccountParticipationWeightRatioModel")],da);let ya=class extends Y{toJSON(){return{balanceWeight:this.balanceWeight,numberOfTransactionsWeight:this.numberOfTransactionsWeight}}};h([A.d(1,"uint32"),u("design:type",Number)],ya.prototype,"balanceWeight",void 0);h([A.d(2,"uint32"),u("design:type",Number)],ya.prototype,"numberOfTransactionsWeight",void 0);ya=h([v.d("BlockParticipationWeightRatioModel")],ya);let Je=We=class extends Vs{get beginEpochTime(){return this.beginEpochTimeLong.toNumber()}set beginEpochTime(e){this.beginEpochTimeLong=py.fromNumber(e,!0)}toJSON(){const e=Object.assign({chainName:this.chainName,assetType:this.assetType,magic:this.magic,bnid:this.bnid,beginEpochTime:this.beginEpochTime,genesisLocationName:this.genesisLocationName,genesisAmount:this.genesisAmount,minTransactionFeePerByte:this.minTransactionFeePerByte.toJSON(),maxTransactionSize:this.maxTransactionSize,maxBlockSize:this.maxBlockSize,maxTPSPerBlock:this.maxTPSPerBlock,consessusBeforeSyncBlockDiff:this.consessusBeforeSyncBlockDiff,maxDelegateTxsPerRound:this.maxDelegateTxsPerRound,maxGrabTimesOfGiftAsset:this.maxGrabTimesOfGiftAsset,issueAssetMinChainAsset:this.issueAssetMinChainAsset,registerChainMinChainAsset:this.registerChainMinChainAsset,maxApplyAndConfirmedBlockHeightDiff:this.maxApplyAndConfirmedBlockHeightDiff,blockPerRound:this.blockPerRound,delegates:this.delegates,whetherToAllowDelegateContinusElections:this.whetherToAllowDelegateContinusElections,forgeInterval:this.forgeInterval,rewardPercent:this.rewardPercent.toJSON(),ports:this.ports.toJSON(),rewardPerBlock:this.rewardPerBlock.toJSON(),accountParticipationWeightRatio:this.accountParticipationWeightRatio.toJSON(),blockParticipationWeightRatio:this.blockParticipationWeightRatio.toJSON(),averageComputingPower:this.averageComputingPower,tpowOfWorkExemptionBlocks:this.tpowOfWorkExemptionBlocks,transactionPowOfWorkConfig:this.transactionPowOfWorkConfig.toJSON()},super.toJSON());return this.maxMultipleOfAssetAndMainAsset&&(e.maxMultipleOfAssetAndMainAsset=this.maxMultipleOfAssetAndMainAsset.toJSON()),this.issueEntityFactoryMinChainAsset&&(e.issueEntityFactoryMinChainAsset=this.issueEntityFactoryMinChainAsset),this.maxMultipleOfEntityAndMainAsset&&(e.maxMultipleOfEntityAndMainAsset=this.maxMultipleOfEntityAndMainAsset.toJSON()),this.maxVotesPerBlock!==void 0&&(e.maxVotesPerBlock=this.maxVotesPerBlock),this.voteMinChainAsset&&(e.voteMinChainAsset=this.voteMinChainAsset),this.maxBlobSizePerTransaction&&(e.maxBlobSizePerTransaction=this.maxBlobSizePerTransaction),e}getBytes(){return this.$type.encode(this).finish()}static fromObject(e){const t=super.fromObject(e);if(t!==e){e.beginEpochTime!==void 0&&(t.beginEpochTime=e.beginEpochTime),e.maxMultipleOfAssetAndMainAsset&&(t.maxMultipleOfAssetAndMainAsset=lr.fromObject(e.maxMultipleOfAssetAndMainAsset));const{maxMultipleOfEntityAndMainAsset:r}=e;r&&r.numerator&&r.denominator&&(t.maxMultipleOfEntityAndMainAsset=lr.fromObject(r))}return t}};h([A.d(We.INC++,"string"),u("design:type",String)],Je.prototype,"chainName",void 0);h([A.d(We.INC++,"string"),u("design:type",String)],Je.prototype,"assetType",void 0);h([A.d(We.INC++,"string"),u("design:type",String)],Je.prototype,"magic",void 0);h([A.d(We.INC++,"string"),u("design:type",String)],Je.prototype,"bnid",void 0);h([A.d(We.INC++,"uint64"),u("design:type",Object)],Je.prototype,"beginEpochTimeLong",void 0);h([A.d(We.INC++,"string"),u("design:type",String)],Je.prototype,"genesisLocationName",void 0);h([A.d(We.INC++,"string"),u("design:type",String)],Je.prototype,"genesisAmount",void 0);h([A.d(We.INC++,Mr),u("design:type",Mr)],Je.prototype,"minTransactionFeePerByte",void 0);h([A.d(We.INC++,"uint32"),u("design:type",Number)],Je.prototype,"maxTransactionSize",void 0);h([A.d(We.INC++,"uint32"),u("design:type",Number)],Je.prototype,"maxBlockSize",void 0);h([A.d(We.INC++,"uint32"),u("design:type",Number)],Je.prototype,"maxTPSPerBlock",void 0);h([A.d(We.INC++,"uint32"),u("design:type",Number)],Je.prototype,"consessusBeforeSyncBlockDiff",void 0);h([A.d(We.INC++,"uint32"),u("design:type",Number)],Je.prototype,"maxDelegateTxsPerRound",void 0);h([A.d(We.INC++,"uint32"),u("design:type",Number)],Je.prototype,"maxGrabTimesOfGiftAsset",void 0);h([A.d(We.INC++,"string"),u("design:type",String)],Je.prototype,"issueAssetMinChainAsset",void 0);h([A.d(We.INC++,"string"),u("design:type",String)],Je.prototype,"registerChainMinChainAsset",void 0);h([A.d(We.INC++,"uint32"),u("design:type",Number)],Je.prototype,"maxApplyAndConfirmedBlockHeightDiff",void 0);h([A.d(We.INC++,"uint32"),u("design:type",Number)],Je.prototype,"blockPerRound",void 0);h([A.d(We.INC++,"uint32"),u("design:type",Number)],Je.prototype,"delegates",void 0);h([A.d(We.INC++,"bool"),u("design:type",Boolean)],Je.prototype,"whetherToAllowDelegateContinusElections",void 0);h([A.d(We.INC++,"uint32","required"),u("design:type",Number)],Je.prototype,"forgeInterval",void 0);h([A.d(We.INC++,ha,"required"),u("design:type",ha)],Je.prototype,"rewardPercent",void 0);h([A.d(We.INC++,fa,"required"),u("design:type",fa)],Je.prototype,"ports",void 0);h([A.d(We.INC++,ua,"required"),u("design:type",ua)],Je.prototype,"rewardPerBlock",void 0);h([A.d(We.INC++,da,"required"),u("design:type",da)],Je.prototype,"accountParticipationWeightRatio",void 0);h([A.d(We.INC++,ya,"required"),u("design:type",ya)],Je.prototype,"blockParticipationWeightRatio",void 0);h([A.d(We.INC++,"uint32","required"),u("design:type",Number)],Je.prototype,"averageComputingPower",void 0);h([A.d(We.INC++,"uint32","required"),u("design:type",Number)],Je.prototype,"tpowOfWorkExemptionBlocks",void 0);h([A.d(We.INC++,ga),u("design:type",ga)],Je.prototype,"transactionPowOfWorkConfig",void 0);h([A.d(We.INC++,lr),u("design:type",lr)],Je.prototype,"maxMultipleOfAssetAndMainAsset",void 0);h([A.d(We.INC++,"string","required"),u("design:type",String)],Je.prototype,"issueEntityFactoryMinChainAsset",void 0);h([A.d(We.INC++,lr),u("design:type",lr)],Je.prototype,"maxMultipleOfEntityAndMainAsset",void 0);h([A.d(We.INC++,"uint32","required"),u("design:type",Number)],Je.prototype,"maxVotesPerBlock",void 0);h([A.d(We.INC++,"string","required"),u("design:type",String)],Je.prototype,"voteMinChainAsset",void 0);h([A.d(We.INC++,"uint32","required"),u("design:type",Number)],Je.prototype,"maxBlobSizePerTransaction",void 0);h([Ys,u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",void 0)],Je.prototype,"getBytes",null);Je=We=h([v.d("GenesisAssetModel")],Je);let ll=class extends Y{toJSON(){return{genesisAsset:this.genesisAsset.toJSON()}}};h([A.d(1,Je),u("design:type",Je)],ll.prototype,"genesisAsset",void 0);ll=h([v.d("GenesisBlockAssetModel")],ll);var om;let ma=om=class extends Vs{get hash(){return Me(this.hashBuffer)}set hash(e){this.hashBuffer=he(e)}toJSON(){return Object.assign({hash:this.hash},super.toJSON())}getBytes(){return this.$type.encode(this).finish()}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.hash&&(t.hash=e.hash),t}};h([A.d(om.INC++,"bytes"),u("design:type",Uint8Array)],ma.prototype,"hashBuffer",void 0);h([Ys,u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",void 0)],ma.prototype,"getBytes",null);ma=om=h([v.d("RoundLastAssetModel")],ma);let hl=class extends Y{toJSON(){return{roundLastAsset:this.roundLastAsset.toJSON()}}};h([A.d(1,ma),u("design:type",ma)],hl.prototype,"roundLastAsset",void 0);hl=h([v.d("RoundLastBlockAssetModel")],hl);let _a=class extends dt{};h([A.d(21,Jh),u("design:type",Jh)],_a.prototype,"asset",void 0);_a=h([v.d("CommonBlock")],_a);let to=class extends dt{};h([A.d(21,ll),u("design:type",ll)],to.prototype,"asset",void 0);to=h([v.d("GenesisBlock")],to);let Aa=class extends dt{};h([A.d(22,hl),u("design:type",hl)],Aa.prototype,"asset",void 0);Aa=h([v.d("RoundLastBlock")],Aa);var Yu;const{ArgumentFormatException:P_}=re("MODEL","blockModel");var zt;(function(i){i[i.GENESIS=0]="GENESIS",i[i.COMMON=1]="COMMON",i[i.ROUNDEND=2]="ROUNDEND"})(zt||(zt={}));const Ch=(()=>{const i=new Map,e=new Map;return[[zt.GENESIS,to],[zt.COMMON,_a],[zt.ROUNDEND,Aa]].forEach(([t,r])=>{i.set(t,r),e.set(r,t)}),{KM:i,MK:e}})(),Nf=new WeakMap;let Si=Yu=class extends Y{get block(){let e=Nf.get(this._block_bytes);if(!e){const t=Ch.KM.get(this._block_type);if(!t)throw new P_(c.INVALID_BLOCK_TYPE,{type:this._block_type});e=t.decode(this._block_bytes),Nf.set(this._block_bytes,e)}return e}set block(e){const t=e.constructor,r=Ch.MK.get(t);if(r===void 0)throw new P_(c.INVALID_BLOCK_CONSTRUCTOR,{name:t.name});this._block_type=r,this._block_bytes=new Uint8Array(t.encode(e).finish()),Nf.set(this._block_bytes,e)}static fromObject(e){const t=super.fromObject(e);if(e!==t){const r=e.block;if(r)if(r instanceof Y)t.block=r;else{let n=zt.COMMON;r.height===0?n=zt.GENESIS:r.remark&&"hash"in r.remark&&(n=zt.ROUNDEND);const s=Ch.KM.get(n);s&&(t.block=s.fromObject(r))}}return t}toJSON(){return{block:this.block}}};Si.INC=1;h([A.d(Yu.INC++,zt),u("design:type",Number)],Si.prototype,"_block_type",void 0);h([A.d(Yu.INC++,"bytes"),u("design:type",Uint8Array)],Si.prototype,"_block_bytes",void 0);Si=Yu=h([v.d("SomeBlockModel")],Si);let Ea=class extends Y{toJSON(){return{type:this.type,data:this.data}}};h([A.d(2,"string"),u("design:type",String)],Ea.prototype,"type",void 0);h([A.d(1,"string"),u("design:type",String)],Ea.prototype,"data",void 0);Ea=h([v.d("CustomModel")],Ea);let ul=class extends Y{toJSON(){return{custom:this.custom.toJSON()}}};h([A.d(1,Ea),u("design:type",Ea)],ul.prototype,"custom",void 0);ul=h([v.d("CustomAssetModel")],ul);var am;let Ia=am=class extends Ie{};h([A.d(am.INC++,ul),u("design:type",ul)],Ia.prototype,"asset",void 0);Ia=am=h([v.d("CustomTransaction")],Ia);let fl=class extends Y{toJSON(){return{genesisBlock:this.genesisBlock}}};h([A.d(1,"string"),u("design:type",String)],fl.prototype,"genesisBlock",void 0);fl=h([v.d("RegisterChainModel")],fl);let gl=class extends Y{toJSON(){return{registerChain:this.registerChain.toJSON()}}};h([A.d(1,fl),u("design:type",fl)],gl.prototype,"registerChain",void 0);gl=h([v.d("RegisterChainAssetModel")],gl);var cm;let Ta=cm=class extends Ie{};h([A.d(cm.INC++,gl),u("design:type",gl)],Ta.prototype,"asset",void 0);Ta=cm=h([v.d("RegisterChainTransaction")],Ta);var pm;const{ArgumentFormatException:B_,error:nO,IllegalStateException:sO}=re("MODEL","transactionModel"),M_=new WeakMap,xf=new WeakMap;let Sa=pm=class extends Y{get transactions(){const{transactionBufferList:e}=this;let t=M_.get(e);return t||(t=this.transactionBufferList.map(r=>{const n=Ie.decode(r),s=je.trsTypeToV(n.type),o=je.VM.get(s);if(!o)throw new B_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});const a=o.decode(r);return xf.set(a,r),a})),t}set transactions(e){const t=e.map(r=>{let n=xf.get(r);return n||(n=r.getBytes(),xf.set(r,n)),n});M_.set(t,e),this.transactionBufferList=t}toJSON(){return{transactions:this.transactions.map(e=>e.toJSON())}}static fromObject(e){const t=super.fromObject(e);if(t!==e&&e.transactions){const r=e.transactions,n=[];for(const s of r)if(s instanceof Y)n.push(s);else{const o=s.type;if(o){const a=je.trsTypeToV(o),p=je.VM.get(a);if(!p)throw new B_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:a});n.push(p.fromObject(s))}}t.transactions=n}return t}};Sa.INC=1;h([A.d(pm.INC++,"bytes","repeated"),u("design:type",Array)],Sa.prototype,"transactionBufferList",void 0);Sa=pm=h([v.d("MultipleModel")],Sa);let dl=class extends Y{toJSON(){return{multiple:this.multiple.toJSON()}}};h([A.d(1,Sa),u("design:type",Sa)],dl.prototype,"multiple",void 0);dl=h([v.d("MultipleAssetModel")],dl);var lm;let wa=lm=class extends Ie{};h([A.d(lm.INC++,dl),u("design:type",dl)],wa.prototype,"asset",void 0);wa=lm=h([v.d("MultipleTransaction")],wa);var hm;const{ArgumentFormatException:v_,error:cO,IllegalStateException:pO}=re("MODEL","transactionModel"),Of=new WeakMap,Cf=new WeakMap;let ba=hm=class extends Y{get transaction(){const{transactionBuffer:e}=this;let t=Of.get(e);if(!t){const r=Ie.decode(e),n=je.trsTypeToV(r.type),s=je.VM.get(n);if(!s)throw new v_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:n});t=s.decode(e),Cf.set(t,e),Of.set(e,t)}return t}set transaction(e){let t=Cf.get(e);t||(t=e.getBytes(),Cf.set(e,t),Of.set(t,e)),this.transactionBuffer=t}toJSON(){return{transaction:this.transaction.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e&&e.transaction){const r=e.transaction;if(r instanceof Y)t.transaction=r;else{const n=r.type;if(n){const s=je.trsTypeToV(n),o=je.VM.get(s);if(!o)throw new v_(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.transaction=o.fromObject(r)}}}return t}};ba.INC=1;h([A.d(hm.INC++,"bytes"),u("design:type",Uint8Array)],ba.prototype,"transactionBuffer",void 0);ba=hm=h([v.d("PromiseModel")],ba);let yl=class extends Y{toJSON(){return{promise:this.promise.toJSON()}}};h([A.d(1,ba),u("design:type",ba)],yl.prototype,"promise",void 0);yl=h([v.d("PromiseAssetModel")],yl);var um;let Na=um=class extends Ie{};h([A.d(um.INC++,yl),u("design:type",yl)],Na.prototype,"asset",void 0);Na=um=h([v.d("PromiseTransaction")],Na);var fm;let xa=fm=class extends Y{get promiseId(){return Me(this.promiseIdBuffer)}set promiseId(e){this.promiseIdBuffer=he(e)}toJSON(){return{promiseId:this.promiseId}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.promiseId&&(t.promiseId=e.promiseId),t}};xa.INC=1;h([A.d(fm.INC++,"bytes"),u("design:type",Uint8Array)],xa.prototype,"promiseIdBuffer",void 0);xa=fm=h([v.d("PromiseResolveModel")],xa);let ml=class extends Y{toJSON(){return{resolve:this.resolve.toJSON()}}};h([A.d(1,xa),u("design:type",xa)],ml.prototype,"resolve",void 0);ml=h([v.d("PromiseResolveAssetModel")],ml);var gm;let Oa=gm=class extends Ie{};h([A.d(gm.INC++,ml),u("design:type",ml)],Oa.prototype,"asset",void 0);Oa=gm=h([v.d("PromiseResolveTransaction")],Oa);var pr;(function(i){i.TEXT="text",i.ADDRESS="address",i.SIGNATURE="signature",i.NUMBER="number",i.CALC="calc"})(pr||(pr={}));var Ca;(function(i){i.STRING="string",i.LITERAL="literal"})(Ca||(Ca={}));var L_;(function(i){i.FLOAT_32="float32",i.FLOAT_64="float64",i.FLOAT_128="float128",i.FLOAT_big="bigfloat"})(L_||(L_={}));var ac;let ms=ac=class extends Y{toJSON(){const e={type:this.type,name:this.name,keyPath:this.keyPath};return this.pattern&&(e.pattern=this.pattern),e}};ms.INC=1;h([A.d(ac.INC++,"string"),u("design:type",String)],ms.prototype,"type",void 0);h([A.d(ac.INC++,"string"),u("design:type",String)],ms.prototype,"name",void 0);h([A.d(ac.INC++,"string"),u("design:type",String)],ms.prototype,"keyPath",void 0);h([A.d(ac.INC++,"string","optional"),u("design:type",String)],ms.prototype,"pattern",void 0);ms=ac=h([v.d("BaseInputModel")],ms);var cc;let wi=cc=class extends ms{toJSON(){const e={...super.toJSON(),format:this.format};return this.min&&(e.min=this.min.toJSON()),this.max&&(e.max=this.max.toJSON()),this.step&&(e.step=this.step.toJSON()),e}};h([A.d(cc.INC++,lr,"optional"),u("design:type",lr)],wi.prototype,"min",void 0);h([A.d(cc.INC++,lr,"optional"),u("design:type",lr)],wi.prototype,"max",void 0);h([A.d(cc.INC++,lr,"optional"),u("design:type",lr)],wi.prototype,"step",void 0);h([A.d(cc.INC++,"string","required",Ca.LITERAL),u("design:type",String)],wi.prototype,"format",void 0);wi=cc=h([v.d("NumberInputModel")],wi);class Pt{constructor(e,t){if(Object.defineProperty(this,"numerator",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"denominator",{enumerable:!0,configurable:!0,writable:!0,value:t}),t<0n)throw new RangeError("invalid denominator: should not be negative number.")}static from(e,t=1){e=e.toString().trim();let r=BigInt(t);const n=e.lastIndexOf(".");n!==-1&&(r=10n**BigInt(e.length-n-1),e=e.slice(0,n)+e.slice(n+1));let s=BigInt(e);return r<0n&&(r=-r,s=-s),new Pt(s,r)}isFinite(){return this.denominator!==0n}isInfinity(){return this.denominator===0n&&this.numerator!==0n}isNaN(){return this.denominator===0n&&this.numerator===0n}isNeg(){return this.numerator<0n}toString(){return this.toPrecision(8)}toPrecision(e,t=Rc.ROUND){if(this.isNaN())return"NaN";if(this.isInfinity())return this.isNeg()?"-Infinity":"Infinity";let{denominator:r,numerator:n}=this;if(r===1n)return n.toString();const s=Math.floor(e),o=s+1;if(o<1)throw new Error("invalid digits");const a=10n**BigInt(o);let l=n*a/r,f="";l<0&&(f="-",l=-l);const g=l/10n;let d;switch(t){case Rc.FLOOR:d=g.toString();break;case Rc.CEIL:{l%10n!==0n?d=(g+1n).toString():d=g.toString();break}default:l%10n>=5n?d=(g+1n).toString():d=g.toString()}d=d.padStart(o,"0");let y=d.slice(0,-s)+"."+d.slice(-s);return y.endsWith("0")&&(y=y.replace(/[\.0]+$/,"")),f+y}}var Rc;(function(i){i[i.FLOOR=0]="FLOOR",i[i.ROUND=1]="ROUND",i[i.CEIL=2]="CEIL"})(Rc||(Rc={}));const dm=(i,e,t)=>{if(i.denominator===e.denominator)return new Pt(t(i.numerator,e.numerator,i.denominator),i.denominator);const r=i.numerator*e.denominator,n=e.numerator*i.denominator,s=i.denominator*e.denominator;return new Pt(t(r,n,s),i.denominator*e.denominator)},XT=(i,e)=>dm(i,e,(t,r)=>t+r),ZT=(i,e)=>dm(i,e,(t,r)=>t-r),OE=(i,e)=>dm(i,e,(t,r)=>t*r),eS=(i,e)=>OE(i,new Pt(e.denominator,e.numerator));new Pt(0n,0n);new Pt(1n,1n);new Pt(0n,1n);Pt.from(Math.PI);Pt.from(Math.E);Pt.from(Math.LN2);Pt.from(Math.LN10);Pt.from(Math.LOG2E);Pt.from(Math.LOG10E);Pt.from(Math.SQRT1_2);class jr{constructor(e,t={}){Object.defineProperty(this,"label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isBinary",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isPrefix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"precedence",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateContext",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.label=e,this.isBinary=!!t.isBinary,this.isPrefix=!!t.isPrefix,this.precedence=t.precedence??-1}}const Nt={start:new jr("start"),end:new jr("end"),parenL:new jr("("),parenR:new jr(")"),numeric:new jr("numeric"),identifier:new jr("identifier"),plus:new jr("+",{isBinary:!0,precedence:13}),minus:new jr("-",{isBinary:!0,precedence:13}),times:new jr("*",{isBinary:!0,precedence:14}),div:new jr("/",{isBinary:!0,precedence:14}),prefixPlus:new jr("+",{isPrefix:!0,precedence:16}),prefixMinus:new jr("-",{isPrefix:!0,precedence:16})};Nt.parenL.updateContext=function(){this.allowPrefix=!0};Nt.parenR.updateContext=function(){this.allowPrefix=!1};Nt.numeric.updateContext=function(){this.allowPrefix=!1};Nt.identifier.updateContext=function(){this.allowPrefix=!1};class ym{constructor(e){Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.type="",this.start=e,this.end=e}}function mm(i){return i>=48&&i<=57}function CE(i){return i===46?!0:mm(i)}function RE(i){return i>=65&&i<=90||i>=97&&i<=122}function tS(i){return!!(RE(i)||mm(i)||i===95)}function rS(i){let e=i;const t=[];for(let r=0;r<e.length;r++)e.charCodeAt(r)!==95&&t.push(e[r]);return t.length!==e.length&&(e=t.join("")),e}const D_=["+","-","*","/","(",")"],$s=[];function nS(i){$s.includes(i)||$s.unshift(i)}function PE(i,e){if(typeof i!="string"||!/^\S+$/.test(i))throw new Error("The custom operator should be a non-empty string");if(D_.includes(i))throw new Error(`The custom operator cannot use reserved character, including: ${D_.join(", ")}`);if(CE(i.charCodeAt(0)))throw new Error("The custom operator cannot start with a possible number, including: `.`, 0-9");if(i.charCodeAt(0)===63)throw new Error("The custom operator cannot start with `?`");if(e!=null&&(typeof e!="number"||e<0))throw new Error("The precedence should be a number greater than 0")}class BE{constructor(e,t,r,n=!1){Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"codes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"calc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e,this.codes=e.split("").map((s,o)=>e.charCodeAt(o)),this.type=new jr(e,{isBinary:!n,isPrefix:n,precedence:t}),this.calc=r}}function sS(i,e,t){if(PE(i,e),typeof t!="function")throw new Error("Expected to receive a calculation method, like: `(left, right) => String(left - right)`");return new BE(i,e,t,!1)}function iS(i,e,t){if(PE(i,e),typeof t!="function")throw new Error("Expected to receive a calculation method, like: `(value) => String(Math.abs(value))`");return new BE(i,e,t,!0)}let ME={"+":(i,e)=>String(Number(i)+Number(e)),"-":(i,e)=>String(Number(i)-Number(e)),"*":(i,e)=>String(Number(i)*Number(e)),"/":(i,e)=>String(Number(i)/Number(e))};function oS(i){const e=["+","-","*","/"];i=i||{},e.forEach(t=>{if(typeof i[t]!="function")throw new Error(`Missing method for calculation operator \`${t}\``)}),ME=i}function aS(i,e,t){switch(t){case"+":case"-":case"*":case"/":return ME[t](i,e);default:for(let r=0;r<$s.length;r++){const n=$s[r];if(n.type.isBinary&&n.value===t)return n.calc(i,e)}}throw new Error(`Unexpected binary operator: ${t}`)}function cS(i,e){switch(e){case"+":return i;case"-":return String(-i);default:for(let t=0;t<$s.length;t++){const r=$s[t];if(r.type.isPrefix&&r.value===e)return r.calc(i)}}throw new Error(`Unexpected unary operator: ${e}`)}function Nc(i,e={}){if(i instanceof ym){let t;switch(i.type){case"Expression":return Nc(i.expression,e);case"BinaryExpression":return aS(Nc(i.left,e),Nc(i.right,e),i.operator);case"UnaryExpression":return cS(Nc(i.argument,e),i.operator);case"NumericLiteral":return i.value;case"Identifier":if(t=e[i.name],t===void 0)throw new Error(`The scope name \`${i.name}\` is not initialized`);return String(t);default:throw new Error(`Unexpected type: ${i.type}`)}}return i}class Mn{static evaluate(e,t){return new Mn(e).compile()(t)}constructor(e){Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pos",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tokenType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastTokenStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lastTokenEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"allowPrefix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.input=String(e),this.tokenType=Nt.start,this.value="",this.pos=0,this.start=0,this.end=0,this.lastTokenStart=0,this.lastTokenEnd=0,this.allowPrefix=!0}compile(){let e=this.node;return e===void 0&&(e=this.parse()),t=>e?Nc(e,t??{}):"0"}parse(){this.next();const e=this.startNode(this.start);return this.tokenType===Nt.end?this.node=null:(e.expression=this.parseExprAtom(this.start,-1),this.tokenType!==Nt.end&&this.unexpected(this.value),this.node=this.finishNode(e,"Expression"))}parseExprAtom(e,t){if(this.tokenType===Nt.parenL){this.next();const r=this.parseExprAtom(this.start,-1);return this.expect(Nt.parenR),this.parseMaybeBinary(r,e,t)}else{const r=this.parseMaybeUnary(t);return this.parseMaybeBinary(r,e,t)}}parseMaybeBinary(e,t,r){const n=this.tokenType.precedence;if(this.tokenType.isBinary&&n>r){const s=this.startNode(t),o=this.value;this.next();const a=this.start,p=this.parseExprAtom(a,n),l=this.parseMaybeBinary(p,a,n);return s.left=e,s.operator=o,s.right=l,this.finishNode(s,"BinaryExpression"),this.parseMaybeBinary(s,t,r)}return e}parseMaybeUnary(e){const t=this.tokenType.precedence,r=this.startNode(),n=this.start,s=this.value;if(this.tokenType.isPrefix&&t>=e)return r.operator=s,r.prefix=!0,this.next(),r.argument=this.parseExprAtom(this.start,t),this.finishNode(r,"UnaryExpression");if(this.tokenType===Nt.numeric){const o=rS(s);return r.rawValue=s,r.value=o,this.next(),this.finishNode(r,"NumericLiteral")}return this.tokenType===Nt.identifier?(r.name=s,this.next(),this.finishNode(r,"Identifier")):this.unexpected(s,n)}next(){if(this.lastTokenStart=this.start,this.lastTokenEnd=this.end,this.skipSpace(),this.start=this.pos,this.pos>=this.input.length){if(this.tokenType===Nt.end)return;this.finishToken(Nt.end)}else this.readToken()}readToken(){const e=this.codeAt(this.pos);return CE(e)?this.readNumeric():this.readTokenFromCode()}readNumeric(){const e=this.pos;let t=-1,r=!0,n=!1,s=!1,o=-1;for(;this.isValidPosition();){const p=this.codeAt(this.pos);if(mm(p))t===-1&&(t=0),this.pos++,s=!1,n=!0;else if(s){o=this.pos,s=!1;break}else if(p===69||p===101){if(t!==0){o=this.pos;break}t++,this.pos++,this.isValidPosition()&&(this.codeAt(this.pos)===43||this.codeAt(this.pos)===45)&&this.pos++,r=!1,s=!0}else if(p===46){if(!r){o=this.pos;break}r=!1,this.pos++,this.pos-e===1&&(s=!0)}else if(p===95){if(!n){o=this.pos;break}n=!1,s=!0,this.pos++}else break}s&&(o=this.pos-1),o>=0&&this.unexpected(this.input[o],o);const a=this.input.slice(e,this.pos);this.finishToken(Nt.numeric,a)}readTokenFromCode(){const e=this.codeAt(this.pos);let t,r,n;for(r=0;r<$s.length;r++){const s=$s[r];for(n=0;n<s.codes.length&&s.codes[n]===this.codeAt(this.pos+n);n++);if(n===s.codes.length){t=s;break}}if(t)return this.pos+=t.codes.length,this.finishToken(t.type,t.value);switch(e){case 40:return this.pos++,this.finishToken(Nt.parenL,"(");case 41:return this.pos++,this.finishToken(Nt.parenR,")");case 42:return this.pos++,this.finishToken(Nt.times,"*");case 43:return this.pos++,this.allowPrefix?this.finishToken(Nt.prefixPlus,"+"):this.finishToken(Nt.plus,"+");case 45:return this.pos++,this.allowPrefix?this.finishToken(Nt.prefixMinus,"-"):this.finishToken(Nt.minus,"-");case 47:return this.pos++,this.finishToken(Nt.div,"/");default:if(RE(e))return this.readIdentifier()}this.unexpected(this.input[this.pos])}readIdentifier(){const e=this.pos;for(;this.isValidPosition();){const r=this.codeAt(this.pos);if(tS(r))this.pos++;else break}const t=this.input.slice(e,this.pos);this.finishToken(Nt.identifier,t)}finishToken(e,t=""){const r=this.tokenType;this.end=this.pos,this.tokenType=e,this.value=t,this.updateContext(r)}updateContext(e){const t=this.tokenType;t.isBinary||t.isPrefix?this.allowPrefix=!0:t.updateContext&&t.updateContext.call(this,e)}codeAt(e){return this.input.charCodeAt(e)}isValidPosition(){return this.pos<this.input.length}startNode(e){return new ym(e??this.start)}finishNode(e,t){return e.type=t,e.end=this.lastTokenEnd,e}skipSpace(){for(;this.isValidPosition();){const e=this.codeAt(this.pos);if(e===32||e===160)this.pos++;else if(e===13||e===10||e===8232||e===8233)e===13&&this.codeAt(this.pos+1)===10&&this.pos++,this.pos++;else if(e>8&&e<14)this.pos++;else break}}expect(e){this.eat(e)||this.unexpected(this.value)}eat(e){return this.tokenType===e?(this.next(),!0):!1}unexpected(e="",t){this.raise(t??this.start,`Unexpected token ${e}`)}raise(e,t){throw e>this.input.length-1?t="Unexpected end of input":t+=` at position ${e}`,new SyntaxError(t)}}Object.defineProperty(Mn,"Node",{enumerable:!0,configurable:!0,writable:!0,value:ym});Object.defineProperty(Mn,"TokenType",{enumerable:!0,configurable:!0,writable:!0,value:jr});Object.defineProperty(Mn,"tokenTypes",{enumerable:!0,configurable:!0,writable:!0,value:Nt});Object.defineProperty(Mn,"installedOperators",{enumerable:!0,configurable:!0,writable:!0,value:$s});const vE=Mn.evaluate;Mn.createBinaryOperator=sS;Mn.createUnaryOperator=iS;Mn.useOperator=nS;Mn.useAdapter=oS;const pS={"+":(i,e)=>XT(Pt.from(i),Pt.from(e)).toString(),"-":(i,e)=>ZT(Pt.from(i),Pt.from(e)).toString(),"*":(i,e)=>OE(Pt.from(i),Pt.from(e)).toString(),"/":(i,e)=>eS(Pt.from(i),Pt.from(e)).toString()};Mn.useAdapter(pS);var Qu;let _l=Qu=class extends wi{toJSON(){return{...super.toJSON(),calc:this.calc,precision:this.precision}}evaluate(e){return vE(this.calc,e)}};h([A.d(Qu.INC++,"string"),u("design:type",String)],_l.prototype,"calc",void 0);h([A.d(Qu.INC++,"string"),u("design:type",String)],_l.prototype,"precision",void 0);_l=Qu=h([v.d("CalcInputModel")],_l);let Al=class extends ms{};Al=h([v.d("TextInputModel")],Al);let sg=class extends Al{};sg=h([v.d("AddressInputModel")],sg);let ig=class extends Al{};ig=h([v.d("SignatureInputModel")],ig);const k_=(()=>{const i=new Map,e=new Map;return[[pr.NUMBER,wi],[pr.CALC,_l],[pr.TEXT,Al],[pr.ADDRESS,sg],[pr.SIGNATURE,ig]].forEach(([t,r])=>{i.set(t,r),e.set(r,t)}),{VM:i,MV:e}})();var Wu;const{ArgumentFormatException:fh,error:TO,IllegalStateException:SO}=re("MODEL","transactionModel");let ro=Wu=class extends Y{get inputs(){return this.inputBufferList.map(e=>{const t=ms.decode(e),r=k_.VM.get(t.type);if(!r)throw new fh(c.INVALID_MACRO_INPUT_TYPE,{type_base:t.type});return r.decode(e)})}set inputs(e){const t=e.map(r=>r.getBytes());this.inputBufferList=t}get template(){const{templateBuffer:e}=this,t=Ie.decode(e),r=je.trsTypeToV(t.type),n=je.VM.get(r);if(!n)throw new fh(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:r});return n.decode(e)}set template(e){this.templateBuffer=e.getBytes()}toJSON(){return{inputs:this.inputs.map(t=>t.toJSON()),template:this.template.toJSON()}}static fromObject(e){const t=super.fromObject(e);if(t!==e){if(e.inputs){const r=e.inputs,n=[];for(const s of r)if(s instanceof Y)n.push(s);else{const o=s.type,a=k_.VM.get(o);if(!a)throw new fh(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:o});n.push(a.fromObject(s))}t.inputs=n}if(e.template){const r=e.template;if(r instanceof Y)t.template=r;else{const n=r.type;if(n){const s=je.trsTypeToV(n),o=je.VM.get(s);if(!o)throw new fh(c.INVALID_TRANSACTION_BASE_TYPE,{type_base:s});t.template=o.fromObject(r)}}}}return t}};ro.INC=1;h([A.d(Wu.INC++,"bytes","repeated"),u("design:type",Array)],ro.prototype,"inputBufferList",void 0);h([A.d(Wu.INC++,"bytes"),u("design:type",Uint8Array)],ro.prototype,"templateBuffer",void 0);ro=Wu=h([v.d("MacroModel")],ro);let El=class extends Y{toJSON(){return{macro:this.macro.toJSON()}}};h([A.d(1,ro),u("design:type",ro)],El.prototype,"macro",void 0);El=h([v.d("MacroAssetModel")],El);var _m;let Ra=_m=class extends Ie{};h([A.d(_m.INC++,El),u("design:type",El)],Ra.prototype,"asset",void 0);Ra=_m=h([v.d("MacroTransaction")],Ra);var qu;const lS=new ps(i=>new Bi(i.inputs));let no=qu=class extends Y{get macroId(){return Me(this.macroIdBuffer)}set macroId(e){this.macroIdBuffer=he(e)}get inputMap(){return lS.forceGet(this)}toJSON(){return{macroId:this.macroId,inputs:this.inputs}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.macroId&&(t.macroId=e.macroId),t}};no.INC=1;h([A.d(qu.INC++,"bytes"),u("design:type",Uint8Array)],no.prototype,"macroIdBuffer",void 0);h([Er.d(qu.INC++,"string","string"),u("design:type",Object)],no.prototype,"inputs",void 0);no=qu=h([v.d("MacroCallModel")],no);let Il=class extends Y{toJSON(){return{call:this.call.toJSON()}}};h([A.d(1,no),u("design:type",no)],Il.prototype,"call",void 0);Il=h([v.d("MacroCallAssetModel")],Il);var Am;let Pa=Am=class extends Ie{};h([A.d(Am.INC++,Il),u("design:type",Il)],Pa.prototype,"asset",void 0);Pa=Am=h([v.d("MacroCallTransaction")],Pa);je.VM.set(H.CUSTOM,Ia);je.MV.set(Ia,H.CUSTOM);je.VM.set(H.REGISTER_CHAIN,Ta);je.MV.set(Ta,H.REGISTER_CHAIN);je.VM.set(H.MULTIPLE,wa);je.MV.set(wa,H.MULTIPLE);je.VM.set(H.PROMISE,Na);je.MV.set(Na,H.PROMISE);je.VM.set(H.PROMISE_RESOLVE,Oa);je.MV.set(Oa,H.PROMISE_RESOLVE);je.VM.set(H.MACRO,Ra);je.MV.set(Ra,H.MACRO);je.VM.set(H.MACRO_CALL,Pa);je.MV.set(Pa,H.MACRO_CALL);var No,li;(function(i){i[i.INDETERMINATE=0]="INDETERMINATE",i[i.DETERMINATE=1]="DETERMINATE",i[i.BUFFER=2]="BUFFER",i[i.QUERY=3]="QUERY"})(li||(li={}));let Fr=No=class extends Y{get loaded(){return this._loaded>this.total?this.total:this._loaded}set loaded(e){this._loaded=e}get buffer(){return this._buffer&&this._buffer>this.total?this.total:this._buffer}set buffer(e){this._buffer=e}toJSON(){var e;const t={type:this.type,mode:this.mode,loaded:this.loaded,buffer:this.buffer,total:this.total};return(e=this.buffer)!==null&&e!==void 0||(t.buffer=this.buffer),t}static fromObject(e){const t=super.fromObject(e);return e.loaded&&(t.loaded=e.loaded),e.buffer&&(t.buffer=e.buffer),t}};Fr.INC=1;h([A.d(No.INC++,"string"),u("design:type",String)],Fr.prototype,"type",void 0);h([A.d(No.INC++,li),u("design:type",Number)],Fr.prototype,"mode",void 0);h([A.d(No.INC++,"uint32"),u("design:type",Number)],Fr.prototype,"_loaded",void 0);h([A.d(No.INC++,"uint32","optional"),u("design:type",Number)],Fr.prototype,"_buffer",void 0);h([A.d(No.INC++,"uint32"),u("design:type",Number)],Fr.prototype,"total",void 0);Fr=No=h([v.d("ProgressEvent")],Fr);var Em;let Yh=Em=class extends Fr{toJSON(){return Object.assign({finishedDetails:this.finishedDetails.map(e=>e.toJSON())},super.toJSON())}};h([A.d(Em.INC++,na,"repeated"),u("design:type",Array)],Yh.prototype,"finishedDetails",void 0);Yh=Em=h([v.d("TransactionsProgressEvent")],Yh);var Xu;let bi=Xu=class extends Fr{toJSON(){return Object.assign({finishedDetails:this.finishedDetails.map(e=>e.toJSON()),processingDetails:this.processingDetails},super.toJSON())}};h([A.d(Xu.INC++,na,"repeated"),u("design:type",Array)],bi.prototype,"finishedDetails",void 0);h([Er.d(Xu.INC++,"uint32",Yh),u("design:type",Object)],bi.prototype,"processingDetails",void 0);bi=Xu=h([v.d("BlocksProgressEvent")],bi);var Im;let Us=Im=class extends Fr{toJSON(){return Object.assign({currentBlockDetails:this.currentBlockDetails.toJSON()},super.toJSON())}};h([A.d(Im.INC++,bi),u("design:type",bi)],Us.prototype,"currentBlockDetails",void 0);Us=Im=h([v.d("BlockchainRebuidingProgressEvent")],Us);let Ba=class extends Fr{};Ba=h([v.d("BlockchainPeerScanningProgressEvent")],Ba);let Ni=class extends Fr{toJSON(){const e={};for(const r in this.applyDetails)e[r]=this.applyDetails[r].toJSON();const t={};for(const r in this.syncDetails)t[r]=this.syncDetails[r].toJSON();return Object.assign({applyDetails:e,syncDetails:t},super.toJSON())}};h([Er.d(Us.INC++,"uint32",bi),u("design:type",Object)],Ni.prototype,"applyDetails",void 0);h([Er.d(Us.INC++,"uint32",bi),u("design:type",Object)],Ni.prototype,"syncDetails",void 0);Ni=h([v.d("BlockchainReplayBlockProgressEvent")],Ni);let Ma=class extends Fr{};Ma=h([v.d("BlockchainRollbackProgressEventModel")],Ma);let va=class extends Fr{};va=h([v.d("BlockchainGeneratingProgressEvent")],va);var Re;(function(i){i[i.error=0]="error",i[i.busy=1]="busy",i[i.success=2]="success",i[i.idempotentError=3]="idempotentError"})(Re||(Re={}));var rn;(function(i){i[i.OFFLINE=0]="OFFLINE",i[i.FREE=1]="FREE",i[i.REBUIDING=2]="REBUIDING",i[i.PEER_SCANNING=3]="PEER_SCANNING",i[i.REPLAY_BLOCK=4]="REPLAY_BLOCK",i[i.GENERATING=5]="GENERATING",i[i.ROLLBACK=6]="ROLLBACK"})(rn||(rn={}));var Qh;(function(i){i[i.Refuse=0]="Refuse",i[i.InBlock=1]="InBlock",i[i.InUnconfirmQuene=2]="InUnconfirmQuene"})(Qh||(Qh={}));var be;(function(i){i[i.FEE_LESS_THAN_WEB_FEE=0]="FEE_LESS_THAN_WEB_FEE",i[i.TRS_EXPRIED=1]="TRS_EXPRIED",i[i.TRANSACTION_IN_UNTREATEDTR=2]="TRANSACTION_IN_UNTREATEDTR",i[i.TRANSACTION_IN_TRS=3]="TRANSACTION_IN_TRS",i[i.TRANSACTION_BASE_TYPE_NOT_FOUND=4]="TRANSACTION_BASE_TYPE_NOT_FOUND",i[i.TRANSACTION_BASE_NOT_FOUND=5]="TRANSACTION_BASE_NOT_FOUND",i[i.CHAIN_ASSET_NOT_ENOUGH=6]="CHAIN_ASSET_NOT_ENOUGH",i[i.ASSET_NOT_ENOUGH=7]="ASSET_NOT_ENOUGH",i[i.TRANSACTION_SENDER_ASSET_FROZEN=8]="TRANSACTION_SENDER_ASSET_FROZEN",i[i.TRANSACTION_RECIPIENT_ASSET_FROZEN=9]="TRANSACTION_RECIPIENT_ASSET_FROZEN",i[i.TRANSACTION_FEE_NOT_ENOUGH=10]="TRANSACTION_FEE_NOT_ENOUGH",i[i.MUSET_VOTE_FOR_DAPP_POSSESSOR=11]="MUSET_VOTE_FOR_DAPP_POSSESSOR",i[i.TRANSACTION_ASSET_DEBT=12]="TRANSACTION_ASSET_DEBT",i[i.LOCATION_NAME_NOT_EXIST=13]="LOCATION_NAME_NOT_EXIST",i[i.ACCOUNT_NOT_LNS_POSSESSOR=14]="ACCOUNT_NOT_LNS_POSSESSOR",i[i.DAPP_ALREADY_EXISTS=15]="DAPP_ALREADY_EXISTS",i[i.ACCOUNT_ALREADY_DELEGATE=16]="ACCOUNT_ALREADY_DELEGATE",i[i.ASSETTYPE_ALREADY_EXIST=17]="ASSETTYPE_ALREADY_EXIST",i[i.CHAINNAME_ALREADY_EXIST=18]="CHAINNAME_ALREADY_EXIST",i[i.ASSET_ALREADY_EXIST=19]="ASSET_ALREADY_EXIST",i[i.LOCATION_NAME_ALREADY_EXIST=20]="LOCATION_NAME_ALREADY_EXIST",i[i.CAN_NOT_SET_FROZEN_ACCOUNT_AS_MANAGER=21]="CAN_NOT_SET_FROZEN_ACCOUNT_AS_MANAGER",i[i.CAN_NOT_SET_SAME_ACCOUNT_AS_MANAGER=22]="CAN_NOT_SET_SAME_ACCOUNT_AS_MANAGER",i[i.SET_LNS_MANAGER_PERMISSION_DENIED=23]="SET_LNS_MANAGER_PERMISSION_DENIED",i[i.SET_LNS_RECORD_VALUE_PERMISSION_DENIED=24]="SET_LNS_RECORD_VALUE_PERMISSION_DENIED",i[i.ACCOUNT_ALREADY_HAVE_USERNAME=25]="ACCOUNT_ALREADY_HAVE_USERNAME",i[i.USERNAME_ALREADY_EXIST=26]="USERNAME_ALREADY_EXIST",i[i.ACCOUNT_ALREADY_VOTED_FOR_DELEGATE=27]="ACCOUNT_ALREADY_VOTED_FOR_DELEGATE",i[i.TRS_IN_FEATURE=28]="TRS_IN_FEATURE",i[i.TRANSACTION_POW_CHECK_FIELD=29]="TRANSACTION_POW_CHECK_FIELD",i[i.TRUST_MAIN_ASSET_ONLY=30]="TRUST_MAIN_ASSET_ONLY",i[i.USE_MAIN_ASSET_PURCHASE_ONLY=31]="USE_MAIN_ASSET_PURCHASE_ONLY",i[i.ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH=32]="ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH",i[i.ACCOUNT_IS_NOT_AN_DELEGATE=33]="ACCOUNT_IS_NOT_AN_DELEGATE",i[i.DELEGATE_IS_ALREADY_REJECT_VOTE=34]="DELEGATE_IS_ALREADY_REJECT_VOTE",i[i.MIGRATE_MAIN_ASSET_ONLY=35]="MIGRATE_MAIN_ASSET_ONLY",i[i.ASSET_IS_ALREADY_MIGRATION=36]="ASSET_IS_ALREADY_MIGRATION",i[i.MAGIC_ALREADY_EXIST=37]="MAGIC_ALREADY_EXIST",i[i.ENTITY_FACTORY_ALREADY_EXIST=38]="ENTITY_FACTORY_ALREADY_EXIST",i[i.ENTITY_FACTORY_NOT_EXIST=39]="ENTITY_FACTORY_NOT_EXIST",i[i.ENTITY_ALREADY_EXIST=40]="ENTITY_ALREADY_EXIST",i[i.ENTITY_NOT_EXIST=41]="ENTITY_NOT_EXIST",i[i.ACCOUNT_NOT_ENTITY_POSSESSOR=42]="ACCOUNT_NOT_ENTITY_POSSESSOR",i[i.DELEGATE_IS_ALREADY_ACCEPT_VOTE=43]="DELEGATE_IS_ALREADY_ACCEPT_VOTE",i[i.ACCOUNT_NOT_DAPPID_POSSESSOR=44]="ACCOUNT_NOT_DAPPID_POSSESSOR",i[i.ASSET_NOT_EXIST=45]="ASSET_NOT_EXIST",i[i.DAPPID_NOT_EXIST=46]="DAPPID_NOT_EXIST",i[i.CERTIFICATE_ALREADY_EXIST=47]="CERTIFICATE_ALREADY_EXIST",i[i.CERTIFICATE_NOT_EXIST=48]="CERTIFICATE_NOT_EXIST",i[i.ACCOUNT_NOT_CERTIFICATE_POSSESSOR=49]="ACCOUNT_NOT_CERTIFICATE_POSSESSOR"})(be||(be={}));var Te;(function(i){i[i.REFUSE=0]="REFUSE",i[i.RESPONSE=1]="RESPONSE",i[i.QUERY_TRANSACTION=2]="QUERY_TRANSACTION",i[i.NEW_TRANSACTION=4]="NEW_TRANSACTION",i[i.QUERY_BLOCK=8]="QUERY_BLOCK",i[i.NEW_BLOCK=16]="NEW_BLOCK",i[i.GET_PEER_INFO=32]="GET_PEER_INFO",i[i.INDEX_TRANSACTION=64]="INDEX_TRANSACTION",i[i.DOWNLOAD_TRANSACTION=128]="DOWNLOAD_TRANSACTION",i[i.OPEN_BLOB=256]="OPEN_BLOB",i[i.READ_BLOB=512]="READ_BLOB",i[i.CLOSE_BLOB=1024]="CLOSE_BLOB",i[i.QUERY_TINDEX=2048]="QUERY_TINDEX",i[i.GET_TRANSACTIONINBLOCK=4096]="GET_TRANSACTIONINBLOCK",i[i.QUERY_TRANSACTION_RETURN=3]="QUERY_TRANSACTION_RETURN",i[i.NEW_TRANSACTION_RETURN=5]="NEW_TRANSACTION_RETURN",i[i.QUERY_BLOCK_RETURN=9]="QUERY_BLOCK_RETURN",i[i.NEW_BLOCK_RETURN=17]="NEW_BLOCK_RETURN",i[i.GET_PEER_INFO_RETURN=33]="GET_PEER_INFO_RETURN",i[i.INDEX_TRANSACTION_RETURN=65]="INDEX_TRANSACTION_RETURN",i[i.DOWNLOAD_TRANSACTION_RETURN=129]="DOWNLOAD_TRANSACTION_RETURN",i[i.OPEN_BLOB_RETURN=257]="OPEN_BLOB_RETURN",i[i.READ_BLOB_RETURN=513]="READ_BLOB_RETURN",i[i.CLOSE_BLOB_RETURN=1025]="CLOSE_BLOB_RETURN",i[i.QUERY_TINDEX_RETURN=2049]="QUERY_TINDEX_RETURN",i[i.GET_TRANSACTIONINBLOCK_RETURN=4097]="GET_TRANSACTIONINBLOCK_RETURN"})(Te||(Te={}));var og,Zu;let xt=og=class extends Y{constructor(){super(...arguments),this._parsed_detail=!1}get detail(){if(!this._parsed_detail){this._parsed_detail=!0;try{this._detail=this.detailJSON?JSON.parse(this.detailJSON):{}}catch{this._detail={}}}return this._detail}set detail(e){this.detailJSON=JSON.stringify(e),this._detail=e,this._parsed_detail=!0}static fromException(e){const t=og.fromObject(e);return t.detail=e.detail,t}toJSON(){return{message:this.message,detailJSON:this.detailJSON,PLATFORM:this.PLATFORM,CHANNEL:this.CHANNEL,BUSINESS:this.BUSINESS,MODULE:this.MODULE,FILE:this.FILE,CODE:this.CODE}}};h([A.d(1,"string"),u("design:type",String)],xt.prototype,"message",void 0);h([A.d(2,"string","required",""),u("design:type",String)],xt.prototype,"detailJSON",void 0);h([A.d(3,"string","optional"),u("design:type",String)],xt.prototype,"PLATFORM",void 0);h([A.d(4,"string","optional"),u("design:type",String)],xt.prototype,"CHANNEL",void 0);h([A.d(5,"string","optional"),u("design:type",String)],xt.prototype,"BUSINESS",void 0);h([A.d(6,"string","optional"),u("design:type",String)],xt.prototype,"MODULE",void 0);h([A.d(7,"string","optional"),u("design:type",String)],xt.prototype,"FILE",void 0);h([A.d(8,"string","optional"),u("design:type",String)],xt.prototype,"CODE",void 0);xt=og=h([v.d("ExceptionMessage")],xt);let rr=Zu=class extends Y{toJSON(){const e={status:this.status};return this.error&&(e.error=this.error.toJSON()),e}};rr.INC=1;h([A.d(Zu.INC++,Re),u("design:type",Number)],rr.prototype,"status",void 0);h([A.d(Zu.INC++,xt,"optional"),u("design:type",xt)],rr.prototype,"error",void 0);rr=Zu=h([v.d("CommonResponse")],rr);var nr,Tm,Sm,wm,bm,Nm,xm,xo,Om,Cm;let ht=nr=class extends Y{get signature(){return this.signatureBuffer&&Me(this.signatureBuffer)||void 0}set signature(e){this.signatureBuffer=he(e)}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.signature&&(t.signature=e.signature),t}toJSON(){return{type:this.type,types:this.types,signature:this.signature,senderId:this.senderId,recipientId:this.recipientId,dappid:this.dappid,lns:this.lns,storage:this.storage,blockSignature:this.blockSignature,minHeight:this.minHeight,maxHeight:this.maxHeight,trusteeId:this.trusteeId,purchaseDAppid:this.purchaseDAppid,range:this.range,offset:this.offset,limit:this.limit,address:this.address}}};ht.INC=1;h([A.d(nr.INC++,"string","optional"),u("design:type",String)],ht.prototype,"type",void 0);h([A.d(nr.INC++,"string","repeated"),u("design:type",Array)],ht.prototype,"types",void 0);h([A.d(nr.INC++,"bytes","optional"),u("design:type",Uint8Array)],ht.prototype,"signatureBuffer",void 0);h([A.d(nr.INC++,"string","optional"),u("design:type",String)],ht.prototype,"senderId",void 0);h([A.d(nr.INC++,"string","optional"),u("design:type",String)],ht.prototype,"recipientId",void 0);h([A.d(nr.INC++,"string","optional"),u("design:type",String)],ht.prototype,"dappid",void 0);h([A.d(nr.INC++,"string","optional"),u("design:type",String)],ht.prototype,"lns",void 0);h([A.d(nr.INC++,hs,"optional"),u("design:type",hs)],ht.prototype,"storage",void 0);h([A.d(nr.INC++,"string","optional"),u("design:type",String)],ht.prototype,"blockSignature",void 0);h([A.d(nr.INC++,"uint32","optional"),u("design:type",Number)],ht.prototype,"minHeight",void 0);h([A.d(nr.INC++,"uint32","optional"),u("design:type",Number)],ht.prototype,"maxHeight",void 0);h([A.d(nr.INC++,"string","optional"),u("design:type",String)],ht.prototype,"trusteeId",void 0);h([A.d(nr.INC++,"string","optional"),u("design:type",String)],ht.prototype,"purchaseDAppid",void 0);h([A.d(nr.INC++,"uint32"),u("design:type",Number)],ht.prototype,"offset",void 0);h([A.d(nr.INC++,"uint32","optional"),u("design:type",Number)],ht.prototype,"limit",void 0);h([A.d(nr.INC++,"string","optional"),u("design:type",String)],ht.prototype,"range",void 0);h([A.d(nr.INC++,"string","optional"),u("design:type",String)],ht.prototype,"address",void 0);ht=nr=h([v.d("TransactionQueryOptions")],ht);let on=Tm=class extends Y{toJSON(){return{tIndex:this.tIndex}}};on.INC=1;h([A.d(Tm.INC++,"int32","required",1),u("design:type",Number)],on.prototype,"tIndex",void 0);on=Tm=h([v.d("TransactionSortOptions")],on);let so=class extends Y{toJSON(){return{query:this.query.toJSON(),sort:this.sort.toJSON()}}};h([A.d(1,ht),u("design:type",ht)],so.prototype,"query",void 0);h([A.d(2,on),u("design:type",on)],so.prototype,"sort",void 0);so=h([v.d("QueryTransactionArg")],so);let La=Sm=class extends rr{toJSON(){return Object.assign({transactions:this.transactions.map(e=>e.toJSON())},super.toJSON())}};h([A.d(Sm.INC++,Gt,"repeated"),u("design:type",Array)],La.prototype,"transactions",void 0);La=Sm=h([v.d("QueryTransactionReturn")],La);let Tl=class extends Y{toJSON(){return{query:this.query,sort:this.sort}}};h([A.d(1,ht),u("design:type",ht)],Tl.prototype,"query",void 0);h([A.d(2,on),u("design:type",on)],Tl.prototype,"sort",void 0);Tl=h([v.d("QueryTindexArg")],Tl);let Da=wm=class extends rr{toJSON(){return Object.assign({tIndexes:this.tIndexes},super.toJSON())}};h([A.d(wm.INC++,"uint32","repeated"),u("design:type",Array)],Da.prototype,"tIndexes",void 0);Da=wm=h([v.d("QueryTindexReturn")],Da);let io=bm=class extends Y{static fromObject(e){return super.fromObject(e)}toJSON(){return{tIndexRanges:this.tIndexRanges}}};io.INC=1;h([A.d(bm.INC++,"uint32","repeated"),u("design:type",Array)],io.prototype,"tIndexRanges",void 0);io=bm=h([v.d("TransactionInBlockGetOptions")],io);let Sl=class extends Y{toJSON(){return{query:this.query}}};h([A.d(1,io),u("design:type",io)],Sl.prototype,"query",void 0);Sl=h([v.d("GetTransactionInBlockArg")],Sl);let ka=Nm=class extends rr{toJSON(){return Object.assign({transactionInBlocks:this.transactionInBlocks.map(e=>e.toJSON())},super.toJSON())}};h([A.d(Nm.INC++,Gt,"repeated"),u("design:type",Array)],ka.prototype,"transactionInBlocks",void 0);ka=Nm=h([v.d("GetTransactionInBlockReturn")],ka);let wl=xm=class extends qi{static fromObject(e){return super.fromObject(e)}};h([A.d(xm.INC++,"string","optional"),u("design:type",String)],wl.prototype,"grabSecret",void 0);wl=xm=h([v.d("NewTransactionArg")],wl);let _s=xo=class extends rr{toJSON(){var e,t,r;const n=Object.assign({newTrsStatus:this.newTrsStatus,minFee:this.minFee},super.toJSON());return(e=this.refuseReason)!==null&&e!==void 0||(n.refuseReason=this.refuseReason),(t=this.errorCode)!==null&&t!==void 0||(n.errorCode=this.errorCode),(r=this.errorMessage)!==null&&r!==void 0||(n.errorMessage=this.errorMessage),n}};h([A.d(xo.INC++,Qh,"required",Qh.Refuse),u("design:type",Number)],_s.prototype,"newTrsStatus",void 0);h([A.d(xo.INC++,"string","required","0"),u("design:type",String)],_s.prototype,"minFee",void 0);h([A.d(xo.INC++,be,"optional"),u("design:type",Number)],_s.prototype,"refuseReason",void 0);h([A.d(xo.INC++,"string","optional"),u("design:type",String)],_s.prototype,"errorCode",void 0);h([A.d(xo.INC++,"string","optional"),u("design:type",String)],_s.prototype,"errorMessage",void 0);_s=xo=h([v.d("NewTransactionReturn")],_s);let As=class extends Y{toJSON(){const e={height:this.height,tIndex:this.tIndex,length:this.length};return this.blockSignature&&(e.blockSignature=this.blockSignature),e}};h([A.d(1,"uint32"),u("design:type",Number)],As.prototype,"height",void 0);h([A.d(2,"uint32"),u("design:type",Number)],As.prototype,"tIndex",void 0);h([A.d(3,"uint32","required",1),u("design:type",Number)],As.prototype,"length",void 0);h([A.d(4,"string"),u("design:type",String)],As.prototype,"blockSignature",void 0);As=h([v.d("TransactionIndexModel")],As);let bl=class extends Y{toJSON(){return{query:this.query.toJSON(),sort:this.sort.toJSON()}}};h([A.d(1,ht),u("design:type",ht)],bl.prototype,"query",void 0);h([A.d(2,on),u("design:type",on)],bl.prototype,"sort",void 0);bl=h([v.d("IndexTransactionArg")],bl);let Ha=Om=class extends rr{toJSON(){return Object.assign({tIndexes:this.tIndexes.map(e=>e.toJSON())},super.toJSON())}};h([A.d(Om.INC++,As,"repeated"),u("design:type",Array)],Ha.prototype,"tIndexes",void 0);Ha=Om=h([v.d("IndexTransactionReturn")],Ha);let Nl=class extends Y{toJSON(){return{tIndexes:this.tIndexes.map(e=>e.toJSON())}}};h([A.d(1,As,"repeated"),u("design:type",Array)],Nl.prototype,"tIndexes",void 0);Nl=h([v.d("DownloadTransactionArg")],Nl);let Fa=Cm=class extends rr{toJSON(){return Object.assign({transactions:this.transactions.map(e=>e.toJSON())},super.toJSON())}};h([A.d(Cm.INC++,Gt,"repeated"),u("design:type",Array)],Fa.prototype,"transactions",void 0);Fa=Cm=h([v.d("DownloadTransactionReturn")],Fa);var th,rh,Rm,nh;let xi=th=class extends Y{get hash(){return Me(this.hashBuffer)}set hash(e){this.hashBuffer=he(e)}toJSON(){return{algorithm:this.algorithm,hash:this.hash,downloadSize:this.downloadSize}}static fromObject(e){const t=super.fromObject(e);return e.hash&&(t.hash=e.hash),t}};xi.INC=1;h([A.d(th.INC++,"string"),u("design:type",String)],xi.prototype,"algorithm",void 0);h([A.d(th.INC++,"bytes"),u("design:type",Uint8Array)],xi.prototype,"hashBuffer",void 0);h([A.d(th.INC++,"int32"),u("design:type",Number)],xi.prototype,"downloadSize",void 0);xi=th=h([v.d("OpenBlobArgModel")],xi);let Oi=rh=class extends rr{toJSON(){const e=super.toJSON();return e.descriptor=this.descriptor,e.contentType=this.contentType,e}static fromObject(e){return super.fromObject(e)}};h([A.d(rh.INC++,"string","optional"),u("design:type",String)],Oi.prototype,"descriptor",void 0);h([A.d(rh.INC++,"string","optional"),u("design:type",String)],Oi.prototype,"contentType",void 0);h([A.d(rh.INC++,"uint32","optional"),u("design:type",Number)],Oi.prototype,"size",void 0);Oi=rh=h([v.d("OpenBlobReturn")],Oi);let Va=Rm=class extends Y{toJSON(){return{descriptor:this.descriptor}}};Va.INC=1;h([A.d(Rm.INC++,"string"),u("design:type",String)],Va.prototype,"descriptor",void 0);Va=Rm=h([v.d("CloseBlobArg")],Va);let xl=class extends rr{};xl=h([v.d("CloseBlobReturn")],xl);let Ks=nh=class extends Y{toJSON(){return{descriptor:this.descriptor,start:this.start,end:this.end}}};Ks.INC=1;h([A.d(nh.INC++,"string"),u("design:type",String)],Ks.prototype,"descriptor",void 0);h([A.d(nh.INC++,"uint32"),u("design:type",Number)],Ks.prototype,"start",void 0);h([A.d(nh.INC++,"uint32"),u("design:type",Number)],Ks.prototype,"end",void 0);Ks=nh=h([v.d("ReadBlobArg")],Ks);let oo=class extends rr{get chunk(){return Me(this.chunkBuffer)}set chunk(e){this.chunkBuffer=he(e)}toJSON(){const e=super.toJSON();return e.chunk=this.chunk,e}static fromObject(e){const t=super.fromObject(e);return e.chunk&&(t.chunk=e.chunk),t}};oo.INC=1;h([A.d(Ks.INC++,"bytes"),u("design:type",Uint8Array)],oo.prototype,"chunkBuffer",void 0);oo=h([v.d("ReadBlobReturn")],oo);var Pm,Zn;let ao=class extends Y{toJSON(){const e=super.toJSON();return this.signature&&(e.signature=this.signature),this.height&&(e.height=this.height),e}};h([A.d(1,"string","optional"),u("design:type",String)],ao.prototype,"signature",void 0);h([A.d(2,"uint32","optional"),u("design:type",Number)],ao.prototype,"height",void 0);ao=h([v.d("BlockQueryOptions")],ao);let $a=class extends Y{toJSON(){return{query:this.query.toJSON()}}};h([A.d(1,ao),u("design:type",ao)],$a.prototype,"query",void 0);$a=h([v.d("QueryBlockArg")],$a);let Ua=Pm=class extends rr{toJSON(){const e=super.toJSON();return this.someBlock&&(e.someBlock=this.someBlock.toJSON()),e}};h([A.d(Pm.INC++,Si,"optional"),u("design:type",Si)],Ua.prototype,"someBlock",void 0);Ua=Pm=h([v.d("QueryBlockReturn")],Ua);let Vr=Zn=class extends Y{get generatorPublicKey(){return Me(this.generatorPublicKeyBuffer)}set generatorPublicKey(e){this.generatorPublicKeyBuffer=he(e)}toJSON(){return{height:this.height,signature:this.signature,previousBlockSignature:this.previousBlockSignature,timestamp:this.timestamp,totalFee:this.totalFee,numberOfTransactions:this.numberOfTransactions,generatorPublicKey:this.generatorPublicKey,blockParticipation:this.blockParticipation,version:this.version}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.generatorPublicKey&&(t.generatorPublicKey=e.generatorPublicKey),t}};Vr.INC=1;h([A.d(Zn.INC++,"uint32"),u("design:type",Number)],Vr.prototype,"height",void 0);h([A.d(Zn.INC++,"string"),u("design:type",String)],Vr.prototype,"signature",void 0);h([A.d(Zn.INC++,"string"),u("design:type",String)],Vr.prototype,"previousBlockSignature",void 0);h([A.d(Zn.INC++,"uint32"),u("design:type",Number)],Vr.prototype,"timestamp",void 0);h([A.d(Zn.INC++,"string"),u("design:type",String)],Vr.prototype,"totalFee",void 0);h([A.d(Zn.INC++,"uint32"),u("design:type",Number)],Vr.prototype,"numberOfTransactions",void 0);h([A.d(Zn.INC++,"bytes"),u("design:type",Uint8Array)],Vr.prototype,"generatorPublicKeyBuffer",void 0);h([A.d(Zn.INC++,"string"),u("design:type",String)],Vr.prototype,"blockParticipation",void 0);h([A.d(Zn.INC++,"uint32"),u("design:type",Number)],Vr.prototype,"version",void 0);Vr=Zn=h([v.d("NewBlockArg")],Vr);let Ka=class extends rr{};Ka=h([v.d("NewBlockReturn")],Ka);var vr,Hi,Xs,Bm;const H_=new WeakMap,Rf=new WeakMap;let Ol=class extends Y{toJSON(){return{uid:this.uid}}};h([A.d(1,"uint32","optional"),u("design:type",Number)],Ol.prototype,"uid",void 0);Ol=h([v.d("GetPeerInfoArg")],Ol);let Cl=class extends Y{get peerTime(){return this.peerTimeLong.toNumber()}set peerTime(e){this.peerTimeLong=py.fromNumber(e,!0)}toJSON(){return{peerTime:this.peerTime}}static fromObject(e){const t=super.fromObject(e);return t!==e&&e.peerTime!==void 0&&(t.peerTime=e.peerTime),t}};h([A.d(1,"uint64"),u("design:type",Object)],Cl.prototype,"peerTimeLong",void 0);Cl=h([v.d("PeerConsensus")],Cl);let Wt=vr=class extends Y{get servicePeerInfo(){return{peerInfoDelay:this.peerInfoDelay,onlineUser:this.onlineUser,productivity:this.productivity,paidSourceChainMagic:this.paidSourceChainMagic,paidsourceChainName:this.paidsourceChainName,paidAssetType:this.paidAssetType,paidAmount:this.paidAmount,paidType:this.paidType,serviceNotesName:this.serviceNotesName,noteIP:this.noteIP,delegateAddress:this.delegateAddress,developerVote:this.developerVote,systemDelegateVote:this.systemDelegateVote,dappOnChainBuy:this.dappOnChainBuy}}set servicePeerInfo(e){this.peerInfoDelay=e.peerInfoDelay,this.onlineUser=e.onlineUser,this.productivity=e.productivity,this.paidSourceChainMagic=e.paidSourceChainMagic,this.paidsourceChainName=e.paidsourceChainName,this.paidAssetType=e.paidAssetType,this.paidAmount=e.paidAmount,this.paidType=e.paidType,this.serviceNotesName=e.serviceNotesName,this.noteIP=e.noteIP,this.delegateAddress=e.delegateAddress,this.developerVote=e.developerVote,this.systemDelegateVote=e.systemDelegateVote,this.dappOnChainBuy=e.dappOnChainBuy}toJSON(){return{peerInfoDelay:this.peerInfoDelay,onlineUser:this.onlineUser,productivity:this.productivity,paidSourceChainMagic:this.paidSourceChainMagic,paidsourceChainName:this.paidsourceChainName,paidAssetType:this.paidAssetType,paidAmount:this.paidAmount,paidType:this.paidType,serviceNotesName:this.serviceNotesName,noteIP:this.noteIP,delegateAddress:this.delegateAddress,developerVote:this.developerVote,systemDelegateVote:this.systemDelegateVote,dappOnChainBuy:this.dappOnChainBuy}}static fromObject(e){const t=super.fromObject(e);return t!==e&&(e.peerInfoDelay&&(t.peerInfoDelay=e.peerInfoDelay),e.onlineUser&&(t.onlineUser=e.onlineUser),e.productivity&&(t.productivity=e.productivity),e.paidSourceChainMagic&&(t.paidSourceChainMagic=e.paidSourceChainMagic),e.paidsourceChainName&&(t.paidsourceChainName=e.paidsourceChainName),e.paidAmount&&(t.paidAmount=e.paidAmount),e.paidType&&(t.paidType=e.paidType),e.serviceNotesName&&(t.serviceNotesName=e.serviceNotesName),e.noteIP&&(t.noteIP=e.noteIP),e.delegateAddress&&(t.delegateAddress=e.delegateAddress),e.developerVote&&(t.developerVote=e.developerVote),e.systemDelegateVote&&(t.systemDelegateVote=e.systemDelegateVote),e.dappOnChainBuy&&(t.dappOnChainBuy=e.dappOnChainBuy)),t}};Wt.INC=1;h([A.d(vr.INC++,"uint32"),u("design:type",Number)],Wt.prototype,"peerInfoDelay",void 0);h([A.d(vr.INC++,"uint32"),u("design:type",Number)],Wt.prototype,"onlineUser",void 0);h([A.d(vr.INC++,"uint32"),u("design:type",Number)],Wt.prototype,"productivity",void 0);h([A.d(vr.INC++,"string"),u("design:type",String)],Wt.prototype,"paidSourceChainMagic",void 0);h([A.d(vr.INC++,"string"),u("design:type",String)],Wt.prototype,"paidsourceChainName",void 0);h([A.d(vr.INC++,"string"),u("design:type",String)],Wt.prototype,"paidAssetType",void 0);h([A.d(vr.INC++,"string"),u("design:type",String)],Wt.prototype,"paidAmount",void 0);h([A.d(vr.INC++,"string"),u("design:type",String)],Wt.prototype,"paidType",void 0);h([A.d(vr.INC++,"string"),u("design:type",String)],Wt.prototype,"serviceNotesName",void 0);h([A.d(vr.INC++,"string"),u("design:type",String)],Wt.prototype,"noteIP",void 0);h([A.d(vr.INC++,"string"),u("design:type",String)],Wt.prototype,"delegateAddress",void 0);h([A.d(vr.INC++,"bool"),u("design:type",Boolean)],Wt.prototype,"developerVote",void 0);h([A.d(vr.INC++,"bool"),u("design:type",Boolean)],Wt.prototype,"systemDelegateVote",void 0);h([A.d(vr.INC++,"bool"),u("design:type",Boolean)],Wt.prototype,"dappOnChainBuy",void 0);Wt=vr=h([v.d("ServicePeerInfo")],Wt);let Wn=Hi=class extends Y{get progress(){const{status:e}=this;return e===rn.REBUIDING?{status:e,progressEvent:this.rebuildingProgressEvent}:e===rn.PEER_SCANNING?{status:e,progressEvent:this.peerScanningProgressEvent}:e===rn.REPLAY_BLOCK?{status:e,progressEvent:this.replayBlockProgressEvent}:e===rn.GENERATING?{status:e,progressEvent:this.generatingProgressEvent}:e===rn.ROLLBACK?{status:e,progressEvent:this.rollbackProgressEvent}:{status:e,progressEvent:void 0}}get progressEvent(){return this._progressEvent}set progressEvent(e){e&&(e instanceof Us?this.rebuildingProgressEvent=e:e instanceof Ba?this.peerScanningProgressEvent=e:e instanceof Ni?this.replayBlockProgressEvent=e:e instanceof va?this.generatingProgressEvent=e:e instanceof Ma&&(this.rollbackProgressEvent=e))}get status(){return this._status}set status(e){e!==this._status&&(this._status=e,this._clearProgressEvent(),e===rn.REBUIDING?this.rebuildingProgressEvent=Us.fromObject({mode:li.DETERMINATE}):e===rn.PEER_SCANNING?this.peerScanningProgressEvent=Ba.fromObject({mode:li.BUFFER}):e===rn.REPLAY_BLOCK?this.replayBlockProgressEvent=Ni.fromObject({mode:li.BUFFER}):e===rn.GENERATING?this.generatingProgressEvent=va.fromObject({mode:li.QUERY}):e===rn.ROLLBACK&&(this.rollbackProgressEvent=Ma.fromObject({mode:li.BUFFER})))}_clearProgressEvent(){this.rebuildingProgressEvent=void 0,this.peerScanningProgressEvent=void 0,this.replayBlockProgressEvent=void 0,this.generatingProgressEvent=void 0,this.rollbackProgressEvent=void 0}toJSON(){return this.progress}};Wn.INC=1;h([A.d(Hi.INC++,Us,"optional"),u("design:type",Us)],Wn.prototype,"rebuildingProgressEvent",void 0);h([A.d(Hi.INC++,Ba,"optional"),u("design:type",Ba)],Wn.prototype,"peerScanningProgressEvent",void 0);h([A.d(Hi.INC++,Ni,"optional"),u("design:type",Ni)],Wn.prototype,"replayBlockProgressEvent",void 0);h([A.d(Hi.INC++,va,"optional"),u("design:type",va)],Wn.prototype,"generatingProgressEvent",void 0);h([A.d(Hi.INC++,Ma,"optional"),u("design:type",Ma)],Wn.prototype,"rollbackProgressEvent",void 0);h([A.d(Hi.INC++,rn),u("design:type",Number)],Wn.prototype,"_status",void 0);Wn=Hi=h([v.d("BlockchainStatus")],Wn);let hn=Xs=class extends Y{constructor(){super(...arguments),this._parsed_serviceInfo=!1}get serviceInfo(){return!this._parsed_serviceInfo&&typeof this.serviceInfoJSON=="string"&&(this._parsed_serviceInfo=!0,this._serviceInfo=JSON.parse(this.serviceInfoJSON)),this._serviceInfo}set serviceInfo(e){this.serviceInfoJSON=(this._serviceInfo=e)?JSON.stringify(e):void 0,this._parsed_serviceInfo=!0}get servicePeerInfo(){const{servicePeerInfoBufferList:e}=this;let t=H_.get(e);return t||(t=this.servicePeerInfoBufferList.map(r=>{const n=Wt.decode(r);return Rf.set(n,r),n})),t}set servicePeerInfo(e){const t=e.map(r=>{let n=Rf.get(r);return n||(n=Wt.encode(r).finish(),Rf.set(r,n)),n});H_.set(t,e),this.servicePeerInfoBufferList=t}toJSON(){return{uid:this.uid,height:this.height,blockchainStatus:this.blockchainStatus.toJSON(),serviceInfo:this.serviceInfo,servicePeerInfo:this.servicePeerInfo.map(e=>e.toJSON()),peerConsensus:this.peerConsensus.toJSON(),peerLinkCount:this.peerLinkCount}}static fromObject(e){const t=super.fromObject(e);if(t!==e){const r=[];if(e.servicePeerInfo){const n=e.servicePeerInfo;for(const s of n)r[r.length]=Wt.fromObject(s)}t.servicePeerInfo=r}return t}};hn.INC=1;h([A.d(Xs.INC++,"uint32"),u("design:type",Number)],hn.prototype,"uid",void 0);h([A.d(Xs.INC++,"uint32"),u("design:type",Number)],hn.prototype,"height",void 0);h([A.d(Xs.INC++,Wn),u("design:type",Wn)],hn.prototype,"blockchainStatus",void 0);h([A.d(Xs.INC++,"string","optional"),u("design:type",String)],hn.prototype,"serviceInfoJSON",void 0);h([A.d(Xs.INC++,"bytes","repeated"),u("design:type",Array)],hn.prototype,"servicePeerInfoBufferList",void 0);h([A.d(Xs.INC++,Cl),u("design:type",Cl)],hn.prototype,"peerConsensus",void 0);h([A.d(Xs.INC++,"uint32"),u("design:type",Number)],hn.prototype,"peerLinkCount",void 0);hn=Xs=h([v.d("PeerInfo")],hn);let Ga=Bm=class extends rr{toJSON(){const e=super.toJSON();return this.peerInfo&&(e.peerInfo=this.peerInfo.toJSON()),e}};h([A.d(Bm.INC++,hn,"optional"),u("design:type",hn)],Ga.prototype,"peerInfo",void 0);Ga=Bm=h([v.d("GetPeerInfoReturn")],Ga);var Zs;let an=Zs=class extends Y{};an.INC=1;h([A.d(Zs.INC++,"uint32"),u("design:type",Number)],an.prototype,"version",void 0);h([A.d(Zs.INC++,"uint32"),u("design:type",Number)],an.prototype,"req_id",void 0);h([A.d(Zs.INC++,Te),u("design:type",Number)],an.prototype,"cmd",void 0);h([A.d(Zs.INC++,"bytes"),u("design:type",Uint8Array)],an.prototype,"binary",void 0);h([A.d(Zs.INC++,"uint32"),u("design:type",Number)],an.prototype,"lockTimespan",void 0);h([A.d(Zs.INC++,"uint32"),u("design:type",Number)],an.prototype,"refuseTimespan",void 0);h([A.d(Zs.INC++,"uint32"),u("design:type",Number)],an.prototype,"messageVersion",void 0);an=Zs=h([v.d("ChainChannelMessageModel")],an);function ag(i){return typeof i=="object"&&i!==null&&!(Symbol.iterator in i)}function cg(i){return i.length===1?i[0]:new Proxy(i[0],{get(e,t,r){const n=i.filter(a=>Reflect.has(a,t));if(n.length===0)return;if(n.length===1)return Reflect.get(n[0],t);const s=n.map(a=>Reflect.get(a,t)),o=s.filter(a=>ag(a));return o.length===0?s[s.length-1]:cg(o)},getOwnPropertyDescriptor(e,t){const r=i.filter(a=>Reflect.has(a,t));if(r.length===0)return;if(r.length===1)return Object.getOwnPropertyDescriptor(r[0],t);const n=r.map(a=>({obj:a,value:Reflect.get(a,t)})),s=n.filter(a=>ag(a.value)),o=Object.getOwnPropertyDescriptor(n[n.length-1].obj,t);return s.length===0?o:{...o,value:cg(n.map(a=>a.value))}},ownKeys(){const e=new Set;for(const t of i)for(const r of Reflect.ownKeys(t))e.add(r);return[...e]}})}function LE(...i){const e=i.filter(ag);return e.length===0?{}:cg(e)}var hS=(i,e)=>["%c"+i,e];const fi=Symbol("eventemitter.description"),Ht={head:hS,MIDNIGHTBLUE_BOLD_UNDERLINE:"color:midnightblue;text-decoration: underline;font-weight: bold;",DARKVIOLET_BOLD_UNDERLINE:"color:darkviolet;text-decoration: underline;font-weight: bold;"};function DE(i,e){const t=Object.getOwnPropertyDescriptor(i,"name");t&&t.configurable&&Object.defineProperty(i,"name",{value:e,configurable:!0})}const kE=Cs.getGlobalFlag("BFCHAIN_ENV","development");kE.split(",").map(i=>i.trim());const pg=new Map;for(const i of kE.split(",")){const[e,t]=i.split("=").map(s=>s.trim());let r=e,n=!1;r.startsWith("- ")&&(n=!0,r=r.substr(2)),n?pg.delete(r):pg.set(r,t)}function Rl(i){return pg.has(i)}const nn=Rl("eventemitter")&&Rl("browser");class wn{constructor(){this._e=Object.create(null)}on(e,t,r={}){this._on(e,t,r.taskname,r.once)}_on(e,t,r,n){const s=this._e;let o=s[e];o?o.has(t)&&console.warn(`hanlder '${t.name}' already exits in event set ${e}.`):o=s[e]=new Map,r===void 0&&(r=Zl(this.constructor)),o.set(t,{taskname:r,once:n})}once(e,t,r={}){this._on(e,t,r.taskname,!0)}off(e,t){return this._off(e,t)}_off(e,t){const r=this._e[e];let n=!0;return r?t?r.delete(t)&&r.size===0&&delete this._e[e]:(r.clear(),delete this._e[e]):n=!1,n}get[fi](){return""}emit(e,...t){this._emit(e,t)}_emit(e,t){const r=this._e[e];if(nn&&(console.group(...Ht.head("%s EMIT [%s]",Ht.MIDNIGHTBLUE_BOLD_UNDERLINE),this[fi]||this,e),console.log(...Ht.head("%s ARGS:",Ht.MIDNIGHTBLUE_BOLD_UNDERLINE),...t)),r)for(const[n,s]of r.entries())try{if(nn){const{taskname:a=n.name}=s;console.log(...Ht.head("%s RUN [%s]",Ht.MIDNIGHTBLUE_BOLD_UNDERLINE),this[fi]||this,a)}const o=n(...t);o instanceof Promise&&o.catch(a=>this._emitErrorHanlder(a,e,t))}catch(o){this._emitErrorHanlder(o,e,t)}finally{s.once&&r.delete(n)}nn&&console.groupEnd()}_emitErrorHanlder(e,t,r){if(!this._hasEmitErrorHandlerSet)throw nn&&console.error(`EventEmitter '${this.constructor.name}' emit '${t.toString()}' fail:`,e),e;for(const n of this._emitErrorHandlerSet)n(e,{eventname:t,args:r})}get _emitErrorHandlerSet(){return this._hasEmitErrorHandlerSet=!0,new Set}onError(e,t){typeof t=="string"&&DE(e,t),this._emitErrorHandlerSet.has(e)&&console.warn(`hanlder '${e.name}' already exits in custom error hanlder event set.`),this._emitErrorHandlerSet.add(e)}offError(e){return!!this._hasEmitErrorHandlerSet&&(e?this._emitErrorHandlerSet.delete(e):(this._emitErrorHandlerSet.clear(),!0))}clear(e={}){this._e=Object.create(null);const{ignoreCustomErrorHanlder:t}=e;!t&&this._hasEmitErrorHandlerSet&&this._emitErrorHandlerSet.clear()}get removeAllListeners(){return this.clear}get addListener(){return this.on}get removeListener(){return this.off}}h([ne,u("design:type",Object),u("design:paramtypes",[])],wn.prototype,"_emitErrorHandlerSet",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],wn.prototype,"removeAllListeners",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],wn.prototype,"addListener",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],wn.prototype,"removeListener",null);var Wh;(function(i){i[i.TESTNET=0]="TESTNET",i[i.MAINNET=1]="MAINNET"})(Wh||(Wh={}));let te=class{constructor(e,t){this.genesisBlock=e,this.business=t,this.events=new wn,this._hookBlockMap=new Map,this._hookBlockMap.set(e.version,e),this.hookedGenesisBlock=this.genesisBlock}_applyHookGenesisBlock(){const e=[...this._hookBlockMap].sort((t,r)=>t[0]-r[0]);this.hookedGenesisBlock=LE(this.genesisBlock,...e.map(t=>({...t[1],version:t[0]}))),WI(this),this.events.emit("hookGenesisBlockApply",this.toJSON())}setHookGenesisBlock(e,t){this._hookBlockMap.set(e,t),this._applyHookGenesisBlock()}getHookGenesisBlock(e){return this._hookBlockMap.get(e)}rollBackHookGenesisBlock(e){this._hookBlockMap.delete(e)&&this._applyHookGenesisBlock()}get version(){return this.hookedGenesisBlock.version}get miniUnit(){return"1"}get netType(){return this.initials==="b"?Wh.MAINNET:Wh.TESTNET}get initials(){return this.bnid}get milestones(){return this.rewardPerBlock}get genesisAccountPublicKey(){return this.hookedGenesisBlock.generatorPublicKey}get chainName(){return this.hookedGenesisBlock.asset.genesisAsset.chainName}get assetType(){return this.hookedGenesisBlock.asset.genesisAsset.assetType}get magic(){return this.hookedGenesisBlock.asset.genesisAsset.magic}get bnid(){return this.hookedGenesisBlock.asset.genesisAsset.bnid}get beginEpochTime(){return this.hookedGenesisBlock.asset.genesisAsset.beginEpochTime}get genesisLocationName(){return this.hookedGenesisBlock.asset.genesisAsset.genesisLocationName}get genesisAmount(){return this.hookedGenesisBlock.asset.genesisAsset.genesisAmount}set genesisAmount(e){this.hookedGenesisBlock.asset.genesisAsset.genesisAmount=e}get minTransactionFeePerByte(){return this.hookedGenesisBlock.asset.genesisAsset.minTransactionFeePerByte}get maxTransactionSize(){return this.hookedGenesisBlock.asset.genesisAsset.maxTransactionSize}get maxBlockSize(){return this.hookedGenesisBlock.asset.genesisAsset.maxBlockSize}get maxTPSPerBlock(){return this.hookedGenesisBlock.asset.genesisAsset.maxTPSPerBlock}get consessusBeforeSyncBlockDiff(){return this.hookedGenesisBlock.asset.genesisAsset.consessusBeforeSyncBlockDiff}get maxDelegateTxsPerRound(){return this.hookedGenesisBlock.asset.genesisAsset.maxDelegateTxsPerRound}get maxGrabTimesOfGiftAsset(){return this.hookedGenesisBlock.asset.genesisAsset.maxGrabTimesOfGiftAsset}get maxVotesPerBlock(){return this.hookedGenesisBlock.asset.genesisAsset.maxVotesPerBlock}get maxBlobSizePerTransaction(){return this.hookedGenesisBlock.asset.genesisAsset.maxBlobSizePerTransaction}get maxBlobSizePerBlock(){return this.hookedGenesisBlock.asset.genesisAsset.maxBlobSizePerTransaction*100}get voteMinChainAsset(){return this.hookedGenesisBlock.asset.genesisAsset.voteMinChainAsset||"0"}get issueAssetMinChainAsset(){return this.magic==="181PI"||this.magic==="I1QQW"||this.magic==="BPZBE"?"100000000000":this.magic==="TUJT3"||this.magic==="8Y885"?"10000000000":this.hookedGenesisBlock.asset.genesisAsset.issueAssetMinChainAsset}get maxMultipleOfAssetAndMainAsset(){return this.magic==="181PI"?{numerator:"1000000",denominator:"1"}:this.magic==="I1QQW"?{numerator:"1000000",denominator:"1"}:this.magic==="BPZBE"?{numerator:"1000000",denominator:"1"}:this.magic==="TUJT3"?{numerator:"10000000",denominator:"1"}:this.magic==="8Y885"?{numerator:"10000000",denominator:"1"}:this.hookedGenesisBlock.asset.genesisAsset.maxMultipleOfAssetAndMainAsset}get registerChainMinChainAsset(){return this.hookedGenesisBlock.asset.genesisAsset.registerChainMinChainAsset}get issueEntityFactoryMinChainAsset(){return this.hookedGenesisBlock.asset.genesisAsset.issueEntityFactoryMinChainAsset}get maxMultipleOfEntityAndMainAsset(){return this.hookedGenesisBlock.asset.genesisAsset.maxMultipleOfEntityAndMainAsset}get maxApplyAndConfirmedBlockHeightDiff(){return this.hookedGenesisBlock.asset.genesisAsset.maxApplyAndConfirmedBlockHeightDiff}get blockPerRound(){return this.hookedGenesisBlock.asset.genesisAsset.blockPerRound}get delegates(){return this.hookedGenesisBlock.asset.genesisAsset.delegates}get whetherToAllowDelegateContinusElections(){return this.hookedGenesisBlock.asset.genesisAsset.whetherToAllowDelegateContinusElections}get forgeInterval(){return this.hookedGenesisBlock.asset.genesisAsset.forgeInterval}get rewardPercent(){return this.hookedGenesisBlock.asset.genesisAsset.rewardPercent}get ports(){return this.hookedGenesisBlock.asset.genesisAsset.ports}get rewardPerBlock(){return this.hookedGenesisBlock.asset.genesisAsset.rewardPerBlock}get accountParticipationWeightRatio(){return this.hookedGenesisBlock.asset.genesisAsset.accountParticipationWeightRatio}get blockParticipationWeightRatio(){return this.hookedGenesisBlock.asset.genesisAsset.blockParticipationWeightRatio}get averageComputingPower(){return this.hookedGenesisBlock.asset.genesisAsset.averageComputingPower}get tpowOfWorkExemptionBlocks(){return this.hookedGenesisBlock.asset.genesisAsset.tpowOfWorkExemptionBlocks}get transactionPowOfWorkConfig(){return this.hookedGenesisBlock.asset.genesisAsset.transactionPowOfWorkConfig}get generatorPublicKey(){return this.hookedGenesisBlock.generatorPublicKey}get signature(){return this.hookedGenesisBlock.signature}get nextRoundDelegates(){return this.hookedGenesisBlock.asset.genesisAsset.nextRoundDelegates}get newDelegates(){return this.hookedGenesisBlock.asset.genesisAsset.newDelegates}get maxBeginBalance(){return this.hookedGenesisBlock.asset.genesisAsset.maxBeginBalance}get maxTxCount(){return this.hookedGenesisBlock.asset.genesisAsset.maxTxCount}get rate(){return this.hookedGenesisBlock.asset.genesisAsset.rate}get blobFeeMultipleRatio(){return{numerator:BigInt(this.genesisAmount),denominator:BigInt(31456e11)}}get totalMainAssets(){const{heights:e,rewards:t}=this.milestones,r=[0,...e];let n=BigInt(0);for(let s=1;s<r.length;s++)n+=BigInt(r[s]-r[s-1])*BigInt(t[s-1]);return n+=BigInt(this.genesisAmount),n}toJSON(){return{version:this.version,miniUnit:this.miniUnit,chainName:this.chainName,assetType:this.assetType,magic:this.magic,bnid:this.bnid,beginEpochTime:this.beginEpochTime,genesisLocationName:this.genesisLocationName,genesisAmount:this.genesisAmount,minTransactionFeePerByte:this.minTransactionFeePerByte,maxTransactionSize:this.maxTransactionSize,maxBlockSize:this.maxBlockSize,maxTPSPerBlock:this.maxTPSPerBlock,consessusBeforeSyncBlockDiff:this.consessusBeforeSyncBlockDiff,maxDelegateTxsPerRound:this.maxDelegateTxsPerRound,maxGrabTimesOfGiftAsset:this.maxGrabTimesOfGiftAsset,issueAssetMinChainAsset:this.issueAssetMinChainAsset,registerChainMinChainAsset:this.registerChainMinChainAsset,maxApplyAndConfirmedBlockHeightDiff:this.maxApplyAndConfirmedBlockHeightDiff,blockPerRound:this.blockPerRound,delegates:this.delegates,whetherToAllowDelegateContinusElections:this.whetherToAllowDelegateContinusElections,forgeInterval:this.forgeInterval,rewardPercent:this.rewardPercent,ports:this.ports,rewardPerBlock:this.rewardPerBlock,accountParticipationWeightRatio:this.accountParticipationWeightRatio,blockParticipationWeightRatio:this.blockParticipationWeightRatio,averageComputingPower:this.averageComputingPower,tpowOfWorkExemptionBlocks:this.tpowOfWorkExemptionBlocks,transactionPowOfWorkConfig:this.transactionPowOfWorkConfig,maxMultipleOfAssetAndMainAsset:this.maxMultipleOfAssetAndMainAsset,issueEntityFactoryMinChainAsset:this.issueEntityFactoryMinChainAsset,maxMultipleOfEntityAndMainAsset:this.maxMultipleOfEntityAndMainAsset,maxVotesPerBlock:this.maxVotesPerBlock,voteMinChainAsset:this.voteMinChainAsset,maxBlobSizePerTransaction:this.maxBlobSizePerTransaction}}};h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"version",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"miniUnit",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"netType",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"genesisAccountPublicKey",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"chainName",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"assetType",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"magic",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"bnid",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"beginEpochTime",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"genesisLocationName",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"minTransactionFeePerByte",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxTransactionSize",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxBlockSize",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxTPSPerBlock",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"consessusBeforeSyncBlockDiff",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxDelegateTxsPerRound",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxGrabTimesOfGiftAsset",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxVotesPerBlock",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxBlobSizePerTransaction",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxBlobSizePerBlock",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"voteMinChainAsset",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"issueAssetMinChainAsset",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxMultipleOfAssetAndMainAsset",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"registerChainMinChainAsset",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"issueEntityFactoryMinChainAsset",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxMultipleOfEntityAndMainAsset",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxApplyAndConfirmedBlockHeightDiff",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"blockPerRound",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"delegates",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"whetherToAllowDelegateContinusElections",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"forgeInterval",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"rewardPercent",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"ports",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"rewardPerBlock",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"accountParticipationWeightRatio",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"blockParticipationWeightRatio",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"averageComputingPower",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"tpowOfWorkExemptionBlocks",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"transactionPowOfWorkConfig",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"generatorPublicKey",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"signature",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"nextRoundDelegates",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"newDelegates",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxBeginBalance",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"maxTxCount",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"rate",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],te.prototype,"totalMainAssets",null);te=h([j("config"),u("design:paramtypes",[Object,String])],te);let Tr=class{constructor(){this._map=new Map}get clear(){return this._map.clear.bind(this._map)}get delete(){return this._map.delete.bind(this._map)}get forEach(){return this._map.forEach.bind(this._map)}get get(){return this._map.get.bind(this._map)}get has(){return this._map.has.bind(this._map)}get set(){return this._map.set.bind(this._map)}get size(){return this._map.size}get[Symbol.iterator](){return this._map[Symbol.iterator].bind(this._map)}get entries(){return this._map.entries.bind(this._map)}get keys(){return this._map.keys.bind(this._map)}get values(){return this._map.values.bind(this._map)}get[Symbol.toStringTag](){return"EasyMap"}};h([ne,u("design:type",Object),u("design:paramtypes",[])],Tr.prototype,"delete",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Tr.prototype,"forEach",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Tr.prototype,"get",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Tr.prototype,"has",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Tr.prototype,"set",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Tr.prototype,Symbol.iterator,null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Tr.prototype,"entries",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Tr.prototype,"keys",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Tr.prototype,"values",null);Tr=h([j("configMap")],Tr);const uS=i=>typeof i=="object"&&i!==null&&typeof i.then=="function";class Qt{constructor(){this.is_resolved=!1,this.is_rejected=!1,this.is_finished=!1,this.promise=new Promise((e,t)=>{this.resolve=r=>{try{uS(r)?r.then(this.resolve,this.reject):(this.is_resolved=!0,this.is_finished=!0,e(this.value=r),this._runThen(),this._innerFinallyArg=Object.freeze({status:"resolved",result:this.value}),this._runFinally())}catch(n){this.reject(n)}},this.reject=r=>{this.is_rejected=!0,this.is_finished=!0,t(this.reason=r),this._runCatch(),this._innerFinallyArg=Object.freeze({status:"rejected",reason:this.reason}),this._runFinally()}})}onSuccess(e){this.is_resolved?this.__callInnerThen(e):(this._innerThen||(this._innerThen=[])).push(e)}onError(e){this.is_rejected?this.__callInnerCatch(e):(this._innerCatch||(this._innerCatch=[])).push(e)}onFinished(e){this.is_finished?this.__callInnerFinally(e):(this._innerFinally||(this._innerFinally=[])).push(e)}_runFinally(){if(this._innerFinally){for(const e of this._innerFinally)this.__callInnerFinally(e);this._innerFinally=void 0}}__callInnerFinally(e){queueMicrotask(async()=>{try{await e(this._innerFinallyArg)}catch(t){console.error("Unhandled promise rejection when running onFinished",e,t)}})}_runThen(){if(this._innerThen){for(const e of this._innerThen)this.__callInnerThen(e);this._innerThen=void 0}}_runCatch(){if(this._innerCatch){for(const e of this._innerCatch)this.__callInnerCatch(e);this._innerCatch=void 0}}__callInnerThen(e){queueMicrotask(async()=>{try{await e(this.value)}catch(t){console.error("Unhandled promise rejection when running onSuccess",e,t)}})}__callInnerCatch(e){queueMicrotask(async()=>{try{await e(this.value)}catch(t){console.error("Unhandled promise rejection when running onError",e,t)}})}}const F_=i=>!(!i||!i.constructor)&&typeof i.next=="function"&&typeof i.return=="function"&&typeof i.throw=="function"&&typeof i[Symbol.asyncIterator]=="function"&&i[Symbol.asyncIterator]()===i,V_=i=>!!i&&typeof i.next=="function"&&typeof i.return=="function"&&typeof i.throw=="function"&&typeof i[Symbol.iterator]=="function"&&i[Symbol.iterator]()===i;class ve{constructor(){this._e=Object.create(null)}on(e,t,r={}){let n=this._e[e];n?n.has(t)&&console.warn(`[${r.taskname||e.toString()}]`):n=this._e[e]=new Map,r.taskname===void 0&&(r.taskname=Zl(this.on)),n.set(t,r)}once(e,t,r){return this.on(e,t,r?new Proxy(r,{get:(n,s,o)=>s==="once"||Reflect.get(n,s,o)}):{once:!0})}has(e,t){const r=this._e[e];return!!r&&(t?r.has(t):r.size>0)}off(e,t){const r=this._e[e];let n=!1;return r&&(n=r.delete(t))&&r.size===0&&delete this._e[e],n}get[fi](){return""}emit(e,t){const r=this._e[e];if(r){nn&&r.size&&console.log(...Ht.head("%s QUENE EMIT [%s]",Ht.DARKVIOLET_BOLD_UNDERLINE),this[fi]||this,e,t);const n=r.entries(),s=a=>{if(typeof a=="object"){if(F_(a))return(async()=>{try{const p=a[Symbol.asyncIterator]();for(;;){const l=await p.next();if(l.done)return l.value}}catch(p){this._emitErrorHanlder(p,e,t)}})();if(V_(a)){const p=a[Symbol.iterator]();try{for(;;){const l=p.next();if(l.done)return l.value}}catch(l){this._emitErrorHanlder(l,e,t)}}}return a},o=()=>{const a=n.next();if(!a.done){const[p,l]=a.value;try{nn&&console.log(...Ht.head("RUN [%s]",Ht.DARKVIOLET_BOLD_UNDERLINE),p.name);const f=p(t,o);return f instanceof Promise?f.then(s,g=>this._emitErrorHanlder(g,e,t)):s(f)}catch(f){this._emitErrorHanlder(f,e,t)}finally{l.once&&r.delete(p)}}};return o()}}async*emitToAsyncGenerator(e,t){const r=this._e[e];if(r){nn&&r.size&&console.log(...Ht.head("%s QUENE EMIT [%s]",Ht.DARKVIOLET_BOLD_UNDERLINE),this[fi]||this,e,t);const n=r.entries(),s=async function*(){const o=n.next();if(!o.done){const[a,p]=o.value;try{nn&&console.log(...Ht.head("RUN [%s]",Ht.DARKVIOLET_BOLD_UNDERLINE),a.name),yield;const l=await a(t,s);if(typeof l=="object"){if(F_(l))return yield*l;if(V_(l))return yield*l}return l}catch(l){this._emitErrorHanlder(l,e,t)}finally{p.once&&r.delete(a)}}}.bind(this);return yield*s()}}clear(e={}){this._e=Object.create(null);const{ignoreCustomErrorHanlder:t}=e;!t&&this._hasEmitErrorHandlerSet&&this._emitErrorHandlerSet.clear()}get removeAllListeners(){return this.clear}get addListener(){return this.on}get removeListener(){return this.off}_emitErrorHanlder(e,t,r){if(!this._hasEmitErrorHandlerSet)throw nn&&console.error(`QueneEventEmitter '${this.constructor.name}' emit '${t.toString()}' fail:`,e),e;for(const n of this._emitErrorHandlerSet)n(e,{eventname:t,arg:r})}get _emitErrorHandlerSet(){return this._hasEmitErrorHandlerSet=!0,new Set}onError(e,t){typeof t=="string"&&DE(e,t),this._emitErrorHandlerSet.has(e)&&console.warn(`hanlder '${e.name}' already exits in custom error hanlder event set.`),this._emitErrorHandlerSet.add(e)}offError(e){return!!this._hasEmitErrorHandlerSet&&(e?this._emitErrorHandlerSet.delete(e):(this._emitErrorHandlerSet.clear(),!0))}}h([ne,u("design:type",Object),u("design:paramtypes",[])],ve.prototype,"removeAllListeners",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],ve.prototype,"addListener",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],ve.prototype,"removeListener",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],ve.prototype,"_emitErrorHandlerSet",null);class Rh extends wn{_emit(e,t){if(this._hasBeforeTaskMap){const r=this._beforeTasks[e];r&&(delete this._beforeTasks[e],r.resolve(t))}if(this._hasCommonEmitHandlerMap){nn&&this._commonEmitHandlerMap.size&&console.log(...Ht.head("%s EMIT WILDCARDS * [%s]",Ht.MIDNIGHTBLUE_BOLD_UNDERLINE),this[fi]||this,{eventname:e,args:t});for(const[r,n]of this._commonEmitHandlerMap)try{if(nn){const{taskname:o=r.name}=n;console.log(...Ht.head("RUN [%s]",Ht.MIDNIGHTBLUE_BOLD_UNDERLINE),o)}const s=r({eventname:e,args:t});s instanceof Promise&&s.catch(o=>this._emitErrorHanlder(o,e,t))}catch(s){this._emitErrorHanlder(s,e,t)}finally{n.once&&this._commonEmitHandlerMap.delete(r)}}if(super._emit(e,t),this._hasAfterTaskMap){const r=this._afterTasks[e];r&&(delete this._afterTasks[e],r.resolve(t))}}clear(e={}){super.clear(e);const{ignoreCommonErrorHanlder:t,ignoreBeforeTask:r,ignoreAfterTask:n}=e;if(!t&&this._hasCommonEmitHandlerMap&&this._commonEmitHandlerMap.clear(),!r&&this._hasBeforeTaskMap){const s=new Error("Remove all listeners");for(const o in this._beforeTasks)this._beforeTasks[o].reject(s)}if(!n&&this._hasAfterTaskMap){const s=new Error("Remove all listeners");for(const o in this._afterTasks)this._afterTasks[o].reject(s)}}get _commonEmitHandlerMap(){return this._hasCommonEmitHandlerMap=!0,new Map}onEmit(e,t={}){this._commonEmitHandlerMap.has(e)&&console.warn(`hanlder '${e.name}' already exits in common hanlder event set.`),t.taskname===void 0&&(t.taskname=Zl(this.onEmit)),this._commonEmitHandlerMap.set(e,t)}offEmit(e){return!!this._hasCommonEmitHandlerMap&&(e?this._commonEmitHandlerMap.delete(e):(this._commonEmitHandlerMap.clear(),!0))}get _afterTasks(){return this._hasAfterTaskMap=!0,Object.create(null)}after(e){let t=this._afterTasks[e];return t||(t=this._afterTasks[e]=new Qt),t.promise}abortAfter(e,t){const r=this._afterTasks[e];return r&&r.reject(t),r}get _beforeTasks(){return this._hasBeforeTaskMap=!0,Object.create(null)}before(e){let t=this._beforeTasks[e];return t||(t=this._beforeTasks[e]=new Qt),t.promise}abortBefore(e,t){const r=this._beforeTasks[e];return r&&r.reject(t),r}}h([ne,u("design:type",Object),u("design:paramtypes",[])],Rh.prototype,"_commonEmitHandlerMap",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Rh.prototype,"_afterTasks",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Rh.prototype,"_beforeTasks",null);class HE extends ve{emit(e,t){if(this._hasCommonEmitHandlerMap){if(nn&&this._commonEmitHandlerMap.size){const r=this[fi]||this;console.log(...Ht.head("%s QUENE EMIT WILDCARDS * [%s]",Ht.DARKVIOLET_BOLD_UNDERLINE),r,e,t)}for(const[r,n]of this._commonEmitHandlerMap)try{if(nn){const{taskname:o=r.name}=n;console.log(...Ht.head("RUN [%s]",Ht.DARKVIOLET_BOLD_UNDERLINE),o)}const s=r({eventname:e,args:t});s instanceof Promise&&s.catch(o=>this._emitErrorHanlder(o,e,t))}catch(s){this._emitErrorHanlder(s,e,t)}finally{n.once&&this._commonEmitHandlerMap.delete(r)}}return super.emit(e,t)}get _commonEmitHandlerMap(){return this._hasCommonEmitHandlerMap=!0,new Map}onEmit(e,t={}){this._commonEmitHandlerMap.has(e)&&console.warn(`hanlder '${e.name}' already exits in common hanlder event set.`),t.taskname===void 0&&(t.taskname=Zl(this.onEmit)),this._commonEmitHandlerMap.set(e,t)}offEmit(e){return!!this._hasCommonEmitHandlerMap&&(e?this._commonEmitHandlerMap.delete(e):(this._commonEmitHandlerMap.clear(),!0))}clear(e={}){super.clear(e);const{ignoreCommonErrorHanlder:t}=e;!t&&this._hasCommonEmitHandlerMap&&this._commonEmitHandlerMap.clear()}}h([ne,u("design:type",Object),u("design:paramtypes",[])],HE.prototype,"_commonEmitHandlerMap",null);class Pr extends ve{constructor(){super(...arguments),this.list=[],this.min_next_index=0,this.calcs=[],this._is_rejected=!1,this._is_resolved=!1,this._requestProcess=0}canPush(e){return!(e<this.min_next_index||e in this.list||this.is_done)}push(e,t=this.min_next_index){if(t<this.min_next_index)throw new RangeError(`push into wrong index:${t}, should be ${this.min_next_index}`);if(t in this.list||t in this.calcs)throw new TypeError(`index:${t} already have value`);for(this.list[t]=e;this.list[this.min_next_index];)this.min_next_index+=1;return this.emit("push",{item:e,index:t})}pushCalc(e,t=this.min_next_index){if(t<this.min_next_index)throw new RangeError(`push into wrong index:${t}, should be ${this.min_next_index}`);if(t in this.list||t in this.calcs)throw new TypeError(`index:${t} already have value`);const r=()=>{delete this.calcs[t];const n=this.list[t]=e();return this.emit("push",{item:n,index:t}),n};for(this.calcs[t]=r;this.list[this.min_next_index];)this.min_next_index+=1;return this.emit("pushCalc",{calc:r,index:t})}get is_done(){return this._is_rejected||this._is_resolved}_initTask(){let e=this._task;return e||(e=this._task=new Qt,this._is_rejected?e.reject(this._reason):this._is_resolved?e.resolve(this.list):(this._requestProcess=1/0,this.emit("requestAll",void 0))),e.promise}async done(){var e;if(!this.is_done){for(this._is_resolved=!0,(e=this._task)==null?void 0:e.resolve(this.list);;){const t=new Set(Object.keys(this.calcs));if(t.size===0)break;await new Promise((r,n)=>{const s=()=>{this.off("push",o),this.off("error",a)},o=p=>{t.delete(p.index.toString())&&t.size===0&&(r(),s())},a=()=>{n(),s()};this.on("push",o),this.once("error",a)})}return Object.freeze(this.list),this.emit("done",void 0)}}throw(e){var t;if(!this.is_done)return this._is_rejected=!0,(t=this._task)==null||t.reject(e),Object.freeze(this.list),this.emit("error",this._reason=e)}resolve(){return this.done()}reject(e){return this.throw(e)}then(...e){return this._initTask().then(...e)}catch(...e){return this._initTask().catch(...e)}get requestProcess(){return this._requestProcess}[Symbol.asyncIterator](){const e=this,{list:t,calcs:r}=e;return{index:0,return:()=>(Yf(e.done()),Promise.resolve({done:!0,value:void 0})),async next(){const n=this.index;r[n]&&Yf(r[n]());const s=t[n];let o={done:e.is_done,value:s};return n in t?o.done=!1:e.is_done||(o=await new Promise(async(a,p)=>{const l=()=>{e.off("error",f),e.off("push",d),e.off("pushCalc",y),e.off("done",g)},f=(m,E)=>(l(),p(m),E()),g=(m,E)=>(l(),a({done:!0,value:s}),E()),d=({item:m,index:E},T)=>(n===E&&(l(),a({done:!1,value:m})),T()),y=({calc:m,index:E},T)=>(n===E&&(l(),a({done:!1,value:m()})),T());e.on("error",f),e.on("done",g),e.on("push",d),e.on("pushCalc",y);try{await e.emit("requestItem",e._requestProcess=n)}catch(m){e.emit("error",m)}})),this.index+=1,o}}}toAsyncIterableIterator(){return fS(this)}}async function*fS(i){yield*i}h([$e,u("design:type",Function),u("design:paramtypes",[Object,Object]),u("design:returntype",void 0)],Pr.prototype,"push",null),h([$e,u("design:type",Function),u("design:paramtypes",[Function,Object]),u("design:returntype",void 0)],Pr.prototype,"pushCalc",null),h([$e,u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",Promise)],Pr.prototype,"done",null),h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],Pr.prototype,"throw",null),h([$e,u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",void 0)],Pr.prototype,"resolve",null),h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],Pr.prototype,"reject",null),h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],Pr.prototype,"then",null),h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],Pr.prototype,"catch",null);const Pf=(i,e,t)=>{let r=[new Qt];const n=(a,p)=>{let l=a[p];return l===void 0&&(l=a[p]=new Qt),l},s=a=>{if(r!==void 0)return n(r,a).promise};let o=0;(async()=>{await s(o);for await(const a of i){let p=t(a);if(p.async&&(p=await p.value),p.filter){if(p.multi)for(const l of p.maps)e.push(l);else e.push(p.map);await s(o)}}await e.done()})().catch(e.throw),e.on("done",(a,p)=>(i.done(),p())),e.on("error",(a,p)=>(i.throw(a),p())),e.on("requestItem",(a,p)=>{r!==void 0&&(n(r,o).resolve(),o+=1),p()}),e.on("requestAll",(a,p)=>{if(r!==void 0){for(const l of r)l.is_resolved===!1&&l.resolve();r=void 0}p()})},hi=class{static InitCryptTable(){const i=new Array(1280);let e,t,r,n=1048577,s=0,o=0;for(s=0;s<256;s++)for(o=s,e=0;e<5;e++,o+=256)n=(125*n+3)%2796203,t=(65535&n)<<16,n=(125*n+3)%2796203,r=65535&n,i[o]=t|r;return i}static hashString(i,e){const{cryptTable:t,cryptTable_length:r}=hi;let n,s=2146271213,o=4008636142;for(let a=0;a<i.length;a+=1)n=((e<<8)+i.charCodeAt(a))%r,s=t[n]^s+o,o=n+s+o+(o<<5)+3;return s}static inRangePosition(i){const{hashRange:e}=hi;return(i-e.min)/e.dis%1}static hashToRandom(i,e,t=0,r=1,n){const s=(hi.hashString(i,e)-hi.hashRange.min)/hi.hashRange.dis*(r-t)+t;return n?Math.floor(s):s}};let Bf=hi;Bf.cryptTable=Object.freeze(hi.InitCryptTable()),Bf.cryptTable_length=hi.cryptTable.length,Bf.hashRange=Object.freeze({min:-2147483648,max:2147483647,dis:Math.pow(2,32)});class gS extends wt{constructor(e){super(t=>[],e)}add(e,t){this.forceGet(e).push(t)}remove(e,t){const r=this.get(e);if(r){const n=r.indexOf(t);if(n!==-1)return r.splice(n,1),!0}return!1}}class Mf{constructor(e){this.eventEmitter=e,this.BINDED_EVENTS_MAP=new gS}on(e,t,r){return this.eventEmitter.on(e,t,r),this.BINDED_EVENTS_MAP.add(e,t),this}off(e,t){return this.BINDED_EVENTS_MAP.remove(e,t)&&this.eventEmitter.off(e,t),this}emit(e,...t){return this.eventEmitter.emit(e,...t),this}once(e,t,r){const n=(...s)=>(this.BINDED_EVENTS_MAP.remove(e,n),t(...s));return this.BINDED_EVENTS_MAP.add(e,n),this.eventEmitter.once(e,t,r),this}removeAllListeners(){for(const[e,t]of this.BINDED_EVENTS_MAP)for(const r of t)this.eventEmitter.off(e,r);return this.BINDED_EVENTS_MAP.clear(),this}get clear(){return this.removeAllListeners}get addListener(){return this.on}get removeListener(){return this.off}}h([ne,u("design:type",Object),u("design:paramtypes",[])],Mf.prototype,"clear",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Mf.prototype,"addListener",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Mf.prototype,"removeListener",null);var $_;let lg=class{constructor(){this._instanceParamWM=new WeakMap}getParam(i){return this._instanceParamWM.get(i)}setParam(i,e){this._instanceParamWM.set(i,e)}};lg=h([j()],lg);const dS=/"(?:\.|(\\\")|[^\""\n])*"|'(?:\.|(\\\')|[^\''\n])*'/g;let qh=class{constructor(i,e){this.moduleMap=i,this.flagParamStack=e,this._applyedFlagMap=new Map,this._flagInfomationMap=new Map}strToBool_(i){const e=i.toLowerCase();return e!=="disable"&&e!=="disabled"&&e!=="false"&&(e==="enable"||e==="enabled"||e==="true"||e===""||i)}_formatString(i){return i.startsWith("'")&&i.endsWith("'")||i.startsWith('"')&&i.endsWith('"')?i.slice(1,-1):i}parse(i){const e=[],t=`_PLACE_${Math.random().toString(36).slice(2)}_HOLDER_`,r=i.replace(dS,s=>(e.push(s),t)).split(/\s+/).filter(s=>!!s),n=new Map;for(const s of r){const o=s.indexOf("=");let a,p,l="";if(o===-1)a=s;else{if(a=s.substr(0,o),a.includes(t))throw new Error(`Flags format error: ${a.replace(t,e.shift()||t)} is invilde.`);l=s.substr(o+1).replace(new RegExp(t,"g"),g=>{const d=e.shift();if(!d)throw new Error;return d})}const f=this._flagInfomationMap.get(s);if(f)switch(f.type){case"boolean":p=!!this.strToBool_(l);break;case"number":const g=Number.parseFloat(l);p=Number.isNaN(g)?void 0:g;break;case"string":p=this._formatString(l)}else{if(p=this.strToBool_(l),typeof p=="string"){const g=parseFloat(p);g.toString()===p&&(p=g)}typeof p=="string"&&(p=this._formatString(p))}n.delete(a),n.set(a,p)}return n}quote(i){const e=[];for(let[t,r]of i)r===void 0?e.push(t):(typeof r=="string"&&(r=JSON.stringify(r)),e.push(`${t}=${r}`));return e.join(" ")}applyFlags(i){i instanceof Map||(i=this.parse(i));for(const[e,t]of i)this.setFlagValue(e,t);return this._applyedFlagMap=i}getFlagValue(i){return this._applyedFlagMap.get(i)}setFlagValue(i,e){const t=this._flagInfomationMap.get(i);return!!t&&(e===!1?(t.onDisable instanceof Function&&t.onDisable(),this._applyedFlagMap.delete(i)):(t.onEnable instanceof Function&&t.onEnable(e),this._applyedFlagMap.set(i,e)),!0)}hasFlag(i){return this._applyedFlagMap.has(i)}getApplyedFlags(){return this.quote(this._applyedFlagMap)}registerBooleanFlag(i,e,t){if(this._flagInfomationMap.has(i))throw new Error(`Duplicate registration boolean flag: ${i}.`);this._flagInfomationMap.set(i,{type:"boolean",onEnable:e,onDisable:t})}registerStringFlag(i,e,t){if(this._flagInfomationMap.has(i))throw new Error(`Duplicate registration string flag: ${i}.`);this._flagInfomationMap.set(i,{type:"string",onEnable:e,onDisable:t})}registerNumberFlag(i,e,t){if(this._flagInfomationMap.has(i))throw new Error(`Duplicate registration number flag: ${i}.`);this._flagInfomationMap.set(i,{type:"number",onEnable:e,onDisable:t})}registerInjectionFlag(i,e,t="boolean"){if(this._flagInfomationMap.has(i))throw new Error(`Duplicate registration injection flag: ${i}.`);this._flagInfomationMap.set(i,{type:t,onEnable:r=>{const n=this.moduleMap,s=Ot(e,n.installMask(new et([[yS,r]])));this.flagParamStack.setParam(s,r)}})}};qh=h([j(),u("design:paramtypes",[typeof($_=et!==void 0&&et)=="function"?$_:Object,lg])],qh);const yS=Symbol("flag param in constructor");var mS=()=>performance;let Dn=class{constructor(){this.platformInfo=Cs,this.performance=mS()}get platformName(){return Cs.platformName()}get isNodejs(){return SE}get isWindows(){return GT}get isCordova(){return wE}get isWebView(){return eh}get isWebMainThread(){return nm}get isWebWorker(){return bE}};h([ne,u("design:type",Object),u("design:paramtypes",[])],Dn.prototype,"platformName",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Dn.prototype,"isNodejs",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Dn.prototype,"isWindows",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Dn.prototype,"isCordova",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Dn.prototype,"isWebView",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Dn.prototype,"isWebMainThread",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Dn.prototype,"isWebWorker",null),Dn=h([j()],Dn);const hg=new WeakMap;function Ji(i,e,t){let r,n=hg.get(i);if(!n){const s={resolves:new Set,rejects:new Set},o=()=>{s.resolves.clear(),s.rejects.clear(),p.cbs=void 0},a=i.then(l=>{for(const f of s.resolves)queueMicrotask(async()=>{try{await f(l)}catch(g){console.error("Unhandled promise rejection when running onfulfilled",f,g)}});o()},async l=>{for(const f of s.rejects)queueMicrotask(async()=>{try{await f(l)}catch(g){console.error("Unhandled promise rejection when running onrejected",f,g)}});o()}),p={cbs:s,promise:a};hg.set(i,n=p)}return n.cbs?(e&&n.cbs.resolves.add(e),t&&n.cbs.rejects.add(t),r=n.promise):r=i.then(e,t),{thened:n,toPromise:r}}function Ph(i,e,t){const r=hg.get(i);return r&&r.cbs&&(e&&r.cbs.resolves.delete(e),t&&r.cbs.rejects.delete(t)),r}class Mm{constructor(e){this.rankList=[],this.thenedMap=new Map,this._cter=!1,this.options=Mm.mergeOptions(e)}static mergeOptions(e){return Object.assign({throwWhenNoRacer:!1},e)}resolve(e){this.quota?(this.quota.resolve(e),this.quota=void 0):this.rankList.push({type:1,value:e})}reject(e){this.quota?(this.quota.reject(e),this.quota=void 0):this.rankList.push({type:0,value:e})}addRacer(e){const t=this.thenedMap.get(e);if(!t){const r=a=>{this.resolve(a),this.thenedMap.delete(e)},n=a=>{this.reject(a),this.thenedMap.delete(e)},{thened:s,toPromise:o}=Ji(e,r,n);return s.cbs&&this.thenedMap.set(e,{cbs:s.cbs,onfulfilled:r,onrejected:n,toPromise:o}),o}return t.toPromise}removeRacer(e){const t=this.thenedMap.get(e);return!!t&&(this._removeRacer(e,t),this._checkToEndRace(),!0)}_removeRacer(e,t){t.cbs.resolves.delete(t.onfulfilled),t.cbs.rejects.delete(t.onrejected),this.thenedMap.delete(e)}hasRacer(e){return this.thenedMap.has(e)}get size(){return this.thenedMap.size}_queneToCheck(){}_checkToEndRace(){this.options.throwWhenNoRacer&&this._cter===!1&&this.thenedMap.size===0&&(this._cter=!0,queueMicrotask(()=>{this.thenedMap.size===0&&this.quota&&this.quota.is_finished===!1&&this.quota.reject(new RangeError("no racer to race"))}))}static isNoRacerException(e){return e instanceof RangeError&&e.message==="no racer to race"}race(e){const t=this.rankList.shift();if(!t)return e?(this.quota?this.quota!==e&&this.quota.promise.then(e.resolve,e.reject):this.quota=e,e.promise):(this._checkToEndRace(),(this.quota||(this.quota=new Qt)).promise);if(t.type===1)return t.value;throw t.value}clear(e){for(const t of this.thenedMap)this._removeRacer(t[0],t[1]);this.rankList.length=0,this.quota&&(this.quota.reject(e),this.quota=void 0)}}function FE(i){const e=new Qt;let t=!0;const r=[];for(const n of i){if(typeof n!="object"||n===null||typeof n.then!="function"){t=!1,e.resolve(n);break}r.push(n)}if(t)if(r.length===0)console.warn("safePromiseRace got empty array");else{const n=new Mm;e.onFinished(()=>n.clear());for(const s of r)n.addRacer(s);n.race(e)}return e.promise}const ug=Symbol("then"),fg=Symbol("catch");class gg{constructor(e){let t,r;const n=new Promise((a,p)=>{t=a,r=p});this.promise=Object.assign(n,{[ug]:n.then,[fg]:n.catch});let s=!1;const o=()=>{s||(e(t,r),s=!0)};n.then=(a,p)=>(o(),this.delayThen(a,p)),n.catch=a=>(o(),this.delayCatch(a))}delayThen(e,t){return this.promise[ug](e,t)}delayCatch(e){return this.promise[fg](e)}get then(){return this.promise.then}get catch(){return this.promise.catch}}gg.THEN_SYMBOL=ug,gg.CATCH_SYMBOL=fg;class _S{constructor(e=2){this.maxParallelNum=e,this._runningTasks=[],this._waitingQuene=[]}addTaskExecutor(e){const t=new Qt;return this._waitingQuene.push({executor:e,po:t}),t.promise}get isDone(){return this._runningTasks.length===0&&this._waitingQuene.length===0}get hasTask(){return!this.isDone}get isFull(){return this._runningTasks.length+this._waitingQuene.length>=this.maxParallelNum}async*_startParallel(){for(;;){const e=this._waitingQuene.shift();if(!e)break;try{const t=await e.executor();e.po.resolve(t),yield{asset:t}}catch(t){yield{error:t},e.po.reject(t)}}}async doAll(e){const t=[];for await(const r of this.yieldResults(e))t.push(r);return t}async doRace(e){for await(const t of this.yieldResults(e))return t}yieldResults(e){return this._yielding||(this._yielding=this._yieldResults(e)),this._yielding}async*_yieldResults(e={}){const t=[],r=()=>this._startParallel(),n=this._runningTasks;for(;;){for(;n.length<this.maxParallelNum&&this._waitingQuene.length>0;){const o=t.shift()||r(),a=o.next().then(l=>{if(!l.done){t.push(o);const f=l.value;if(f){if(!("error"in f))return{asset:f.asset,rm:p};if(e.onError&&e.onError(f.error),!e.ignoreError)throw f.error}}p()});n.push(a);const p=()=>{const l=n.indexOf(a);l!==-1&&n.splice(l,1)}}if(n.length===0)break;const s=await FE(n);s&&(yield s.asset,s.rm())}this._yielding=void 0}}class AS extends Ku{constructor(e,t){super(e),this.silence=t,this.ABORT_ERROR_FLAG=!0}}class vm extends Qt{constructor(){super()}get is_done(){return this.is_resolved||this.is_rejected}abort(e="Abort"){this.is_done||(this.reject(this.abort_error=new AS(e)),this._hasAbortEvent&&this._abortEvent.emit("abort",this.abort_error,this))}get _abortEvent(){return this._hasAbortEvent=!0,new wn}onAbort(e){this._abortEvent.on("abort",e)}follow(e){return e.then(this.resolve).catch(this.reject),this.promise}static fromPromise(e){const t=new vm;return Yf(e instanceof gg?e.delayThen(t.resolve,t.reject):e.then(t.resolve,t.reject)),t}finally(e){return this.promise.finally(e)}}h([ne,u("design:type",Object),u("design:paramtypes",[])],vm.prototype,"_abortEvent",null);const Xh=new WeakMap,Ps=(i,e)=>{let t;i<=0&&(i=1);const r=new Promise(n=>t=setTimeout(()=>{Xh.delete(r),n()},i)).then(e);return Xh.set(r,t),r},VE=i=>{const e=Xh.get(i);e!==void 0&&(Xh.delete(i),clearTimeout(e))};class Lm{constructor(){this._task_list=[]}toPromise(){return Promise.all(this._task_list)}set next(e){this._task_list.push(e)}tryToPromise(){return this._task_list.some(e=>e&&typeof e.then=="function")?Promise.all(this._task_list):this._task_list}}const Ve=async i=>{const e=new Lm;try{await i(e)}catch(t){e.next=Promise.reject(t)}return e.toPromise()};var Bh,U_;const{info:ES}=NE("util","TimeHelper"),IS={TIME_SPEED:"TIME_SPEED"};let Mh=Bh=class{constructor(i,e=1){this.platformHelper=i,this.TIME_SPEED=e,this.clearTimeout=clearTimeout,this.clearInterval=clearInterval,this.time_offset_ms=0,this.SYSTEM_START_TIME=this.platformHelper.performance.timeOrigin,typeof e=="number"&&e>0||(this.TIME_SPEED=1),ES("TIME SPPED  %d.",this.TIME_SPEED)}setTimeout(i,e){return setTimeout(i,e/this.TIME_SPEED)}setInterval(i,e){return setInterval(i,e/this.TIME_SPEED)}sleep(i,e){return Ps(i/this.TIME_SPEED,e)}get BLOCKCHAIN_SYSTEM_START_TIME(){return this.SYSTEM_START_TIME+this.time_offset_ms}now(i=!1){const e=this.platformHelper.performance.now()+this.SYSTEM_START_TIME+this.time_offset_ms,t=Date.now()-e;t>1&&(this.time_offset_ms+=t);const r=this.SYSTEM_START_TIME+(this.platformHelper.performance.now()+this.time_offset_ms)*this.TIME_SPEED;return i?parseInt(r.toString()):r}changeNowByDiff(i){const{NOW_DIFF_SYMBOL:e}=Bh,t=Reflect.get(Date,e);if(this.time_offset_ms+=i-(t||0),i!==0){if(t===void 0){const r=Date.now,n=Date.now=()=>r()+Reflect.get(Date,e);Reflect.set(n,"source",r)}Reflect.set(Date,e,i)}else{const r=Date.now,n=Reflect.get(r,"source");n!==void 0&&(Date.now=n,Reflect.deleteProperty(Date,e))}}changeNowByTime(i){const{NOW_DIFF_SYMBOL:e}=Bh,t=Reflect.get(Date,e)||0,r=i-(Date.now()-t);return this.changeNowByDiff(r)}formatDate(i,e="yyyy-MM-dd hh:mm:ss"){const t=i.getMonth()+1,r={"M+":t,"d+":i.getDate(),"h+":i.getHours(),"m+":i.getMinutes(),"s+":i.getSeconds(),"q+":Math.floor((i.getMonth()+3)/3),E:["","","",""][Math.floor(t%12/3)],W:["","","","","","",""][i.getDay()],S:i.getMilliseconds()};let n=e;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(i.getFullYear()+"").substr(4-RegExp.$1.length)));for(const s in r)new RegExp("("+s+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?""+r[s]:("00"+r[s]).substr((""+r[s]).length)));return n}formatDateTime(i=this.now()){return this.formatDate(new Date(i))}formatYMDHMS(i,e,t,r,n,s){const o=(a,p=2)=>String(a).padStart(p,"0");return`${o(i,4)}-${o(e)}-${o(t)} ${o(r)}:${o(n)}:${o(s)}`}};Mh.NOW_DIFF_SYMBOL=Symbol("now-diff-ms"),Mh=Bh=h([j(),Oe(1,J(IS.TIME_SPEED,{optional:!0})),u("design:paramtypes",[typeof(U_=Dn!==void 0&&Dn)=="function"?U_:Object,Object])],Mh);let Wo=class{get v4(){return"(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}"}get v6seg(){return"[a-fA-F\\d]{1,4}"}get v6(){const{v4:i,v6seg:e}=this;return`
    (
    (?:${e}:){7}(?:${e}|:)|                                // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
    (?:${e}:){6}(?:${i}|:${e}|:)|                         // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
    (?:${e}:){5}(?::${i}|(:${e}){1,2}|:)|                 // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
    (?:${e}:){4}(?:(:${e}){0,1}:${i}|(:${e}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
    (?:${e}:){3}(?:(:${e}){0,2}:${i}|(:${e}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
    (?:${e}:){2}(?:(:${e}){0,3}:${i}|(:${e}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
    (?:${e}:){1}(?:(:${e}){0,4}:${i}|(:${e}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
    (?::((?::${e}){0,5}:${i}|(?::${e}){1,7}|:))           // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
    )(%[0-9a-zA-Z]{1,})?                                           // %eth0            %1
    `.replace(/\/\/.*$/gm,"").replace(/(^\s+)|(\s+$)|\s+/g,"").replace(/\n/g,"")}isIp(i){const{v4:e,v6:t}=this;return new RegExp(`(?:^${e}$)|(?:^${t}$)`).test(i)}isIpV4(i){const{v4:e}=this;return new RegExp(`^${e}$`).test(i)}isIpV6(i){const{v6:e}=this;return new RegExp(`^${e}$`).test(i)}ipv4ToUint32(i){return i.split(".").reduce((e,t,r)=>e+ +t*Math.pow(256,3-r),0)}uint32ToIpv4(i){return`${i/16777216|0}.${i%16777216/65536|0}.${i%65536/256|0}.${i%256}`}};h([ne,u("design:type",Object),u("design:paramtypes",[])],Wo.prototype,"v4",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Wo.prototype,"v6seg",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Wo.prototype,"v6",null),Wo=h([j()],Wo);class kr extends as.Buffer{static from(e,t,r){return as.Buffer.from(e,t,r)}static alloc(e,t,r){return as.Buffer.alloc(e,t,r)}static allocUnsafe(e){return as.Buffer.allocUnsafe(e)}static allocUnsafeSlow(e){return as.Buffer.allocUnsafeSlow(e)}}var TS=()=>({TextDecoder,TextEncoder});const SS=new WeakMap,{TextEncoder:wS,TextDecoder:bS}=TS(),NS=new wS;new bS("utf-8");const xS=new Uint8Array;function vf(i){if(!i)return xS;const e=i.length<=128?OS(i):NS.encode(i);return SS.set(e,i),e}function OS(i){const e=[];let t,r;for(let n=0;n<i.length;++n)t=i.charCodeAt(n),t<128?e[e.length]=t:t<2048?(e[e.length]=t>>6|192,e[e.length]=63&t|128):(64512&t)==55296&&(64512&(r=i.charCodeAt(n+1)))==56320?(t=65536+((1023&t)<<10)+(1023&r),++n,e[e.length]=t>>18|240,e[e.length]=t>>12&63|128,e[e.length]=t>>6&63|128,e[e.length]=63&t|128):(e[e.length]=t>>12|224,e[e.length]=t>>6&63|128,e[e.length]=63&t|128);return new Uint8Array(e)}var $E;class Tn{constructor(e,t=n=>n,r){this.transformKey=t,this._afterDelete=r,this._set=new Set(e)}static from(e){return new Tn(e.entries,e.transformKey,e.afterDelete)}tryAdd(e){return this.add(this.transformKey(e))}tryDelete(e){return this.delete(this.transformKey(e))}tryHas(e){return this.has(this.transformKey(e))}get clear(){return this._set.clear.bind(this._set)}get delete(){const e=this._set.delete.bind(this._set),{_afterDelete:t}=this;return t?r=>!!e(r)&&(t(r),!0):e}get forEach(){return this._set.forEach.bind(this._set)}get has(){return this._set.has.bind(this._set)}get add(){return this._set.add.bind(this._set)}get size(){return this._set.size}get[$E=Symbol.iterator](){return this._set[Symbol.iterator].bind(this._set)}get entries(){return this._set.entries.bind(this._set)}get keys(){return this._set.keys.bind(this._set)}get values(){return this._set.values.bind(this._set)}get[Symbol.toStringTag](){return"EasySet"}}h([ne,u("design:type",Object),u("design:paramtypes",[])],Tn.prototype,"clear",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Tn.prototype,"delete",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Tn.prototype,"forEach",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Tn.prototype,"has",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Tn.prototype,"add",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Tn.prototype,$E,null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Tn.prototype,"entries",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Tn.prototype,"keys",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Tn.prototype,"values",null);class Pc{constructor(e,t=n=>n,r){this.transformKey=t,this._afterDelete=r,this._ws=new WeakSet(e)}static from(e){return new Pc(e.entries,e.transformKey,e.afterDelete)}tryAdd(e){return this.add(this.transformKey(e))}tryDelete(e){return this.delete(this.transformKey(e))}tryHas(e){return this.has(this.transformKey(e))}get delete(){const e=this._ws.delete.bind(this._ws),{_afterDelete:t}=this;return t?r=>!!e(r)&&(t(r),!0):e}get add(){return this._ws.add.bind(this._ws)}get has(){return this._ws.has.bind(this._ws)}get[Symbol.toStringTag](){return"EasyWeakSet"}}h([ne,u("design:type",Object),u("design:paramtypes",[])],Pc.prototype,"delete",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Pc.prototype,"add",null),h([ne,u("design:type",Object),u("design:paramtypes",[])],Pc.prototype,"has",null);const CS=typeof Promise=="function",RS=typeof self=="object"?self:global,UE=typeof Symbol<"u",dg=typeof Map<"u",yg=typeof Set<"u",PS=typeof WeakMap<"u",BS=typeof WeakSet<"u",MS=typeof DataView<"u",KE=UE&&Symbol.iterator!==void 0,K_=UE&&Symbol.toStringTag!==void 0,vS=yg&&typeof Set.prototype.entries=="function",LS=dg&&typeof Map.prototype.entries=="function",DS=vS&&Object.getPrototypeOf(new Set().entries()),kS=LS&&Object.getPrototypeOf(new Map().entries()),GE=KE&&typeof Array.prototype[Symbol.iterator]=="function",HS=GE&&Object.getPrototypeOf([][Symbol.iterator]()),zE=KE&&typeof String.prototype[Symbol.iterator]=="function",FS=zE&&Object.getPrototypeOf(""[Symbol.iterator]());function VS(i){const e=typeof i;if(e!=="object")return e;if(i===null)return"null";if(i===RS)return"global";if(Array.isArray(i)&&(K_===!1||!(Symbol.toStringTag in i)))return"Array";if(typeof window=="object"&&window!==null){if(typeof window.location=="object"&&i===window.location)return"Location";if(typeof window.document=="object"&&i===window.document)return"Document";if(typeof window.navigator=="object"){if(typeof window.navigator.mimeTypes=="object"&&i===window.navigator.mimeTypes)return"MimeTypeArray";if(typeof window.navigator.plugins=="object"&&i===window.navigator.plugins)return"PluginArray"}if((typeof window.HTMLElement=="function"||typeof window.HTMLElement=="object")&&i instanceof window.HTMLElement){if(i.tagName==="BLOCKQUOTE")return"HTMLQuoteElement";if(i.tagName==="TD")return"HTMLTableDataCellElement";if(i.tagName==="TH")return"HTMLTableHeaderCellElement"}}const t=K_&&i[Symbol.toStringTag];if(typeof t=="string")return t;const r=Object.getPrototypeOf(i);return r===RegExp.prototype?"RegExp":r===Date.prototype?"Date":CS&&r===Promise.prototype?"Promise":yg&&r===Set.prototype?"Set":dg&&r===Map.prototype?"Map":BS&&r===WeakSet.prototype?"WeakSet":PS&&r===WeakMap.prototype?"WeakMap":MS&&r===DataView.prototype?"DataView":dg&&r===kS?"Map Iterator":yg&&r===DS?"Set Iterator":GE&&r===HS?"Array Iterator":zE&&r===FS?"String Iterator":r===null?"Object":Object.prototype.toString.call(i).slice(8,-1)}const jE=typeof Buffer<"u";jE&&Buffer.from;const $S=jE?function(i){return Buffer.isBuffer(i)}:function(i){return!1};function G_(i){return $S(i)?"Buffer":VS(i)}const JE=new class{get(i,e,t=G_(i)){switch(t){case"Arguments":case"Array":case"Object":return i[e];case"Map":return i.get(e);case"Set":return e}}set(i,e,t,r=G_(i)){switch(r){case"Arguments":case"Array":case"Object":i[e]=t;break;case"Map":i.set(e,t);break;case"Set":i.add(t)}return i}};JE.get;JE.set;const US=typeof globalThis<"u"&&globalThis!==null&&globalThis.Object===Object&&globalThis,KS=typeof global<"u"&&global!==null&&global.Object===Object&&global,GS=typeof self<"u"&&self!==null&&self.Object===Object&&self;US||KS||GS||Function("return this")();class Vt extends Mh{getTimestamp(e=this.now()){return Math.floor((e-this.config.beginEpochTime)/1e3)}getTimeByTimestamp(e){return e*1e3+this.config.beginEpochTime}get beginEpochTime(){return new Date(this.config.beginEpochTime)}getSlotNumberByTimestamp(e=this.getTimestamp()){return Math.floor(e/this.config.forgeInterval)}getNextSlotNumberByTimestamp(e=this.getTimestamp()){return this.getSlotNumberByTimestamp(e)+1}getTimestampBySlotNumber(e){return e*this.config.forgeInterval}formatTimestamp(e=this.getTimestamp()){return this.formatDateTime(e*1e3+this.config.beginEpochTime)}}h([J(te),u("design:type",te)],Vt.prototype,"config",void 0);h([ne,u("design:type",Object),u("design:paramtypes",[])],Vt.prototype,"beginEpochTime",null);const{ArgumentIllegalException:zS}=re("HELPER","jsbiHelper");function dn(i){try{if(typeof i=="string"){if(/^[0-9-]*$/.test(i)===!1)throw new Error("QAQ");i=parseInt(i)}else if(typeof i=="number")i=Math.floor(i);else return i;return BigInt(i)}catch{throw new zS(c.PROP_IS_INVALID,{prop:`param ${i}`,target:"fraction"})}}let It=class{multiplyFloor(e,t){return this.multiplyFloorFraction(e,this.numberToFraction(t))}floorFraction(e){const t=dn(e.numerator),r=dn(e.denominator);return t/r}ceilFraction(e){const t=dn(e.numerator),r=dn(e.denominator),n=t/r;return n*r===t?n:n+BigInt(1)}multiplyFraction(e,t){const r=BigInt(e.numerator),n=BigInt(e.denominator),s=BigInt(t.numerator),o=BigInt(t.denominator);return{numerator:r*s,denominator:n*o}}multiplyFractionAndFloor(e,t){return this.floorFraction(this.multiplyFraction(e,t))}multiplyFractionAndCeil(e,t){return this.ceilFraction(this.multiplyFraction(e,t))}multiplyFloorFraction(e,t){const r=dn(e),n=BigInt(t.numerator),s=BigInt(t.denominator);return r*n/s}multiplyFloorFractionString(e,t){const r=dn(e),n=BigInt(t.numerator),s=BigInt(t.denominator);return r*n/s}multiplyRound(e,t){return this.multiplyRoundFraction(e,this.numberToFraction(t))}multiplyRoundFraction(e,t){const r=this.multiplyFloorFraction(e,{numerator:BigInt(t.numerator)*BigInt(10),denominator:BigInt(t.denominator)}),n=r/BigInt(10);return r%BigInt(10)>=BigInt(5)?n+BigInt(1):n}numberToFraction(e){const r=e.toFixed(45).split("."),n=r.length>1?r[1].length:0,s=1+"0".repeat(n);return{numerator:r.join(""),denominator:s}}multiplyCeil(e,t){return this.multiplyCeilFraction(e,this.numberToFraction(t))}multiplyCeilFraction(e,t){const r=dn(e),n=BigInt(t.numerator),s=BigInt(t.denominator),o=r*n,a=o/s;return a*s===o?a:a+BigInt(1)}divisionCeilFraction(e,t){const r=dn(e),n=BigInt(t.numerator),s=BigInt(t.denominator),o=r*s,a=o/n;return a*n===o?a:a+BigInt(1)}divisionFraction(e,t){const r=BigInt(e.numerator),n=BigInt(e.denominator),s=BigInt(t.numerator),o=BigInt(t.denominator);return{numerator:r*o,denominator:n*s}}divisionFractionAndFloor(e,t){return this.floorFraction(this.divisionFraction(e,t))}divisionFractionAndCeil(e,t){return this.ceilFraction(this.divisionFraction(e,t))}compareFraction(e,t){const r=dn(e.numerator),n=dn(e.denominator),s=dn(t.numerator),o=dn(t.denominator),a=r*o,p=s*n;return a===p?0:a>p?1:-1}};It=h([j()],It);let $r=class{constructor(e,t,r){this.cryptoHelper=e,this.keypairHelper=t,this.ed2curveHelper=r}async detachedSign(e,t){const r=await this.cryptoHelper.sha256(e);return this.keypairHelper.detached_sign(r,t)}async detachedVeriy(e,t,r){const n=await this.cryptoHelper.sha256(e);return this.keypairHelper.detached_verify(n,t,r)}async signToString(e,t,r="hex"){return(await this.detachedSign(e,t)).toString(r)}async asymmetricEncrypt(e,t,r){const n=await this.ed2curveHelper.convertPublicKey(t);if(!n)throw new Error("decryptPK convertPublicKey fail");const s=await this.ed2curveHelper.convertSecretKey(r);return this.keypairHelper.box(e,n,s)}async asymmetricDecrypt(e,t,r,n=new Uint8Array(24)){const s=await this.ed2curveHelper.convertPublicKey(t);if(!s)throw new Error("decryptPK convertPublicKey fail");const o=await this.ed2curveHelper.convertSecretKey(r);return await this.keypairHelper.open(e,n,s,o)}};$r=h([j("asymmetricHelper"),Oe(0,J("cryptoHelper")),Oe(1,J("keypairHelper")),Oe(2,J("ed2curveHelper")),u("design:paramtypes",[Object,Object,Object])],$r);let Zh=class{calcParityBit(e){let t=0;for(let r=0;r<e.length;r++)t+=e.charCodeAt(r);return t%36}shuffle(e){let t=e.length;for(;t;){const r=Math.floor(Math.random()*t--);[e[r],e[t]]=[e[t],e[r]]}return e}__getRandomString(e){const t=[];for(let s=0;s<10;s++)t[t.length]=s;for(let s=65;s<91;s++)t[t.length]=String.fromCharCode(s);const r=this.shuffle(t);let n="";for(let s=0;s<e;s++)n+=r[Math.floor(Math.random()*e)];return n}__addParityBit(e){const r=`P_${this.calcParityBit(e)}`;return e+zi[r]}createMagic(e){if(e){if(typeof e!="string")throw new Error(`Not a valid magic ${e}`);if(!new RegExp("^[A-Z0-9]{4}$").test(e))throw new Error(`Not a valid magic ${e}`)}else e=this.__getRandomString(4);return this.__addParityBit(e)}createDAppId(e){if(e){if(typeof e!="string")throw new Error(`Not a valid dappid ${e}`);if(!new RegExp("^[A-Z0-9]{7}$").test(e))throw new Error(`Not a valid dappid ${e}`)}else e=this.__getRandomString(7);return this.__addParityBit(e)}};Zh=h([j()],Zh);const jS="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";class JS{constructor(e=jS){this.ALPHABET=e,this.BASE=this.ALPHABET.length,this.ALPHABET_MAP={},this.LEADER=this.ALPHABET.charAt(0);for(let t=0;t<e.length;t++){const r=e.charAt(t);if(this.ALPHABET_MAP[r]!==void 0)throw new TypeError(r+" is ambiguous");this.ALPHABET_MAP[r]=t}}encode(e){if(e.length===0)return"";const t=[0];for(let n=0;n<e.length;++n){let s=e[n];for(let o=0;o<t.length;++o)s+=t[o]<<8,t[o]=s%this.BASE,s=s/this.BASE|0;for(;s>0;)t.push(s%this.BASE),s=s/this.BASE|0}let r="";for(let n=0;e[n]===0&&n<e.length-1;++n)r+=this.ALPHABET[0];for(let n=t.length-1;n>=0;--n)r+=this.ALPHABET[t[n]];return r}decodeUnsafe(e){if(e.length===0)return new Uint8Array;const t=[0];for(let r=0;r<e.length;r++){let n=this.ALPHABET_MAP[e[r]];if(n===void 0)return;let s=n;for(let o=0;o<t.length;++o)s+=t[o]*this.BASE,t[o]=s&255,s>>=8;for(;s>0;)t.push(s&255),s>>=8}for(let r=0;e[r]===this.LEADER&&r<e.length-1;++r)t.push(0);return new Uint8Array(t).reverse()}decode(e){const t=this.decodeUnsafe(e);if(t)return t;throw new Error("Non-base"+this.BASE+" character")}}const YS=new JS;let eu=class{constructor(e,t){this.cryptoHelper=e,this.Buffer=t,this.bs58=YS}async sha256x2(e){const t=await this.cryptoHelper.sha256(e);return this.cryptoHelper.sha256(t)}async encode(e){return this.bs58.encode(this.Buffer.concat([e,await this.sha256x2(e)],e.length+4))}async decodeRaw(e){let t=e.slice(0,-4),r=e.slice(-4),n=await this.sha256x2(t);if(!(r[0]^n[0]|r[1]^n[1]|r[2]^n[2]|r[3]^n[3]))return this.Buffer.from(t)}async decodeUnsafe(e){let t=await this.bs58.decodeUnsafe(e);if(t)return this.decodeRaw(t)}async decode(e){let t=this.bs58.decode(e),r=await this.decodeRaw(t);if(!r)throw new Error("Invalid checksum");return r}};eu=h([j(),Oe(0,J("cryptoHelper")),Oe(1,J("Buffer")),u("design:paramtypes",[Object,Object])],eu);function QS(i,e,t){t=Math.min(i.length,t);for(var r=[],n=e;n<t;){var s=i[n],o=null,a=s>239?4:s>223?3:s>191?2:1;if(n+a<=t){var p,l,f,g;switch(a){case 1:s<128&&(o=s);break;case 2:p=i[n+1],(p&192)===128&&(g=(s&31)<<6|p&63,g>127&&(o=g));break;case 3:p=i[n+1],l=i[n+2],(p&192)===128&&(l&192)===128&&(g=(s&15)<<12|(p&63)<<6|l&63,g>2047&&(g<55296||g>57343)&&(o=g));break;case 4:p=i[n+1],l=i[n+2],f=i[n+3],(p&192)===128&&(l&192)===128&&(f&192)===128&&(g=(s&15)<<18|(p&63)<<12|(l&63)<<6|f&63,g>65535&&g<1114112&&(o=g))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|o&1023),r.push(o),n+=a}return WS(r)}var z_=4096;function WS(i){var e=i.length;if(e<=z_)return String.fromCharCode.apply(String,i);for(var t="",r=0;r<e;)t+=String.fromCharCode.apply(String,i.slice(r,r+=z_));return t}const j_=new WeakMap;let de=class{constructor(e,t,r,n,s){this.cryptoHelper=e,this.keypairHelperInterface=t,this.Buffer=r,this.base58Helper=n,this.config=s}get _prefix(){return this.config.initials}checkSecret(e){if(/^\s|\s$/.test(e))throw new SyntaxError("Main Secret cannot contain spaces at the beginning or end");if(/[\cA-\cZ]/.test(e))throw new SyntaxError("Main Secret cannot contain Special Characters");return!0}async createSecretKeypair(e){return await this.keypairHelperInterface.create(await this.cryptoHelper.sha256(vf(e)))}async getPublicKeyFromSecret(e){return(await this.createSecretKeypair(e)).publicKey}async getPublicKeyStringFromSecret(e,t="hex"){return(await this.getPublicKeyFromSecret(e)).toString(t)}async getBinaryAddressFromPublicKey(e){const t=j_.get(e);if(t)return t;const r=await this.cryptoHelper.sha256(e),n=await this.cryptoHelper.ripemd160(r);return j_.set(e,n),n}async getAddressFromPublicKey(e,t=this._prefix){return t+await this.base58Helper.encode(await this.getBinaryAddressFromPublicKey(e))}getAddressFromPublicKeyString(e,t){return this.getAddressFromPublicKey(pE(e),t)}async getAddressFromSecret(e,t){return this.getAddressFromPublicKey(await this.getPublicKeyFromSecret(e),t)}async isAddress(e){return typeof e!="string"||/^[0-9]{1,20}$/g.test(e)?!1:!(e[0]!==this._prefix||!await this.base58Helper.decodeUnsafe(e.slice(1)))}async createSecondSecretKeypair(e,t){const r=`${e}-${(await this.cryptoHelper.md5(vf(t))).toString("hex")}`,n=await this.cryptoHelper.sha256(vf(r));return this.createSecretKeypair(QS(n,0,n.length))}async getPublicKeyFromSecondSecret(e,t){return(await this.createSecondSecretKeypair(e,t)).publicKey}async getPublicKeyStringFromSecondSecret(e,t,r="hex"){return(await this.getPublicKeyFromSecondSecret(e,t)).toString(r)}async checkSecondSecret(e,t,r){return await this.getPublicKeyStringFromSecondSecret(e,t)===r}async createSecondSecretKeypairV2(e,t){const r=`v2:${e}-${t}`;return this.createSecretKeypair(r)}async getPublicKeyFromSecondSecretV2(e,t){return(await this.createSecondSecretKeypairV2(e,t)).publicKey}async getPublicKeyStringFromSecondSecretV2(e,t,r="hex"){return(await this.getPublicKeyFromSecondSecretV2(e,t)).toString(r)}async checkSecondSecretV2(e,t,r){return await this.getPublicKeyStringFromSecondSecretV2(e,t)===r}};de=h([j(),Oe(0,J("cryptoHelper")),Oe(1,J("keypairHelper")),Oe(2,J("Buffer")),u("design:paramtypes",[Object,Object,Object,eu,te])],de);let Pe=class{constructor(e,t,r,n,s){this.accountBaseHelper=e,this.configHelper=t,this.ipHelper=r,this.parityBitHelper=n,this.jsbiHelper=s,this.MAX_UINT_32_INTEGER=2**32,this.MAX_INT_32_INTEGER=2**31-1,this.MIN_INT_32_INTEGER=-(2**31),this.isValidSecondPublicKey=this.isValidPublicKey,this.isValidAssetNumber=this.isValidStringNumber,this.isValidAccountEquity=this.isValidStringNumber,this.isValidBlockParticipation=this.isValidStringNumber,this.isValidEquityRate=this.isValidStringNumber,this.isValidAssetPrealnum=this.isValidStringNumber}isIp(e){return this.ipHelper.isIp(e)}isIpV4(e){return this.ipHelper.isIpV4(e)}isIpV6(e){return this.ipHelper.isIpV6(e)}isLongitude(e){return/^[\-\+]((0(\.\d{1,10})?)|(([1,9](\d)?)(\.\d{1,10})?)|(1[0-7]\d{1}(\.\d{1,10})?)|(180(\.0{1,10})?))$/.test(e)}isLatitude(e){return/^[\-\+]((0(\.\d{1,10})?)|([1,9](\.\d{1,10})?)|([1-8]\d?(\.\d{1,10})?)|(90(\.0{1,10})?))$/.test(e)}isDNS(e){return/^(?=^.{3,255}$)[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/.test(e)}isEmail(e){return/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/.test(e)?["qq.com","163.com","vip.163.com","263.net","yeah.net","sohu.com","sina.cn","sina.com","eyou.com","gmail.com","hotmail.com","42du.cn"].includes(e.substring(e.indexOf("@")+1)):!1}async isValidLocationNameRecord(e){if(!this.isObject(e))return!1;const{recordType:t,recordValue:r}=e;if(t===void 0||r===void 0||!this.isString(r))return!1;if(t===0)return!0;if(t===1)return this.isIpV4(r);if(t===2)return this.isIpV6(r);if(t===3){const n=r.split(",");return n.length!==2?!1:this.isLongitude(n[0])&&this.isLatitude(n[1])}return t===4?await this.accountBaseHelper.isAddress(r):t===5?this.isValidLocationName(r):t===6?this.isDNS(r):t===8?this.isEmail(r):t===7?this.isURL(r):!1}async isValidRange(e,t){if(e!==0&&e!==1&&e!==2&&e!==4||!this.isArray(t))return!1;if(e===0){if(t.length!==0)return!1}else{if(t.length===0)return!1;switch(e){case 1:for(const r of t)if(!await this.accountBaseHelper.isAddress(r))return!1;break;case 2:for(const r of t)if(!this.isValidDAppId(r))return!1;break;case 4:for(const r of t)if(!this.isValidLocationName(r))return!1;break;default:return!1}}return!0}isValidCipherPublicKeys(e){if(!this.isArray(e))return!1;for(const t of e)if(!this.isValidPublicKey(t))return!1;return!0}isValidAccountSignature(e){if(!e||!this.isObject(e))return!1;const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;return!(!(this.isValidPublicKey(t)&&this.isValidSignature(r))||n&&!s||!n&&s||n&&s&&!(this.isValidPublicKey(n)&&this.isValidSignature(s)))}getVariableType(e){return Object.prototype.toString.call(e)}isBoolean(e){return typeof e=="boolean"}isNaturalNumber(e){return Number.isInteger(e)&&e>=0}isUint32(e){return this.isNaturalNumber(e)&&e<this.MAX_UINT_32_INTEGER}isInt32(e){return Number.isInteger(e)&&e<this.MAX_INT_32_INTEGER&&e>this.MIN_INT_32_INTEGER}isNoEmptyUint8Array(e){return e instanceof Uint8Array&&e.length>0}isPositiveInteger(e){return Number.isInteger(e)&&e>0}isPositiveFloatMatchCondition(e,t){let r=e;if(e&&typeof e.denominator=="number"&&typeof e.numerator=="number"){if(e.denominator===0)return!1;r=e.numerator/e.denominator}return Number.isNaN(r)?!1:t(r)}isPositiveFloatContainZero(e){return this.isPositiveFloatMatchCondition(e,t=>t>=0)}isPositiveFloatNotContainZero(e){return this.isPositiveFloatMatchCondition(e,t=>t>0)}isPositiveBigFloatMatchCondition(e,t){return!(e&&typeof e.denominator=="string"&&typeof e.numerator=="string")||e.denominator==="0"?!1:t(e)}isPositiveBigFloatContainZero(e){return this.isPositiveBigFloatMatchCondition(e,t=>this.jsbiHelper.compareFraction(t,{numerator:0,denominator:888})>=0)}isPositiveBigFloatNotContainZero(e){return this.isPositiveBigFloatMatchCondition(e,t=>this.jsbiHelper.compareFraction(t,{numerator:0,denominator:888})>0)}isFraction(e){if(typeof e!="object"||e===null||!(e.numerator&&e.denominator))return!1;try{const t=BigInt(e.denominator),r=BigInt(0);if(t===r)return!1}catch{return!1}return!0}isFiniteBigInt(e){try{return BigInt(e),!0}catch{return!1}}isEmptyObject(e){if(!this.isObject(e))return!1;let t;for(t in e)return!1;return!0}isArrayEqual(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}isValidBufferSize(e,t){if(e instanceof Uint8Array)return e.length===t;if(this.isString(e)&&e.length===t*2)for(let r=0;r<e.length;r+=1){let n=e[r];return n>="0"&&n<="f"}return!1}isValidPublicKey(e){return this.isValidBufferSize(e,32)}isValidSecretKey(e){return this.isValidBufferSize(e,64)}isString(e){return typeof e=="string"}isHexString(e){return typeof e=="string"&&/^[A-F0-9]+$/i.test(e)}isArray(e){return this.getVariableType(e)==="[object Array]"}isObject(e){return this.getVariableType(e)==="[object Object]"}isImage(e){return this.isString(e)}isURL(e){try{if(this.isString(e))return new URL(e).hostname!==""}catch{}return!1}isValidTransactionSignature(e){return this.isValidSignature(e)}isValidBlockSignature(e){return this.isValidSignature(e)}isValidSignature(e){return this.isValidBufferSize(e,64)}isValidChainOnChainHash(e){return this.isValidBufferSize(e,32)}isValidUpperChainName(e){return this.isString(e)?/^[A-Z0-9]{5,20}$/.test(e):!1}isValidChainName(e){return this.isString(e)?/^[a-z0-9]{5,20}$/.test(e):!1}isValidAssetType(e){return this.isString(e)?/^[A-Z]{3,10}$/.test(e):!1}isValidChainMagic(e){if(!this.isString(e)||!/^[A-Z0-9]{5}$/.test(e))return!1;const t=e.slice(0,4),r=e.slice(4),s=`P_${this.parityBitHelper.calcParityBit(t)}`;return zi[s]===void 0?!1:zi[s].toString()===r}isValidTransactionType(e){if(!this.isString(e))return!1;const t=e.split("-");if(t.length!==4||!this.isValidAssetType(t[0])||!this.isValidUpperChainName(t[1]))return!1;const r=t[2];if(!(r===r.trim().toUpperCase()&&r.length===3))return!1;const n=t[3];return!!(/^[0-9]+$/.test(n)&&n.length===2)}isValidDAppId(e){if(!this.isString(e)||!/^[A-Z0-9]{8}$/.test(e))return!1;const t=e.slice(0,7),r=e.slice(7),s=`P_${this.parityBitHelper.calcParityBit(t)}`;return zi[s]===void 0?!1:zi[s].toString()===r}isValidGenesisUsername(e){return this.isString(e)?/^[A-Za-z0-9_]{1,20}$/.test(e):!1}isValidUsername(e,t=this.configHelper.chainName){return!(!this.isValidGenesisUsername(e)||e.toLowerCase().includes(t))}isMakeUpWithNumber(e){return/^(([0-9])|([1-9](\d)+?))$/.test(e)}isValidStringNumber(e){return this.isString(e)?this.isMakeUpWithNumber(e):!1}isPositiveStringNumber(e){return this.isValidStringNumber(e)&&BigInt(e)>BigInt(0)}isValidLocationName(e,t=this.configHelper.chainName){if(!this.isString(e)||e.length>512||this.isStartWithOrEndWithPoint(e))return!1;const r=e.split("."),n=r.length;if(n<2)return!1;for(let s=0;s<n;s++){const o=r[s];if(o.length>128)return!1;if(s===n-2){if(!this.isLowerCaseLetter(o))return!1}else if(s===n-1){if(o!==t)return!1}else if(o.length<=2){if(!this.isLowerCaseLetterOrNumber(o))return!1}else if(!this.isLowerCaseLetterOrNumberOrUnderline(o))return!1}return!0}isValidNumber(e){const t=e.toString();return!(t.length>1&&t.startsWith("0"))}isValidPort(e){return!Number.isNaN(e)&&this.isValidNumber(e)&&e>0&&e<65536}isValidChainPorts(e){return this.isEmptyObject(e)?!1:this.isValidPort(e.port)&&this.isValidPort(e.scan_peer_port)}isValidChainRewardPercent(e){if(this.isEmptyObject(e)||!(e.votePercent&&e.forgePercent))return!1;const t=e.votePercent,r=e.forgePercent;if(!(this.isPositiveFloatNotContainZero(t.denominator)&&this.isPositiveFloatNotContainZero(r.denominator))||t.denominator!==r.denominator)return!1;const n=t.denominator;return t.numerator+r.numerator===n}isValidChainRewardMilestones(e){if(!(e&&e.heights&&e.rewards))return!1;const t=e.heights,r=e.rewards;if(!(this.isArray(t)&&this.isArray(r)))return!1;const n=t.length,s=r.length;if(n<1||s<2||s-n!==1||r[s-1]!=="0"||Number.isNaN(t[0])||!this.isValidNumber(t[0]))return!1;if(n>1){for(let o=0;o<n-1;o++)if(Number.isNaN(t[o+1])||!this.isValidNumber(t[o+1])||t[o]>=t[o+1])return!1}for(let o=0;o<s;o++)if(!this.isValidAssetNumber(r[o]))return!1;return!0}isUpperCaseString(e){return this.isString(e)&&e===e.trim().toUpperCase()}isLowerCaseString(e){return this.isString(e)&&e===e.trim().toLowerCase()}isScientificCounting(e){return e.includes(".")||e.includes("e")}isLowerCaseLetter(e){return this.isString(e)&&/^[a-z]+$/.test(e)}isUpperCaseLetter(e){return this.isString(e)&&/^[A-Z]+$/.test(e)}isUpperCaseLetterOrNumber(e){return this.isString(e)&&/^[A-Z0-9]+$/.test(e)}isUpperCaseOrLowerCaseLetter(e){return this.isString(e)&&/^[A-Za-z]+$/.test(e)}isUpperCaseOrLowerCaseLetterOrNumber(e){return this.isString(e)&&/^[A-Za-z0-9]+$/.test(e)}isStartWithOrEndWithPoint(e){return!/^[^\.].*[^\.]$/.test(e)}isLowerCaseLetterOrNumber(e){return/^[a-z0-9]+$/.test(e)}isLowerCaseLetterOrNumberOrUnderline(e){return/^[a-z0-9][a-z0-9_]*[a-z0-9]+$/.test(e)}isValidFeeRate(e){if(!e)return!1;const t=e.senderPaidFeeRate,r=e.recipientPaidFeeRate;return!(!this.isPositiveFloatContainZero(t)||!this.isPositiveFloatContainZero(r)||!(t.denominator===1&&r.denominator===1)||!(t.numerator===1&&r.numerator===0||t.numerator===0&&r.numerator===1))}isValidAccountParticipationWeightRatio(e){if(!e)return!1;const{balanceWeight:t,numberOfTransactionsWeight:r}=e;return this.isNaturalNumber(t)&&this.isNaturalNumber(r)}isValidBlockParticipationWeightRatio(e){if(!e)return!1;const{balanceWeight:t,numberOfTransactionsWeight:r}=e;return this.isNaturalNumber(t)&&this.isNaturalNumber(r)}isValidRate(e){if(!e)return!1;const t=e.prevWeight,r=e.nextWeight;try{const n=BigInt(t),s=BigInt(r);return n===BigInt(0)||s===BigInt(0)?!1:typeof r==typeof t}catch{return!1}}isValidAssetExchangeWeightRatio(e){if(!e)return!1;const{toExchangeAssetWeight:t,beExchangeAssetWeight:r}=e;return!(!(this.isValidStringNumber(e.toExchangeAssetWeight)&&this.isValidStringNumber(e.beExchangeAssetWeight))||t==="0"||r==="0")}isValidTpowDiffFormula(e){return!0}isValidEntityFactoryId(e){return this.isString(e)?/^[a-z0-9]{3,15}$/.test(e):!1}isValidEntityId(e){if(!this.isString(e))return!1;const t=e.split("_");if(t.length!==2&&t.length!==3)return!1;const r=/^[a-z0-9]{3,30}$/;return t.length===3?t[0]!=="m"||!this.isValidEntityFactoryId(t[1])?!1:r.test(t[2]):this.isValidEntityFactoryId(t[0])?r.test(t[1]):!1}isValidTindexRanges(e){const t=e.length;if(t===0||t%2!==0||!this.isNaturalNumber(e[0]))return!1;for(let r=1;r<t;r++)if(!this.isPositiveInteger(e[r]))return!1;return!0}isValidCertificateId(e){if(!this.isString(e)||e.length<3||e.length>100||e.includes(":")===!1)return!1;const t=e.split(":");return t.length!==2||this.isPositiveStringNumber(t[0])===!1?!1:/^[A-Za-z0-9\-_]*$/.test(t[1])}};Pe=h([j(),u("design:paramtypes",[de,te,Wo,Zh,It])],Pe);let tu=class{constructor(){this.store=[]}push(e){this.store.push(e)}pop(){return this.store.pop()}peek(){return this.store[this.store.length-1]}isEmpty(){return this.store.length===0}size(){return this.store.length}clear(){this.store=[]}};tu=h([j()],tu);const{ArgumentIllegalException:yn}=re("HELPER","jsbiHelper");let mg=class{constructor(e){this.config=e}getOperatorPatternString(e){let t="";const r=e.length;for(let n=0;n<r;n++){const s=e[n];if(e[e.length]=s,s==="+"||s==="*"||s==="/"||s==="%")t+=`\\${s}`;else if(s==="**"){let o="";for(let a=0;a<2;a++)o+=`\\${s[a]}`;t+=o}else t+=s;n!==r-1&&(t+="|")}return t}isStringNumber(e){return/^[0-9]+$/.test(e)}getFormulaList(e){const t=e.trim().replace(/\s+/gi," ").split(" "),r=[];for(const n of t)n&&(r[r.length]=n);return r}separateParamAndBracket(e){let t="",r="",n=0;return e.includes(bt.LEFT_BRACKET)&&(t=e.slice(e.lastIndexOf(bt.LEFT_BRACKET)+1),r=e.slice(0,e.lastIndexOf(bt.LEFT_BRACKET)+1)),e.includes(bt.RIGHT_BRACKET)&&(t=e.slice(0,e.indexOf(bt.RIGHT_BRACKET)),r=e.slice(e.indexOf(bt.RIGHT_BRACKET)),n=1),{realParam:t,brackets:r,direction:n}}isValidTpowDiffFormula(e){if(!e)return!1;const t=this.getFormulaList(e);if(t.length<3)return!1;let r=0,n=0;for(const p of t){if(p.includes(bt.LEFT_BRACKET)){const{realParam:l,brackets:f}=this.separateParamAndBracket(p);if(r+=f.length,l&&!Bo.includes(l)&&!this.isStringNumber(l))return!1;continue}if(p.includes(bt.RIGHT_BRACKET)){const{realParam:l,brackets:f}=this.separateParamAndBracket(p);if(n+=f.length,l&&!Bo.includes(l)&&!this.isStringNumber(l))return!1;continue}if(!(Bo.includes(p)||Mo.includes(p)||d_.includes(p))){if(!this.isStringNumber(p))return!1;continue}p===bt.LEFT_BRACKET&&r++,p===bt.RIGHT_BRACKET&&n++}if(r!==n)return!1;const s=this.getOperatorPatternString(Mo),o=new RegExp(`^(\\)|${s}).*`,"i"),a=new RegExp(`.(${s}|\\()$`,"i");if(o.test(e)||a.test(e))return!1;for(let p=0;p<t.length;p++){const l=t[p];if(l===bt.LEFT_BRACKET&&Mo.includes(t[p+1])||l===bt.RIGHT_BRACKET&&Mo.includes(t[p-1]))return!1}return!0}checkAndGetCalcTpowDiffParam(e){const t=this.getFormulaList(this.config.tpowDiffFormula),r=[];for(const n of t){if(Mo.includes(n)){r[r.length]=n;continue}if(d_.includes(n)){r[r.length]=n;continue}if(this.isStringNumber(n)){r[r.length]=n;continue}if(Bo.includes(n)){if(e[n]===void 0)throw new yn(c.PROP_IS_REQUIRE,{prop:n,target:"params"});r[r.length]=n;continue}if(n.includes(bt.LEFT_BRACKET)||n.includes(bt.RIGHT_BRACKET)){const{realParam:s,brackets:o,direction:a}=this.separateParamAndBracket(n);if(s&&Bo.includes(s)&&e[s]===void 0)throw new yn(c.PROP_IS_REQUIRE,{prop:s,target:"params"});if(a){s&&(r[r.length]=s);for(const p of o)r[r.length]=p}else{for(const p of o)r[r.length]=p;s&&(r[r.length]=s)}}}return r}calcResult(e,t,r){const n=r===BigInt(0)?BigInt(1):r;switch(t){case Yt.ADD:return e+r;case Yt.SUBTRACT:return e-r;case Yt.MULTIPLY:return e*r;case Yt.DIVIDE:return e/n;case Yt.POWER:return e**r;case Yt.MODULAR:return e%n}}getOperatorPriority(e){switch(e){case Yt.ADD:return 1;case Yt.SUBTRACT:return 1;case Yt.MULTIPLY:return 2;case Yt.DIVIDE:return 2;case Yt.POWER:return 3;case Yt.MODULAR:return 2;default:throw new yn(c.PROP_IS_INVALID,{prop:`operator ${e}`,target:"tpowDiffFormula"})}}calcOperatorPriority(e,t){const r=this.getOperatorPriority(e),n=this.getOperatorPriority(t);return r>=n}calcDiffOfTransactionProfOfWork(e){const t=this.checkAndGetCalcTpowDiffParam(e),r=new tu,n=new tu,s=a=>{if(Bo.includes(a)){const p=e[a];r.push(BigInt(p));return}if(this.isStringNumber(a)){r.push(BigInt(a));return}if(Mo.includes(a)){for(;;){let p=n.peek();if(!p){n.push(a);break}if(p===bt.LEFT_BRACKET){n.push(a);break}let l=n.peek();if(this.calcOperatorPriority(l,a)){l=n.pop();const f=r.pop();if(f===void 0)throw new yn(c.PROP_IS_REQUIRE,{prop:"nextIntem",target:"dataStack"});const g=r.pop();if(g===void 0)throw new yn(c.PROP_IS_REQUIRE,{prop:"prevItem",target:"dataStack"});r.push(this.calcResult(g,l,f))}else{n.push(a);break}}return}if(a===bt.LEFT_BRACKET){n.push(a);return}if(a===bt.RIGHT_BRACKET)for(;;){const p=n.pop();if(!p)throw new yn(c.PROP_IS_REQUIRE,{prop:"operator",target:"operatorStack"});if(p===bt.LEFT_BRACKET)break;const l=r.pop();if(l===void 0)throw new yn(c.PROP_IS_REQUIRE,{prop:"nextIntem",target:"dataStack"});const f=r.pop();if(f===void 0){if(n.pop()!==bt.LEFT_BRACKET)throw new yn(c.SHOULD_BE,{to_compare_prop:"nextOperator",to_target:"operatorStack",be_compare_prop:bt.LEFT_BRACKET});if(n.size()>0)throw new yn(c.PROP_LENGTH_SHOULD_EQ_FIELD,{prop:"size",target:"operatorStack",field:0});r.push(l);continue}r.push(this.calcResult(f,p,l))}},o=()=>{for(;n.size()!==0;){const a=n.pop();if(!a)throw new yn(c.PROP_IS_REQUIRE,{prop:"operator",target:"operatorStack"});const p=r.pop();if(p===void 0)throw new yn(c.PROP_IS_REQUIRE,{prop:"nextIntem",target:"dataStack"});const l=r.pop();if(l===void 0)throw new yn(c.PROP_IS_REQUIRE,{prop:"prevItem",target:"dataStack"});r.push(this.calcResult(l,a,p))}};for(const a of t)s(a);return o(),r.peek()}};mg=h([j(),u("design:paramtypes",[te])],mg);let Gs=class{constructor(e,t,r){this.config=e,this.jsbiHelper=t,this.Buffer=r,this._cache_of_diff_numerator_BI=new Map,this._cache_of_diff_BI={num:-1,participation:"",diff_BI:BigInt(0)},this._PROGRESS_FIX=1e6,this._PROGRESS_FIX_BI=BigInt(this._PROGRESS_FIX),this.BI_2_32=BigInt(32),this.BI_2_16=BigInt(16),this.BI_2_8=BigInt(8)}get growthFactorBI(){const{growthFactor:e}=this.config.transactionPowOfWorkConfig;return{numerator:BigInt(e.numerator),denominator:BigInt(e.denominator)}}get participationRatioBI(){const{participationRatio:e}=this.config.transactionPowOfWorkConfig;return{numerator:BigInt(e.numerator),denominator:BigInt(e.denominator)}}get genesisAmountBI(){return BigInt(this.config.genesisAmount)}get MAX_SAFE_INTEGER_BI(){return BigInt(Number.MAX_SAFE_INTEGER)}logBI(e){const{MAX_SAFE_INTEGER_BI:t}=this,{MAX_SAFE_INTEGER:r}=Number;if(e<=t)return Math.log(Number(e));const n=e/t;if(n>=t)throw new RangeError("log bigint out range.");const s=Number(e-n*t)/r;return Math.log(Number(n)+s)+Math.log(r)}get hardDiffThresholdBI(){const e=BigInt(this.config.blockPerRound),t=BigInt(this.config.forgeInterval);return BigInt(this.config.averageComputingPower)*t*e/(e-BigInt(1))}calcDiffBaseBI(e){const{growthFactorBI:t}=this;let r=this._cache_of_diff_numerator_BI.get(e);if(!r){const n=BigInt(e),s=t.numerator,o=t.denominator;r=s**n/o**n*n,this._cache_of_diff_numerator_BI.set(e,r)}return r}accDiffBaseBI(e){const t=e%1;let r=BigInt(0);for(let n=0;n<=e;n++)r+=this.calcDiffBaseBI(n);return t!==0&&(r+=this.jsbiHelper.multiplyCeilFraction(this.calcDiffBaseBI(e-t+1),this.jsbiHelper.numberToFraction(t))),r}calcTpowParticipationBI(e,t){return BigInt(e+1)*BigInt(t)}calcDiffOfTransactionProfOfWork(e,t){const{_cache_of_diff_BI:r,hardDiffThresholdBI:n}=this;let s;if(r.num===e&&r.participation===t)s=r.diff_BI;else{const{growthFactorBI:o,jsbiHelper:a}=this;let p=this._cache_of_diff_numerator_BI.get(e);if(!p){const y=BigInt(e),m=o.numerator,E=o.denominator;p=m**y/E**y*y,this._cache_of_diff_numerator_BI.set(e,p)}if(p===BigInt(0))return p;const f=1/this.calcNeedOnlineTime(t),g=this.accDiffBaseBI(f),d={numerator:n,denominator:g};s=a.multiplyCeilFraction(p,d),r.num=e,r.participation=t,r.diff_BI=s}return s}calcNeedOnlineTime(e){const{participationRatioBI:t}=this,r=Number(this.jsbiHelper.multiplyCeilFraction(e,t))/1e11,n=.238536212611/(1-.7936005508148*Math.E**(-.0847138128036*r)),s=Number(e)/1e8;if(s>1e6){const o=Math.cbrt(10),a=1e6/o**4,p=y=>Math.log(y/a)/Math.log(o),l=176/53,f=4/(4-l),d=1/((p(s)-l)*f);if(d<n)return d}return n}_calcTransactionProfOfWorkScore(e,t,r,n){if(n||(n=this.calcDiffOfTransactionProfOfWork(t,r)),n<BigInt(1))return!1;const s=Math.max(Math.min(Math.ceil(Math.log2(Number(n*(BigInt(1)+n)))),e.length),8),o=BigInt(2)<<BigInt(s-1),a=o/n,p=this.getUintN(this.Buffer.from(e),s);return{diff:n,done:p<=a,conditionScore:a,totalScore:o,score:p}}async calcTransactionProfOfWorkProgress(e,t,r,n){const s=this._calcTransactionProfOfWorkScore(e,t,r,n);return!s||s.done?1:Number((s.score-s.conditionScore)*this._PROGRESS_FIX_BI/(s.totalScore-s.conditionScore))/this._PROGRESS_FIX}async checkTransactionProfOfWork(e,t,r,n){const s=this._calcTransactionProfOfWorkScore(e,t,r,n);return!!(!s||s.done)}*nonceWriter(e){e=e.$type.decode(e.getBytes(!0,!0)),e.nonce||(e.nonce=0),yield{uint8array:new Uint8Array(e.$type.encode(e).finish()),nonce:0},e.nonce=1;const r=new Uint8Array(e.$type.encode(e).finish());yield{uint8array:r,nonce:1},e.nonce=2;const n=new Uint8Array(e.$type.encode(e).finish());yield{uint8array:n,nonce:2};let s=0;for(let o=0;o<r.length;o++)if(r[o]!==n[o]){s=o;break}for(let o=3;o<4294967296;o++){const a=n.length,p=new ArrayBuffer(a),l=new Uint8Array(p);l.set(n,0),new DataView(p).setUint32(s,o,!0),yield{uint8array:l,nonce:o,offset:s}}}getUintN(e,t){let r=BigInt(0),n=0;for(;t>0;)if(t>=32){const s=BigInt(e.readUInt32BE(n));r=(r<<this.BI_2_32)+s,n+=4,t-=32}else if(t>=16){const s=BigInt(e.readUInt16BE(n));r=(r<<this.BI_2_16)+s,n+=2,t-=16}else if(t>=8){const s=BigInt(e.readUInt8(n));r=(r<<this.BI_2_8)+s,n+=1,t-=8}else{const s=e.readUInt8(n)>>8-t,o=BigInt(s);r=(r<<BigInt(t))+o,t-=t}return r}};h([ne,u("design:type",Object),u("design:paramtypes",[])],Gs.prototype,"growthFactorBI",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Gs.prototype,"participationRatioBI",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Gs.prototype,"genesisAmountBI",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Gs.prototype,"MAX_SAFE_INTEGER_BI",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Gs.prototype,"hardDiffThresholdBI",null);Gs=h([j(),Oe(2,J("Buffer")),u("design:paramtypes",[te,It,Object])],Gs);const qS=Symbol("bfchain-core:TransactionFilter"),XS=Symbol("bfchain-core:AbortForbiddenTransaction"),{ArgumentFormatException:Lf,ArgumentIllegalException:J_,NoFoundException:ZS}=re("HELPER","transactionHelper");let me=class{constructor(e,t,r,n,s,o,a,p,l){this.config=e,this.baseHelper=t,this.jsbiHelper=r,this.cryptoHelper=n,this.keypairHelper=s,this.Buffer=o,this.asymmetricHelper=a,this.accountBaseHelper=p,this.tpowHelper=l,this.ALL_TRANSACTION_TYPES=[this.SIGNATURE,this.DELEGATE,this.VOTE,this.USERNAME,this.ACCEPT_VOTE,this.REJECT_VOTE,this.CUSTOM,this.DAPP,this.DAPP_PURCHASING,this.REGISTER_CHAIN,this.MARK,this.ISSUE_ASSET,this.DESTROY_ASSET,this.TRANSFER_ASSET,this.TO_EXCHANGE_ASSET,this.BE_EXCHANGE_ASSET,this.GIFT_ASSET,this.GRAB_ASSET,this.TRUST_ASSET,this.SIGN_FOR_ASSET,this.EMIGRATE_ASSET,this.IMMIGRATE_ASSET,this.TO_EXCHANGE_SPECIAL_ASSET,this.BE_EXCHANGE_SPECIAL_ASSET,this.LOCATION_NAME,this.SET_LNS_RECORD_VALUE,this.SET_LNS_MANAGER,this.ISSUE_ENTITY_FACTORY,this.ISSUE_ENTITY,this.DESTROY_ENTITY,this.TRANSFER_ANY,this.GIFT_ANY,this.GRAB_ANY,this.TO_EXCHANGE_ANY,this.BE_EXCHANGE_ANY,this.ISSUE_ENTITY_MULTI,this.TO_EXCHANGE_ANY_MULTI,this.BE_EXCHANGE_ANY_MULTI,this.TO_EXCHANGE_ANY_MULTI_ALL,this.BE_EXCHANGE_ANY_MULTI_ALL,this.MULTIPLE,this.PROMISE,this.PROMISE_RESOLVE,this.MACRO,this.MACRO_CALL,this.ISSUE_CERTIFICATE,this.DESTROY_CERTIFICATE],this.abortForbiddenTransaction=!0}get _ASSETTYPE(){return this.config.assetType}get _CHAIN_NAME(){return this.config.chainName.toUpperCase()}parseType(e){const t=e.indexOf("-"),r=e.indexOf("-",t+1),n=e.substr(r+1);return{assetType:e.substr(0,t),chainName:e.substring(t+1,r),baseType:n}}resolveType(e){return`${e.assetType}-${e.chainName}-${e.baseType}`}getTypeName(e){const{baseType:t}=this.parseType(e);return this.getTypeNameByBaseType(t)}getTypeNameByBaseType(e){return je.VK.get(e)}getTransactionType(e){return`${this._ASSETTYPE}-${this._CHAIN_NAME}-${e}`}isValidType(e){return this.baseHelper.isValidTransactionType(e)}async generateSignature(e){return ly(await this.cryptoHelper.sha256(e.getBytes(!0,!0)))}isValidTransactionSignature(e){return this.baseHelper.isValidTransactionSignature(e)}get SIGNATURE(){return this.getTransactionType(H.SIGNATURE)}get DELEGATE(){return this.getTransactionType(H.DELEGATE)}get VOTE(){return this.getTransactionType(H.VOTE)}get USERNAME(){return this.getTransactionType(H.USERNAME)}get ACCEPT_VOTE(){return this.getTransactionType(H.ACCEPT_VOTE)}get REJECT_VOTE(){return this.getTransactionType(H.REJECT_VOTE)}get CUSTOM(){return this.getTransactionType(H.CUSTOM)}get DAPP(){return this.getTransactionType(H.DAPP)}get DAPP_PURCHASING(){return this.getTransactionType(H.DAPP_PURCHASING)}get REGISTER_CHAIN(){return this.getTransactionType(H.REGISTER_CHAIN)}get MARK(){return this.getTransactionType(H.MARK)}get ISSUE_ASSET(){return this.getTransactionType(H.ISSUE_ASSET)}get DESTROY_ASSET(){return this.getTransactionType(H.DESTROY_ASSET)}get TRANSFER_ASSET(){return this.getTransactionType(H.TRANSFER_ASSET)}get GIFT_ASSET(){return this.getTransactionType(H.GIFT_ASSET)}get GRAB_ASSET(){return this.getTransactionType(H.GRAB_ASSET)}get TRUST_ASSET(){return this.getTransactionType(H.TRUST_ASSET)}get SIGN_FOR_ASSET(){return this.getTransactionType(H.SIGN_FOR_ASSET)}get EMIGRATE_ASSET(){return this.getTransactionType(H.EMIGRATE_ASSET)}get IMMIGRATE_ASSET(){return this.getTransactionType(H.IMMIGRATE_ASSET)}get TO_EXCHANGE_ASSET(){return this.getTransactionType(H.TO_EXCHANGE_ASSET)}get BE_EXCHANGE_ASSET(){return this.getTransactionType(H.BE_EXCHANGE_ASSET)}get TO_EXCHANGE_SPECIAL_ASSET(){return this.getTransactionType(H.TO_EXCHANGE_SPECIAL_ASSET)}get BE_EXCHANGE_SPECIAL_ASSET(){return this.getTransactionType(H.BE_EXCHANGE_SPECIAL_ASSET)}get LOCATION_NAME(){return this.getTransactionType(H.LOCATION_NAME)}get SET_LNS_RECORD_VALUE(){return this.getTransactionType(H.SET_LNS_RECORD_VALUE)}get SET_LNS_MANAGER(){return this.getTransactionType(H.SET_LNS_MANAGER)}get ISSUE_ENTITY_FACTORY(){return this.getTransactionType(H.ISSUE_ENTITY_FACTORY)}get ISSUE_ENTITY_FACTORY_V1(){return this.getTransactionType(H.ISSUE_ENTITY_FACTORY_V1)}get ISSUE_ENTITY(){return this.getTransactionType(H.ISSUE_ENTITY)}get DESTROY_ENTITY(){return this.getTransactionType(H.DESTROY_ENTITY)}get TRANSFER_ANY(){return this.getTransactionType(H.TRANSFER_ANY)}get GIFT_ANY(){return this.getTransactionType(H.GIFT_ANY)}get GRAB_ANY(){return this.getTransactionType(H.GRAB_ANY)}get TO_EXCHANGE_ANY(){return this.getTransactionType(H.TO_EXCHANGE_ANY)}get BE_EXCHANGE_ANY(){return this.getTransactionType(H.BE_EXCHANGE_ANY)}get ISSUE_ENTITY_MULTI(){return this.getTransactionType(H.ISSUE_ENTITY_MULTI)}get TO_EXCHANGE_ANY_MULTI(){return this.getTransactionType(H.TO_EXCHANGE_ANY_MULTI)}get BE_EXCHANGE_ANY_MULTI(){return this.getTransactionType(H.BE_EXCHANGE_ANY_MULTI)}get TO_EXCHANGE_ANY_MULTI_ALL(){return this.getTransactionType(H.TO_EXCHANGE_ANY_MULTI_ALL)}get BE_EXCHANGE_ANY_MULTI_ALL(){return this.getTransactionType(H.BE_EXCHANGE_ANY_MULTI_ALL)}get MULTIPLE(){return this.getTransactionType(H.MULTIPLE)}get PROMISE(){return this.getTransactionType(H.PROMISE)}get PROMISE_RESOLVE(){return this.getTransactionType(H.PROMISE_RESOLVE)}get MACRO(){return this.getTransactionType(H.MACRO)}get MACRO_CALL(){return this.getTransactionType(H.MACRO_CALL)}get ISSUE_CERTIFICATE(){return this.getTransactionType(H.ISSUE_CERTIFICATE)}get DESTROY_CERTIFICATE(){return this.getTransactionType(H.DESTROY_CERTIFICATE)}genesisDelegates(e=this.config){const t=[],r=e.genesisBlock.transactionInfo.transactionInBlocks;for(const n of r){const{baseType:s}=this.parseType(n.transaction.type);s===H.DELEGATE&&t.push(n.transaction.senderId)}return t}async getGensisAcountAddress(e=this.config){return this.accountBaseHelper.getAddressFromPublicKeyString(e.genesisAccountPublicKey)}async verifyTransactionSignature(e,t){const r=t&&t.taskLabel||"Transaction",{signSignatureBuffer:n,signatureBuffer:s,senderSecondPublicKeyBuffer:o,senderPublicKeyBuffer:a}=e,p=await this.cryptoHelper.sha256().update(e.getBytes(!0,!0)).digest();if(!await this.keypairHelper.detached_verify(p,s,a))throw new Lf(c.INVALID_SIGNATURE,{taskLabel:r});if(o&&o.length>0||n&&n.length>0)if(o&&n){const l=await this.cryptoHelper.sha256().update(e.getBytes(!1,!0)).digest();if(!await this.keypairHelper.detached_verify(l,n,o))throw new Lf(c.INVALID_SIGNSIGNATURE,{taskLabel:r})}else throw new Lf(`Invalid ${r} miss signSignature or senderSecondPublicKey`)}verifyTransactionSize(e){const{maxTransactionSize:t}=this.config,r=e.getBytes().length;if(r>t)throw new J_(c.PROP_SHOULD_LTE_FIELD,{prop:`transaction size ${r}`,target:"transaction",field:t})}verifyTransactionBlobSize(e){const{maxBlobSizePerTransaction:t}=this.config;if(e.blobSize>t)throw new J_(c.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${e.blobSize}`,target:"transaction",field:t})}__calcStandardMinFee(e){const t=this.config.minTransactionFeePerByte;return e?this.jsbiHelper.compareFraction(t,e)>=0?t:e:t}calcMinFeePerBytes(e,t,r=this.config.minTransactionFeePerByte){let n=t,s=e;do{const o=this.jsbiHelper.multiplyCeilFraction(n,r).toString();if(o.length===s.length)return o;n+=o.length-s.length,s=o}while(!0)}calcTransactionMinFeeByBytes(e,t,r){return BigInt(this.calcMinFeePerBytes(e.fee,t||e.getBytes().length,this.__calcStandardMinFee(r)))}calcTransactionMinFeeByMaxBytes(e,t){return this.jsbiHelper.multiplyCeilFraction(this.config.maxTransactionSize,this.__calcStandardMinFee(t))*BigInt(e)}calcTransactionMinFeeByMulti(e,t,r,n){const s=this.calcMinFeePerBytes(e.fee,r||e.getBytes().length,this.__calcStandardMinFee(n));return BigInt(s)*BigInt(t)}calcTransactionBlobFee(e,t){const r=e.blobSize;if(r===0)return BigInt(0);const n=this.calcMinFeePerBytes(e.fee,r,this.__calcStandardMinFee(t));return this.jsbiHelper.multiplyCeilFraction(BigInt(n),this.config.blobFeeMultipleRatio)}calcTransactionMinFee(e,t,r){const n=e.type;if(n===this.GIFT_ASSET){const s=e.asset.giftAsset.totalGrabableTimes+1;return(this.calcTransactionMinFeeByMaxBytes(s,r)+this.calcTransactionBlobFee(e,r)).toString()}if(n===this.GIFT_ANY){const s=e.asset.giftAny.totalGrabableTimes+1;return(this.calcTransactionMinFeeByMaxBytes(s,r)+this.calcTransactionBlobFee(e,r)).toString()}if(n===this.TRUST_ASSET){const s=e.asset.trustAsset.numberOfSignFor+1;return(this.calcTransactionMinFeeByMaxBytes(s,r)+this.calcTransactionBlobFee(e,r)).toString()}return n===this.ISSUE_ENTITY_MULTI?(this.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length,void 0,r)+this.calcTransactionBlobFee(e,r)).toString():n==this.TO_EXCHANGE_ANY_MULTI?(this.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.calcTransactionBlobFee(e,r)).toString():n===this.BE_EXCHANGE_ANY_MULTI?(this.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.calcTransactionBlobFee(e,r)).toString():n===this.GRAB_ASSET||n===this.GRAB_ANY||n===this.SIGN_FOR_ASSET?this.calcTransactionBlobFee(e,r):(this.calcTransactionMinFeeByBytes(e,t,r)+this.calcTransactionBlobFee(e,r)).toString()}calcTransactionFee(e,t=this.config.minTransactionFeePerByte){return this.calcMinFeePerBytes(e.fee,e.getBytes().length,t)}get calcNeedOnlineTime(){return this.tpowHelper.calcNeedOnlineTime.bind(this.tpowHelper)}get calcTpowParticipationBI(){return this.tpowHelper.calcTpowParticipationBI.bind(this.tpowHelper)}get calcDiffOfTransactionProfOfWork(){return this.tpowHelper.calcDiffOfTransactionProfOfWork.bind(this.tpowHelper)}get checkTransactionProfOfWork(){return this.tpowHelper.checkTransactionProfOfWork.bind(this.tpowHelper)}nonceWriter(e){return this.tpowHelper.nonceWriter(e)}hashCode(e){let t=0,r=0;const n=e.length;for(;r<n;)t=(t<<5)-t+e.charCodeAt(r++)<<0;return Math.abs(t)}async calcGrabRandomGiftAssetNumber(e,t,r,n,s,o){const a=BigInt(s);if(o===1)return a;const{jsbiHelper:p}=this,l=BigInt(0),f=BigInt(this.config.miniUnit),g=a/BigInt(o);if(g===l)return f;const d=BigInt(`0x${await this.cryptoHelper.md5().update(e).update(t).update(r).update(n).digest("hex")}`),y=p.multiplyFloorFractionString(s,{numerator:d,denominator:BigInt(2)**BigInt(128)});if(y<f)return f;const m=g*BigInt(2);if(y<=m)return y;let E=y%m;return y>m*BigInt(2)&&E<=g&&(E+=g),E}async calcGrabRecipientRandomGiftAssetNumber(e,t,r,n,s,o){const a=new Map;let p=BigInt(0);for(const f of s){const g=BigInt(`0x${(await this.cryptoHelper.md5().update(t).update(r).update(n).update(f).digest("hex")).substr(0,16)}`);p=p+g,a.set(f,g)}const l=a.get(e);if(!l)throw new ZS(c.NOT_EXIST,{prop:`grabId(${e})`,target:"giftTransactionRecipient"});return l*BigInt(o)/p}calcGrabAverageGiftAssetNumber(e,t){const r=BigInt(e),n=BigInt(this.config.miniUnit);if(t===1)return r;const s=BigInt(0),o=r/BigInt(t);return o===s?n:o}calcGrabGiftAssetNumber(e,t,r){const n=t.asset.giftAsset;switch(n.giftDistributionRule){case 0:return this.calcGrabAverageGiftAssetNumber(n.amount,n.totalGrabableTimes);case 1:return this.calcGrabRandomGiftAssetNumber(e,r,t.signatureBuffer,t.senderId,n.amount,n.totalGrabableTimes);case 2:return this.calcGrabRandomGiftAssetNumber(e,r,t.signatureBuffer,t.senderId,n.amount,n.totalGrabableTimes)}}async generateGrabAsset(e,t,r){const n=await this.accountBaseHelper.createSecretKeypair(r.mainSecret),s=e.asset.giftAsset,{grabId:o=await this.accountBaseHelper.getAddressFromPublicKey(n.publicKey),grabSecret:a}=r,p=e.signatureBuffer;let l;a&&(l=lt.fromObject({signatureBuffer:await this.getCiphertextSignature({secret:a,transactionSignatureBuffer:p,senderId:o}),publicKeyBuffer:n.publicKey}));const f=Un.fromObject({blockSignatureBuffer:t,transactionSignatureBuffer:p,giftAsset:s,ciphertextSignature:l});return f.amount=(await this.calcGrabGiftAssetNumber(o,e,t)).toString(),f}async getCiphertextSignature(e){return this.asymmetricHelper.detachedSign(await this.cryptoHelper.sha256().update(e.transactionSignatureBuffer).update(e.senderId).digest(),(await this.accountBaseHelper.createSecretKeypair(e.secret)).secretKey)}async verifyCiphertextSignature(e){return this.asymmetricHelper.detachedVeriy(await this.cryptoHelper.sha256().update(e.transactionSignatureBuffer).update(e.senderId).digest(),e.ciphertextSignatureBuffer,e.secretPublicKey)}getTransactionMaxEffectiveHeight(e){return e.effectiveBlockHeight}getTransactionMinEffectiveHeight(e){let t=e.applyBlockHeight;if(e instanceof oa){const r=e.asset.giftAsset.beginUnfrozenBlockHeight;r&&(t=r)}return t}isTransactionInFilter(e){return!(this.transactionFilter&&!this.transactionFilter.includes(e))}sortTransactionAssetChanges(e){return e.sort((t,r)=>{if(t.accountType>r.accountType)return 1;if(t.accountType<r.accountType)return-1;if(t.sourceChainMagic>r.sourceChainMagic)return 1;if(t.sourceChainMagic<r.sourceChainMagic)return-1;if(t.assetType>r.assetType)return 1;if(t.assetType<r.assetType)return-1;const n=BigInt(t.assetPrealnum),s=BigInt(r.assetPrealnum);return n>s?1:n<s?-1:0})}calcTransactionQueryRange(e,t=this.config){const r=e-t.maxApplyAndConfirmedBlockHeightDiff;return{startHeight:r<=0?1:r,endHeight:e-1}}calcTransactionQueryRangeByApplyBlockHeight(e,t){return{startHeight:e,endHeight:t-1}}getFactoryIdByEntityId(e){const t=e.split("_");return t.length>2?t[1]:t[0]}calcDestroyMainAssetsOfIsseuEntityFactory(e,t=this.config){const r=this.jsbiHelper,n=r.divisionFraction({numerator:e,denominator:"1"},t.maxMultipleOfEntityAndMainAsset);return r.multiplyCeilFraction(lE,n).toString()}tIndexRangesToTindexes(e){let t=e[0];const r=[t];for(let n=1;n<e.length;n++)if(n%2===1)for(let s=0;s<e[n]-1;s++)r[r.length]=++t;else t+=e[n]+1,r[r.length]=t;return r}tIndexRangesToStartAndEndTindex(e){let t=e[0];const r=[t];t+=e[1],r.push(t-1);for(let n=2;n<e.length;n+=2)t+=e[n],r.push(t),t+=e[n+1],r.push(t-1);return r}};h([ne,u("design:type",Object),u("design:paramtypes",[])],me.prototype,"calcNeedOnlineTime",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],me.prototype,"calcTpowParticipationBI",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],me.prototype,"checkTransactionProfOfWork",null);h([J(qS,{optional:!0}),u("design:type",Array)],me.prototype,"transactionFilter",void 0);h([J(XS,{dynamics:!0}),u("design:type",Object)],me.prototype,"abortForbiddenTransaction",void 0);me=h([j(),Oe(3,J("cryptoHelper")),Oe(4,J("keypairHelper")),Oe(5,J("Buffer")),u("design:paramtypes",[te,Pe,It,Object,Object,Object,$r,de,Gs])],me);const{NoFoundException:ew,ArgumentIllegalException:Df,RefuseException:gh}=re("helper","blobHelper");let Ci=class{constructor(e){this.timeHelper=e}support(e,t="readwrite"){let r=!0;return e==="SHA256"?(t.includes("read")&&(r=r&&this.blobSha256Reader!==void 0),t.includes("write")&&(r=r&&this.blobSha256Writer!==void 0)):r=!1,r}supportAlgorithms(e){const t=new Set;for(const r of["SHA256"])this.support(r,e)&&t.add(r);return t}async exists(e){const{blobSha256Reader:t}=this;return!t||e.algorithm!=="SHA256"?!1:t.has(e.hash)}async open(e){const{blobSha256Reader:t}=this;if(t===void 0)throw new ew(c.PARAM_LOST,{param:"blobSha256Reader"});const{hash:r,algorithm:n}=e;if(n!=="SHA256")throw new Df(c.BLOB_ALGORITHM_IS_INVALID,{hash:r,algorithm:n});return await t.open(r)}async read(e){const{blobSha256Reader:t}=this;if(t===void 0)throw new Df(c.PARAM_LOST,{param:"blobSha256Reader"});return{chunkBuffer:await t.read(e.descriptor,e.start,e.end)}}async close(e){const{blobSha256Reader:t}=this;if(t===void 0)throw new Df(c.PARAM_LOST,{param:"blobSha256Reader"});return await t.close(e.descriptor)}requestStorage(e,t,r,n,s){const{blobSha256Writer:o}=this;if(!o)throw new gh(c.PARAM_LOST,{param:"blobSha256Writer"});return o.requestStorage(e,t,r,n,s)}saveChunk(e,t,r){const{blobSha256Writer:n}=this;if(!n)throw new gh(c.PARAM_LOST,{param:"blobSha256Writer"});return n.saveChunk(e,t,r)}saveAsBlob(e){const{blobSha256Writer:t}=this;if(!t)throw new gh(c.PARAM_LOST,{param:"blobSha256Writer"});return t.saveAsBlob(e)}changeBlobStrategy(e,t){const{blobSha256Writer:r}=this;if(!r)throw new gh(c.PARAM_LOST,{param:"blobSha256Writer"});return r.changeBlobStrategy(e,t)}};h([J("blobSha256Reader",{optional:!0}),u("design:type",Object)],Ci.prototype,"blobSha256Reader",void 0);h([J("blobSha256Writer",{optional:!0}),u("design:type",Object)],Ci.prototype,"blobSha256Writer",void 0);Ci=h([j(),u("design:paramtypes",[Vt])],Ci);class tw{constructor(e,t){this.magic=e,this.assetType=t}}const Y_=new Map,Q_=new WeakSet;let ke=class{isChainAssetInfo(e){return Q_.has(e)}getAssetInfo(e,t){const r=e+":"+t;let n=Y_.get(r);return n||(n=new tw(e,t),Object.freeze(n),Y_.set(r,n),Q_.add(n)),n}};ke=h([j()],ke);var _g,Ag;re("helper-block_base_statistics","blockBaseStatisticsHelper");let zs=_g=class{constructor(e,t,r,n){this.transactionHelper=e,this.chainAssetInfo=t,this.config=r,this.moduleMap=n,this._block_statistics_m=new Map}getConfig(){return this.tempConfig||this.config}forceGetStatisticsInfoByBlock(e,t,r,n){let s=this._block_statistics_m.get(e);return s||(s=Ot(Pl,new et([[Pl.SOURCE_DATA_SYMBOL,r]],this.moduleMap)),s.on("destroy",()=>{this._block_statistics_m.delete(e)}),this._block_statistics_m.set(e,s)),s.ref(t),n&&(this.tempConfig=n,s.on("destroy",()=>{this._block_statistics_m.delete(e),this.tempConfig=void 0})),s}getStatisticsInfoByBlock(e){return this._block_statistics_m.get(e)}_applyFee(e,t){const{applyInfo:r,transaction:n}=e,{address:s,assetInfo:o}=r,a=BigInt(r.sourceAmount),{baseType:p}=this.transactionHelper.parseType(n.type),l=t.initAssetStatistic(o);l.total.changeAmount=(BigInt(l.total.changeAmount)+a).toString(),l.total.moveAmount=(BigInt(l.total.moveAmount)+a).toString(),l.total.changeCount+=1;const f=n.signature;t.subIdMap.has(f)||(l.total.transactionCount+=1,t.subIdMap.set(f,!0));const g=t.initTypeStatistic(o,p);t.totalFee=t.totalFee+a,t.totalAsset=t.totalAsset+a,t.totalChainAsset=t.totalChainAsset+a,t.addTotalAccount(s),g.changeAmount=(BigInt(g.changeAmount)+a).toString(),g.changeCount+=1,g.moveAmount=(BigInt(g.moveAmount)+a).toString(),t.typeSubIdMap.has(f)||(g.transactionCount+=1,t.typeSubIdMap.set(f,!0))}_applyAsset(e,t,r=!1){const{applyInfo:n,transaction:s}=e,{type:o}=s,a=BigInt(n.sourceAmount),{baseType:p}=this.transactionHelper.parseType(o),l=t.initAssetStatistic(n.assetInfo),f=t.initTypeStatistic(n.assetInfo,p);l.total.changeAmount=(BigInt(l.total.changeAmount)+a).toString(),l.total.changeCount+=1;const g=s.signature;if(t.subIdMap.has(g)||(l.total.transactionCount+=1,t.subIdMap.set(g,!0)),f.changeAmount=(BigInt(f.changeAmount)+a).toString(),f.changeCount+=1,t.typeSubIdMap.has(g)||(f.transactionCount+=1,t.typeSubIdMap.set(g,!0)),n.amount.startsWith("-")||r){l.total.moveAmount=(BigInt(l.total.moveAmount)+a).toString(),t.totalAsset=t.totalAsset+a;const{assetInfo:d}=n,y=this.getConfig();d.assetType===y.assetType&&d.magic===y.magic&&(t.totalChainAsset=t.totalChainAsset+a),f.moveAmount=(BigInt(f.moveAmount)+a).toString()}t.addTotalAccount(n.address)}bindApplyTransactionEventEmiter(e,t){const r=_g.eventEmitterStatisticsWM.forceGet(e);if(!r.has(t))return r.add(t),e.on("fee",(n,s)=>(this._applyFee(n,t),s()),{taskname:"applyTransaction/blockStatistic/fee"}),e.on("feeFromUnfrozen",(n,s)=>(this._applyFee(n,t),s()),{taskname:"applyTransaction/blockStatistic/feeFromUnfrozen"}),e.on("asset",(n,s)=>(this._applyAsset(n,t),s()),{taskname:"applyTransaction/blockStatistic/asset"}),e.on("frozenAsset",(n,s)=>(this._applyAsset(n,t),s()),{taskname:"applyTransaction/blockStatistic/frozenAsset"}),e.on("unfrozenAsset",(n,s)=>(this._applyAsset(n,t,!0),s()),{taskname:"applyTransaction/blockStatistic/unfrozenAsset"}),e.on("issueAsset",(n,s)=>(this._applyAsset(n,t,!0),s()),{taskname:"applyTransaction/blockStatistic/issueAsset"}),!0}};zs.eventEmitterStatisticsWM=new ps(i=>new WeakSet);zs=_g=h([j("bfchain-core:BlockBaseStatistics"),u("design:paramtypes",[me,ke,te,et])],zs);let Pl=Ag=class extends wn{constructor(e=On.fromObject({}),t){super(),this.source_data=e,this.chainAssetInfoHelper=t,this.subIdMap=new Map,this.typeSubIdMap=new Map,this._accountAddressSet=new Set,this._souce_data_totalAccount=this.source_data.totalAccount,this._reasonSet=new Set}get totalFee(){return this._totalFee||(this._totalFee=BigInt(this.source_data.totalFee))}set totalFee(e){this._totalFee=e}get totalAsset(){return this._totalAsset||(this._totalAsset=BigInt(this.source_data.totalAsset))}set totalAsset(e){this._totalAsset=e}get totalChainAsset(){return this._totalChainAsset||(this._totalChainAsset=BigInt(this.source_data.totalChainAsset))}set totalChainAsset(e){this._totalChainAsset=e}get totalAccount(){return this.source_data.totalAccount}addTotalAccount(e){return this._accountAddressSet.add(e),this.source_data.totalAccount=this._souce_data_totalAccount+this._accountAddressSet.size}getAssetTypeTypeStatisticMap(e){let t=this.source_data.magicAssetTypeTypeStatisticMap.get(e);return t||(t=eo.fromObject({}),this.source_data.magicAssetTypeTypeStatisticMap.set(e,t)),t.assetTypeTypeStatisticMap}__initAssetStatistic(){return Zi.fromObject({typeStatisticHashMap:{},total:{changeAmount:"0",changeCount:0,moveAmount:"0",transactionCount:0}})}getAssetStatistic(e){const{magic:t,assetType:r}=e,n=this.getAssetTypeTypeStatisticMap(t);let s=n.get(r);return s||(s=this.__initAssetStatistic(),n.set(r,s)),s}setAssetStatistic(e,t){const{magic:r,assetType:n}=e;let o=this.source_data.magicAssetTypeTypeStatisticMap.get(r);return o||(o=eo.fromObject({}),this.source_data.magicAssetTypeTypeStatisticMap.set(r,o)),o.assetTypeTypeStatisticMap.set(n,t),this}initAssetStatistic(e){const{magic:t,assetType:r}=e,n=this.getAssetTypeTypeStatisticMap(t);let s=n.get(r);return s||(s=this.__initAssetStatistic(),n.set(r,s)),s}__initTypeStatistic(){return Qn.fromObject({changeAmount:"0",changeCount:0,moveAmount:"0",transactionCount:0})}getTypeStatistic(e,t){let n=this.getAssetStatistic(e).typeStatisticMap.get(t);return n||(n=this.__initTypeStatistic()),n}setTypeStatistic(e,t,r){return this.getAssetStatistic(e).typeStatisticMap.set(t,r),this}initTypeStatistic(e,t){const r=this.getAssetStatistic(e);let n=r.typeStatisticMap.get(t);return n||(n=this.__initTypeStatistic(),r.typeStatisticMap.set(t,n)),n}ref(e){this._reasonSet.add(e)}unref(e){this._reasonSet.delete(e),this._reasonSet.size===0&&this.emit("destroy")}toModel(){return this._totalFee&&(this.source_data.totalFee=this._totalFee.toString()),this._totalAsset&&(this.source_data.totalAsset=this._totalAsset.toString()),this._totalChainAsset&&(this.source_data.totalChainAsset=this._totalChainAsset.toString()),this.source_data.format()}};Pl.SOURCE_DATA_SYMBOL=Symbol("source-data");Pl=Ag=h([j(),Oe(0,J(Ag.SOURCE_DATA_SYMBOL,{optional:!0})),u("design:paramtypes",[Object,ke])],Pl);const{ArgumentFormatException:ri,NoFoundException:Vi,ArgumentIllegalException:DC,OutOfRangeException:rw,IllegalStateException:nw,ConsensusException:sw}=re("HELPER","blockHelper");let _t=class{constructor(e,t,r,n,s,o,a){this.config=e,this.baseHelper=t,this.accountBaseHelper=r,this.jsbiHelper=n,this.cryptoHelper=s,this.keypairHelper=o,this.Buffer=a,this._BTC_BLOCK_WM=new WeakMap,this._BLOCK_BTC_WM=new WeakMap}async generateSignature(e){return ly(await this.cryptoHelper.sha256(e.getBytes(!0,!0)))}isValidSignature(e){return this.baseHelper.isValidSignature(e)}async verifyBlockSignature(e,t){const r=t&&t.taskLabel||"Block",{Buffer:n}=this,{generatorPublicKeyBuffer:s,signatureBuffer:o,generatorSecondPublicKeyBuffer:a,signSignatureBuffer:p}=e,l=await this.cryptoHelper.sha256(e.getBytes(!0,!0,!0));if(!await this.keypairHelper.detached_verify(l,o,s))throw new ri(c.INVALID_SIGNATURE,{taskLabel:r});if(a&&a.length>0||p&&p.length>0)if(a&&p){const f=await this.cryptoHelper.sha256().update(e.getBytes(!1,!0,!0)).digest();if(!this.keypairHelper.detached_verify(f,n.from(p),n.from(a)))throw new ri(c.INVALID_SIGNSIGNATURE,{taskLabel:r})}else throw new ri(`Invalid ${r} miss signSignature or senderSecondPublicKey`)}verifyBlockVersion(e,t=this.config){if(e.version>t.version)throw new sw(c.NOT_MATCH,{to_compare_prop:`block version ${e.version}`,be_compare_prop:`blockChain version ${t.version}`,to_target:"block",be_target:"config"})}parseTypeByHeight(e){return e===1?zt.GENESIS:e%this.config.blockPerRound===0?zt.ROUNDEND:zt.COMMON}calcRoundByHeight(e){return Math.ceil(e/this.config.blockPerRound)}calcBlockNumberToRoundEnd(e){return this.config.blockPerRound-(e%this.config.blockPerRound||this.config.blockPerRound)}calcRoundStartHeight(e){return(e-1)*this.config.blockPerRound+1}calcRoundEndHeight(e){return e*this.config.blockPerRound}calcRoundStartHeightByHeight(e){const t=this.calcRoundByHeight(e);return this.calcRoundStartHeight(t)}calcRoundEndHeightByHeight(e){const t=this.calcRoundByHeight(e);return this.calcRoundEndHeight(t)}calcBlockChainRoundByHeight(e){return this.calcRoundByHeight(e+1)}async forceGetBlockByHeight(e,t=this.blockGetterHelper){if(!t)throw new Vi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=await t.getBlockByHeight(e);if(!r)throw new ri(c.NOT_EXIST,{prop:`height:${e}`,target:"blocks"});return r}async forceGetBlockBySignature(e,t=this.blockGetterHelper){if(!t)throw new Vi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=await t.getBlockBySignature(e);if(!r)throw new ri(c.NOT_EXIST,{prop:`signature: ${e}`,target:"blockChain"});return r}async forceGetBlockListByHeightRange(e,t,r=this.blockGetterHelper){const n=[];if(e>t)throw new rw(c.OUT_OF_RANGE,{variable:"min and max",message:`min: ${e} max: ${t}`});for(let s=e;s<=t;s++)n[n.length]=await this.forceGetBlockByHeight(s,r);return n}async forceGetBlockGeneratorAddressByHeight(e,t=this.blockGetterHelper){if(!t)throw new Vi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=typeof t.getBlockGeneratorPublicKeyBufferByHeight=="function"?await t.getBlockGeneratorPublicKeyBufferByHeight(e):(await this.forceGetBlockByHeight(e,t)).generatorPublicKeyBuffer;if(!r)throw new ri(c.NOT_EXIST,{prop:`height:${e}`,target:"generatorPublicKey"});return this.accountBaseHelper.getAddressFromPublicKey(r)}async forceGetBlockSignatureBufferByHeight(e,t=this.blockGetterHelper){if(!t)throw new Vi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=typeof t.getBlockSignatureByHeight=="function"?await t.getBlockSignatureByHeight(e):(await this.forceGetBlockByHeight(e,t)).signatureBuffer;if(!r)throw new ri(c.NOT_EXIST,{prop:`height:${e}`,target:"generatorPublicKey"});return r}async forceGetBlockSignatureByHeight(e,t=this.blockGetterHelper){return Me(await this.forceGetBlockSignatureBufferByHeight(e,t))}async getLastBlock(e=this.blockGetterHelper){if(!e)throw new Vi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});return e.getLastBlock()}async getBlocksByRange(e,t,r=this.blockGetterHelper){if(!r)throw new Vi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});if(!("getBlockByHeight"in r))return r.getBlocksByRange(e,t);if("getBlockByHeight"in r){const n=[];for(let s=e;s<t;s++){const o=await r.getBlockByHeight(s);if(!o)break;n.push(o)}return n}throw new nw(c.FAILED_TO_GET_BLOCKS_BY_RANGE,{minHeight:e,maxHeight:t})}async getCurrentGenerateBlock(e=this.blockGetterHelper){if(e&&e.getCurrentGenerateBlock)return e.getCurrentGenerateBlock()}async getCurrentReplayingBlockInfo(e=this.blockGetterHelper){if(e&&e.getCurrentReplayingBlockInfo)return e.getCurrentReplayingBlockInfo()}async getCurrentProcessingBlockPlotChecker(e=this.blockGetterHelper){const t=await this.getCurrentGenerateBlock();if(t)return this.parseNewBlockToPlotChecker(t);const r=await this.getCurrentReplayingBlockInfo(e);if(r)return this.parseBlockToPlotChecker(r.replayingBlock||r.currentBlock)}parseBlockToPlotChecker(e){let t=this._BLOCK_BTC_WM.get(e);return t||(t={height:e.height,timestamp:e.timestamp,get blockParticipation(){return Object.defineProperty(this,"blockParticipation",{value:BigInt(e.blockParticipation)}),this.blockParticipation},numberOfTransactions:e.numberOfTransactions,get totalFee(){return Object.defineProperty(this,"totalFee",{value:BigInt(e.totalFee)}),this.totalFee},signature:e.signature,previousBlockSignature:e.previousBlockSignature},this._BLOCK_BTC_WM.set(e,t),this._BTC_BLOCK_WM.set(t,e)),t}getBlockFromPlotChecker(e){return this._BTC_BLOCK_WM.get(e)}parseNewBlockToPlotChecker(e){return{height:e.height,timestamp:e.timestamp,get blockParticipation(){return Object.defineProperty(this,"blockParticipation",{value:BigInt(e.blockParticipation)}),this.blockParticipation},numberOfTransactions:e.numberOfTransactions,get totalFee(){return Object.defineProperty(this,"totalFee",{value:BigInt(e.totalFee)}),this.totalFee},signature:"signature"in e?e.signature:"ff".repeat(64),previousBlockSignature:e.previousBlockSignature}}parseBlockPlotCheckerListToPlotChecker(e){const t=e[0],r=e[e.length-1];return{height:r.height,timestamp:r.timestamp,get blockParticipation(){return Object.defineProperty(this,"blockParticipation",{value:e.reduce((s,o)=>s+o.blockParticipation,BigInt(0))}),this.blockParticipation},get numberOfTransactions(){return Object.defineProperty(this,"numberOfTransactions",{value:e.reduce((s,o)=>s+o.numberOfTransactions,0)}),this.numberOfTransactions},get totalFee(){return Object.defineProperty(this,"totalFee",{value:e.reduce((s,o)=>s+o.totalFee,BigInt(0))}),this.totalFee},get signature(){return Object.defineProperty(this,"signature",{value:e.reduce((s,o)=>s+o.signature,"")}),this.signature},previousBlockSignature:t.previousBlockSignature}}calcTpowParticipation(e,t){return BigInt(e+1)*BigInt(t)}calcAccountRoundEquity(e,t,r){const{balanceWeight:n,numberOfTransactionsWeight:s}=this.config.accountParticipationWeightRatio,o=BigInt(e)*BigInt(s);return(BigInt(t)*BigInt(n)+o).toString()}calcBlockParticipation(e){const{totalChainAsset:t,numberOfTransactions:r}=e,{balanceWeight:n,numberOfTransactionsWeight:s}=this.config.blockParticipationWeightRatio,o=BigInt(t)*BigInt(n),a=BigInt(r)*BigInt(s);return(o+a).toString()}async forceGetBlockGeneratorAddressByRound(e,t=this.blockGetterHelper){if(!t)throw new Vi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const r=(e-1)*this.config.blockPerRound+1,n=e*this.config.blockPerRound,s=[];for(let o=r;o<=n;o++){const a=typeof t.getBlockGeneratorPublicKeyBufferByHeight=="function"?await t.getBlockGeneratorPublicKeyBufferByHeight(o):(await this.forceGetBlockByHeight(o,t)).generatorPublicKeyBuffer;if(!a)throw new ri(c.NOT_EXIST,{prop:`height:${o}`,target:"generatorPublicKey"});const p=await this.accountBaseHelper.getAddressFromPublicKey(a);s.includes(p)||s.push(p)}return s}async calcChainOnChainHash(e,t){let r=(this.calcRoundByHeight(e)-1)*this.config.blockPerRound;r=r===0?1:r;const n=await this.cryptoHelper.sha256();if(r!==1){const o=await this.forceGetBlockByHeight(r,t);n.update(o.asset.roundLastAsset.hashBuffer)}for(let o=r;o<e;o++){const a=await this.forceGetBlockSignatureBufferByHeight(o,t);n.update(a)}return(await n.digest()).toString("hex")}nextRoundDelegatesCompareFn(e,t){return t.vote>e.vote?1:t.vote<e.vote?-1:t.productivity>e.productivity?1:t.productivity<e.productivity?-1:e.publicKey>t.publicKey?1:e.publicKey===t.publicKey?0:-1}sortInRankAccountInfoList(e){return e.sort(this.nextRoundDelegatesCompareFn)}calcRewardsForForginAndVoting(e,t){let r=BigInt(e.totalFee);(e.magic==="181PI"&&e.height>17100||e.magic==="TUJT3"&&e.height>188613||e.magic==="BPZBE"&&e.height>17800||e.magic==="8Y885"&&e.height>0||e.magic==="VVYYQ"&&e.height>0||e.magic==="I1QQW"&&e.height>0)&&(r=BigInt(0));const n=BigInt(e.reward),s={blockFee:r,blockReward:n,reward:n+r,vrewards:BigInt(0),vrewardsRemaining:BigInt(0)};if(e.height!==1&&t>BigInt(0)){const{jsbiHelper:o,config:a}=this,p=a.rewardPercent.votePercent,l=o.multiplyFloorFraction(r,p),f=o.multiplyFloorFraction(n,p);s.blockFee=r-l,s.blockReward=n-f,s.reward=s.blockFee+s.blockReward,s.vrewards=l+f}return s}calcForgingAndVotingReward(e,t,r){return{...this.calcRewardsForForginAndVoting(e,r),voters:t,totalEquity:r}}calcVotingRewards(e,t,r){return r*e/t}calcBlockVotesRewards(e,t,r){const n={};let s=BigInt(0);for(const a of e){const p=this.calcVotingRewards(a.equity,t,r);s+=p,n[a.address]=p}const o=r-s;return{voteRewardList:n,vrewardsRemaining:o}}};h([J("blockGetterHelper",{optional:!0}),u("design:type",Object)],_t.prototype,"blockGetterHelper",void 0);_t=h([j(),Oe(4,J("cryptoHelper")),Oe(5,J("keypairHelper")),Oe(6,J("Buffer")),u("design:paramtypes",[te,Pe,de,It,Object,Object,Object])],_t);const{ArgumentFormatException:W_}=re("HELPER","milestonesHelper");let Es=class{constructor(e,t){this.config=e,this.baseHelper=t,this.isVaildMilestones(),this.heights=this.config.milestones.heights,this.rewards=this.config.milestones.rewards,this.genesisAmount=this.config.genesisAmount}isVaildMilestones(){if(!this.baseHelper.isValidChainRewardMilestones(this.config.milestones))throw new W_(c.PROP_IS_INVALID,{prop:"milestones",target:"config"})}parseHeight(e){if(!this.baseHelper.isPositiveInteger(e))throw new W_(c.PROP_IS_INVALID,{prop:"height",type:"positive integer"});return Number(e)}binarySearchMiles(e,t){if(e[0]>=t)return 0;if(e[e.length-1]<t)return e.length;let r=0,n=e.length-1,s;for(;r<n;)s=Math.floor((r+n)/2),e[s]>=t?n=s:r=s+1;return r}calcReward(e){if(e=this.parseHeight(e),e===1||this.heights.length===0)return"0";const t=Math.floor(this.binarySearchMiles(this.heights,e));return this.rewards[t]}calcSupply(e){e=this.parseHeight(e);const t=Math.floor(this.binarySearchMiles(this.heights,e));let r=BigInt(this.genesisAmount);const n=new Map;let s,o;for(let a=0;a<=t;a++)o=BigInt(this.rewards[a]),a===0?s=this.heights[a]-1:a===t?s=e-this.heights[a-1]:s=this.heights[a]-this.heights[a-1],s=BigInt(s),n.set(a,o*s);return n.forEach((a,p)=>{r+=a}),r.toString()}calcAllSupply(){const e=this.heights[this.heights.length-1],t=this.heights.length;let r=BigInt(this.genesisAmount);const n=new Map;let s,o;for(let a=0;a<=t;a++)o=BigInt(this.rewards[a]),a===0?s=this.heights[a]-1:a===t?s=e-this.heights[a-1]:s=this.heights[a]-this.heights[a-1],s=BigInt(s),n.set(a,o*s);return n.forEach((a,p)=>{r+=a}),r.toString()}};Es=h([j(),u("design:paramtypes",[te,Pe])],Es);class es{constructor(e){this._map=new Map(e)}get(e){return this._map.get(e)}has(e){return this._map.has(e)}set(e,t){return this._map.set(e,t)}[Symbol.iterator](){return this._map.entries()}entries(){return this._map[Symbol.iterator]}static fromPrefix(e,t){const r=new es;for(const[n,s]of t)r.set(e+n,s);return r}mergeWithPrefix(e,t){for(const[r,n]of t)this.set(e+r,n);return this}}const tt="/",bn="utf-8",{ArgumentIllegalException:rs}=re("HELPER","transactionHelper");let Eg=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new rs(c.PROP_IS_REQUIRE,{prop:`chainInfo ${e}`,target:"encodeArgs"});const{chainName:t,magic:r,genesisBlockSignature:n}=e;if(!t)throw new rs(c.PROP_IS_REQUIRE,{prop:`chainName ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new rs(c.PROP_IS_INVALID,{prop:`chainName ${t}`,target:"encodeArgs"});if(!r)throw new rs(c.PROP_IS_REQUIRE,{prop:`magic ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new rs(c.PROP_IS_INVALID,{prop:`magic ${r}`,target:"encodeArgs"});if(!n)throw new rs(c.PROP_IS_REQUIRE,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new rs(c.PROP_IS_INVALID,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new rs(c.PROP_IS_REQUIRE,{prop:`fromChainId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new rs(c.PROP_IS_INVALID,{prop:`fromChainId ${e}`,target:"decodeArgs"});if(e.split(tt).length!==4)throw new rs(c.PROP_IS_INVALID,{prop:`fromChainId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${tt}${e.magic}${tt}${e.chainName}${tt}${e.genesisBlockSignature}`}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(tt);return{magic:r[1],chainName:r[2],genesisBlockSignature:r[3]}}};Eg=h([j()],Eg);function iw(i="fromChainId"){const e=new Eg;return new es([[`${i}/${e.version}`,e]])}const{ArgumentIllegalException:ns}=re("HELPER","transactionHelper");let Ig=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new ns(c.PROP_IS_REQUIRE,{prop:`chainInfo ${e}`,target:"encodeArgs"});const{chainName:t,magic:r,genesisBlockSignature:n}=e;if(!t)throw new ns(c.PROP_IS_REQUIRE,{prop:`chainName ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new ns(c.PROP_IS_INVALID,{prop:`chainName ${t}`,target:"encodeArgs"});if(!r)throw new ns(c.PROP_IS_REQUIRE,{prop:`magic ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new ns(c.PROP_IS_INVALID,{prop:`magic ${r}`,target:"encodeArgs"});if(!n)throw new ns(c.PROP_IS_REQUIRE,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new ns(c.PROP_IS_INVALID,{prop:`genesisBlockSignature ${n}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new ns(c.PROP_IS_REQUIRE,{prop:`toChainId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new ns(c.PROP_IS_INVALID,{prop:`toChainId ${e}`,target:"decodeArgs"});if(e.split(tt).length!==4)throw new ns(c.PROP_IS_INVALID,{prop:`toChainId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${tt}${e.magic}${tt}${e.chainName}${tt}${e.genesisBlockSignature}`}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(tt);return{magic:r[1],chainName:r[2],genesisBlockSignature:r[3]}}};Ig=h([j()],Ig);function ow(i="toChainId"){const e=new Ig;return new es([[`${i}/${e.version}`,e]])}const{ArgumentIllegalException:uc}=re("HELPER","transactionHelper");let Tg=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new uc(c.PROP_IS_REQUIRE,{prop:`address ${e}`,target:"encodeArgs"});if(typeof e!="string")throw new uc(c.PROP_IS_INVALID,{prop:`address ${e}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new uc(c.PROP_IS_REQUIRE,{prop:`fromId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new uc(c.PROP_IS_INVALID,{prop:`fromId ${e}`,target:"decodeArgs"});if(e.split(tt).length!==2)throw new uc(c.PROP_IS_INVALID,{prop:`fromId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${tt}${e}`}decode(e,t=!1){return t||this.checkDecodeArgs(e),e.split(tt)[1]}};Tg=h([j()],Tg);function aw(i="fromId"){const e=new Tg;return new es([[`${i}/${e.version}`,e]])}const{ArgumentIllegalException:fc}=re("HELPER","transactionHelper");let Sg=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new fc(c.PROP_IS_REQUIRE,{prop:`address ${e}`,target:"encodeArgs"});if(typeof e!="string")throw new fc(c.PROP_IS_INVALID,{prop:`address ${e}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new fc(c.PROP_IS_REQUIRE,{prop:`toId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new fc(c.PROP_IS_INVALID,{prop:`toId ${e}`,target:"decodeArgs"});if(e.split(tt).length!==2)throw new fc(c.PROP_IS_INVALID,{prop:`toId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${tt}${e}`}decode(e,t=!1){return t||this.checkDecodeArgs(e),e.split(tt)[1]}};Sg=h([j()],Sg);function cw(i="toId"){const e=new Sg;return new es([[`${i}/${e.version}`,e]])}const{ArgumentIllegalException:Do}=re("HELPER","transactionHelper");let wg=class{constructor(){this.version="1"}checkEncodeArgs(e){if(!e)throw new Do(c.PROP_IS_REQUIRE,{prop:`assetInfo ${e}`,target:"encodeArgs"});const{parentAssetType:t,assetType:r}=e;if(t!==L.DAPP&&t!==L.LOCATION_NAME&&t!==L.ENTITY&&t!==L.ASSETS)throw new Do(c.PROP_IS_INVALID,{prop:`parentAssetType ${t}`,target:"encodeArgs"});if(typeof r!="string")throw new Do(c.PROP_IS_INVALID,{prop:`assetType ${r}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new Do(c.PROP_IS_REQUIRE,{prop:`assetId ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new Do(c.PROP_IS_INVALID,{prop:`assetId ${e}`,target:"decodeArgs"});if(e.split(tt).length!==3)throw new Do(c.PROP_IS_INVALID,{prop:`assetId ${e}`,target:"decodeArgs"})}encode(e,t=!1){return t||this.checkEncodeArgs(e),`${this.version}${tt}${e.parentAssetType}${tt}${e.assetType}`}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(tt);return{parentAssetType:Number(r[1]),assetType:r[2]}}};wg=h([j()],wg);function pw(i="assetId"){const e=new wg;return new es([[`${i}/${e.version}`,e]])}const{ArgumentIllegalException:Sr}=re("HELPER","transactionHelper");let bg=class{constructor(){this.version="1"}checkEncodeArgs(e){const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;if(!t)throw new Sr(c.PROP_IS_REQUIRE,{prop:`publicKey ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new Sr(c.PROP_IS_INVALID,{prop:`publicKey ${t}`,target:"encodeArgs"});if(!r)throw new Sr(c.PROP_IS_REQUIRE,{prop:`signature ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new Sr(c.PROP_IS_INVALID,{prop:`signature ${r}`,target:"encodeArgs"});if(n){if(!n)throw new Sr(c.PROP_IS_REQUIRE,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new Sr(c.PROP_IS_INVALID,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(!s)throw new Sr(c.PROP_IS_REQUIRE,{prop:`signSignature ${s}`,target:"encodeArgs"});if(typeof s!="string")throw new Sr(c.PROP_IS_INVALID,{prop:`signSignature ${s}`,target:"encodeArgs"})}else if(s)throw new Sr(c.SHOULD_NOT_EXIST,{prop:`signSignature ${s}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new Sr(c.PROP_IS_REQUIRE,{prop:`signature ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new Sr(c.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"});const t=e.split("/");if(t.length!==2&&t.length!==3)throw new Sr(c.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"});if(t[1].split("-").length!==2)throw new Sr(c.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"});if(t[2]&&t[2].split("-").length!==2)throw new Sr(c.PROP_IS_INVALID,{prop:`signature ${e}`,target:"decodeArgs"})}encode(e,t=!1){t||this.checkEncodeArgs(e);let r=`${this.version}${tt}${e.publicKey}-${e.signature}`;return e.secondPublicKey&&e.signSignature&&(r+=`${tt}${e.secondPublicKey}-${e.signSignature}`),r}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(tt),n=r[1].split("-"),s={publicKey:n[0],signature:n[1]};if(r[2]){const o=r[2].split("-");s.secondPublicKey=o[0],s.signSignature=o[1]}return s}splitSignature(e){return e.split("/")[0]}splitSignSignature(e){return e.split("/").slice(0,2).join(tt)}async generateSignature(e,t,r){const{secret:n,secondSecret:s,migrateCertificate:o}=e;o.signature=this.version;const a=await t.createSecretKeypair(n),p=Me(a.publicKey),l=await r.detachedSign(kr.from(JSON.stringify({body:o.body,signature:o.signature}),bn),a.secretKey);if(o.signature+=`/${p}-${Me(l)}`,s){const f=await t.createSecondSecretKeypairV2(n,s),g=Me(f.publicKey),d=await r.detachedSign(kr.from(JSON.stringify({body:o.body,signature:o.signature}),bn),f.secretKey);o.signature+=`/${g}-${Me(d)}`}return o}async verifySignature(e,t,r){const n=r&&r.taskLabel||"MigrateCertificate",s=e.signature,o=this.decode(s);if(!await t.detachedVeriy(kr.from(JSON.stringify({body:e.body,signature:this.splitSignature(s)}),bn),he(o.signature),he(o.publicKey)))throw new Sr(c.INVALID_SIGNATURE,{taskLabel:n});if(o.secondPublicKey&&o.signSignature&&!await t.detachedVeriy(kr.from(JSON.stringify({body:e.body,signature:this.splitSignSignature(s)}),bn),he(o.signSignature),he(o.secondPublicKey)))throw new Sr(c.INVALID_SIGNSIGNATURE,{taskLabel:n})}};bg=h([j()],bg);function lw(i="signature"){const e=new bg;return new es([[`${i}/${e.version}`,e]])}const{ArgumentIllegalException:wr}=re("HELPER","transactionHelper");let Ng=class{constructor(){this.version="1"}checkEncodeArgs(e){const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;if(!t)throw new wr(c.PROP_IS_REQUIRE,{prop:`publicKey ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new wr(c.PROP_IS_INVALID,{prop:`publicKey ${t}`,target:"encodeArgs"});if(!r)throw new wr(c.PROP_IS_REQUIRE,{prop:`signature ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new wr(c.PROP_IS_INVALID,{prop:`signature ${r}`,target:"encodeArgs"});if(n){if(!n)throw new wr(c.PROP_IS_REQUIRE,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new wr(c.PROP_IS_INVALID,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(!s)throw new wr(c.PROP_IS_REQUIRE,{prop:`signSignature ${s}`,target:"encodeArgs"});if(typeof s!="string")throw new wr(c.PROP_IS_INVALID,{prop:`signSignature ${s}`,target:"encodeArgs"})}else if(s)throw new wr(c.SHOULD_NOT_EXIST,{prop:`signSignature ${s}`,target:"encodeArgs"})}checkDecodeArgs(e){if(!e)throw new wr(c.PROP_IS_REQUIRE,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new wr(c.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});const t=e.split("/");if(t.length!==2&&t.length!==3)throw new wr(c.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});if(t[1].split("-").length!==2)throw new wr(c.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"});if(t[2]&&t[2].split("-").length!==2)throw new wr(c.PROP_IS_INVALID,{prop:`fromAuthSignature ${e}`,target:"decodeArgs"})}encode(e,t=!1){t||this.checkEncodeArgs(e);let r=`${this.version}${tt}${e.publicKey}-${e.signature}`;return e.secondPublicKey&&e.signSignature&&(r+=`${tt}${e.secondPublicKey}-${e.signSignature}`),r}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(tt),n=r[1].split("-"),s={publicKey:n[0],signature:n[1]};if(r[2]){const o=r[2].split("-");s.secondPublicKey=o[0],s.signSignature=o[1]}return s}splitSignature(e){return e.split("/")[0]}splitSignSignature(e){return e.split("/").slice(0,2).join(tt)}async generateSignature(e,t,r){const{authSecret:n,authSecondSecret:s,migrateCertificate:o}=e;o.fromAuthSignature=this.version;const a=await t.createSecretKeypair(n),p=Me(a.publicKey),l=await r.detachedSign(kr.from(JSON.stringify({body:o.body,signature:o.signature,fromAuthSignature:o.fromAuthSignature}),bn),a.secretKey);if(o.fromAuthSignature+=`/${p}-${Me(l)}`,s){const f=await t.createSecondSecretKeypairV2(n,s),g=Me(f.publicKey),d=await r.detachedSign(kr.from(JSON.stringify({body:o.body,signature:o.signature,fromAuthSignature:o.fromAuthSignature}),bn),f.secretKey);o.fromAuthSignature+=`/${g}-${Me(d)}`}return o}async verifySignature(e,t,r){const n=r&&r.taskLabel||"MigrateCertificate",s=e.fromAuthSignature,o=this.decode(s);if(!await t.detachedVeriy(kr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:this.splitSignature(s)}),bn),he(o.signature),he(o.publicKey)))throw new wr(c.INVALID_FROMAUTHSIGNATURE,{taskLabel:n});if(o.secondPublicKey&&o.signSignature&&!await t.detachedVeriy(kr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:this.splitSignSignature(s)}),bn),he(o.signSignature),he(o.secondPublicKey)))throw new wr(c.INVALID_FROMAUTHSIGNSIGNATURE,{taskLabel:n})}};Ng=h([j()],Ng);function hw(i="fromAuthSignature"){const e=new Ng;return new es([[`${i}/${e.version}`,e]])}const{ArgumentIllegalException:br}=re("HELPER","transactionHelper");let xg=class{constructor(){this.version="1"}checkEncodeArgs(e){const{publicKey:t,signature:r,secondPublicKey:n,signSignature:s}=e;if(!t)throw new br(c.PROP_IS_REQUIRE,{prop:`publicKey ${t}`,target:"encodeArgs"});if(typeof t!="string")throw new br(c.PROP_IS_INVALID,{prop:`publicKey ${t}`,target:"encodeArgs"});if(!r)throw new br(c.PROP_IS_REQUIRE,{prop:`signature ${r}`,target:"encodeArgs"});if(typeof r!="string")throw new br(c.PROP_IS_INVALID,{prop:`signature ${r}`,target:"encodeArgs"});if(n){if(!n)throw new br(c.PROP_IS_REQUIRE,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(typeof n!="string")throw new br(c.PROP_IS_INVALID,{prop:`secondPublicKey ${n}`,target:"encodeArgs"});if(!s)throw new br(c.PROP_IS_REQUIRE,{prop:`signSignature ${s}`,target:"encodeArgs"});if(typeof s!="string")throw new br(c.PROP_IS_INVALID,{prop:`signSignature ${s}`,target:"encodeArgs"})}else if(s)throw new br(c.SHOULD_NOT_EXIST,{prop:`signSignature ${s}`,target:"encodeArgs"})}checkDecodeArgs(e,t){if(!e)throw new br(c.PROP_IS_REQUIRE,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});if(typeof e!="string")throw new br(c.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});const r=e.split("/");if(r.length!==2&&r.length!==3)throw new br(c.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});if(r[1].split("-").length!==2)throw new br(c.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"});if(r[2]&&r[2].split("-").length!==2)throw new br(c.PROP_IS_INVALID,{prop:`toAuthSignature ${e}`,target:"decodeArgs"})}encode(e,t=!1){t||this.checkEncodeArgs(e);let r=`${this.version}${tt}${e.publicKey}-${e.signature}`;return e.secondPublicKey&&e.signSignature&&(r+=`${tt}${e.secondPublicKey}-${e.signSignature}`),r}decode(e,t=!1){t||this.checkDecodeArgs(e);const r=e.split(tt),n=r[1].split("-"),s={publicKey:n[0],signature:n[1]};if(r[2]){const o=r[2].split("-");s.secondPublicKey=o[0],s.signSignature=o[1]}return s}splitSignature(e){return e.split("/")[0]}splitSignSignature(e){return e.split("/").slice(0,2).join(tt)}async generateSignature(e,t,r){const{authSecret:n,authSecondSecret:s,migrateCertificate:o}=e;o.toAuthSignature=this.version;const a=await t.createSecretKeypair(n),p=Me(a.publicKey),l=await r.detachedSign(kr.from(JSON.stringify({body:o.body,signature:o.signature,fromAuthSignature:o.fromAuthSignature,toAuthSignature:o.toAuthSignature}),bn),a.secretKey);if(o.toAuthSignature+=`/${p}-${Me(l)}`,s){const f=await t.createSecondSecretKeypairV2(n,s),g=Me(f.publicKey),d=await r.detachedSign(kr.from(JSON.stringify({body:o.body,signature:o.signature,fromAuthSignature:o.fromAuthSignature,toAuthSignature:o.toAuthSignature}),bn),f.secretKey);o.toAuthSignature+=`/${g}-${Me(d)}`}return o}async verifySignature(e,t,r){const n=r&&r.taskLabel||"MigrateCertificate",s=e.toAuthSignature,o=this.decode(s);if(!await t.detachedVeriy(kr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:e.fromAuthSignature,toAuthSignature:this.splitSignature(s)}),bn),he(o.signature),he(o.publicKey)))throw new br(c.INVALID_TOAUTHSIGNATURE,{taskLabel:n});if(o.secondPublicKey&&o.signSignature&&!await t.detachedVeriy(kr.from(JSON.stringify({body:e.body,signature:e.signature,fromAuthSignature:e.fromAuthSignature,toAuthSignature:this.splitSignSignature(s)}),bn),he(o.signSignature),he(o.secondPublicKey)))throw new br(c.INVALID_TOAUTHSIGNSIGNATURE,{taskLabel:n})}};xg=h([j()],xg);function uw(i="toAuthSignature"){const e=new xg;return new es([[`${i}/${e.version}`,e]])}function fw(i=1){return new es().mergeWithPrefix(`${i}/`,iw()).mergeWithPrefix(`${i}/`,ow()).mergeWithPrefix(`${i}/`,aw()).mergeWithPrefix(`${i}/`,cw()).mergeWithPrefix(`${i}/`,pw()).mergeWithPrefix(`${i}/`,lw()).mergeWithPrefix(`${i}/`,hw()).mergeWithPrefix(`${i}/`,uw())}const fr=fw();let ru=class{constructor(e){this.config=e,this.fieldConverter=fr,this._init(),this._check()}get fromChainId(){return this.__fromChainId}get toChainId(){return this.__toChainId}get fromId(){return this.__fromId}get toId(){return this.__toId}get assetId(){return this.__assetId}get signature(){return this.__signature}get fromAuthSignature(){return this.__fromAuthSignature}get toAuthSignature(){return this.__toAuthSignature}getUUID(e){return this.signature.decode(e.fromAuthSignature,!0).signature}_init(){if(!this.config){this.__fromChainId=fr.get("1/fromChainId/1"),this.__toChainId=fr.get("1/toChainId/1"),this.__fromId=fr.get("1/fromId/1"),this.__toId=fr.get("1/toId/1"),this.__assetId=fr.get("1/assetId/1"),this.__signature=fr.get("1/signature/1"),this.__fromAuthSignature=fr.get("1/fromAuthSignature/1"),this.__toAuthSignature=fr.get("1/toAuthSignature/1");return}const{fromChainIdVersion:e,toChainIdVersion:t,fromIdVersion:r,toIdVersion:n,assetIdVersion:s,signatureVersion:o,fromAuthSignatureVersion:a,toAuthSignatureVersion:p}=this.config;this.__fromChainId=fr.get(`1/fromChainId/${e}`),this.__toChainId=fr.get(`1/toChainId/${t}`),this.__fromId=fr.get(`1/fromId/${r}`),this.__toId=fr.get(`1/toId/${n}`),this.__assetId=fr.get(`1/assetId/${s}`),this.__signature=fr.get(`1/signature/${o}`),this.__fromAuthSignature=fr.get(`1/fromAuthSignature/${a||o}`),this.__toAuthSignature=fr.get(`1/toAuthSignature/${p||a||o}`)}_check(){if(this.config){if(!this.__fromChainId)throw new SyntaxError(`unknown fromChainId version ${this.config.fromChainIdVersion}`);if(!this.__toChainId)throw new SyntaxError(`unknown toChainId version ${this.config.toChainIdVersion}`);if(!this.__fromId)throw new SyntaxError(`unknown fromId version ${this.config.fromIdVersion}`);if(!this.__toId)throw new SyntaxError(`unknown toId version ${this.config.toIdVersion}`);if(!this.__assetId)throw new SyntaxError(`unknown assetId version ${this.config.assetIdVersion}`);if(!this.__signature)throw new SyntaxError(`unknown signature version ${this.config.signatureVersion}`);if(!this.__fromAuthSignature)throw new SyntaxError(`unknown fromAuthSignature version ${this.config.fromAuthSignatureVersion}`);if(!this.__toAuthSignature)throw new SyntaxError(`unknown toAuthSignature version ${this.config.toAuthSignatureVersion}`)}}};ru=h([j(),u("design:paramtypes",[Object])],ru);const{ArgumentIllegalException:q_}=re("HELPER","transactionHelper");function ni(i){return i.split("/",1)[0]}function vn(i){if(!i)return new ru;const{body:e,signature:t,fromAuthSignature:r,toAuthSignature:n}=i;if(!e)throw new q_(c.PROP_IS_REQUIRE,{prop:"json.body"});if(!t)throw new q_(c.PROP_IS_REQUIRE,{prop:"json.signature"});const{fromChainId:s,toChainId:o,fromId:a,toId:p,assetId:l}=e,f=ni(s),g=ni(o),d=ni(a),y=ni(p),m=ni(l),E=ni(t),T={fromChainIdVersion:f,toChainIdVersion:g,fromIdVersion:d,toIdVersion:y,assetIdVersion:m,signatureVersion:E};return r&&(T.fromAuthSignatureVersion=ni(r)),n&&(T.toAuthSignatureVersion=ni(n)),new ru(T)}let Og=class{constructor(){this.__version="0.0.1"}get version(){return this.__version}set version(e){this.__version=e}};Og=h([j()],Og);const{ArgumentIllegalException:sr}=re("HELPER","transactionHelper");let js=class{constructor(e,t,r,n,s,o,a){this.baseHelper=e,this.configHelper=t,this.chainTimeHelper=r,this.asymmetricHelper=n,this.accountBaseHelper=s,this.transactionHelper=o,this.config=a}__checkVersion(e){if(!e)throw new sr(c.PROP_IS_REQUIRE,{prop:"version",target:"migrateCertificate"});if(typeof e!="string")throw new sr(c.PROP_IS_INVALID,{prop:"version",target:"migrateCertificate"})}__checkTimestamp(e){if(!e)throw new sr(c.PROP_IS_REQUIRE,{prop:"timestamp",target:"migrateCertificate"});if(!this.baseHelper.isPositiveInteger(e))throw new sr(c.PROP_IS_INVALID,{prop:"timestamp",target:"migrateCertificate"})}__checkAssets(e){if(!e)throw new sr(c.PROP_IS_REQUIRE,{prop:"assets",target:"migrateCertificate"});if(!this.baseHelper.isValidAssetNumber(e))throw new sr(c.PROP_IS_INVALID,{prop:"assets",target:"migrateCertificate"});if(e==="0")throw new sr(c.PROP_SHOULD_GT_FIELD,{prop:"assets",fueld:"0",target:"migrateCertificate"})}getMigrateCertificateConverter(e){return vn(e)}formatMigrateCertificate(e){const{body:t,signature:r,fromAuthSignature:n,toAuthSignature:s}=e;return{body:{version:t.version,timestamp:t.timestamp,fromChainId:t.fromChainId,toChainId:t.toChainId,fromId:t.fromId,toId:t.toId,assetId:t.assetId,assetPrealnum:t.assetPrealnum},signature:r||"",fromAuthSignature:n||"",toAuthSignature:s||""}}combineMigrateCertificateBody(e,t=this.configHelper){const r=vn(),{senderId:n,recipientId:s,toChainInfo:o,assetInfo:a,assetPrealnum:p}=e;return{body:{version:t.version.toString(),timestamp:this.chainTimeHelper.now(!0),fromChainId:r.fromChainId.encode({magic:t.magic,chainName:t.chainName,genesisBlockSignature:t.signature},!0),toChainId:r.toChainId.encode(o),fromId:r.fromId.encode(n,!0),toId:r.toId.encode(s,!0),assetId:r.assetId.encode(a,!0),assetPrealnum:p},signature:r.signature.version}}combineMigrateCertificateSignature(e,t){const r=vn(e),{signature:n,fromAuthSignature:s,toAuthSignature:o}=t;return n&&(e.signature=r.signature.encode(n)),s&&(e.fromAuthSignature=r.fromAuthSignature.encode(s)),o&&(e.toAuthSignature=r.toAuthSignature.encode(o)),e}async generateMigrateCertificate(e,t=this.configHelper){const{senderSecret:r,senderSecondSecret:n,recipientId:s,toChainInfo:o,assetInfo:a,assetPrealnum:p}=e,l=vn();this.__checkAssets(p);const f=this.accountBaseHelper,g=await f.createSecretKeypair(r),d=await f.getAddressFromPublicKey(g.publicKey);let y={body:{version:this.config.version,timestamp:this.chainTimeHelper.now(!0),fromChainId:l.fromChainId.encode({magic:t.magic,chainName:t.chainName,genesisBlockSignature:t.signature},!0),toChainId:l.toChainId.encode(o),fromId:l.fromId.encode(d,!0),toId:l.toId.encode(s,!0),assetId:l.assetId.encode(a,!0),assetPrealnum:p},signature:"",fromAuthSignature:"",toAuthSignature:""};return r&&(y=await l.signature.generateSignature({secret:r,secondSecret:n,migrateCertificate:y},f,this.asymmetricHelper)),y}parseMigrateCertificateToJson(e){const{body:t,signature:r,fromAuthSignature:n,toAuthSignature:s}=e,o=vn(e);return{body:{version:t.version,senderId:o.fromId.decode(t.fromId),recipientId:o.toId.decode(t.toId),timestamp:t.timestamp,fromChain:o.fromChainId.decode(t.fromChainId),toChain:o.toChainId.decode(t.toChainId),asset:o.assetId.decode(t.assetId),assetPrealnum:t.assetPrealnum},signature:o.signature.decode(r),fromAuthSignature:n&&n.includes("/")?o.fromAuthSignature.decode(n):void 0,toAuthSignature:s&&s.includes("/")?o.toAuthSignature.decode(s):void 0}}async fromAuthSignMigrateCertificate(e){return vn(e.migrateCertificate).fromAuthSignature.generateSignature(e,this.accountBaseHelper,this.asymmetricHelper)}async toAuthSignMigrateCertificate(e){return vn(e.migrateCertificate).toAuthSignature.generateSignature(e,this.accountBaseHelper,this.asymmetricHelper)}async verifyMigrateCertificateSignature(e,t){return vn(e).signature.verifySignature(e,this.asymmetricHelper,t)}async verifyMigrateCertificateFromAuthSignature(e,t){return vn(e).fromAuthSignature.verifySignature(e,this.asymmetricHelper,t)}async verifyMigrateCertificateToAuthSignature(e,t){return vn(e).toAuthSignature.verifySignature(e,this.asymmetricHelper,t)}async __checkAuthAccount(e,t,r){const n=await this.accountBaseHelper.getAddressFromPublicKeyString(r.publicKey),s=t.genesisDelegates,o=await this.accountBaseHelper.getAddressFromPublicKeyString(t.generatorPublicKey);if(s.push(o),!s.includes(n))throw new sr(c.NOT_MATCH,{to_compare_prop:`${e} auth signature address ${n}`,be_compare_prop:"genesis delegate address",to_target:"migrateCertificate",be_target:"fromChain"})}async checkChainInfo(e,t,r,n){if(t.magic!==r.magic)throw new sr(c.SHOULD_BE,{to_compare_prop:`${e}.magic ${t.magic}`,to_target:"migrateCertificate",be_compare_prop:r.magic});if(t.chainName!==r.chainName)throw new sr(c.SHOULD_BE,{to_compare_prop:`${e}.chainName ${t.chainName}`,to_target:"migrateCertificate",be_compare_prop:r.chainName});if(t.genesisBlockSignature!==t.genesisBlockSignature)throw new sr(c.SHOULD_BE,{to_compare_prop:`${e}.genesisBlockSignature ${t.genesisBlockSignature}`,to_target:"migrateCertificate",be_compare_prop:t.genesisBlockSignature});n&&await this.__checkAuthAccount(e,r,n)}async verifyMigrateCertificate(e,t){const r={target:"migrateCertificate"},n=vn(e),{forceCheckFromChainInfo:s,fromChainBaseConfig:o,forceCheckFromAuthSignature:a,forceCheckToChainInfo:p,toChainBaseConfig:l,forceCheckToAuthSignature:f}=t,{body:g,signature:d,fromAuthSignature:y,toAuthSignature:m}=e;this.__checkVersion(g.version),this.__checkTimestamp(g.timestamp),n.fromChainId.checkDecodeArgs(g.fromChainId),n.toChainId.checkDecodeArgs(g.toChainId),n.fromId.checkDecodeArgs(g.fromId),n.toId.checkDecodeArgs(g.toId),n.assetId.checkDecodeArgs(g.assetId),this.__checkAssets(g.assetPrealnum),n.signature.checkDecodeArgs(d);const E=this.baseHelper,T=n.signature.decode(d,!0);if(!E.isValidAccountSignature(T))throw new sr(c.PROP_IS_INVALID,{prop:`signature ${d}`,...r});if(await n.signature.verifySignature(e,this.asymmetricHelper),s){if(!o)throw new sr(c.PROP_IS_REQUIRE,{prop:"fromChainBaseConfig",target:"options"});const w=n.fromChainId.decode(g.fromChainId);if(await this.checkChainInfo("fromChain",w,o),y&&y.includes(tt)){n.fromAuthSignature.checkDecodeArgs(y);const b=n.fromAuthSignature.decode(y,!0);if(!E.isValidAccountSignature(b))throw new sr(c.PROP_IS_INVALID,{prop:`fromAuthSignature ${y}`,...r});await this.__checkAuthAccount("fromChain",o,b)}}if(a){if(!y)throw new sr(c.PROP_IS_REQUIRE,{prop:"fromAuthSignature",...r});await this.verifyMigrateCertificateFromAuthSignature(e)}if(p){if(!l)throw new sr(c.PROP_IS_REQUIRE,{prop:"toChainBaseConfig",target:"options"});const w=n.toChainId.decode(g.toChainId);if(await this.checkChainInfo("toChain",w,l),m&&m.includes(tt)){n.toAuthSignature.checkDecodeArgs(m);const b=n.toAuthSignature.decode(m,!0);if(!E.isValidAccountSignature(b))throw new sr(c.PROP_IS_INVALID,{prop:`toAuthSignature ${m}`,...r});await this.__checkAuthAccount("toChain",l,b)}}if(f){if(!m)throw new sr(c.PROP_IS_REQUIRE,{prop:"toAuthSignature",...r});await this.verifyMigrateCertificateToAuthSignature(e)}return n}};js=h([j(),u("design:paramtypes",[Pe,te,Vt,$r,de,me,Og])],js);let Cg=class{constructor(){this.__version="0.0.1"}get version(){return this.__version}set version(e){this.__version=e}};Cg=h([j()],Cg);const dh="utf-8",{ArgumentIllegalException:Kr}=re("HELPER","RegisterChainCertificateHelper");let Bl=class{constructor(e,t,r,n,s){this.baseHelper=e,this.chainTimeHelper=t,this.asymmetricHelper=r,this.accountBaseHelper=n,this.config=s}__checkVersion(e){if(!e)throw new Kr(c.PROP_IS_REQUIRE,{prop:"version",target:"registerChainCertificate"});if(typeof e!="string")throw new Kr(c.PROP_IS_INVALID,{prop:"version",target:"registerChainCertificate"})}__checkTimestamp(e){if(!e)throw new Kr(c.PROP_IS_REQUIRE,{prop:"timestamp",target:"registerChainCertificate"});if(!this.baseHelper.isPositiveInteger(e))throw new Kr(c.PROP_IS_INVALID,{prop:"timestamp",target:"registerChainCertificate"})}__checkPublicKey(e){if(!e)throw new Kr(c.PROP_IS_REQUIRE,{prop:"publicKey",target:"registerChainCertificate"});if(!this.baseHelper.isValidPublicKey(e))throw new Kr(c.PROP_IS_INVALID,{prop:"publicKey",target:"registerChainCertificate"})}__checkSignature(e){if(!e)throw new Kr(c.PROP_IS_REQUIRE,{prop:"signature",target:"registerChainCertificate"});if(!this.baseHelper.isValidSignature(e))throw new Kr(c.PROP_IS_INVALID,{prop:"signature",target:"registerChainCertificate"})}async generateRegisterChainCertificate(e){const{generatorSecret:t,generatorSecondSecret:r,genesisBlockInfo:n,version:s,timestamp:o}=e,a=this.accountBaseHelper,p=await a.createSecretKeypair(t),l=Me(p.publicKey);let f;const g={body:{version:s||this.config.version,timestamp:o===void 0?this.chainTimeHelper.now(!0):o,genesisBlockInfo:{genesisAccount:{address:await a.getAddressFromPublicKey(p.publicKey),publicKey:l},...n}},publicKey:l};r&&(f=await a.createSecretKeypair(t),g.secondPublicKey=Me(f.publicKey));const d=await this.asymmetricHelper.detachedSign(Buffer.from(JSON.stringify(g),dh),p.secretKey),y={...g,signature:Me(d)};if(f){const m=await this.asymmetricHelper.detachedSign(Buffer.from(JSON.stringify(g),dh),f.secretKey);y.signSignature=Me(m)}return y}async verifyRegisterChainCertificateSignature(e,t){const r=t&&t.taskLabel||"RegisterChainCertificate",{body:n,publicKey:s,signature:o,secondPublicKey:a,signSignature:p}=e;if(!await this.asymmetricHelper.detachedVeriy(Buffer.from(JSON.stringify({body:n,publicKey:s}),dh),he(o),he(s)))throw new Kr(c.INVALID_SIGNATURE,{taskLabel:r});if(a&&p&&!await this.asymmetricHelper.detachedVeriy(Buffer.from(JSON.stringify({body:n,publicKey:s,secondPublicKey:a,signature:o}),dh),he(p),he(a)))throw new Kr(c.INVALID_SIGNSIGNATURE,{taskLabel:r})}async verifyRegisterChainCertificate(e){const{body:t,publicKey:r,signature:n,secondPublicKey:s,signSignature:o}=e;if(r!==t.genesisBlockInfo.genesisAccount.publicKey)throw new Kr(c.NOT_MATCH,{to_compare_prop:`publicKey ${r}`,be_compare_prop:`generatorPublicKey ${t.genesisBlockInfo.genesisAccount.publicKey}`,to_target:"registerChainCertificate",be_target:"registerChainCertificate.body.genesisBlockInfo"});if(t.genesisBlockInfo.delegates!==t.genesisBlockInfo.genesisDelegates.length)throw new Kr(c.NOT_MATCH,{to_compare_prop:`delegates ${t.genesisBlockInfo.delegates}`,be_compare_prop:`genesisDelegates length ${t.genesisBlockInfo.genesisDelegates.length}`,to_target:"registerChainCertificate.body.genesisBlockInfo",be_target:"registerChainCertificate.body.genesisBlockInfo"});if(this.__checkVersion(t.version),this.__checkTimestamp(t.timestamp),this.__checkPublicKey(r),this.__checkSignature(n),s&&o)this.__checkPublicKey(s),this.__checkSignature(o);else{if(s)throw new Kr(c.SHOULD_NOT_EXIST,{prop:`secondPublicKey ${s}`,target:"registerChainCertificate"});if(o)throw new Kr(c.SHOULD_NOT_EXIST,{prop:`signSignature ${o}`,target:"registerChainCertificate"})}return await this.verifyRegisterChainCertificateSignature(e),!0}encode(e){return JSON.stringify(e)}decode(e){return JSON.parse(e)}};Bl=h([j(),u("design:paramtypes",[Pe,Vt,$r,de,Cg])],Bl);let X_=class{constructor(e){this.accountBaseHelper=e}};X_=h([j(),u("design:paramtypes",[de])],X_);const{ArgumentIllegalException:Se}=re("CONTROLLER","_txbase");class Ke{async fromJSON(e,t){const r=this.init(e,e.asset);return t&&t.verify&&await this.verify(r,t.config),r}verifyKeypair(e){if(!e)throw new Se(c.PARAM_LOST,{param:"keypair"});const t={target:"keypair"};if(!e.publicKey)throw new Se(c.PROP_IS_REQUIRE,{prop:"publicKey",...t});if(!e.secretKey)throw new Se(c.PROP_IS_REQUIRE,{param:"secretKey",...t})}verifySecondKeypair(e){if(!e)throw new Se(c.PARAM_LOST,{param:"keypair"});const t={target:"keypair"};if(!e.publicKey)throw new Se(c.PROP_IS_REQUIRE,{prop:"publicKey",...t});if(!e.secretKey)throw new Se(c.PROP_IS_REQUIRE,{param:"secretKey",...t})}async verifyTransactionBody(e,t,r=this.configHelper){if(!e)throw new Se(c.PARAM_LOST,{param:"body"});if(!t)throw new Se(c.PARAM_LOST,{param:"asset"});const n={target:"body"},{baseHelper:s,accountBaseHelper:o}=this;if(!s.isPositiveInteger(e.version))throw new Se(c.PROP_IS_REQUIRE,{prop:"version",...n});if(!e.type)throw new Se(c.PROP_IS_REQUIRE,{prop:"type",...n});if(!s.isValidTransactionType(e.type))throw new Se(c.PROP_IS_INVALID,{prop:"type",type:"transaction type",...n});if(!e.senderId)throw new Se(c.PROP_IS_REQUIRE,{prop:"senderId",...n});if(!await o.isAddress(e.senderId))throw new Se(c.PROP_IS_INVALID,{prop:`senderId ${e.senderId}`,type:"account address",...n});if(!e.senderPublicKey)throw new Se(c.PROP_IS_REQUIRE,{prop:"senderPublicKey",...n});if(!s.isValidPublicKey(e.senderPublicKey))throw new Se(c.PROP_IS_INVALID,{prop:`senderPublicKey ${e.senderPublicKey}`,type:"account publicKey",...n});const a=await o.getAddressFromPublicKeyString(e.senderPublicKey);if(e.senderId!==a)throw new Se(c.NOT_MATCH,{to_compare_prop:`senderId ${e.senderId}`,be_compare_prop:`publicKey => address ${a}`,to_target:"senderPublicKey",be_target:"body",...n});if(e.senderSecondPublicKey&&!s.isValidPublicKey(e.senderSecondPublicKey))throw new Se(c.PROP_IS_INVALID,{prop:`senderSecondPublicKey ${e.senderSecondPublicKey}`,type:"account publicKey",...n});if(e.recipientId!==void 0&&!await o.isAddress(e.recipientId))throw new Se(c.PROP_IS_INVALID,{prop:`recipientId ${e.recipientId}`,type:"account address",...n});const{range:p}=e;if(p.length>0){const m=new Set(p);if(p.length!==m.size)throw new Se(c.SHOULD_NOT_DUPLICATE,{prop:"range",...n})}if(!await this.baseHelper.isValidRange(e.rangeType,p))throw new Se(c.PROP_IS_INVALID,{prop:`range ${e.rangeType}`,type:"transaction range",...n});if(!s.isNaturalNumber(e.timestamp))throw new Se(c.PROP_IS_INVALID,{prop:`timestamp ${e.timestamp}`,type:"natural number",...n});const l=e.applyBlockHeight;if(!s.isPositiveInteger(l))throw new Se(c.PROP_IS_INVALID,{prop:`applyBlockHeight ${l}`,type:"positive integer",...n});const f=e.effectiveBlockHeight;if(!s.isPositiveInteger(f))throw new Se(c.PROP_IS_INVALID,{prop:`effectiveBlockHeight ${f}`,type:"positive integer",...n});if(f<l)throw new Se(c.PROP_SHOULD_GTE_FIELD,{prop:`effectiveBlockHeight ${f}`,field:l,...n});const{maxApplyAndConfirmedBlockHeightDiff:g}=r,d=l+g;if(f>d)throw new Se(c.PROP_SHOULD_LTE_FIELD,{prop:`effectiveBlockHeight ${f}`,field:d,...n});if(this.checkTrsBaseFee(e.fee,n),!e.fromMagic)throw new Se(c.PROP_IS_REQUIRE,{prop:"fromMagic",...n});if(!s.isValidChainMagic(e.fromMagic))throw new Se(c.PROP_IS_INVALID,{prop:`fromMagic ${e.fromMagic}`,type:"chain magic",...n});if(!e.toMagic)throw new Se(c.PROP_IS_REQUIRE,{prop:"toMagic",...n});if(!s.isValidChainMagic(e.toMagic))throw new Se(c.PROP_IS_INVALID,{prop:`toMagic ${e.toMagic}`,type:"chain magic",...n});if(e.sourceIP!==void 0&&!s.isIp(e.sourceIP))throw new Se(c.PROP_IS_INVALID,{prop:`sourceIP ${e.sourceIP}`,type:"ip",...n});if(e.dappid!==void 0&&!s.isValidDAppId(e.dappid))throw new Se(c.PROP_IS_INVALID,{prop:`dappid ${e.dappid}`,type:"dappid",...n});if(e.lns!==void 0&&!s.isValidLocationName(e.lns,r.chainName))throw new Se(c.PROP_IS_INVALID,{prop:`lns ${e.lns}`,type:"location name",...n});const y=e.remark;if(!y)throw new Se(c.PROP_IS_REQUIRE,{prop:"remark",...n});if(s.getVariableType(y)!=="[object Object]")throw new Se(c.PROP_IS_INVALID,{prop:"remark",...n});for(const m in y)if(!s.isString(y[m]))throw new Se(c.PROP_IS_INVALID,{prop:"remark",...n})}async verifyBaseInfo(e,t=this.configHelper){if(!e)throw new Se(c.PARAM_LOST,{param:"transaction"});await this.verifyTransactionBody(e,e.asset,t);const r={target:"transaction"},{baseHelper:n}=this;if(!e.signature)throw new Se(c.PROP_IS_REQUIRE,{prop:"signature",...r});if(!n.isValidSignature(e.signature))throw new Se(c.PROP_IS_INVALID,{prop:`signature ${e.signature}`,type:"signature",...r});if(e.signSignature&&!n.isValidSignature(e.signSignature))throw new Se(c.PROP_IS_INVALID,{prop:`signSignature ${e.signSignature}`,type:"signature",...r})}async verifySignature(e){await this.transactionHelper.verifyTransactionSignature(e)}verifyTransactionSize(e){this.transactionHelper.verifyTransactionSize(e)}verifyTransactionBlobSize(e){this.transactionHelper.verifyTransactionBlobSize(e)}async verify(e,t=this.configHelper){await this.verifyBaseInfo(e,t),this.verifyTransactionSize(e),this.verifyTransactionBlobSize(e),await this.verifySignature(e)}checkAssetAmount(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});const{baseHelper:n}=this;if(!n.isValidAssetNumber(e))throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,type:"asset number",...r});const s=BigInt(0),o=BigInt(e);if(s>=o)throw new Se(c.PROP_SHOULD_GT_FIELD,{prop:`${t} ${e}`,field:"0",...r})}checkAssetPrealnum(e,t,r){this.checkBaseAssetPrealnum(r,t,e),this.isAssetPrealnumGtZero(e,t,r)}checkBaseAssetPrealnum(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});const{baseHelper:n}=this;if(!n.isValidAssetNumber(e))throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,type:"asset prealnum",...r});const s=BigInt(0),o=BigInt(e);if(s>o)throw new Se(c.PROP_SHOULD_GTE_FIELD,{prop:`${t} ${e}`,field:"0",...r})}isAssetPrealnumGtZero(e,t,r){if(e==="0")throw new Se(c.PROP_SHOULD_GT_FIELD,{prop:`${t} ${e}`,field:"0",...r})}checkTrsBaseFee(e,t){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:"fee",...t});const{baseHelper:r}=this;if(!r.isValidAssetNumber(e))throw new Se(c.PROP_IS_INVALID,{prop:`fee ${e}`,type:"asset number",...t});const n=BigInt(e);if(BigInt("0")>n)throw new Se(c.PROP_SHOULD_GTE_FIELD,{prop:`fee ${e}`,field:"0",...t})}emptyRangeType(e,t){if(e.rangeType!==0)throw new Se(c.SHOULD_BE,{to_compare_prop:`rangeType ${e.rangeType}`,to_target:"body",be_compare_prop:"RANGE_TYPE.EMPTY",...t})}checkChainName(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidChainName(e))throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,type:"chain name",...r})}checkChainMagic(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidChainMagic(e))throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,type:"chain magic",...r})}checkParentAssetType(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});if(!L[e])throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkAsset(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidAssetType(e))throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkDAppid(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidDAppId(e))throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkLocationName(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidLocationName(e))throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkEntityFactoryId(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidEntityFactoryId(e))throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkEntityId(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidEntityId(e))throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkCertificateId(e,t,r){if(!e)throw new Se(c.PROP_IS_REQUIRE,{prop:t,...r});if(!this.baseHelper.isValidCertificateId(e))throw new Se(c.PROP_IS_INVALID,{prop:`${t} ${e}`,...r})}checkAssetType(e,t,r,n){if(e===L.ASSETS){this.checkAsset(t,r,n);return}if(e===L.DAPP){this.checkDAppid(t,r,n);return}if(e===L.LOCATION_NAME){this.checkLocationName(t,r,n);return}if(e===L.ENTITY){this.checkEntityId(t,r,n);return}if(e===L.CERTIFICATE){this.checkCertificateId(t,r,n);return}throw new Se(c.PROP_IS_INVALID,{prop:`parentAssetType ${e}`,...n})}async checkTaxInformation(e,t){if(!t)throw new Se(c.PROP_IS_REQUIRE,{prop:"taxInformation",...e});const{taxCollector:r,taxAssetPrealnum:n}=t;if(!r)throw new Se(c.PROP_IS_REQUIRE,{prop:"taxInformation.taxCollector",...e});if(!await this.accountBaseHelper.isAddress(r))throw new Se(c.PROP_IS_INVALID,{prop:`taxInformation.taxCollector ${r}`,...e});if(!n)throw new Se(c.PROP_IS_REQUIRE,{prop:"taxInformation.taxAssetPrealnum",...e});if(!this.baseHelper.isValidAssetPrealnum(n))throw new Se(c.PROP_IS_INVALID,{prop:`taxInformation.taxAssetPrealnum ${n}`,...e})}async applyTransaction(e,t,r=this.configHelper){const n=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);await t.emit("fee",{type:"fee",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:n,amount:"-"+e.fee,sourceAmount:e.fee}})}beginDealTransaction(e,t){return t.emit("beginDealTransaction",{type:"beginDealTransaction",transaction:e,applyInfo:void 0})}endDealTransaction(e,t){return t.emit("endDealTransaction",{transactionInBlock:e})}_applyTransactionEmitAsset(e,t,r,n){return Ve(s=>{s.next=e.emit("asset",{type:"asset",transaction:t,applyInfo:{address:n.senderId,publicKeyBuffer:n.senderPublicKeyBuffer,assetInfo:n.assetInfo,amount:"-"+r,sourceAmount:r}}),n.recipientId&&(s.next=e.emit("asset",{type:"asset",transaction:t,applyInfo:{address:n.recipientId,publicKeyBuffer:n.recipientPublicKeyBuffer,assetInfo:n.assetInfo,amount:r,sourceAmount:r}}))})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}}const{ArgumentIllegalException:Gr}=re("CONTROLLER","UsernameTransactionFactory");let nu=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s,accountBaseHelper:o}=this;if(e.recipientId)throw new Gr(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Gr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Gr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Gr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="alias")throw new Gr(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"alias",...n});const p=t.username;if(!p)throw new Gr(c.PARAM_LOST,{param:"username"});const l={...n,target:"usernameAsset"},f=p.alias;if(!f)throw new Gr(c.PROP_IS_REQUIRE,{prop:"alias",...l});if(!s.isString(f))throw new Gr(c.PROP_IS_INVALID,{prop:`username ${f}`,type:"string",...l});const g=/^[A-Za-z0-9_]{1,20}$/;if(e.applyBlockHeight===1){if(!g.test(f))throw new Gr(c.PROP_IS_INVALID,{prop:`alias ${f}`,type:"genesis username",...l})}else{if(!g.test(f))throw new Gr(c.PROP_IS_INVALID,{prop:`alias ${f}`,type:"username",...l});if(f.toLowerCase().includes(this.configHelper.chainName))throw new Gr(c.SHOULD_NOT_INCLUDE,{prop:`alias ${f}`,value:"chain name",...l})}if(a.value!==f)throw new Gr(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`alias ${f}`,to_target:"storage",be_target:"username",...n});if(await o.isAddress(f))throw new Gr(c.SHOULD_NOT_BE,{to_compare_prop:`username ${f}`,to_target:"usernameAsset",be_compare_prop:"address",...l});if(f.length===0||f.length>20)throw new Gr(c.NOT_IN_EXPECTED_RANGE,{prop:`alias ${f}`,min:1,max:20,...l})}init(e,t){return wp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r),n.next=t.emit("setUsername",{type:"setUsername",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,alias:e.asset.username.alias}})})}};nu=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],nu);const{ArgumentIllegalException:$i}=re("CONTROLLER","SignatureTransactionFactory");let su=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(e.recipientId)throw new $i(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new $i(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new $i(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new $i(c.SHOULD_NOT_EXIST,{prop:"storage",...n});const o=t.signature;if(!o)throw new $i(c.PARAM_LOST,{param:"signature"});const a={...n,target:"signatureAsset"},p=o.publicKey;if(!p)throw new $i(c.PROP_IS_REQUIRE,{prop:"publicKey",...a});if(!s.isValidSecondPublicKey(p))throw new $i(c.PROP_IS_INVALID,{prop:`publicKey ${p}`,type:"account second publicKey",...a})}init(e,t){return bp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r),n.next=t.emit("setSecondPublicKey",{type:"setSecondPublicKey",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,secondPublicKeyBuffer:e.asset.signature.publicKeyBuffer}})})}};su=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],su);const{ArgumentIllegalException:yh}=re("CONTROLLER","DelegateTransactionFactory");let Rg=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new yh(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new yh(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new yh(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new yh(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}init(e,t){return Np.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r),n.next=t.emit("registerToDelegate",{type:"registerToDelegate",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer}})})}};Rg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Rg);const{ArgumentIllegalException:ko}=re("CONTROLLER","VoteTransactionFactory");let Pg=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new ko(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ko(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ko(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new ko(c.SHOULD_NOT_EXIST,{prop:"storage",...n});const o=t.vote;if(!o)throw new ko(c.PARAM_LOST,{param:"voteAsset"});const a={...n,target:"voteAsset"};if(!s.isValidAccountEquity(o.equity))throw new ko(c.PROP_IS_INVALID,{prop:`equity ${o.equity}`,type:"account equity",...a})}init(e,t){return xp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){const n=e.asset.vote.equity;return Ve(s=>{s.next=super.applyTransaction(e,t,r),s.next=t.emit("voteEquity",{type:"voteEquity",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,equity:"-"+n,sourceEquity:n,recipientId:e.recipientId}})})}};Pg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Pg);const{ArgumentIllegalException:mh}=re("CONTROLLER","AcceptVoteTransactionFactory");let Bg=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new mh(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new mh(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new mh(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new mh(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}init(e,t){return Op.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r),n.next=t.emit("acceptVote",{type:"acceptVote",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer}})})}};Bg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Bg);const{ArgumentIllegalException:_h}=re("CONTROLLER","RejectVoteTransactionFactory");let Mg=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new _h(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new _h(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new _h(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new _h(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}init(e,t){return Cp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r),n.next=t.emit("rejectVote",{type:"rejectVote",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer}})})}};Mg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Mg);const{ArgumentIllegalException:gr}=re("CONTROLLER","DAppTransactionFactory");let Ml=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new gr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new gr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new gr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new gr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="dappid")throw new gr(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"dappid",...n});const o=t.dapp;if(this.verifyDAppAsset(o,r),s.value!==o.dappid)throw new gr(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`dappid ${o.dappid}`,to_target:"storage",be_target:"dapp",...n})}verifyDAppAsset(e,t=this.configHelper){const{baseHelper:r}=this,n={target:"body"};if(!e)throw new gr(c.PARAM_LOST,{param:"dapp",...n});const s={...n,target:"dappAsset"},{dappid:o,sourceChainMagic:a,sourceChainName:p,type:l,purchaseAsset:f}=e;if(!o)throw new gr(c.PROP_IS_REQUIRE,{prop:"dappid",...s});if(!r.isString(o))throw new gr(c.PROP_IS_INVALID,{prop:`dappid ${o}`,type:"string",...s});if(o.length!==8)throw new gr(c.PROP_LENGTH_SHOULD_EQ_FIELD,{prop:`dappid ${o}`,fileds:8,...s});if(!r.isUpperCaseLetterOrNumber(o))throw new gr(c.PROP_IS_INVALID,{prop:`dappid ${o}`,type:"uppercase or number",...s});if(this.checkChainName(p,"sourceChainName",s),p!==t.chainName)throw new gr(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${p}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(a,"sourceChainMagic",s),a!==t.magic)throw new gr(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${a}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(l!==1&&l!==0)throw new gr(c.NOT_MATCH,{to_compare_prop:`type ${l}`,be_compare_prop:"dappType",to_target:"dapp",be_target:"DAPP_TYPE",...s});if(l===0){if(!f)throw new gr(c.PROP_IS_REQUIRE,{prop:"purchaseAsset",...s});if(!r.isValidAssetNumber(f))throw new gr(c.PROP_IS_INVALID,{prop:"purchaseAsset",type:"asset number",...s});this.checkAssetAmount(f,"purchaseAsset",s)}else if(l===1&&f)throw new gr(c.SHOULD_NOT_EXIST,{prop:"purchaseAsset",...s})}init(e,t){return Rp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{sourceChainName:s,sourceChainMagic:o,dappid:a,type:p,purchaseAsset:l}=e.asset.dapp;n.next=t.emit("issueDApp",{type:"issueDApp",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:s,sourceChainMagic:o,dappid:a,possessorAddress:e.recipientId,type:p,purchaseAsset:l,status:0}})})}};Ml=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Ml);const{ArgumentIllegalException:si}=re("CONTROLLER","DAppPurchasingTransactionFactory");let vg=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.dappTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new si(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new si(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new si(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new si(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="dappid")throw new si(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"dappid",...n});const a=t.dappPurchasing;if(!a)throw new si(c.PARAM_LOST,{param:"dappPurchasing"});const p={...n,target:"dappPurchasingAsset"},{dappAsset:l}=a;if(this.dappTransactionFactory.verifyDAppAsset(l),o.value!==l.dappid)throw new si(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`dappid ${l.dappid}`,to_target:"storage",be_target:"dapp",...p});if(l.type!==0)throw new si(c.SHOULD_NOT_BE,{to_compare_prop:`type ${l.type}`,to_target:"dappAsset",be_compare_prop:0,...p})}init(e,t){return Pp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{magic:s,assetType:o}=r,{purchaseAsset:a}=e.asset.dappPurchasing.dappAsset,p=this.chainAssetInfoHelper.getAssetInfo(s,o);n.next=this._applyTransactionEmitAsset(t,e,a,{senderId:e.senderId,senderPublicKeyBuffer:e.senderPublicKeyBuffer,recipientId:e.recipientId,assetInfo:p})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,purchaseAsset:n}=e.asset.dappPurchasing.dappAsset;return t.magic===r&&t.assetType===this.configHelper.assetType&&n||"0"}};vg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,Ml])],vg);const{ArgumentIllegalException:Lr}=re("CONTROLLER","MarkTransactionFactory");let Lg=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.dappTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Lr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Lr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Lr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.dappid)throw new Lr(c.PROP_IS_REQUIRE,{prop:"dappid",...n});if(!e.storage)throw new Lr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="dappid")throw new Lr(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"dappid",...n});const p=t.mark;if(!p)throw new Lr(c.PARAM_LOST,{param:"mark"});const l={...n,target:"markAsset"},f=p.dapp;if(this.dappTransactionFactory.verifyDAppAsset(f),e.dappid!==f.dappid)throw new Lr(c.NOT_MATCH,{to_compare_prop:`dappid ${a.value}`,be_compare_prop:`dappid ${f.dappid}`,to_target:"body",be_target:"mark",...n});if(a.value!==f.dappid)throw new Lr(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`dappid ${f.dappid}`,to_target:"storage",be_target:"mark",...n});const g=p.content;if(!g)throw new Lr(c.PROP_IS_REQUIRE,{prop:"content",...l});if(!s.isString(g))throw new Lr(c.PROP_IS_INVALID,{prop:`content ${g}`,type:"string",...l});if(g.length>1024)throw new Lr(c.OVER_LENGTH,{prop:`content ${g}`,limit:1024,...l});const d=p.action;if(!d)throw new Lr(c.PROP_IS_REQUIRE,{prop:"action",...l});if(!s.isString(d))throw new Lr(c.PROP_IS_INVALID,{prop:`action ${d}`,type:"string",...l});const y=d.length;if(y<1||y>10)throw new Lr(c.NOT_IN_EXPECTED_RANGE,{prop:`action ${d}`,min:1,max:10,...l})}init(e,t){return Bp.fromObject({...e,asset:t})}};Lg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,Ml])],Lg);const{ArgumentIllegalException:Nr}=re("CONTROLLER","IssueAssetTransactionFactory");let Dg=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this,o=e.recipientId;if(!e.recipientId)throw new Nr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.senderId===o)throw new Nr(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${o}`,...n});if(e.fromMagic!==r.magic)throw new Nr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Nr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Nr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="assetType")throw new Nr(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const p=t.issueAsset;if(!p)throw new Nr(c.PARAM_LOST,{param:"issueAsset"});const l={...n,target:"issueAssetAsset"},{sourceChainName:f,sourceChainMagic:g,assetType:d,expectedIssuedAssets:y}=p;if(this.checkChainName(f,"sourceChainName",l),f!==r.chainName)throw new Nr(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${f}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(g,"sourceChainMagic",l),g!==r.magic)throw new Nr(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${f}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!d)throw new Nr(c.PROP_IS_REQUIRE,{prop:"assetType",...l});if(!s.isUpperCaseLetter(d))throw new Nr(c.PROP_IS_INVALID,{prop:`assetType ${d}`,type:"uppercase",...l});const m=d.length;if(m<3||m>10)throw new Nr(c.NOT_IN_EXPECTED_RANGE,{prop:`assetType ${d}`,type:"string length",min:3,max:10,...l});if(a.value!==d)throw new Nr(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`assetType ${d}`,to_target:"storage",be_target:"issueAsset",...n});if(!y)throw new Nr(c.PROP_IS_REQUIRE,{prop:"expectedIssuedAssets",...l});if(!s.isValidAssetNumber(y))throw new Nr(c.PROP_IS_INVALID,{prop:`expectedIssuedAssets ${y}`,type:"asset number",...l});if(BigInt(y)<=BigInt(0))throw new Nr(c.PROP_SHOULD_GT_FIELD,{prop:"expectedIssuedAssets",field:"0",...l})}init(e,t){return Mp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:o,senderPublicKeyBuffer:a}=e,{sourceChainName:p,sourceChainMagic:l,assetType:f,expectedIssuedAssets:g}=e.asset.issueAsset;n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,accountStatus:16}});const d=this.chainAssetInfoHelper.getAssetInfo(l,f);n.next=t.emit("issueAsset",{type:"issueAsset",transaction:e,applyInfo:{address:s,genesisAddress:o,publicKeyBuffer:a,sourceChainName:p,assetInfo:d,amount:g,sourceAmount:g}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,expectedIssuedAssets:s}=e.asset.issueAsset;return t.magic===r&&t.assetType===n?s:"0"}};Dg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Dg);const{ArgumentIllegalException:Ho}=re("CONTROLLER","TransferTransactionFactory");let iu=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async commonVerifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const s=e.recipientId;if(!s)throw new Ho(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.senderId===s)throw new Ho(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${s}`,...n});if(e.fromMagic!==r.magic)throw new Ho(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Ho(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Ho(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="assetType")throw new Ho(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"assetType",...n});return o}};iu=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],iu);const{ArgumentIllegalException:Z_}=re("CONTROLLER","TransferAssetTransactionFactory");let ou=class extends iu{async verifyTransactionBody(e,t,r=this.configHelper){const n={target:"transferAssetAsset"},s=await super.commonVerifyTransactionBody(e,t,r),o=t.transferAsset;if(!o)throw new Z_(c.PARAM_LOST,{param:"transferAsset"});const{sourceChainMagic:a,sourceChainName:p,assetType:l,amount:f}=o;if(a===this.configHelper.magic&&(this.checkChainName(p,"sourceChainName",n),this.checkChainMagic(a,"sourceChainMagic",n),this.checkAsset(l,"assetType",n)),s.value!==l)throw new Z_(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`assetType ${l}`,to_target:"storage",be_target:"transferAsset"});this.checkAssetAmount(f,"amount",n)}init(e,t){return vp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{amount:s,assetType:o,sourceChainMagic:a}=e.asset.transferAsset,p=this.chainAssetInfoHelper.getAssetInfo(a,o);n.next=this._applyTransactionEmitAsset(t,e,s,{senderId:e.senderId,senderPublicKeyBuffer:e.senderPublicKeyBuffer,recipientId:e.recipientId,assetInfo:p})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.transferAsset;return t.magic===r&&t.assetType===n?s:"0"}};ou=h([j()],ou);const{ArgumentIllegalException:Fo}=re("CONTROLLER","TransferAnyTransactionFactory");let au=class extends iu{async verifyTransactionBody(e,t,r=this.configHelper){const n=await super.commonVerifyTransactionBody(e,t,r),s={target:"transferAnyAsset"};if(n.key!=="assetType")throw new Fo(c.SHOULD_BE,{to_compare_prop:`storage.key ${n.key}`,to_target:"storage",be_compare_prop:"assetType",...s});const o=t.transferAny;if(!o)throw new Fo(c.PARAM_LOST,{param:"transferAny"});const{sourceChainMagic:a,sourceChainName:p,parentAssetType:l,assetType:f,taxInformation:g}=o;if(a===this.configHelper.magic&&(this.checkChainName(p,"sourceChainName",s),this.checkChainMagic(a,"sourceChainMagic",s),this.checkAssetType(l,f,"assetType",s)),n.value!==f)throw new Fo(c.NOT_MATCH,{to_compare_prop:`storage.value ${n.value}`,be_compare_prop:`assetType ${f}`,to_target:"storage",be_target:"transferAny",...s});if(this.checkAssetAmount(o.amount,"amount",s),l!==L.ASSETS&&o.amount!=="1")throw new Fo(c.SHOULD_BE,{to_compare_prop:`amount ${o.amount}`,to_target:"transferAny",be_compare_prop:"1"});if(l===L.ENTITY)await this.checkTaxInformation(s,g);else if(g)throw new Fo(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...s})}init(e,t){return Xp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:o,recipientId:a,asset:p}=e,{amount:l,assetType:f,sourceChainMagic:g,sourceChainName:d,parentAssetType:y,taxInformation:m}=p.transferAny;if(y===L.ASSETS){const E=this.chainAssetInfoHelper.getAssetInfo(g,f);n.next=this._applyTransactionEmitAsset(t,e,l,{senderId:s,senderPublicKeyBuffer:o,recipientId:a,assetInfo:E})}else if(y===L.DAPP)n.next=t.emit("changeDAppPossessor",{type:"changeDAppPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:a,sourceChainName:d,sourceChainMagic:g,dappid:f}});else if(y===L.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:a,sourceChainName:d,sourceChainMagic:g,name:f}});else if(y===L.ENTITY&&m){n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:a,sourceChainName:d,sourceChainMagic:g,entityId:f}}),n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:d,sourceChainMagic:g,parentAssetType:y,assetType:f,taxInformation:m.toJSON()}});const E=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,m.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:o,recipientId:m.taxCollector,assetInfo:E})}else if(y===L.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,possessorAddress:a,sourceChainName:d,sourceChainMagic:g,certificateId:f}});else throw new Fo(c.PROP_IS_INVALID,{prop:`parentAssetType ${y}`,target:"transaction.asset.transferAsset"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.transferAny;return t.magic===r&&t.assetType===n?s:"0"}};au=h([j()],au);const{ArgumentIllegalException:Ln}=re("CONTROLLER","DestroyAssetTransactionFactory");let cu=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const s=e.recipientId;if(!s)throw new Ln(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.senderId===s)throw new Ln(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${s}`,...n});if(e.fromMagic!==r.magic)throw new Ln(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Ln(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Ln(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="assetType")throw new Ln(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const a=t.destroyAsset;if(!a)throw new Ln(c.PARAM_LOST,{param:"destroyAsset"});const p={...n,target:"destroyAssetAsset"},{sourceChainMagic:l,sourceChainName:f,assetType:g}=a;if(f!==r.chainName)throw new Ln(c.SHOULD_BE,{to_compare_prop:"sourceChainName",to_target:"body",be_compare_prop:"local chain name",...p});if(l!==r.magic)throw new Ln(c.SHOULD_BE,{to_compare_prop:"sourceChainMagic",to_target:"body",be_compare_prop:"local chain magic",...p});if(this.checkAsset(g,"assetType",p),g===r.assetType)throw new Ln(c.SHOULD_NOT_BE,{to_compare_prop:"assetType",to_target:"destroyAsset",be_compare_prop:r.assetType,...p});if(o.value!==g)throw new Ln(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`assetType ${g}`,to_target:"storage",be_target:"destroyAsset",...n});this.checkAssetAmount(a.amount,"amount",p)}init(e,t){return Lp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:o,recipientId:a}=e,{amount:p,assetType:l,sourceChainMagic:f}=e.asset.destroyAsset,g=this.chainAssetInfoHelper.getAssetInfo(f,l);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:g,amount:`-${p}`,sourceAmount:p}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:a,publicKeyBuffer:o,assetInfo:g,amount:p,sourceAmount:p}}),n.next=t.emit("destroyAsset",{type:"destroyAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:e.senderPublicKeyBuffer,assetsApplyAddress:a,assetInfo:g,amount:p,sourceAmount:p}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.destroyAsset;return t.magic===r&&t.assetType===n?s:"0"}};cu=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],cu);const{ArgumentIllegalException:Wr}=re("CONTROLLER","ToExchangeAssetTransactionFactory");let pu=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new Wr(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Wr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Wr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});const s=t.toExchangeAsset;if(this.verifyToExchangeAsset(s,r),s.toExchangeNumber==="0")throw new Wr(c.PROP_SHOULD_GT_FIELD,{prop:"toExchangeNumber",field:"0",target:"toExchangeAsset"});if(e.storage)throw new Wr(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}verifyToExchangeAsset(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new Wr(c.PARAM_LOST,{param:"toExchangeAsset"});const n={target:"toExchangeAssetAsset"},s=e.cipherPublicKeys,o=new Set(s);if(s.length!==o.size)throw new Wr(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(s))throw new Wr(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",type:"cipher publicKeys",...n});if(e.toExchangeSource===this.configHelper.magic&&(this.checkChainName(e.toExchangeChainName,"toExchangeChainName",n),this.checkChainMagic(e.toExchangeSource,"toExchangeSource",n),this.checkAsset(e.toExchangeAsset,"toExchangeAsset",n)),e.beExchangeSource===this.configHelper.magic&&(this.checkChainName(e.beExchangeChainName,"beExchangeChainName",n),this.checkChainMagic(e.beExchangeSource,"beExchangeSource",n),this.checkAsset(e.beExchangeAsset,"beExchangeAsset",n)),!e.toExchangeNumber)throw new Wr(c.PROP_IS_REQUIRE,{prop:"toExchangeNumber",...n});if(!r.isValidAssetNumber(e.toExchangeNumber))throw new Wr(c.PROP_IS_INVALID,{prop:"toExchangeNumber",type:"asset number",...n});if(e.toExchangeNumber==="0")throw new Wr(c.PROP_SHOULD_GT_FIELD,{prop:"toExchangeNumber",field:"0",...n});if(!r.isValidRate(e.exchangeRate))throw new Wr(c.PROP_IS_INVALID,{prop:`exchangeRate ${JSON.stringify(e.exchangeRate)}`,type:"rate",...n});if(e.toExchangeAsset===e.beExchangeAsset)throw new Wr(c.SHOULD_NOT_BE,{to_compare_prop:`toExchangeAsset ${e.toExchangeAsset}`,to_target:"toExchangeAsset",be_compare_prop:e.beExchangeAsset})}init(e,t){return Dp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{toExchangeSource:s,toExchangeAsset:o,toExchangeNumber:a}=e.asset.toExchangeAsset,p=this.chainAssetInfoHelper.getAssetInfo(s,o);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:p,amount:`-${a}`,sourceAmount:a,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:e.signature}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeSource:s,toExchangeAsset:o,toExchangeNumber:a}=e.asset.toExchangeAsset;return r===s&&n===o?a:"0"}};pu=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],pu);const{ArgumentIllegalException:Jt}=re("CONTROLLER","BeExchangeAssetTransactionFactory");let kg=class extends Ke{constructor(e,t,r,n,s,o,a){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=o,this.toExchangeAssetTransactionFactory=a}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s,jsbiHelper:o}=this;if(!e.recipientId)throw new Jt(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Jt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Jt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Jt(c.PROP_IS_REQUIRE,{prop:"storage",...n});const p=e.storage;if(p.key!=="transactionSignature")throw new Jt(c.SHOULD_BE,{to_compare_prop:`storage.key ${p.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const l=t.beExchangeAsset;if(!l)throw new Jt(c.PARAM_LOST,{param:"beExchangeAsset"});const f={...n,target:"beExchangeAsset"},{transactionSignature:g}=l;if(!g)throw new Jt(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...f});if(!s.isValidSignature(g))throw new Jt(c.PROP_IS_INVALID,{prop:`transactionSignature ${g}`,type:"transaction signature",...f});if(p.value!==g)throw new Jt(c.NOT_MATCH,{to_compare_prop:`storage.value ${p.value}`,be_compare_prop:`transactionSignature ${g}`,to_target:"storage",be_target:"beExchangeAsset",...n});const{toExchangeNumber:d,beExchangeNumber:y}=l;if(!d)throw new Jt(c.PROP_IS_REQUIRE,{prop:"toExchangeNumber",...f});if(!s.isValidAssetNumber(d))throw new Jt(c.PROP_IS_INVALID,{prop:"toExchangeNumber",type:"asset number",...f});if(!y)throw new Jt(c.PROP_IS_REQUIRE,{prop:"beExchangeNumber",...f});if(!s.isValidAssetNumber(y))throw new Jt(c.PROP_IS_INVALID,{prop:"beExchangeNumber",type:"asset number",...f});const{exchangeAsset:m,ciphertextSignature:E}=l;if(this.toExchangeAssetTransactionFactory.verifyToExchangeAsset(m),BigInt(d)>BigInt(m.toExchangeNumber))throw new Jt(c.PROP_SHOULD_LTE_FIELD,{prop:`toExchangeNumber ${d}`,field:m.toExchangeNumber,...f});if(!s.isValidRate(m.exchangeRate))throw new Jt(c.PROP_IS_INVALID,{prop:`exchangeRate ${m.exchangeRate}`,type:"rate",...f});const{cipherPublicKeys:T}=m;if(T.length>0){if(!E)throw new Jt(c.NOT_EXIST,{prop:`ciphertextSignature ${E}`,...f});if(!s.isValidAccountSignature(E))throw new Jt(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${E}`,...f});const{signature:w,publicKey:b}=E;if(!T.includes(b))throw new Jt(c.NOT_MATCH,{to_compare_prop:`publicKey ${b}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...f});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:he(b),ciphertextSignatureBuffer:he(w),transactionSignatureBuffer:he(g),senderId:e.senderId}))throw new Jt(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${w}`,type:"signature",...f})}else if(E)throw new Jt(c.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${E}`,...f})}init(e,t){return kp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{exchangeAsset:s,toExchangeNumber:o,beExchangeNumber:a}=e.asset.beExchangeAsset,{toExchangeSource:p,toExchangeAsset:l,beExchangeSource:f,beExchangeAsset:g}=s,d=this.chainAssetInfoHelper.getAssetInfo(f,g);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:d,amount:`-${a}`,sourceAmount:a}});const y=e.recipientId;n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:y,assetInfo:d,amount:a,sourceAmount:a}});const m=this.chainAssetInfoHelper.getAssetInfo(p,l);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:m,amount:o,sourceAmount:o,frozenId:e.asset.beExchangeAsset.transactionSignature,recipientId:y}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{exchangeAsset:s,toExchangeNumber:o,beExchangeNumber:a}=e.asset.beExchangeAsset,{toExchangeSource:p,beExchangeSource:l,toExchangeAsset:f,beExchangeAsset:g}=s;return r===p&&n===f?o:r===l&&n===g?a:"0"}};kg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,It,pu])],kg);const{ArgumentIllegalException:Vo}=re("CONTROLLER","GiftTransactionFactory");let lu=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=o}async commonVerifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new Vo(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Vo(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Vo(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Vo(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="assetType")throw new Vo(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"assetType",...n});return s}checkTransactionFee(e,t,r=this.configHelper){const{maxTransactionSize:n,minTransactionFeePerByte:s}=r,o=n*(t+1),a={numerator:BigInt(e),denominator:o};if(this.jsbiHelper.compareFraction(a,s)<0){const l=this.jsbiHelper.multiplyCeilFraction(a.denominator,s).toString();throw new Vo(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:be.TRANSACTION_FEE_NOT_ENOUGH,minFee:l.toString(),target:"body"})}}};lu=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,It])],lu);const{ArgumentIllegalException:ss}=re("CONTROLLER","GiftAssetTransactionFactory");let hu=class extends lu{async verifyTransactionBody(e,t,r=this.configHelper){const n=await this.commonVerifyTransactionBody(e,t,r),s=t.giftAsset;if(this.verifyGiftAsset(s,r),s.giftDistributionRule===2&&e.rangeType!==1)throw new ss(c.SHOULD_BE,{to_compare_prop:`rangeType ${e.rangeType}`,to_target:"body",be_compare_prop:1});if(s.beginUnfrozenBlockHeight&&s.beginUnfrozenBlockHeight>=e.effectiveBlockHeight)throw new ss(c.PROP_SHOULD_LT_FIELD,{prop:`beginUnfrozenBlockHeight ${s.beginUnfrozenBlockHeight}`,field:e.effectiveBlockHeight,target:"giftAsset"});if(n.value!==s.assetType)throw new ss(c.NOT_MATCH,{to_compare_prop:`storage.value ${n.value}`,be_compare_prop:`assetType ${s.assetType}`,to_target:"storage",be_target:"giftAsset"});this.checkTransactionFee(e.fee,s.totalGrabableTimes,r)}verifyGiftAsset(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new ss(c.PARAM_LOST,{param:"giftAsset"});const n={target:"giftAssetAsset"},s=e.cipherPublicKeys,o=new Set(s);if(s.length!==o.size)throw new ss(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(e.cipherPublicKeys))throw new ss(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",type:"cipher publicKeys",...n});const{sourceChainMagic:a,sourceChainName:p,assetType:l,amount:f,giftDistributionRule:g,totalGrabableTimes:d,beginUnfrozenBlockHeight:y}=e;if(a===this.configHelper.magic&&(this.checkChainName(p,"sourceChainName",n),this.checkChainMagic(a,"sourceChainMagic",n),this.checkAsset(l,"assetType",n)),!r.isPositiveInteger(d))throw new ss(c.PROP_IS_INVALID,{prop:`totalGrabableTimes ${d}`,type:"positive integer",...n});if(d>t.maxGrabTimesOfGiftAsset)throw new ss(c.PROP_SHOULD_LTE_FIELD,{prop:`totalGrabableTimes ${d}`,field:t.maxGrabTimesOfGiftAsset,...n});if(y!==void 0&&!r.isPositiveInteger(y))throw new ss(c.PROP_IS_INVALID,{prop:`beginUnfrozenBlockHeight ${y}`,type:"positive integer",...n});if(g!==1&&g!==0&&g!==2)throw new ss(c.PROP_IS_INVALID,{prop:`giftDistributionRule ${g}`,type:"enum of GIFT_DISTRIBUTION_RULE",...n});this.checkAssetAmount(f,"amount",n)}init(e,t){return oa.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{chainAssetInfoHelper:s}=this,{amount:o,assetType:a,sourceChainMagic:p,totalGrabableTimes:l}=e.asset.giftAsset,f=s.getAssetInfo(p,a),g=this.transactionHelper.getTransactionMinEffectiveHeight(e),d=this.transactionHelper.getTransactionMaxEffectiveHeight(e);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:f,amount:`-${o}`,sourceAmount:o,minEffectiveHeight:g,maxEffectiveHeight:d,totalUnfrozenTimes:l,frozenId:e.signature}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.giftAsset;return t.magic===r&&t.assetType===n?s:"0"}};hu=h([j()],hu);const{ArgumentIllegalException:xr}=re("CONTROLLER","GiftAnyTransactionFactory");let vl=class extends lu{async verifyTransactionBody(e,t,r=this.configHelper){const n=await this.commonVerifyTransactionBody(e,t,r),s=t.giftAny;if(await this.verifyGiftAny(s,r),s.giftDistributionRule===2&&e.rangeType!==1)throw new xr(c.SHOULD_BE,{to_compare_prop:`rangeType ${e.rangeType}`,to_target:"body",be_compare_prop:1});if(s.beginUnfrozenBlockHeight&&s.beginUnfrozenBlockHeight>=e.effectiveBlockHeight)throw new xr(c.PROP_SHOULD_LT_FIELD,{prop:`beginUnfrozenBlockHeight ${s.beginUnfrozenBlockHeight}`,field:e.effectiveBlockHeight,target:"giftAsset"});if(n.value!==s.assetType)throw new xr(c.NOT_MATCH,{to_compare_prop:`storage.value ${n.value}`,be_compare_prop:`assetType ${s.assetType}`,to_target:"storage",be_target:"giftAsset"});this.checkTransactionFee(e.fee,s.totalGrabableTimes,r)}async verifyGiftAny(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new xr(c.PARAM_LOST,{param:"giftAny"});const n={target:"giftAnyAsset"},s=e.cipherPublicKeys,o=new Set(s);if(s.length!==o.size)throw new xr(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(e.cipherPublicKeys))throw new xr(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",...n});const{sourceChainMagic:a,sourceChainName:p,parentAssetType:l,assetType:f,amount:g,giftDistributionRule:d,totalGrabableTimes:y,beginUnfrozenBlockHeight:m,taxInformation:E}=e;if(a===this.configHelper.magic&&(this.checkChainName(p,"sourceChainName",n),this.checkChainMagic(a,"sourceChainMagic",n),this.checkAssetType(l,f,"assetType",n)),!r.isPositiveInteger(y))throw new xr(c.PROP_IS_INVALID,{prop:`totalGrabableTimes ${y}`,type:"positive integer",...n});if(y>t.maxGrabTimesOfGiftAsset)throw new xr(c.PROP_SHOULD_LTE_FIELD,{prop:`totalGrabableTimes ${y}`,field:t.maxGrabTimesOfGiftAsset,...n});if(m!==void 0&&!r.isPositiveInteger(m))throw new xr(c.PROP_IS_INVALID,{prop:`beginUnfrozenBlockHeight ${e.beginUnfrozenBlockHeight}`,type:"positive integer",...n});if(this.checkAssetAmount(g,"amount",n),l===L.ASSETS){if(d===void 0)throw new xr(c.PROP_IS_REQUIRE,{prop:"giftDistributionRule",...n});if(d!==1&&d!==0&&d!==2)throw new xr(c.PROP_IS_INVALID,{prop:`giftDistributionRule ${d}`,type:"enum of GIFT_DISTRIBUTION_RULE",...n})}else{if(y!==1)throw new xr(c.SHOULD_BE,{to_compare_prop:`totalGrabableTimes ${y}`,to_target:"giftAny",be_compare_prop:1});if(g!=="1")throw new xr(c.SHOULD_BE,{to_compare_prop:`amount ${g}`,to_target:"giftAny",be_compare_prop:"1"});if(d!==void 0)throw new xr(c.SHOULD_NOT_EXIST,{prop:"giftDistributionRule",target:"giftAny"})}if(l===L.ENTITY)await this.checkTaxInformation(n,E);else if(E)throw new xr(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...n})}init(e,t){return Zp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{chainAssetInfoHelper:s}=this,{senderId:o,senderPublicKeyBuffer:a,signature:p,asset:l}=e,{taxInformation:f,amount:g,assetType:d,parentAssetType:y,sourceChainMagic:m,sourceChainName:E,totalGrabableTimes:T}=l.giftAny,w=this.transactionHelper.getTransactionMinEffectiveHeight(e),b=this.transactionHelper.getTransactionMaxEffectiveHeight(e);if(y===L.ASSETS){const C=s.getAssetInfo(m,d);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:o,publicKeyBuffer:a,assetInfo:C,amount:`-${g}`,sourceAmount:g,minEffectiveHeight:w,maxEffectiveHeight:b,totalUnfrozenTimes:T,frozenId:p}})}else if(y===L.DAPP)n.next=t.emit("frozenDApp",{type:"frozenDApp",transaction:e,applyInfo:{address:o,sourceChainName:E,sourceChainMagic:m,dappid:d,minEffectiveHeight:w,maxEffectiveHeight:b,status:17,frozenId:p}});else if(y===L.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:o,sourceChainName:E,sourceChainMagic:m,name:d,minEffectiveHeight:w,maxEffectiveHeight:b,status:17,frozenId:p}});else if(y===L.ENTITY&&f){n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:o,sourceChainName:E,sourceChainMagic:m,entityId:d,minEffectiveHeight:w,maxEffectiveHeight:b,status:17,frozenId:p}}),n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:E,sourceChainMagic:m,parentAssetType:y,assetType:d,taxInformation:f.toJSON()}});const{taxAssetPrealnum:C}=f;if(C!=="0"){const N=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:o,publicKeyBuffer:a,assetInfo:N,amount:`-${C}`,sourceAmount:C,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:p}})}}else if(y===L.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:o,sourceChainName:E,sourceChainMagic:m,certificateId:d,minEffectiveHeight:w,maxEffectiveHeight:b,status:17,frozenId:p}});else throw new xr(c.PROP_IS_INVALID,{prop:`parentAssetType ${y}`,target:"transaction.asset.giftAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.giftAny;return t.magic===r&&t.assetType===n?s:"0"}};vl=h([j()],vl);const{ArgumentIllegalException:Or}=re("CONTROLLER","GrabAssetTransactionFactory");let Hg=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.__giftAssetTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Or(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Or(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Or(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Or(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="transactionSignature")throw new Or(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const p=t.grabAsset;if(!p)throw new Or(c.PARAM_LOST,{param:"grabAsset"});const l={...n,target:"grabAssetAsset"},{blockSignature:f,transactionSignature:g}=p;if(!f)throw new Or(c.PROP_IS_REQUIRE,{prop:"blockSignature",...l});if(!s.isValidSignature(f))throw new Or(c.PROP_IS_INVALID,{prop:`blockSignature ${f}`,type:"block signature",...l});if(!g)throw new Or(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...l});if(!s.isValidSignature(g))throw new Or(c.PROP_IS_INVALID,{prop:`transactionSignature ${g}`,type:"transaction signature",...l});if(a.value!==g)throw new Or(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`transactionSignature ${g}`,to_target:"storage",be_target:"grabAsset",...n});this.checkAssetAmount(p.amount,"amount",l);const{giftAsset:d,ciphertextSignature:y}=p;this.__giftAssetTransactionFactory.verifyGiftAsset(d);const{cipherPublicKeys:m}=d;if(m.length>0){if(!y)throw new Or(c.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...l});if(!s.isValidAccountSignature(y))throw new Or(c.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...l});const{publicKey:E,signature:T}=y;if(!m.includes(E))throw new Or(c.NOT_MATCH,{to_compare_prop:`publicKey ${E}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...l});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:he(E),ciphertextSignatureBuffer:he(T),transactionSignatureBuffer:he(g),senderId:e.senderId}))throw new Or(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${T}`,type:"signature",...l})}else if(y)throw new Or(c.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${y}`,type:"grabAsset",...l})}init(e,t){return Hp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{const{chainAssetInfoHelper:s}=this,{grabAsset:o}=e.asset,{amount:a,transactionSignature:p}=o,{assetType:l,sourceChainMagic:f}=o.giftAsset,g=e.recipientId,d=s.getAssetInfo(f,l);n.next=super.applyTransaction(e,t,r),n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:d,amount:a,sourceAmount:a,frozenId:p,recipientId:g}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{amount:r,giftAsset:n}=e.asset.grabAsset,{sourceChainMagic:s,assetType:o}=n;return t.magic===s&&t.assetType===o?r:"0"}};Hg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,hu])],Hg);const{ArgumentIllegalException:dr}=re("CONTROLLER","GrabAnyTransactionFactory");let uu=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.__giftAnyTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new dr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new dr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new dr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new dr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="transactionSignature")throw new dr(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const p=t.grabAny;if(!p)throw new dr(c.PARAM_LOST,{param:"grabAny"});const l={...n,target:"grabAnyAsset"},{blockSignature:f,transactionSignature:g}=p;if(!f)throw new dr(c.PROP_IS_REQUIRE,{prop:"blockSignature",...l});if(!s.isValidSignature(f))throw new dr(c.PROP_IS_INVALID,{prop:`blockSignature ${f}`,type:"block signature",...l});if(!g)throw new dr(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...l});if(!s.isValidSignature(g))throw new dr(c.PROP_IS_INVALID,{prop:`transactionSignature ${g}`,type:"transaction signature",...l});if(a.value!==g)throw new dr(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`transactionSignature ${g}`,to_target:"storage",be_target:"grabAsset",...n});this.checkAssetAmount(p.amount,"amount",l);const{giftAny:d,ciphertextSignature:y}=p;await this.__giftAnyTransactionFactory.verifyGiftAny(d);const{cipherPublicKeys:m}=d;if(m.length>0){if(!y)throw new dr(c.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...l});if(!s.isValidAccountSignature(y))throw new dr(c.NOT_EXIST,{prop:`ciphertextSignature ${y}`,...l});const{publicKey:E,signature:T}=y;if(!m.includes(E))throw new dr(c.NOT_MATCH,{to_compare_prop:`publicKey ${E}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...l});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:he(E),ciphertextSignatureBuffer:he(T),transactionSignatureBuffer:he(g),senderId:e.senderId}))throw new dr(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${T}`,type:"signature",...l})}else if(y)throw new dr(c.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${y}`,type:"grabAsset",...l})}init(e,t){return el.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{const{chainAssetInfoHelper:s}=this,{senderId:o,recipientId:a,senderPublicKeyBuffer:p,asset:l}=e,{amount:f,giftAny:g,transactionSignature:d}=l.grabAny,{assetType:y,parentAssetType:m,sourceChainMagic:E,sourceChainName:T}=g,w=s.getAssetInfo(E,y);if(n.next=super.applyTransaction(e,t,r),m===L.ASSETS)n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:o,publicKeyBuffer:p,assetInfo:w,amount:f,sourceAmount:f,recipientId:a,frozenId:d}});else if(m===L.DAPP)n.next=t.emit("unfrozenDApp",{type:"unfrozenDApp",transaction:e,applyInfo:{address:o,publicKeyBuffer:p,possessorAddress:o,sourceChainName:T,sourceChainMagic:E,dappid:y,status:0,frozenId:d}});else if(m===L.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:o,publicKeyBuffer:p,possessorAddress:o,sourceChainName:T,sourceChainMagic:E,name:y,status:0,frozenId:d}});else if(m===L.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:o,publicKeyBuffer:p,possessorAddress:o,sourceChainName:T,sourceChainMagic:E,entityId:y,status:0,frozenId:d}}),g.taxInformation){const{taxCollector:b,taxAssetPrealnum:C}=g.taxInformation;if(C==="0"){const N=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,C,{senderId:o,senderPublicKeyBuffer:p,recipientId:b,assetInfo:N})}else{const N=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:b,publicKeyBuffer:p,assetInfo:N,amount:C,sourceAmount:C,recipientId:a,frozenId:d}})}}}else if(m===L.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:o,publicKeyBuffer:p,possessorAddress:o,sourceChainName:T,sourceChainMagic:E,certificateId:y,status:0,frozenId:d}});else throw new dr(c.PROP_IS_INVALID,{prop:`parentAssetType ${m}`,target:"transaction.asset.grabAny.giftAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{amount:r,giftAny:n}=e.asset.grabAny,{sourceChainMagic:s,assetType:o}=n;return t.magic===s&&t.assetType===o?r:"0"}};uu=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,vl])],uu);const{ArgumentIllegalException:ir}=re("CONTROLLER","TrustAssetTransactionFactory");let fu=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{senderId:s,recipientId:o}=e;if(!o)throw new ir(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(s===o)throw new ir(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${s}`,to_target:"body",be_compare_prop:`recipientId ${o}`,...n});if(e.fromMagic!==r.magic)throw new ir(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ir(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new ir(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="assetType")throw new ir(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const p=t.trustAsset;await this.verifyTrustAsset(p,s,o);const l=p.trustees;if(!l.includes(s))throw new ir(c.SHOULD_INCLUDE,{prop:"trustees",value:`senderId ${s}`,...n,target:"trustAsset"});if(!l.includes(o))throw new ir(c.SHOULD_INCLUDE,{prop:"trustee",value:`recipientId ${o}`,...n,target:"trustAsset"});if(a.value!==p.assetType)throw new ir(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`assetType ${p.assetType}`,to_target:"storage",be_target:"trustAsset",...n})}async verifyTrustAsset(e,t,r){const{baseHelper:n,accountBaseHelper:s}=this;if(!e)throw new ir(c.PARAM_LOST,{param:"trustAsset"});const o={target:"trustAssetAsset"},{trustees:a,numberOfSignFor:p,sourceChainName:l,sourceChainMagic:f}=e;if(!n.isArray(a))throw new ir(c.PROP_IS_INVALID,{prop:"trustees",type:"string array",...o,target:"trustAsset"});if(a.length<0)throw new ir(c.PROP_IS_REQUIRE,{prop:`trustees length ${a.length}`,...o});for(const d of a)if(!await s.isAddress(d))throw new ir(c.PROP_IS_INVALID,{prop:`trustee ${d}`,type:"account address",target:"trustees"});const g=[...new Set([...a,t,r])];if(a.length!==g.length)throw new ir(c.SHOULD_NOT_DUPLICATE,{prop:"trustee",...o});if(!n.isPositiveInteger(p))throw new ir(c.PROP_IS_INVALID,{prop:`numberOfSignFor ${p}`,type:"positive integer",...o});if(p>g.length)throw new ir(c.PROP_SHOULD_LTE_FIELD,{prop:`numberOfSignFor ${p}`,field:g.length,...o,target:"trustAsset"});if(p<1)throw new ir(c.PROP_SHOULD_GTE_FIELD,{prop:`numberOfSignFor ${p}`,field:1,...o,target:"trustAsset"});if(f===this.configHelper.magic&&(this.checkChainName(l,"sourceChainName",o),this.checkChainMagic(f,"sourceChainMagic",o),this.checkAsset(e.assetType,"assetType",o)),this.checkAssetAmount(e.amount,"amount",o),e.amount==="0")throw new ir(c.PROP_SHOULD_GT_FIELD,{prop:`amount ${e.amount}`,fueld:"0",...o})}init(e,t){return Fp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{amount:s,assetType:o,sourceChainMagic:a,numberOfSignFor:p}=e.asset.trustAsset,l=this.chainAssetInfoHelper.getAssetInfo(a,o);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:l,amount:`-${s}`,sourceAmount:s,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:e.signature,totalUnfrozenTimes:p}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.trustAsset;return t.magic===r&&t.assetType===n?s:"0"}};fu=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],fu);const{ArgumentIllegalException:Dr}=re("CONTROLLER","signForAssetTransactionFactory");let Fg=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.trustAssetTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s,accountBaseHelper:o,transactionHelper:a}=this,p=e.recipientId;if(!p)throw new Dr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});const l=e.senderId;if(e.fromMagic!==r.magic)throw new Dr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Dr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Dr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const f=e.storage;if(f.key!=="transactionSignature")throw new Dr(c.SHOULD_BE,{to_compare_prop:`storage.key ${f.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const g={...n,target:"signForAssetAsset"},d=t.signForAsset;if(!d)throw new Dr(c.PARAM_LOST,{param:"signForAsset"});const{trustAsset:y,trustSenderId:m,trustRecipientId:E,transactionSignature:T}=d;if(!T)throw new Dr(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...g});if(!s.isValidSignature(T))throw new Dr(c.PROP_IS_INVALID,{prop:`transactionSignature ${T}`,type:"transaction signature",...g});if(f.value!==T)throw new Dr(c.NOT_MATCH,{to_compare_prop:`storage.value ${f.value}`,be_compare_prop:`transactionSignature ${T}`,to_target:"storage",be_target:"signForAsset",...n});if(!m)throw new Dr(c.PROP_IS_REQUIRE,{prop:"trustSenderId",...g});if(!await o.isAddress(m))throw new Dr(c.PROP_IS_INVALID,{prop:`trustSenderId ${m}`,type:"account address",...n,target:"trustAsset"});if(!E)throw new Dr(c.PROP_IS_REQUIRE,{prop:"trustRecipientId",...g});if(!await o.isAddress(E))throw new Dr(c.PROP_IS_INVALID,{prop:`trustRecipientId ${E}`,type:"account address",...g});if(p!==E)throw new Dr(c.SHOULD_BE,{to_compare_prop:`recipientId ${p}`,to_target:"body",be_compare_prop:`trustRecipientId ${E}`,...g});await this.trustAssetTransactionFactory.verifyTrustAsset(y,m,E);const{trustees:w}=y;if(![...new Set([...w,m,E])].includes(l))throw new Dr(c.PERMISSION_DENIED,{operationName:`sign for asset ${T}`,...g})}init(e,t){return Vp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{transactionSignature:s,trustSenderId:o,trustRecipientId:a,trustAsset:p}=e.asset.signForAsset,l=this.chainAssetInfoHelper.getAssetInfo(p.sourceChainMagic,p.assetType);n.next=t.emit("signForAsset",{type:"signForAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,frozenId:s,frozenAddress:o,recipientId:a,assetInfo:l}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,assetType:n,amount:s}=e.asset.signForAsset.trustAsset;return t.magic===r&&t.assetType===n?s:"0"}};Fg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,fu])],Fg);const{ArgumentIllegalException:qr}=re("CONTROLLER","EmigrateAssetTransactionFactory");let Vg=class extends Ke{constructor(e,t,r,n,s,o){super(),this.baseHelper=e,this.configHelper=t,this.accountBaseHelper=r,this.transactionHelper=n,this.chainAssetInfoHelper=s,this.migrateCertificateHelper=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new qr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new qr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic===r.magic)throw new qr(c.SHOULD_NOT_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new qr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="assetType")throw new qr(c.SHOULD_BE,{to_compare_prop:`key ${s.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const o=t.emigrateAsset;if(!o)throw new qr(c.PARAM_LOST,{param:"emigrateAsset"});if(!o.migrateCertificate)throw new qr(c.PROP_IS_REQUIRE,{prop:"migrateCertificate",target:"emigrateAsset"});let a;try{a=JSON.parse(o.migrateCertificate)}catch{throw new qr(c.PROP_IS_INVALID,{prop:"migrateCertificate",target:"emigrateAsset"})}const p=await this.migrateCertificateHelper.verifyMigrateCertificate(a,{forceCheckFromChainInfo:!0,fromChainBaseConfig:{chainName:r.chainName,magic:r.magic,generatorPublicKey:r.generatorPublicKey,genesisBlockSignature:r.signature,genesisDelegates:this.transactionHelper.genesisDelegates(r)},forceCheckFromAuthSignature:!0});if(a.toAuthSignature)throw new qr(c.SHOULD_NOT_EXIST,{prop:"toAuthSignature",...n,target:"aemigrateAsset.migrateCertificate"});const{toChainId:l,fromId:f,toId:g,assetId:d}=a.body,y=p.fromId.decode(f);if(e.senderId!==y)throw new qr(c.NOT_MATCH,{to_compare_prop:`senderId ${e.senderId}`,be_compare_prop:`fromId ${y}`,to_target:"body",be_target:"migrateCertificate",...n});const m=p.toId.decode(g);if(e.recipientId!==m)throw new qr(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`toId ${m}`,to_target:"body",be_target:"migrateCertificate",...n});const E=p.toChainId.decode(l);if(e.toMagic!==E.magic)throw new qr(c.NOT_MATCH,{to_compare_prop:`toMagic ${e.toMagic}`,be_compare_prop:`toChainId ${E.magic}`,to_target:"body",be_target:"migrateCertificate",...n});const T=p.assetId.decode(d);if(s.value!==T.assetType)throw new qr(c.NOT_MATCH,{to_compare_prop:`value ${s.value}`,be_compare_prop:`assetTypeId ${T.assetType}`,to_target:"storage",be_target:"migrateCertificateBody",...n})}init(e,t){return $p.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:o}=e;n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,accountStatus:17}})})}};Vg=h([j(),u("design:paramtypes",[Pe,te,de,me,ke,js])],Vg);const{ArgumentIllegalException:Xr}=re("CONTROLLER","ImmigrateAssetTransactionFactory");let $g=class extends Ke{constructor(e,t,r,n,s,o){super(),this.baseHelper=e,this.configHelper=t,this.accountBaseHelper=r,this.transactionHelper=n,this.chainAssetInfoHelper=s,this.migrateCertificateHelper=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new Xr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic===r.magic)throw new Xr(c.SHOULD_NOT_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Xr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Xr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="assetType")throw new Xr(c.SHOULD_BE,{to_compare_prop:`key ${s.key}`,to_target:"storage",be_compare_prop:"assetType",...n});const o=t.immigrateAsset;if(!o)throw new Xr(c.PARAM_LOST,{param:"immigrateAsset"});const a={...n,target:"immigrateAsset"};if(!o.migrateCertificate)throw new Xr(c.PROP_IS_REQUIRE,{prop:"migrateCertificate",...a});let p;try{p=JSON.parse(o.migrateCertificate)}catch{throw new Xr(c.PROP_IS_INVALID,{prop:"migrateCertificate",...a})}const l=await this.migrateCertificateHelper.verifyMigrateCertificate(p,{forceCheckToChainInfo:!0,toChainBaseConfig:{chainName:r.chainName,magic:r.magic,generatorPublicKey:r.generatorPublicKey,genesisBlockSignature:r.signature,genesisDelegates:this.transactionHelper.genesisDelegates(r)},forceCheckToAuthSignature:!0,forceCheckFromAuthSignature:!0}),{fromChainId:f,toId:g,assetId:d}=p.body,y=l.toId.decode(g,!0);if(e.recipientId!==y)throw new Xr(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`toId ${y}`,to_target:"body",be_target:"migrateCertificate",...n});const m=l.fromChainId.decode(f,!0);if(e.fromMagic!==m.magic)throw new Xr(c.NOT_MATCH,{to_compare_prop:`fromMagic ${e.fromMagic}`,be_compare_prop:`fromChainId ${m.magic}`,to_target:"body",be_target:"migrateCertificate",...n});const E=l.assetId.decode(d,!0);if(s.value!==E.assetType)throw new Xr(c.NOT_MATCH,{to_compare_prop:`value ${s.value}`,be_compare_prop:`asset ${JSON.stringify(E)}`,to_target:"storage",be_target:"migrateCertificate",...n})}init(e,t){return Up.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);let s;try{s=JSON.parse(e.asset.immigrateAsset.migrateCertificate)}catch{throw new Xr(c.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const o=this.migrateCertificateHelper.getMigrateCertificateConverter(s),{fromChainId:a,assetId:p,assetPrealnum:l}=s.body,f=o.fromChainId.decode(a),g=o.assetId.decode(p),{parentAssetType:d,assetType:y}=g;if(d===L.ASSETS){const m=this.chainAssetInfoHelper.getAssetInfo(f.magic,y);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:e.recipientId,assetInfo:m,amount:l,sourceAmount:l}})}else throw new Error("");n.next=t.emit("migrateCertificate",{type:"migrateCertificate",transaction:e,applyInfo:{migrateCertificateId:o.getUUID(s),assetInfo:{magic:f.magic,assetType:y},assets:l,migrateIdBuffer:e.signatureBuffer}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){let r;try{r=JSON.parse(e.asset.immigrateAsset.migrateCertificate)}catch{throw new Xr(c.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const n=this.migrateCertificateHelper.getMigrateCertificateConverter(r),{fromChainId:s,assetId:o,assetPrealnum:a}=r.body,p=n.fromChainId.decode(s),l=n.assetId.decode(o);return t.magic===p.magic&&t.assetType===l.assetType?a:"0"}};$g=h([j(),u("design:paramtypes",[Pe,te,de,me,ke,js])],$g);const{ArgumentIllegalException:Zt}=re("CONTROLLER","ToExchangeSpecialAssetTransactionFactory");let gu=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new Zt(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Zt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Zt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});const s=t.toExchangeSpecialAsset;if(this.verifyExchangeSpecialAsset(s),e.storage)throw new Zt(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}verifyExchangeSpecialAsset(e){if(!e)throw new Zt(c.PARAM_LOST,{param:"toExchangeSpecialAsset"});const{baseHelper:t}=this,r={target:"toExchangeSpecialAssetAsset"};if(!t.isValidCipherPublicKeys(e.cipherPublicKeys))throw new Zt(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",type:"cipher publicKeys",...r});const{toExchangeSource:n,toExchangeChainName:s,toExchangeAsset:o,beExchangeSource:a,beExchangeChainName:p,beExchangeAsset:l}=e;this.checkChainName(s,"toExchangeChainName",r),this.checkChainMagic(n,"toExchangeSource",r),this.checkChainName(p,"beExchangeChainName",r),this.checkChainMagic(a,"beExchangeSource",r);const f=e.exchangeAssetType;if(f!==0&&f!==1&&f!==2)throw new Zt(c.PROP_IS_INVALID,{prop:f,...r});const g=e.exchangeDirection;if(g!==0&&g!==1)throw new Zt(c.PROP_IS_REQUIRE,{prop:g,...r});if(g===1){if(f===0){if(!t.isValidDAppId(l))throw new Zt(c.PROP_IS_INVALID,{prop:`beExchangeAsset ${l}`,...r})}else if(f===1){if(!t.isValidLocationName(l))throw new Zt(c.PROP_IS_INVALID,{prop:`beExchangeAsset ${l}`,...r})}else if(f===2&&!t.isValidEntityId(l))throw new Zt(c.PROP_IS_INVALID,{prop:`beExchangeAsset ${l}`,...r});if(!t.isValidAssetType(o))throw new Zt(c.PROP_IS_INVALID,{prop:`toExchangeAsset ${o}`,...r})}else{if(f===0){if(!t.isValidDAppId(o))throw new Zt(c.PROP_IS_INVALID,{prop:`toExchangeAsset ${o}`,...r})}else if(f===1){if(!t.isValidLocationName(o))throw new Zt(c.PROP_IS_INVALID,{prop:`toExchangeAsset ${o}`,...r})}else if(f===2&&!t.isValidEntityId(o))throw new Zt(c.PROP_IS_INVALID,{prop:`toExchangeAsset ${o}`,...r});if(!t.isValidAssetType(l))throw new Zt(c.PROP_IS_INVALID,{prop:`beExchangeAsset ${l}`,...r})}if(!e.exchangeNumber)throw new Zt(c.PROP_IS_REQUIRE,{prop:"beExchangeNumber",...r});if(!t.isValidAssetNumber(e.exchangeNumber))throw new Zt(c.PROP_IS_INVALID,{prop:`beExchangeNumber ${e.exchangeNumber}`,type:"asset number",...r})}init(e,t){return Kp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const s=e.signature,{toExchangeChainName:o,toExchangeSource:a,toExchangeAsset:p,exchangeNumber:l,exchangeDirection:f,exchangeAssetType:g}=e.asset.toExchangeSpecialAsset;if(f===1){const d=this.chainAssetInfoHelper.getAssetInfo(a,p);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:d,amount:`-${l}`,sourceAmount:l,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:s}})}else{const d=e.senderId;if(g===0)n.next=t.emit("frozenDApp",{type:"frozenDApp",transaction:e,applyInfo:{address:d,sourceChainName:o,sourceChainMagic:a,dappid:p,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:s}});else if(g===1)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:d,sourceChainName:o,sourceChainMagic:a,name:p,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:s}});else if(g===2)n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:d,sourceChainName:o,sourceChainMagic:a,entityId:p,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:s}});else throw new Zt(c.PROP_IS_INVALID,{prop:`exchangeAssetType ${g}`,target:"transaction.asset.toExchangeSpecialAssetAsset"})}})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeSource:s,toExchangeAsset:o,exchangeDirection:a,exchangeNumber:p}=e.asset.toExchangeSpecialAsset;return a===1&&r===s&&n===o?p:"0"}};gu=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],gu);const{ArgumentIllegalException:Cr}=re("CONTROLLER","BeExchangeSpecialAssetTransactionFactory");let Ug=class extends Ke{constructor(e,t,r,n,s,o,a){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=o,this.toExchangeSpecialAssetTransactionFactory=a}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this,o=e.recipientId;if(!o)throw new Cr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.senderId===o)throw new Cr(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${o}`,...n});if(e.fromMagic!==r.magic)throw new Cr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Cr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Cr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="transactionSignature")throw new Cr(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const p=t.beExchangeSpecialAsset;if(!p)throw new Cr(c.PARAM_LOST,{param:"beExchangeSpecialAsset",...n});const l={...n,target:"beExchangeSpecialAsset"},f=p.transactionSignature;if(!f)throw new Cr(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...l});if(!s.isValidSignature(f))throw new Cr(c.PROP_IS_INVALID,{prop:`transactionSignature ${f}`,type:"transaction signature",...l});if(a.value!==f)throw new Cr(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`transactionSignature ${f}`,to_target:"storage",be_target:"beExchangeSpecialAsset",...n});const{exchangeSpecialAsset:g,ciphertextSignature:d}=p;this.toExchangeSpecialAssetTransactionFactory.verifyExchangeSpecialAsset(g);const{cipherPublicKeys:y}=g;if(y.length>0){if(!d)throw new Cr(c.NOT_EXIST,{prop:`ciphertextSignature ${d}`,...l});if(!s.isValidAccountSignature(d))throw new Cr(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${d}`,...l});const{signature:m,publicKey:E}=d;if(!y.includes(E))throw new Cr(c.NOT_MATCH,{to_compare_prop:`publicKey ${E}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...l});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:he(E),ciphertextSignatureBuffer:he(m),transactionSignatureBuffer:he(f),senderId:e.senderId}))throw new Cr(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${m}`,type:"signature",...l})}else if(d)throw new Cr(c.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${p.ciphertextSignature}`,...l})}init(e,t){return Gp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{exchangeSpecialAsset:s,transactionSignatureBuffer:o,transactionSignature:a}=e.asset.beExchangeSpecialAsset,{toExchangeChainName:p,toExchangeSource:l,toExchangeAsset:f,beExchangeChainName:g,beExchangeSource:d,beExchangeAsset:y,exchangeDirection:m,exchangeNumber:E,exchangeAssetType:T}=s,{senderId:w,senderPublicKeyBuffer:b,recipientId:C}=e;if(m===1){const N=this.chainAssetInfoHelper.getAssetInfo(l,f);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:w,publicKeyBuffer:b,assetInfo:N,amount:E,sourceAmount:E,frozenId:a,recipientId:C}}),T===0?n.next=t.emit("changeDAppPossessor",{type:"changeDAppPossessor",transaction:e,applyInfo:{address:w,publicKeyBuffer:b,possessorAddress:C,sourceChainName:g,sourceChainMagic:d,dappid:y}}):T===1?n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:w,publicKeyBuffer:b,possessorAddress:C,sourceChainName:g,sourceChainMagic:d,name:y}}):T===2&&(n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:w,publicKeyBuffer:b,possessorAddress:C,sourceChainName:g,sourceChainMagic:d,entityId:y}}))}else{const N=this.chainAssetInfoHelper.getAssetInfo(d,y);if(n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:b,assetInfo:N,amount:`-${E}`,sourceAmount:E}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:C,assetInfo:N,amount:E,sourceAmount:E}}),T===0)n.next=t.emit("unfrozenDApp",{type:"unfrozenDApp",transaction:e,applyInfo:{address:w,publicKeyBuffer:b,possessorAddress:w,sourceChainName:p,sourceChainMagic:l,dappid:f,status:0,frozenId:a}});else if(T===1)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:w,publicKeyBuffer:b,possessorAddress:w,sourceChainName:p,sourceChainMagic:l,name:f,status:0,frozenId:a}});else if(T===2)n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:w,publicKeyBuffer:b,possessorAddress:w,sourceChainName:p,sourceChainMagic:l,entityId:f,status:0,frozenId:a}});else throw new Cr(c.PROP_IS_INVALID,{prop:`exchangeAssetType ${T}`,target:"transaction.asset.beExchangeSpecialAssetAsset.exchangeSpecialAsset"})}})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeSource:s,toExchangeAsset:o,beExchangeAsset:a,beExchangeSource:p,exchangeNumber:l}=e.asset.beExchangeSpecialAsset.exchangeSpecialAsset;return r===s&&n===o||r===p&&n===a?l:"0"}};Ug=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,It,gu])],Ug);const{ArgumentIllegalException:Ut}=re("CONTROLLER","LocationNameTransactionFactory");let Kg=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Ut(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Ut(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Ut(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Ut(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="name")throw new Ut(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"name",...n});const a=t.locationName;if(!a)throw new Ut(c.PARAM_LOST,{param:"locationName"});const p={...n,target:"locationName"},l=a.name;if(!l)throw new Ut(c.PROP_IS_REQUIRE,{prop:"name",...p});if(!s.isString(l))throw new Ut(c.PROP_IS_INVALID,{prop:`name ${l}`,type:"string",...p});if(l.length>512)throw new Ut(c.OVER_LENGTH,{prop:`name ${l}`,limit:512,...p});if(s.isStartWithOrEndWithPoint(l))throw new Ut(c.SHOULD_NOT_START_WITH_OR_END_WITH,{prop:`name ${l}`,field:".",...p});const g=l.split("."),d=g.length;if(d<2)throw new Ut(c.PROP_IS_INVALID,{prop:`name ${l}`,...p});for(let T=0;T<d;T++){const w=g[T];if(w.length>128)throw new Ut(c.OVER_LENGTH,{prop:`name ${w}`,limit:128,...p});if(T===d-2){if(!s.isLowerCaseLetter(w))throw new Ut(c.PROP_IS_INVALID,{prop:`name ${w}`,type:"lowercase",...p})}else if(T===d-1){if(w!==r.chainName)throw new Ut(c.SHOULD_BE,{to_compare_prop:"root location name",to_target:`name ${w}`,be_compare_prop:r.chainName,...p})}else if(w.length<=2){if(!s.isLowerCaseLetterOrNumber(w))throw new Ut(c.PROP_IS_INVALID,{prop:`name ${w}`,type:"lowercase letter or number",...p})}else if(!s.isLowerCaseLetterOrNumberOrUnderline(w))throw new Ut(c.PROP_IS_INVALID,{prop:`name ${w}`,type:"lowercase letter or number or underline",...p})}if(o.value!==l)throw new Ut(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`name ${l}`,to_target:"storage",be_target:"locationName",...n});const{sourceChainName:y,sourceChainMagic:m,operationType:E}=a;if(this.checkChainName(y,"sourceChainName",p),y!==r.chainName)throw new Ut(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${y}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(m,"sourceChainMagic",p),m!==r.magic)throw new Ut(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${m}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(E!==0&&E!==1)throw new Ut(c.NOT_MATCH,{to_compare_prop:`operationType ${E}`,be_compare_prop:"locationNameType",to_target:"locationName",be_target:"LOCATION_NAME_OPERATION_TYPE",...p});if(E===1&&e.senderId!==e.recipientId)throw new Ut(c.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"transaction",be_compare_prop:e.senderId,...n})}init(e,t){return zp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:o}=e,{name:a,sourceChainMagic:p,sourceChainName:l,operationType:f}=e.asset.locationName;f===0?n.next=t.emit("registerLocationName",{type:"registerLocationName",transaction:e,applyInfo:{address:s,name:a,sourceChainMagic:p,sourceChainName:l,possessorAddress:o,status:0}}):n.next=t.emit("cancelLocationName",{type:"cancelLocationName",transaction:e,applyInfo:{address:s,sourceChainName:l,sourceChainMagic:p,name:a,status:255}})})}};Kg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Kg);const{ArgumentIllegalException:bs}=re("CONTROLLER","SetLnsManagerTransactionFactory");let Gg=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new bs(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new bs(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new bs(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new bs(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="name")throw new bs(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"name",...n});const p=t.lnsManager;if(!p)throw new bs(c.PARAM_LOST,{param:"lnsManager"});const l={...n,target:"lnsManagerAsset"},f=p.name;if(!f)throw new bs(c.PROP_IS_REQUIRE,{prop:"name",...l});if(!s.isValidLocationName(f))throw new bs(c.PROP_IS_INVALID,{prop:`name ${f}`,type:"location name",...l});if(a.value!==f)throw new bs(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`name ${f}`,to_target:"storage",be_target:"lnsManager",...n});const{sourceChainName:g,sourceChainMagic:d}=p;this.checkChainName(g,"sourceChainName",l),this.checkChainMagic(d,"sourceChainMagic",l)}init(e,t){return jp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{name:s,sourceChainMagic:o,sourceChainName:a}=e.asset.lnsManager;n.next=t.emit("setLnsManager",{type:"setLnsManager",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:a,sourceChainMagic:o,name:s,manager:e.recipientId}})})}};Gg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Gg);const{ArgumentIllegalException:at}=re("CONTROLLER","SetLnsRecordValueTransactionFactory");let zg=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(e.recipientId)throw new at(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new at(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new at(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new at(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="name")throw new at(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"name",...n});const a=t.lnsRecordValue;if(!a)throw new at(c.PARAM_LOST,{param:"lnsRecordValue"});const p={...n,target:"lnsRecordValueAsset"},l=a.name;if(!l)throw new at(c.PROP_IS_REQUIRE,{prop:"name",...p});if(!s.isValidLocationName(l))throw new at(c.PROP_IS_INVALID,{prop:`name ${l}`,type:"location name",...p});if(o.value!==l)throw new at(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`name ${l}`,to_target:"storage",be_target:"lnsRecordValue",...n});const{sourceChainName:f,sourceChainMagic:g}=a;switch(this.checkChainName(f,"sourceChainName",p),this.checkChainMagic(g,"sourceChainMagic",p),a.operationType){case 0:if(!a.addRecord)throw new at(c.PROP_IS_REQUIRE,{prop:"addRecord",...p});if(a.deleteRecord)throw new at(c.SHOULD_NOT_EXIST,{prop:"deleteRecord",...p});await this.checkLocationNameRecord(a.addRecord);break;case 1:if(a.addRecord)throw new at(c.SHOULD_NOT_EXIST,{prop:"addRecord",...p});if(!a.deleteRecord)throw new at(c.PROP_IS_REQUIRE,{prop:"deleteRecord",...p});await this.checkLocationNameRecord(a.deleteRecord);break;case 2:if(!a.addRecord)throw new at(c.PROP_IS_REQUIRE,{prop:"addRecord",...p});if(!a.deleteRecord)throw new at(c.PROP_IS_REQUIRE,{prop:"deleteRecord",...p});await this.checkLocationNameRecord(a.addRecord),await this.checkLocationNameRecord(a.deleteRecord);break;default:throw new at(c.PROP_IS_INVALID,{prop:"operationType",type:"location name operation type",...p})}}async checkLocationNameRecord(e){const{baseHelper:t,accountBaseHelper:r}=this;if(!e)throw new at(c.PARAM_LOST,{param:"record"});const n={target:"lnsRecordValue"},{recordType:s,recordValue:o}=e;if(!t.isString(o))throw new at(c.NOT_A_STRING,{prop:"recordValue",value:o,...n});if(s===1){if(!t.isIpV4(o))throw new at(c.NOT_A_IPV4,{prop:"recordValue",value:o,...n})}else if(s===2){if(!t.isIpV6(o))throw new at(c.NOT_A_IPV6,{prop:"recordValue",value:o,...n})}else if(s===3){const a=o.split(",");if(a.length!==2)throw new at(c.NOT_A_LONGITUDE_LATITUDE,{prop:"recordValue",value:o,...n});if(!t.isLongitude(a[0]))throw new at(c.NOT_A_LONGITUDE,{prop:"recordValue",value:o,...n});if(!t.isLatitude(a[1]))throw new at(c.NOT_A_LATITUDE,{prop:"recordValue",value:o,...n})}else if(s===4){if(!await r.isAddress(o))throw new at(c.NOT_A_ADDRESS,{prop:"recordValue",value:o,...n})}else if(s===5){if(!t.isValidLocationName(o))throw new at(c.NOT_A_LOCATION_NAME,{prop:"recordValue",value:o,...n})}else if(s===6){if(!t.isDNS(o))throw new at(c.NOT_A_DNS,{prop:"recordValue",value:o,...n})}else if(s===8){if(!t.isEmail(o))throw new at(c.NOT_A_EMAIL,{prop:"recordValue",value:o,...n})}else if(s===7){if(!t.isURL(o))throw new at(c.NOT_A_URL,{prop:"recordValue",value:o,...n})}else if(s!==0)throw new at(c.NOT_EXIST,{prop:"recordType",...n})}init(e,t){return Jp.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{name:s,sourceChainMagic:o,sourceChainName:a,operationType:p,addRecord:l,deleteRecord:f}=e.asset.lnsRecordValue;n.next=t.emit("setLnsRecordValue",{type:"setLnsRecordValue",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainMagic:o,sourceChainName:a,name:s,operationType:p,addRecord:l,deleteRecord:f}})})}};zg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],zg);const{ArgumentIllegalException:er}=re("CONTROLLER","IssueEntityFactoryTransactionFactory");let co=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=o}async commonVerifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new er(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new er(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new er(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new er(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="factoryId")throw new er(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"factoryId",...n});const a=t.issueEntityFactory;if(this.verifyIssueEntityFactoryAsset(a,r),o.value!==a.factoryId)throw new er(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`factoryId ${a.factoryId}`,to_target:"storage",be_target:"dapp",...n})}async verifyTransactionBody(e,t,r=this.configHelper){if(await this.commonVerifyTransactionBody(e,t,r),e.senderId===e.recipientId)throw new er(c.SHOULD_NOT_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"body",be_compare_prop:`recipientId ${e.recipientId}`,target:"body"})}verifyIssueEntityFactoryAsset(e,t=this.configHelper){const{baseHelper:r}=this,n={target:"body"};if(!e)throw new er(c.PARAM_LOST,{param:"issueEntityFactory",...n});const s={...n,target:"issueEntityFactory"},{sourceChainMagic:o,sourceChainName:a,factoryId:p,entityPrealnum:l,entityFrozenAssetPrealnum:f,purchaseAssetPrealnum:g}=e;if(a!==t.chainName)throw new er(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${a}`,to_target:"body",be_compare_prop:"local chain name",...n});if(o!==t.magic)throw new er(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${o}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!p)throw new er(c.PROP_IS_REQUIRE,{prop:"factoryId",...s});if(!r.isString(p))throw new er(c.PROP_IS_INVALID,{prop:`factoryId ${p}`,type:"string",...s});const d=p.length;if(d<3||d>15)throw new er(c.NOT_IN_EXPECTED_RANGE,{prop:`factoryId ${p}`,type:"string length",min:3,max:15,...s});if(!r.isLowerCaseLetterOrNumber(p))throw new er(c.PROP_IS_INVALID,{prop:`factoryId ${p}`,type:"lowercase letter or number",...s});if(!r.isPositiveStringNumber(l))throw new er(c.PROP_IS_INVALID,{prop:`entityPrealnum ${l}`,type:"positive integer",IssueEntityFactoryAsset_Exception_Detail:s});if(!f)throw new er(c.PROP_IS_REQUIRE,{prop:"entityFrozenAssetPrealnum",...s});if(!r.isValidAssetPrealnum(f))throw new er(c.PROP_IS_INVALID,{prop:`entityFrozenAssetPrealnum ${f}`,type:"string number",...s});if(!g)throw new er(c.PROP_IS_REQUIRE,{prop:"purchaseAssetPrealnum",...s});if(!r.isValidAssetPrealnum(g))throw new er(c.PROP_IS_INVALID,{prop:`purchaseAssetPrealnum ${g}`,type:"string number",...s})}init(e,t){return Yp.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{sourceChainName:s,sourceChainMagic:o,factoryId:a,entityPrealnum:p,entityFrozenAssetPrealnum:l,purchaseAssetPrealnum:f}=e.asset.issueEntityFactory;n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,accountStatus:16}}),n.next=t.emit("issueEntityFactoryByFrozen",{type:"issueEntityFactoryByFrozen",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:s,sourceChainMagic:o,factoryId:a,entityPrealnum:p,entityFrozenAssetPrealnum:l,possessorAddress:e.recipientId,purchaseAssetPrealnum:f,status:0}})})}};co=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,It])],co);let du=class extends co{async verifyTransactionBody(e,t,r=this.configHelper){await this.commonVerifyTransactionBody(e,t,r)}init(e,t){return Qp.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ve(n=>{const{senderId:s,recipientId:o,senderPublicKeyBuffer:a,fee:p}=e,l=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=t.emit("fee",{type:"fee",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:l,amount:"-"+p,sourceAmount:p}});const{sourceChainName:f,sourceChainMagic:g,factoryId:d,entityPrealnum:y,entityFrozenAssetPrealnum:m,purchaseAssetPrealnum:E}=e.asset.issueEntityFactory,T=this.transactionHelper.calcDestroyMainAssetsOfIsseuEntityFactory(y,r);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:l,amount:"-"+T,sourceAmount:T}}),n.next=t.emit("destroyMainAsset",{type:"destroyMainAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:l,amount:"-"+T,sourceAmount:T}}),n.next=t.emit("issueEntityFactoryByDestroy",{type:"issueEntityFactoryByDestroy",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,sourceChainName:f,sourceChainMagic:g,factoryId:d,entityPrealnum:y,entityFrozenAssetPrealnum:m,possessorAddress:e.recipientId,purchaseAssetPrealnum:E,status:0}})})}};du=h([j()],du);const{ArgumentIllegalException:yr}=re("CONTROLLER","IssueEntityTransactionFactory");let jg=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.issueEntityFactoryTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new yr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new yr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new yr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new yr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="entityId")throw new yr(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"entityId",...n});const p=t.issueEntity;if(!p)throw new yr(c.PARAM_LOST,{param:"issueEntity"});const l={...n,target:"issueEntityAsset"},{sourceChainName:f,sourceChainMagic:g,entityId:d,entityFactoryPossessor:y,entityFactory:m}=p;if(f!==r.chainName)throw new yr(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${f}`,to_target:"body",be_compare_prop:"local chain name",...n});if(g!==r.magic)throw new yr(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${f}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!y)throw new yr(c.PROP_IS_REQUIRE,{prop:"entityFactoryPossessor",...n});if(!await this.accountBaseHelper.isAddress(y))throw new yr(c.PROP_IS_INVALID,{prop:`entityFactoryPossessor ${y}`,type:"account address",...n,target:"issueEntity"});if(!d)throw new yr(c.PROP_IS_REQUIRE,{prop:"entityId",...l});const E=d.split("_");if(E.length!==2)throw new yr(c.PROP_IS_INVALID,{prop:`entityId ${d}`,...l});if(!s.isValidEntityFactoryId(E[0]))throw new yr(c.PROP_IS_INVALID,{prop:`factoryId ${E[0]}`,...l});const T=E[1].length;if(T<3||T>30)throw new yr(c.NOT_IN_EXPECTED_RANGE,{prop:`entityId ${E[1]}`,type:"string length",min:3,max:30,...l});if(!s.isLowerCaseLetterOrNumber(E[1]))throw new yr(c.PROP_IS_INVALID,{prop:`entityId ${E[1]}`,type:"lowercase or number",...l});if(a.value!==d)throw new yr(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`entityId ${d}`,to_target:"storage",be_target:"issueEntityAsset",...n});if(this.issueEntityFactoryTransactionFactory.verifyIssueEntityFactoryAsset(m),E[0]!==m.factoryId)throw new yr(c.NOT_MATCH,{to_compare_prop:`factoryId ${E[0]}`,be_compare_prop:`factoryId ${m.factoryId}`,to_target:"entityId",be_target:"entityFactory",...n})}init(e,t){return Gh.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:o,senderPublicKeyBuffer:a,signature:p}=e,{sourceChainName:l,sourceChainMagic:f,entityId:g,entityFactoryPossessor:d,entityFactory:y}=e.asset.issueEntity,{factoryId:m,entityFrozenAssetPrealnum:E,purchaseAssetPrealnum:T}=y;n.next=t.emit("issueEntity",{type:"issueEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,sourceChainName:l,sourceChainMagic:f,factoryId:m,entityId:g,possessorAddress:o,entityFactoryPossessorAddress:d,entityFrozenAssetPrealnum:E,issueId:p,status:0}});const w=this.chainAssetInfoHelper.getAssetInfo(this.configHelper.magic,this.configHelper.assetType);if(E!=="0"){const b=this.transactionHelper.getTransactionMinEffectiveHeight(e),C=Number.MAX_SAFE_INTEGER;n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:w,amount:`-${E}`,sourceAmount:E,frozenId:p,minEffectiveHeight:b,maxEffectiveHeight:C,totalUnfrozenTimes:1}})}n.next=this._applyTransactionEmitAsset(t,e,T,{senderId:s,senderPublicKeyBuffer:a,recipientId:d,assetInfo:w})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,entityFrozenAssetPrealnum:n,purchaseAssetPrealnum:s}=e.asset.issueEntity.entityFactory;return t.magic===r&&t.assetType===this.configHelper.assetType?(BigInt(n)+BigInt(s)).toString():"0"}};jg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,co])],jg);const{ArgumentIllegalException:eA}=re("CONTROLLER","IssueEntityTransactionFactory");let yu=class extends jg{async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"issueEntityAsset"},{taxAssetPrealnum:s}=t.issueEntity;if(!s)throw new eA(c.PROP_IS_REQUIRE,{prop:"taxAssetPrealnum",...n});if(!this.baseHelper.isValidAssetPrealnum(s))throw new eA(c.PROP_IS_INVALID,{prop:`taxAssetPrealnum ${s}`,...n})}init(e,t){return Wp.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ve(n=>{const{senderId:s,recipientId:o,senderPublicKeyBuffer:a,signature:p,fee:l}=e,{sourceChainName:f,sourceChainMagic:g,entityId:d,taxAssetPrealnum:y,entityFactoryPossessor:m,entityFactory:E}=e.asset.issueEntity,{factoryId:T,entityFrozenAssetPrealnum:w,purchaseAssetPrealnum:b}=E,C=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);if(n.next=t.emit("fee",{type:"fee",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:C,amount:"-"+l,sourceAmount:l}}),n.next=t.emit("issueEntityV1",{type:"issueEntityV1",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,sourceChainName:f,sourceChainMagic:g,factoryId:T,entityId:d,taxAssetPrealnum:y,possessorAddress:o,entityFactoryPossessorAddress:m,entityFrozenAssetPrealnum:w,issueId:p,status:0}}),w!=="0"){const N=this.transactionHelper.getTransactionMinEffectiveHeight(e),O=Number.MAX_SAFE_INTEGER;n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:C,amount:`-${w}`,sourceAmount:w,frozenId:p,minEffectiveHeight:N,maxEffectiveHeight:O,totalUnfrozenTimes:1}})}n.next=this._applyTransactionEmitAsset(t,e,b,{senderId:s,senderPublicKeyBuffer:a,recipientId:m,assetInfo:C})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,entityFrozenAssetPrealnum:n,purchaseAssetPrealnum:s}=e.asset.issueEntity.entityFactory;return t.magic===r&&t.assetType===this.configHelper.assetType?(BigInt(n)+BigInt(s)).toString():"0"}};yu=h([j()],yu);const{ArgumentIllegalException:or}=re("CONTROLLER","DestroyEntityTransactionFactory");let Jg=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.issueEntityFactoryTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new or(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new or(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new or(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new or(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="entityId")throw new or(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"entityId",...n});const o=t.destroyEntity;if(!o)throw new or(c.PARAM_LOST,{param:"destroyEntity"});const a={...n,target:"destroyAssetAsset"},{sourceChainMagic:p,sourceChainName:l,entityId:f,entityFactoryApplicant:g,entityFactoryPossessor:d,entityFactory:y,transactionSignature:m}=o;if(l!==r.chainName)throw new or(c.SHOULD_BE,{to_compare_prop:"sourceChainName",to_target:"body",be_compare_prop:"local chain name",...a});if(p!==r.magic)throw new or(c.SHOULD_BE,{to_compare_prop:"sourceChainMagic",to_target:"body",be_compare_prop:"local chain magic",...a});const E=this.baseHelper;if(!f)throw new or(c.PROP_IS_REQUIRE,{prop:"entityId",...a});if(!E.isValidEntityId(f))throw new or(c.PROP_IS_INVALID,{prop:`entityId ${f}`,type:"entityId",...a});if(s.value!==f)throw new or(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`entityId ${f}`,to_target:"storage",be_target:"destroyEntity",...n});if(!d)throw new or(c.PROP_IS_REQUIRE,{prop:"entityFactoryPossessor",...n});if(!await this.accountBaseHelper.isAddress(d))throw new or(c.PROP_IS_INVALID,{prop:`entityFactoryPossessor ${d}`,type:"account address",...n,target:"destroyEntity"});if(!g)throw new or(c.PROP_IS_REQUIRE,{prop:"entityFactoryApplicant",...n});if(!await this.accountBaseHelper.isAddress(g))throw new or(c.PROP_IS_INVALID,{prop:`entityFactoryApplicant ${g}`,type:"account address",...n,target:"destroyEntity"});this.issueEntityFactoryTransactionFactory.verifyIssueEntityFactoryAsset(y);const T=this.transactionHelper.getFactoryIdByEntityId(f);if(T!==y.factoryId)throw new or(c.NOT_MATCH,{to_compare_prop:`factoryId ${T}`,be_compare_prop:`factoryId ${y.factoryId}`,to_target:"entityId",be_target:"entityFactory",...n});if(!m)throw new or(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...a});if(!E.isValidTransactionSignature(m))throw new or(c.PROP_IS_INVALID,{prop:`transactionSignature ${m}`,type:"transaction signature",...a})}init(e,t){return qp.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:o,recipientId:a}=e,{sourceChainMagic:p,sourceChainName:l,entityId:f,entityFactoryApplicant:g,entityFactoryPossessor:d,entityFactory:y,transactionSignature:m}=e.asset.destroyEntity;n.next=t.emit("destroyEntity",{type:"destroyEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,sourceChainMagic:p,sourceChainName:l,entityId:f,entityFactoryApplicantAddress:g,entityFactoryPossessorAddress:d,entityFactory:y.toJSON(),frozenId:m,status:255}});const E=y.entityFrozenAssetPrealnum;if(E!=="0"){const T=this.chainAssetInfoHelper.getAssetInfo(this.configHelper.magic,this.configHelper.assetType);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:e.senderId,publicKeyBuffer:e.senderPublicKeyBuffer,assetInfo:T,amount:E,sourceAmount:E,frozenId:m,recipientId:a}})}})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{sourceChainMagic:r,entityFactory:n}=e.asset.destroyEntity;return t.magic===r&&t.assetType===this.configHelper.assetType?n.entityFrozenAssetPrealnum:"0"}};Jg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,co])],Jg);const{ArgumentIllegalException:Tt}=re("CONTROLLER","ToExchangeAnyTransactionFactory");let Ll=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new Tt(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Tt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Tt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic"});const s=t.toExchangeAny;if(await this.verifyToExchangeAny(s,r),s.toExchangeAssetPrealnum==="0")throw new Tt(c.PROP_SHOULD_GT_FIELD,{prop:"toExchangeAssetPrealnum",field:"0",target:"toExchangeAny"});if(e.storage)throw new Tt(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}async verifyToExchangeAny(e,t=this.configHelper){const{baseHelper:r}=this;if(!e)throw new Tt(c.PARAM_LOST,{param:"toExchangeAny"});const n={target:"toExchangeAnyAsset"},s=e.cipherPublicKeys,o=new Set(s);if(s.length!==o.size)throw new Tt(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",...n});if(!r.isValidCipherPublicKeys(s))throw new Tt(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",...n});const{toExchangeParentAssetType:a,toExchangeAssetType:p,beExchangeParentAssetType:l,beExchangeAssetType:f}=e;this.checkParentAssetType(a,"toExchangeParentAssetType",n),this.checkParentAssetType(l,"beExchangeParentAssetType",n),e.toExchangeSource===this.configHelper.magic&&(this.checkChainName(e.toExchangeChainName,"toExchangeChainName",n),this.checkChainMagic(e.toExchangeSource,"toExchangeSource",n),this.checkAssetType(a,p,"toExchangeAssetType",n)),e.beExchangeSource===this.configHelper.magic&&(this.checkChainName(e.beExchangeChainName,"beExchangeChainName",n),this.checkChainMagic(e.beExchangeSource,"beExchangeSource",n),this.checkAssetType(l,f,"beExchangeAssetType",n));const{toExchangeAssetPrealnum:g,beExchangeAssetPrealnum:d,assetExchangeWeightRatio:y,taxInformation:m}=e;if(!g)throw new Tt(c.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...n});if(!r.isValidAssetNumber(g))throw new Tt(c.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...n});if(p===f)throw new Tt(c.SHOULD_NOT_BE,{to_compare_prop:`toExchangeAssetType ${p}`,to_target:"toExchangeAny",be_compare_prop:f});if(a===L.ASSETS)if(l===L.ASSETS){if(d)throw new Tt(c.SHOULD_NOT_EXIST,{prop:"beExchangeAssetPrealnum",...n});if(!y)throw new Tt(c.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",...n});if(!r.isValidAssetExchangeWeightRatio(y))throw new Tt(c.PROP_IS_INVALID,{prop:`assetExchangeWeightRatio ${JSON.stringify(y)}`,...n})}else{if(!d)throw new Tt(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...n});if(d!=="1")throw new Tt(c.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${d}`,to_target:"toExchangeAnyAsset",be_compare_prop:"1"});if(y)throw new Tt(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...n})}else{if(g!=="1")throw new Tt(c.SHOULD_BE,{to_compare_prop:`toExchangeAssetPrealnum ${g}`,to_target:"toExchangeAnyAsset",be_compare_prop:"1",...n});if(!d)throw new Tt(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...n});if(y)throw new Tt(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...n});if(!r.isValidAssetNumber(d))throw new Tt(c.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...n});if(l===L.ASSETS){if(d==="0")throw new Tt(c.PROP_SHOULD_GT_FIELD,{prop:"beExchangeAssetPrealnum",field:"0",...n})}else if(d!=="1")throw new Tt(c.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${d}`,to_target:"toExchangeAnyAsset",be_compare_prop:"1"})}if(a===L.ENTITY)await this.checkTaxInformation(n,m);else if(m)throw new Tt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...n})}init(e,t){return tl.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:o,signature:a}=e,{toExchangeChainName:p,toExchangeSource:l,toExchangeParentAssetType:f,toExchangeAssetType:g,toExchangeAssetPrealnum:d,taxInformation:y}=e.asset.toExchangeAny;if(f===L.ASSETS){const m=this.chainAssetInfoHelper.getAssetInfo(l,g);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:m,amount:`-${d}`,sourceAmount:d,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:a}})}else if(f===L.DAPP)n.next=t.emit("frozenDApp",{type:"frozenDApp",transaction:e,applyInfo:{address:s,sourceChainName:p,sourceChainMagic:l,dappid:g,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}});else if(f===L.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:s,sourceChainName:p,sourceChainMagic:l,name:g,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}});else if(f===L.ENTITY){if(n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:s,sourceChainName:p,sourceChainMagic:l,entityId:g,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}}),y){n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:p,sourceChainMagic:l,parentAssetType:f,assetType:g,taxInformation:y.toJSON()}});const{taxAssetPrealnum:m}=y;if(m!=="0"){const E=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:E,amount:`-${m}`,sourceAmount:m,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:a}})}}}else if(f===L.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:s,sourceChainName:p,sourceChainMagic:l,certificateId:g,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}});else throw new Tt(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${f}`,target:"transaction.asset.toExchangeAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeSource:s,toExchangeAssetType:o,toExchangeAssetPrealnum:a}=e.asset.toExchangeAny;return r===s&&n===o?a:"0"}};Ll=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Ll);const{ArgumentIllegalException:Mt}=re("CONTROLLER","BeExchangeAnyTransactionFactory");let mu=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.toExchangeAnyTransactionFactory=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Mt(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Mt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Mt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Mt(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="transactionSignature")throw new Mt(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const p=t.beExchangeAny;if(!p)throw new Mt(c.PARAM_LOST,{param:"beExchangeAny"});const l={...n,target:"beExchangeAny"},{transactionSignature:f}=p;if(!f)throw new Mt(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...l});if(!s.isValidSignature(f))throw new Mt(c.PROP_IS_INVALID,{prop:`transactionSignature ${f}`,type:"transaction signature",...l});if(a.value!==f)throw new Mt(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`transactionSignature ${f}`,to_target:"storage",be_target:"beExchangeAny",...n});const{toExchangeAssetPrealnum:g,beExchangeAssetPrealnum:d}=p;if(!g)throw new Mt(c.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...l});if(!s.isValidAssetNumber(g))throw new Mt(c.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",type:"asset prealnum",...l});if(!d)throw new Mt(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...l});if(!s.isValidAssetNumber(d))throw new Mt(c.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",type:"asset prealnum",...l});const{exchangeAny:y,ciphertextSignature:m}=p;await this.toExchangeAnyTransactionFactory.verifyToExchangeAny(y);const{beExchangeParentAssetType:E}=y;if(BigInt(g)>BigInt(y.toExchangeAssetPrealnum))throw new Mt(c.PROP_SHOULD_LTE_FIELD,{prop:`toExchangeAssetPrealnum ${g}`,field:y.toExchangeAssetPrealnum,...l});if(E===L.ENTITY)await this.checkTaxInformation(l,p.taxInformation);else if(p.taxInformation)throw new Mt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...l});const{cipherPublicKeys:T}=y;if(T.length>0){if(!m)throw new Mt(c.NOT_EXIST,{prop:`ciphertextSignature ${m}`,...l});if(!s.isValidAccountSignature(m))throw new Mt(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${m}`,...l});const{signature:w,publicKey:b}=m;if(!T.includes(b))throw new Mt(c.NOT_MATCH,{to_compare_prop:`publicKey ${b}`,be_compare_prop:"cipherPublicKeys",to_target:"ciphertextSignature",be_target:"cipherPublicKeys",...l});if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:he(b),ciphertextSignatureBuffer:he(w),transactionSignatureBuffer:he(f),senderId:e.senderId}))throw new Mt(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${w}`,type:"signature",...l})}else if(m)throw new Mt(c.SHOULD_NOT_EXIST,{prop:`ciphertextSignature ${m}`,...l})}init(e,t){return rl.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:o,senderPublicKeyBuffer:a}=e,{exchangeAny:p,toExchangeAssetPrealnum:l,beExchangeAssetPrealnum:f,taxInformation:g,transactionSignature:d}=e.asset.beExchangeAny,{toExchangeChainName:y,toExchangeSource:m,toExchangeParentAssetType:E,toExchangeAssetType:T,beExchangeChainName:w,beExchangeSource:b,beExchangeParentAssetType:C,beExchangeAssetType:N}=p;if(E===L.ASSETS){const O=this.chainAssetInfoHelper.getAssetInfo(m,T);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:O,amount:l,sourceAmount:l,frozenId:d,recipientId:o}})}else{let O=s;if(l==="0"&&(O=o),E===L.DAPP)n.next=t.emit("unfrozenDApp",{type:"unfrozenDApp",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:O,sourceChainName:y,sourceChainMagic:m,dappid:T,status:0,frozenId:d}});else if(E===L.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:O,sourceChainName:y,sourceChainMagic:m,name:T,status:0,frozenId:d}});else if(E===L.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:O,sourceChainName:y,sourceChainMagic:m,entityId:T,status:0,frozenId:d}}),p.taxInformation){const{taxCollector:R,taxAssetPrealnum:F}=p.taxInformation;if(F==="0"){const z=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,F,{senderId:s,senderPublicKeyBuffer:a,recipientId:R,assetInfo:z})}else{const z=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:R,publicKeyBuffer:a,assetInfo:z,amount:F,sourceAmount:F,frozenId:d,recipientId:o}})}}}else if(E===L.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:O,sourceChainName:y,sourceChainMagic:m,certificateId:T,status:0,frozenId:d}});else throw new Mt(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${E}`,target:"transaction.asset.beExchangeAny.exchangeAny"})}if(C===L.ENTITY&&g&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:w,sourceChainMagic:b,parentAssetType:C,assetType:N,taxInformation:g.toJSON()}})),f==="0"){if(g){const O=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,"0",{senderId:s,senderPublicKeyBuffer:a,recipientId:g.taxCollector,assetInfo:O})}return}if(C===L.ASSETS){const O=this.chainAssetInfoHelper.getAssetInfo(b,N);n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:O,amount:`-${f}`,sourceAmount:f}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:o,assetInfo:O,amount:f,sourceAmount:f}})}else if(C===L.DAPP)n.next=t.emit("changeDAppPossessor",{type:"changeDAppPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:w,sourceChainMagic:b,dappid:N}});else if(C===L.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:w,sourceChainMagic:b,name:N}});else if(C===L.ENTITY){if(n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:w,sourceChainMagic:b,entityId:N}}),g){const O=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,g.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:a,recipientId:g.taxCollector,assetInfo:O})}}else if(C===L.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:w,sourceChainMagic:b,certificateId:N}});else throw new Mt(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${C}`,target:"transaction.asset.beExchangeAny.exchangeAny"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{exchangeAny:s,toExchangeAssetPrealnum:o,beExchangeAssetPrealnum:a}=e.asset.beExchangeAny,{toExchangeSource:p,beExchangeSource:l,toExchangeAssetType:f,beExchangeAssetType:g}=s;return r===p&&n===f?o:r===l&&n===g?a:"0"}};mu=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,Ll])],mu);const{ArgumentIllegalException:vt}=re("CONTROLLER","IssueEntityMultiTransactionV1");let _u=class extends Ke{constructor(e,t,r,n,s,o,a){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=o,this.issueEntityFactoryTransactionFactory=a}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new vt(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new vt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new vt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new vt(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="factoryId")throw new vt(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"factoryId",...n});const p=t.issueEntityMulti;if(!p)throw new vt(c.PARAM_LOST,{param:"issueEntityMulti"});const l={...n,target:"issueEntityMultiAsset"},{sourceChainName:f,sourceChainMagic:g,entityStructList:d,entityFactoryPossessor:y,entityFactory:m}=p;if(this.issueEntityFactoryTransactionFactory.verifyIssueEntityFactoryAsset(m),f!==r.chainName)throw new vt(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${f}`,to_target:"body",be_compare_prop:"local chain name",...n});if(g!==r.magic)throw new vt(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${f}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!y)throw new vt(c.PROP_IS_REQUIRE,{prop:"entityFactoryPossessor",...n});if(!await this.accountBaseHelper.isAddress(y))throw new vt(c.PROP_IS_INVALID,{prop:`entityFactoryPossessor ${y}`,type:"account address",...n,target:"issueEntityMulti"});const E=d.length;if(!(s.isArray(d)&&E>0))throw new vt(c.PROP_IS_INVALID,{prop:`entityStructList ${JSON.stringify(d)}`,...n,target:"issueEntityMulti"});const T=m.factoryId,w=new Set;for(const{entityId:b,taxAssetPrealnum:C}of d){if(!b)throw new vt(c.PROP_IS_REQUIRE,{prop:"entityId",...l});w.add(b);const N=b.split("_");if(N.length!==3)throw new vt(c.PROP_IS_INVALID,{prop:`entityId ${b}`,target:"issueEntityMulti.entityStructList"});if(N[0]!=="m")throw new vt(c.SHOULD_BE,{to_compare_prop:`entityId first item ${N[0]}`,be_compare_prop:"m",to_target:"issueEntityMulti.entityStructList"});if(!s.isValidEntityFactoryId(N[1]))throw new vt(c.PROP_IS_INVALID,{prop:`factoryId ${N[0]}`,target:"issueEntityMulti.entityStructList"});if(N[1]!==T)throw new vt(c.NOT_MATCH,{to_compare_prop:`factoryId ${N[1]}`,be_compare_prop:`factoryId ${T}`,to_target:"entityId",be_target:"entityFactory",...n});const O=N[2].length;if(O<3||O>30)throw new vt(c.NOT_IN_EXPECTED_RANGE,{prop:`entityId ${N[2]}`,min:3,max:30,target:"issueEntityMulti.entityStructList"});if(!s.isLowerCaseLetterOrNumber(N[2]))throw new vt(c.PROP_IS_INVALID,{prop:`entityId ${N[2]}`,target:"issueEntityMulti.entityStructList"});if(!C)throw new vt(c.PROP_IS_REQUIRE,{prop:"taxAssetPrealnum",target:"issueEntityMulti.entityStructList"});if(!this.baseHelper.isValidAssetPrealnum(C))throw new vt(c.PROP_IS_INVALID,{prop:`taxAssetPrealnum ${C}`,target:`issueEntityMulti.entityStructList ${b}`})}if(w.size<E)throw new vt(c.SHOULD_NOT_DUPLICATE,{prop:`entityStructList ${JSON.stringify(d)}`,target:"issueEntityMulti"});if(a.value!==T)throw new vt(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`factoryId ${T}`,to_target:"storage",be_target:"issueEntityMultiAsset",...n})}init(e,t){return nl.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){return Ve(n=>{const{senderId:s,recipientId:o,senderPublicKeyBuffer:a,signature:p,fee:l}=e,{sourceChainName:f,sourceChainMagic:g,entityStructList:d,entityFactoryPossessor:y,entityFactory:m}=e.asset.issueEntityMulti,{factoryId:E,entityFrozenAssetPrealnum:T,purchaseAssetPrealnum:w}=m,b=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=t.emit("fee",{type:"fee",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:b,amount:"-"+l,sourceAmount:l}}),n.next=t.emit("issueEntityMultiV1",{type:"issueEntityMultiV1",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,sourceChainName:f,sourceChainMagic:g,factoryId:E,entityStructList:d,possessorAddress:o,entityFactoryPossessorAddress:y,entityFrozenAssetPrealnum:T,issueId:p,status:0}});const C=d.length;if(T!=="0"){const N=(BigInt(T)*BigInt(C)).toString(),O=this.transactionHelper.getTransactionMinEffectiveHeight(e),R=Number.MAX_SAFE_INTEGER;n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:b,amount:`-${N}`,sourceAmount:N,frozenId:p,minEffectiveHeight:O,maxEffectiveHeight:R,totalUnfrozenTimes:C}})}n.next=this._applyTransactionEmitAsset(t,e,(BigInt(w)*BigInt(C)).toString(),{senderId:s,senderPublicKeyBuffer:a,recipientId:y,assetInfo:b})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{entityStructList:r,entityFactory:n}=e.asset.issueEntityMulti,{sourceChainMagic:s,entityFrozenAssetPrealnum:o,purchaseAssetPrealnum:a}=n;if(t.magic===s&&t.assetType===this.configHelper.assetType){const p=r.length;return(BigInt(o)*BigInt(p)+BigInt(a)*BigInt(p)).toString()}return"0"}};_u=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,It,co])],_u);const{ArgumentIllegalException:ut}=re("CONTROLLER","ToExchangeAnyMultiTransactionFactory");let Au=class extends Ke{constructor(e,t,r,n,s,o){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new ut(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ut(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ut(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});const s=t.toExchangeAnyMulti;if(!s)throw new ut(c.PARAM_LOST,{param:"toExchangeAnyMulti",...n});const o=s.cipherPublicKeys,a=new Set(o);if(o.length!==a.size)throw new ut(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",target:"toExchangeAnyMulti"});if(!this.baseHelper.isValidCipherPublicKeys(o))throw new ut(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",target:"toExchangeAnyMulti"});const{toExchangeAssets:p,beExchangeAsset:l}=s,f=await this.verifyToExchangeAnyMulti("toExchangeAnyMulti",p,l,r);for(const d of p)if(d.toExchangeAssetPrealnum==="0")throw new ut(c.PROP_SHOULD_GT_FIELD,{prop:"toExchangeAssetPrealnum",field:"0",target:"toExchangeAnyMulti.toExchangeAssets.toExchangeAsset"});const g=l.beExchangeAssetPrealnum;if(f){if(l.beExchangeParentAssetType!==L.ASSETS){if(g!=="1")throw new ut(c.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${g}`,to_target:"toExchangeAnyMulti.beExchangeAsset",be_compare_prop:"1"})}else if(g==="0")throw new ut(c.PROP_SHOULD_GT_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,target:"toExchangeAnyMulti.beExchangeAsset",field:"0"})}else if(g)throw new ut(c.SHOULD_NOT_EXIST,{prop:"beExchangeAssetPrealnum",target:"toExchangeAnyMulti.beExchangeAsset"});if(e.storage)throw new ut(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}async verifyToExchangeAnyMulti(e,t,r,n=this.configHelper){const{baseHelper:s}=this;if(!t)throw new ut(c.PARAM_LOST,{param:`${e}.toExchangeAssets`});if(!r)throw new ut(c.PARAM_LOST,{param:`${e}.beExchangeAsset`});if(t.length<=0)throw new ut(c.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"toExchangeAssets",target:e,field:0});const{beExchangeChainName:o,beExchangeSource:a,beExchangeParentAssetType:p,beExchangeAssetType:l,beExchangeAssetPrealnum:f}=r,g={target:`${e}.beExchangeAsset`},d=this.configHelper.magic;this.checkParentAssetType(p,"beExchangeParentAssetType",g),a===d&&(this.checkChainName(o,"beExchangeChainName",g),this.checkChainMagic(a,"beExchangeSource",g),this.checkAssetType(p,l,"beExchangeAssetType",g));let y=!1,m=new Set;const E={target:`${e}.toExchangeAssets.toExchangeAsset`};for(const T of t){const{toExchangeChainName:w,toExchangeSource:b,toExchangeParentAssetType:C,toExchangeAssetType:N,toExchangeAssetPrealnum:O,assetExchangeWeightRatio:R,taxInformation:F}=T;if(m.has(N))throw new ut(c.SHOULD_NOT_DUPLICATE,{prop:`toExchangeAssets ${JSON.stringify(t)}`,target:e});if(m.add(N),this.checkParentAssetType(C,"toExchangeParentAssetType",E),b===d&&(this.checkChainName(w,"toExchangeChainName",E),this.checkChainMagic(b,"toExchangeSource",E),this.checkAssetType(C,N,"toExchangeAssetType",E)),!O)throw new ut(c.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...E});if(!s.isValidAssetNumber(O))throw new ut(c.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...E});if(C===L.ENTITY)await this.checkTaxInformation(E,F);else if(F)throw new ut(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...E});if(C!==L.ASSETS){if(y=!0,O!=="1")throw new ut(c.SHOULD_BE,{to_compare_prop:`toExchangeAssetPrealnum ${O}`,to_target:"toExchangeAnyMulti.toExchangeAssets",be_compare_prop:"1"});if(R)throw new ut(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...E})}else if(p===L.ASSETS){if(!R)throw new ut(c.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",...E});if(!s.isValidAssetExchangeWeightRatio(R))throw new ut(c.PROP_IS_INVALID,{prop:`assetExchangeWeightRatio ${R}`,...E})}else{if(R)throw new ut(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...E});y=!0}}if(m.has(l))throw new ut(c.SHOULD_NOT_BE,{to_compare_prop:`beExchangeAssetType ${l}`,to_target:"toExchangeAsset",be_compare_prop:l});if(y){if(!f)throw new ut(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...g});if(!s.isValidAssetNumber(f))throw new ut(c.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...g})}if(p===L.ENTITY)await this.checkTaxInformation(g,r.taxInformation);else if(r.taxInformation)throw new ut(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:`${e}.toExchangeAssets.beExchangeAsset`});return y}init(e,t){return sl.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:o,signature:a}=e,{toExchangeAssets:p,beExchangeAsset:l}=e.asset.toExchangeAnyMulti;let f=BigInt(0);for(const g of p){const{toExchangeSource:d,toExchangeChainName:y,toExchangeParentAssetType:m,toExchangeAssetType:E,toExchangeAssetPrealnum:T,taxInformation:w}=g;if(m===L.ASSETS){const b=this.chainAssetInfoHelper.getAssetInfo(d,E);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:b,amount:`-${T}`,sourceAmount:T,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:a}})}else if(m===L.DAPP)n.next=t.emit("frozenDApp",{type:"frozenDApp",transaction:e,applyInfo:{address:s,sourceChainName:y,sourceChainMagic:d,dappid:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}});else if(m===L.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:s,sourceChainName:y,sourceChainMagic:d,name:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}});else if(m===L.ENTITY){if(n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:s,sourceChainName:y,sourceChainMagic:d,entityId:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}}),w){n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:y,sourceChainMagic:d,parentAssetType:m,assetType:E,taxInformation:w.toJSON()}});const{taxAssetPrealnum:b}=w;b!=="0"&&(f+=BigInt(w.taxAssetPrealnum))}}else if(m===L.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:s,sourceChainName:y,sourceChainMagic:d,certificateId:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}});else throw new ut(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${m}`,target:"transaction.asset.toExchangeAnyMulti"})}if(f!==BigInt(0)){const g=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:g,amount:`-${f.toString()}`,sourceAmount:f.toString(),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:a+this.Buffer.from("_entity").toString("hex")}})}l.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:l.beExchangeChainName,sourceChainMagic:l.beExchangeSource,parentAssetType:l.beExchangeParentAssetType,assetType:l.beExchangeAssetType,taxInformation:l.taxInformation.toJSON()}}))})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,s=e.asset.toExchangeAnyMulti.toExchangeAssets;for(const o of s){const{toExchangeSource:a,toExchangeAssetType:p,toExchangeAssetPrealnum:l}=o;if(r===a&&n===p)return l}return"0"}};Au=h([j(),Oe(0,J("Buffer")),u("design:paramtypes",[Object,de,me,Pe,te,ke])],Au);const{ArgumentIllegalException:ct}=re("CONTROLLER","BeExchangeAnyMultiTransactionFactory");let Eu=class extends Ke{constructor(e,t,r,n,s,o){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=o}async verifyToExchangeAnyMulti(e,t,r,n=this.configHelper){const{baseHelper:s}=this;if(!t)throw new ct(c.PARAM_LOST,{param:`${e}.toExchangeAssets`});if(!r)throw new ct(c.PARAM_LOST,{param:`${e}.beExchangeAsset`});if(t.length<=0)throw new ct(c.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"toExchangeAssets",target:e,field:0});const{beExchangeChainName:o,beExchangeSource:a,beExchangeParentAssetType:p,beExchangeAssetType:l,beExchangeAssetPrealnum:f}=r,g={target:`${e}.beExchangeAsset`},d=this.configHelper.magic;this.checkParentAssetType(p,"beExchangeParentAssetType",g),a===d&&(this.checkChainName(o,"beExchangeChainName",g),this.checkChainMagic(a,"beExchangeSource",g),this.checkAssetType(p,l,"beExchangeAssetType",g));let y=!1,m=new Set;const E={target:`${e}.toExchangeAssets.toExchangeAsset`};for(const T of t){const{toExchangeChainName:w,toExchangeSource:b,toExchangeParentAssetType:C,toExchangeAssetType:N,toExchangeAssetPrealnum:O,assetExchangeWeightRatio:R,taxInformation:F}=T;if(m.has(N))throw new ct(c.SHOULD_NOT_DUPLICATE,{prop:`toExchangeAssets ${JSON.stringify(t)}`,target:e});if(m.add(N),this.checkParentAssetType(C,"toExchangeParentAssetType",E),b===d&&(this.checkChainName(w,"toExchangeChainName",E),this.checkChainMagic(b,"toExchangeSource",E),this.checkAssetType(C,N,"toExchangeAssetType",E)),!O)throw new ct(c.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...E});if(!s.isValidAssetNumber(O))throw new ct(c.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...E});if(C===L.ENTITY)await this.checkTaxInformation(E,F);else if(F)throw new ct(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...E});if(C!==L.ASSETS){if(y=!0,R)throw new ct(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...E});if(p!==L.ASSETS&&l===N)throw new ct(c.SHOULD_NOT_BE,{to_compare_prop:`beExchangeAssetType ${l}`,to_target:"toExchangeAnyMulti.beExchangeAsset",be_compare_prop:N})}else if(p===L.ASSETS){if(!R)throw new ct(c.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",...E});if(!s.isValidAssetExchangeWeightRatio(R))throw new ct(c.PROP_IS_INVALID,{prop:`assetExchangeWeightRatio ${R}`,...E})}else{if(R)throw new ct(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",...E});y=!0}}if(y){if(!f)throw new ct(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...g});if(!s.isValidAssetNumber(f))throw new ct(c.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...g})}return y}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new ct(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ct(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ct(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new ct(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="transactionSignature")throw new ct(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const p=t.beExchangeAnyMulti;if(!p)throw new ct(c.PARAM_LOST,{param:"beExchangeAnyMulti"});const l={...n,target:"beExchangeAnyMulti"},{transactionSignature:f}=p;if(!f)throw new ct(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...l});if(!s.isValidSignature(f))throw new ct(c.PROP_IS_INVALID,{prop:`transactionSignature ${f}`,type:"transaction signature",...l});if(a.value!==f)throw new ct(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`transactionSignature ${f}`,to_target:"storage",be_target:"beExchangeAnyMulti",...n});const{toExchangeAssets:g,beExchangeAsset:d,ciphertextSignature:y}=p;await this.verifyToExchangeAnyMulti("beExchangeAnyMulti",g,d,r);const{beExchangeParentAssetType:m,beExchangeAssetPrealnum:E,taxInformation:T}=d;if(!E)throw new ct(c.PROP_IS_REQUIRE,{prop:"beExchangeAsset.beExchangeAssetPrealnum",...l});if(m===L.ENTITY)await this.checkTaxInformation(l,T);else if(T)throw new ct(c.SHOULD_NOT_EXIST,{prop:"beExchangeAsset.taxInformation",...l});if(y){if(!s.isValidAccountSignature(y))throw new ct(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${y}`,...l});const{signature:w,publicKey:b}=y;if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:he(b),ciphertextSignatureBuffer:he(w),transactionSignatureBuffer:he(f),senderId:e.senderId}))throw new ct(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${w}`,type:"signature",...l})}}init(e,t){return il.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:o,senderPublicKeyBuffer:a}=e,{toExchangeAssets:p,beExchangeAsset:l,transactionSignature:f}=e.asset.beExchangeAnyMulti,{beExchangeChainName:g,beExchangeSource:d,beExchangeParentAssetType:y,beExchangeAssetType:m,beExchangeAssetPrealnum:E}=l;let T=0;for(const w of p){const{toExchangeSource:b,toExchangeChainName:C,toExchangeParentAssetType:N,toExchangeAssetType:O,toExchangeAssetPrealnum:R,taxInformation:F}=w;if(N===L.ASSETS){const z=this.chainAssetInfoHelper.getAssetInfo(b,O);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:z,amount:R,sourceAmount:R,frozenId:f,recipientId:o}}),T++}else{let z=s;if(R==="0"&&(z=o),N===L.DAPP)n.next=t.emit("unfrozenDApp",{type:"unfrozenDApp",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:z,sourceChainName:C,sourceChainMagic:b,dappid:O,status:0,frozenId:f}}),T++;else if(N===L.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:z,sourceChainName:C,sourceChainMagic:b,name:O,status:0,frozenId:f}}),T++;else if(N===L.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:z,sourceChainName:C,sourceChainMagic:b,entityId:O,status:0,frozenId:f}}),T++,F){const{taxCollector:K,taxAssetPrealnum:B}=F;if(B==="0"){const M=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,B,{senderId:s,senderPublicKeyBuffer:a,recipientId:K,assetInfo:M})}else{const M=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:K,assetInfo:M,amount:B,sourceAmount:B,frozenId:f+this.Buffer.from("_entity").toString("hex"),recipientId:o}})}}}else if(N===L.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:z,sourceChainName:C,sourceChainMagic:b,certificateId:O,status:0,frozenId:f}});else throw new ct(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${N}`,target:"transaction.asset.beExchangeAnyMulti.toExchangeAsset"})}}if(y===L.ENTITY&&l.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:g,sourceChainMagic:d,parentAssetType:y,assetType:m,taxInformation:l.taxInformation.toJSON()}})),E==="0"){if(l.taxInformation){const w=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,"0",{senderId:s,senderPublicKeyBuffer:a,recipientId:l.taxInformation.taxCollector,assetInfo:w})}return}if(y===L.ASSETS){const w=this.chainAssetInfoHelper.getAssetInfo(d,m),b=(BigInt(E)*BigInt(T)).toString();n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:w,amount:`-${b}`,sourceAmount:b}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:o,assetInfo:w,amount:b,sourceAmount:b}})}else if(y===L.DAPP)n.next=t.emit("changeDAppPossessor",{type:"changeDAppPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:g,sourceChainMagic:d,dappid:m}});else if(y===L.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:g,sourceChainMagic:d,name:m}});else if(y===L.ENTITY){if(n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:g,sourceChainMagic:d,entityId:m}}),l.taxInformation){const w=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,l.taxInformation.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:a,recipientId:l.taxInformation.taxCollector,assetInfo:w})}}else if(y===L.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:g,sourceChainMagic:d,certificateId:m}});else throw new ct(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${y}`,target:"transaction.asset.beExchangeAnyMulti.beExchangeAsset"})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeAssets:s,beExchangeAsset:o}=e.asset.beExchangeAnyMulti;for(const a of s){const{toExchangeSource:p,toExchangeAssetType:l,toExchangeAssetPrealnum:f}=a;if(r===p&&n===l)return f}return r===o.beExchangeSource&&n===o.beExchangeAssetType?o.beExchangeAssetPrealnum:"0"}};Eu=h([j(),Oe(0,J("Buffer")),u("design:paramtypes",[Object,de,me,Pe,te,ke])],Eu);const{ArgumentIllegalException:St}=re("CONTROLLER","ToExchangeAnyMultiAllTransactionFactory");let Iu=class extends Ke{constructor(e,t,r,n,s,o){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=o}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(e.recipientId)throw new St(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new St(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new St(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});const s=t.toExchangeAnyMultiAll;if(!s)throw new St(c.PARAM_LOST,{param:"toExchangeAnyMultiAll",...n});const o=s.cipherPublicKeys,a=new Set(o);if(o.length!==a.size)throw new St(c.SHOULD_NOT_DUPLICATE,{prop:"cipherPublicKeys",target:"toExchangeAnyMultiAll"});if(!this.baseHelper.isValidCipherPublicKeys(o))throw new St(c.PROP_IS_INVALID,{prop:"cipherPublicKeys",target:"toExchangeAnyMultiAll"});const{toExchangeAssets:p,beExchangeAssets:l}=s;await this.verifyExchangeAnyMultiAll("toExchangeAnyMultiAll",p,l,r);for(const{beExchangeParentAssetType:f,beExchangeAssetPrealnum:g}of l)if(f===L.ASSETS){if(g==="0")throw new St(c.PROP_SHOULD_GT_FIELD,{prop:"beExchangeAssetPrealnum",field:"0",target:"toExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}else if(g!=="1")throw new St(c.SHOULD_BE,{to_compare_prop:`beExchangeAssetPrealnum ${g}`,to_target:"toExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset",be_compare_prop:"1"});if(e.storage)throw new St(c.SHOULD_NOT_EXIST,{prop:"storage",...n})}async verifyExchangeAnyMultiAll(e,t,r,n=this.configHelper){const{baseHelper:s}=this;if(!t)throw new St(c.PARAM_LOST,{param:`${e}.toExchangeAssets`});if(!r)throw new St(c.PARAM_LOST,{param:`${e}.beExchangeAssets`});if(t.length<=0)throw new St(c.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"toExchangeAssets",target:e,field:0});if(r.length<=0)throw new St(c.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"beExchangeAssets",target:e,field:0});const o=this.configHelper.magic,a=new Set,p={target:`${e}.toExchangeAssets.toExchangeAsset`};for(const g of t){const{toExchangeChainName:d,toExchangeSource:y,toExchangeParentAssetType:m,toExchangeAssetType:E,toExchangeAssetPrealnum:T,taxInformation:w}=g,b=`${y}-${E}`;if(a.has(b))throw new St(c.SHOULD_NOT_DUPLICATE,{prop:`toExchangeAssets.toExchangeAsset ${JSON.stringify(g)}`,target:e});if(a.add(b),this.checkParentAssetType(m,"toExchangeParentAssetType",p),y===o&&(this.checkChainName(d,"toExchangeChainName",p),this.checkChainMagic(y,"toExchangeSource",p),this.checkAssetType(m,E,"toExchangeAssetType",p)),!T)throw new St(c.PROP_IS_REQUIRE,{prop:"toExchangeAssetPrealnum",...p});if(!s.isValidAssetNumber(T))throw new St(c.PROP_IS_INVALID,{prop:"toExchangeAssetPrealnum",...p});if(m===L.ENTITY)await this.checkTaxInformation(p,w);else if(w)throw new St(c.SHOULD_NOT_EXIST,{prop:"taxInformation",...p});if(m===L.ASSETS){if(T==="0")throw new St(c.PROP_SHOULD_GT_FIELD,{prop:"toExchangeAssetPrealnum",field:"0",target:`${e}.toExchangeAssets.toExchangeAsset`})}else if(T!=="1")throw new St(c.SHOULD_BE,{to_compare_prop:`toExchangeAssetPrealnum ${T}`,to_target:`${e}.toExchangeAssets.toExchangeAsset`,be_compare_prop:"1"})}const l={target:`${e}.beExchangeAssets.beExchangeAsset`},f=new Set;for(const g of r){const{beExchangeChainName:d,beExchangeSource:y,beExchangeParentAssetType:m,beExchangeAssetType:E,beExchangeAssetPrealnum:T,taxInformation:w}=g,b=`${y}-${E}`;if(a.has(b))throw new St(c.SHOULD_NOT_BE,{to_compare_prop:`beExchangeAssetType ${E}`,to_target:"toExchangeAnyMultiAll.beExchangeAssets",be_compare_prop:E});if(f.has(b))throw new St(c.SHOULD_NOT_DUPLICATE,{prop:`beExchangeAssets.beExchangeAsset ${JSON.stringify(g)}`,target:e});if(f.add(b),this.checkParentAssetType(m,"beExchangeParentAssetType",l),y===o&&(this.checkChainName(d,"beExchangeChainName",l),this.checkChainMagic(y,"beExchangeSource",l),this.checkAssetType(m,E,"beExchangeAssetType",l)),!T)throw new St(c.PROP_IS_REQUIRE,{prop:"beExchangeAssetPrealnum",...l});if(!s.isValidAssetNumber(T))throw new St(c.PROP_IS_INVALID,{prop:"beExchangeAssetPrealnum",...l});if(m===L.ENTITY)await this.checkTaxInformation(l,w);else if(w)throw new St(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:`${e}.beExchangeAssets.beExchangeAsset`})}}init(e,t){return ol.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:o,signature:a}=e,{toExchangeAssets:p,beExchangeAssets:l}=e.asset.toExchangeAnyMultiAll;let f=BigInt(0);for(const g of p){const{toExchangeSource:d,toExchangeChainName:y,toExchangeParentAssetType:m,toExchangeAssetType:E,toExchangeAssetPrealnum:T,taxInformation:w}=g;if(m===L.ASSETS){const b=this.chainAssetInfoHelper.getAssetInfo(d,E);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:b,amount:`-${T}`,sourceAmount:T,maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:a}})}else if(m===L.DAPP)n.next=t.emit("frozenDApp",{type:"frozenDApp",transaction:e,applyInfo:{address:s,sourceChainName:y,sourceChainMagic:d,dappid:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}});else if(m===L.LOCATION_NAME)n.next=t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:s,sourceChainName:y,sourceChainMagic:d,name:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}});else if(m===L.ENTITY){if(n.next=t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:s,sourceChainName:y,sourceChainMagic:d,entityId:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}}),w){n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:y,sourceChainMagic:d,parentAssetType:m,assetType:E,taxInformation:w.toJSON()}});const{taxAssetPrealnum:b}=w;b!=="0"&&(f+=BigInt(w.taxAssetPrealnum))}}else if(m===L.CERTIFICATE)n.next=t.emit("frozenCertificate",{type:"frozenCertificate",transaction:e,applyInfo:{address:s,sourceChainName:y,sourceChainMagic:d,certificateId:E,minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),status:17,frozenId:a}});else throw new St(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${m}`,target:"toExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}if(f!==BigInt(0)){const g=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,assetInfo:g,amount:`-${f.toString()}`,sourceAmount:f.toString(),maxEffectiveHeight:this.transactionHelper.getTransactionMaxEffectiveHeight(e),minEffectiveHeight:this.transactionHelper.getTransactionMinEffectiveHeight(e),frozenId:a+this.Buffer.from("_entity").toString("hex")}})}for(const g of l)g.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:g.beExchangeChainName,sourceChainMagic:g.beExchangeSource,parentAssetType:g.beExchangeParentAssetType,assetType:g.beExchangeAssetType,taxInformation:g.taxInformation.toJSON()}}))})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,s=e.asset.toExchangeAnyMultiAll.toExchangeAssets;for(const o of s){const{toExchangeSource:a,toExchangeAssetType:p,toExchangeAssetPrealnum:l}=o;if(r===a&&n===p)return l}return"0"}};Iu=h([j(),Oe(0,J("Buffer")),u("design:paramtypes",[Object,de,me,Pe,te,ke])],Iu);const{ArgumentIllegalException:Zr}=re("CONTROLLER","BeExchangeAnyMultiAllTransactionFactory");let Yg=class extends Ke{constructor(e,t,r,n,s,o,a){super(),this.Buffer=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.configHelper=s,this.chainAssetInfoHelper=o,this.toExchangeAnyMultiAllTransactionFactory=a}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(!e.recipientId)throw new Zr(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Zr(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Zr(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new Zr(c.PROP_IS_REQUIRE,{prop:"storage",...n});const a=e.storage;if(a.key!=="transactionSignature")throw new Zr(c.SHOULD_BE,{to_compare_prop:`storage.key ${a.key}`,to_target:"storage",be_compare_prop:"transactionSignature",...n});const p=t.beExchangeAnyMultiAll;if(!p)throw new Zr(c.PARAM_LOST,{param:"beExchangeAnyMultiAll"});const l={...n,target:"beExchangeAnyMultiAll"},{transactionSignature:f}=p;if(!f)throw new Zr(c.PROP_IS_REQUIRE,{prop:"transactionSignature",...l});if(!s.isValidSignature(f))throw new Zr(c.PROP_IS_INVALID,{prop:`transactionSignature ${f}`,type:"transaction signature",...l});if(a.value!==f)throw new Zr(c.NOT_MATCH,{to_compare_prop:`storage.value ${a.value}`,be_compare_prop:`transactionSignature ${f}`,to_target:"storage",be_target:"beExchangeAnyMultiAll",...n});const{toExchangeAssets:g,beExchangeAssets:d,ciphertextSignature:y}=p;if(await this.toExchangeAnyMultiAllTransactionFactory.verifyExchangeAnyMultiAll("beExchangeAnyMultiAll",g,d,r),y){if(!s.isValidAccountSignature(y))throw new Zr(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${y}`,...l});const{signature:m,publicKey:E}=y;if(!await this.transactionHelper.verifyCiphertextSignature({secretPublicKey:he(E),ciphertextSignatureBuffer:he(m),transactionSignatureBuffer:he(f),senderId:e.senderId}))throw new Zr(c.PROP_IS_INVALID,{prop:`ciphertextSignature ${m}`,type:"signature",...l})}}init(e,t){return al.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:o,senderPublicKeyBuffer:a}=e,{toExchangeAssets:p,beExchangeAssets:l,transactionSignature:f}=e.asset.beExchangeAnyMultiAll;for(const g of p){const{toExchangeSource:d,toExchangeChainName:y,toExchangeParentAssetType:m,toExchangeAssetType:E,toExchangeAssetPrealnum:T,taxInformation:w}=g;if(m===L.ASSETS){const b=this.chainAssetInfoHelper.getAssetInfo(d,E);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:b,amount:T,sourceAmount:T,frozenId:f,recipientId:o}})}else{const b=s;if(m===L.DAPP)n.next=t.emit("unfrozenDApp",{type:"unfrozenDApp",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:b,sourceChainName:y,sourceChainMagic:d,dappid:E,status:0,frozenId:f}});else if(m===L.LOCATION_NAME)n.next=t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:b,sourceChainName:y,sourceChainMagic:d,name:E,status:0,frozenId:f}});else if(m===L.ENTITY){if(n.next=t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:b,sourceChainName:y,sourceChainMagic:d,entityId:E,status:0,frozenId:f}}),w){const{taxCollector:C,taxAssetPrealnum:N}=w;if(N==="0"){const O=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,N,{senderId:s,senderPublicKeyBuffer:a,recipientId:C,assetInfo:O})}else{const O=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:C,assetInfo:O,amount:N,sourceAmount:N,frozenId:f+this.Buffer.from("_entity").toString("hex"),recipientId:o}})}}}else if(m===L.CERTIFICATE)n.next=t.emit("unfrozenCertificate",{type:"unfrozenCertificate",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:b,sourceChainName:y,sourceChainMagic:d,certificateId:E,status:0,frozenId:f}});else throw new Zr(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${m}`,target:"beExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}}for(const g of l){const{beExchangeChainName:d,beExchangeSource:y,beExchangeParentAssetType:m,beExchangeAssetType:E,beExchangeAssetPrealnum:T,taxInformation:w}=g;if(m===L.ENTITY&&g.taxInformation&&(n.next=t.emit("payTax",{type:"payTax",transaction:e,applyInfo:{sourceChainName:d,sourceChainMagic:y,parentAssetType:m,assetType:E,taxInformation:g.taxInformation.toJSON()}})),T==="0"){if(g.taxInformation){const b=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,"0",{senderId:s,senderPublicKeyBuffer:a,recipientId:g.taxInformation.taxCollector,assetInfo:b})}continue}if(m===L.ASSETS){const b=this.chainAssetInfoHelper.getAssetInfo(y,E),C=T;n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,assetInfo:b,amount:`-${C}`,sourceAmount:C}}),n.next=t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:o,assetInfo:b,amount:C,sourceAmount:C}})}else if(m===L.DAPP)n.next=t.emit("changeDAppPossessor",{type:"changeDAppPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:d,sourceChainMagic:y,dappid:E}});else if(m===L.LOCATION_NAME)n.next=t.emit("changeLocationNamePossessor",{type:"changeLocationNamePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:d,sourceChainMagic:y,name:E}});else if(m===L.ENTITY){if(n.next=t.emit("changeEntityPossessor",{type:"changeEntityPossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:d,sourceChainMagic:y,entityId:E}}),w){const b=this.chainAssetInfoHelper.getAssetInfo(r.magic,r.assetType);n.next=this._applyTransactionEmitAsset(t,e,w.taxAssetPrealnum,{senderId:s,senderPublicKeyBuffer:a,recipientId:w.taxCollector,assetInfo:b})}}else if(m===L.CERTIFICATE)n.next=t.emit("changeCertificatePossessor",{type:"changeCertificatePossessor",transaction:e,applyInfo:{address:s,publicKeyBuffer:a,possessorAddress:o,sourceChainName:d,sourceChainMagic:y,certificateId:E}});else throw new Zr(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${m}`,target:"beExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){const{magic:r,assetType:n}=t,{toExchangeAssets:s,beExchangeAssets:o}=e.asset.beExchangeAnyMultiAll;for(const a of s){const{toExchangeSource:p,toExchangeAssetType:l,toExchangeAssetPrealnum:f}=a;if(r===p&&n===l)return f}for(const a of o)if(r===a.beExchangeSource&&n===a.beExchangeAssetType)return a.beExchangeAssetPrealnum;return"0"}};Yg=h([j(),Oe(0,J("Buffer")),u("design:paramtypes",[Object,de,me,Pe,te,ke,Iu])],Yg);const{ArgumentIllegalException:mn}=re("CONTROLLER","IssueCertificateTransactionFactory");let Qg=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};this.emptyRangeType(e,n);const{baseHelper:s}=this;if(e.recipientId,!e.recipientId)throw new mn(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new mn(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new mn(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new mn(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="certificateId")throw new mn(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"certificateId",...n});const a=t.issueCertificate;if(!a)throw new mn(c.PARAM_LOST,{param:"issueCertificate"});const p={...n,target:"issueCertificateAsset"},{sourceChainMagic:l,sourceChainName:f,certificateId:g,type:d}=a;if(this.checkChainName(f,"sourceChainName",p),f!==r.chainName)throw new mn(c.SHOULD_BE,{to_compare_prop:`sourceChainName ${f}`,to_target:"body",be_compare_prop:"local chain name",...n});if(this.checkChainMagic(l,"sourceChainMagic",p),l!==r.magic)throw new mn(c.SHOULD_BE,{to_compare_prop:`sourceChainMagic ${f}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!g)throw new mn(c.PROP_IS_REQUIRE,{prop:"certificateId",...p});if(!s.isValidCertificateId(g))throw new mn(c.PROP_IS_INVALID,{prop:`certificateId ${g}`,...p});if(d!==0&&d!==1&&d!==2)throw new mn(c.NOT_MATCH,{to_compare_prop:`type ${d}`,be_compare_prop:"type",to_target:"dapp",be_target:"CERTIFICATE_TYPE"});if(o.value!==g)throw new mn(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`certificateId ${g}`,to_target:"storage",be_target:"issueCertificate",...n})}init(e,t){return cl.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,recipientId:o,senderPublicKeyBuffer:a}=e,{sourceChainName:p,sourceChainMagic:l,certificateId:f,type:g}=e.asset.issueCertificate;n.next=t.emit("issueCertificate",{type:"issueCertificate",transaction:e,applyInfo:{address:s,possessorAddress:o,publicKeyBuffer:a,sourceChainName:p,sourceChainMagic:l,certificateId:f,type:g,status:0,issueId:e.signature}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};Qg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Qg);const{ArgumentIllegalException:is}=re("CONTROLLER","DestroyCertificateTransactionFactory");let Wg=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new is(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new is(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new is(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new is(c.PROP_IS_REQUIRE,{prop:"storage",...n});const o=e.storage;if(o.key!=="certificateId")throw new is(c.SHOULD_BE,{to_compare_prop:`storage.key ${o.key}`,to_target:"storage",be_compare_prop:"certificateId",...n});const a=t.destroyCertificate;if(!a)throw new is(c.PARAM_LOST,{param:"destroyCertificate"});const p={...n,target:"destroyCertificateAsset"},{sourceChainMagic:l,sourceChainName:f,certificateId:g,type:d}=a;if(f!==r.chainName)throw new is(c.SHOULD_BE,{to_compare_prop:"sourceChainName",to_target:"body",be_compare_prop:"local chain name",...p});if(l!==r.magic)throw new is(c.SHOULD_BE,{to_compare_prop:"sourceChainMagic",to_target:"body",be_compare_prop:"local chain magic",...p});if(!this.baseHelper.isValidCertificateId(g))throw new is(c.PROP_IS_INVALID,{prop:`certificateId ${g}`,...p});if(o.value!==g)throw new is(c.NOT_MATCH,{to_compare_prop:`storage.value ${o.value}`,be_compare_prop:`certificateId ${g}`,to_target:"storage",be_target:"destroyCertificate"})}init(e,t){return pl.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:o,recipientId:a}=e,{sourceChainMagic:p,sourceChainName:l,certificateId:f,type:g}=e.asset.destroyCertificate;n.next=t.emit("destroyCertificate",{type:"destroyCertificate",transaction:e,applyInfo:{address:s,possessorAddress:a,publicKeyBuffer:o,sourceChainName:l,sourceChainMagic:p,certificateId:f,status:255}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};Wg=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Wg);const{ArgumentFormatException:gc,OutOfRangeException:KR,ConsensusException:tA,warn:rA}=re("CONTROLLER","transaction");let qn=class{constructor(e,t,r,n,s,o,a,p){this.transactionHelper=e,this.tpowHelper=t,this.accountBaseHelper=r,this.asymmetricHelper=n,this.keypairHelper=s,this.Buffer=o,this.config=a,this.moduleMap=p,this._txFactoryCache=new Map,this.fromJSON=this.recombineTransaction}getTransactionFactory(e){let t=this._txFactoryCache.get(e);return t||(t=Ot(e,this.moduleMap),this._txFactoryCache.set(e,t)),t}getTransactionFactoryFromType(e){const{baseType:t}=this.transactionHelper.parseType(e);return this.getTransactionFactoryFromBaseType(t)}getTransactionFactoryFromBaseType(e){const t=Ar.VF.get(e);if(!t)throw new gc(c.INVALID_BASE_TYPE,{base_type:e});return this.getTransactionFactory(t)}canCreateTransaction(e){return this.transactionHelper.isTransactionInFilter(e)}get abortForbiddenTransaction(){return this.transactionHelper.abortForbiddenTransaction}async createTransactionWithoutSignature(e,t,r,n=this.config){const s=t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e);if(!this.canCreateTransaction(s)){const l=je.VK.get(je.trsTypeToV(s)),f=new tA(c.DISABLED_CREATE_TRANSACTION,{trsName:l});if(this.abortForbiddenTransaction)throw f;rA(f)}const o=this.getTransactionFactory(e);await o.verifyTransactionBody(t,r,n);const a={version:t.version,type:t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e),senderId:t.senderId,senderPublicKey:t.senderPublicKey,senderSecondPublicKey:t.senderSecondPublicKey,recipientId:t.recipientId||void 0,rangeType:t.rangeType,range:t.range,timestamp:t.timestamp,fee:t.fee,remark:t.remark,dappid:t.dappid||void 0,lns:t.lns||void 0,sourceIP:t.sourceIP||void 0,fromMagic:t.fromMagic,toMagic:t.toMagic,applyBlockHeight:t.applyBlockHeight,effectiveBlockHeight:t.effectiveBlockHeight,storage:t.storage,nonce:t.nonce||0};return o.init(a,r)}async createTransaction(e,t,r,n,s,o=this.config,a,p){const l=t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e);if(!this.canCreateTransaction(l)){const y=je.VK.get(je.trsTypeToV(l)),m=new tA(c.DISABLED_CREATE_TRANSACTION,{trsName:y});if(this.abortForbiddenTransaction)throw m;rA(m)}const f=this.getTransactionFactory(e);f.verifyKeypair(n),s&&f.verifySecondKeypair(s),await f.verifyTransactionBody(t,r,o);const g={version:t.version,type:t.type||this.getTransactionTypeFromTransactionFactoryConstructor(e),senderId:t.senderId,senderPublicKey:t.senderPublicKey,senderSecondPublicKey:t.senderSecondPublicKey,recipientId:t.recipientId||void 0,rangeType:t.rangeType,range:t.range,timestamp:t.timestamp,fee:t.fee,remark:t.remark,dappid:t.dappid||void 0,lns:t.lns||void 0,sourceIP:t.sourceIP||void 0,fromMagic:t.fromMagic,toMagic:t.toMagic,applyBlockHeight:t.applyBlockHeight,effectiveBlockHeight:t.effectiveBlockHeight,storage:t.storage,nonce:t.nonce},d=f.init(g,r);return d.signatureBuffer=await this.asymmetricHelper.detachedSign(d.getBytes(!0,!0),n.secretKey),s&&(d.signSignatureBuffer=await this.asymmetricHelper.detachedSign(d.getBytes(!1,!0),s.secretKey)),a&&!p?a.calculator?a.calculator(d,a,n,s):this.transactionPowCalculator(d,a,n,s):d.nonce=0,this.transactionHelper.verifyTransactionSize(d),this.transactionHelper.verifyTransactionBlobSize(d),d}async transactionPowCalculator(e,t,r,n){const s=t.event,o=async(f,g)=>{const d=f?"error":"done";return f||n&&(e.signSignatureBuffer=await this.asymmetricHelper.detachedSign(e.getBytes(!1,!0),n.secretKey)),s&&await s.emit(d,{transaction:e,nonce:g}),e},a=this.tpowHelper.calcDiffOfTransactionProfOfWork(t.count,t.participation);let p=!1,l=0;if(a>BigInt(1)){const f=s&&await s.emit("start",{diff:a.toString(),count:t.count,participation:t.participation,transaction:e});if(f&&f.break)return p=f.break,o(p,l);for(const{uint8array:g,nonce:d,offset:y}of this.tpowHelper.nonceWriter(e)){l=d;const m=await this.asymmetricHelper.detachedSign(g,r.secretKey),E=await this.tpowHelper.checkTransactionProfOfWork(m,t.count,t.participation,a),T=s&&await s.emit("work",{nonce:d,transaction:e,offset:y});if(T&&T.break){e.nonce=d,e.signatureBuffer=m,p=T.break;break}if(E){e.nonce=d,e.signatureBuffer=m;break}}}return o(p,l)}async recombineTransaction(e){return await this.getTransactionFactoryFromType(e.type).fromJSON(e)}recombineTransactionInBlock(e){return Gt.fromObject(e)}parseBytesToTransaction(e){return Ie.decode(e)}parseBytesToSomeTransaction(e){const t=new sn(e);t.uint32(),t.uint32(),t.uint32();const r=t.string();return this.getTransactionModelConstructorFromType(r).decode(e)}getTransactionModelConstructorFromType(e){const{baseType:t}=this.transactionHelper.parseType(e);return this.getTransactionModelConstructorFromBaseType(t)}getTransactionModelConstructorFromBaseType(e){const t=je.VM.get(e);if(!t)throw new gc(c.INVALID_BASE_TYPE,{base_type:e});return t}getTransactionTypeFromTransactionFactoryConstructor(e){const t=Ar.FV.get(e);if(!t)throw new gc(c.UNREGISTERED_TRANSACTION_FACTORY,{factoryName:e.name});const r=Ar.VK.get(t);if(!r)throw new gc(c.UNREGISTERED_TRANSACTION_BASE_TYPE,{trs_base:t});const n=this.transactionHelper[r];if(!n)throw new gc(c.UNREGISTERED_TRANSACTION_TYPE,{trs_key:r});return n}getMoveAmount(e,t={magic:this.config.magic,assetType:this.config.assetType}){return this.getTransactionFactoryFromType(e.type).getMoveAmount(e,t)}};qn=h([j("bfchain-core:TransactionCore"),Oe(4,J("keypairHelper")),Oe(5,J("Buffer")),u("design:paramtypes",[me,Gs,de,$r,Object,Object,te,et])],qn);const Ar=(()=>{const i=new Map,e=new Map;for(const n in H){const s=H[n];e.set(n,s),i.set(s,n)}const t=new Map,r=new Map;return[[H.USERNAME,nu],[H.SIGNATURE,su],[H.DELEGATE,Rg],[H.VOTE,Pg],[H.ACCEPT_VOTE,Bg],[H.REJECT_VOTE,Mg],[H.DAPP,Ml],[H.DAPP_PURCHASING,vg],[H.MARK,Lg],[H.ISSUE_ASSET,Dg],[H.DESTROY_ASSET,cu],[H.TRANSFER_ASSET,ou],[H.TO_EXCHANGE_ASSET,pu],[H.BE_EXCHANGE_ASSET,kg],[H.GIFT_ASSET,hu],[H.GRAB_ASSET,Hg],[H.TRUST_ASSET,fu],[H.SIGN_FOR_ASSET,Fg],[H.EMIGRATE_ASSET,Vg],[H.IMMIGRATE_ASSET,$g],[H.TO_EXCHANGE_SPECIAL_ASSET,gu],[H.BE_EXCHANGE_SPECIAL_ASSET,Ug],[H.LOCATION_NAME,Kg],[H.SET_LNS_RECORD_VALUE,zg],[H.SET_LNS_MANAGER,Gg],[H.ISSUE_ENTITY_FACTORY,co],[H.ISSUE_ENTITY_FACTORY_V1,du],[H.ISSUE_ENTITY,yu],[H.DESTROY_ENTITY,Jg],[H.TRANSFER_ANY,au],[H.GIFT_ANY,vl],[H.GRAB_ANY,uu],[H.TO_EXCHANGE_ANY,Ll],[H.BE_EXCHANGE_ANY,mu],[H.ISSUE_ENTITY_MULTI,_u],[H.TO_EXCHANGE_ANY_MULTI,Au],[H.BE_EXCHANGE_ANY_MULTI,Eu],[H.TO_EXCHANGE_ANY_MULTI_ALL,Iu],[H.BE_EXCHANGE_ANY_MULTI_ALL,Yg],[H.ISSUE_CERTIFICATE,Qg],[H.DESTROY_CERTIFICATE,Wg]].forEach(([n,s])=>{t.set(n,s),r.set(s,n)}),{VK:i,KV:e,VF:t,FV:r,trsTypeToV(n){const s=n.indexOf("-",n.indexOf("-")+1);return n.substr(s+1)}}})(),{ConsensusException:mr}=re("VERIFIER","HelperLogicVerifier");let po=class{deepClone(e){const t=Array.isArray(e)?[]:{};if(typeof e=="object"){for(const r in e)e[r]&&typeof e[r]=="object"?t[r]=this.deepClone(e[r]):t[r]=e[r];return t}else return e}async isPossessAssetExceptChainAsset(e,t,r,n=this.configHelper){for(const o in t){const a=t[o];for(const p in a)if(p!==n.assetType&&a[p].assetNumber>BigInt(0))throw new mr(c.POSSESS_ASSET_EXCEPT_CHAIN_ASSET)}if(await r.isPossessFrozenAssetExceptMain(e))throw new mr(c.POSSESS_FROZEN_ASSET_EXCEPT_CHAIN_ASSET)}async isDAppPossessor(e,t=this.configHelper,r){if(await r.isDAppPossessor(t.magic,e))throw new mr(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"DApp id possessor can not initiate a frozen account transaction"})}async isLnsPossessorOrManager(e,t=this.configHelper,r){if(await r.isLnsPossessorOrManager(t.magic,e))throw new mr(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Location name possessor or manager can not initiate a frozen account transaction"})}async isEntityFactoryPossessor(e,t=this.configHelper,r){if(await r.isEntityFactoryPossessor(t.magic,e))throw new mr(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"EntityFactory possessor can not initiate a frozen account transaction"})}async isEntityPossessor(e,t=this.configHelper,r){if(await r.isEntityPossessor(t.magic,e))throw new mr(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Entity possessor can not initiate a frozen account transaction"})}async isCertApplicantOrPossessor(e,t=this.configHelper,r){if(await r.isCertApplicantOrPossessor(t.magic,e))throw new mr(c.ACCOUNT_CAN_NOT_BE_FROZEN,{address:e,reason:"Certificate applicant or possessor can not initiate a frozen account transaction"})}async isAssetExist(e,t,r,n){const s=await n.getAsset(t,r);if(!s)throw new mr(c.NOT_EXIST,{prop:`asset with magic ${t} assetType ${r}`,target:"blockChain"});if(s.sourceChainName!==e)throw new mr(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${s.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} assetType ${r}`,be_target:`transaction magic ${t} assetType ${r}`});return s}async isDAppExist(e,t,r,n,s){const o=await s.getDApp(t,r,n);if(!o)throw new mr(c.DAPPID_IS_NOT_EXIST,{dappid:r,errorId:be.DAPPID_NOT_EXIST});if(o.sourceChainName!==e)throw new mr(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${o.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} dappid ${r}`,be_target:`transaction magic ${t} dappid ${r}`});return o}async isLocationNameExist(e,t,r,n,s){const o=await s.getLocationName(t,r,n);if(!o)throw new mr(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:r,errorId:be.LOCATION_NAME_NOT_EXIST});if(o.sourceChainName!==e)throw new mr(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${o.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} locationName ${r}`,be_target:`transaction magic ${t} locationName ${r}`});return o}async isEntityExist(e,t,r,n,s){const o=await s.getEntity(t,r,n);if(!o)throw new mr(c.ENTITY_IS_NOT_EXIST,{entityId:r,errorId:be.ENTITY_NOT_EXIST});if(o.sourceChainName!==e)throw new mr(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${o.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} entityId ${r}`,be_target:`transaction magic ${t} entityId ${r}`});return o}async isCertificateExist(e,t,r,n,s){const o=await s.getCertificate(t,r,n);if(!o)throw new mr(c.CERTIFICATE_IS_NOT_EXIST,{certificateId:r,errorId:be.CERTIFICATE_NOT_EXIST});if(o.sourceChainName!==e)throw new mr(c.NOT_MATCH,{to_compare_prop:`sourceChainName ${o.sourceChainName}`,be_compare_prop:`sourceChainName ${e}`,to_target:`blockChain magic ${t} certificateId ${r}`,be_target:`transaction magic ${t} certificateId ${r}`});return o}};h([J(te),u("design:type",te)],po.prototype,"configHelper",void 0);po=h([j()],po);const{ConsensusException:X,NoFoundException:jR}=re("VERIFIER","EventLogicVerifier");let Is=class{addRecord(e,t,r){const{recordType:n,recordValue:s}=t;if(r&&r[n]&&r[n][s])throw new X(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:e,reason:"New location name record value already exist"})}deleteRecord(e,t,r){const{recordType:n,recordValue:s}=t;if(!(r[n]&&r[n][s]))throw new X(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:e,reason:"Delete location name record value not exist"})}listenEventFee(e,t){t.on("fee",({transaction:r,applyInfo:n},s)=>{const{magic:o,assetType:a}=this.configHelper;if(o!==this.configHelper.magic)throw new X(c.SHOULD_BE,{to_compare_prop:`magic ${o}`,to_target:"applyInfo",be_compare_prop:this.configHelper.magic});if(a!==this.configHelper.assetType)throw new X(c.SHOULD_BE,{to_compare_prop:`assetType ${a}`,to_target:"applyInfo",be_compare_prop:this.configHelper.assetType});const p=BigInt(n.amount),l=n.address;e[l]=e[l]||{},e[l][o]=e[l][o]||{},e[l][o][a]=e[l][o][a]||{sourceChainMagic:o,assetType:a,assetNumber:BigInt(0),history:{}};const f=e[l][o][a],g=f.assetNumber;if(f.assetNumber+=p,f.assetNumber<BigInt(0))throw new X(c.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${r.signature} address: ${l} magic ${n.assetInfo.magic} assetType: ${n.assetInfo.assetType} hodingAsset: ${g.toString()} spendFee: ${n.amount}`,errorId:be.ASSET_NOT_ENOUGH});return s()},{taskname:"applyTransaction/logicVerifier/fee"})}listenEventDestroyMainAsset(e,t,r){r.on("destroyMainAsset",async({transaction:n,applyInfo:s},o)=>{const{magic:a,assetType:p}=this.configHelper;if(a!==this.configHelper.magic)throw new X(c.SHOULD_BE,{to_compare_prop:`magic ${a}`,to_target:"applyInfo",be_compare_prop:this.configHelper.magic});if(p!==this.configHelper.assetType)throw new X(c.SHOULD_BE,{to_compare_prop:`assetType ${p}`,to_target:"applyInfo",be_compare_prop:this.configHelper.assetType});const{amount:l,sourceAmount:f}=s,g=await t.getAsset(a,p);if(!g)throw new X(c.ASSET_NOT_EXIST,{magic:a,assetType:p,errorId:be.ASSET_NOT_EXIST});if(g.remainAssetPrealnum<BigInt(f))throw new X(c.ASSET_NOT_ENOUGH,{reason:`Asset ${a} ${p} remain: ${g.remainAssetPrealnum.toString()} destroyAsset: ${l}`,errorId:be.ASSET_NOT_ENOUGH});return o()},{taskname:"applyTransaction/logicVerifier/destroyMainAsset"})}listenEventAsset(e,t){t.on("asset",({transaction:r,applyInfo:n},s)=>{const{magic:o,assetType:a}=n.assetInfo,p=n.address;e[p]=e[p]||{},e[p][o]=e[p][o]||{},e[p][o][a]=e[p][o][a]||{sourceChainMagic:o,assetType:a,assetNumber:BigInt(0),history:{}};const l=e[p][o][a],f=l.assetNumber;if(l.assetNumber+=BigInt(n.amount),l.assetNumber<BigInt(0))throw new X(c.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${r.signature} address: ${p} magic ${n.assetInfo.magic} assetType: ${n.assetInfo.assetType} hodingAsset: ${f.toString()} spendAsset: ${n.amount}`,errorId:be.ASSET_NOT_ENOUGH});return s()},{taskname:"applyTransaction/logicVerifier/asset"})}listenEventFrozenAsset(e,t){t.on("frozenAsset",async({transaction:r,applyInfo:n},s)=>{const{magic:o,assetType:a}=n.assetInfo,p=n.address;e[p]=e[p]||{},e[p][o]=e[p][o]||{},e[p][o][a]=e[p][o][a]||{sourceChainMagic:o,assetType:a,assetNumber:BigInt(0),history:{}};const l=e[p][o][a],f=l.assetNumber;if(l.assetNumber+=BigInt(n.amount),l.assetNumber<BigInt(0))throw new X(c.ASSET_NOT_ENOUGH,{reason:`Transaction signature: ${r.signature} address: ${p} magic ${n.assetInfo.magic} assetType: ${n.assetInfo.assetType} hodingAsset: ${f.toString()} frozenAsset: ${n.amount}`,errorId:be.ASSET_NOT_ENOUGH});return s()},{taskname:"applyTransaction/logicVerifier/frozenAsset"})}listenEventUnfrozenAsset(e,t,r){r.on("unfrozenAsset",async({transaction:n,applyInfo:s},o)=>{const{assetInfo:a,frozenId:p,amount:l,recipientId:f}=s,{magic:g,assetType:d}=a,y=await t.getFrozenAsset(f,p,d);if(!y)throw new X(c.FROZEN_ASSET_NOT_EXIST_OR_EXPIRED,{frozenAddress:f,signature:p,assetType:d});const{maxEffectiveHeight:m,minEffectiveHeight:E,remainUnfrozenTimes:T,amount:w}=y;if(E>e)throw new X(c.NOT_BEGIN_UNFROZEN_YET,{frozenId:p});if(e>m)throw new X(c.FROZEN_ASSET_EXPIRATION,{frozenId:p});if(m<e)throw new X(c.FROZEN_ASSET_EXPIRATION,{frozenId:p});if(BigInt(l)>BigInt(w))throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset to unfrozen magic ${g} assetType ${d} remain ${w} spend ${l}`});if(T!==void 0&&T===0)throw new X(c.UNFROZEN_TIME_USE_UP,{frozenId:p});return o()},{taskname:"applyTransaction/logicVerifier/unfrozenAsset"})}listenEventSignForAsset(e,t,r){r.on("signForAsset",async({transaction:n,applyInfo:s},o)=>{const{frozenId:a,frozenAddress:p,assetInfo:l}=s,f=await t.getFrozenAsset(p,a,l.assetType);if(!f)throw new X(c.FROZEN_ASSET_NOT_EXIST_OR_EXPIRED,{address:p,signature:a,assetType:l.assetType});const{maxEffectiveHeight:g,minEffectiveHeight:d,remainUnfrozenTimes:y,amount:m}=f;if(d>e)throw new X(c.NOT_BEGIN_UNFROZEN_YET,{frozenId:a});if(e>g)throw new X(c.FROZEN_ASSET_EXPIRATION,{frozenId:a});if(g<e)throw new X(c.FROZEN_ASSET_EXPIRATION,{frozenId:a});if(BigInt(m)===BigInt(0))throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset to sign for magic ${f.sourceChainMagic} assetType ${f.assetType} remain ${m}`});if(y!==void 0&&y===0)throw new X(c.UNFROZEN_TIME_USE_UP,{frozenId:a});return o()},{taskname:"applyTransaction/logicVerifier/signForAsset"})}listenEventVoteEquity(e,t,r,n){n.on("voteEquity",({transaction:s,applyInfo:o},a)=>{const p=r-1,l=o.address;e[l]=e[l]||{};const f=e[l].equityInfo,g=BigInt(0);let d=f.round===p?f.equity:g;const y=d;if(d+=BigInt(o.equity),d<g)throw new X(c.ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH,{errorId:be.ACCOUNT_REMAIN_EQUITY_NOT_ENOUGH,reason:`Transaction signature: ${s.signature} address: ${l} hodingEquity: ${y.toString()} spendEquity: ${o.equity}`});const{magic:m,assetType:E,voteMinChainAsset:T}=this.configHelper,w=t[m][E].assetNumber-BigInt(s.fee);if(BigInt(T)>w)throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, vote account need min remain asset ${T}, remain Assets: ${w}`,errorId:be.CHAIN_ASSET_NOT_ENOUGH});return a()},{taskname:"applyTransaction/logicVerifier/voteEquity"})}listenEventFrozenAccount(e,t){t.on("frozenAccount",({applyInfo:r},n)=>{const{address:s}=r;e[s]=e[s]||{};const o=e[s].accountStatus;if(o===1||o===16||o===17)throw new X(c.ACCOUNT_FROZEN,{address:s,status:o});return n()},{taskname:"applyTransaction/logicVerifier/frozenAccount"})}listenEventSetUsername(e,t){t.on("setUsername",async({applyInfo:r},n)=>{const{address:s,alias:o}=r;if(await e.getAlias(o))throw new X(c.USERNAME_ALREADY_EXIST,{errorId:be.USERNAME_ALREADY_EXIST});return n()},{taskname:"applyTransaction/logicVerifier/setUsername"})}listenEventSetSecondPublicKey(e){e.on("setSecondPublicKey",({applyInfo:t},r)=>r(),{taskname:"applyTransaction/logicVerifier/setSecondPublicKey"})}listenEventRegisterToDelegate(e,t){t.on("registerToDelegate",async({applyInfo:r},n)=>{const{address:s}=r;if(e[s]=e[s]||{},e[s].isDelegate)throw new X(c.ACCOUNT_IS_ALREADY_AN_DELEGATE,{address:s,errorId:be.ACCOUNT_ALREADY_DELEGATE});return n()},{taskname:"applyTransaction/logicVerifier/registerToDelegate"})}listenEventAcceptVote(e,t){t.on("acceptVote",({applyInfo:r},n)=>{const{address:s}=r;if(e[s]=e[s]||{},!e[s].isDelegate)throw new X(c.ACCOUNT_IS_NOT_AN_DELEGATE,{address:s,errorId:be.ACCOUNT_IS_NOT_AN_DELEGATE});if(e[s].isAcceptVote)throw new X(c.DELEGATE_IS_ALREADY_ACCEPT_VOTE,{address:s,errorId:be.DELEGATE_IS_ALREADY_ACCEPT_VOTE});return n()},{taskname:"applyTransaction/logicVerifier/acceptVote"})}listenEventRejectVote(e,t){t.on("rejectVote",({applyInfo:r},n)=>{const{address:s}=r;if(e[s]=e[s]||{},!e[s].isDelegate)throw new X(c.ACCOUNT_IS_NOT_AN_DELEGATE,{address:s,errorId:be.ACCOUNT_IS_NOT_AN_DELEGATE});if(!e[s].isAcceptVote)throw new X(c.DELEGATE_IS_ALREADY_REJECT_VOTE,{address:s,errorId:be.DELEGATE_IS_ALREADY_REJECT_VOTE});return n()},{taskname:"applyTransaction/logicVerifier/rejectVote"})}async __checkAsset(e,t,r){const n=await r.getAccountInfo(e);if(n){const l=n.accountStatus;if(l===1||l===16||l===17)throw new X(c.ACCOUNT_FROZEN,{address:e,status:l})}const s=this.configHelper.magic;if(await r.isCurrencyForbidden(t))throw new X(c.FORBIDDEN,{prop:`AssetType ${t}`,target:"blockChain"});if(await r.getCurrency(t))throw new X(c.ALREADY_EXIST,{prop:`AssetType ${t}`,target:"blockChain",errorId:be.ASSETTYPE_ALREADY_EXIST});if(await r.getAsset(s,t))throw new X(c.ASSET_NOT_EXIST,{magic:s,assetType:t,errorId:be.ASSET_NOT_EXIST})}listenEventIssueAsset(e,t,r){r.on("issueAsset",async({transaction:n,applyInfo:s},o)=>{const{address:a,assetInfo:p,genesisAddress:l,sourceAmount:f}=s,{assetType:g}=p;await this.__checkAsset(l,g,t),await this.helperLogicVerifier.isPossessAssetExceptChainAsset(a,e,t),await this.helperLogicVerifier.isDAppPossessor(a,this.configHelper,t),await this.helperLogicVerifier.isLnsPossessorOrManager(a,this.configHelper,t),await this.helperLogicVerifier.isEntityFactoryPossessor(a,this.configHelper,t),await this.helperLogicVerifier.isEntityPossessor(a,this.configHelper,t),await this.helperLogicVerifier.isCertApplicantOrPossessor(a,this.configHelper,t);const{magic:d,assetType:y,issueAssetMinChainAsset:m}=this.configHelper,E=e[d][y].assetNumber-BigInt(n.fee);if(BigInt(m)>E)throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${m}, remain Assets: ${E}`,errorId:be.CHAIN_ASSET_NOT_ENOUGH});const T=this.jsbiHelper.multiplyFloorFraction(E,this.configHelper.maxMultipleOfAssetAndMainAsset);if(BigInt(f)>T)throw new X(c.PROP_SHOULD_LTE_FIELD,{prop:`expectedIssuedAssets ${f}`,target:"issueAsset",field:`calc max assets ${T}`});return o()},{taskname:"applyTransaction/logicVerifier/issueAsset"})}listenEventDestroyAsset(e,t){t.on("destroyAsset",async({applyInfo:r},n)=>{const{sourceAmount:s,assetInfo:o}=r,{magic:a,assetType:p}=o,l=await e.getAsset(a,p);if(!l)throw new X(c.ASSET_NOT_EXIST,{magic:a,assetType:p,errorId:be.ASSET_NOT_EXIST});if(l.remainAssetPrealnum<BigInt(s))throw new X(c.ASSET_NOT_ENOUGH,{reason:`Asset ${a} ${p} remain: ${l.remainAssetPrealnum.toString()} destroyAsset: ${s}`,errorId:be.ASSET_NOT_ENOUGH});return n()},{taskname:"applyTransaction/logicVerifier/destroyAsset"})}listenEventIssueDApp(e,t,r){r.on("issueDApp",async({applyInfo:n},s)=>{const{address:o,dappid:a,sourceChainMagic:p,possessorAddress:l}=n;if(o!==l){const g=await t.getAccountInfo(l);if(g){const d=g.accountStatus;if(d===1||d===16||d===17)throw new X(c.ACCOUNT_FROZEN,{address:l,status:d})}}if(await t.getDApp(p,a,e))throw new X(c.DAPPID_IS_ALREADY_EXIST,{dappid:a,errorId:be.DAPP_ALREADY_EXISTS});return s()},{taskname:"applyTransaction/logicVerifier/issueDApp"})}listenEventFrozenDApp(e,t,r){r.on("frozenDApp",async({applyInfo:n},s)=>{const{address:o,sourceChainName:a,sourceChainMagic:p,dappid:l}=n,f=await this.helperLogicVerifier.isDAppExist(a,p,l,e,t);if(f.possessorAddress!==o)throw new X(c.ACCOUNT_NOT_DAPPID_POSSESSOR,{address:o,dappid:l,errorId:be.ACCOUNT_NOT_DAPPID_POSSESSOR});if(f.status===17)throw new X(c.DAPPID_ALREADY_FROZEN,{dappid:l});return s()},{taskname:"applyTransaction/logicVerifier/frozenDApp"})}listenEventUnfrozenDApp(e,t,r){r.on("unfrozenDApp",async({transaction:n,applyInfo:s},o)=>{const{address:a,sourceChainName:p,sourceChainMagic:l,dappid:f,frozenId:g}=s,d=await this.helperLogicVerifier.isDAppExist(p,l,f,e,t);if(d.status!==17)throw new X(c.DAPPID_NOT_FROZEN,{dappid:f});if(d.frozenId!==g)throw new X(c.SHOULD_BE,{to_compare_prop:`frozenId ${g}`,to_target:"transaction",be_compare_prop:`dapp frozenId ${d.frozenId}`});if(n.recipientId!==d.possessorAddress)throw new X(c.SHOULD_BE,{to_compare_prop:`recipientId ${n.recipientId}`,to_target:"transaction",be_compare_prop:`dapp possessor ${d.possessorAddress}`});return o()},{taskname:"applyTransaction/logicVerifier/unfrozenDApp"})}async __isPossessorFrozen(e,t){const r=await t.getAccountInfo(e);if(r){const n=r.accountStatus;if(n===1||n===16||n===17)throw new X(c.ACCOUNT_FROZEN,{address:e,status:n})}}listenEventChangeDAppPossessor(e,t,r){r.on("changeDAppPossessor",async({transaction:n,applyInfo:s},o)=>{const{address:a,possessorAddress:p,sourceChainName:l,sourceChainMagic:f,dappid:g}=s;a!==p&&await this.__isPossessorFrozen(p,t);const d=await this.helperLogicVerifier.isDAppExist(l,f,g,e,t);if(d.status===17)throw new X(c.DAPPID_ALREADY_FROZEN,{dappid:g});if(n.senderId!==d.possessorAddress)throw new X(c.SHOULD_BE,{to_compare_prop:`senderId ${n.senderId}`,to_target:"transaction",be_compare_prop:`dapp possessor ${d.possessorAddress}`});return o()},{taskname:"applyTransaction/logicVerifier/changeDAppPossessor"})}listenEventRegisterChain(e,t,r){r.on("registerChain",async({transaction:n,applyInfo:s},o)=>{const{address:a,genesisBlock:p}=s;await this.helperLogicVerifier.isPossessAssetExceptChainAsset(a,e,t);const{magic:l,assetType:f,registerChainMinChainAsset:g}=this.configHelper,d=e[l][f].assetNumber-BigInt(n.fee);if(BigInt(g)>d)throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${g}, remain Assets: ${d}`,errorId:be.CHAIN_ASSET_NOT_ENOUGH});await this.helperLogicVerifier.isDAppPossessor(a,this.configHelper,t),await this.helperLogicVerifier.isLnsPossessorOrManager(a,this.configHelper,t),await this.helperLogicVerifier.isEntityFactoryPossessor(a,this.configHelper,t),await this.helperLogicVerifier.isEntityPossessor(a,this.configHelper,t),await this.helperLogicVerifier.isCertApplicantOrPossessor(a,this.configHelper,t);const{magic:y,assetType:m,chainName:E}=p;if(await t.getMagic(y))throw new X(c.ALREADY_EXIST,{prop:`Magic ${y}`,target:"blockChain",errorId:be.MAGIC_ALREADY_EXIST});if(await t.getCurrency(E))throw new X(c.ALREADY_EXIST,{prop:`ChainName ${E}`,target:"blockChain",errorId:be.CHAINNAME_ALREADY_EXIST});if(await t.getCurrency(m))throw new X(c.ALREADY_EXIST,{prop:`AssetType ${m}`,target:"blockChain",errorId:be.ASSETTYPE_ALREADY_EXIST});if(await t.getChain(y))throw new X(c.ALREADY_EXIST,{prop:`Chain with magic ${y}`,target:"blockChain"});return o()},{taskname:"applyTransaction/logicVerifier/registerChain"})}listenEventRegisterLocationName(e,t,r){r.on("registerLocationName",async({applyInfo:n},s)=>{const{address:o,sourceChainMagic:a,name:p,possessorAddress:l}=n;if(o!==l){const y=await t.getAccountInfo(l);if(y){const m=y.accountStatus;if(m===1||m===16||m===17)throw new X(c.ACCOUNT_FROZEN,{address:l,status:m})}}if(await t.getLocationName(a,p,e))throw new X(c.LOCATION_NAME_IS_ALREADY_EXIST,{prop:p,target:"blockChain",errorId:be.LOCATION_NAME_ALREADY_EXIST});if(await t.isLocationNameForbidden(p))throw new X(c.FORBIDDEN,{prop:`Location name ${p}`,target:"blockChain"});if(p.split(".").length>2){const y=p.indexOf(".")+1,m=p.substr(y);if(!await t.getLocationName(a,m,e))throw new X(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:m})}return s()},{taskname:"applyTransaction/logicVerifier/registerLocationName"})}listenEventCancelLocationName(e,t,r){r.on("cancelLocationName",async({transaction:n,applyInfo:s},o)=>{const{sourceChainName:a,sourceChainMagic:p,name:l}=s,f=await this.helperLogicVerifier.isLocationNameExist(a,p,l,e,t);if(f.status===17)throw new X(c.CAN_NOT_DELETE_LOCATION_NAME,{locationName:l,reason:"Frozen location name can not be delete"});if(f.status===255)throw new X(c.CAN_NOT_DELETE_LOCATION_NAME,{locationName:l,reason:"Location name has been deleted"});if(n.senderId!==n.recipientId)throw new X(c.SHOULD_BE,{to_compare_prop:"recipientId",to_target:"transaction",be_compare_prop:n.senderId});if(f.possessorAddress!==n.senderId)throw new X(c.CAN_NOT_DELETE_LOCATION_NAME,{locationName:l,reason:"Only location name possessor can delete location name"});if(await t.isSubLocationNameExist(p,l))throw new X(c.CAN_NOT_DELETE_LOCATION_NAME,{locationName:l,reason:"Location name have child location name, please delete it at first"});return o()},{taskname:"applyTransaction/logicVerifier/cancelLocationName"})}listenEventSetLnsManager(e,t,r){r.on("setLnsManager",async({applyInfo:n},s)=>{const{address:o,sourceChainName:a,sourceChainMagic:p,name:l,manager:f}=n,g=await t.getAccountInfo(f);if(g){const y=g.accountStatus;if(y===1||y===16||y===17)throw new X(c.ACCOUNT_FROZEN,{address:f,errorId:be.CAN_NOT_SET_FROZEN_ACCOUNT_AS_MANAGER})}const d=await this.helperLogicVerifier.isLocationNameExist(a,p,l,e,t);if(d.status===17)throw new X(c.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:l,reason:"Frozen location name can not set manager"});if(f===d.manager)throw new X(c.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:l,reason:"Can not set the same account as manager",errorId:be.CAN_NOT_SET_SAME_ACCOUNT_AS_MANAGER});if(d.type==="MULTI_LEVEL"){const m=l.split(".")[0].length+1,E=l.substr(m),T=await t.getLocationName(p,E,e);if(!T)throw new X(c.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:E,reason:"Last location name is not exists"});if(!(o===d.possessorAddress||o===T.manager))throw new X(c.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:E,reason:"Only the location name possessor or upper level location name manager can set manager of multi level location name"})}else if(o!==d.possessorAddress)throw new X(c.SET_LOCATION_NAME_MANAGER_FIELD,{locationName:l,reason:"Only the location name possessor can set manager of top level location name"});return s()},{taskname:"applyTransaction/logicVerifier/setLnsManager"})}listenEventSetLnsRecordValue(e,t,r){r.on("setLnsRecordValue",async({applyInfo:n},s)=>{const{address:o,sourceChainName:a,sourceChainMagic:p,name:l,operationType:f,addRecord:g,deleteRecord:d}=n,y=await this.helperLogicVerifier.isLocationNameExist(a,p,l,e,t),{records:m,status:E}=y;if(E===17)throw new X(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:l,reason:"Frozen location name can not set record value"});if(!(o===y.possessorAddress||o===y.manager))throw new X(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:l,reason:"Only the location name possessor or manager can set record value"});if(f===0){if(!g)throw new X(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:l,reason:"New location name record value lose"});this.addRecord(l,g,m)}else if(f===1){if(!d)throw new X(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:l,reason:"Delete location name record value lose"});this.deleteRecord(l,d,m)}else if(f===2){if(!(g&&d))throw new X(c.SET_LOCATION_NAME_RECORD_VALUE_FIELD,{locationName:l,reason:"New location name record value and delete location name record value lose"});this.deleteRecord(l,d,m),this.addRecord(l,g,m)}return s()},{taskname:"applyTransaction/logicVerifier/setLnsRecordValue"})}listenEventFrozenLocationName(e,t,r){r.on("frozenLocationName",async({applyInfo:n},s)=>{const{address:o,sourceChainName:a,sourceChainMagic:p,name:l}=n,f=await this.helperLogicVerifier.isLocationNameExist(a,p,l,e,t);if(f.status===17)throw new X(c.LOCATION_NAME_ALREADY_FROZEN,{locationName:l});if(f.type!=="TOP_LEVEL")throw new X(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(f.possessorAddress!==o)throw new X(c.ACCOUNT_NOT_LOCATION_NAME_POSSESSOR,{address:o,locationName:l,errorId:be.ACCOUNT_NOT_LNS_POSSESSOR});return s()},{taskname:"applyTransaction/logicVerifier/frozenLocationName"})}listenEventUnfrozenLocationName(e,t,r){r.on("unfrozenLocationName",async({transaction:n,applyInfo:s},o)=>{const{address:a,sourceChainName:p,sourceChainMagic:l,name:f,frozenId:g}=s,d=await this.helperLogicVerifier.isLocationNameExist(p,l,f,e,t);if(d.status!==17)throw new X(c.LOCATION_NAME_NOT_FROZEN,{locationName:f});if(d.frozenId!==g)throw new X(c.SHOULD_BE,{to_compare_prop:`frozenId ${g}`,to_target:"transaction",be_compare_prop:`location name frozenId ${d.frozenId}`});if(d.type!=="TOP_LEVEL")throw new X(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(n.recipientId!==d.possessorAddress)throw new X(c.SHOULD_BE,{to_compare_prop:`recipientId ${n.recipientId}`,to_target:"transaction",be_compare_prop:`locationName possessor ${d.possessorAddress}`});return o()},{taskname:"applyTransaction/logicVerifier/unfrozenLocationName"})}listenEventChangeLocationNamePossessor(e,t,r){r.on("changeLocationNamePossessor",async({transaction:n,applyInfo:s},o)=>{const{address:a,possessorAddress:p,sourceChainName:l,sourceChainMagic:f,name:g}=s;a!==p&&await this.__isPossessorFrozen(p,t);const d=await this.helperLogicVerifier.isLocationNameExist(l,f,g,e,t);if(d.type!=="TOP_LEVEL")throw new X(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);if(d.status===17)throw new X(c.LOCATION_NAME_ALREADY_FROZEN,{locationName:g});if(n.senderId!==d.possessorAddress)throw new X(c.SHOULD_BE,{to_compare_prop:`senderId ${n.senderId}`,to_target:"transaction",be_compare_prop:`locationName possessor ${d.possessorAddress}`});return o()},{taskname:"applyTransaction/logicVerifier/changeLocationNamePossessor"})}async __checkEntityFactory(e,t,r,n,s){const o=await s.getAccountInfo(t);if(o){const p=o.accountStatus;if(p===1||p===16||p===17)throw new X(c.ACCOUNT_FROZEN,{address:t,status:p})}if(await s.getEntityFactory(r,n,e))throw new X(c.ENTITY_FACTORY_IS_ALREADY_EXIST,{factoryId:n,errorId:be.ENTITY_FACTORY_ALREADY_EXIST})}listenEventIssueEntityFactoryByFrozen(e,t,r,n){n.on("issueEntityFactoryByFrozen",async({transaction:s,applyInfo:o},a)=>{const{address:p,factoryId:l,sourceChainMagic:f,possessorAddress:g,entityPrealnum:d}=o;await this.__checkEntityFactory(t,g,f,l,r),await this.helperLogicVerifier.isPossessAssetExceptChainAsset(p,e,r),await this.helperLogicVerifier.isDAppPossessor(p,this.configHelper,r),await this.helperLogicVerifier.isLnsPossessorOrManager(p,this.configHelper,r),await this.helperLogicVerifier.isEntityFactoryPossessor(p,this.configHelper,r),await this.helperLogicVerifier.isEntityPossessor(p,this.configHelper,r),await this.helperLogicVerifier.isCertApplicantOrPossessor(p,this.configHelper,r);const{magic:y,assetType:m,issueEntityFactoryMinChainAsset:E}=this.configHelper,T=e[y][m].assetNumber-BigInt(s.fee);if(BigInt(E)>T)throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${E}, remain Assets: ${T}`,errorId:be.CHAIN_ASSET_NOT_ENOUGH});const w=this.jsbiHelper.multiplyFractionAndFloor({numerator:T,denominator:lE},this.configHelper.maxMultipleOfEntityAndMainAsset);if(BigInt(d)>w)throw new X(c.PROP_SHOULD_LTE_FIELD,{prop:`entityPrealnum ${d}`,target:"issueEntityFactory",field:`calc max entities ${w}`});return a()},{taskname:"applyTransaction/logicVerifier/issueEntityFactoryByFrozen"})}listenEventIssueEntityFactoryByDestroy(e,t,r){r.on("issueEntityFactoryByDestroy",async({transaction:n,applyInfo:s},o)=>{const{factoryId:a,sourceChainMagic:p,possessorAddress:l}=s;return await this.__checkEntityFactory(e,l,p,a,t),o()},{taskname:"applyTransaction/logicVerifier/issueEntityFactoryByDestroy"})}__isEntityFactoryMatch(e,t,r){if(e.sourceChainMagic!==t.sourceChainMagic||e.sourceChainName!==t.sourceChainName||e.factoryId!==t.factoryId||e.entityPrealnum!==t.entityPrealnum.toString()||e.entityFrozenAssetPrealnum!==t.entityFrozenAssetPrealnum||e.purchaseAssetPrealnum!==t.purchaseAssetPrealnum)throw new X(c.NOT_MATCH,{to_compare_prop:`entityFactory ${JSON.stringify(e)}`,be_compare_prop:`entityFactory ${JSON.stringify({sourceChainName:t.sourceChainName,sourceChainMagic:t.sourceChainMagic,factoryId:t.factoryId,entityPrealnum:t.entityPrealnum.toString(),entityFrozenAssetPrealnum:t.entityFrozenAssetPrealnum,purchaseAssetPrealnum:t.purchaseAssetPrealnum})}`,to_target:r,be_target:"blockChain"})}listenEventIssueEntity(e,t,r,n){n.on("issueEntity",async({transaction:s,applyInfo:o},a)=>{const{address:p,possessorAddress:l,entityFactoryPossessorAddress:f,factoryId:g,entityId:d,sourceChainMagic:y,entityFrozenAssetPrealnum:m}=o;if(p!==l){const O=await r.getAccountInfo(l);if(O){const R=O.accountStatus;if(R===1||R===16||R===17)throw new X(c.ACCOUNT_FROZEN,{address:l,status:R})}}const E=await r.getEntityFactory(y,g,t);if(!E)throw new X(c.ENTITY_FACTORY_IS_NOT_EXIST,{factoryId:g,errorId:be.ENTITY_FACTORY_NOT_EXIST});if(this.__isEntityFactoryMatch(s.asset.issueEntity.entityFactory.toJSON(),E,"IssueEntityTransaction"),f!==E.possessorAddress)throw new X(c.NOT_MATCH,{to_compare_prop:`entityFactoryPossessor ${f}`,be_compare_prop:`possessorAddress ${E.possessorAddress}`,to_target:"issueEntity",be_target:"memEntityFactory"});const{remainEntityPrealnum:T}=E;if(T===BigInt(0))throw new X(c.ISSUE_ENTITY_TIMES_USE_UP,{entityFactory:g});if(E.entityPrealnum!==T&&await r.getEntity(y,d,t))throw new X(c.ENTITY_IS_ALREADY_EXIST,{entityId:d,errorId:be.ENTITY_ALREADY_EXIST});const{magic:w,assetType:b}=this.configHelper;let C=e[w][b].assetNumber-BigInt(s.fee);const N=E.purchaseAssetPrealnum;if(N!=="0"&&(C-=BigInt(N),C<BigInt(0)))throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${N}, remain Assets: ${C}`,errorId:be.CHAIN_ASSET_NOT_ENOUGH});if(m!=="0"&&BigInt(m)>C)throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${m}, remain Assets: ${C}`,errorId:be.CHAIN_ASSET_NOT_ENOUGH});return a()},{taskname:"applyTransaction/logicVerifier/issueEntity"})}listenEventIssueEntityV1(e,t,r,n){n.on("issueEntityV1",async({transaction:s,applyInfo:o},a)=>{const{address:p,possessorAddress:l,entityFactoryPossessorAddress:f,factoryId:g,entityId:d,sourceChainMagic:y,entityFrozenAssetPrealnum:m}=o;if(p!==l){const O=await r.getAccountInfo(l);if(O){const R=O.accountStatus;if(R===1||R===16||R===17)throw new X(c.ACCOUNT_FROZEN,{address:l,status:R})}}const E=await r.getEntityFactory(y,g,t);if(!E)throw new X(c.ENTITY_FACTORY_IS_NOT_EXIST,{factoryId:g,errorId:be.ENTITY_FACTORY_NOT_EXIST});if(this.__isEntityFactoryMatch(s.asset.issueEntity.entityFactory.toJSON(),E,"IssueEntityTransactionV1"),f!==E.possessorAddress)throw new X(c.NOT_MATCH,{to_compare_prop:`entityFactoryPossessor ${f}`,be_compare_prop:`possessorAddress ${E.possessorAddress}`,to_target:"issueEntity",be_target:"memEntityFactory"});if(E.remainEntityPrealnum===BigInt(0))throw new X(c.ISSUE_ENTITY_TIMES_USE_UP,{entityFactory:g});if(await r.getEntity(y,d,t))throw new X(c.ENTITY_IS_ALREADY_EXIST,{entityId:d,errorId:be.ENTITY_ALREADY_EXIST});const{magic:w,assetType:b}=this.configHelper;let C=e[w][b].assetNumber-BigInt(s.fee);const N=E.purchaseAssetPrealnum;if(N!=="0"&&(C-=BigInt(N),C<BigInt(0)))throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${N}, remain Assets: ${C}`,errorId:be.CHAIN_ASSET_NOT_ENOUGH});if(m!=="0"&&BigInt(m)>C)throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${m}, remain Assets: ${C}`,errorId:be.CHAIN_ASSET_NOT_ENOUGH});return a()},{taskname:"applyTransaction/logicVerifier/issueEntityV1"})}listenEventIssueEntityMultiV1(e,t,r,n){n.on("issueEntityMultiV1",async({transaction:s,applyInfo:o},a)=>{const{address:p,possessorAddress:l,entityFactoryPossessorAddress:f,factoryId:g,entityStructList:d,sourceChainMagic:y,entityFrozenAssetPrealnum:m}=o;if(p!==l){const O=await r.getAccountInfo(l);if(O){const R=O.accountStatus;if(R===1||R===16||R===17)throw new X(c.ACCOUNT_FROZEN,{address:l,status:R})}}const E=await r.getEntityFactory(y,g,t);if(!E)throw new X(c.ENTITY_FACTORY_IS_NOT_EXIST,{factoryId:g,errorId:be.ENTITY_FACTORY_NOT_EXIST});if(this.__isEntityFactoryMatch(s.asset.issueEntityMulti.entityFactory.toJSON(),E,"IssueEntityMultiTransactionV1"),f!==E.possessorAddress)throw new X(c.NOT_MATCH,{to_compare_prop:`entityFactoryPossessor ${f}`,be_compare_prop:`possessorAddress ${E.possessorAddress}`,to_target:"issueEntity",be_target:"memEntityFactory"});const{remainEntityPrealnum:T}=E;if(T===BigInt(0))throw new X(c.ISSUE_ENTITY_TIMES_USE_UP,{entityFactory:g});if(T<BigInt(d.length))throw new X(c.NOT_ENOUGH_ISSUE_ENTITY_TIMES,{entityFactory:g});if(E.entityPrealnum!==T){for(const{entityId:O}of d)if(await r.getEntity(y,O,t))throw new X(c.ENTITY_IS_ALREADY_EXIST,{entityId:O,errorId:be.ENTITY_ALREADY_EXIST})}const{magic:w,assetType:b}=this.configHelper;let C=e[w][b].assetNumber-BigInt(s.fee);const N=E.purchaseAssetPrealnum;if(N!=="0"&&(C-=BigInt(N),C<BigInt(0)))throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${N}, remain Assets: ${C}`,errorId:be.CHAIN_ASSET_NOT_ENOUGH});if(m!=="0"&&BigInt(m)>C)throw new X(c.ASSET_NOT_ENOUGH,{reason:`No enough asset, Min account asset ${m}, remain Assets: ${C}`,errorId:be.CHAIN_ASSET_NOT_ENOUGH});return a()},{taskname:"applyTransaction/logicVerifier/issueEntityV1"})}listenEventDestroyEntity(e,t,r){r.on("destroyEntity",async({transaction:n,applyInfo:s},o)=>{const{sourceChainMagic:a,entityId:p,entityFactoryApplicantAddress:l,entityFactoryPossessorAddress:f,entityFactory:g}=s,d=g.factoryId,y=await t.getEntityFactory(a,d,e);if(!y)throw new X(c.ENTITY_FACTORY_IS_NOT_EXIST,{factoryId:d,errorId:be.ENTITY_FACTORY_NOT_EXIST});if(this.__isEntityFactoryMatch(n.asset.destroyEntity.entityFactory.toJSON(),y,"DestroyEntityTransaction"),l!==y.applyAddress)throw new X(c.NOT_MATCH,{to_compare_prop:`entityFactoryApplicant ${l}`,be_compare_prop:`applyAddress ${y.applyAddress}`,to_target:"destroyEntity",be_target:"memEntityFactory"});if(f!==y.possessorAddress)throw new X(c.NOT_MATCH,{to_compare_prop:`entityFactoryPossessor ${f}`,be_compare_prop:`possessorAddress ${y.possessorAddress}`,to_target:"destroyEntity",be_target:"memEntityFactory"});const m=await t.getEntity(a,p,e);if(!m)throw new X(c.ENTITY_IS_NOT_EXIST,{entityId:p,errorId:be.ENTITY_NOT_EXIST});if(m.status===17)throw new X(c.CAN_NOT_DESTROY_ENTITY,{entityId:p,reason:"Frozen entity can not be destroy"});if(m.status===255)throw new X(c.ENTITY_ALREADY_DESTROY,{entityId:p,reason:"Entity already be destroy"});if(m.possessorAddress!==n.senderId)throw new X(c.CAN_NOT_DESTROY_ENTITY,{entityId:p,reason:`Only entity possessor can deestory entity ${p}`});return o()},{taskname:"applyTransaction/logicVerifier/destroyEntity"})}listenEventFrozenEntity(e,t,r){r.on("frozenEntity",async({applyInfo:n},s)=>{const{address:o,sourceChainName:a,sourceChainMagic:p,entityId:l}=n,f=await this.helperLogicVerifier.isEntityExist(a,p,l,e,t);if(f.possessorAddress!==o)throw new X(c.ACCOUNT_NOT_ENTITY_POSSESSOR,{address:o,entityId:l,errorId:be.ACCOUNT_NOT_ENTITY_POSSESSOR});if(f.status===17)throw new X(c.ENTITY_ALREADY_FROZEN,{entityId:l});if(f.status===255)throw new X(c.ENTITY_ALREADY_DESTROY,{entityId:l});return s()},{taskname:"applyTransaction/logicVerifier/frozenEntity"})}listenEventUnfrozenEntity(e,t,r){r.on("unfrozenEntity",async({transaction:n,applyInfo:s},o)=>{const{address:a,sourceChainName:p,sourceChainMagic:l,entityId:f,frozenId:g}=s,d=await this.helperLogicVerifier.isEntityExist(p,l,f,e,t);if(d.status===0)throw new X(c.ENTITY_NOT_FROZEN,{entityId:f});if(d.frozenId!==g)throw new X(c.SHOULD_BE,{to_compare_prop:`frozenId ${g}`,to_target:"transaction",be_compare_prop:`entity frozenId ${d.frozenId}`});if(d.status===255)throw new X(c.ENTITY_ALREADY_DESTROY,{entityId:f});if(n.recipientId!==d.possessorAddress)throw new X(c.SHOULD_BE,{to_compare_prop:`recipientId ${n.recipientId}`,to_target:"transaction",be_compare_prop:`entity possessor ${d.possessorAddress}`});return o()},{taskname:"applyTransaction/logicVerifier/unfrozenEntity"})}listenEventChangeEntityPossessor(e,t,r){r.on("changeEntityPossessor",async({transaction:n,applyInfo:s},o)=>{const{address:a,possessorAddress:p,sourceChainName:l,sourceChainMagic:f,entityId:g}=s;a!==p&&await this.__isPossessorFrozen(p,t);const d=await this.helperLogicVerifier.isEntityExist(l,f,g,e,t);if(d.status===17)throw new X(c.ENTITY_ALREADY_FROZEN,{entityId:g});if(d.status===255)throw new X(c.ENTITY_ALREADY_DESTROY,{entityId:g});if(n.senderId!==d.possessorAddress)throw new X(c.SHOULD_BE,{to_compare_prop:`senderId ${n.senderId}`,to_target:"transaction",be_compare_prop:`entity possessor ${d.possessorAddress}`});return o()},{taskname:"applyTransaction/logicVerifier/changeEntityPossessor"})}listenEventMigrateCertificate(e,t){t.on("migrateCertificate",async({applyInfo:r},n)=>{const{migrateCertificateId:s}=r;if(await e.getMigrateCertificate(s))throw new X(c.ASSET_IS_ALREADY_MIGRATION,{migrateCertificateId:s});return n()},{taskname:"applyTransaction/logicVerifier/migrateCertificate"})}listenEventPayTax(e,t,r){r.on("payTax",async({applyInfo:n},s)=>{const{sourceChainName:o,sourceChainMagic:a,parentAssetType:p,assetType:l,taxInformation:f}=n;if(p===L.ENTITY){const g=await this.helperLogicVerifier.isEntityExist(o,a,l,e,t);if(g.applyAddress!==f.taxCollector)throw new X(c.NOT_MATCH,{to_compare_prop:`entityApplicant ${g.applyAddress}`,be_compare_prop:`taxCollector ${f.taxCollector}`,to_target:"taxInformation",be_target:"memEntity"});if(g.taxAssetPrealnum!==f.taxAssetPrealnum)throw new X(c.NOT_MATCH,{to_compare_prop:`taxAssetPrealnum ${g.taxAssetPrealnum}`,be_compare_prop:`taxAssetPrealnum ${f.taxAssetPrealnum}`,to_target:"taxInformation",be_target:"memEntity"})}return s()},{taskname:"applyTransaction/logicVerifier/payTax"})}listenEventIssueCertificate(e,t,r){r.on("issueCertificate",async({transaction:n,applyInfo:s},o)=>{const{address:a,possessorAddress:p,sourceChainMagic:l,sourceChainName:f,certificateId:g}=s;if(a!==p){const y=await t.getAccountInfo(p);if(y){const m=y.accountStatus;if(m===1||m===16||m===17)throw new X(c.ACCOUNT_FROZEN,{address:p,status:m})}}if(await t.getCertificate(l,g,e))throw new X(c.CERTIFICATE_IS_ALREADY_EXIST,{certificateId:g,errorId:be.CERTIFICATE_ALREADY_EXIST});return o()},{taskname:"applyTransaction/logicVerifier/issueCertificate"})}listenEventDestroyCertificate(e,t,r){r.on("destroyCertificate",async({transaction:n,applyInfo:s},o)=>{const{sourceChainMagic:a,sourceChainName:p,certificateId:l}=s,f=await this.helperLogicVerifier.isCertificateExist(p,a,l,e,t);if(f.status===255)throw new X(c.CERTIFICATE_ALREADY_DESTROY,{certificateId:l});if(f.status===17)throw new X(c.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:l,reason:"Frozen certificate can not be destroy"});if(f.type===0)throw new X(c.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:l,reason:"Certificate with type 0 can not be destroy"});if(f.type===1&&f.applyAddress!==n.senderId)throw new X(c.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:l,reason:`Only certificate applicant can deestory certificate ${l}`});if(f.possessorAddress!==n.senderId)throw new X(c.CAN_NOT_DESTROY_CERTIFICATE,{certificateId:l,reason:`Only certificate possessor can deestory certificate ${l}`});return o()},{taskname:"applyTransaction/logicVerifier/destroyCertificate"})}listenEventFrozenCertificate(e,t,r){r.on("frozenCertificate",async({applyInfo:n},s)=>{const{address:o,sourceChainName:a,sourceChainMagic:p,certificateId:l}=n,f=await this.helperLogicVerifier.isCertificateExist(a,p,l,e,t);if(f.status===255)throw new X(c.CERTIFICATE_ALREADY_DESTROY,{certificateId:l});if(f.status===17)throw new X(c.CERTIFICATE_ALREADY_FROZEN,{certificateId:l});if(f.possessorAddress!==o)throw new X(c.ACCOUNT_NOT_CERTIFICATE_POSSESSOR,{address:o,certificateId:l,errorId:be.ACCOUNT_NOT_CERTIFICATE_POSSESSOR});return s()},{taskname:"applyTransaction/logicVerifier/frozenCertificate"})}listenEventUnfrozenCertificate(e,t,r){r.on("unfrozenCertificate",async({transaction:n,applyInfo:s},o)=>{const{address:a,sourceChainName:p,sourceChainMagic:l,certificateId:f,frozenId:g}=s,d=await this.helperLogicVerifier.isCertificateExist(p,l,f,e,t);if(d.status===255)throw new X(c.CERTIFICATE_ALREADY_DESTROY,{certificateId:f});if(d.status!==17)throw new X(c.CERTIFICATE_NOT_FROZEN,{certificateId:f});if(d.frozenId!==g)throw new X(c.SHOULD_BE,{to_compare_prop:`frozenId ${g}`,to_target:"transaction",be_compare_prop:`certificate frozenId ${d.frozenId}`});if(n.recipientId!==d.possessorAddress)throw new X(c.SHOULD_BE,{to_compare_prop:`recipientId ${n.recipientId}`,to_target:"transaction",be_compare_prop:`Certificate possessor ${d.possessorAddress}`});return o()},{taskname:"applyTransaction/logicVerifier/unfrozenCertificate"})}listenEventChangeCertificatePossessor(e,t,r){r.on("changeCertificatePossessor",async({transaction:n,applyInfo:s},o)=>{const{address:a,possessorAddress:p,sourceChainName:l,sourceChainMagic:f,certificateId:g}=s;a!==p&&await this.__isPossessorFrozen(p,t);const d=await this.helperLogicVerifier.isCertificateExist(l,f,g,e,t);if(d.status===255)throw new X(c.CERTIFICATE_ALREADY_DESTROY,{certificateId:g});if(d.status===17)throw new X(c.CERTIFICATE_ALREADY_FROZEN,{certificateId:g});if(n.senderId!==d.possessorAddress)throw new X(c.SHOULD_BE,{to_compare_prop:`senderId ${n.senderId}`,to_target:"transaction",be_compare_prop:`Certificate possessor ${d.possessorAddress}`});return o()},{taskname:"applyTransaction/logicVerifier/changeCertificatePossessor"})}async awaitEventResult(e,t){await this.transactionCore.getTransactionFactoryFromType(e.type).applyTransaction(e,t)}};h([J(It),u("design:type",It)],Is.prototype,"jsbiHelper",void 0);h([J(te),u("design:type",te)],Is.prototype,"configHelper",void 0);h([J(_t),u("design:type",_t)],Is.prototype,"blockHelper",void 0);h([J(me),u("design:type",me)],Is.prototype,"transactionHelper",void 0);h([J(po),u("design:type",po)],Is.prototype,"helperLogicVerifier",void 0);h([J("bfchain-core:TransactionCore"),u("design:type",Object)],Is.prototype,"transactionCore",void 0);Is=h([j()],Is);const{ConsensusException:ot,NoFoundException:nA}=re("VERIFIER","TransactionLogicVerifier");class Le{async logicVerify(e,t,r,n,s){if(e.version>this.configHelper.version)throw new ot(c.PROP_SHOULD_LTE_FIELD,{prop:`version ${e.version}`,target:`transaction ${e.signature}`,field:`blockChain version ${this.configHelper.version}`});const{recipientId:o}=e,a=r.sender;if(!(a&&a.accountInfo&&a.accountAssets))throw new nA(c.NOT_FOUND,{prop:"sender"});const p=a.accountInfo;this.checkSenderAccountStatus(p),this.checkSecondPublicKey(p,e),this.checkApplyBlockHeight(e,t),this.checkEffectiveBlockHeight(e,t),await this.checkTransactionMagic(e,n),t>1&&this.checkTransactionTimestamp(e),await this.checkTransactionRange(e,t,n);let l;if(o){if(l=r.recipient,!l&&(l=await n.getAccountInfoAndAssets(o,t),!l))throw new ot(c.NOT_EXIST,{prop:`Account with address ${o}`,target:"blockChain"});l&&l.accountInfo&&l.accountAssets&&this.checkRecipientAccountStatus(l.accountInfo)}this.checkTrsMaxBytes(e.getBytes().length),await this.checkDAppId(e,t,n,s),await this.checkLocationName(e,t,n);const f=this.blockHelper.calcRoundByHeight(t);return{sender:a,recipient:l,curRound:f}}checkSenderAccountStatus(e){if(!(e&&e.hasOwnProperty("accountStatus")))throw new ot(c.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(e.accountStatus===16||e.accountStatus===17)throw new ot(c.ACCOUNT_FROZEN,{address:e.address,errorId:be.TRANSACTION_SENDER_ASSET_FROZEN})}checkRecipientAccountStatus(e){if(!e.hasOwnProperty("accountStatus"))throw new ot(c.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(e.accountStatus===1||e.accountStatus===17)throw new ot(c.ACCOUNT_FROZEN,{address:e.address,errorId:be.TRANSACTION_RECIPIENT_ASSET_FROZEN})}checkSecondPublicKey(e,t){const{type:r,senderId:n,senderSecondPublicKey:s,applyBlockHeight:o,signature:a,signSignature:p}=t,l=e.secondPublicKey;if(l){if(!(s&&p))throw new ot(c.TRANSACTION_SIGN_SIGNATURE_IS_REQUIRED,{signature:a,senderId:n,applyBlockHeight:o,type:r});if(l!==s)throw new ot(c.TRANSACTION_SENDER_SECOND_PUBLICKEY_ALREADY_CHANGE,{signature:a,senderId:n,applyBlockHeight:o,type:r})}else{if(s)throw new ot(c.TRANSACTION_SHOULD_NOT_HAVE_SENDER_SECOND_PUBLICKEY,{signature:a,senderId:n,applyBlockHeight:o,type:r});if(p)throw new ot(c.TRANSACTION_SHOULD_NOT_HAVE_SIGN_SIGNATURE,{signature:a,senderId:n,applyBlockHeight:o,type:r})}}checkApplyBlockHeight(e,t){const r=e.applyBlockHeight;if(r>t)throw new ot(c.INVALID_TRANSACTION_APPLY_BLOCK_HEIGHT,{signature:e.signature,reason:`applyBlockHeight ${r} must less than currntBlockHeight ${t}`},void 0,"minor")}checkEffectiveBlockHeight(e,t){const r=e.effectiveBlockHeight;if(r<t)throw new ot(c.INVALID_TRANSACTION_EFFECTIVE_BLOCK_HEIGHT,{signature:e.signature,reason:`effectiveBlockHeight ${r} must greate than or equal to currntBlockHeight ${t}`})}async checkTransactionMagic(e,t){const r=e.fromMagic,n=e.toMagic,s=this.configHelper.magic;if(r===s){if(n===s)return;if(!await t.getChain(n))throw new ot(c.INVALID_TRANSACTION_TO_MAGIC,{reason:"Transaction toMagic chain not exists",signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type})}else{if(!await t.getChain(r))throw new ot(c.INVALID_TRANSACTION_FROM_MAGIC,{reason:"Transaction fromMagic chain not exists",signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type});if(n!==s)throw new ot(c.INVALID_TRANSACTION_TO_MAGIC,{reason:"Transaction to magic must be local",signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type})}}checkTransactionTimestamp(e){const{timeHelper:t}=this,r=t.getTimestamp(),n=t.getSlotNumberByTimestamp(e.timestamp),s=t.getSlotNumberByTimestamp(r);if(n>s)throw new ot(c.INVALID_TRANSACTION_TIMESTAMP,{reason:`Transaction timestamp in future. Transaction time is ahead of the time on the server, transaction timestamp ${e.timestamp}, transaction timestamp slot ${n}, blockChain now timestamp ${r}, blockChain now timestamp slot ${s}`,signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type})}async checkTransactionRange(e,t,r){if(!r)throw new nA(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});const{rangeType:n,range:s}=e,{magic:o}=this.configHelper;switch(n){case 0:break;case 1:break;case 2:for(const a of s)if(!await r.getDApp(o,a,t))throw new ot(c.DAPPID_IS_NOT_EXIST,{dappid:a});break;case 4:for(const a of s)if(!await r.getLocationName(o,a,t))throw new ot(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:a});break;default:throw new ot(c.UNKNOWN_RANGE_TYPE,{rangeType:n})}}checkTrsMaxBytes(e){if(BigInt(e)>BigInt(this.configHelper.maxTransactionSize))throw new ot(c.INVALID_TRANSACTION_BYTE_LENGTH,{reason:`The size of the transaction ${e} exceeds the limit`})}async checkDAppId(e,t,r,n){const{dappid:s,senderId:o}=e;if(!s)return;const a=await r.getDApp(e.fromMagic,s,t);if(!a)throw new ot(c.DAPPID_IS_NOT_EXIST,{dappid:s});const p=a.possessorAddress,l=await r.getAccountInfo(p);if(!l)throw new ot(c.NOT_FOUND,{porp:`Dapp possessor ${p}`});if(a.type===0&&!await n.getPurchaseDApp(o,s))throw new ot(c.NEED_PURCHASE_DAPPID_BEFORE_USE,{dappid:`${s} user ${o} possessor ${p}`});if(l.isAcceptVote){const f=this.blockHelper.calcRoundByHeight(t);if(!await r.isVoteForDelegate(o,p,f))throw new ot(c.NEED_VOTE_FOR_DAPPID_POSSESSOR_BFCORE_USE,{dappid:`${s} user ${o} possessor ${p}`,errorId:be.MUSET_VOTE_FOR_DAPP_POSSESSOR})}}async checkLocationName(e,t,r){const n=e.lns;if(!n)return;if(!await r.getLocationName(this.configHelper.magic,n,t))throw new ot(c.LOCATION_NAME_IS_NOT_EXIST,{locationName:n,errorId:be.LOCATION_NAME_NOT_EXIST})}isFeeEnough(e,t){return BigInt(e)<BigInt(t)?{isFeeEnough:!1,minFee:t}:{isFeeEnough:!0,minFee:t}}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByBytes(e,t)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByBytes(e,t,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}checkTransactionBlobSize(e,t){const{maxBlobSizePerTransaction:r}=this.configHelper,n=r<t?r:t;if(e.blobSize>n)throw new ot(c.PROP_SHOULD_LTE_FIELD,{prop:`transaction blob size ${e.blobSize}`,target:"transaction",field:n})}async checkRepeatInUntreatedTransaction(e,t){const{senderId:r,signature:n}=e;if(await t.countTransactionInUntreatedBySignature(r,n)>0)throw new ot(c.ALREADY_EXIST,{prop:`Transaction with signature ${n}`,target:"untreated transaction"})}async checkRepeatInBlockChainTransaction(e,t,r=0,n){const{signature:s,applyBlockHeight:o}=e;if(await n.countTransactionInBlockChainBySignature(s,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(o,t))>r)throw new ot(c.ALREADY_EXIST,{prop:`Transaction with signature ${s}`,target:"blockChain"})}async checkTransactionPowOfWork(e,t,r,n){const s=await n.getAccountTxCountInBlock(e.senderId);if(s===void 0)throw new ot(c.NOT_FOUND,{prop:"account number of transaction in block"});if(!await this.transactionHelper.checkTransactionProfOfWork(he(e.signature),s,r))throw new ot(c.VERIFY_TRANSACTION_POW_OF_WORK_ERROR,{errorId:be.TRANSACTION_POW_CHECK_FIELD,reason:`Transaction pow check field, block height ${t} transaction signature ${e.signature} sender ${e.senderId} participation ${r} sender transaction count in block ${s}`})}getLockData(e){return[]}}h([J(te),u("design:type",te)],Le.prototype,"configHelper",void 0);h([J(Vt),u("design:type",Vt)],Le.prototype,"timeHelper",void 0);h([J(_t),u("design:type",_t)],Le.prototype,"blockHelper",void 0);h([J(me),u("design:type",me)],Le.prototype,"transactionHelper",void 0);h([J(It),u("design:type",It)],Le.prototype,"jsbiHelper",void 0);h([J(Is,{dynamics:!0}),u("design:type",Is)],Le.prototype,"eventLogicVerifier",void 0);h([J(po),u("design:type",po)],Le.prototype,"helperLogicVerifier",void 0);h([J("customTransactionCenter",{optional:!0,dynamics:!0}),u("design:type",Object)],Le.prototype,"customTransactionCenter",void 0);const{ConsensusException:gw}=re("VERIFIER","UsernameLogicVerifier");let qg=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p=new ve,{eventLogicVerifier:l}=this;if(l.listenEventFee(a,p),l.listenEventSetUsername(n,p),await l.awaitEventResult(e,p),o.accountInfo.username)throw new gw(c.ACCOUNT_ALREADY_HAVE_USERNAME,{errorId:be.ACCOUNT_ALREADY_HAVE_USERNAME});return!0}getLockData(e){return[e.asset.username.alias]}};qg=h([j(),u("design:paramtypes",[])],qg);let Xg=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p=new ve,{eventLogicVerifier:l}=this;return l.listenEventFee(a,p),l.listenEventSetSecondPublicKey(p),await l.awaitEventResult(e,p),!0}};Xg=h([j(),u("design:paramtypes",[])],Xg);const{ConsensusException:dw}=re("VERIFIER","DelegateLogicVerifier");let Zg=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o,curRound:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},l={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountInfo)},f=new ve,{eventLogicVerifier:g}=this;return g.listenEventFee(p,f),g.listenEventRegisterToDelegate(l,f),await g.awaitEventResult(e,f),!0}async checkRegisterDelegateQuota(e,t){const{maxDelegateTxsPerRound:r}=this.configHelper,n=await t.getNumberOfNewDelegate();let s=r;const o=this.blockHelper.calcRoundByHeight(e);if(e<this.configHelper.blockPerRound&&(s=s+this.configHelper.delegates),n>=s)throw new dw(c.REGISTER_DELEGTE_QUOTA_FULL,{round:o})}};Zg=h([j(),u("design:paramtypes",[])],Zg);let ed=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountInfo)},l=new ve,{eventLogicVerifier:f}=this;return f.listenEventFee(a,l),f.listenEventAcceptVote(p,l),await f.awaitEventResult(e,l),!0}};ed=h([j(),u("design:paramtypes",[])],ed);let td=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountInfo)},l=new ve,{eventLogicVerifier:f}=this;return f.listenEventFee(a,l),f.listenEventRejectVote(p,l),await f.awaitEventResult(e,l),!0}};td=h([j(),u("design:paramtypes",[])],td);const{ConsensusException:sA,NoFoundException:yw}=re("VERIFIER","VoteLogicVerifier");let rd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o,recipient:a,curRound:p}=await this.logicVerify(e,t,r,n,s),l={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},f={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountInfo)};if(a&&a.accountInfo&&a.accountAssets){const y=a.accountInfo.address;l[y]=this.helperLogicVerifier.deepClone(a.accountAssets),f[y]=this.helperLogicVerifier.deepClone(a.accountInfo)}const g=new ve,{eventLogicVerifier:d}=this;if(d.listenEventFee(l,g),d.listenEventVoteEquity(f,this.helperLogicVerifier.deepClone(o.accountAssets),p,g),await d.awaitEventResult(e,g),!a)throw new yw(c.NOT_FOUND,{prop:`recipient ${e.recipientId}`});return await this.isVoteForAcceptVoteDelegate(a),!0}async isVoteForAcceptVoteDelegate(e){const t=e.accountInfo;if(!t.isDelegate)throw new sA(c.ACCOUNT_IS_NOT_AN_DELEGATE,{address:t.address,errorId:be.ACCOUNT_IS_NOT_AN_DELEGATE});if(!t.isAcceptVote)throw new sA(c.DELEGATE_IS_ALREADY_REJECT_VOTE,{address:t.address,errorId:be.DELEGATE_IS_ALREADY_REJECT_VOTE})}};rd=h([j(),u("design:paramtypes",[])],rd);let nd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p=new ve,{eventLogicVerifier:l}=this;return l.listenEventFee(a,p),l.listenEventIssueDApp(t,n,p),await l.awaitEventResult(e,p),!0}getLockData(e){return[e.asset.dapp.dappid]}};nd=h([j(),u("design:paramtypes",[])],nd);const{ConsensusException:$o}=re("VERIFIER","DAppPurchasingLogicVerifier");let sd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){await this.isDAppidMatch(e,t,n);const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p=new ve,{eventLogicVerifier:l}=this;return l.listenEventFee(a,p),l.listenEventAsset(a,p),await l.awaitEventResult(e,p),!0}async isDAppidMatch(e,t,r){const{dappAsset:n}=e.asset.dappPurchasing,{sourceChainMagic:s,dappid:o}=n,a=await r.getDApp(s,o,t);if(!a)throw new $o(c.DAPPID_IS_NOT_EXIST,{dappid:o});if(e.recipientId!==a.possessorAddress)throw new $o(c.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"DAppPurchasingTransaction",be_compare_prop:`dapp possessor ${a.possessorAddress}`});if(n.sourceChainName!==a.sourceChainName||n.type!==a.type)throw new $o(c.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(n.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:n.sourceChainMagic,sourceChainName:a.sourceChainName,dappid:o,type:a.type})}`,to_target:"DAppPurchasingTransaction.asset.dappPurchasing",be_target:"blockChain dapp"});if(a.purchaseAsset){if(!n.purchaseAsset)throw new $o(c.PROP_IS_REQUIRE,{prop:"purchaseAsset",target:"DAppPurchasingTransaction.asset.dappPurchasing.dappAsset"});if(n.purchaseAsset!==a.purchaseAsset)throw new $o(c.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(n.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:n.sourceChainMagic,sourceChainName:a.sourceChainName,dappid:o,type:a.type,purchaseAsset:a.purchaseAsset})}`,to_target:"DAppPurchasingTransaction.asset.dappPurchasing",be_target:"blockChain dapp"})}else if(n.purchaseAsset)throw new $o(c.SHOULD_NOT_EXIST,{prop:"purchaseAsset",target:"DAppPurchasingTransaction.asset.dappPurchasing.dappAsset"})}};sd=h([j(),u("design:paramtypes",[])],sd);const{ConsensusException:dc}=re("VERIFIER","MarkLogicVerifier");let id=class extends Le{constructor(){super()}async verify(e,t,r,n,s){await this.isDAppidMatch(e,t,n);const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(o.accountInfo),a&&a.accountInfo&&a.accountAssets){const g=a.accountInfo.address;p[g]=this.helperLogicVerifier.deepClone(a.accountAssets),this.helperLogicVerifier.deepClone(a.accountInfo)}const l=new ve,{eventLogicVerifier:f}=this;return f.listenEventFee(p,l),await f.awaitEventResult(e,l),!0}async isDAppidMatch(e,t,r){const{dapp:n}=e.asset.mark,{sourceChainMagic:s,dappid:o}=n,a=await r.getDApp(s,o,t);if(!a)throw new dc(c.DAPPID_IS_NOT_EXIST,{dappid:o});if(n.sourceChainName!==a.sourceChainName||n.type!==a.type)throw new dc(c.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(n.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:n.sourceChainMagic,sourceChainName:a.sourceChainName,dappid:o,type:a.type})}`,to_target:"MarkTransaction.asset.mark",be_target:"blockChain dapp"});if(a.purchaseAsset){if(!n.purchaseAsset)throw new dc(c.PROP_IS_REQUIRE,{prop:"purchaseAsset",target:"MarkTransaction.asset.mark.dapp"});if(n.purchaseAsset!==a.purchaseAsset)throw new dc(c.NOT_MATCH,{to_compare_prop:`dapp ${JSON.stringify(n.toJSON())}`,be_compare_prop:`dapp ${JSON.stringify({sourceChainMagic:n.sourceChainMagic,sourceChainName:a.sourceChainName,dappid:o,type:a.type,purchaseAsset:a.purchaseAsset})}`,to_target:"MarkTransaction.asset.mark",be_target:"blockChain dapp"})}else if(n.purchaseAsset)throw new dc(c.SHOULD_NOT_EXIST,{prop:"purchaseAsset",target:"MarkTransaction.asset.mark.dapp"})}};id=h([j(),u("design:paramtypes",[])],id);let od=class extends Le{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},l={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountInfo)};if(a&&a.accountInfo&&a.accountAssets){const y=a.accountInfo.address;p[y]=this.helperLogicVerifier.deepClone(a.accountAssets),l[y]=this.helperLogicVerifier.deepClone(a.accountInfo)}const f=new ve,{eventLogicVerifier:g}=this;g.listenEventFee(p,f),g.listenEventFrozenAccount(l,f);const d=this.helperLogicVerifier.deepClone(o.accountAssets);return g.listenEventIssueAsset(d,n,f),await g.awaitEventResult(e,f),!0}getLockData(e){return[e.type]}};od=h([j(),Oe(0,J(de)),Oe(1,J(me)),u("design:paramtypes",[de,me])],od);const{ConsensusException:iA}=re("VERIFIER","TransactionLogicVerifier");let ad=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:o,assetType:a,sourceChainName:p}=e.asset.transferAsset;await this.helperLogicVerifier.isAssetExist(p,o,a,n);const{sender:l,recipient:f}=await this.logicVerify(e,t,r,n,s),g={[e.senderId]:this.helperLogicVerifier.deepClone(l.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(l.accountInfo),f&&f.accountInfo&&f.accountAssets){this.checkRecipientStatus(a,f.accountInfo);const m=f.accountInfo.address;g[m]=this.helperLogicVerifier.deepClone(f.accountAssets),this.helperLogicVerifier.deepClone(f.accountInfo)}const d=new ve,{eventLogicVerifier:y}=this;return y.listenEventFee(g,d),y.listenEventAsset(g,d),await y.awaitEventResult(e,d),!0}checkRecipientStatus(e,t){if(!t.hasOwnProperty("accountStatus"))throw new iA(c.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(t.accountStatus===16&&e!==this.configHelper.assetType)throw new iA(c.PERMISSION_DENIED,{operationName:`Transfer asset ${e} to ${t.address}, because ${t.address} was frozen`})}};ad=h([j(),u("design:paramtypes",[])],ad);const{ConsensusException:oA}=re("VERIFIER","TransactionLogicVerifier");let cd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),{sourceChainName:p,sourceChainMagic:l,parentAssetType:f,assetType:g}=e.asset.transferAny,d={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(o.accountInfo),a&&a.accountInfo&&a.accountAssets){this.checkRecipientStatus(g,a.accountInfo);const E=a.accountInfo.address;d[E]=this.helperLogicVerifier.deepClone(a.accountAssets),this.helperLogicVerifier.deepClone(a.accountInfo)}const y=new ve,{eventLogicVerifier:m}=this;return m.listenEventFee(d,y),f===L.ASSETS?(await this.helperLogicVerifier.isAssetExist(p,l,g,n),m.listenEventAsset(d,y)):f===L.DAPP?m.listenEventChangeDAppPossessor(t,n,y):f===L.LOCATION_NAME?m.listenEventChangeLocationNamePossessor(t,n,y):f===L.ENTITY?(m.listenEventChangeEntityPossessor(t,n,y),m.listenEventAsset(d,y),m.listenEventPayTax(t,n,y)):f===L.CERTIFICATE&&m.listenEventChangeCertificatePossessor(t,n,y),await m.awaitEventResult(e,y),!0}checkRecipientStatus(e,t){if(!t.hasOwnProperty("accountStatus"))throw new oA(c.PROP_LOSE,{prop:"accountStatus",target:"accountInfo"});if(t.accountStatus===16&&e!==this.configHelper.assetType)throw new oA(c.PERMISSION_DENIED,{operationName:`Transfer asset ${e} to ${t.address}, because ${t.address} was frozen`})}getLockData(e){const{parentAssetType:t,assetType:r,taxInformation:n}=e.asset.transferAny,s=[];return(t===L.DAPP||t===L.LOCATION_NAME||t===L.ENTITY)&&(s.push(r),n&&s.push(n.taxCollector)),s}};cd=h([j(),u("design:paramtypes",[])],cd);const{ConsensusException:mw}=re("VERIFIER","TransactionLogicVerifier");let pd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:o,assetType:a,sourceChainName:p}=e.asset.destroyAsset,l=await this.helperLogicVerifier.isAssetExist(p,o,a,n);if(l.applyAddress!==e.recipientId)throw new mw(c.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"transaction",be_compare_prop:`asset apply account address ${l.applyAddress}`});const{sender:f,recipient:g}=await this.logicVerify(e,t,r,n,s),d={[e.senderId]:this.helperLogicVerifier.deepClone(f.accountAssets)};if(g&&g.accountInfo&&g.accountAssets){const E=g.accountInfo.address;d[E]=this.helperLogicVerifier.deepClone(g.accountAssets)}const y=new ve,{eventLogicVerifier:m}=this;return m.listenEventFee(d,y),m.listenEventAsset(d,y),m.listenEventDestroyAsset(n,y),await m.awaitEventResult(e,y),!0}};pd=h([j(),u("design:paramtypes",[])],pd);let ld=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:o,assetType:a,sourceChainName:p,totalGrabableTimes:l}=e.asset.giftAsset;await this.helperLogicVerifier.isAssetExist(p,o,a,n);const{sender:f}=await this.logicVerify(e,t,r,n,s),g={[e.senderId]:this.helperLogicVerifier.deepClone(f.accountAssets)},d=new ve,{eventLogicVerifier:y}=this;return y.listenEventFee(g,d),y.listenEventFrozenAsset(g,d),await y.awaitEventResult(e,d),!0}checkTrsFeeAndWebFee(e,t){const r=e.asset.giftAsset.totalGrabableTimes+1;return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(r)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=e.asset.giftAsset.totalGrabableTimes+1;return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(n,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}};ld=h([j(),u("design:paramtypes",[])],ld);let hd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:o,assetType:a,parentAssetType:p,sourceChainName:l,totalGrabableTimes:f}=e.asset.giftAny,{sender:g}=await this.logicVerify(e,t,r,n,s),d={[e.senderId]:this.helperLogicVerifier.deepClone(g.accountAssets)},y=new ve,{eventLogicVerifier:m}=this;return m.listenEventFee(d,y),p===L.ASSETS?(await this.helperLogicVerifier.isAssetExist(l,o,a,n),m.listenEventFrozenAsset(d,y)):p===L.DAPP?m.listenEventFrozenDApp(t,n,y):p===L.LOCATION_NAME?m.listenEventFrozenLocationName(t,n,y):p===L.ENTITY?(m.listenEventFrozenEntity(t,n,y),m.listenEventFrozenAsset(d,y),m.listenEventPayTax(t,n,y)):p===L.CERTIFICATE&&m.listenEventFrozenCertificate(t,n,y),await m.awaitEventResult(e,y),!0}checkTrsFeeAndWebFee(e,t){const r=e.asset.giftAny.totalGrabableTimes+1;return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(r)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=e.asset.giftAny.totalGrabableTimes+1;return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(n,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{parentAssetType:t,assetType:r}=e.asset.giftAny,n=[];return(t===L.DAPP||t===L.LOCATION_NAME||t===L.ENTITY)&&n.push(r),n}};hd=h([j(),u("design:paramtypes",[])],hd);const{ConsensusException:ar,NoFoundException:_w}=re("VERIFIER","GrabAssetLogicVerifier");let ud=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const o=e.asset.grabAsset,{transactionSignature:a}=o,p=await s.getTransactionAndBlockSignatureBySignature(a,this.transactionHelper.calcTransactionQueryRange(t));if(!p)throw new _w(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${a}`,target:"grabAsset"});const l=p.transaction;if(l.type!==this.transactionHelper.GIFT_ASSET)throw new ar(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${a}`});this.isValidRecipientId(e,l),this.isBlockSignatureMatch(e,p.blockSignature),this.isDependentTransactionMatch(e,l),await this.isValidAmount(e);const{sender:f,recipient:g}=await this.logicVerify(e,t,r,n,s),d={[e.senderId]:this.helperLogicVerifier.deepClone(f.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(f.accountInfo),g&&g.accountInfo&&g.accountAssets){const E=g.accountInfo.address;d[E]=this.helperLogicVerifier.deepClone(g.accountAssets),this.helperLogicVerifier.deepClone(g.accountInfo)}const y=new ve,{eventLogicVerifier:m}=this;return m.listenEventFee(d,y),m.listenEventUnfrozenAsset(t,n,y),await m.awaitEventResult(e,y),!0}async isValidAmount(e){const{senderId:t,recipientId:r,asset:n}=e,s=n.grabAsset,{giftAsset:o,blockSignatureBuffer:a,transactionSignatureBuffer:p}=s;let l;switch(o.giftDistributionRule){case 0:l=this.transactionHelper.calcGrabAverageGiftAssetNumber(o.amount,o.totalGrabableTimes);break;case 1:l=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,a,p,r,o.amount,o.totalGrabableTimes);break;case 2:l=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,a,p,r,o.amount,o.totalGrabableTimes);break}if(!l)throw new ar(c.PROP_IS_INVALID,{prop:`calculate amount ${l.toString()}`,target:"giftAsset"});if(l.toString()!==s.amount)throw new ar(c.SHOULD_BE,{to_compare_prop:`amount ${s.amount}`,to_target:"grabAsset",be_compare_prop:l.toString()})}isValidRecipientId(e,t){if(e.recipientId!==t.senderId)throw new ar(c.NOT_MATCH,{to_compare_prop:`GrabAssetTransaction.recipientId ${e.recipientId}`,be_compare_prop:`GiftAssetTransaction.senderId ${t.senderId}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"})}isBlockSignatureMatch(e,t){if(t!==e.asset.grabAsset.blockSignature)throw new ar(c.NOT_MATCH,{to_compare_prop:`blockSignature ${t}`,be_compare_prop:`blockSignature ${e.asset.grabAsset.blockSignature}`,to_target:"grabAsset",be_target:"blockChain"})}isDependentTransactionMatch(e,t){const r=e.asset.grabAsset,{giftAsset:n,ciphertextSignature:s}=r,{sourceChainMagic:o,sourceChainName:a,assetType:p,amount:l,giftDistributionRule:f,totalGrabableTimes:g,cipherPublicKeys:d,beginUnfrozenBlockHeight:y}=n,m=t.asset.giftAsset;if(m.sourceChainMagic!==o||m.sourceChainName!==a||m.assetType!==p||m.totalGrabableTimes!==g||m.amount!==l||m.giftDistributionRule!==f)throw new ar(c.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(m)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"});if(m.beginUnfrozenBlockHeight!==void 0){if(y===void 0)throw new ar(c.PROP_IS_REQUIRE,{prop:"beginUnfrozenBlockHeight",target:"grabAsset.giftAsset"});if(m.beginUnfrozenBlockHeight!==y)throw new ar(c.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(m)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"})}else if(y!==void 0)throw new ar(c.SHOULD_NOT_EXIST,{prop:"beginUnfrozenBlockHeight",target:"grabAsset.giftAsset"});if(m.cipherPublicKeys.length!==d.length)throw new ar(c.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(m)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"});for(const w of m.cipherPublicKeys)if(!d.includes(w))throw new ar(c.NOT_MATCH,{to_compare_prop:`grabAsset.giftAsset: ${JSON.stringify(n.toJSON())}`,be_compare_prop:`giftAsset: ${JSON.stringify(m)}`,to_target:"GrabAssetTransaction",be_target:"GiftAssetTransaction"});if(d.length>0){if(!s)throw new ar(c.PROP_IS_REQUIRE,{prop:"ciphertextSignature",target:"grabAsset"});const{publicKey:w}=s;if(!d.includes(w))throw new ar(c.NOT_MATCH,{to_compare_prop:`publicKey ${w}`,be_compare_prop:"cipherPublicKeys",to_target:"grabAsset.ciphertextSignature",be_target:"giftAsset.cipherPublicKeys"})}else if(s)throw new ar(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"grabAsset"});const{rangeType:E,range:T}=t;if(E&1){if(!T.includes(e.senderId))throw new ar(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"grabAssetTransaction",be_compare_prop:"giftAssetTransaction.range"})}else if(E&2){if(!e.dappid||!T.includes(e.dappid))throw new ar(c.SHOULD_BE,{to_compare_prop:`dappid ${e.dappid}`,to_target:"grabAssetTransaction",be_compare_prop:"giftAssetTransaction.range"})}else if(E&4&&(!e.lns||!T.includes(e.lns)))throw new ar(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"grabAssetTransaction",be_compare_prop:"giftAssetTransaction.range"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.fee,this.transactionHelper.calcTransactionBlobFee(e).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.fee,this.transactionHelper.calcTransactionBlobFee(e,r).toString())}async checkSecondaryTransaction(e,t,r){if(await r.checkSecondaryTransaction({senderId:e.senderId,storageValue:e.storageValue,heightRange:this.transactionHelper.calcTransactionQueryRange(t)}))throw new ar(c.CAN_NOT_SECONDARY_TRANSACTION,{reason:`Can not secondary grab asset, sender ${e.senderId} gift transaction signature ${e.storageValue}`})}getLockData(e){const{transactionSignature:t}=e.asset.grabAsset;return[t]}};ud=h([j(),u("design:paramtypes",[])],ud);const{ConsensusException:Lt,NoFoundException:Aw}=re("VERIFIER","GrabAnyLogicVerifier");let fd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const o=e.asset.grabAny,{transactionSignature:a,giftAny:p}=o,l=await s.getTransactionAndBlockSignatureBySignature(a,this.transactionHelper.calcTransactionQueryRange(t));if(!l)throw new Aw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${a}`,target:"grabAny"});const f=l.transaction;if(f.type!==this.transactionHelper.GIFT_ANY)throw new Lt(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${a}`});this.isValidRecipientId(e,f),this.isBlockSignatureMatch(e,l.blockSignature),this.isDependentTransactionMatch(e,f),await this.isValidAmount(e);const{sender:g,recipient:d}=await this.logicVerify(e,t,r,n,s),y={[e.senderId]:this.helperLogicVerifier.deepClone(g.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(g.accountInfo),d&&d.accountInfo&&d.accountAssets){const b=d.accountInfo.address;y[b]=this.helperLogicVerifier.deepClone(d.accountAssets),this.helperLogicVerifier.deepClone(d.accountInfo)}const m=new ve,{eventLogicVerifier:E}=this;E.listenEventFee(y,m);const{parentAssetType:T,taxInformation:w}=p;return T===L.ASSETS?E.listenEventUnfrozenAsset(t,n,m):T===L.DAPP?E.listenEventUnfrozenDApp(t,n,m):T===L.LOCATION_NAME?E.listenEventUnfrozenLocationName(t,n,m):T===L.ENTITY?(E.listenEventUnfrozenEntity(t,n,m),w&&(w.taxAssetPrealnum==="0"?(E.listenEventAsset(y,m),E.listenEventPayTax(t,n,m)):E.listenEventUnfrozenAsset(t,n,m))):T===L.CERTIFICATE&&E.listenEventUnfrozenCertificate(t,n,m),await E.awaitEventResult(e,m),!0}async isValidAmount(e){const{senderId:t,recipientId:r,asset:n}=e,s=n.grabAny,{giftAny:o,blockSignatureBuffer:a,transactionSignatureBuffer:p}=s,{giftDistributionRule:l,parentAssetType:f,totalGrabableTimes:g,amount:d}=o;if(f===L.ASSETS){let y;switch(l){case 0:y=this.transactionHelper.calcGrabAverageGiftAssetNumber(d,g);break;case 1:y=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,a,p,r,d,g);break;case 2:y=await this.transactionHelper.calcGrabRandomGiftAssetNumber(t,a,p,r,d,g);break}if(!y)throw new Lt(c.PROP_IS_INVALID,{prop:"calculate amount",target:"giftAsset"});if(y.toString()!==s.amount)throw new Lt(c.SHOULD_BE,{to_compare_prop:`amount ${s.amount}`,to_target:"grabAny",be_compare_prop:y.toString()})}else if(s.amount!=="1")throw new Lt(c.SHOULD_BE,{to_compare_prop:`amount ${s.amount}`,to_target:"giftAny",be_compare_prop:"1"})}isValidRecipientId(e,t){if(e.recipientId!==t.senderId)throw new Lt(c.NOT_MATCH,{to_compare_prop:`GrabAnyTransaction.recipientId ${e.recipientId}`,be_compare_prop:`GiftAnyTransaction.senderId ${t.senderId}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"})}isBlockSignatureMatch(e,t){if(t!==e.asset.grabAny.blockSignature)throw new Lt(c.NOT_MATCH,{to_compare_prop:`blockSignature ${t}`,be_compare_prop:`blockSignature ${e.asset.grabAny.blockSignature}`,to_target:"grabAny",be_target:"blockChain"})}isDependentTransactionMatch(e,t){const{giftAny:r,ciphertextSignature:n}=e.asset.grabAny,{sourceChainMagic:s,sourceChainName:o,assetType:a,amount:p,giftDistributionRule:l,totalGrabableTimes:f,beginUnfrozenBlockHeight:g,taxInformation:d,cipherPublicKeys:y}=r,m=t.asset.giftAny;if(m.sourceChainMagic!==s||m.sourceChainName!==o||m.assetType!==a||m.amount!==p||m.giftDistributionRule!==l||m.totalGrabableTimes!==f)throw new Lt(c.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(m)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"});if(m.beginUnfrozenBlockHeight!==void 0){if(g===void 0)throw new Lt(c.PROP_IS_REQUIRE,{prop:"beginUnfrozenBlockHeight",target:"grabAny.giftAny"});if(m.beginUnfrozenBlockHeight!==g)throw new Lt(c.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(m)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"})}else if(g!==void 0)throw new Lt(c.SHOULD_NOT_EXIST,{prop:"beginUnfrozenBlockHeight",target:"grabAny.giftAny"});if(m.taxInformation){if(!d)throw new Lt(c.PROP_IS_REQUIRE,{prop:"taxInformation",target:"grabAny.giftAny"});if(m.taxInformation.taxAssetPrealnum!==d.taxAssetPrealnum||m.taxInformation.taxCollector!==d.taxCollector)throw new Lt(c.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(m)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"})}else if(d)throw new Lt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"grabAny.giftAny"});if(m.cipherPublicKeys.length!==y.length)throw new Lt(c.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(m)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"});for(const w of m.cipherPublicKeys)if(!y.includes(w))throw new Lt(c.NOT_MATCH,{to_compare_prop:`grabAny.giftAny: ${JSON.stringify(r.toJSON())}`,be_compare_prop:`giftAny: ${JSON.stringify(m)}`,to_target:"GrabAnyTransaction",be_target:"GiftAnyTransaction"});if(y.length>0){if(!n)throw new Lt(c.NOT_EXIST,{prop:"ciphertextSignature",target:"grabAny"});const{publicKey:w}=n;if(!y.includes(w))throw new Lt(c.NOT_MATCH,{to_compare_prop:`publicKey ${w}`,be_compare_prop:"cipherPublicKeys",to_target:"grabAny.ciphertextSignature",be_target:"giftAny.cipherPublicKeys"})}else if(n)throw new Lt(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"grabAny"});const{rangeType:E,range:T}=t;if(E&1){if(!T.includes(e.senderId))throw new Lt(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"grabAnyTransaction",be_compare_prop:"giftAnyTransaction.range"})}else if(E&2){if(!e.dappid||!T.includes(e.dappid))throw new Lt(c.SHOULD_BE,{to_compare_prop:`dappid ${e.dappid}`,to_target:"grabAnyTransaction",be_compare_prop:"giftAnyTransaction.range"})}else if(E&4&&(!e.lns||!T.includes(e.lns)))throw new Lt(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"grabAnyTransaction",be_compare_prop:"giftAnyTransaction.range"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.fee,this.transactionHelper.calcTransactionBlobFee(e).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.fee,this.transactionHelper.calcTransactionBlobFee(e,r).toString())}async checkSecondaryTransaction(e,t,r){if(await r.checkSecondaryTransaction({senderId:e.senderId,storageValue:e.storageValue,heightRange:this.transactionHelper.calcTransactionQueryRange(t)}))throw new Lt(c.CAN_NOT_SECONDARY_TRANSACTION,{reason:`Can not secondary grab asset, sender ${e.senderId} gift transaction signature ${e.storageValue}`})}getLockData(e){const{transactionSignature:t,giftAny:r}=e.asset.grabAny,{parentAssetType:n,assetType:s,taxInformation:o}=r,a=[t];return(n===L.DAPP||n===L.LOCATION_NAME||n===L.ENTITY)&&(a.push(s),o&&a.push(o.taxCollector)),a}};fd=h([j(),u("design:paramtypes",[])],fd);const{ConsensusException:aA}=re("VERIFIER","TrustAssetLogicVerifier");let gd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:o,assetType:a,sourceChainName:p,numberOfSignFor:l}=e.asset.trustAsset;if(!(o===this.configHelper.magic&&a===this.configHelper.assetType))throw new aA(c.TRUST_MAIN_ASSET_ONLY,{assetType:a,mainAsset:this.configHelper.assetType,errorId:be.TRUST_MAIN_ASSET_ONLY});await this.isTrusteesFrozen(e.asset.trustAsset.trustees,n),await this.helperLogicVerifier.isAssetExist(p,o,a,n);const{sender:f,recipient:g}=await this.logicVerify(e,t,r,n,s),d={[e.senderId]:this.helperLogicVerifier.deepClone(f.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(f.accountInfo),g&&g.accountInfo&&g.accountAssets){const E=g.accountInfo.address;d[E]=this.helperLogicVerifier.deepClone(g.accountAssets),this.helperLogicVerifier.deepClone(g.accountInfo)}const y=new ve,{eventLogicVerifier:m}=this;return m.listenEventFee(d,y),m.listenEventFrozenAsset(d,y),await m.awaitEventResult(e,y),!0}async isTrusteesFrozen(e,t){for(const r of e){const n=await t.getAccountInfo(r);if(n&&n.accountStatus!==0)throw new aA(c.ACCOUNT_FROZEN,{address:n.address,errorId:be.TRANSACTION_SENDER_ASSET_FROZEN})}}checkTrsFeeAndWebFee(e,t){const r=e.asset.trustAsset.numberOfSignFor+1;return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(r)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const n=e.asset.trustAsset.numberOfSignFor+1;return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMaxBytes(n,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}};gd=h([j(),u("design:paramtypes",[])],gd);const{ConsensusException:Ui}=re("VERIFIER","SignForAssetLogicVerifier");let dd=class extends Le{constructor(e){super(),this.accountBaseHelper=e}async verify(e,t,r,n,s){const{transactionSignature:o}=e.asset.signForAsset,a=await s.getTransactionBySignature(o,this.transactionHelper.calcTransactionQueryRange(t));if(!a)throw new Ui(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${o}`,target:"blockChain"});if(a.type!==this.transactionHelper.TRUST_ASSET)throw new Ui(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${o}`});await this.isDependentTransactionMatch(e,a);const{sender:p,recipient:l}=await this.logicVerify(e,t,r,n,s),f={[e.senderId]:this.helperLogicVerifier.deepClone(p.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(p.accountInfo),l&&l.accountInfo&&l.accountAssets){const y=l.accountInfo.address;f[y]=this.helperLogicVerifier.deepClone(l.accountAssets),this.helperLogicVerifier.deepClone(l.accountInfo)}const g=new ve,{eventLogicVerifier:d}=this;return d.listenEventFee(f,g),d.listenEventSignForAsset(t,n,g),await d.awaitEventResult(e,g),!0}async isDependentTransactionMatch(e,t){const{trustAsset:r,trustSenderId:n,trustRecipientId:s}=e.asset.signForAsset,o=t.asset.trustAsset;if(n!==t.senderId)throw new Ui(c.SHOULD_BE,{to_compare_prop:`trustSenderId ${n}`,be_compare_prop:`trustSenderId ${t.senderId}`,to_target:"SignForAssetTransaction.asset.signForAsset",be_target:"TrustAssetTransaction"});if(s!==t.recipientId)throw new Ui(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`recipientId ${t.recipientId}`,to_target:"SignForAssetTransaction",be_target:"TrustAssetTransaction"});if(o.sourceChainMagic!==r.sourceChainMagic||o.sourceChainName!==r.sourceChainName||o.assetType!==r.assetType||o.amount!==r.amount||o.numberOfSignFor!==r.numberOfSignFor||o.trustees.length!==r.trustees.length)throw new Ui(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(o)}`,be_compare_prop:`trustAsset: ${JSON.stringify(r.toJSON())}`,to_target:"SignForAssetTransaction.asset.signForAsset",be_target:"TrustAssetTransaction.asset.trustAsset"});const a=[...o.trustees],p=[...r.trustees];for(const l of a)if(!p.includes(l))throw new Ui(c.NOT_MATCH,{to_compare_prop:`trustees: ${JSON.stringify(p)}`,be_compare_prop:`address: ${l}`,to_target:"SignForAssetTransaction.asset.signForAsset.trustAsset",be_target:"TrustAssetTransaction.asset.trustAsset"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.fee,this.transactionHelper.calcTransactionBlobFee(e).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.fee,this.transactionHelper.calcTransactionBlobFee(e,r).toString())}async checkSecondaryTransaction(e,t,r){if(await r.checkSecondaryTransaction({senderId:e.senderId,storageValue:e.storageValue,heightRange:this.transactionHelper.calcTransactionQueryRange(t)}))throw new Ui(c.CAN_NOT_SECONDARY_TRANSACTION,{reason:`Can not secondary sign for asset, sender ${e.senderId} trust transaction signature ${e.storageValue}`})}getLockData(e){return[e.asset.signForAsset.transactionSignature]}};dd=h([j(),Oe(0,J(de)),u("design:paramtypes",[de])],dd);let yd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const o=e.asset.toExchangeAsset;await this.isExchangeAssetAlreadyExist(o,n);const{sender:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(a.accountAssets)},l=new ve,{eventLogicVerifier:f}=this;return f.listenEventFee(p,l),f.listenEventFrozenAsset(p,l),await f.awaitEventResult(e,l),!0}async isExchangeAssetAlreadyExist(e,t){const{toExchangeSource:r,toExchangeChainName:n,toExchangeAsset:s,beExchangeSource:o,beExchangeChainName:a,beExchangeAsset:p}=e;await this.helperLogicVerifier.isAssetExist(n,r,s,t),await this.helperLogicVerifier.isAssetExist(a,o,p,t)}};yd=h([j(),u("design:paramtypes",[])],yd);const{ConsensusException:cr,NoFoundException:Ew}=re("VERIFIER","TransactionLogicVerifier");let md=class extends Le{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){const o=e.asset.beExchangeAsset,{transactionSignature:a}=o,p=await s.getTransactionBySignature(a,this.transactionHelper.calcTransactionQueryRange(t));if(!p)throw new Ew(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${a}`,target:"blockChain"});if(p.type!==this.transactionHelper.TO_EXCHANGE_ASSET)throw new cr(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${a}`});this.isValidRecipientId(e,p),this.isDependentTransactionMatch(e,p);const{sender:l,recipient:f}=await this.logicVerify(e,t,r,n,s),g={[e.senderId]:this.helperLogicVerifier.deepClone(l.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(l.accountInfo),f&&f.accountInfo&&f.accountAssets){const m=f.accountInfo.address;g[m]=this.helperLogicVerifier.deepClone(f.accountAssets),this.helperLogicVerifier.deepClone(f.accountInfo)}const d=new ve,{eventLogicVerifier:y}=this;return y.listenEventFee(g,d),y.listenEventAsset(g,d),y.listenEventUnfrozenAsset(t,n,d),await y.awaitEventResult(e,d),!0}isValidRecipientId(e,t){if(e.recipientId!==t.senderId)throw new cr(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${t.senderId}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"})}isDependentTransactionMatch(e,t){const r=e.asset.beExchangeAsset,{exchangeAsset:n,ciphertextSignature:s,toExchangeNumber:o,beExchangeNumber:a}=r,{cipherPublicKeys:p,exchangeRate:l}=n,f=t.asset.toExchangeAsset;if(f.toExchangeSource!==n.toExchangeSource||f.beExchangeSource!==n.beExchangeSource||f.toExchangeChainName!==n.toExchangeChainName||f.beExchangeChainName!==n.beExchangeChainName||f.toExchangeAsset!==n.toExchangeAsset||f.beExchangeAsset!==n.beExchangeAsset||f.toExchangeNumber!==n.toExchangeNumber)throw new cr(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(f)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});if(f.exchangeRate){if(!l)throw new cr(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(f)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});if(f.exchangeRate.prevWeight!==l.prevWeight||f.exchangeRate.nextWeight!==l.nextWeight)throw new cr(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(f)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"})}else if(l)throw new cr(c.SHOULD_NOT_EXIST,{prop:"exchangeRate",target:"BeExchangeAssetTransaction.beExchangeAsset.exchangeAsset"});if(e.senderId===e.recipientId){if(o==="0")throw new cr(c.PROP_SHOULD_GT_FIELD,{prop:`toExchangeNumber ${o}`,field:"0",target:"BeExchangeAssetTransaction.beExchangeAsset"});if(a!=="0")throw new cr(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeNumber ${a}`,field:"0",target:"BeExchangeAssetTransaction.beExchangeAsset"})}else{if(o==="0"&&a==="0")throw new cr(c.PROP_SHOULD_GT_FIELD,{prop:`beExchangeNumber ${a}`,field:"0",target:"beExchangeAsset"});const y=this.jsbiHelper.multiplyRoundFraction(o,{numerator:n.exchangeRate.nextWeight,denominator:n.exchangeRate.prevWeight});if(y>BigInt(a))throw new cr(c.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeNumber ${a}`,field:y.toString(),target:"BeExchangeAssetTransaction.beExchangeAsset"})}if(f.cipherPublicKeys.length!==p.length)throw new cr(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(f)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});for(const y of f.cipherPublicKeys)if(!p.includes(y))throw new cr(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(f)}`,be_compare_prop:`exchangeAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAssetTransaction",be_target:"ToExchangeAssetTransaction"});if(p.length>0){if(!s)throw new cr(c.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAsset"});const{publicKey:y}=s;if(!p.includes(y))throw new cr(c.NOT_MATCH,{to_compare_prop:`publicKey ${y}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAsset.ciphertextSignature",be_target:"toExchangeAsset.cipherPublicKeys"})}else if(s)throw new cr(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAsset"});const{rangeType:g,range:d}=t;if(g&1){if(!d.includes(e.senderId))throw new cr(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAssetTransaction",be_compare_prop:"toExchangeAssetTransaction.range"})}else if(g&2){if(!e.dappid||!d.includes(e.dappid))throw new cr(c.SHOULD_BE,{to_compare_prop:`dappid ${e.dappid}`,to_target:"beExchangeAssetTransaction",be_compare_prop:"toExchangeAssetTransaction.range"})}else if(g&4&&(!e.lns||!d.includes(e.lns)))throw new cr(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAssetTransaction",be_compare_prop:"toExchangeAssetTransaction.range"})}getLockData(e){return[e.asset.beExchangeAsset.transactionSignature]}};md=h([j(),u("design:paramtypes",[It])],md);const{ConsensusException:cA}=re("VERIFIER","ToExchangeSpecialAssetLogicVerifier");let _d=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const o=e.asset.toExchangeSpecialAsset,{toExchangeChainName:a,toExchangeSource:p,toExchangeAsset:l,beExchangeSource:f,beExchangeChainName:g,beExchangeAsset:d,exchangeDirection:y,exchangeAssetType:m}=o;if(y===0)await this.helperLogicVerifier.isAssetExist(g,f,d,n);else if(y===1)await this.helperLogicVerifier.isAssetExist(a,p,l,n);else throw new cA(c.PROP_IS_INVALID,{prop:"exchangeDirection",target:"toExchangeSpecialAssetAsset"});const{sender:E}=await this.logicVerify(e,t,r,n,s),T={[e.senderId]:this.helperLogicVerifier.deepClone(E.accountAssets)},w=new ve,{eventLogicVerifier:b}=this;if(b.listenEventFee(T,w),y===1){if(m===1&&d.split(",").length>2)throw new cA(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);b.listenEventFrozenAsset(T,w)}else m===0?b.listenEventFrozenDApp(t,n,w):m===1?b.listenEventFrozenLocationName(t,n,w):m===2&&b.listenEventFrozenEntity(t,n,w);return await b.awaitEventResult(e,w),!0}getLockData(e){const{exchangeAssetType:t,exchangeDirection:r,toExchangeAsset:n}=e.asset.toExchangeSpecialAsset,s=[];return r===0&&(t===0||t===1||t===2)&&s.push(n),s}};_d=h([j(),u("design:paramtypes",[])],_d);const{ConsensusException:_n,NoFoundException:Iw}=re("VERIFIER","BeExchangeSpecialAssetLogicVerifier");let Ad=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const o=e.asset.beExchangeSpecialAsset,{transactionSignature:a}=o,p=await s.getTransactionBySignature(a,this.transactionHelper.calcTransactionQueryRange(t));if(!p)throw new Iw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${a}`,target:"blockChain"});if(p.type!==this.transactionHelper.TO_EXCHANGE_SPECIAL_ASSET)throw new _n(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${a}`});this.isValidRecipientId(e,p),this.isDependentTransactionMatch(e,p);const{sender:l,recipient:f}=await this.logicVerify(e,t,r,n,s),g={[e.senderId]:this.helperLogicVerifier.deepClone(l.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(l.accountInfo),f&&f.accountInfo&&f.accountAssets){const T=f.accountInfo.address;g[T]=this.helperLogicVerifier.deepClone(f.accountAssets),this.helperLogicVerifier.deepClone(f.accountInfo)}const d=new ve,{eventLogicVerifier:y}=this;y.listenEventFee(g,d);const{exchangeDirection:m,exchangeAssetType:E}=e.asset.beExchangeSpecialAsset.exchangeSpecialAsset;return m===1?(y.listenEventUnfrozenAsset(t,n,d),E===0?y.listenEventChangeDAppPossessor(t,n,d):E===1?y.listenEventChangeLocationNamePossessor(t,n,d):E===2&&y.listenEventChangeEntityPossessor(t,n,d)):(y.listenEventAsset(g,d),E===0?y.listenEventUnfrozenDApp(t,n,d):E===1?y.listenEventUnfrozenLocationName(t,n,d):E===2&&y.listenEventUnfrozenEntity(t,n,d)),await y.awaitEventResult(e,d),!0}isValidRecipientId(e,t){if(e.recipientId!==t.senderId)throw new _n(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${t.senderId}`,to_target:"BeExchangeSpecialAssetTransaction",be_target:"ToExchangeSpecialAssetTransaction"})}isDependentTransactionMatch(e,t){const r=e.asset.beExchangeSpecialAsset,{exchangeSpecialAsset:n,ciphertextSignature:s}=r,{toExchangeSource:o,toExchangeAsset:a,beExchangeSource:p,beExchangeAsset:l,toExchangeChainName:f,beExchangeChainName:g,exchangeNumber:d,exchangeAssetType:y,exchangeDirection:m,cipherPublicKeys:E}=n,T=t.asset.toExchangeSpecialAsset;if(T.toExchangeSource!==o||T.beExchangeSource!==p||T.toExchangeAsset!==a||T.beExchangeAsset!==l||T.toExchangeChainName!==f||T.beExchangeChainName!==g||T.exchangeNumber!==d||T.exchangeAssetType!==y||T.exchangeDirection!==m)throw new _n(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(T)}`,be_compare_prop:`exchangeSpecialAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeSpecialAssetTransaction",be_target:"ToExchangeSpecialAssetTransaction"});if(T.cipherPublicKeys.length!==E.length)throw new _n(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(T)}`,be_compare_prop:`exchangeSpecialAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeSpecialAssetTransaction",be_target:"ToExchangeSpecialAssetTransaction"});for(const C of T.cipherPublicKeys)if(!E.includes(C))throw new _n(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(T)}`,be_compare_prop:`exchangeSpecialAsset: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeSpecialAssetTransaction",be_target:"ToExchangeSpecialAssetTransaction"});if(E.length>0){if(!s)throw new _n(c.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeSpecialAsset"});const{publicKey:C}=s;if(!E.includes(C))throw new _n(c.NOT_MATCH,{to_compare_prop:`publicKey ${C}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeSpecialAsset.ciphertextSignature",be_target:"toExchangeSpecialAsset.cipherPublicKeys"})}else if(s)throw new _n(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeSpecialAsset"});const{rangeType:w,range:b}=t;if(w&1){if(!b.includes(e.senderId))throw new _n(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeSpecialAssetTransaction",be_compare_prop:"teExchangeSpecialAssetTransaction.range"})}else if(w&2){if(!e.dappid||!b.includes(e.dappid))throw new _n(c.SHOULD_BE,{to_compare_prop:`dappid ${e.senderId}`,to_target:"beExchangeSpecialAssetTransaction",be_compare_prop:"teExchangeSpecialAssetTransaction.range"})}else if(w&4&&(!e.lns||!b.includes(e.lns)))throw new _n(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeSpecialAssetTransaction",be_compare_prop:"teExchangeSpecialAssetTransaction.range"})}async checkSecondaryTransaction(e,t,r){if(await r.checkSecondaryTransaction({senderId:e.senderId,storageValue:e.storageValue,heightRange:this.transactionHelper.calcTransactionQueryRange(t)}))throw new _n(c.CAN_NOT_SECONDARY_TRANSACTION,{reason:`Can not secondary exchange special asset, sender ${e.senderId} exchange transaction signature ${e.storageValue}`})}getLockData(e){const{transactionSignature:t,exchangeSpecialAsset:r}=e.asset.beExchangeSpecialAsset,{exchangeAssetType:n,exchangeDirection:s,toExchangeAsset:o,beExchangeAsset:a}=r,p=[t];return s===0?(n===0||n===1||n===2)&&p.push(o):(n===0||n===1||n===2)&&p.push(a),p}};Ad=h([j(),u("design:paramtypes",[])],Ad);const{ConsensusException:en}=re("VERIFIER","EmigrateAssetLogicVerifier");let Ed=class extends Le{constructor(e,t,r){super(),this.accountBaseHelper=e,this.configMap=t,this.migrateCertificateHelper=r}async verify(e,t,r,n,s){if(r.sender.accountInfo.isDelegate)throw new en(c.DELEGATE_CAN_NOT_MIGRATE_ASSET);const{senderId:o,toMagic:a}=e;let p;try{p=JSON.parse(e.asset.emigrateAsset.migrateCertificate)}catch{throw new en(c.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const l=this.migrateCertificateHelper.getMigrateCertificateConverter(p),f=p.body,g=l.assetId.decode(f.assetId,!0),y=l.fromChainId.decode(f.fromChainId,!0).magic;if(!(y===this.configHelper.magic&&g.assetType===this.configHelper.assetType))throw new en(c.MIGRATE_MAIN_ASSET_ONLY,{assetType:g.assetType,mainAsset:this.configHelper.assetType,errorId:be.MIGRATE_MAIN_ASSET_ONLY});const m=await n.getChain(a);if(!m)throw new en(c.NOT_EXIST,{prop:`Chain with magic ${a}`,target:"blockChain"});const E=m.genesisBlock,T=l.toChainId.decode(f.toChainId,!0);await this.migrateCertificateHelper.checkChainInfo("toChain",T,{chainName:E.chainName,magic:E.magic,generatorPublicKey:E.genesisAccount.publicKey,genesisBlockSignature:E.genesisBlockSignature,genesisDelegates:E.genesisDelegates.map(W=>W.address)});const{publicKey:w,secondPublicKey:b,signSignature:C}=l.fromAuthSignature.decode(p.fromAuthSignature,!0),N=await this.accountBaseHelper.getAddressFromPublicKeyString(w),O=await n.getAccountInfo(N);if(!O)throw new en(c.NOT_EXIST,{prop:`Account with address ${N}`,target:"blockChain"});if(O.secondPublicKey){if(!b)throw new en(c.PROP_IS_REQUIRE,{prop:"secondPublicKey",target:"genesisDelegateSignature"});if(!C)throw new en(c.PROP_IS_REQUIRE,{prop:"signSignature",target:"genesisDelegateSignature"});if(O.secondPublicKey!==b)throw new en(c.NOT_MATCH,{to_compare_prop:`secondPublicKey ${O.secondPublicKey}`,be_compare_prop:`secondPublicKey ${b}`,to_target:"transaction",be_target:"delegate"})}else{if(b)throw new en(c.CAN_NOT_CARRY_SECOND_PUBLICKEY);if(C)throw new en(c.CAN_NOT_CARRY_SECOND_SIGNATURE,{signature:e.signature,senderId:e.senderId,applyBlockHeight:e.applyBlockHeight,type:e.type})}const{sender:R,recipient:F}=await this.logicVerify(e,t,r,n,s),z={[o]:this.helperLogicVerifier.deepClone(R.accountAssets)},K={[o]:this.helperLogicVerifier.deepClone(R.accountInfo)};if(F&&F.accountInfo&&F.accountAssets){const W=F.accountInfo.address;z[W]=this.helperLogicVerifier.deepClone(F.accountAssets),K[W]=this.helperLogicVerifier.deepClone(F.accountInfo)}const B=new ve,{eventLogicVerifier:M}=this;M.listenEventFee(z,B),M.listenEventFrozenAccount(K,B),await M.awaitEventResult(e,B);const V=R.accountAssets;if(await n.isVoteRecently(o,this.blockHelper.calcRoundByHeight(t)))throw new en(c.VOTE_RECENTLY);if(await n.isFrozenAsset(o))throw new en(c.POSSESS_FROZEN_ASSET);if(await this.helperLogicVerifier.isPossessAssetExceptChainAsset(o,V,n),await this.helperLogicVerifier.isDAppPossessor(o,this.configHelper,n),await this.helperLogicVerifier.isLnsPossessorOrManager(o,this.configHelper,n),await this.helperLogicVerifier.isEntityFactoryPossessor(N,this.configHelper,n),await this.helperLogicVerifier.isEntityPossessor(N,this.configHelper,n),g.parentAssetType===L.ASSETS){const W=g.assetType===this.configHelper.assetType?BigInt(e.fee)+BigInt(f.assetPrealnum):BigInt(f.assetPrealnum);if(V[y][g.assetType].assetNumber!==W)throw new en(c.NEED_EMIGRATE_TOTAL_ASSET,{address:o})}return!0}};Ed=h([j(),Oe(0,J(de)),u("design:paramtypes",[de,Tr,js])],Ed);const{ConsensusException:ii,NoFoundException:_P}=re("VERIFIER","ImmigrateAssetLogicVerifier");let Id=class extends Le{constructor(e,t,r,n){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.configMap=r,this.migrateCertificateHelper=n}async verify(e,t,r,n,s){let o;try{o=JSON.parse(e.asset.immigrateAsset.migrateCertificate)}catch{throw new ii(c.PROP_IS_INVALID,{prop:"migrateCertificate",target:"transaction.asset.immigrateAsset"})}const a=this.migrateCertificateHelper.getMigrateCertificateConverter(o),p=a.fromChainId.decode(o.body.fromChainId,!0),l=e.fromMagic,f=await n.getChain(l);if(!f)throw new ii(c.NOT_EXIST,{prop:`Chain with magic ${p.magic}`,target:"blockChain"});const g=f.genesisBlock;await this.migrateCertificateHelper.checkChainInfo("fromChain",p,{chainName:g.chainName,magic:g.magic,generatorPublicKey:g.genesisAccount.publicKey,genesisBlockSignature:g.genesisBlockSignature,genesisDelegates:g.genesisDelegates.map(O=>O.address)});const{publicKey:d,secondPublicKey:y,signSignature:m}=a.toAuthSignature.decode(o.toAuthSignature,!0),E=await this.accountBaseHelper.getAddressFromPublicKeyString(d),T=await n.getAccountInfo(E);if(!T)throw new ii(c.NOT_EXIST,{prop:`Account with address ${E}`,target:"blockChain"});if(T.secondPublicKey){if(!y)throw new ii(c.PROP_IS_REQUIRE,{prop:"secondPublicKey",target:"genesisDelegateSignature"});if(!m)throw new ii(c.PROP_IS_REQUIRE,{prop:"signSignature",target:"genesisDelegateSignature"});if(T.secondPublicKey!==y)throw new ii(c.NOT_MATCH,{to_compare_prop:`secondPublicKey ${T.secondPublicKey}`,be_compare_prop:`secondPublicKey ${y}`,to_target:"transaction",be_target:"delegate"})}else{if(y)throw new ii(c.CAN_NOT_CARRY_SECOND_PUBLICKEY);if(m)throw new ii(c.CAN_NOT_CARRY_SECOND_SIGNATURE)}const{sender:w}=await this.logicVerify(e,t,r,n,s),b={[e.senderId]:this.helperLogicVerifier.deepClone(w.accountAssets)},C=new ve,{eventLogicVerifier:N}=this;return N.listenEventFee(b,C),N.listenEventAsset(b,C),N.listenEventMigrateCertificate(n,C),await N.awaitEventResult(e,C),!0}};Id=h([j(),Oe(0,J(de)),Oe(1,J(me)),u("design:paramtypes",[de,me,Tr,js])],Id);let Td=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(o.accountInfo),a&&a.accountInfo&&a.accountAssets){const d=a.accountInfo.address;p[d]=this.helperLogicVerifier.deepClone(a.accountAssets),this.helperLogicVerifier.deepClone(a.accountInfo)}const l=new ve,{eventLogicVerifier:f}=this;return f.listenEventFee(p,l),e.asset.locationName.operationType===0?f.listenEventRegisterLocationName(t,n,l):f.listenEventCancelLocationName(t,n,l),await f.awaitEventResult(e,l),!0}getLockData(e){return[e.asset.locationName.name]}};Td=h([j(),u("design:paramtypes",[])],Td);let Sd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(o.accountInfo),a&&a.accountInfo&&a.accountAssets){const g=a.accountInfo.address;p[g]=this.helperLogicVerifier.deepClone(a.accountAssets),this.helperLogicVerifier.deepClone(a.accountInfo)}const l=new ve,{eventLogicVerifier:f}=this;return f.listenEventFee(p,l),f.listenEventSetLnsManager(t,n,l),await f.awaitEventResult(e,l),!0}getLockData(e){return[e.asset.lnsManager.name]}};Sd=h([j(),u("design:paramtypes",[])],Sd);let wd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p=new ve,{eventLogicVerifier:l}=this;return l.listenEventFee(a,p),l.listenEventSetLnsRecordValue(t,n,p),await l.awaitEventResult(e,p),!0}getLockData(e){return[e.asset.lnsRecordValue.name]}};wd=h([j(),u("design:paramtypes",[])],wd);let bd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountInfo)},l=new ve,{eventLogicVerifier:f}=this;f.listenEventFee(a,l),f.listenEventFrozenAccount(p,l);const g=this.helperLogicVerifier.deepClone(o.accountAssets);return f.listenEventRegisterChain(g,n,l),await f.awaitEventResult(e,l),!0}getLockData(e){return[e.type]}};bd=h([j(),u("design:paramtypes",[])],bd);let Nd=class extends Le{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};if(a&&a.accountInfo&&a.accountAssets){const d=a.accountInfo.address;p[d]=this.helperLogicVerifier.deepClone(a.accountAssets)}const l={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountInfo)},f=new ve;this.eventLogicVerifier.listenEventFee(p,f),this.eventLogicVerifier.listenEventFrozenAccount(l,f);const g=this.helperLogicVerifier.deepClone(o.accountAssets);return this.eventLogicVerifier.listenEventIssueEntityFactoryByFrozen(g,t,n,f),await this.eventLogicVerifier.awaitEventResult(e,f),!0}getLockData(e){return[e.type]}};Nd=h([j(),Oe(0,J(de)),Oe(1,J(me)),u("design:paramtypes",[de,me])],Nd);let xd=class extends Le{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};if(a&&a.accountInfo&&a.accountAssets){const g=a.accountInfo.address;p[g]=this.helperLogicVerifier.deepClone(a.accountAssets)}const l=new ve,{eventLogicVerifier:f}=this;return f.listenEventFee(p,l),f.listenEventDestroyMainAsset(p,n,l),f.listenEventIssueEntityFactoryByDestroy(t,n,l),await f.awaitEventResult(e,l),!0}getLockData(e){return[e.type]}};xd=h([j(),Oe(0,J(de)),Oe(1,J(me)),u("design:paramtypes",[de,me])],xd);let pA=class extends Le{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};if(a&&a.accountInfo&&a.accountAssets){const g=a.accountInfo.address;p[g]=this.helperLogicVerifier.deepClone(a.accountAssets)}const l=new ve;this.eventLogicVerifier.listenEventFee(p,l),this.eventLogicVerifier.listenEventFrozenAsset(p,l),this.eventLogicVerifier.listenEventAsset(p,l);const f=this.helperLogicVerifier.deepClone(o.accountAssets);return this.eventLogicVerifier.listenEventIssueEntity(f,t,n,l),await this.eventLogicVerifier.awaitEventResult(e,l),!0}getLockData(e){return[e.asset.issueEntity.entityFactoryPossessor]}};pA=h([j(),Oe(0,J(de)),Oe(1,J(me)),u("design:paramtypes",[de,me])],pA);let Od=class extends Le{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};if(a&&a.accountInfo&&a.accountAssets){const g=a.accountInfo.address;p[g]=this.helperLogicVerifier.deepClone(a.accountAssets)}const l=new ve;this.eventLogicVerifier.listenEventFee(p,l),this.eventLogicVerifier.listenEventFrozenAsset(p,l),this.eventLogicVerifier.listenEventAsset(p,l);const f=this.helperLogicVerifier.deepClone(o.accountAssets);return this.eventLogicVerifier.listenEventIssueEntityV1(f,t,n,l),await this.eventLogicVerifier.awaitEventResult(e,l),!0}getLockData(e){return[e.asset.issueEntity.entityFactoryPossessor]}};Od=h([j(),Oe(0,J(de)),Oe(1,J(me)),u("design:paramtypes",[de,me])],Od);const{ConsensusException:Ah,NoFoundException:Tw}=re("VERIFIER","DestroyEntityLogicVerifier");let Cd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const o=e.asset.destroyEntity,{transactionSignature:a}=o,p=await s.getTransactionAndBlockSignatureBySignature(a,this.transactionHelper.calcTransactionQueryRange(t));if(!p)throw new Tw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${a}`,target:"destroyEntity"});const l=p.transaction;if(l.type===this.transactionHelper.ISSUE_ENTITY){const m=l.asset.issueEntity;if(m.entityId!==o.entityId)throw new Ah(c.NOT_MATCH,{to_compare_prop:`entityId ${o.entityId}`,be_compare_prop:`entityId ${m.entityId}`,to_target:"transaction",be_target:"issueEntityTransaction"})}else if(l.type===this.transactionHelper.ISSUE_ENTITY_MULTI){const m=l.asset.issueEntityMulti.entityStructList.map(E=>E.entityId);if(!m.includes(o.entityId))throw new Ah(c.NOT_MATCH,{to_compare_prop:`entityId ${o.entityId}`,be_compare_prop:`entityId [${m.slice(0,3).join(",")}...]`,to_target:"transaction",be_target:"issueEntityMultiTransaction"})}else throw new Ah(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${a}`});if(e.recipientId!==l.senderId)throw new Ah(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`entityApplicant ${l.senderId}`,to_target:"transaction",be_target:"issueEntityTransaction"});const{sender:f,recipient:g}=await this.logicVerify(e,t,r,n,s),d={[e.senderId]:this.helperLogicVerifier.deepClone(f.accountAssets)};if(g&&g.accountInfo&&g.accountAssets){const m=g.accountInfo.address;d[m]=this.helperLogicVerifier.deepClone(g.accountAssets)}const y=new ve;return this.eventLogicVerifier.listenEventFee(d,y),this.eventLogicVerifier.listenEventUnfrozenAsset(t,n,y),this.eventLogicVerifier.listenEventDestroyEntity(t,n,y),await this.eventLogicVerifier.awaitEventResult(e,y),!0}getLockData(e){const{entityFactoryApplicant:t,entityFactoryPossessor:r,entityId:n}=e.asset.destroyEntity;return[t,r,n]}};Cd=h([j(),u("design:paramtypes",[])],Cd);const{NoFoundException:Sw,ArgumentIllegalException:ww,ConsensusException:bw}=re("VERIFIER","CustomLogicVerifier");let Rd=class extends Le{constructor(){super()}async verify(e,t,r,n,s,o=this.customTransactionCenter){const{sender:a,recipient:p,curRound:l}=await this.logicVerify(e,t,r,n,s),f={[e.senderId]:this.helperLogicVerifier.deepClone(a.accountAssets)},g={[e.senderId]:this.helperLogicVerifier.deepClone(a.accountInfo)};if(p&&p.accountInfo&&p.accountAssets){const T=p.accountInfo.address;f[T]=this.helperLogicVerifier.deepClone(p.accountAssets),g[T]=this.helperLogicVerifier.deepClone(p.accountInfo)}const d=new ve,{eventLogicVerifier:y,helperLogicVerifier:m}=this;if(y.listenEventFrozenAccount(g,d),y.listenEventSetSecondPublicKey(d),y.listenEventSetUsername(n,d),y.listenEventRegisterToDelegate(g,d),y.listenEventAcceptVote(g,d),y.listenEventRejectVote(g,d),y.listenEventVoteEquity(g,m.deepClone(a.accountAssets),l,d),y.listenEventIssueAsset(m.deepClone(a.accountAssets),n,d),y.listenEventFee(f,d),y.listenEventAsset(f,d),y.listenEventFrozenAsset(f,d),y.listenEventUnfrozenAsset(t,n,d),y.listenEventDestroyAsset(n,d),y.listenEventIssueDApp(t,n,d),y.listenEventFrozenDApp(t,n,d),y.listenEventUnfrozenDApp(t,n,d),y.listenEventChangeDAppPossessor(t,n,d),y.listenEventRegisterLocationName(t,n,d),y.listenEventCancelLocationName(t,n,d),y.listenEventFrozenLocationName(t,n,d),y.listenEventUnfrozenLocationName(t,n,d),y.listenEventChangeLocationNamePossessor(t,n,d),y.listenEventSetLnsManager(t,n,d),y.listenEventSetLnsRecordValue(t,n,d),y.listenEventIssueEntityFactoryByFrozen(m.deepClone(a.accountAssets),t,n,d),y.listenEventIssueEntity(m.deepClone(a.accountAssets),t,n,d),y.listenEventDestroyEntity(t,n,d),y.listenEventFrozenEntity(t,n,d),y.listenEventUnfrozenEntity(t,n,d),y.listenEventChangeEntityPossessor(t,n,d),y.listenEventRegisterChain(m.deepClone(a.accountAssets),n,d),y.listenEventMigrateCertificate(n,d),await y.awaitEventResult(e,d),!o)throw new Sw(c.NOT_EXIST,{prop:"customTransactionCenter",target:"moduleStroge"});const E=await o.logicVerify(e);if(!(E&&E.ret))throw new ww(c.PROP_IS_INVALID,{prop:"transaction",target:"transaction"});return!0}async checkRegisterDelegateQuota(e,t){const{maxDelegateTxsPerRound:r}=this.configHelper,n=await t.getNumberOfNewDelegate();let s=r;const o=this.blockHelper.calcRoundByHeight(e);if(e<this.configHelper.blockPerRound&&(s=s+this.configHelper.delegates),n>=s)throw new bw(c.REGISTER_DELEGTE_QUOTA_FULL,{round:o})}};Rd=h([j(),u("design:paramtypes",[])],Rd);const{ConsensusException:Eh}=re("VERIFIER","ToExchangeAnyLogicVerifier");let Pd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p=e.asset.toExchangeAny,{toExchangeChainName:l,toExchangeSource:f,toExchangeParentAssetType:g,toExchangeAssetType:d,beExchangeSource:y,beExchangeChainName:m,beExchangeParentAssetType:E,beExchangeAssetType:T}=p,w=new ve,{eventLogicVerifier:b}=this;if(b.listenEventFee(a,w),g===L.ASSETS)await this.helperLogicVerifier.isAssetExist(l,f,d,n),b.listenEventFrozenAsset(a,w);else if(g===L.DAPP)b.listenEventFrozenDApp(t,n,w);else if(g===L.LOCATION_NAME)b.listenEventFrozenLocationName(t,n,w);else if(g===L.ENTITY)b.listenEventFrozenEntity(t,n,w),b.listenEventFrozenAsset(a,w),b.listenEventPayTax(t,n,w);else if(g===L.CERTIFICATE)b.listenEventFrozenCertificate(t,n,w);else throw new Eh(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${g}`,target:"transaction.asset.toExchangeAny"});if(E===L.ASSETS)await this.helperLogicVerifier.isAssetExist(m,y,T,n);else if(E===L.DAPP)await this.helperLogicVerifier.isDAppExist(m,y,T,t,n);else if(E===L.LOCATION_NAME){if(T.split(",").length>2)throw new Eh(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);await this.helperLogicVerifier.isLocationNameExist(m,y,T,t,n)}else if(E===L.ENTITY){if((await this.helperLogicVerifier.isEntityExist(m,y,T,t,n)).status===255)throw new Eh(c.ENTITY_ALREADY_DESTROY,{entityId:T,reason:"Entity already be destroy"})}else if(E===L.CERTIFICATE)await this.helperLogicVerifier.isCertificateExist(m,y,T,t,n);else throw new Eh(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${E}`,target:"transaction.asset.toExchangeAny"});return await b.awaitEventResult(e,w),!0}getLockData(e){const{toExchangeParentAssetType:t,toExchangeAssetType:r}=e.asset.toExchangeAny,n=[];return(t===L.DAPP||t===L.LOCATION_NAME||t===L.ENTITY)&&n.push(r),n}};Pd=h([j(),u("design:paramtypes",[])],Pd);const{ConsensusException:pt,NoFoundException:Nw}=re("VERIFIER","BeExchangeAnyLogicVerifier");let Bd=class extends Le{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){const o=e.asset.beExchangeAny,{transactionSignature:a}=o,p=await s.getTransactionBySignature(a,this.transactionHelper.calcTransactionQueryRange(t));if(!p)throw new Nw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${a}`,target:"blockChain"});if(p.type!==this.transactionHelper.TO_EXCHANGE_ANY)throw new pt(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${a}`});if(e.recipientId!==p.senderId)throw new pt(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${p.senderId}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});this.isDependentTransactionMatch(e,p);const{sender:l,recipient:f}=await this.logicVerify(e,t,r,n,s),g={[e.senderId]:this.helperLogicVerifier.deepClone(l.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(l.accountInfo),f&&f.accountInfo&&f.accountAssets){const b=f.accountInfo.address;g[b]=this.helperLogicVerifier.deepClone(f.accountAssets),this.helperLogicVerifier.deepClone(f.accountInfo)}const d=new ve,{eventLogicVerifier:y}=this;y.listenEventFee(g,d);const{toExchangeParentAssetType:m,beExchangeParentAssetType:E,taxInformation:T}=o.exchangeAny;let w=!1;if(m===L.ASSETS)y.listenEventUnfrozenAsset(t,n,d);else if(m===L.DAPP)y.listenEventUnfrozenDApp(t,n,d);else if(m===L.LOCATION_NAME)y.listenEventUnfrozenLocationName(t,n,d);else if(m===L.ENTITY)y.listenEventUnfrozenEntity(t,n,d),T&&(T.taxAssetPrealnum==="0"?(y.listenEventAsset(g,d),w=!0):y.listenEventUnfrozenAsset(t,n,d));else if(m===L.CERTIFICATE)y.listenEventUnfrozenCertificate(t,n,d);else throw new pt(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${m}`,target:"transaction.asset.beExchangeAny.exchangeAny"});if(o.beExchangeAssetPrealnum!=="0")if(E===L.ASSETS)w||(y.listenEventAsset(g,d),w=!0);else if(E===L.DAPP)y.listenEventChangeDAppPossessor(t,n,d);else if(E===L.LOCATION_NAME)y.listenEventChangeLocationNamePossessor(t,n,d);else if(E===L.ENTITY)y.listenEventChangeEntityPossessor(t,n,d);else if(E===L.CERTIFICATE)y.listenEventChangeCertificatePossessor(t,n,d);else throw new pt(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${E}`,target:"transaction.asset.beExchangeAny.exchangeAny"});return E===L.ENTITY&&(y.listenEventPayTax(t,n,d),w||y.listenEventAsset(g,d)),await y.awaitEventResult(e,d),!0}isDependentTransactionMatch(e,t){const r=e.asset.beExchangeAny,{exchangeAny:n,ciphertextSignature:s}=r,{cipherPublicKeys:o,assetExchangeWeightRatio:a,taxInformation:p}=n,l=t.asset.toExchangeAny;if(l.toExchangeSource!==n.toExchangeSource||l.beExchangeSource!==n.beExchangeSource||l.toExchangeParentAssetType!==n.toExchangeParentAssetType||l.beExchangeParentAssetType!==n.beExchangeParentAssetType||l.toExchangeAssetType!==n.toExchangeAssetType||l.beExchangeAssetType!==n.beExchangeAssetType||l.toExchangeAssetPrealnum!==n.toExchangeAssetPrealnum)throw new pt(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(l.beExchangeAssetPrealnum){if(!n.beExchangeAssetPrealnum)throw new pt(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(l.beExchangeAssetPrealnum!==n.beExchangeAssetPrealnum)throw new pt(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"})}else if(n.beExchangeAssetPrealnum)throw new pt(c.SHOULD_NOT_EXIST,{prop:"beExchangeAssetPrealnum",target:"BeExchangeAnyTransaction.beExchangeAny.exchangeAny"});if(l.assetExchangeWeightRatio){if(!a)throw new pt(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(l.assetExchangeWeightRatio.toExchangeAssetWeight!==a.toExchangeAssetWeight||l.assetExchangeWeightRatio.beExchangeAssetWeight!==a.beExchangeAssetWeight)throw new pt(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"})}else if(a)throw new pt(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",target:"BeExchangeAnyTransaction.beExchangeAny.exchangeAny"});if(l.taxInformation){if(!p)throw new pt(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(l.taxInformation.taxCollector!==p.taxCollector||l.taxInformation.taxAssetPrealnum!==p.taxAssetPrealnum)throw new pt(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"})}else if(p)throw new pt(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"BeExchangeAnyTransaction.beExchangeAny.exchangeAny"});if(l.cipherPublicKeys.length!==o.length)throw new pt(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});for(const m of l.cipherPublicKeys)if(!o.includes(m))throw new pt(c.NOT_MATCH,{to_compare_prop:`trsAsset: ${JSON.stringify(l)}`,be_compare_prop:`exchangeAny: ${JSON.stringify(n.toJSON())}`,to_target:"BeExchangeAnyTransaction",be_target:"ToExchangeAnyTransaction"});if(o.length>0){if(!s)throw new pt(c.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAny"});const{publicKey:m}=s;if(!o.includes(m))throw new pt(c.NOT_MATCH,{to_compare_prop:`publicKey ${m}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAny.ciphertextSignature",be_target:"toExchangeAny.cipherPublicKeys"})}else if(s)throw new pt(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAny"});const{toExchangeAssetPrealnum:f,beExchangeAssetPrealnum:g}=r;if(e.senderId===e.recipientId){if(n.toExchangeParentAssetType===L.ASSETS){if(f==="0")throw new pt(c.PROP_SHOULD_GT_FIELD,{prop:`toExchangeAssetPrealnum ${f}`,field:"0",target:"beExchangeAny"})}else if(f!=="1")throw new pt(c.PROP_SHOULD_EQ_FIELD,{prop:`toExchangeAssetPrealnum ${f}`,field:"1",target:"beExchangeAny"});if(g!=="0")throw new pt(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,field:"0",target:"beExchangeAny"})}else{if(f==="0"&&g==="0")throw new pt(c.PROP_SHOULD_GT_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,field:"0",target:"beExchangeAny"});if(a){const m=this.jsbiHelper.multiplyRoundFraction(f,{numerator:a.beExchangeAssetWeight,denominator:a.toExchangeAssetWeight});if(m>BigInt(g))throw new pt(c.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,field:m.toString(),target:"beExchangeAny"})}else if(n.beExchangeParentAssetType===L.ASSETS){if(BigInt(g)<BigInt(n.beExchangeAssetPrealnum))throw new pt(c.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,field:n.beExchangeAssetPrealnum,target:"beExchangeAny"})}else if(g!=="1")throw new pt(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${g}`,field:"1",target:"beExchangeAny"})}const{rangeType:d,range:y}=t;if(d&1){if(!y.includes(e.senderId))throw new pt(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAnyTransaction",be_compare_prop:"beExchangeAnyTransaction.range"})}else if(d&2){if(!e.dappid||!y.includes(e.dappid))throw new pt(c.SHOULD_BE,{to_compare_prop:`dappid ${e.senderId}`,to_target:"beExchangeAnyTransaction",be_compare_prop:"beExchangeAnyTransaction.range"})}else if(d&4&&(!e.lns||!y.includes(e.lns)))throw new pt(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAnyTransaction",be_compare_prop:"beExchangeAnyTransaction.range"})}getLockData(e){const{transactionSignature:t,exchangeAny:r,taxInformation:n}=e.asset.beExchangeAny,{toExchangeParentAssetType:s,beExchangeParentAssetType:o}=r,a=[t];return(s===L.DAPP||s===L.LOCATION_NAME||s===L.ENTITY)&&(a.push(r.toExchangeAssetType),r.taxInformation&&a.push(r.taxInformation.taxCollector)),(o===L.DAPP||o===L.LOCATION_NAME||o===L.ENTITY)&&(a.push(r.beExchangeAssetType),n&&a.push(n.taxCollector)),a}};Bd=h([j(),u("design:paramtypes",[It])],Bd);const{ConsensusException:xw}=re("CONTROLLER","IssueEntityMultiV1LogicVerifier");let Md=class extends Le{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){this.__checkTrsFee(e);const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};if(a&&a.accountInfo&&a.accountAssets){const g=a.accountInfo.address;p[g]=this.helperLogicVerifier.deepClone(a.accountAssets)}const l=new ve;this.eventLogicVerifier.listenEventFee(p,l),this.eventLogicVerifier.listenEventFrozenAsset(p,l),this.eventLogicVerifier.listenEventAsset(p,l);const f=this.helperLogicVerifier.deepClone(o.accountAssets);return this.eventLogicVerifier.listenEventIssueEntityMultiV1(f,t,n,l),await this.eventLogicVerifier.awaitEventResult(e,l),!0}__checkTrsFee(e){const t=this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length);if(BigInt(e.fee)<BigInt(t))throw new xw(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:be.TRANSACTION_FEE_NOT_ENOUGH,minFee:t,target:"transaction"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.issueEntityMulti.entityStructList.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){return[e.asset.issueEntityMulti.entityFactoryPossessor]}};Md=h([j(),Oe(0,J(de)),Oe(1,J(me)),u("design:paramtypes",[de,me])],Md);const{ConsensusException:yc}=re("VERIFIER","ToExchangeAnyMultiLogicVerifier");let vd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){this.__checkTrsFee(e);const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p=e.asset.toExchangeAnyMulti,{toExchangeAssets:l,beExchangeAsset:f}=p,g=new ve,{eventLogicVerifier:d}=this;d.listenEventFee(a,g);const{beExchangeSource:y,beExchangeChainName:m,beExchangeParentAssetType:E,beExchangeAssetType:T}=f;let w=!1;if(E===L.ASSETS)await this.helperLogicVerifier.isAssetExist(m,y,T,n);else if(E===L.DAPP)await this.helperLogicVerifier.isDAppExist(m,y,T,t,n);else if(E===L.LOCATION_NAME){if(T.split(",").length>2)throw new yc(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);await this.helperLogicVerifier.isLocationNameExist(m,y,T,t,n)}else if(E===L.ENTITY){if((await this.helperLogicVerifier.isEntityExist(m,y,T,t,n)).status===255)throw new yc(c.ENTITY_ALREADY_DESTROY,{entityId:T,reason:"Entity already be destroy"});d.listenEventPayTax(t,n,g),w=!0}else if(E===L.CERTIFICATE)await this.helperLogicVerifier.isCertificateExist(m,y,T,t,n);else throw new yc(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${E}`,target:"transaction.asset.toExchangeAnyMulti"});let b=!1,C=!1,N=!1,O=!1,R=!1;for(const F of l){const{toExchangeChainName:z,toExchangeSource:K,toExchangeParentAssetType:B,toExchangeAssetType:M}=F;if(B===L.ASSETS){if(await this.helperLogicVerifier.isAssetExist(z,K,M,n),b)continue;d.listenEventFrozenAsset(a,g),b=!0}else if(B===L.DAPP){if(C)continue;d.listenEventFrozenDApp(t,n,g),C=!0}else if(B===L.LOCATION_NAME){if(N)continue;d.listenEventFrozenLocationName(t,n,g),N=!0}else if(B===L.ENTITY)O||(d.listenEventFrozenEntity(t,n,g),O=!0),b||(d.listenEventFrozenAsset(a,g),b=!0),w||(d.listenEventPayTax(t,n,g),w=!0);else if(B===L.CERTIFICATE){if(R)continue;d.listenEventFrozenCertificate(t,n,g),R=!0}else throw new yc(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${B}`,target:"transaction.asset.toExchangeAnyMulti"})}return await d.awaitEventResult(e,g),!0}__checkTrsFee(e){const t=this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length);if(BigInt(e.fee)<BigInt(t))throw new yc(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:be.TRANSACTION_FEE_NOT_ENOUGH,minFee:t,target:"transaction"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.toExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{toExchangeAssets:t}=e.asset.toExchangeAnyMulti,r=[];for(const n of t){const{toExchangeParentAssetType:s,toExchangeAssetType:o}=n;(s===L.DAPP||s===L.LOCATION_NAME||s===L.ENTITY)&&r.push(o)}return r}};vd=h([j(),u("design:paramtypes",[])],vd);const{ConsensusException:ft,NoFoundException:Ow}=re("VERIFIER","BeExchangeAnyMultiLogicVerifier");let Ld=class extends Le{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){this.__checkTrsFee(e);const o=e.asset.beExchangeAnyMulti,{transactionSignature:a}=o,p=await s.getTransactionBySignature(a,this.transactionHelper.calcTransactionQueryRange(t));if(!p)throw new Ow(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${a}`,target:"blockChain"});if(p.type!==this.transactionHelper.TO_EXCHANGE_ANY_MULTI)throw new ft(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${a}`});if(e.recipientId!==p.senderId)throw new ft(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${p.senderId}`,to_target:"BeExchangeAnyMultiTransaction",be_target:"ToExchangeAnyMultiTransaction"});this.isDependentTransactionMatch(e,p);const{sender:l,recipient:f}=await this.logicVerify(e,t,r,n,s),g={[e.senderId]:this.helperLogicVerifier.deepClone(l.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(l.accountInfo),f&&f.accountInfo&&f.accountAssets){const z=f.accountInfo.address;g[z]=this.helperLogicVerifier.deepClone(f.accountAssets),this.helperLogicVerifier.deepClone(f.accountInfo)}const d=new ve,{eventLogicVerifier:y}=this;y.listenEventFee(g,d);const{toExchangeAssets:m,beExchangeAsset:E}=o,{beExchangeParentAssetType:T,taxInformation:w}=E;let b=!1,C=!1,N=!1,O=!1,R=!1,F=!1;if(E.beExchangeAssetPrealnum!=="0")if(T===L.ASSETS)y.listenEventAsset(g,d),b=!0;else if(T===L.DAPP)y.listenEventChangeDAppPossessor(t,n,d);else if(T===L.LOCATION_NAME)y.listenEventChangeLocationNamePossessor(t,n,d);else if(T===L.ENTITY)y.listenEventChangeEntityPossessor(t,n,d);else if(T===L.CERTIFICATE)y.listenEventChangeCertificatePossessor(t,n,d);else throw new ft(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${T}`,target:"beExchangeAnyMulti.toExchangeAssets.beExchangeAsset"});for(const z of m){const{toExchangeParentAssetType:K,taxInformation:B}=z;if(K===L.ASSETS){if(C)continue;y.listenEventUnfrozenAsset(t,n,d),C=!0}else if(K===L.DAPP){if(N)continue;y.listenEventUnfrozenDApp(t,n,d),N=!0}else if(K===L.LOCATION_NAME){if(O)continue;y.listenEventUnfrozenLocationName(t,n,d),O=!0}else if(K===L.ENTITY)R||(y.listenEventUnfrozenEntity(t,n,d),R=!0),B&&(B.taxAssetPrealnum==="0"?b||(y.listenEventAsset(g,d),b=!0):C||(y.listenEventUnfrozenAsset(t,n,d),C=!0));else if(K===L.CERTIFICATE){if(F)continue;y.listenEventUnfrozenCertificate(t,n,d),F=!0}else throw new ft(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${K}`,target:"beExchangeAnyMulti.toExchangeAssets.toExchangeAsset"})}return T===L.ENTITY&&(y.listenEventPayTax(t,n,d),b||y.listenEventAsset(g,d)),await y.awaitEventResult(e,d),!0}isDependentTransactionMatch(e,t){const{toExchangeAssets:r,beExchangeAsset:n,cipherPublicKeys:s}=t.asset.toExchangeAnyMulti,{toExchangeAssets:o,beExchangeAsset:a,ciphertextSignature:p}=e.asset.beExchangeAnyMulti,l={};for(const E of r){const{toExchangeSource:T,toExchangeChainName:w,toExchangeParentAssetType:b,toExchangeAssetType:C,toExchangeAssetPrealnum:N,assetExchangeWeightRatio:O,taxInformation:R}=E;l[`${T}${C}`]={toExchangeChainName:w,toExchangeParentAssetType:b,toExchangeAssetPrealnum:N,assetExchangeWeightRatio:O,taxInformation:R}}for(const E of o){const{toExchangeSource:T,toExchangeChainName:w,toExchangeParentAssetType:b,toExchangeAssetType:C,toExchangeAssetPrealnum:N,assetExchangeWeightRatio:O,taxInformation:R}=E,F=`${T}${C}`,z=l[F];if(!z)throw new ft(c.SHOULD_NOT_INCLUDE,{prop:"toExchangeAssets",target:"toExchangeAnyMulti",value:`toExchangeChainName ${w} toExchangeSource ${T} toExchangeAssetType ${C}`});if(z.toExchangeChainName!==w||z.toExchangeParentAssetType!==b)throw new ft(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:z.toExchangeChainName,toExchangeParentAssetType:z.toExchangeParentAssetType,toExchangeAssetType:C})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(E.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"});if(BigInt(N)>BigInt(z.toExchangeAssetPrealnum))throw new ft(c.PROP_SHOULD_LTE_FIELD,{prop:`toExchangeAssets.toExchangeAsset.toExchangeAssetPrealnum ${N}`,target:"beExchangeAnyMulti",field:z.toExchangeAssetPrealnum});if(z.assetExchangeWeightRatio){if(!O)throw new ft(c.PROP_IS_REQUIRE,{prop:"assetExchangeWeightRatio",target:"beExchangeAnyMulti.beExchangeAsset"});if(z.assetExchangeWeightRatio.toExchangeAssetWeight!==O.toExchangeAssetWeight||z.assetExchangeWeightRatio.beExchangeAssetWeight!==O.beExchangeAssetWeight)throw new ft(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:w,toExchangeAssetType:C})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(E.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"})}else if(O)throw new ft(c.SHOULD_NOT_EXIST,{prop:"assetExchangeWeightRatio",target:"beExchangeAnyMulti.beExchangeAsset"});if(z.taxInformation){if(!R)throw new ft(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:w,toExchangeAssetType:C})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(E.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"});if(z.taxInformation.taxCollector!==R.taxCollector||z.taxInformation.taxAssetPrealnum!==R.taxAssetPrealnum)throw new ft(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({toExchangeSource:T,toExchangeChainName:w,toExchangeAssetType:C})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(E.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"})}else if(R)throw new ft(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.toExchangeAsset"})}if(n.beExchangeSource!==a.beExchangeSource||n.beExchangeChainName!==a.beExchangeChainName||n.beExchangeParentAssetType!==a.beExchangeParentAssetType||n.beExchangeAssetType!==a.beExchangeAssetType)throw new ft(c.NOT_MATCH,{to_compare_prop:`beExchangeAsset: ${JSON.stringify(n)}`,be_compare_prop:`beExchangeAsset: ${JSON.stringify(a.toJSON())}`,to_target:"toExchangeAnyMulti",be_target:"beExchangeAnyMulti"});const{beExchangeAssetPrealnum:f,beExchangeParentAssetType:g}=a,d=BigInt(f);if(e.senderId===e.recipientId){for(const E of o){const{toExchangeParentAssetType:T,toExchangeAssetPrealnum:w}=E;if(T===L.ASSETS){if(w==="0")throw new ft(c.PROP_SHOULD_GT_FIELD,{prop:`toExchangeAssetPrealnum ${w}`,field:"0",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.toExchangeAssets"})}else if(w!=="1")throw new ft(c.PROP_SHOULD_EQ_FIELD,{prop:`toExchangeAssetPrealnum ${w}`,field:"1",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.toExchangeAssets"})}if(f!=="0")throw new ft(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${f}`,field:"0",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"})}else if(g===L.ASSETS){let E=!1;for(const T of o){const{toExchangeParentAssetType:w,toExchangeAssetPrealnum:b,assetExchangeWeightRatio:C}=T;if(w!==L.ASSETS&&(E=!0),C){const N=this.jsbiHelper.multiplyRoundFraction(b,{numerator:C.beExchangeAssetWeight,denominator:C.toExchangeAssetWeight});if(N>d)throw new ft(c.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAssetPrealnum ${f}`,field:N.toString(),target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"})}if(b==="0"&&f==="0")throw new ft(c.PROP_SHOULD_GT_FIELD,{prop:`beExchangeAssetPrealnum ${f}`,field:"0",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"})}if(E&&n.beExchangeAssetPrealnum&&a.beExchangeAssetPrealnum&&BigInt(a.beExchangeAssetPrealnum)<BigInt(n.beExchangeAssetPrealnum))throw new ft(c.PROP_SHOULD_GTE_FIELD,{prop:`beExchangeAsset.beExchangeAssetPrealnum ${a.beExchangeAssetPrealnum}`,target:"beExchangeAnyMulti",field:n.beExchangeAssetPrealnum})}else if(f!=="1")throw new ft(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${f}`,field:"1",target:"BeExchangeAnyMultiTransaction.beExchangeAnyMulti.beExchangeAsset"});if(s.length>0){if(!p)throw new ft(c.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMulti"});const{publicKey:E}=p;if(!s.includes(E))throw new ft(c.NOT_MATCH,{to_compare_prop:`publicKey ${E}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAnyMulti.ciphertextSignature",be_target:"toExchangeAnyMulti.cipherPublicKeys"})}else if(p)throw new ft(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMulti"});const{rangeType:y,range:m}=t;if(y&1){if(!m.includes(e.senderId))throw new ft(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAnyMultiTransaction",be_compare_prop:"beExchangeAnyMultiTransaction.range"})}else if(y&2){if(!e.dappid||!m.includes(e.dappid))throw new ft(c.SHOULD_BE,{to_compare_prop:`dappid ${e.senderId}`,to_target:"beExchangeAnyMultiTransaction",be_compare_prop:"beExchangeAnyMultiTransaction.range"})}else if(y&4&&(!e.lns||!m.includes(e.lns)))throw new ft(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAnyMultiTransaction",be_compare_prop:"beExchangeAnyMultiTransaction.range"})}__checkTrsFee(e){const t=this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length);if(BigInt(e.fee)<BigInt(t))throw new ft(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:be.TRANSACTION_FEE_NOT_ENOUGH,minFee:t,target:"transaction"})}checkTrsFeeAndWebFee(e,t){return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,e.asset.beExchangeAnyMulti.toExchangeAssets.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{transactionSignature:t,toExchangeAssets:r,beExchangeAsset:n}=e.asset.beExchangeAnyMulti,s=[t],{beExchangeParentAssetType:o,beExchangeAssetType:a}=n;for(const p of r){const{toExchangeParentAssetType:l,toExchangeAssetType:f,taxInformation:g}=p;(l===L.DAPP||l===L.LOCATION_NAME||l===L.ENTITY)&&(s.push(f),g&&s.push(g.taxCollector))}return(o===L.DAPP||o===L.LOCATION_NAME||o===L.ENTITY)&&(s.push(a),s.push(a),n.taxInformation&&s.push(n.taxInformation.taxCollector)),s}};Ld=h([j(),u("design:paramtypes",[It])],Ld);const{ConsensusException:mc}=re("VERIFIER","ToExchangeAnyMultiAllLogicVerifier");let Dd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){this.__checkTrsFee(e);const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)},p=e.asset.toExchangeAnyMultiAll,{toExchangeAssets:l,beExchangeAssets:f}=p,g=new ve,{eventLogicVerifier:d}=this;d.listenEventFee(a,g);let y=!1;for(const C of f){const{beExchangeSource:N,beExchangeChainName:O,beExchangeParentAssetType:R,beExchangeAssetType:F}=C;if(R===L.ASSETS)await this.helperLogicVerifier.isAssetExist(O,N,F,n);else if(R===L.DAPP)await this.helperLogicVerifier.isDAppExist(O,N,F,t,n);else if(R===L.LOCATION_NAME){if(F.split(",").length>2)throw new mc(c.ONLY_TOP_LEVEL_LOCATION_NAME_CAN_EXCHANGE);await this.helperLogicVerifier.isLocationNameExist(O,N,F,t,n)}else if(R===L.ENTITY){if((await this.helperLogicVerifier.isEntityExist(O,N,F,t,n)).status===255)throw new mc(c.ENTITY_ALREADY_DESTROY,{entityId:F,reason:"Entity already be destroy"});y||(d.listenEventPayTax(t,n,g),y=!0)}else if(R===L.CERTIFICATE)await this.helperLogicVerifier.isCertificateExist(O,N,F,t,n);else throw new mc(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${R}`,target:"transaction.asset.toExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}let m=!1,E=!1,T=!1,w=!1,b=!1;for(const C of l){const{toExchangeChainName:N,toExchangeSource:O,toExchangeParentAssetType:R,toExchangeAssetType:F}=C;if(R===L.ASSETS){if(await this.helperLogicVerifier.isAssetExist(N,O,F,n),m)continue;d.listenEventFrozenAsset(a,g),m=!0}else if(R===L.DAPP){if(E)continue;d.listenEventFrozenDApp(t,n,g),E=!0}else if(R===L.LOCATION_NAME){if(T)continue;d.listenEventFrozenLocationName(t,n,g),T=!0}else if(R===L.ENTITY)w||(d.listenEventFrozenEntity(t,n,g),w=!0),m||(d.listenEventFrozenAsset(a,g),m=!0),y||(d.listenEventPayTax(t,n,g),y=!0);else if(R===L.CERTIFICATE){if(b)continue;d.listenEventFrozenCertificate(t,n,g),b=!0}else throw new mc(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${R}`,target:"transaction.asset.toExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}return await d.awaitEventResult(e,g),!0}__checkTrsFee(e){const{toExchangeAssets:t,beExchangeAssets:r}=e.asset.toExchangeAnyMultiAll,n=this.transactionHelper.calcTransactionMinFeeByMulti(e,t.length+r.length);if(BigInt(e.fee)<BigInt(n))throw new mc(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:be.TRANSACTION_FEE_NOT_ENOUGH,minFee:n,target:"transaction"})}checkTrsFeeAndWebFee(e,t){const{toExchangeAssets:r,beExchangeAssets:n}=e.asset.toExchangeAnyMultiAll;return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,r.length+n.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const{toExchangeAssets:n,beExchangeAssets:s}=e.asset.toExchangeAnyMultiAll;return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,n.length+s.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{toExchangeAssets:t}=e.asset.toExchangeAnyMultiAll,r=[];for(const n of t){const{toExchangeParentAssetType:s,toExchangeAssetType:o}=n;(s===L.DAPP||s===L.LOCATION_NAME||s===L.ENTITY)&&r.push(o)}return r}};Dd=h([j(),u("design:paramtypes",[])],Dd);const{ConsensusException:At,NoFoundException:Cw}=re("VERIFIER","BeExchangeAnyMultiAllLogicVerifier");let kd=class extends Le{constructor(e){super(),this.jsbiHelper=e}async verify(e,t,r,n,s){this.__checkTrsFee(e);const o=e.asset.beExchangeAnyMultiAll,{transactionSignature:a}=o,p=await s.getTransactionBySignature(a,this.transactionHelper.calcTransactionQueryRange(t));if(!p)throw new Cw(c.NOT_EXIST_OR_EXPIRED,{prop:`Transaction with signature ${a}`,target:"blockChain"});if(p.type!==this.transactionHelper.TO_EXCHANGE_ANY_MULTI_ALL)throw new At(c.NOT_EXPECTED_RELATED_TRANSACTION,{signature:`${a}`});if(e.recipientId!==p.senderId)throw new At(c.NOT_MATCH,{to_compare_prop:`recipientId ${e.recipientId}`,be_compare_prop:`senderId ${p.senderId}`,to_target:"BeExchangeAnyMultiAllTransaction",be_target:"ToExchangeAnyMultiAllTransaction"});this.isDependentTransactionMatch(e,p);const{sender:l,recipient:f}=await this.logicVerify(e,t,r,n,s),g={[e.senderId]:this.helperLogicVerifier.deepClone(l.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(l.accountInfo),f&&f.accountInfo&&f.accountAssets){const B=f.accountInfo.address;g[B]=this.helperLogicVerifier.deepClone(f.accountAssets),this.helperLogicVerifier.deepClone(f.accountInfo)}const d=new ve,{eventLogicVerifier:y}=this;y.listenEventFee(g,d);const{toExchangeAssets:m,beExchangeAssets:E}=o;let T=!1,w=!1,b=!1,C=!1,N=!1;for(const B of E){const{beExchangeParentAssetType:M,beExchangeAssetPrealnum:V,taxInformation:U}=B;if(V!=="0")if(M===L.ASSETS){if(T)continue;y.listenEventAsset(g,d),T=!0}else if(M===L.DAPP){if(w)continue;y.listenEventChangeDAppPossessor(t,n,d),w=!0}else if(M===L.LOCATION_NAME){if(b)continue;y.listenEventChangeLocationNamePossessor(t,n,d),b=!0}else if(M===L.ENTITY){if(C)continue;y.listenEventChangeEntityPossessor(t,n,d),C=!0}else if(M===L.CERTIFICATE){if(N)continue;y.listenEventChangeCertificatePossessor(t,n,d),N=!0}else throw new At(c.PROP_IS_INVALID,{prop:`beExchangeParentAssetType ${M}`,target:"beExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"});if(M===L.ENTITY){if(y.listenEventPayTax(t,n,d),!T)continue;y.listenEventAsset(g,d)}}let O=!1,R=!1,F=!1,z=!1,K=!1;for(const B of m){const{toExchangeParentAssetType:M,taxInformation:V}=B;if(M===L.ASSETS){if(O)continue;y.listenEventUnfrozenAsset(t,n,d),O=!0}else if(M===L.DAPP){if(R)continue;y.listenEventUnfrozenDApp(t,n,d),R=!0}else if(M===L.LOCATION_NAME){if(F)continue;y.listenEventUnfrozenLocationName(t,n,d),F=!0}else if(M===L.ENTITY)z||(y.listenEventUnfrozenEntity(t,n,d),z=!0),V&&(V.taxAssetPrealnum==="0"?T||(y.listenEventAsset(g,d),T=!0):O||(y.listenEventUnfrozenAsset(t,n,d),O=!0));else if(M===L.CERTIFICATE){if(K)continue;y.listenEventUnfrozenCertificate(t,n,d),K=!0}else throw new At(c.PROP_IS_INVALID,{prop:`toExchangeParentAssetType ${M}`,target:"beExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}return await y.awaitEventResult(e,d),!0}isDependentTransactionMatch(e,t){const{toExchangeAssets:r,beExchangeAssets:n,cipherPublicKeys:s}=t.asset.toExchangeAnyMultiAll,{toExchangeAssets:o,beExchangeAssets:a,ciphertextSignature:p}=e.asset.beExchangeAnyMultiAll;if(r.length!==o.length)throw new At(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.length: ${r.length}`,be_compare_prop:`toExchangeAssets.length: ${o.length}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(n.length!==a.length)throw new At(c.NOT_MATCH,{to_compare_prop:`beExchangeAssets.length: ${n.length}`,be_compare_prop:`beExchangeAssets.length: ${a.length}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});const l={};for(const y of r){const{toExchangeSource:m,toExchangeChainName:E,toExchangeParentAssetType:T,toExchangeAssetType:w,toExchangeAssetPrealnum:b,taxInformation:C}=y;l[`${m}${w}`]={toExchangeChainName:E,toExchangeParentAssetType:T,toExchangeAssetPrealnum:b,taxInformation:C}}const f={};for(const y of n){const{beExchangeSource:m,beExchangeChainName:E,beExchangeParentAssetType:T,beExchangeAssetType:w,beExchangeAssetPrealnum:b,taxInformation:C}=y;f[`${m}${w}`]={beExchangeChainName:E,beExchangeParentAssetType:T,beExchangeAssetPrealnum:b,taxInformation:C}}for(const y of o){const{toExchangeSource:m,toExchangeChainName:E,toExchangeParentAssetType:T,toExchangeAssetType:w,toExchangeAssetPrealnum:b,taxInformation:C}=y,N=`${m}${w}`,O=l[N];if(!O)throw new At(c.SHOULD_NOT_INCLUDE,{prop:"toExchangeAssets",target:"toExchangeAnyMultiAll",value:`toExchangeChainName ${E} toExchangeSource ${m} toExchangeAssetType ${w}`});const R={toExchangeSource:m,toExchangeChainName:O.toExchangeChainName,toExchangeParentAssetType:O.toExchangeParentAssetType,toExchangeAssetType:w};if(O.toExchangeChainName!==E||O.toExchangeParentAssetType!==T)throw new At(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(R)}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(y.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(b!==O.toExchangeAssetPrealnum)throw new At(c.PROP_SHOULD_EQ_FIELD,{prop:`toExchangeAssets.toExchangeAsset.toExchangeAssetPrealnum ${b}`,target:"beExchangeAnyMultiAll",field:O.toExchangeAssetPrealnum});if(O.taxInformation){if(!C)throw new At(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(R)}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(y.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(O.taxInformation.taxCollector!==C.taxCollector||O.taxInformation.taxAssetPrealnum!==C.taxAssetPrealnum)throw new At(c.NOT_MATCH,{to_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify({...R,taxInformation:{taxCollector:C.taxCollector,taxAssetPrealnum:C.taxAssetPrealnum}})}`,be_compare_prop:`toExchangeAssets.toExchangeAsset: ${JSON.stringify(y.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"})}else if(C)throw new At(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"beExchangeAnyMultiAll.toExchangeAssets.toExchangeAsset"})}for(const y of a){const{beExchangeSource:m,beExchangeChainName:E,beExchangeParentAssetType:T,beExchangeAssetType:w,beExchangeAssetPrealnum:b,taxInformation:C}=y,N=`${m}${w}`,O=f[N];if(!O)throw new At(c.SHOULD_NOT_INCLUDE,{prop:"beExchangeAssets",target:"beExchangeAnyMultiAll",value:`beExchangeChainName ${E} beExchangeSource ${m} beExchangeAssetType ${w}`});const R={beExchangeSource:m,beExchangeChainName:O.beExchangeChainName,beExchangeParentAssetType:O.beExchangeParentAssetType,beExchangeAssetType:w};if(E!==O.beExchangeChainName||T!==O.beExchangeParentAssetType)throw new At(c.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(R)}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(y.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(e.senderId===e.recipientId){if(b!=="0")throw new At(c.PROP_SHOULD_EQ_FIELD,{prop:`beExchangeAssetPrealnum ${b}`,field:"0",target:"beExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}else if(b!==O.beExchangeAssetPrealnum)throw new At(c.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(R)}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(y.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(O.taxInformation){if(!C)throw new At(c.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(R)}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(y.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"});if(O.taxInformation.taxCollector!==C.taxCollector||O.taxInformation.taxAssetPrealnum!==C.taxAssetPrealnum)throw new At(c.NOT_MATCH,{to_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify({...R,taxInformation:{taxCollector:C.taxCollector,taxAssetPrealnum:C.taxAssetPrealnum}})}`,be_compare_prop:`beExchangeAssets.beExchangeAsset: ${JSON.stringify(y.toJSON())}`,to_target:"toExchangeAnyMultiAll",be_target:"beExchangeAnyMultiAll"})}else if(C)throw new At(c.SHOULD_NOT_EXIST,{prop:"taxInformation",target:"beExchangeAnyMultiAll.beExchangeAssets.beExchangeAsset"})}if(s.length>0){if(!p)throw new At(c.NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMultiAll"});const{publicKey:y}=p;if(!s.includes(y))throw new At(c.NOT_MATCH,{to_compare_prop:`publicKey ${y}`,be_compare_prop:"cipherPublicKeys",to_target:"beExchangeAnyMultiAll.ciphertextSignature",be_target:"toExchangeAnyMultiAll.cipherPublicKeys"})}else if(p)throw new At(c.SHOULD_NOT_EXIST,{prop:"ciphertextSignature",target:"beExchangeAnyMultiAll"});const{rangeType:g,range:d}=t;if(g&1){if(!d.includes(e.senderId))throw new At(c.SHOULD_BE,{to_compare_prop:`senderId ${e.senderId}`,to_target:"beExchangeAnyMultiAllTransaction",be_compare_prop:"beExchangeAnyMultiAllTransaction.range"})}else if(g&2){if(!e.dappid||!d.includes(e.dappid))throw new At(c.SHOULD_BE,{to_compare_prop:`dappid ${e.senderId}`,to_target:"beExchangeAnyMultiAllTransaction",be_compare_prop:"beExchangeAnyMultiAllTransaction.range"})}else if(g&4&&(!e.lns||!d.includes(e.lns)))throw new At(c.SHOULD_BE,{to_compare_prop:`lns ${e.lns}`,to_target:"beExchangeAnyMultiAllTransaction",be_compare_prop:"beExchangeAnyMultiAllTransaction.range"})}__checkTrsFee(e){const{toExchangeAssets:t,beExchangeAssets:r}=e.asset.beExchangeAnyMultiAll,n=this.transactionHelper.calcTransactionMinFeeByMulti(e,t.length+r.length);if(BigInt(e.fee)<BigInt(n))throw new At(c.TRANSACTION_FEE_NOT_ENOUGH,{errorId:be.TRANSACTION_FEE_NOT_ENOUGH,minFee:n,target:"transaction"})}checkTrsFeeAndWebFee(e,t){const{toExchangeAssets:r,beExchangeAssets:n}=e.asset.beExchangeAnyMultiAll;return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,r.length+n.length)+this.transactionHelper.calcTransactionBlobFee(e)).toString())}checkTrsFeeAndMiningMachineFeeAndWebFee(e,t,r){const{toExchangeAssets:n,beExchangeAssets:s}=e.asset.beExchangeAnyMultiAll;return this.isFeeEnough(e.fee,(this.transactionHelper.calcTransactionMinFeeByMulti(e,n.length+s.length,void 0,r)+this.transactionHelper.calcTransactionBlobFee(e,r)).toString())}getLockData(e){const{transactionSignature:t,toExchangeAssets:r,beExchangeAssets:n}=e.asset.beExchangeAnyMultiAll,s=[t];for(const o of r){const{toExchangeParentAssetType:a,toExchangeAssetType:p,taxInformation:l}=o;(a===L.DAPP||a===L.LOCATION_NAME||a===L.ENTITY)&&(s.push(p),l&&s.push(l.taxCollector))}for(const o of n){const{beExchangeParentAssetType:a,beExchangeAssetType:p,taxInformation:l}=o;(a===L.DAPP||a===L.LOCATION_NAME||a===L.ENTITY)&&(s.push(p),s.push(p),l&&s.push(l.taxCollector))}return s}};kd=h([j(),u("design:paramtypes",[It])],kd);const{ConsensusException:lA,NoFoundException:kP}=re("VERIFIER","IssueCertificateLogicVerifier");let Hd=class extends Le{constructor(e,t){super(),this.accountBaseHelper=e,this.transactionHelper=t}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),p={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};if(e.senderId+"",this.helperLogicVerifier.deepClone(o.accountInfo),a&&a.accountInfo&&a.accountAssets){const g=a.accountInfo.address;p[g]=this.helperLogicVerifier.deepClone(a.accountAssets),this.helperLogicVerifier.deepClone(a.accountInfo)}const l=new ve,{eventLogicVerifier:f}=this;return f.listenEventFee(p,l),f.listenEventIssueCertificate(t,n,l),await f.awaitEventResult(e,l),!0}checkOnChainHeight(e,t){const r=Number(e.split(":")[0]);if(r<t)throw new lA(c.PROP_SHOULD_GTE_FIELD,{prop:`CertificateId on chain height ${r}`,target:"issueCertificate",field:t})}isOnChainHeight(e,t){const r=Number(e.split(":")[0]);if(r!==t)throw new lA(c.SHOULD_BE,{to_compare_prop:`CertificateId on chain height ${r}`,to_target:"issueCertificate",be_compare_prop:t})}getLockData(e){return[e.type]}};Hd=h([j(),Oe(0,J(de)),Oe(1,J(me)),u("design:paramtypes",[de,me])],Hd);const{ConsensusException:hA}=re("VERIFIER","TransactionLogicVerifier");let Fd=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sourceChainMagic:o,sourceChainName:a,certificateId:p,type:l}=e.asset.destroyCertificate,f=await this.helperLogicVerifier.isCertificateExist(a,o,p,t,n);if(f.applyAddress!==e.recipientId)throw new hA(c.SHOULD_BE,{to_compare_prop:`recipientId ${e.recipientId}`,to_target:"transaction",be_compare_prop:`certificate apply account address ${f.applyAddress}`});if(f.type!==l)throw new hA(c.NOT_MATCH,{to_compare_prop:`type ${l}`,be_compare_prop:`type ${f.type}`,to_target:"transaction",be_target:"issueCertificateTransaction"});const{sender:g,recipient:d}=await this.logicVerify(e,t,r,n,s),y={[e.senderId]:this.helperLogicVerifier.deepClone(g.accountAssets)};if(d&&d.accountInfo&&d.accountAssets){const T=d.accountInfo.address;y[T]=this.helperLogicVerifier.deepClone(d.accountAssets)}const m=new ve,{eventLogicVerifier:E}=this;return E.listenEventFee(y,m),E.listenEventAsset(y,m),E.listenEventDestroyCertificate(t,n,m),await E.awaitEventResult(e,m),!0}};Fd=h([j(),u("design:paramtypes",[])],Fd);const{ArgumentFormatException:Rw}=re("CONTROLLER","TransactionLogicVerifierCore");let Ri=class{constructor(e,t,r,n,s,o,a){this.transactionHelper=e,this.accountBaseHelper=t,this.asymmetricHelper=r,this.keypairHelper=n,this.Buffer=s,this.config=o,this.moduleMap=a,this._txLogicVerifierCache=new Map}getTransactionLogicVerifier(e){let t=this._txLogicVerifierCache.get(e);return t||(t=Ot(e,this.moduleMap),this._txLogicVerifierCache.set(e,t)),t}getTransactionLogicVerifierFromType(e){const{baseType:t}=this.transactionHelper.parseType(e);return this.getTransactionLogicVerifierFromBaseType(t)}getTransactionLogicVerifierFromBaseType(e){const t=ts.KLV.get(e);if(!t)throw new Rw(c.INVALID_BASE_TYPE,{base_type:e});return this.getTransactionLogicVerifier(t)}};Ri=h([j("bfchain-core:TransactionLogicVerifierCore"),Oe(3,J("keypairHelper")),Oe(4,J("Buffer")),u("design:paramtypes",[me,de,$r,Object,Object,te,et])],Ri);const ts=(()=>{const i=new Map,e=new Map;return[[H.USERNAME,qg],[H.SIGNATURE,Xg],[H.DELEGATE,Zg],[H.VOTE,rd],[H.ACCEPT_VOTE,ed],[H.REJECT_VOTE,td],[H.CUSTOM,Rd],[H.DAPP,nd],[H.DAPP_PURCHASING,sd],[H.MARK,id],[H.REGISTER_CHAIN,bd],[H.ISSUE_ASSET,od],[H.DESTROY_ASSET,pd],[H.TRANSFER_ASSET,ad],[H.TO_EXCHANGE_ASSET,yd],[H.BE_EXCHANGE_ASSET,md],[H.GIFT_ASSET,ld],[H.GRAB_ASSET,ud],[H.TRUST_ASSET,gd],[H.SIGN_FOR_ASSET,dd],[H.EMIGRATE_ASSET,Ed],[H.IMMIGRATE_ASSET,Id],[H.TO_EXCHANGE_SPECIAL_ASSET,_d],[H.BE_EXCHANGE_SPECIAL_ASSET,Ad],[H.LOCATION_NAME,Td],[H.SET_LNS_RECORD_VALUE,wd],[H.SET_LNS_MANAGER,Sd],[H.ISSUE_ENTITY_FACTORY,Nd],[H.ISSUE_ENTITY_FACTORY_V1,xd],[H.ISSUE_ENTITY,Od],[H.DESTROY_ENTITY,Cd],[H.TRANSFER_ANY,cd],[H.GIFT_ANY,hd],[H.GRAB_ANY,fd],[H.TO_EXCHANGE_ANY,Pd],[H.BE_EXCHANGE_ANY,Bd],[H.ISSUE_ENTITY_MULTI,Md],[H.TO_EXCHANGE_ANY_MULTI,vd],[H.BE_EXCHANGE_ANY_MULTI,Ld],[H.TO_EXCHANGE_ANY_MULTI_ALL,Dd],[H.BE_EXCHANGE_ANY_MULTI_ALL,kd],[H.ISSUE_CERTIFICATE,Hd],[H.DESTROY_CERTIFICATE,Fd]].forEach(([t,r])=>{i.set(t,r),e.set(r,t)}),{KLV:i,LVK:e,trsTypeToV(t){const r=t.indexOf("-",t.indexOf("-")+1);return t.substr(r+1)}}})(),{ConsensusException:Pw,NoFoundException:$P}=re("VERIFIER","PromiseLogicVerifier");let Dl=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};e.senderId+"",this.helperLogicVerifier.deepClone(o.accountInfo);const p=new ve,{eventLogicVerifier:l}=this,{signature:f}=e.asset.promise.transaction;if(await s.getTransactionBySignature(f,this.transactionHelper.calcTransactionQueryRange(t)))throw new Pw(c.ALREADY_EXIST,{prop:`promiseTransaction ${f}`,target:"blockChain",errorId:be.TRANSACTION_IN_TRS});return l.listenEventFee(a,p),await l.awaitEventResult(e,p),!0}};h([J("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),u("design:type",Ri)],Dl.prototype,"transactionLogicVerifierCore",void 0);Dl=h([j(),u("design:paramtypes",[])],Dl);const{ConsensusException:_c,NoFoundException:uA}=re("VERIFIER","PromiseResolveLogicVerifier");let za=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),{senderId:p,recipientId:l}=e,f={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};e.senderId+"",this.helperLogicVerifier.deepClone(o.accountInfo);const g=new ve,{eventLogicVerifier:d}=this,{promiseId:y}=e.asset.resolve,m=await s.getPromiseTransaction(y);if(!m)throw new uA(c.NOT_EXIST,{prop:`Promise transaction ${y}`,target:"blockChain"});if(m.applyBlockHeight>t)throw new _c(c.NOT_BEGIN_RESOLVE_YET,{promiseId:y});if(m.effectiveBlockHeight<t)throw new _c(c.ALREADY_EXPIRED,{prop:`Promise transaction ${y}`,target:"blockChain"});d.listenEventFee(f,g);const E=new Map([[p,o]]);l&&a&&E.set(l,a);const T=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(m.type),{senderId:w,recipientId:b}=m;let C=E.get(w);if(!C){const R=await n.getAccountInfoAndAssets(p,t);if(!R)throw new _c(c.NOT_EXIST,{prop:`Account with address ${w}`,target:"blockChain"});C=R,E.set(w,C)}let N;if(b&&(N=E.get(b),!N)){const R=await n.getAccountInfoAndAssets(b,t);if(!R)throw new _c(c.NOT_EXIST,{prop:`Account with address ${w}`,target:"blockChain"});N=R,E.set(b,N)}const O=await this.transactionCore.recombineTransaction(m);return await T.verify(O,t,{sender:C,recipient:N},n,s),await d.awaitEventResult(e,g),!0}async checkRepeatInBlockChainTransaction(e,t,r=0,n){const{promiseId:s}=e.asset.resolve,o=await n.getPromiseTransaction(s);if(!o)throw new uA(c.NOT_EXIST,{prop:`Promise transaction ${s}`,target:"blockChain"});const a=[e.signature,o.signature],p=e.applyBlockHeight>o.applyBlockHeight?o.applyBlockHeight:e.applyBlockHeight;if(await n.countTransactionsInBlockChainBySignature(a,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(p,t))>(r===0?0:2))throw new _c(c.ALREADY_EXIST,{prop:`One of transactions with signatures ${a.join(",")}`,target:"blockChain"})}};h([J("bfchain-core:TransactionCore",{dynamics:!0}),u("design:type",qn)],za.prototype,"transactionCore",void 0);h([J("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),u("design:type",Ri)],za.prototype,"transactionLogicVerifierCore",void 0);za=h([j(),u("design:paramtypes",[])],za);let kl=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o}=await this.logicVerify(e,t,r,n,s),a={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};e.senderId+"",this.helperLogicVerifier.deepClone(o.accountInfo);const p=new ve,{eventLogicVerifier:l}=this;return l.listenEventFee(a,p),await l.awaitEventResult(e,p),!0}};h([J("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),u("design:type",Ri)],kl.prototype,"transactionLogicVerifierCore",void 0);kl=h([j(),u("design:paramtypes",[])],kl);const{ConsensusException:kf,NoFoundException:fA}=re("VERIFIER","MacroCallLogicVerifier");let ja=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),{senderId:p,recipientId:l}=e,f={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};e.senderId+"",this.helperLogicVerifier.deepClone(o.accountInfo);const g=new ve,{eventLogicVerifier:d}=this,{macroId:y,inputs:m}=e.asset.call,E=await s.getMacroCallTransaction(y,m);if(!E)throw new fA(c.NOT_EXIST,{prop:`Macro call transaction with macroId ${y}`,target:"blockChain"});d.listenEventFee(f,g);const T=new Map([[p,o]]);l&&a&&T.set(l,a);const w=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(E.type),{senderId:b,recipientId:C}=E;let N=T.get(b);if(!N){const F=await n.getAccountInfoAndAssets(p,t);if(!F)throw new kf(c.NOT_EXIST,{prop:`Account with address ${b}`,target:"blockChain"});N=F,T.set(b,N)}let O;if(C&&(O=T.get(C),!O)){const F=await n.getAccountInfoAndAssets(C,t);if(!F)throw new kf(c.NOT_EXIST,{prop:`Account with address ${b}`,target:"blockChain"});O=F,T.set(C,O)}const R=await this.transactionCore.recombineTransaction(E);return await w.verify(R,t,{sender:N,recipient:O},n,s),await d.awaitEventResult(e,g),!0}async checkRepeatInBlockChainTransaction(e,t,r=0,n){const{macroId:s,inputs:o}=e.asset.call,a=await n.getMacroCallTransaction(s,o);if(!a)throw new fA(c.NOT_EXIST,{prop:`Macro transaction with macroId ${s}`,target:"blockChain"});const p=[e.signature,a.signature],l=e.applyBlockHeight>a.applyBlockHeight?a.applyBlockHeight:e.applyBlockHeight;if(await n.countTransactionsInBlockChainBySignature(p,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(l,t))>(r===0?0:2))throw new kf(c.ALREADY_EXIST,{prop:`One of transactions with signatures ${p.join(",")}`,target:"blockChain"})}};h([J("bfchain-core:TransactionCore",{dynamics:!0}),u("design:type",qn)],ja.prototype,"transactionCore",void 0);h([J("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),u("design:type",Ri)],ja.prototype,"transactionLogicVerifierCore",void 0);ja=h([j(),u("design:paramtypes",[])],ja);const{ConsensusException:Hf,NoFoundException:jP}=re("VERIFIER","MultipleLogicVerifier");let Hl=class extends Le{constructor(){super()}async verify(e,t,r,n,s){const{sender:o,recipient:a}=await this.logicVerify(e,t,r,n,s),{senderId:p,recipientId:l}=e,f={[e.senderId]:this.helperLogicVerifier.deepClone(o.accountAssets)};e.senderId+"",this.helperLogicVerifier.deepClone(o.accountInfo);const g=new ve,{eventLogicVerifier:d}=this,{transactions:y}=e.asset.multiple;d.listenEventFee(f,g);const m=new Map([[p,o]]);l&&a&&m.set(l,a);for(const E of y){const{senderId:T,recipientId:w}=E,b=this.transactionLogicVerifierCore.getTransactionLogicVerifierFromType(E.type);let C=m.get(T);if(!C){const O=await n.getAccountInfoAndAssets(p,t);if(!O)throw new Hf(c.NOT_EXIST,{prop:`Account with address ${T}`,target:"blockChain"});C=O,m.set(T,C)}let N;if(w&&(N=m.get(w),!N)){const O=await n.getAccountInfoAndAssets(w,t);if(!O)throw new Hf(c.NOT_EXIST,{prop:`Account with address ${T}`,target:"blockChain"});N=O,m.set(w,N)}await b.verify(E,t,{sender:C,recipient:N},n,s)}return await d.awaitEventResult(e,g),!0}async checkRepeatInBlockChainTransaction(e,t,r=0,n){const{transactions:s}=e.asset.multiple,o=[e.signature];let a=e.applyBlockHeight;for(const f of s)o.push(f.signature),a>f.applyBlockHeight&&(a=f.applyBlockHeight);const p=await n.countTransactionsInBlockChainBySignature(o,this.transactionHelper.calcTransactionQueryRangeByApplyBlockHeight(a,t)),l=r===0?0:s.length+1;if(p>l)throw new Hf(c.ALREADY_EXIST,{prop:`One of transactions with signatures ${o.slice(0,3).map(f=>f.slice(0,8)).join(",")}`,target:"blockChain"})}};h([J("bfchain-core:TransactionLogicVerifierCore",{dynamics:!0}),u("design:type",Ri)],Hl.prototype,"transactionLogicVerifierCore",void 0);Hl=h([j(),u("design:paramtypes",[])],Hl);ts.KLV.set(H.PROMISE,Dl);ts.LVK.set(Dl,H.PROMISE);ts.KLV.set(H.PROMISE_RESOLVE,za);ts.LVK.set(za,H.PROMISE_RESOLVE);ts.KLV.set(H.MACRO,kl);ts.LVK.set(kl,H.MACRO);ts.KLV.set(H.MACRO_CALL,ja);ts.LVK.set(ja,H.MACRO_CALL);ts.KLV.set(H.MULTIPLE,Hl);ts.LVK.set(Hl,H.MULTIPLE);const{ArgumentIllegalException:Ac,info:gA}=re("CONTROLLER","_blockbase"),dA=Rl("generateBlock");class Dm{transactionInBlockFromJSON(e){return Gt.fromObject(e)}async generateBlock(e,t,r,n,s,o,a=this.config){dA&&gA("begin generateBlock"),await this.generateBlockCore.generateBlockBefore(e,t,r,o);const p=this._generateBlock(e,t);return await this.generateBlockCore.generateBlockAfter(p,r,n,s,o,a),dA&&gA("finish generateBlock"),p}async replayBlock(e,t,r,n={},s=this.config){return await this.replayBlockCore.replayBlock(e,t,r,n,s)}verifyKeypair(e){if(!e)throw new Ac(c.PARAM_LOST,{param:"keypair"});const t={target:"keypair"},{baseHelper:r}=this,{publicKey:n,secretKey:s}=e;if(!n)throw new Ac(c.PROP_IS_REQUIRE,{prop:"publicKey",...t});if(!r.isValidPublicKey(n))throw new Ac(c.PROP_IS_INVALID,{prop:`publicKey ${n}`,...t});if(!s)throw new Ac(c.PROP_IS_REQUIRE,{param:"secretKey",...t});if(!r.isValidSecretKey(s))throw new Ac(c.PROP_IS_INVALID,{prop:`secretKey ${s}`,...t})}async verifyBlockBody(e,t,r=this.config){this.commonBlockVerify.verifyBlockBody(e,t)}async verify(e,t=this.config){await this.verifyBlockCore.verify(e,t)}async generateSignature(e){return await this.blockHelper.generateSignature(e)}async isBlockAlreadyExist(e,t,r){await this.commonBlockVerify.isBlockAlreadyExist(e,t,r)}}const{NoFoundException:YP,ArgumentException:Bw}=re("Core","BlockGeneratorCalculator");let Rn=class{constructor(e,t,r,n){this.config=e,this.timeHelper=t,this.blockHelper=r,this.accountBaseHelper=n,this.getAddressSeedMap=s=>new wt(a=>{let p=0;for(let l=1;l<a.length;l++)p+=a.charCodeAt(l);return p*s%256})}async fastCalcGenerateBlockDelegate(e,t={}){let r;if("toTimestamp"in t)r=t.toTimestamp;else{const{nowTimestamp:n=this.timeHelper.getTimestamp()}=t;r=this.timeHelper.getTimestampBySlotNumber(this.timeHelper.getSlotNumberByTimestamp(n)+1)}if(e.timestamp>=r)throw new Bw(`lastblock timestamp(${e.timestamp}) should not be greater than toTimestamp(${r})`);for await(const n of this.calcGenerateBlockDelegateGenerator(e,{toTimestamp:r,blockGetterHelper:t.blockGetterHelper,ignoreOfflineGeneraters:!0}))if(n.timestamp===r)return{address:n.address,timestamp:n.timestamp};throw new Error}async calcGenerateBlockDelegate(e,t){for await(const r of this.calcGenerateBlockDelegateGenerator(e,t))if(r.timestamp===t.toTimestamp)return r;throw new Error}async*calcGenerateBlockDelegateGenerator(e,t={}){const{toTimestamp:r=1/0,blockGetterHelper:n=this.blockHelper.blockGetterHelper,ignoreOfflineGeneraters:s,yieldSkip:o=1}=t,a=e.timestamp+this.config.forgeInterval;let p=a;const l=new wt(()=>[]),f=[],g=e.height%this.config.blockPerRound,d=t.blockCache||{};for(let K=0;K<g;K++){const B=e.height-K;f.push(d[B]||await this.blockHelper.forceGetBlockByHeight(B,n))}const y=Math.max(1,this.blockHelper.calcRoundEndHeight(this.blockHelper.calcRoundByHeight(e.height+1)-1)),m=d[y]||await this.blockHelper.forceGetBlockByHeight(y,n),E=this.blockHelper.calcRoundByHeight(m.height+1),T=K=>{const B=(K-m.timestamp)/this.config.forgeInterval/this.config.blockPerRound;return B%1===0&&B>0?B-1:Math.floor(B)},w=K=>(K*this.config.blockPerRound+1)*this.config.forgeInterval+m.timestamp,b=d[e.height]||await this.blockHelper.forceGetBlockByHeight(e.height,n);if(s){if(!Number.isSafeInteger(r))throw new RangeError("toTimestamp must be an integer, when you ignore Offline Generaters.");const K=T(a),B=T(r);B>K&&(p=w(B))}const C=m.height===1?m.asset.genesisAsset.nextRoundDelegates:m.asset.roundLastAsset.nextRoundDelegates,N=async K=>{const B=new Set;if(K===0)for(const D of C)B.add(D.address);else{const D=E-K;if(D<=1)for(const W of this.config.genesisBlock.asset.genesisAsset.nextRoundDelegates)B.add(W.address);else{const W=this.blockHelper.calcRoundStartHeight(D),ae=Math.min(this.blockHelper.calcRoundEndHeight(D),e.height);for(let ue=W;ue<=ae;ue++)B.add(await this.blockHelper.forceGetBlockGeneratorAddressByHeight(ue,n));if(B.size<this.config.blockPerRound)for(const ue of C)B.add(ue.address)}}const M=new Set;for(const D of f)T(D.timestamp)===K&&M.add(await this.accountBaseHelper.getAddressFromPublicKey(D.generatorPublicKeyBuffer));const V=new Set;for(const D of f){const W=D.roundOfflineGeneratersHashMap[K];if(W)for(const ae of W.split(","))V.add(ae)}const U=[];for(const D of B)M.has(D)||V.has(D)||U.push(D);return U},O=b.generatorPublicKeyBuffer.reduce((K,B)=>K+B,0),R=K=>K.slice().sort((B,M)=>{const V=this.getAddressSeedMap(O).forceGet(B)-this.getAddressSeedMap(O).forceGet(M);return V===0?K.indexOf(B)-K.indexOf(M):V}),F=K=>{let B;return{roundOfflineGeneratersReadonlyMap:l,get roundOfflineGeneratersHashMap(){if(!B){B={};for(const[M,V]of l)B[M]=V.join(",")}return B},address:K,timestamp:this.timeHelper.getTimestampBySlotNumber(this.timeHelper.getSlotNumberByTimestamp(p))}};let z=0;for(;p<=r;){const K=T(p),B=await N(K),M=(w(K+1)-p)/this.config.forgeInterval;B.length>M&&(B.length=M);const V=R(B);let U;do{const D=V.shift();if(!D)break;o>1?(++z===o||p===r)&&(z=0,yield F(D)):yield F(D),(U||(U=l.forceGet(K))).push(D),p+=this.config.forgeInterval}while(V.length)}}async calcNextBlockGenerator(e){const t=e.timestamp+this.config.forgeInterval;for await(const r of this.calcGenerateBlockDelegateGenerator({timestamp:e.timestamp,height:e.height},{toTimestamp:t,blockCache:{[e.height]:e}}))if(r.timestamp===t)return r;throw new Error}};Rn=h([j(),u("design:paramtypes",[te,Vt,_t,de])],Rn);const{ArgumentIllegalException:tn,ConsensusException:yA}=re("CONTROLLER","_blockbase");let Ts=class{constructor(e,t,r,n){this.blockHelper=e,this.baseHelper=t,this.milestonesHelper=r,this.chainAssetInfoHelper=n}verifyBlockBody(e,t){const{baseHelper:r}=this;if(!e)throw new tn(c.PARAM_LOST,{param:"body"});if(!t)throw new tn(c.PARAM_LOST,{param:"asset"});const n={target:"body"};if(!r.isPositiveInteger(e.version))throw new tn(c.PROP_IS_INVALID,{prop:`version ${e.version}`,type:"positive integer",...n});const s=e.height;if(!r.isPositiveInteger(s))throw new tn(c.PROP_IS_INVALID,{prop:`height ${s}`,type:"positive integer",...n});if(s>1&&!e.previousBlockSignature)throw new tn(c.PROP_IS_REQUIRE,{prop:"previousBlockSignature",...n});if(!r.isNaturalNumber(e.timestamp))throw new tn(c.PROP_IS_INVALID,{prop:`timestamp ${e.timestamp}`,type:"positive integer or 0",...n});if(!r.isValidAccountEquity(e.generatorEquity))throw new tn(c.PROP_IS_INVALID,{prop:"generatorEquity",type:"account equity",...n});const o=e.remark;if(!o)throw new tn(c.PROP_IS_REQUIRE,{prop:"remark",...n});if(r.getVariableType(o)!=="[object Object]")throw new tn(c.PROP_IS_INVALID,{prop:"remark",...n});for(const a in o)if(!r.isString(o[a]))throw new tn(c.PROP_IS_INVALID,{prop:"remark",...n});if(!o&&r.getVariableType(o)!=="[object Object]")throw new tn(c.PARAM_LOST,{param:"remark",...n})}verifyBlockReward(e){const t=this.milestonesHelper.calcReward(e.height).toString();if(t!==e.reward)throw new tn(c.NOT_MATCH,{to_compare_prop:`blockReward ${e.reward}`,be_compare_prop:`expectedReward ${t}`,to_target:"block",be_target:"calculate"})}verifyBlockSize(e,t){const r=this.calcBlockSize(e,t);if(e.blockSize!==r)throw new tn(c.NOT_MATCH,{to_compare_prop:`blockSize ${e.blockSize}`,be_compare_prop:`blockSize ${r}`,to_target:"block",be_target:"calculate"})}verifySignature(e){return this.blockHelper.verifyBlockSignature(e)}get canInsertTransaction(){return this.transactionCore.canCreateTransaction.bind(this.transactionCore)}calcBlockSize(e,t){const r=dt.$type.fields.blockSize.id,n=a=>({value:a,size:a===0?0:new $n().uint32(r).uint32(a).finish().length}),s=e.blockSize;let o=s;if(o=e.getBytes(!1,!1,t).length+(e.signatureBuffer.length?0:66),e.generatorPublicKeyBuffer){const a=e.signSignatureBuffer&&e.signSignatureBuffer.length||0;o+=a?0:66}if(s!==o){let a=n(s);do{const p=n(o);if(p.size===a.size)break;o+=p.size-a.size,a=p}while(!0)}return o}async isBlockAlreadyExist(e,t,r){if(typeof r.getCountBlock!="function")throw new yA(c.PROP_IS_INVALID,{prop:"getCountBlock",target:"blockGetterHelper"});if(await r.getCountBlock({signature:e})>0)throw new yA(c.ALREADY_EXIST,{prop:`Block with signature ${e}`,target:"blockChain",errorId:`Block already exists: ${e} height: ${t}`})}};h([J("bfchain-core:TransactionCore"),u("design:type",Object)],Ts.prototype,"transactionCore",void 0);h([ne,u("design:type",Object),u("design:paramtypes",[])],Ts.prototype,"canInsertTransaction",null);Ts=h([j(),u("design:paramtypes",[_t,Pe,Es,ke])],Ts);const{ArgumentIllegalException:gt,ArgumentFormatException:Ih,ConsensusException:Mw}=re("CONTROLLER","_blockbase");let Ja=class{constructor(e,t,r,n,s,o,a,p,l){this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.asymmetricHelper=s,this.chainAssetInfoHelper=o,this.commonBlockVerify=a,this.accountBaseHelper=p,this.cryptoHelper=l}async verify(e,t=this.config){await this.commonBlockVerify.verifyBlockBody(e,e.remark),await this.verifyBlockDerivativeInfo(e,t),e.height===1&&await this.verifyBlockTransactions(e,t),await this.commonBlockVerify.verifySignature(e)}async verifyBlockTransactions(e,t=this.config){if(!e)throw new gt(c.PARAM_LOST,{param:"block"});const r={target:"block"},{baseHelper:n}=this;if(!e.transactions)throw new gt(c.PROP_IS_REQUIRE,{prop:"transactions",...r});const s=e.transactions.length;if(s!==e.numberOfTransactions)throw new gt(c.NOT_MATCH,{to_compare_prop:`numberOfTransactions ${e.numberOfTransactions}`,be_compare_prop:`transactions length ${s}`,to_target:"block",be_target:"block",...r});if(s>t.maxTPSPerBlock*t.forgeInterval)throw new Ih(c.PROP_SHOULD_LTE_FIELD,{prop:`transactions length ${s}`,field:`maxTrsPerBlock ${t.maxTPSPerBlock*t.forgeInterval}`,...r});const{totalAmount:o,totalFee:a}=e;if(!o)throw new gt(c.PROP_IS_REQUIRE,{prop:"totalAmount",...r});if(!n.isValidAssetNumber(o))throw new gt(c.PROP_IS_INVALID,{prop:`totalAmount ${o}`,type:"asset number",...r});if(!a)throw new gt(c.PROP_IS_REQUIRE,{prop:"totalFee",...r});if(!n.isValidAssetNumber(a))throw new gt(c.PROP_IS_INVALID,{prop:`totalFee ${a}`,type:"asset number",...r});const p=new Map,l=await this.accountBaseHelper.getAddressFromPublicKey(e.generatorPublicKeyBuffer);p.set(`${l}_${t.magic}_${t.assetType}`,BigInt(t.genesisAmount));function f(B,M,V){return`${B}_${M}_${V}`}function g(B,M){const V=p.get(B);V?p.set(B,V+M):p.set(B,M)}function d(B){const M=p.get(B);return M?M.toString():"0"}const y=e.transactions,m=new Set,E=this.cryptoHelper.sha256();let T=0,w=0;const b=e.statisticInfo,C=new ve,N=this.statisticsHelper.forceGetStatisticsInfoByBlock(C.taskname||`core-verify-${e.height}`,e.signature,void 0,t);try{this.statisticsHelper.bindApplyTransactionEventEmiter(C,N);const{magic:B,assetType:M}=t;for(const V of y){const U=V.transaction;if(await this.transactionCore.getTransactionFactoryFromType(U.type).verify(U,t),m.has(U.signature))throw new Mw(c.SHOULD_NOT_DUPLICATE,{prop:`transaction with signature ${U.signature}`,target:`block with height ${e.height}`});if(m.add(U.signature),!await this.asymmetricHelper.detachedVeriy(V.getBytes(!0,!0),V.signatureBuffer,e.generatorPublicKeyBuffer))throw new Ih(c.INVALID_SIGNATURE,{taskLabel:"transactionInBlock"});if(e.generatorSecondPublicKeyBuffer){if(!V.signSignatureBuffer)throw new Ih(c.PROP_IS_REQUIRE,{prop:"signSignature",target:"transactionInBlock"});if(!await this.asymmetricHelper.detachedVeriy(V.getBytes(!1,!0),V.signSignatureBuffer,e.generatorSecondPublicKeyBuffer))throw new Ih(c.INVALID_SIGNSIGNATURE,{taskLabel:"transactionInBlock"})}const D=V.transaction,{type:W,senderId:ae,recipientId:ue,fromMagic:Ee,fee:Ae}=D;let P=[];const ee=f(ae,Ee,M);let ye="0";W.includes(H.TRANSFER_ASSET)&&(ye=D.asset.transferAsset.amount);const De=BigInt("-"+ye)+BigInt("-"+Ae);if(g(ee,De),P[P.length]=Yn.fromObject({accountType:jh.SENDER,sourceChainMagic:B,assetType:M,assetPrealnum:d(ee)}),ue){const pe=f(ue,Ee,M);g(pe,BigInt(ye)),P[P.length]=Yn.fromObject({accountType:jh.RECIPIENT,sourceChainMagic:B,assetType:M,assetPrealnum:d(pe)})}P=this.transactionCore.transactionHelper.sortTransactionAssetChanges(P);const ce=V.transactionAssetChanges,Q=P.length,se=ce.length;if(Q!==se)throw new gt(c.NOT_MATCH,{to_compare_prop:`transactionAssetChanges lenght ${se}`,be_compare_prop:`transactionAssetChanges lenght ${Q}`,to_target:`transactionInBlock ${D.senderId} ${D.signature}`,be_target:"calculate"});for(let pe=0;pe<Q;pe++)if(!n.isArrayEqual(P[pe].getBytes(),ce[pe].getBytes()))throw new gt(c.NOT_MATCH,{to_compare_prop:`transactionAssetChanges with index ${pe} ${JSON.stringify(ce[pe])}`,be_compare_prop:`transactionAssetChanges with index ${pe} ${JSON.stringify(P[pe])}`,to_target:`transactionInBlock ${D.senderId} ${D.signature}`,be_target:"calculate"});const oe=Gt.encode(V).finish();E.update(oe),T+=oe.length,w+=V.transaction.blobSize,await this.transactionCore.getTransactionFactoryFromType(D.type).applyTransaction(D,C,t)}}catch(B){throw B}finally{N.unref(e.signature)}if(!n.isArrayEqual(N.toModel().getBytes(),b.getBytes()))throw new gt(c.PROP_IS_INVALID,{prop:"statisticInfo",type:"block statisticInfo",...r});const O=N.totalAsset,R=N.totalFee;if(O!==BigInt(o))throw new gt(c.PROP_SHOULD_EQ_FIELD,{prop:`totalAmount ${o}`,field:O.toString(),...r});if(R!==BigInt(a))throw new gt(c.PROP_SHOULD_EQ_FIELD,{prop:`totalFee ${a}`,field:R,...r});if(e.payloadLength!==T)throw new gt(c.PROP_SHOULD_EQ_FIELD,{prop:`payloadLength ${e.payloadLength}`,field:T,...r});if(e.blockSize>t.maxBlockSize)throw new gt(c.TOO_LARGE,{prop:"blockSize",reason:`blockSize: ${e.blockSize} max: ${t.maxBlockSize}`,...r});if(e.blobSize!==w)throw new gt(c.NOT_MATCH,{to_compare_prop:`blobSize ${e.blobSize}`,be_compare_prop:`blobSize ${w}`,to_target:"block",be_target:"calculate"});if(e.blobSize>t.maxBlobSizePerBlock)throw new gt(c.TOO_LARGE,{prop:"blobSize",reason:`blobSize: ${e.blobSize} max: ${t.maxBlobSizePerBlock}`,...r});const F=await E.digest("hex");if(e.payloadHash!==F)throw new gt(c.NOT_MATCH,{to_compare_prop:`payloadHash ${F}`,be_compare_prop:`payloadHash ${e.payloadHash}`,to_target:"calculate",be_target:"block",...r});const z=y.length;if(e.numberOfTransactions!==z)throw new gt(c.NOT_MATCH,{to_compare_prop:`numberOfTransactions ${e.numberOfTransactions}`,be_compare_prop:`numberOfTransactions ${z}`,to_target:"block",be_target:"calculate"});const K=this.blockHelper.calcBlockParticipation({totalChainAsset:N.totalChainAsset,numberOfTransactions:z});if(e.blockParticipation!==K)throw new gt(c.NOT_MATCH,{to_compare_prop:`blockParticipation ${e.remark.blockParticipation}`,be_compare_prop:`blockParticipation ${K}`,to_target:"block",be_target:"calculate"})}async verifyBlockDerivativeInfo(e,t=this.config){const r={target:"block"},{baseHelper:n}=this;if(e.height!==1&&!e.previousBlockSignature&&n.isValidBlockSignature(e.previousBlockSignature))throw new gt(c.PROP_IS_INVALID,{prop:`previousBlockSignature ${e.previousBlockSignature}`,...r});if(!n.isNaturalNumber(e.numberOfTransactions))throw new gt(c.PROP_IS_INVALID,{prop:`numberOfTransactions ${e.numberOfTransactions}`,type:"natural number",...r});if(!e.payloadHash)throw new gt(c.PROP_IS_REQUIRE,{prop:`payloadHash ${e.payloadHash}`,...r});if(!n.isNaturalNumber(e.payloadLength))throw new gt(c.PROP_IS_INVALID,{prop:`payloadLength ${e.payloadLength}`,type:"natural number",...r});if(e.magic!==t.magic)throw new gt(c.NOT_MATCH,{to_compare_prop:`block.magic ${e.magic}`,be_compare_prop:`genesisBlock.magic ${t.magic}`,to_target:"block_body",be_target:"genesis_block",...r});if(!e.generatorPublicKey)throw new gt(c.PROP_IS_REQUIRE,{prop:"generatorPublicKey",...r});if(!n.isValidPublicKey(e.generatorPublicKey))throw new gt(c.PROP_IS_INVALID,{prop:`generatorPublicKey ${e.generatorPublicKey}`,type:"account publicKey",...r});if(!e.signature)throw new gt(c.PROP_IS_REQUIRE,{prop:"signature",...r});if(!n.isValidSignature(e.signature))throw new gt(c.PROP_IS_INVALID,{prop:`signature ${e.signature}`,type:"signature",...r});this.commonBlockVerify.verifyBlockReward(e),this.commonBlockVerify.verifyBlockSize(e)}};h([J("bfchain-core:TransactionCore"),u("design:type",Object)],Ja.prototype,"transactionCore",void 0);Ja=h([j(),Oe(8,J("cryptoHelper")),u("design:paramtypes",[_t,Pe,te,zs,$r,ke,Ts,de,Object])],Ja);const{ArgumentIllegalException:Uo,OutOfRangeException:XP,ArgumentFormatException:vw,NoFoundException:mA,log:Th,info:_A,warn:AA,ConsensusException:Ff}=re("CONTROLLER","_blockbase"),Ko=Rl("generateBlock");let Ya=class{constructor(e,t,r,n,s,o,a,p){this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.asymmetricHelper=s,this.blockGeneratorCalculator=o,this.commonBlockVerify=a,this.cryptoHelper=p}async generateBlockBefore(e,t,r,n){if(!e)throw new Uo(c.PARAM_LOST,{param:"body"});if(!t)throw new Uo(c.PARAM_LOST,{param:"asset"});if(!r)throw new Uo(c.PARAM_LOST,{param:"transactions"});if(Ko&&Th("before generateBlock"),n&&await this._wrapBlockError(n.emit("beforeGenerateBlock",e),n,"beforeGenerateBlock",e),e.height>1)if(!e.roundOfflineGeneratersHashMap||!e.isTrustRoundOfflineGeneraters){const s=await this.blockHelper.forceGetBlockByHeight(e.height-1);e.roundOfflineGeneratersHashMap=(await this.blockGeneratorCalculator.calcGenerateBlockDelegate(s,{toTimestamp:e.timestamp})).roundOfflineGeneratersHashMap}else e.roundOfflineGeneratersHashMap=e.roundOfflineGeneratersHashMap}async _wrapBlockError(e,t,r,n){if(e)try{return await e}catch(s){await t.emit("blockError",{type:`generateBlock/${r}`,error:s,blockBody:n})}}async generateBlockAfter(e,t,r,n,s,o=this.config){return e.magic=o.magic,await this.insertTransactions(e,t,r,n,s),Ko&&Th("before signatureBlock"),s&&await this._wrapBlockError(s.emit("beforeSignatureBlock",e),s,"beforeSignatureBlock",e),e.blockSize=this.commonBlockVerify.calcBlockSize(e),e.signatureBuffer=await this.asymmetricHelper.detachedSign(e.getBytes(!0,!0,!0),r.secretKey),n&&(e.signSignatureBuffer=await this.asymmetricHelper.detachedSign(e.getBytes(!1,!0,!0),n.secretKey)),Ko&&Th("before generatedBlock"),s&&await this._wrapBlockError(s.emit("generatedBlock",e),s,"generatedBlock",e),e}async insertTransactions(e,t,r,n,s=new ve){const o=this.transactionCore,a=o.abortForbiddenTransaction,p=o.transactionHelper.VOTE,l=this.config.maxVotesPerBlock,{height:f,generatorPublicKey:g,statisticInfo:d}=e,{tpowOfWorkExemptionBlocks:y,maxBlockSize:m}=this.config;let E=this.config.maxBlobSizePerBlock;if(s.customMaxBlobSizeGetter){const z=s.customMaxBlobSizeGetter();E=z<E?z:E}const T=this.cryptoHelper.sha256();let w=0,b=0,C=0;const N=this.statisticsHelper.forceGetStatisticsInfoByBlock(s.taskname||`core-generate-${f}`,g,d),O=[],R=f>y,F=new Set;try{this.statisticsHelper.bindApplyTransactionEventEmiter(s,N);const z=new wt(B=>0);Ko&&_A("begin insertTransactions");for await(const B of t){s.tIndexGetter&&(B.tIndex=await s.tIndexGetter(B)),Ko&&Th("insert transaction: %d / %d",B.tIndex,e.numberOfTransactions);try{const M=B.transaction,{type:V,senderId:U,signature:D}=M;if(F.has(D))throw new Ff(c.SHOULD_NOT_DUPLICATE,{prop:`transaction with signature ${D}`,target:`block with height ${e.height}`});if(F.add(D),!this.commonBlockVerify.canInsertTransaction(V)){const P=je.VK.get(je.trsTypeToV(V)),ee=new Ff(c.DISABLED_INSERT_TRANSACTION,{trsName:P});if(a)throw ee;AA(ee)}if(R){const P=z.forceGet(U),ee=await s.emit("verifyTransactionProfOfWork",{transaction:M,count:P});if(ee===void 0)throw new mA(c.NOT_EXIST,{prop:`verifyTransactionProfOfWork count ${P} signature ${D} senderId ${U} nonce ${M.nonce}`,target:"ApplyTransactionEventEmitter"});if(!ee)throw new vw(c.TRAN_POW_VERIFY_FAIL);z.set(U,P+1)}O.push(B),B.height=e.height;const W=o.getTransactionFactoryFromType(V);await W.beginDealTransaction(M,s),await W.applyTransaction(M,s),s.assetChangesGetter&&(B.transactionAssetChanges=await s.assetChangesGetter(B));const ae=B.transactionAssetChanges,ue=`height ${B.height} tIndex ${B.tIndex} type ${V} senderId ${U} ${M.recipientId?" recipientId "+M.recipientId:" "} signature ${B.transaction.signature}`;for(const P of ae)if(BigInt(P.assetPrealnum)<BigInt(0))throw new Uo(c.PROP_IS_INVALID,{prop:`assetBalance ${P.assetPrealnum}  ${P.sourceChainMagic} ${P.assetType}`,target:"transactionAssetChanges",detail:ue});s.assetPrealnumGetter&&(B.assetPrealnum=await s.assetPrealnumGetter(B));const Ee=B.assetPrealnum;if(Ee){const{remainAssetPrealnum:P,frozenMainAssetPrealnum:ee}=Ee;if(BigInt(P)<BigInt(0))throw new Uo(c.PROP_IS_INVALID,{prop:`remainAssetPrealnum ${P}`,target:"assetPrealnum",detail:ue});if(BigInt(ee)<BigInt(0))throw new Uo(c.PROP_IS_INVALID,{prop:`frozenMainAssetPrealnum ${ee}`,target:"assetPrealnum",detail:ue})}B.signatureBuffer=await this.asymmetricHelper.detachedSign(B.getBytes(!0,!0),r.secretKey),n&&(B.signSignatureBuffer=await this.asymmetricHelper.detachedSign(B.getBytes(!1,!0),n.secretKey)),Object.freeze(B);const Ae=B.getBytes();T.update(Ae),b+=Ae.length,b>m*.95&&await s.emit("nearMaxPayloadLength",{payloadLength:b}),C+=B.transaction.blobSize,C>E*.95&&await s.emit("nearMaxBlobSize",{blobSize:C}),await W.endDealTransaction(B,s),V===p&&w++}catch(M){const V=await s.emit("error",{error:M,type:"genesisBlock",transactionInBlock:B});if(V&&V.continue)continue;throw M}}if(Ko&&_A("finish insertTransactions"),w>l)throw new Ff(c.PROP_SHOULD_LTE_FIELD,{prop:`numberOfVotes ${w}`,target:"block",field:`maxVotesPerBlock ${l}`});const K=O.length;if(e.transactionInfo.numberOfTransactions=K,K>0)e.transactionInfo.startTindex=O[0].tIndex;else{if(!s.startTindexGetter)throw new mA(c.NOT_EXIST,{prop:"startTindexGetter",target:"eventEmitter"});e.transactionInfo.startTindex=await s.startTindexGetter()}e.transactionInfo.statisticInfo=N.toModel(),e.transactionInfo.payloadHashBuffer=await T.digest(),e.transactionInfo.payloadLength=b,e.transactionInfo.blobSize=C,e.transactionInfo.transactionInBlocks=O,e.blockParticipation=this.blockHelper.calcBlockParticipation({totalChainAsset:N.totalChainAsset,numberOfTransactions:K}),s.blockGeneratorEquityGetter&&(e.generatorEquity=await s.blockGeneratorEquityGetter(e.generatorPublicKey)),s.has("finishedDealTransactions")&&(AA("@deprecated",'logic "finishedDealTransactions" '),await s.emit("finishedDealTransactions",e))}finally{N.unref(g)}return e}};h([J("bfchain-core:TransactionCore"),u("design:type",Object)],Ya.prototype,"transactionCore",void 0);Ya=h([j(),Oe(7,J("cryptoHelper")),u("design:paramtypes",[_t,Pe,te,zs,$r,Rn,Ts,Object])],Ya);const{ArgumentIllegalException:tr,OutOfRangeException:Lw,ArgumentFormatException:Sh,NoFoundException:Ki,log:wh,info:bh,warn:EA,ConsensusException:Go}=re("CONTROLLER","_blockbase"),oi=Rl("generateBlock");let Qa=class{constructor(e,t,r,n,s,o,a,p,l,f,g,d,y,m){this.blockHelper=e,this.accountBaseHelper=t,this.transactionHelper=r,this.baseHelper=n,this.config=s,this.statisticsHelper=o,this.milestonesHelper=a,this.asymmetricHelper=p,this.chainAssetInfoHelper=l,this.chainTimeHelper=f,this.blockGeneratorCalculator=g,this.moduleMap=d,this.commonBlockVerify=y,this.cryptoHelper=m}async _wrapBlockError(e,t,r,n){if(e)try{return await e}catch(s){t.emit("blockError",{type:`replayBlock/${r}`,error:s,blockBody:n})}}async replayBlock(e,t,r,n={},s=this.config){oi&&bh("begin replayBlock");const{verifySignature:o,recordForkBlock:a}=n;if(!t)throw new tr(c.PARAM_LOST,{param:"transactions"});if(oi&&wh("before replayBlock"),r&&await this._wrapBlockError(r.emit("beforeGenerateBlock",e),r,"beforeGenerateBlock",e),this.blockHelper.verifyBlockVersion(e,s),e.height>1){const l=e.roundOfflineGeneratersHashMap,f=await this.blockHelper.forceGetBlockByHeight(e.height-1);if(e.previousBlockSignature!==f.signature){if(a){let b=n.blockGetterHelper;if(!b&&(b=this.moduleMap.get("blockGetterHelper"),!b))throw new Ki(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});await b.chainBlockFork(e,Fh.DIFFERENT_PRE_BLOCK_SIGNATURE)}throw new tr(c.NOT_MATCH,{to_compare_prop:`previousBlockSignature ${e.previousBlockSignature}`,be_compare_prop:`blockSignature ${e.signature}`,to_target:"block",be_target:"blockChain lastBlock"})}const g=this.chainTimeHelper,d=g.getSlotNumberByTimestamp(e.timestamp),y=g.getNextSlotNumberByTimestamp(f.timestamp);if(d<y)throw new Go(c.PROP_SHOULD_GT_FIELD,{prop:`timestamp ${e.timestamp}`,target:"block",field:`lastBlock timestamp ${f.timestamp}`});const{address:m,roundOfflineGeneratersReadonlyMap:E}=await this.blockGeneratorCalculator.calcGenerateBlockDelegate(f,{toTimestamp:e.timestamp}),T=await this.accountBaseHelper.getAddressFromPublicKeyString(e.generatorPublicKey);if(m!==T){const b=g.getSlotNumberByTimestamp(e.timestamp);throw new Go(c.INVALID_BLOCK_GENERATOR,{reason:`lastBlock.timestamp: ${f.timestamp} lastBlock.height: ${f.height}, block.timestamp: ${e.timestamp} curTime: ${g.getTimeByTimestamp(e.timestamp)} signature${e.signature} height: ${e.height} slot ${b} ${m}  ${T} `})}let w=0;for(const b in l){const C=E.get(+b);if(!C||C.join(",")!==l[b])throw new tr(c.NOT_MATCH,{to_compare_prop:"roundOfflineGeneratersHashMap",be_compare_prop:"roundOfflineGeneratersHashMap",to_target:"block",be_target:"calculate"});w++}if(w!==E.size)throw new tr(c.NOT_MATCH,{to_compare_prop:`roundOfflineGeneratersHashMap size ${w}`,be_compare_prop:`roundOfflineGeneratersHashMap size ${E.size}`,to_target:"block",be_target:"calculate"})}const p=await this.insertTransactionsForReplay(e,t,r,n,s);return this.commonBlockVerify.verifyBlockReward(e),oi&&wh("before signatureBlock"),r&&await this._wrapBlockError(r.emit("beforeSignatureBlock",e),r,"beforeSignatureBlock",e),this.commonBlockVerify.verifyBlockSize(e,p),o&&await this.commonBlockVerify.verifySignature(e),oi&&wh("before generatedBlock"),r&&await this._wrapBlockError(r.emit("generatedBlock",e),r,"generatedBlock",e),oi&&bh("finish replayBlock"),e}async insertTransactionsForReplay(e,t,r=new ve,n,s=this.config){const{verifySignature:o,skipVerifyStatisticInfo:a,skipVerifyParticipation:p}=n,{height:l,signature:f,generatorPublicKeyBuffer:g,statisticInfo:d}=e,{tpowOfWorkExemptionBlocks:y}=s,m=l>y,E=this.config.maxVotesPerBlock,T=this.cryptoHelper.sha256();let w=0,b=0,C=0;const N=this.statisticsHelper.forceGetStatisticsInfoByBlock(r.taskname||`core-replay-${l}`,f),O=[],{transactionCore:R,asymmetricHelper:F,transactionHelper:z,baseHelper:K}=this,{VOTE:B,GRAB_ASSET:M,SIGN_FOR_ASSET:V}=z,U=R.abortForbiddenTransaction,D=new Set;if(!r.startTindexGetter)throw new Ki(c.NOT_EXIST,{prop:"startTindexGetter",target:"eventEmitter"});if(!r.tIndexGetter)throw new Ki(c.NOT_EXIST,{prop:"tIndexGetter",target:"eventEmitter"});if(!r.assetChangesGetter)throw new Ki(c.NOT_EXIST,{prop:"assetChangesGetter",target:"eventEmitter"});if(!r.assetPrealnumGetter)throw new Ki(c.NOT_EXIST,{prop:"assetPrealnumGetter",target:"eventEmitter"});if(!r.blockGeneratorEquityGetter)throw new Ki(c.NOT_EXIST,{prop:"blockGeneratorEquityGetter",target:"eventEmitter"});const W=await r.startTindexGetter();if(e.startTindex!==W)throw new tr(c.NOT_MATCH,{to_compare_prop:`startTindex ${e.startTindex}`,be_compare_prop:`startTindex ${W}`,to_target:"block",be_target:"calculate"});const ae=await r.blockGeneratorEquityGetter(e.generatorPublicKey);if(e.generatorEquity!==ae)throw new tr(c.NOT_MATCH,{to_compare_prop:`generatorEquity ${e.generatorEquity}`,be_compare_prop:`generatorEquity ${ae}`,to_target:"block",be_target:"calculate"});const ue=new Map;try{this.statisticsHelper.bindApplyTransactionEventEmiter(r,N);const Ee=new wt(ee=>0);oi&&bh("begin insertTransactionsForReplay");for await(const ee of t){const ye=r.tIndexGetter(ee);oi&&wh("insert transaction: %d / %d",ee.tIndex+1,e.numberOfTransactions);try{if(ee.tIndex!==ye)throw new Lw(c.NOT_MATCH,{to_compare_prop:`tIndex ${ee.tIndex}`,be_compare_prop:`tIndex ${ye}`,to_target:"transactionInBlock",be_target:"calculate"});const De=ee.transaction,{type:ce,senderId:Q,storageValue:se,signature:oe}=De;if(D.has(oe))throw new Go(c.SHOULD_NOT_DUPLICATE,{prop:`transaction with signature ${oe}`,target:`block with height ${e.height}`});if(D.add(oe),!this.commonBlockVerify.canInsertTransaction(ce)){const Ce=je.VK.get(je.trsTypeToV(ce)),Fe=new Go(c.DISABLED_INSERT_TRANSACTION,{trsName:Ce});if(U)throw Fe;EA(Fe)}if(m){const Ce=Ee.forceGet(Q),Fe=await r.emit("verifyTransactionProfOfWork",{transaction:De,count:Ce});if(Fe===void 0)throw new Ki(c.NOT_EXIST,{prop:"verifyTransactionProfOfWork",target:"ApplyTransactionEventEmitter"});if(!Fe)throw new Sh(c.TRAN_POW_VERIFY_FAIL);Ee.set(Q,Ce+1)}if(O.push(ee.getBytes()),se&&(ce===M||ce===V)){const Ce=ue.get(se);if(Ce){for(const Fe of Ce)if(Fe.senderId===Q)throw new Go(c.SHOULD_NOT_INCLUDE,{prop:"Transactions",target:`block with height ${l}`,value:`transaction with storageValue ${se}`});Ce.push(De)}else ue.set(se,[De])}const le=R.getTransactionFactoryFromType(ce);if(await le.beginDealTransaction(De,r),await le.applyTransaction(De,r),!a){const Ce=await r.assetChangesGetter(ee),Fe=ee.transactionAssetChanges,Ye=Ce.length,rt=Fe.length;if(Ye!==rt)throw new tr(c.NOT_MATCH,{to_compare_prop:`transactionAssetChanges lenght ${rt}`,be_compare_prop:`transactionAssetChanges lenght ${Ye}`,to_target:`transactionInBlock ${Q} ${oe}`,be_target:"calculate"});for(let qe=0;qe<Ye;qe++)if(!K.isArrayEqual(Ce[qe].getBytes(),Fe[qe].getBytes()))throw new tr(c.NOT_MATCH,{to_compare_prop:`transactionAssetChanges with index ${qe} ${JSON.stringify(Fe[qe])}`,be_compare_prop:`transactionAssetChanges with index ${qe} ${JSON.stringify(Ce[qe])}`,to_target:`transactionInBlock ${Q} ${oe}`,be_target:"calculate"});const st=ee.assetPrealnum;if(st){const qe=await r.assetPrealnumGetter(ee);if(!qe)throw new tr(c.NOT_FOUND,{prop:`transaction assetPrealnum ${oe}`,target:"blockChain"});if(qe.remainAssetPrealnum!==st.remainAssetPrealnum)throw new tr(c.NOT_MATCH,{to_compare_prop:`assetPrealnum.remainAssetPrealnum ${JSON.stringify(st.remainAssetPrealnum)}`,be_compare_prop:`assetPrealnum.remainAssetPrealnum ${JSON.stringify(qe.remainAssetPrealnum)}`,to_target:`transactionInBlock ${Q} ${oe}`,be_target:"calculate"});if(qe.frozenMainAssetPrealnum!==st.frozenMainAssetPrealnum)throw new tr(c.NOT_MATCH,{to_compare_prop:`assetPrealnum.frozenMainAssetPrealnum ${JSON.stringify(st.frozenMainAssetPrealnum)}`,be_compare_prop:`assetPrealnum.frozenMainAssetPrealnum ${JSON.stringify(qe.frozenMainAssetPrealnum)}`,to_target:`transactionInBlock ${Q} ${oe}`,be_target:"calculate"})}}if(o){if(!await F.detachedVeriy(ee.getBytes(!0,!0),ee.signatureBuffer,g))throw new Sh("Invalid transactionInBlock signature: %O",ee.toJSON());if(e.generatorSecondPublicKeyBuffer){if(!ee.signSignatureBuffer)throw new Sh(c.PROP_IS_REQUIRE,{prop:"signSignature",target:"transactionInBlock"});if(!await F.detachedVeriy(ee.getBytes(!1,!0),ee.signSignatureBuffer,e.generatorSecondPublicKeyBuffer))throw new Sh("Invalid transactionInBlock signSignature: %O",ee.toJSON())}}Object.freeze(ee);const pe=ee.getBytes();T.update(pe),b+=pe.length,C+=ee.transaction.blobSize,await le.endDealTransaction(ee,r),ce===B&&w++}catch(De){const ce=await r.emit("error",{error:De,type:"replayBlock",transactionInBlock:ee});if(ce&&ce.continue)continue;throw De}}if(oi&&bh("finish insertTransactionsForReplay"),w>E)throw new Go(c.PROP_SHOULD_LTE_FIELD,{prop:`numberOfVotes ${w}`,target:"block",field:`maxVotesPerBlock ${E}`});const Ae=O.length;if(e.numberOfTransactions!==Ae)throw new tr(c.NOT_MATCH,{to_compare_prop:`numberOfTransactions ${e.numberOfTransactions}`,be_compare_prop:`numberOfTransactions ${Ae}`,to_target:"block",be_target:"calculate"});if(e.payloadLength!==b)throw new tr(c.NOT_MATCH,{to_compare_prop:`payloadLength ${e.payloadLength}`,be_compare_prop:`payloadLength ${b}`,to_target:"block",be_target:"calculate"});if(e.blobSize!==C)throw new tr(c.NOT_MATCH,{to_compare_prop:`blobSize ${e.blobSize}`,be_compare_prop:`blobSize ${C}`,to_target:"block",be_target:"calculate"});const P=await T.digest("hex");if(e.payloadHash!==P)throw new tr(c.NOT_MATCH,{to_compare_prop:`payloadHashHex ${e.payloadHash}`,be_compare_prop:`payloadHashHex ${P}`,to_target:"block",be_target:"calculate"});if(!p){const ee=this.blockHelper.calcBlockParticipation({totalChainAsset:N.totalChainAsset,numberOfTransactions:Ae});if(e.blockParticipation!==ee)throw new tr(c.NOT_MATCH,{to_compare_prop:`blockParticipation ${e.blockParticipation}`,be_compare_prop:`blockParticipation ${ee}`,to_target:"block",be_target:"calculate"})}if(!a){if(!this.baseHelper.isArrayEqual(d.getBytes(),N.toModel().getBytes()))throw new tr(c.NOT_MATCH,{to_compare_prop:`statisticsInfo ${JSON.stringify(d.toJSON())}`,be_compare_prop:`statisticsInfo ${JSON.stringify(N.toModel().toJSON())}`,to_target:"block",be_target:"calculate"});const ee=N.totalAsset,ye=N.totalFee;if(BigInt(e.totalAmount)!==ee)throw new tr(c.NOT_MATCH,{to_compare_prop:`totalAmount ${e.totalAmount}`,be_compare_prop:`totalAmount ${ee.toString()}`,to_target:"block",be_target:"calculate"});if(BigInt(e.totalFee)!==ye)throw new tr(c.NOT_MATCH,{to_compare_prop:`totalFee ${e.totalFee}`,be_compare_prop:`totalFee ${ye.toString()}`,to_target:"block",be_target:"calculate"});e.transactionInfo.transactionInBlockBufferList=O}r.has("finishedDealTransactions")&&(EA("@deprecated",'logic "finishedDealTransactions" '),await r.emit("finishedDealTransactions",e))}finally{N.unref(e.signature)}return O}};h([J("bfchain-core:TransactionCore"),u("design:type",Object)],Qa.prototype,"transactionCore",void 0);Qa=h([j(),Oe(13,J("cryptoHelper")),u("design:paramtypes",[_t,de,me,Pe,te,zs,Es,$r,ke,Vt,Rn,et,Ts,Object])],Qa);let Tu=class extends Dm{constructor(e,t,r,n,s,o,a,p,l,f,g,d){super(),this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.milestonesHelper=s,this.asymmetricHelper=o,this.cryptoHelper=a,this.blockGeneratorCalculator=p,this.commonBlockVerify=l,this.verifyBlockCore=f,this.generateBlockCore=g,this.replayBlockCore=d}async fromJSON(e,t){const r=_a.fromObject(e);return t&&t.verify&&await this.verify(r,t.config),r}async verifyBlockBody(e,t,r=this.config){await super.verifyBlockBody(e,t,r)}_generateBlock(e,t){const r=_a.fromObject({...e,asset:t});return r.reward=this.milestonesHelper.calcReward(r.height),r}};h([J("bfchain-core:TransactionCore"),u("design:type",Object)],Tu.prototype,"transactionCore",void 0);Tu=h([j(),Oe(6,J("cryptoHelper")),u("design:paramtypes",[_t,Pe,te,zs,Es,$r,Object,Rn,Ts,Ja,Ya,Qa])],Tu);const{ArgumentIllegalException:we}=re("CONTROLLER","GenesisBlockFactory");let Su=class extends Dm{constructor(e,t,r,n,s,o,a,p,l,f,g,d,y,m){super(),this.blockHelper=e,this.accountBaseHelper=t,this.baseHelper=r,this.config=n,this.statisticsHelper=s,this.milestonesHelper=o,this.asymmetricHelper=a,this.tpowDiffHelper=p,this.cryptoHelper=l,this.blockGeneratorCalculator=f,this.commonBlockVerify=g,this.verifyBlockCore=d,this.generateBlockCore=y,this.replayBlockCore=m}async fromJSON(e,t){const r=to.fromObject(e);return t&&t.verify&&await this.verify(r,t.config),r}async verifyBlockBody(e,t,r=this.config){await super.verifyBlockBody(e,t);const{baseHelper:n}=this,s=t.genesisAsset;if(!s)throw new we(c.PARAM_LOST,{param:"genesisBlock"});const o={target:"genesisBlock"},a=s.assetType;if(!a)throw new we(c.PROP_IS_REQUIRE,{prop:"assetType",...o});if(!n.isValidAssetType(a))throw new we(c.PROP_IS_INVALID,{prop:`assetType ${s.assetType}`,...o});const p=s.chainName;if(!p)throw new we(c.PROP_IS_REQUIRE,{prop:"chainName",...o});if(!n.isValidChainName(p))throw new we(c.PROP_IS_INVALID,{prop:`chainName ${s.chainName}`,...o});const l=s.magic;if(!l)throw new we(c.PROP_IS_REQUIRE,{prop:"magic",...o});if(!n.isValidChainMagic(l))throw new we(c.PROP_IS_INVALID,{prop:`magic ${s.magic}`,...o});const f=s.bnid;if(!f)throw new we(c.PROP_IS_REQUIRE,{prop:"bnid",...o});if(f!==kh.TESTNET&&f!==kh.MAINNET)throw new we(c.SHOULD_BE,{to_compare_prop:`bnid ${f}`,to_target:"remark",be_compare_prop:"BNID_TYPE",...o});if(!n.isPositiveInteger(s.beginEpochTime))throw new we(c.PROP_IS_INVALID,{prop:`beginEpochTime ${s.beginEpochTime}`,...o});const g=s.genesisLocationName;if(!g)throw new we(c.PROP_IS_REQUIRE,{prop:"genesisLocationName",...o});if(!n.isValidLocationName(g,r.chainName))throw new we(c.PROP_IS_INVALID,{prop:`genesisLocationName ${s.genesisLocationName}`,...o});if(!s.genesisAmount)throw new we(c.PROP_IS_REQUIRE,{prop:"genesisAmount",...o});if(!n.isValidAssetNumber(s.genesisAmount))throw new we(c.PROP_IS_INVALID,{prop:`genesisAmount ${s.genesisAmount}`,...o});if(!n.isPositiveFloatContainZero(s.minTransactionFeePerByte))throw new we(c.PROP_IS_INVALID,{prop:`minTransactionFeePerByte ${s.minTransactionFeePerByte}`,...o});if(!n.isPositiveInteger(s.maxTPSPerBlock))throw new we(c.PROP_IS_INVALID,{prop:`maxTPSPerBlock ${s.maxTPSPerBlock}`,...o});if(!n.isPositiveInteger(s.maxTransactionSize))throw new we(c.PROP_IS_INVALID,{prop:`maxTransactionSize ${s.maxTransactionSize}`,...o});if(!n.isPositiveInteger(s.maxBlockSize))throw new we(c.PROP_IS_INVALID,{prop:`maxBlockSize ${s.maxBlockSize}`,...o});if(!n.isNaturalNumber(s.consessusBeforeSyncBlockDiff))throw new we(c.PROP_IS_INVALID,{prop:`consessusBeforeSyncBlockDiff ${s.consessusBeforeSyncBlockDiff}`,...o});if(!n.isNaturalNumber(s.maxDelegateTxsPerRound))throw new we(c.PROP_IS_INVALID,{prop:`maxDelegateTxsPerRound ${s.maxDelegateTxsPerRound}`,...o});if(!n.isPositiveInteger(s.maxGrabTimesOfGiftAsset))throw new we(c.PROP_IS_INVALID,{prop:`maxGrabTimesOfGiftAsset ${s.maxGrabTimesOfGiftAsset}`,...o});const{maxVotesPerBlock:d,voteMinChainAsset:y,maxBlobSizePerTransaction:m}=s;if(d===void 0)throw new we(c.PROP_IS_REQUIRE,{prop:`maxVotesPerBlock ${d}`,...o});if(!n.isNaturalNumber(d))throw new we(c.PROP_IS_INVALID,{prop:`maxVotesPerBlock ${d}`,...o});if(m===void 0)throw new we(c.PROP_IS_REQUIRE,{prop:`maxBlobSizePerTransaction ${m}`,...o});if(!n.isNaturalNumber(m))throw new we(c.PROP_IS_INVALID,{prop:`maxBlobSizePerTransaction ${m}`,...o});if(!y)throw new we(c.PROP_IS_REQUIRE,{prop:`voteMinChainAsset ${y}`,...o});if(!n.isValidAssetNumber(y))throw new we(c.PROP_IS_INVALID,{prop:`voteMinChainAsset ${y}`,...o});if(!s.issueAssetMinChainAsset)throw new we(c.PROP_IS_REQUIRE,{prop:"issueAssetMinChainAsset",...o});if(!n.isValidAssetNumber(s.issueAssetMinChainAsset))throw new we(c.PROP_IS_INVALID,{prop:`issueAssetMinChainAsset ${s.issueAssetMinChainAsset}`,...o});const{maxMultipleOfAssetAndMainAsset:E,issueEntityFactoryMinChainAsset:T,maxMultipleOfEntityAndMainAsset:w}=s;if(!E)throw new we(c.PROP_IS_REQUIRE,{prop:"maxMultipleOfAssetAndMainAsset",...o});if(!n.isPositiveBigFloatNotContainZero(E))throw new we(c.PROP_IS_INVALID,{prop:`maxMultipleOfAssetAndMainAsset ${E}`,...o});if(!T)throw new we(c.PROP_IS_REQUIRE,{prop:"issueEntityFactoryMinChainAsset",...o});if(!n.isValidAssetNumber(T))throw new we(c.PROP_IS_INVALID,{prop:`issueEntityFactoryMinChainAsset ${T}`,...o});if(!w)throw new we(c.PROP_IS_REQUIRE,{prop:"maxMultipleOfEntityAndMainAsset",...o});if(!n.isPositiveBigFloatNotContainZero(w))throw new we(c.PROP_IS_INVALID,{prop:`maxMultipleOfEntityAndMainAsset ${w}`,...o});if(!s.registerChainMinChainAsset)throw new we(c.PROP_IS_REQUIRE,{prop:`registerChainMinChainAsset ${s.registerChainMinChainAsset}`,...o});if(!n.isValidAssetNumber(s.registerChainMinChainAsset))throw new we(c.PROP_IS_INVALID,{prop:`registerChainMinChainAsset ${s.registerChainMinChainAsset}`,...o});if(!n.isValidAccountParticipationWeightRatio(s.accountParticipationWeightRatio))throw new we(c.PROP_IS_INVALID,{prop:`accountParticipationWeightRatio ${s.accountParticipationWeightRatio}`,...o});if(!n.isValidBlockParticipationWeightRatio(s.blockParticipationWeightRatio))throw new we(c.PROP_IS_INVALID,{prop:`blockParticipationWeightRatio ${s.blockParticipationWeightRatio}`,...o});if(!n.isPositiveInteger(s.maxApplyAndConfirmedBlockHeightDiff))throw new we(c.PROP_IS_INVALID,{prop:`maxApplyAndConfirmedBlockHeightDiff ${s.maxApplyAndConfirmedBlockHeightDiff}`,...o});const{blockPerRound:b,forgeInterval:C,delegates:N,whetherToAllowDelegateContinusElections:O}=s;if(!n.isPositiveInteger(b))throw new we(c.PROP_IS_INVALID,{prop:`blockPerRound ${b}`,...o});if(!n.isPositiveInteger(N))throw new we(c.PROP_IS_INVALID,{prop:`delegates ${N}`,...o});if(!n.isBoolean(O))throw new we(c.PROP_IS_INVALID,{prop:`whetherToAllowDelegateContinusElections ${O}`,...o});if(O){if(N<b)throw new we(c.GENESIS_DELEGATE_NOT_ENOUGH,{expected:b,actual:N,...o})}else if(N<b*2)throw new we(c.GENESIS_DELEGATE_NOT_ENOUGH,{expected:b*2,actual:N,...o});if(!n.isPositiveInteger(C))throw new we(c.PROP_IS_INVALID,{prop:`forgeInterval ${C}`,...o});if(C<5)throw new we(c.PROP_SHOULD_GTE_FIELD,{prop:`forgeInterval ${C}`,field:5,...o});if(!s.rewardPercent)throw new we(c.PROP_IS_REQUIRE,{prop:"rewardPercent",...o});if(!n.isValidChainRewardPercent(s.rewardPercent))throw new we(c.PROP_IS_INVALID,{prop:`rewardPercent ${s.rewardPercent}`,...o});if(!s.ports)throw new we(c.PROP_IS_REQUIRE,{prop:"ports",...o});if(!n.isValidChainPorts(s.ports))throw new we(c.PROP_IS_INVALID,{prop:`ports ${s.ports}`,...o});const R=s.rewardPerBlock;if(!R)throw new we(c.PROP_IS_REQUIRE,{prop:"rewardPerBlock",...o});if(!R.heights)throw new we(c.PROP_IS_REQUIRE,{prop:"rewardPerBlock.heights",...o});if(!R.rewards)throw new we(c.PROP_IS_REQUIRE,{prop:"rewardPerBlock.rewards",...o});const{heights:F,rewards:z}=R;if(!n.isArray(F))throw new we(c.PROP_SHOULD_BE_ARRAY,{prop:"rewardPerBlock.heights",...o});if(!n.isArray(z))throw new we(c.PROP_SHOULD_BE_ARRAY,{prop:"rewardPerBlock.rewards",...o});const K=F.length,B=z.length;if(K<1)throw new we(c.PROP_LENGTH_SHOULD_GTE_FIELD,{prop:"rewardPerBlock.heights",field:1,...o});if(B<2)throw new we(c.PROP_LENGTH_SHOULD_GTE_FIELD,{prop:"rewardPerBlock.rewards",field:2,...o});if(B-K!==1)throw new we(c.SHOULD_BE,{to_compare_prop:`rewards's length - heights's length ${B-K}`,to_target:"rewardPerBlock",be_compare_prop:1,...o});if(z[B-1]!=="0")throw new we(c.SHOULD_BE,{to_compare_prop:`the last one of rewards ${z[B-1]}`,to_target:"rewardPerBlock",be_compare_prop:0,...o});if(Number.isNaN(F[0])||!n.isValidNumber(F[0]))throw new we(c.PROP_IS_INVALID,{prop:"rewardPerBlock.heights",...o});if(K>1)for(let D=0;D<K-1;D++){if(Number.isNaN(F[D+1])||!n.isValidNumber(F[D+1]))throw new we(c.PROP_IS_INVALID,{prop:"rewardPerBlock.heights",...o});if(F[D]>=F[D+1])throw new we(c.PROP_IS_INVALID,{prop:"rewardPerBlock.heights",...o})}for(let D=0;D<B;D++)if(!n.isValidAssetNumber(z[D]))throw new we(c.PROP_IS_INVALID,{prop:"rewardPerBlock.rewards",...o});if(s.nextRoundDelegates.length!==r.blockPerRound)throw new we(c.NOT_MATCH,{to_compare_prop:`nextRoundDelegates length ${s.nextRoundDelegates.length}`,be_compare_prop:`config.blockPerRound: ${r.blockPerRound}`,to_target:"genesisBlockRemark",be_target:"config",...o});if(s.maxBeginBalance!=="0")throw new we(c.SHOULD_BE,{to_compare_prop:`maxBeginBalance ${s.maxBeginBalance}`,to_target:"GenesisBlockRemark",be_compare_prop:"'0'",...o});if(s.maxTxCount!==0)throw new we(c.SHOULD_BE,{to_compare_prop:`maxTxCount ${s.maxTxCount}`,to_target:"GenesisBlockRemark",be_compare_prop:"0",...o});const M=s.nextRoundDelegates;if(n.getVariableType(M)!=="[object Array]")throw new we(c.SHOULD_BE,{to_compare_prop:"nextRoundDelegates",to_target:"genesisBlock",be_compare_prop:"array",...o});for(let D=0;D<M.length;D++){const W=M[D];if(!await this.accountBaseHelper.isAddress(W.address))throw new we(c.PROP_IS_INVALID,{prop:`nextRoundDelegates[${D}].address ${M[D].address}`,target:"genesisBlock.nextRoundDelegates"});if(!this.baseHelper.isValidAccountEquity(W.equity))throw new we(c.PROP_IS_INVALID,{prop:`nextRoundDelegates[${D}].equity ${M[D].equity}`,target:"genesisBlock.nextRoundDelegates"})}if(!n.isNaturalNumber(s.averageComputingPower))throw new we(c.PROP_IS_INVALID,{prop:`averageComputingPower ${s.averageComputingPower}`,...o});if(!n.isNaturalNumber(s.tpowOfWorkExemptionBlocks))throw new we(c.PROP_IS_INVALID,{prop:`tpowOfWorkExemptionBlocks ${s.tpowOfWorkExemptionBlocks}`,...o});const{growthFactor:V,participationRatio:U}=s.transactionPowOfWorkConfig;{const{denominator:D,numerator:W}=V,ae=BigInt(W),ue=BigInt(D);if(!(ae>=ue&&ue>=BigInt(1)))throw new we(c.PROP_IS_INVALID,{prop:`transactionPowOfWorkConfig.growthFactor ${D}`,...o})}if(!n.isPositiveFloatContainZero(U))throw new we(c.PROP_IS_INVALID,{prop:`transactionPowOfWorkConfig.participationRatio ${U}`,...o})}_generateBlock(e,t){const r=to.fromObject({...e,asset:t});return r.generatorPublicKey=e.generatorPublicKey,r.reward="0",r}};h([J("bfchain-core:TransactionCore"),u("design:type",Object)],Su.prototype,"transactionCore",void 0);Su=h([j(),Oe(8,J("cryptoHelper")),u("design:paramtypes",[_t,de,Pe,te,zs,Es,$r,mg,Object,Rn,Ts,Ja,Ya,Qa])],Su);const{ArgumentIllegalException:zo,ConsensusException:os,NoFoundException:IA}=re("CONTROLLER","RoundLastBlockFactory");let wu=class extends Dm{constructor(e,t,r,n,s,o,a,p,l,f,g,d,y){super(),this.blockHelper=e,this.baseHelper=t,this.config=r,this.statisticsHelper=n,this.milestonesHelper=s,this.asymmetricHelper=o,this.cryptoHelper=a,this.blockGeneratorCalculator=p,this.commonBlockVerify=l,this.verifyBlockCore=f,this.generateBlockCore=g,this.replayBlockCore=d,this.moduleMap=y}async fromJSON(e,t){const r=Aa.fromObject(e);return t&&t.verify&&await this.verify(r,t.config),r}async verifyBlockBody(e,t,r=this.config){await super.verifyBlockBody(e,t,r);const n=t.roundLastAsset,s={target:"roundLastBlockAsset"},{baseHelper:o}=this;if(!n.nextRoundDelegates)throw new zo(c.PROP_IS_REQUIRE,{prop:"nextRoundDelegates",...s});if(!n.newDelegates)throw new zo(c.PROP_IS_REQUIRE,{prop:"newDelegates",...s});if(!o.isValidAssetNumber(n.maxBeginBalance))throw new zo(c.PROP_IS_INVALID,{prop:"maxBeginBalance",type:"asset number",...s});if(!o.isNaturalNumber(n.maxTxCount))throw new zo(c.PROP_IS_INVALID,{prop:`maxTxCount ${n.maxTxCount}`,type:"block maxTxCount",...s});if(!o.isValidChainOnChainHash(n.hash))throw new zo(c.PROP_IS_INVALID,{prop:`chainOnChainHash ${n.hash}`,type:"chainOnChainHash",...s});if(!o.isString(n.rate))throw new zo(c.PROP_IS_INVALID,{prop:`rate ${n.rate}`,type:"rate",...s})}_generateBlock(e,t){const r=Aa.fromObject({...e,asset:t});return r.reward=this.milestonesHelper.calcReward(r.height),r}async replayBlock(e,t,r,n={},s=this.config){if(await super.replayBlock(e,t,r,n,s),n.verifyAsset){const{height:o,asset:a}=e;let p=n.transactionGetterHelper;if(!p&&(p=this.moduleMap.get("transactionGetterHelper"),!p))throw new IA(c.NOT_EXIST,{prop:"transactionGetterHelper",target:"moduleStroge"});const l=a.roundLastAsset;await this.checkBlockNewDelegates(e.height,l.newDelegates,p);let f=n.blockGetterHelper;if(!f&&(f=this.moduleMap.get("blockGetterHelper"),!f))throw new IA(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});await this.checkBlockChainOnChainHash(o,l.hash,f),await this.checkBlockNewForgingDelegates(e,f)}return e}async checkNewDelegates(e,t){const r=await t.getRegisterNewDelegates(e),{maxDelegateTxsPerRound:n,delegates:s,blockPerRound:o}=this.config,a=r.length;if(e>o){if(a>n)throw new os(c.PROP_SHOULD_LTE_FIELD,{prop:`delegateCount ${a}`,target:"block",field:`maxDelegateTxsPerRound ${n}`})}else if(s!==a)throw new os(c.PROP_SHOULD_EQ_FIELD,{prop:`number of newDelegates ${a}`,target:"newDelegates",field:s});return r}async checkBlockNewDelegates(e,t,r){const n=await this.checkNewDelegates(e,r),s=t.length;if(s!==n.length)throw new os(c.NOT_MATCH,{to_compare_prop:`number of new delegates ${s}`,be_compare_prop:`number of new delegates ${n.length}`,to_target:"block",be_target:"calculate"});for(let o=0;o<s;o++)if(t[o]!==n[o])throw new os(c.NOT_MATCH,{to_compare_prop:`new delegates ${t[o]}`,be_compare_prop:`new delegates ${n[o]}`,to_target:"block",be_target:"calculate"})}async checkBlockChainOnChainHash(e,t,r){const n=await this.blockHelper.calcChainOnChainHash(e,r);if(n!==t)throw new os(c.NOT_MATCH,{to_compare_prop:`remark hash ${t}`,be_compare_prop:`remark hash ${n}`,to_target:"block",be_target:"calculate"})}async checkBlockNewForgingDelegates(e,t){const r=await t.getNewForgingDelegates(await t.getLastBlock(),e.generatorPublicKey),n=e.asset.roundLastAsset.nextRoundDelegates,s=r.length;if(s!==n.length)throw new os(c.NOT_MATCH,{to_compare_prop:`nextRoundDelegates length ${n.length}`,be_compare_prop:`nextRoundDelegates length ${r.length}`,to_target:"block remark",be_target:"calculate"});for(let o=0;o<s;o++){const{address:a,vote:p}=r[o],l=n[o];if(l.address!==a)throw new os(c.NOT_MATCH,{to_compare_prop:`nextRoundDelegates index ${o} address ${l.address}`,be_compare_prop:`nextRoundDelegates index ${o} address ${a}`,to_target:"block remark",be_target:"calculate"});const f=p.toString();if(l.equity!==f)throw new os(c.NOT_MATCH,{to_compare_prop:`nextRoundDelegates index ${o} address ${l.address} equity ${l.equity}`,be_compare_prop:`nextRoundDelegates index ${o} address ${a} equity ${f}`,to_target:"block remark",be_target:"calculate"})}}checkMaxBeginBalanceAndMaxTxCount(e,t){const r=e.asset.roundLastAsset;if(r.maxBeginBalance!==t.maxBeginBalance)throw new os(c.NOT_MATCH,{to_compare_prop:`maxBeginBalance ${r.maxBeginBalance}`,be_compare_prop:`maxBeginBalance ${t.maxBeginBalance}`,to_target:"block remark",be_target:"calculate"});if(r.maxTxCount!==t.maxTxCount)throw new os(c.NOT_MATCH,{to_compare_prop:`maxTxCount ${r.maxTxCount}`,be_compare_prop:`maxTxCount ${t.maxTxCount}`,to_target:"block remark",be_target:"calculate"})}};h([J("bfchain-core:TransactionCore"),u("design:type",Object)],wu.prototype,"transactionCore",void 0);wu=h([j(),Oe(6,J("cryptoHelper")),u("design:paramtypes",[_t,Pe,te,zs,Es,$r,Object,Rn,Ts,Ja,Ya,Qa,et])],wu);const{NoFoundException:Et}=re("helper-account","accountHelper");let bu=class{getAccounts(e,t,r=this.accountGetterHelper){if(!r)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAccounts(e,t)}getNextRoundDelegates(e=this.accountGetterHelper){if(!e&&!e)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return e.getNextRoundDelegates()}getDelegates(e,t=this.accountGetterHelper){if(!t)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getDelegates(e)}getAccountInfo(e,t=this.accountGetterHelper){if(!t)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getAccountInfo(e)}getAccountTxCountInBlock(e,t=this.accountGetterHelper){if(!t)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getAccountTxCountInBlock(e)}getAccountAssets(e,t,r=this.accountGetterHelper){if(!r)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAccountAssets(e,t)}getAccountInfoAndAssets(e,t,r=this.accountGetterHelper){if(!r)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAccountInfoAndAssets(e,t)}getDApp(e,t,r,n=this.accountGetterHelper){if(!n)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return n.getDApp(e,t,r)}isDAppPossessor(e,t,r=this.accountGetterHelper){if(!r)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.isDAppPossessor(e,t)}isVoteForDelegate(e,t,r,n=this.accountGetterHelper){if(!n)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return n.isVoteForDelegate(e,t,r)}getLocationName(e,t,r,n=this.accountGetterHelper){if(!n)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return n.getLocationName(e,t,r)}isLnsPossessorOrManager(e,t,r=this.accountGetterHelper){if(!r)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.isLnsPossessorOrManager(e,t)}isSubLocationNameExist(e,t,r=this.accountGetterHelper){if(!r)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.isSubLocationNameExist(e,t)}isLocationNameForbidden(e,t=this.accountGetterHelper){if(!t)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.isLocationNameForbidden(e)}getFrozenAsset(e,t,r,n=this.accountGetterHelper){if(!n)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return n.getFrozenAsset(e,t,r)}getAsset(e,t,r=this.accountGetterHelper){if(!r)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAsset(e,t)}getCurrency(e,t=this.accountGetterHelper){if(!t)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getCurrency(e)}isCurrencyForbidden(e,t=this.accountGetterHelper){if(!t)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.isCurrencyForbidden(e)}getMagic(e,t=this.accountGetterHelper){if(!t)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getMagic(e)}getChain(e,t=this.accountGetterHelper){if(!t)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getChain(e)}getAlias(e,t=this.accountGetterHelper){if(!t)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getAlias(e)}getMigrateCertificate(e,t=this.accountGetterHelper){if(!t)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return t.getMigrateCertificate(e)}mergeAccountMissedBlock(e,t,r=this.accountGetterHelper){if(!r)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.mergeAccountMissedBlock(e,t)}mergeAccountEquity(e,t,r=this.accountGetterHelper){if(!r)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.mergeAccountEquity(e,t)}getAccountVoteInfo(e,t,r=this.accountGetterHelper){if(!r)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return r.getAccountVoteInfo(e,t)}getMemoryDelegates(e=this.accountGetterHelper){if(!e)throw new Et(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});return e.getMemoryDelegates()}};h([J("accountGetterHelper",{optional:!0}),u("design:type",Object)],bu.prototype,"accountGetterHelper",void 0);bu=h([j()],bu);re("Core","PickNextRoundDelegates");let TA=class{constructor(e,t,r,n,s){this.config=e,this.blockHelper=t,this.accountHelper=r,this.accountBaseHelper=n,this.transactionHelper=s}async getNextRoundDelegates(e,t){const r=this.blockHelper.calcRoundByHeight(e);return await this.calcForgingDelegates(r,t)}async calcForgingDelegates(e,t){let r=await this.accountHelper.getNextRoundDelegates(t);const n=r.length<this.config.blockPerRound;let s=r.map(a=>a.address),o=e-1;for(;r.length<this.config.blockPerRound&&o!==0;){const a=await this.__getAlternateDelegates(o,r,s,t);r=a.results,s=a.pickAddressArr,o--}return n&&(r=this.blockHelper.sortInRankAccountInfoList(r)),r}async __getAlternateDelegates(e,t,r,n){if(e===1)return await this.getGenesisDelegates(t,r,n);const s=await this.blockHelper.forceGetBlockGeneratorAddressByRound(e),o=[];for(const p of s)r.includes(p)||(r[r.length]=p,o[o.length]=p);let a=await this.accountHelper.getAccounts(o,e,n);return a=this.__sortByProductivity(a),t.push.apply(t,a.slice(0,this.config.blockPerRound-t.length)),{results:t,pickAddressArr:r}}async getGenesisDelegates(e,t,r){const n=this.transactionHelper.genesisDelegates(this.config),s=[];for(const a of n)t.includes(a)||(s[s.length]=a,t[t.length]=a);let o=await this.accountHelper.getAccounts(s,1,r);return o=this.__sortByProductivity(o),e.push.apply(e,o.slice(0,this.config.blockPerRound-e.length)),{results:e,pickAddressArr:t}}__sortByProductivity(e){if(e.length<=1)return e;const t=[...e],r=Math.floor(t.length/2),n=t.splice(r,1)[0],s=[],o=[];for(let a=0;a<t.length;a++)t[a].productivity>n.productivity?s[s.length]=t[a]:o[o.length]=t[a];return this.__sortByProductivity(s).concat([n],this.__sortByProductivity(o))}};TA=h([j(),u("design:paramtypes",[te,_t,bu,de,me])],TA);const{warn:SA,ConsensusException:Vf,log:Dw}=re("Core","blockForkCheck");var Xe;(function(i){i[i.KEEP=1]="KEEP",i[i.MERGE=2]="MERGE",i[i.FORK=3]="FORK"})(Xe||(Xe={}));var Nu;(function(i){i[i.PUZZLED=11]="PUZZLED"})(Nu||(Nu={}));let wA=class{constructor(e,t,r){this.blockHelper=e,this.timeHelper=t,this.config=r}async checkNewBlockFromChainChannel(e,t,r=this.blockHelper.blockGetterHelper){const n=await this.checkNewBlock(e,t.toBlockGetterHelper({maxHeight:e.height}),r);if(n.plot===Xe.MERGE){const s=await this.blockHelper.getCurrentReplayingBlockInfo(r),o=s&&s.chainChannelGroup;o&&o.addChainChannels(t)}return n}checkSameHeightBlockPlot_(e,t){if(e.timestamp>t.timestamp)return Xe.FORK;if(e.timestamp<t.timestamp)return Xe.KEEP;if(e.previousBlockSignature===t.previousBlockSignature&&e.timestamp===t.timestamp){if(e.blockParticipation>t.blockParticipation)return Xe.KEEP;if(e.blockParticipation===t.blockParticipation){if(e.numberOfTransactions>t.numberOfTransactions)return Xe.KEEP;if(e.totalFee>t.totalFee)return Xe.KEEP;if(e.totalFee===t.totalFee){if(e.signature>t.signature)return Xe.KEEP;if(e.signature===t.signature)return Xe.MERGE}}}return Xe.FORK}checkSameHeightBlockListPlot_(e,t){return this.checkSameHeightBlockPlot_(this.blockHelper.parseBlockPlotCheckerListToPlotChecker(e),this.blockHelper.parseBlockPlotCheckerListToPlotChecker(t))}async getBlockPlotCheckerEnd_(e,t){const r={pc:t,blockGetterHelper:e},n=await this.blockHelper.getCurrentReplayingBlockInfo(e);n&&(r.blockGetterHelper=n.blockGetterHelper,r.pc=this.blockHelper.parseBlockToPlotChecker(await n.blockGetterHelper.getLastBlock()));const s=await this.blockHelper.getCurrentGenerateBlock(e);return s&&(r.pc=this.blockHelper.parseNewBlockToPlotChecker(s)),r}async checkBlockGetterPlot(e,t,r,n){const[s,o]=await Promise.all([this.getBlockPlotCheckerEnd_(t,e),this.getBlockPlotCheckerEnd_(n,r)]);if(s.pc.height<=o.pc.height){const p=await this.checkBlockGetterPlotEnd(s.pc,o.pc,o.blockGetterHelper);return p.plot===Xe.KEEP?{plot:Xe.KEEP,height:e.height,blockPlotChecker:e}:p.plot===Xe.MERGE?{plot:Xe.MERGE,height:r.height,blockPlotChecker:r}:p.plot===Xe.FORK&&typeof p.height=="number"&&p.height<=e.height?{plot:p.plot,height:p.height}:p}const a=await this.checkBlockGetterPlotEnd(o.pc,s.pc,s.blockGetterHelper);return a.plot===Xe.MERGE?{plot:Xe.MERGE,height:r.height,blockPlotChecker:r}:a.plot===Xe.FORK?{plot:Xe.KEEP,height:e.height,blockPlotChecker:e}:(SA(`should not happen: the pc5.height is large then pc6.height, Why plot is ${Xe[a.plot]}?`),a)}async checkBlockGetterPlotEnd(e,t,r){const n={plot:Xe.MERGE,height:t.height,blockPlotChecker:t},s={plot:Xe.KEEP,height:e.height,blockPlotChecker:e},o=p=>({plot:Xe.FORK,height:p}),a=()=>({plot:Nu.PUZZLED});if(e.height<t.height)return(e.height===t.height-1?t.previousBlockSignature:await this.blockHelper.forceGetBlockSignatureByHeight(e.height,r))===e.signature?n:o();if(e.height===t.height){if(e.signature===t.signature)return n;if(e.previousBlockSignature===t.previousBlockSignature){const p=this.checkSameHeightBlockPlot_(e,t);return p===Xe.FORK?o(e.height-1):p===Xe.KEEP?s:n}return a()}return s}async checkNewBlock(e,t,r=this.blockHelper.blockGetterHelper){const n=await this.blockHelper.getLastBlock(r),s=this.blockHelper.parseBlockToPlotChecker(await this.blockHelper.getLastBlock(r));let o;e instanceof dt?o=this.blockHelper.parseBlockToPlotChecker(e):o=e;const a=await this.checkBlockGetterPlot(s,r,o,t),p={plot:Xe.MERGE,height:o.height,block:this.blockHelper.getBlockFromPlotChecker(o)},l={plot:Xe.KEEP,height:s.height,block:n},f=(g,d)=>({plot:Xe.FORK,height:g,block:d});if(a.plot===Nu.PUZZLED){const g=await this.findNearestSameBlock(s.height-1,r,t),d=(await this.blockHelper.forceGetBlockListByHeightRange(g.height+1,s.height,r)).map(E=>this.blockHelper.parseBlockToPlotChecker(E)),y=(await this.blockHelper.forceGetBlockListByHeightRange(g.height+1,o.height,t)).map(E=>this.blockHelper.parseBlockToPlotChecker(E)),m=this.checkSameHeightBlockListPlot_(d,y);if(m===Xe.FORK)return f(g.height,g);if(m===Xe.KEEP)return l;if(m===Xe.MERGE)return SA("should not happen. pc1 and pc2 are puzzled. should not 'MERGE'!"),p;throw new Error("should not happen in PUZZLED")}if(a.plot===Xe.FORK){if(typeof a.height=="number")return f(a.height,a.height===s.height?n:void 0);const g=await this.findNearestSameBlock(s.height-1,r,t);return f(g.height,g)}if(a.plot===Xe.MERGE)return p;if(a.plot===Xe.KEEP)return l;throw new Error("should not happen in checkResult")}async findNearestSameBlock(e,t,r){if(e<1)throw new Vf(c.GENESIS_BLOCK_MAYBE_NO_EQUAL);const n=this.blockHelper.calcRoundByHeight(e)-1,s=this.blockHelper.calcRoundEndHeight(n),o=await this.findNearestSameBlockInOneRound(e,s,t,r);if(o)return o;let a=s;do{const f=await this.blockHelper.forceGetBlockByHeight(a,t);if((await this.blockHelper.forceGetBlockByHeight(a,r)).asset.roundLastAsset.hash===f.asset.roundLastAsset.hash)break;a-=this.config.blockPerRound}while(a>1);const p=a+this.config.blockPerRound;Dw(` ${p} 58 ()`);const l=await this.findNearestSameBlockInOneRound(p,p-this.config.blockPerRound,t,r);if(!l)throw new Vf(c.FAILED_TO_FIND_NEAREST_SAME_BLOCK_IN_ONE_ROUND);return l}async findNearestSameBlockInOneRound(e,t,r,n){for(let s=e;s>=t-1;s--){const o=await this.blockHelper.forceGetBlockByHeight(s,n),a=await this.blockHelper.forceGetBlockByHeight(s,r);if(o.signature===a.signature)return a;if(s===1)throw new Vf(c.GENESIS_BLOCK_NOT_MATCH)}}};wA=h([j(),u("design:paramtypes",[_t,Vt,te])],wA);const{NoFoundException:kw}=re("BLOCK","RecommendedDelegateCalculator");let bA=class{constructor(e,t,r,n){this.config=e,this.blockHelper=t,this.accountBaseHelper=r,this.jsbiHelper=n,this.forgingDelegates={delegates:[],curRound:0}}async calDelegateNumberOfForgingAndPackagedTransactions(e,t,r,n){const s=this.config.blockPerRound,o=e<=s?e:e-e%s;let a=1;{const g=t*s;o>g&&(a=o-g)}const p=n?await n.wrapAsync(this.blockHelper.getBlocksByRange(a,o,r)):await this.blockHelper.getBlocksByRange(a,o,r),l=[],f=new Map;for(const g of p){const d=await this.accountBaseHelper.getAddressFromPublicKeyString(g.generatorPublicKey),y=f.get(d);y?(y.producedblocks++,y.applyTxNumber+=g.numberOfTransactions):(l[l.length]=d,f.set(d,{producedblocks:1,applyTxNumber:g.numberOfTransactions}))}return{forgeInfoMap:f,generatorAddressList:l}}async calCanBePickAccounts(e,t,r,n,s,o){const a=o?await o.wrapAsync(s.getAccounts(t,n)):await s.getAccounts(t,n),p=[],l=this.jsbiHelper;for(const f of a)if(l.compareFraction(l.numberToFraction(f.productivity),e)>=0&&f.isAcceptVote){const g=r.get(f.address),d={address:f.address,productivity:f.productivity,forgedBlocks:g.producedblocks,applyTxNumber:g.applyTxNumber,vote:f.vote};p[p.length]=d}else r.delete(f.address);return p}sortDelegatesByFields(e,t){if(e.length<=1)return e;const r=[...e],n=Math.floor(r.length/2),s=r.splice(n,1)[0],o=[],a=[];for(let p=0;p<r.length;p++){const l=r[p];if(l[t]>s[t]){o[o.length]=r[p];continue}if(l[t]<s[t]){a[a.length]=r[p];continue}if(l.address<s.address){o[o.length]=r[p];continue}a[a.length]=r[p]}return this.sortDelegatesByFields(o,t).concat([s],this.sortDelegatesByFields(a,t))}hybridArray(e,t,r,n,s){const o=[...e,...t,...r,...n,...s];let a=o.length;for(;a;){const p=Math.floor(Math.random()*a--);[o[p],o[a]]=[o[a],o[p]]}return o}async calRecommendedDelegates(e,t,r,n,s,o){const{forgeInfoMap:a,generatorAddressList:p}=await this.calDelegateNumberOfForgingAndPackagedTransactions(e,t.numberOfRounds,s,o),l=this.blockHelper.calcRoundByHeight(e),f=await this.calCanBePickAccounts(t.minBeSelectProductivity,p,a,l,n,o),g=this.jsbiHelper,d=f.length,y=Number(g.multiplyFloorFraction(d,t.productivityPercent)),m=Number(g.multiplyFloorFraction(d,t.forgedBlocksPercent)),E=Number(g.multiplyFloorFraction(d,t.applyTxPercent)),T=Number(g.multiplyFloorFraction(d,t.votePercent)),w=d-y-m-E-T,b=this.sortDelegatesByFields(f,"productivity"),C=b.splice(0,y).map(U=>U.address),N=this.sortDelegatesByFields(b,"forgedBlocks"),O=N.splice(0,m).map(U=>U.address),R=this.sortDelegatesByFields(N,"applyTxNumber"),F=R.splice(0,E).map(U=>U.address),z=[];for(const U of R)r.includes(U.address)||(z[z.length]=U);const B=this.sortDelegatesByFields(z,"vote").splice(0,T).map(U=>U.address),M=o?await o.wrapAsync(n.getRecommendedNewDelegates(w,e)):await n.getRecommendedNewDelegates(w,e),V=[];for(const U of M)U.isAcceptVote&&(V[V.length]=U.address);if(V.length<w){const U=this.sortDelegatesByFields(z,"productivity");for(const D of U)if(V[V.length]=D.address,V.length===w)break}this.forgingDelegates.delegates=this.hybridArray(C,O,F,B,V)}allocationQuota(e,t,r,n){if(e.length!==0)for(let s=0;s<e.length&&(t.has(e[s])||r.indexOf(e[s])<0&&(r[r.length]=e[s]),r.length!==n);s++);}async randomAccessDelegates(e,t,r,n,s,o){if(!n)throw new kw(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});const a=o&&o.aborter,p=[],l=r.maxNumberOfRecommended,f=this.config.blockPerRound,g=a?await a.wrapAsync(n.getAccountVoteInfo(t,e)):await n.getAccountVoteInfo(t,e),d=new Set(g),y=this.blockHelper.calcRoundByHeight(t);let m=(y-1)*f;m=m||1;const E=a?await a.wrapAsync(this.blockHelper.forceGetBlockByHeight(m,s)):await this.blockHelper.forceGetBlockByHeight(m,s);let T=[];m===1?T=E.asset.genesisAsset.nextRoundDelegates:T=E.asset.roundLastAsset.nextRoundDelegates;const w=T.map(O=>O.address);if(m>f)for(const O of w)d.add(O);let b,C;o&&o.memoryDelegates?b=o.memoryDelegates:b=a?await a.wrapAsync(n.getMemoryDelegates()):await n.getMemoryDelegates(),o&&o.delegates?C=o.delegates:C=a?await a.wrapAsync(n.getAccounts(b,y)):await n.getAccounts(b,y);for(const O of C)O.isAcceptVote||d.add(O.address);for(const O of b)if(d.has(O)||(p[p.length]=O),p.length===l)return{delegate:p};return(y!==this.forgingDelegates.curRound||t<=f)&&(this.forgingDelegates.delegates=[],this.forgingDelegates.curRound=y,await this.calRecommendedDelegates(t,r,w,n,s,a)),this.allocationQuota(this.forgingDelegates.delegates,d,p,l),{delegate:p}}};bA=h([j(),u("design:paramtypes",[te,_t,de,It])],bA);const{ArgumentFormatException:NA,log:cB,warn:Hw}=re("Core","Block");let Fl=class{constructor(e,t,r,n,s,o,a){this.blockHelper=e,this.asymmetricHelper=t,this.blockGeneratorCalculator=r,this.keypairHelper=n,this.cryptoHelper=s,this.Buffer=o,this.moduleMap=a,this._blockFactoryCache=new Map,this.fromJSON=this.recombineBlock}getBlockFactory(e){let t=this._blockFactoryCache.get(e);return t||(t=Ot(e,this.moduleMap),this._blockFactoryCache.set(e,t)),t}getBlockFactoryFromHeight(e){const t=this.blockHelper.parseTypeByHeight(e);return this.getBlockFactoryFromBaseType(t)}getBlockFactoryFromBaseType(e){const t=Fw.KF.get(e);if(!t)throw new NA(c.INVALID_BASE_TYPE,{base_type:e});return this.getBlockFactory(t)}async generateBlock(e,t,r,n,s,o,a){const p=this.getBlockFactory(e);return p.verifyKeypair(s),o&&(p.verifyKeypair(o),t.generatorSecondPublicKey=Me(o.publicKey)),t.remark=t.remark||{},await p.verifyBlockBody(t,r),await p.generateBlock(t,r,n,s,o,a)}async replayBlock(e,t,r,n={}){const s=this.getBlockFactoryFromHeight(e.height);return await s.verifyBlockBody(e,e.asset),await s.replayBlock(e,t,r,n)}async recombineBlock(e){return await this.getBlockFactoryFromHeight(e.height).fromJSON(e)}parseBytesToBlock(e){return dt.decode(e)}parseBytesToSomeBlock(e,t){if(typeof t!="number"){const n=new sn(e);n.uint32(),n.uint32(),n.uint32(),t=n.uint32()}return this.getBlockModelConstructorFromHeight(t).decode(e)}getBlockModelConstructorFromHeight(e){return this.getBlockModelConstructorFromBaseType(e)}getBlockModelConstructorFromBaseType(e){const t=this.blockHelper.parseTypeByHeight(e),r=Ch.KM.get(t);if(!r)throw new NA(c.INVALID_BASE_TYPE,{base_type:t});return r}getRoundLastBlockRemarkHash(...e){return Hw("@deprecated","blockHelper.getRoundLastBlockRemarkHash"),this.blockHelper.calcChainOnChainHash(...e)}};Fl=h([j("bfchain-core:BlockCore"),Oe(3,J("keypairHelper")),Oe(4,J("cryptoHelper")),Oe(5,J("Buffer")),u("design:paramtypes",[_t,$r,Rn,Object,Object,Object,et])],Fl);const Fw=(()=>{const i=new Map,e=new Map;return[[zt.GENESIS,Su],[zt.COMMON,Tu],[zt.ROUNDEND,wu]].forEach(([t,r])=>{i.set(t,r),e.set(r,t)}),{KF:i,FK:e}})(),{ConsensusException:Rr,NoFoundException:Gi}=re("VERIFIER","BlockLogicVerifier");var xu;(function(i){i[i.SYNC=1]="SYNC",i[i.REBUILD=2]="REBUILD",i[i.GENERATEBLOCK=3]="GENERATEBLOCK"})(xu||(xu={}));class fn{async verifyBlockBase(e,t,r,n=this.transactionGetterHelper,s=this.blockGetterHelper){if(this.blockHelper.verifyBlockVersion(e,this.configHelper),!n)throw new Gi(c.NOT_EXIST,{prop:"transactionGetterHelper",target:"moduleStroge"});if(!s)throw new Gi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});t!==xu.REBUILD&&await this.isBlockAlreadyExist(e.signature,e.height,s),this.checkBlockTimestamp(e),e.height!==1&&await this.checkPreviousBlock(e,s),await this.checkSecondPublicKey(e,r)}async checkSecondPublicKey(e,t){const{height:r,generatorPublicKey:n,generatorSecondPublicKey:s,signature:o,signSignature:a}=e,p=await this.accountBaseHelper.getAddressFromPublicKeyString(n);if(!t)throw new Gi(c.NOT_EXIST,{prop:`delegate with address ${p}`,target:"blockChain"});if(t.secondPublicKey){if(!(s&&a))throw new Rr(c.BLOCK_SIGN_SIGNATURE_IS_REQUIRED,{signature:o,generatorAddress:p,height:r});if(t.secondPublicKey!==s)throw new Rr(c.BLOCK_GENERATOR_SECOND_PUBLICKEY_ALREADY_CHANGE,{signature:o,generatorAddress:p,height:r})}else{if(s)throw new Rr(c.BLOCK_SHOULD_NOT_HAVE_GENERATOR_SECOND_PUBLICKEY,{signature:o,generatorAddress:p,height:r});if(a)throw new Rr(c.BLOCK_SHOULD_NOT_HAVE_SIGN_SIGNATURE,{signature:o,generatorAddress:p,height:r})}}checkBlockTimestamp(e){const{timeHelper:t}=this,r=t.getTimestamp(),n=t.getSlotNumberByTimestamp(e.timestamp),s=t.getSlotNumberByTimestamp(r);n>s&&console.debug(`Block timestamp in future. Block time is ahead of the time on the server, block timestamp ${e.timestamp}, block timestamp slot ${n}, blockChain now timestamp ${r}, blockChain now timestamp slot ${s}`)}async isBlockAlreadyExist(e,t,r=this.blockGetterHelper){if(!r)throw new Gi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});if(typeof r.getCountBlock!="function")throw new Rr(c.PROP_IS_INVALID,{prop:"getCountBlock",target:"blockGetterHelper"});if(await r.getCountBlock({signature:e})>0)throw new Rr(c.ALREADY_EXIST,{prop:`Block with signature ${e}`,target:"blockChain",errorId:`Block already exists: ${e} height: ${t}`})}async verifyBlockWithTransactions(e,t){t!==xu.GENERATEBLOCK&&await this.blockCore.getBlockFactoryFromHeight(e.height).verify(e)}async checkPreviousBlock(e,t=this.blockGetterHelper){if(!t)throw new Gi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});if(typeof t.chainBlockFork!="function")throw new Rr(c.PROP_IS_INVALID,{prop:"chainBlockFork",target:"blockGetterHelper"});const{height:r,previousBlockSignature:n,timestamp:s}=e,o=await t.getBlockByHeight(r-1);if(!o)throw new Rr(c.NOT_EXIST,{prop:`Block with height ${r-1}`,target:"blockChain"});const a=o.signature;if(n!==a)throw await t.chainBlockFork(e,Fh.DIFFERENT_PRE_BLOCK_SIGNATURE),new Rr(c.NOT_MATCH,{to_compare_prop:`previousBlockSignature: ${n}`,be_compare_prop:`__signature: ${a}`,to_target:`block ${r}`,be_target:`lastBlock ${o.height}`});const{timeHelper:p}=this,l=p.getSlotNumberByTimestamp(s),f=p.getNextSlotNumberByTimestamp(o.timestamp);if(l<f)throw new Rr(c.PROP_SHOULD_GT_FIELD,{prop:`timestamp ${s}`,target:"block",field:`lastBlock timestamp ${o.timestamp}`})}async isValidBlockSlot(e,t=this.blockGetterHelper){if(!t)throw new Gi(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const{timeHelper:r,blockGeneratorCalculator:n}=this,s=await this.accountBaseHelper.getAddressFromPublicKeyString(e.generatorPublicKey),o=r.getSlotNumberByTimestamp(e.timestamp),a=await t.getLastBlock(),p=await n.calcGenerateBlockDelegate({timestamp:a.timestamp,height:a.height},{toTimestamp:e.timestamp,blockGetterHelper:t});if(p.address!==s)throw new Rr(c.INVALID_BLOCK_GENERATOR,{reason:`lastBlock.timestamp: ${a.timestamp} lastBlock.height: ${a.height}, block.timestamp: ${e.timestamp} curTime: ${r.getTimeByTimestamp(e.timestamp)} signature${e.signature} height: ${e.height} slot${o}${p.address}${s}`});const l=e.roundOfflineGeneratersHashMap;for(const[f,g]of p.roundOfflineGeneratersReadonlyMap){if(!l[f])throw new Rr(c.NOT_MATCH,{to_compare_prop:"roundOfflineGeneratersHashMap",be_compare_prop:"roundOfflineGeneratersHashMap",to_target:"calcGenerateBlockDelegate",be_target:`block with height ${e.height}, signature ${e.signature}`});if(g.join(",")!==l[f]){const d=l[f].split(",");if(g.length!==d.length)throw new Rr(c.NOT_MATCH,{to_compare_prop:`calcRoundOfflineGeneraters.length: ${g.length}`,be_compare_prop:`blockRoundOfflineGeneraters.length: ${d.length}`,to_target:"calcGenerateBlockDelegate",be_target:`block with height ${e.height}, signature ${e.signature}`});for(const y of g)if(!d.includes(y))throw new Rr(c.NOT_EXIST,{prop:`offlineGenerater ${y}`,target:`block.roundOfflineGeneratersHashMap with height ${e.height}, signature ${e.signature}`})}}}async checkNewDelegates(e,t){if(!t)throw new Gi(c.NOT_EXIST,{prop:"transactionGetterHelper",target:"moduleStroge"});const r=this.blockHelper.calcRoundByHeight(e),n=await t.getRegisterNewDelegates(e),{delegates:s,maxDelegateTxsPerRound:o}=this.configHelper,a=n.length;if(r===1){if(a>o+s)throw new Rr(c.PROP_SHOULD_LTE_FIELD,{prop:`delegateCount ${a}`,target:"block",field:`maxDelegateTxsPerRound ${o+s}`})}else if(a>o)throw new Rr(c.PROP_SHOULD_LTE_FIELD,{prop:`delegateCount ${a}`,target:"block",field:`maxDelegateTxsPerRound ${o}`});return n}}h([J(_t),u("design:type",_t)],fn.prototype,"blockHelper",void 0);h([J(de),u("design:type",de)],fn.prototype,"accountBaseHelper",void 0);h([J(te),u("design:type",te)],fn.prototype,"configHelper",void 0);h([J(Vt),u("design:type",Vt)],fn.prototype,"timeHelper",void 0);h([J(Es),u("design:type",Es)],fn.prototype,"milestonesHelper",void 0);h([J(ke),u("design:type",ke)],fn.prototype,"chainAssetInfoHelper",void 0);h([J("bfchain-core:BlockCore"),u("design:type",Object)],fn.prototype,"blockCore",void 0);h([J(Rn),u("design:type",Rn)],fn.prototype,"blockGeneratorCalculator",void 0);h([J("transactionGetterHelper",{optional:!0,dynamics:!0}),u("design:type",Object)],fn.prototype,"transactionGetterHelper",void 0);h([J("blockGetterHelper",{optional:!0,dynamics:!0}),u("design:type",Object)],fn.prototype,"blockGetterHelper",void 0);class Vw extends fn{async verify(e,t,r,n=this.transactionGetterHelper,s=this.blockGetterHelper){return await this.verifyBlockBase(e,t,r,n,s),!0}async verifyBlockAsset(e,t=this.transactionGetterHelper,r=this.blockGetterHelper){await this.checkNewDelegates(e.height,t)}checkMaxBeginBalanceAndMaxTxCount(e,t){}}class $w extends fn{async verify(e,t,r,n=this.transactionGetterHelper,s=this.blockGetterHelper){return await this.verifyBlockBase(e,t,r,n,s),await this.checkPreviousBlock(e,s),await this.isValidBlockSlot(e,s),!0}async verifyBlockAsset(e,t=this.transactionGetterHelper,r=this.blockGetterHelper){await this.checkNewDelegates(e.height,t)}checkMaxBeginBalanceAndMaxTxCount(e,t){}}const{ConsensusException:Ns,NoFoundException:Uw}=re("VERIFIER","BlockLogicVerifier");class Kw extends fn{async verify(e,t,r,n=this.transactionGetterHelper,s=this.blockGetterHelper){return await this.verifyBlockBase(e,t,r,n,s),await this.checkPreviousBlock(e,s),await this.isValidBlockSlot(e,s),!0}async verifyBlockAsset(e,t=this.transactionGetterHelper,r=this.blockGetterHelper){const{height:n,asset:s}=e,{newDelegates:o,hash:a}=s.roundLastAsset;await this.checkChainOnChainHash(n,a,r),await this.isValidNewDelegates(n,o,t),await this.checkNewForgingDelegates(e,r)}async isValidNewDelegates(e,t,r=this.transactionGetterHelper){const n=await this.checkNewDelegates(e,r);if(t.length!==n.length)throw new Ns(c.NOT_MATCH,{to_compare_prop:`newDelegates length ${t.length}`,be_compare_prop:`newDelegates length ${n.length}`,to_target:"block",be_target:"blockChain"});for(const s of t)if(!n.includes(s))throw new Ns(c.NOT_MATCH,{to_compare_prop:`newDelegates ${JSON.stringify(n)}`,be_compare_prop:`newDelegates ${s}`,to_target:"block",be_target:"blockChain"})}async checkChainOnChainHash(e,t,r=this.blockGetterHelper){const n=await this.blockHelper.calcChainOnChainHash(e,r);if(n!==t)throw new Ns(c.NOT_MATCH,{to_compare_prop:`hashString ${n}`,be_compare_prop:`hash ${t}`,to_target:"block",be_target:"calculate"})}async checkNewForgingDelegates(e,t=this.blockGetterHelper){if(!t)throw new Uw(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});if(typeof t.getNewForgingDelegates!="function")throw new Ns(c.PROP_IS_INVALID,{prop:"getNewForgingDelegates",target:"blockGetterHelper"});const r=await t.getNewForgingDelegates(await t.getLastBlock(),e.generatorPublicKey),n=e.asset.roundLastAsset.nextRoundDelegates;if(r.length!==n.length)throw new Ns(c.NOT_MATCH,{to_compare_prop:`delegates length ${r.length}`,be_compare_prop:`delegates length ${n.length}`,to_target:"block asset",be_target:"calculate"});for(let s=0;s<r.length;s++){const o=r[s].address,a=n[s];if(a.address!==o)throw new Ns(c.NOT_MATCH,{to_compare_prop:`nextRoundDelegates index ${s} address ${a.address}`,be_compare_prop:`nextRoundDelegates index ${s} address ${o}`,to_target:"block asset",be_target:"calculate"});const p=r[s].vote.toString();if(a.equity!==p)throw new Ns(c.NOT_MATCH,{to_compare_prop:`nextRoundDelegates index ${s} address ${a.address} equity ${a.equity}`,be_compare_prop:`nextRoundDelegates index ${s} address ${o} equity ${p}`,to_target:"block asset",be_target:"calculate"})}}checkMaxBeginBalanceAndMaxTxCount(e,t){const r=e.asset.roundLastAsset;if(r.maxBeginBalance!==t.maxBeginBalance)throw new Ns(c.NOT_MATCH,{to_compare_prop:`maxBeginBalance ${r.maxBeginBalance}`,be_compare_prop:`maxBeginBalance ${t.maxBeginBalance}`,to_target:"block asset",be_target:"calculate"});if(r.maxTxCount!==t.maxTxCount)throw new Ns(c.NOT_MATCH,{to_compare_prop:`maxTxCount ${r.maxTxCount}`,be_compare_prop:`maxTxCount ${t.maxTxCount}`,to_target:"block asset",be_target:"calculate"})}}const{ArgumentFormatException:Gw}=re("Core","BlockLogicVerifierCore");let Vd=class{constructor(e,t){this.blockHelper=e,this.moduleMap=t,this._blockLogicVerifierCache=new Map}getBlockLogicVerifier(e){let t=this._blockLogicVerifierCache.get(e);return t||(t=Ot(e,this.moduleMap),this._blockLogicVerifierCache.set(e,t)),t}getBlockLogicVerifierFromHeight(e){const t=this.blockHelper.parseTypeByHeight(e);return this.getBlockLogicVerifierFromBaseType(t)}getBlockLogicVerifierFromBaseType(e){const t=zw.KLV.get(e);if(!t)throw new Gw(c.INVALID_BASE_TYPE,{base_type:e});return this.getBlockLogicVerifier(t)}};Vd=h([j("bfchain-core:BlockLogicVerifierCore"),u("design:paramtypes",[_t,et])],Vd);const zw=(()=>{const i=new Map,e=new Map;return[[zt.GENESIS,Vw],[zt.COMMON,$w],[zt.ROUNDEND,Kw]].forEach(([t,r])=>{i.set(t,r),e.set(r,t)}),{KLV:i,LVK:e}})(),{ConsensusException:jw,NoFoundException:$f}=re("TICKER","BlockLogicTicker");let Qr=class{async tickBlockBase(e,t=this.blockGetterHelper,r=this.blockTickGetterHelper){const n=await this.calcForgingAndVotingReward(e,t);await this.updateForgingAndVotingAccount(e,n,r)}async getVoteForDelegate(e,t,r=this.blockGetterHelper){if(!r)throw new $f(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});if(typeof r.getVoteForDelegate!="function")throw new jw(c.PROP_IS_INVALID,{prop:"getVoteForDelegate",target:"blockGetterHelper"});const n=await r.getVoteForDelegate(e,t),s=[],o=BigInt(0);let a=BigInt(0);for(const p of n)p.equity>o&&(a+=p.equity,s[s.length]=p);return{voters:s,totalEquity:a}}async calcForgingAndVotingReward(e,t=this.blockGetterHelper){if(!t)throw new $f(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const{accountBaseHelper:r}=this,{height:n}=e,s=await r.getAddressFromPublicKeyString(e.generatorPublicKey),{totalEquity:o,voters:a}=await this.getVoteForDelegate(s,n,t);return await this.blockHelper.calcForgingAndVotingReward(e,a,o)}async updateForgingAndVotingAccount(e,t,r=this.blockTickGetterHelper){if(!r)throw new $f(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});const{voters:n,totalEquity:s}=t;if(e.height!==1&&s>BigInt(0)){const o=BigInt(t.vrewards),{voteRewardList:a,vrewardsRemaining:p}=this.blockHelper.calcBlockVotesRewards(n,s,o);t.reward=t.reward+p,await r.updateVotingAccount(e,a)}await r.updateForgingAccount(e,t.reward)}};h([J(_t),u("design:type",_t)],Qr.prototype,"blockHelper",void 0);h([J(te),u("design:type",te)],Qr.prototype,"configHelper",void 0);h([J(Vt),u("design:type",Vt)],Qr.prototype,"timeHelper",void 0);h([J(de),u("design:type",de)],Qr.prototype,"accountBaseHelper",void 0);h([J(It),u("design:type",It)],Qr.prototype,"jsbiHelper",void 0);h([J(Rn),u("design:type",Rn)],Qr.prototype,"blockGeneratorCalculator",void 0);h([J("accountGetterHelper",{optional:!0,dynamics:!0}),u("design:type",Object)],Qr.prototype,"accountGetterHelper",void 0);h([J("blockGetterHelper",{optional:!0,dynamics:!0}),u("design:type",Object)],Qr.prototype,"blockGetterHelper",void 0);h([J("blockTickGetterHelper",{optional:!0,dynamics:!0}),u("design:type",Object)],Qr.prototype,"blockTickGetterHelper",void 0);Qr=h([j()],Qr);re("CONTROLLER","BlockLogicVerifier");let $d=class extends Qr{async tick(e,t=this.blockGetterHelper,r=this.blockTickGetterHelper){return await this.tickBlockBase(e,t,r),{}}};$d=h([j()],$d);let Ud=class extends Qr{async tick(e,t=this.blockGetterHelper,r=this.blockTickGetterHelper){return await this.tickBlockBase(e,t,r),{}}};Ud=h([j()],Ud);const{ConsensusException:Jw,NoFoundException:Ec}=re("TICKER","BlockLogicTicker");let Kd=class extends Qr{async tick(e,t=this.blockGetterHelper,r=this.blockTickGetterHelper,n){await this.tickBlockBase(e,t,r);const s=this.blockHelper.calcRoundByHeight(e.height);return await this.roundEnd(e,s,n,t,r)}async roundEnd(e,t,r,n=this.blockGetterHelper,s=this.blockTickGetterHelper){const o=await this.saveDelegatesVoteAndTotalVote(e.height,n,r);await this.saveVotingAccountEquity(e.height,s),await this.saveVotingAccountLastInfoAndEquity(e.height,s);const a=await this.getMaxBeginBalanceAndMaxTxCountAndRate(t,s);return{equities:o,...a}}async saveDelegatesVoteAndTotalVote(e,t=this.blockGetterHelper,r){if(!r)throw new Ec(c.NOT_EXIST,{prop:"accountGetterHelper",target:"moduleStroge"});if(!t)throw new Ec(c.NOT_EXIST,{prop:"blockGetterHelper",target:"moduleStroge"});if(typeof t.getVoteRecords!="function")throw new Jw(c.PROP_IS_INVALID,{prop:"getVoteForDelegate",target:"blockGetterHelper"});const n={},s=await t.getVoteRecords();let o=BigInt(0);for(const a in s){const p=s[a];for(const l in p)n[l]||(n[l]=BigInt(0)),n[l]+=p[l],o+=n[l]}return await r.mergeAccountEquity(e,n),o}async saveVotingAccountEquity(e,t=this.blockTickGetterHelper){if(!t)throw new Ec(c.NOT_EXIST,{prop:"blockTickGetterHelper",target:"moduleStroge"});await t.saveVotingAccountEquity(e)}async saveVotingAccountLastInfoAndEquity(e,t=this.blockTickGetterHelper){if(!t)throw new Ec(c.NOT_EXIST,{prop:"blockTickGetterHelper",target:"moduleStroge"});await t.saveVotingAccountLastInfoAndEquity(e)}async getMaxBeginBalanceAndMaxTxCountAndRate(e,t=this.blockTickGetterHelper){if(!t)throw new Ec(c.NOT_EXIST,{prop:"blockTickGetterHelper",target:"moduleStroge"});return await t.getMaxBeginBalanceAndMaxTxCountAndRate(e)}};Kd=h([j()],Kd);const{ArgumentFormatException:Yw,log:dB,warn:yB}=re("Core","BlockTicker");let Gd=class{constructor(e,t){this.blockHelper=e,this.moduleMap=t,this._blockTickerCache=new Map}getBlockTicker(e){let t=this._blockTickerCache.get(e);return t||(t=Ot(e,this.moduleMap),this._blockTickerCache.set(e,t)),t}getBlockTickerFromHeight(e){const t=this.blockHelper.parseTypeByHeight(e);return this.getBlockTickerFromBaseType(t)}getBlockTickerFromBaseType(e){const t=Qw.KT.get(e);if(!t)throw new Yw(c.INVALID_BASE_TYPE,{base_type:e});return this.getBlockTicker(t)}};Gd=h([j("bfchain-core:BlockTickerCore"),u("design:paramtypes",[_t,et])],Gd);const Qw=(()=>{const i=new Map,e=new Map;return[[zt.GENESIS,$d],[zt.COMMON,Ud],[zt.ROUNDEND,Kd]].forEach(([t,r])=>{i.set(t,r),e.set(r,t)}),{KT:i,TK:e}})(),{ArgumentIllegalException:Ge}=re("CONTROLLER","CustomTransactionEvent");let Ou=class{constructor(e,t,r,n,s,o,a){this.accountBaseHelper=e,this.baseHelper=t,this.configHelper=r,this.transactionHelper=n,this.chainAssetInfoHelper=s,this.registerChainCertificateHelper=o,this.configMap=a}async verifyAddress(e){const t={target:"applyResult"};if(!await this.accountBaseHelper.isAddress(e))throw new Ge(c.PROP_IS_INVALID,{prop:"address",...t})}verifyPublicKey(e){if(!this.baseHelper.isValidPublicKey(e))throw new Ge(c.PROP_IS_INVALID,{prop:"publicKey",target:"applyResult"})}async verifyFrozenAddress(e){if(!await this.accountBaseHelper.isAddress(e))throw new Ge(c.PROP_IS_INVALID,{prop:"frozenAddress",target:"applyResult"})}async verifyRecipientId(e){if(!await this.accountBaseHelper.isAddress(e))throw new Ge(c.PROP_IS_INVALID,{prop:"recipientId",target:"applyResult"})}async verifyPossessorAddress(e){if(!await this.accountBaseHelper.isAddress(e))throw new Ge(c.PROP_IS_INVALID,{prop:"possessorAddress",target:"applyResult"})}verifyAssetNumber(e){if(!this.baseHelper.isValidAssetNumber(e))throw new Ge(c.PROP_IS_INVALID,{prop:"amount",target:"applyResult"})}verifyMagic(e){if(!this.baseHelper.isValidChainMagic(e))throw new Ge(c.PROP_IS_INVALID,{prop:"magic",target:"applyResult"})}verifyAssetType(e){if(!this.baseHelper.isValidAssetType(e))throw new Ge(c.PROP_IS_INVALID,{prop:"assetType",target:"applyResult"})}verifyChainName(e){if(!this.baseHelper.isValidChainName(e))throw new Ge(c.PROP_IS_INVALID,{prop:"chainName",target:"applyResult"})}verifyDAppid(e){if(!this.baseHelper.isValidDAppId(e))throw new Ge(c.PROP_IS_INVALID,{prop:"dappid",target:"applyResult"})}verifyMinAndMaxEffectiveHeight(e,t,r){const{transactionHelper:n}=this,s=n.getTransactionMinEffectiveHeight(r);if(e!==s)throw new Ge(c.PROP_IS_INVALID,{prop:"minEffectiveHeight",target:"applyResult"});const o=n.getTransactionMaxEffectiveHeight(r);if(t!==o)throw new Ge(c.PROP_IS_INVALID,{prop:"maxEffectiveHeight",target:"applyResult"})}verifyLocationName(e){if(!this.baseHelper.isValidLocationName(e))throw new Ge(c.PROP_IS_INVALID,{prop:"locationName",target:"applyResult"})}async verifyApplyResult(e,t){const{baseHelper:r,accountBaseHelper:n,transactionHelper:s}=this,o={target:"applyResult"},{address:a,publicKey:p}=e.applyInfo;if(await this.verifyAddress(a),p&&this.verifyPublicKey(p),e.type==="setSecondPublicKey"){const{secondPublicKey:l}=e.applyInfo;if(!r.isValidSecondPublicKey(l))throw new Ge(c.PROP_IS_INVALID,{prop:"secondPublicKey",...o});return}if(e.type==="setUsername"){const l=e.applyInfo;if(!r.isValidUsername(l.alias))throw new Ge(c.PROP_IS_INVALID,{prop:"alias",...o});return}if(!(e.type==="registerToDelegate"||e.type==="acceptVote"||e.type==="rejectVote")){if(e.type==="voteEquity"){const{equity:l,recipientId:f}=e.applyInfo;if(!r.isValidAccountEquity(l))throw new Ge(c.PROP_IS_INVALID,{prop:"voteEquity",...o});await this.verifyRecipientId(f);return}if(e.type==="asset"){const{magic:l,assetType:f,amount:g,action:d}=e.applyInfo;if(this.verifyAssetNumber(g),this.verifyMagic(l),this.verifyAssetType(f),!(d==="+"||d==="-"))throw new Ge(c.PROP_IS_INVALID,{prop:"action",...o});return}if(e.type==="destroyAsset"){const{magic:l,assetType:f,amount:g}=e.applyInfo;this.verifyAssetNumber(g),this.verifyMagic(l),this.verifyAssetType(f);return}if(e.type==="frozenAsset"){const{magic:l,assetType:f,amount:g,minEffectiveHeight:d,maxEffectiveHeight:y}=e.applyInfo;this.verifyAssetNumber(g),this.verifyMagic(l),this.verifyAssetType(f),this.verifyMinAndMaxEffectiveHeight(d,y,t);return}if(e.type==="unfrozenAsset"){const{magic:l,assetType:f,amount:g,frozenId:d,recipientId:y}=e.applyInfo;if(this.verifyAssetNumber(g),this.verifyMagic(l),this.verifyAssetType(f),await this.verifyRecipientId(y),!(t.storage&&t.storage.key==="transactionSignature"&&t.storage.value===d))throw new Ge(c.PROP_IS_INVALID,{prop:"frozenId",...o});return}if(e.type==="signForAsset"){const{frozenId:l,frozenAddress:f,recipientId:g}=e.applyInfo;if(await this.verifyFrozenAddress(f),await this.verifyRecipientId(g),!(t.storage&&t.storage.key==="transactionSignature"&&t.storage.value===l))throw new Ge(c.PROP_IS_INVALID,{prop:"frozenId",...o});return}if(e.type==="frozenAccount"){const{accountStatus:l}=e.applyInfo;if(l!==0&&l!==1&&l!==16&&l!==17)throw new Ge(c.PROP_IS_INVALID,{prop:"accountStatus",...o});return}if(e.type==="issueDApp"){const{sourceChainName:l,sourceChainMagic:f,dappid:g,possessorAddress:d,type:y,purchaseAsset:m}=e.applyInfo;if(this.verifyMagic(f),this.verifyChainName(l),await this.verifyPossessorAddress(d),this.verifyDAppid(g),y!==1&&y!==0)throw new Ge(c.PROP_IS_INVALID,{prop:"type",...o});m&&this.verifyAssetNumber(m);return}if(e.type==="frozenDApp"){const{dappid:l,sourceChainMagic:f,minEffectiveHeight:g,maxEffectiveHeight:d}=e.applyInfo;this.verifyDAppid(l),this.verifyMagic(f),this.verifyMinAndMaxEffectiveHeight(g,d,t);return}if(e.type==="unfrozenDApp"){const{dappid:l,possessorAddress:f,sourceChainMagic:g}=e.applyInfo;this.verifyDAppid(l),this.verifyMagic(g),await this.verifyPossessorAddress(f);return}if(e.type==="issueAsset"){const{applyAddress:l,sourceChainName:f,sourceChainMagic:g,assetType:d,genesisAddress:y,expectedIssuedAssets:m,remainAssets:E}=e.applyInfo;if(this.verifyMagic(g),this.verifyChainName(f),this.verifyAssetType(d),!await n.isAddress(l))throw new Ge(c.PROP_IS_INVALID,{prop:"applyAddress",...o});if(!await n.isAddress(y))throw new Ge(c.PROP_IS_INVALID,{prop:"genesisAddress",...o});if(!r.isValidAssetNumber(m))throw new Ge(c.PROP_IS_INVALID,{prop:"expectedIssuedAssets",...o});if(!r.isValidAssetNumber(E))throw new Ge(c.PROP_IS_INVALID,{prop:"remainAssets",...o});return}if(e.type==="registerChain"){const l=this.configHelper,f=e.applyInfo.genesisBlock;if(!this.baseHelper.isString(f))throw new Ge(c.PROP_IS_INVALID,{prop:"genesisBlock",...o});const g=this.registerChainCertificateHelper.decode(f);await this.registerChainCertificateHelper.verifyRegisterChainCertificate(g);const{bnid:d,magic:y,assetType:m,chainName:E}=g.body.genesisBlockInfo;if(y===l.magic)throw new Ge(c.SHOULD_NOT_BE,{to_compare_prop:`magic ${y}`,to_target:"register genesisBlock",be_compare_prop:l.magic,...o});if(m===l.assetType)throw new Ge(c.SHOULD_NOT_BE,{to_compare_prop:`assetType ${m}`,to_target:"register genesisBlock",be_compare_prop:l.assetType,...o});if(E===l.chainName)throw new Ge(c.SHOULD_NOT_BE,{to_compare_prop:`chainName ${E}`,to_target:"register genesisBlock",be_compare_prop:l.chainName,...o});if(l.initials!==d)throw new Ge(c.NOT_MATCH,{to_compare_prop:`initials ${l.initials}`,be_compare_prop:`bnid ${d}`,to_target:"config",be_target:"register genesisBlock",...o})}if(e.type==="registerLocationName"){const{sourceChainName:l,sourceChainMagic:f,name:g,possessorAddress:d}=e.applyInfo;this.verifyMagic(f),this.verifyChainName(l),await this.verifyPossessorAddress(d),this.verifyLocationName(g);return}if(e.type==="cancelLocationName"){const{address:l,sourceChainMagic:f,name:g}=e.applyInfo;this.verifyMagic(f),this.verifyLocationName(g);return}if(e.type==="setLnsRecordValue"){const{name:l,sourceChainMagic:f,operationType:g,addRecord:d,deleteRecord:y}=e.applyInfo;if(this.verifyLocationName(l),this.verifyMagic(f),g===0){if(!d)throw new Ge(c.PROP_IS_REQUIRE,{prop:"addRecord",...o});if(y)throw new Ge(c.SHOULD_NOT_EXIST,{prop:"deleteRecord",...o});if(!await r.isValidLocationNameRecord(d))throw new Ge(c.PROP_IS_INVALID,{prop:`addRecord ${JSON.stringify(d)}`,...o})}else if(g===1){if(d)throw new Ge(c.SHOULD_NOT_EXIST,{prop:"addRecord",...o});if(!y)throw new Ge(c.PROP_IS_REQUIRE,{prop:"deleteRecord",...o});if(!await r.isValidLocationNameRecord(y))throw new Ge(c.PROP_IS_INVALID,{prop:`deleteRecord ${JSON.stringify(y)}`,...o})}else if(g===2){if(!d)throw new Ge(c.PROP_IS_REQUIRE,{prop:"addRecord",...o});if(!y)throw new Ge(c.PROP_IS_REQUIRE,{prop:"deleteRecord",...o});if(!await r.isValidLocationNameRecord(d))throw new Ge(c.PROP_IS_INVALID,{prop:`addRecord ${JSON.stringify(d)}`,...o});if(!await r.isValidLocationNameRecord(y))throw new Ge(c.PROP_IS_INVALID,{prop:`deleteRecord ${JSON.stringify(y)}`,...o})}else throw new Ge(c.PROP_IS_INVALID,{prop:"operationType",...o});return}if(e.type==="frozenLocationName"){const{name:l,sourceChainMagic:f,minEffectiveHeight:g,maxEffectiveHeight:d}=e.applyInfo;this.verifyLocationName(l),this.verifyMagic(f),this.verifyMinAndMaxEffectiveHeight(g,d,t);return}if(e.type==="unfrozenLocationName"){const{possessorAddress:l,name:f,sourceChainMagic:g}=e.applyInfo;await this.verifyPossessorAddress(l),this.verifyLocationName(f),this.verifyMagic(g);return}throw new Ge(c.PROP_IS_INVALID,{prop:"type",...o})}}combineApplyEvent(e,t,r){if(r.type==="setUsername"){const{address:n,publicKey:s,alias:o}=r.applyInfo;return t.emit("setUsername",{type:"setUsername",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),alias:o}})}if(r.type==="setSecondPublicKey"){const{address:n,publicKey:s,secondPublicKey:o}=r.applyInfo;return t.emit("setSecondPublicKey",{type:"setSecondPublicKey",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),secondPublicKeyBuffer:he(o)}})}if(r.type==="registerToDelegate"){const{address:n,publicKey:s}=r.applyInfo;return t.emit("registerToDelegate",{type:"registerToDelegate",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s)}})}if(r.type==="acceptVote"){const{address:n,publicKey:s}=r.applyInfo;return t.emit("acceptVote",{type:"acceptVote",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s)}})}if(r.type==="rejectVote"){const{address:n,publicKey:s}=r.applyInfo;return t.emit("rejectVote",{type:"rejectVote",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s)}})}if(r.type==="voteEquity"){const{address:n,publicKey:s,equity:o,recipientId:a}=r.applyInfo;return t.emit("voteEquity",{type:"voteEquity",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),equity:"-"+o,sourceEquity:o,recipientId:a}})}if(r.type==="asset"){const{address:n,publicKey:s,magic:o,assetType:a,amount:p,action:l}=r.applyInfo,f=this.chainAssetInfoHelper.getAssetInfo(o,a);return t.emit("asset",{type:"asset",transaction:e,applyInfo:{address:n,publicKeyBuffer:s?he(s):void 0,assetInfo:f,amount:l==="-"?"-"+p:p,sourceAmount:p}})}if(r.type==="destroyAsset"){const{address:n,publicKey:s,magic:o,assetType:a,amount:p,assetsApplyAddress:l}=r.applyInfo,f=this.chainAssetInfoHelper.getAssetInfo(o,a);return t.emit("destroyAsset",{type:"destroyAsset",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),assetsApplyAddress:l,assetInfo:f,amount:p,sourceAmount:p}})}if(r.type==="frozenAsset"){const{address:n,publicKey:s,magic:o,assetType:a,amount:p,minEffectiveHeight:l,maxEffectiveHeight:f,totalUnfrozenTimes:g}=r.applyInfo,d=this.chainAssetInfoHelper.getAssetInfo(o,a);return t.emit("frozenAsset",{type:"frozenAsset",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),assetInfo:d,amount:`-${p}`,sourceAmount:p,frozenId:e.signature,minEffectiveHeight:l,maxEffectiveHeight:f,totalUnfrozenTimes:g}})}if(r.type==="unfrozenAsset"){const{address:n,publicKey:s,magic:o,assetType:a,amount:p,frozenId:l,recipientId:f}=r.applyInfo,g=this.chainAssetInfoHelper.getAssetInfo(o,a);return t.emit("unfrozenAsset",{type:"unfrozenAsset",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),assetInfo:g,amount:p,sourceAmount:p,frozenId:l,recipientId:f}})}if(r.type==="signForAsset"){const{address:n,publicKey:s,frozenId:o,frozenAddress:a,recipientId:p,assetInfo:l}=r.applyInfo;return t.emit("signForAsset",{type:"signForAsset",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),frozenId:o,frozenAddress:a,recipientId:p,assetInfo:l}})}if(r.type==="frozenAccount"){const{address:n,publicKey:s,accountStatus:o}=r.applyInfo;return t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),accountStatus:o}})}if(r.type==="issueDApp"){const{address:n,publicKey:s,sourceChainName:o,sourceChainMagic:a,dappid:p,type:l,purchaseAsset:f,possessorAddress:g}=r.applyInfo;return t.emit("issueDApp",{type:"issueDApp",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),sourceChainName:o,sourceChainMagic:a,dappid:p,possessorAddress:g,type:l,purchaseAsset:f,status:0}})}if(r.type==="frozenDApp"){const{address:n,dappid:s,sourceChainMagic:o,sourceChainName:a,minEffectiveHeight:p,maxEffectiveHeight:l,frozenId:f}=r.applyInfo;return t.emit("frozenDApp",{type:"frozenDApp",transaction:e,applyInfo:{address:n,sourceChainName:a,sourceChainMagic:o,dappid:s,minEffectiveHeight:p,maxEffectiveHeight:l,status:17,frozenId:f}})}if(r.type==="unfrozenDApp"){const{address:n,publicKey:s,dappid:o,sourceChainMagic:a,sourceChainName:p,possessorAddress:l,frozenId:f}=r.applyInfo;return t.emit("unfrozenDApp",{type:"unfrozenDApp",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),sourceChainName:p,sourceChainMagic:a,dappid:o,possessorAddress:l,status:0,frozenId:f}})}if(r.type==="issueAsset"){const{address:n,publicKey:s,sourceChainName:o,sourceChainMagic:a,assetType:p,genesisAddress:l,expectedIssuedAssets:f}=r.applyInfo,g=this.chainAssetInfoHelper.getAssetInfo(a,p);return t.emit("issueAsset",{type:"issueAsset",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),sourceChainName:o,genesisAddress:l,assetInfo:g,amount:f,sourceAmount:f}})}if(r.type==="registerChain"){const{address:n,publicKey:s,genesisBlock:o}=r.applyInfo,a=this.registerChainCertificateHelper.decode(o);return t.emit("registerChain",{type:"registerChain",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),genesisBlock:a.body.genesisBlockInfo}})}if(r.type==="registerLocationName"){const{address:n,publicKey:s,name:o,sourceChainMagic:a,sourceChainName:p,possessorAddress:l}=r.applyInfo;return t.emit("registerLocationName",{type:"registerLocationName",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),name:o,sourceChainMagic:a,sourceChainName:p,possessorAddress:l,status:0}})}if(r.type==="cancelLocationName"){const{address:n,publicKey:s,name:o,sourceChainMagic:a,sourceChainName:p}=r.applyInfo;return t.emit("cancelLocationName",{type:"cancelLocationName",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),sourceChainName:p,sourceChainMagic:a,name:o,status:255}})}if(r.type==="setLnsManager"){const{address:n,publicKey:s,name:o,sourceChainMagic:a,sourceChainName:p,manager:l}=r.applyInfo;return t.emit("setLnsManager",{type:"setLnsManager",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),sourceChainName:p,sourceChainMagic:a,name:o,manager:l}})}if(r.type==="setLnsRecordValue"){const{address:n,publicKey:s,name:o,sourceChainMagic:a,sourceChainName:p,operationType:l,addRecord:f,deleteRecord:g}=r.applyInfo;return t.emit("setLnsRecordValue",{type:"setLnsRecordValue",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),sourceChainName:p,sourceChainMagic:a,name:o,operationType:l,addRecord:f,deleteRecord:g}})}if(r.type==="frozenLocationName"){const{address:n,name:s,sourceChainMagic:o,sourceChainName:a,minEffectiveHeight:p,maxEffectiveHeight:l,frozenId:f}=r.applyInfo;return t.emit("frozenLocationName",{type:"frozenLocationName",transaction:e,applyInfo:{address:n,sourceChainName:a,sourceChainMagic:o,name:s,minEffectiveHeight:p,maxEffectiveHeight:l,status:17,frozenId:f}})}if(r.type==="unfrozenLocationName"){const{address:n,publicKey:s,name:o,sourceChainMagic:a,sourceChainName:p,possessorAddress:l,frozenId:f}=r.applyInfo;return t.emit("unfrozenLocationName",{type:"unfrozenLocationName",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),sourceChainName:p,sourceChainMagic:a,name:o,possessorAddress:l,status:0,frozenId:f}})}if(r.type==="frozenEntity"){const{address:n,entityId:s,sourceChainMagic:o,sourceChainName:a,minEffectiveHeight:p,maxEffectiveHeight:l,frozenId:f}=r.applyInfo;return t.emit("frozenEntity",{type:"frozenEntity",transaction:e,applyInfo:{address:n,sourceChainName:a,sourceChainMagic:o,entityId:s,minEffectiveHeight:p,maxEffectiveHeight:l,status:17,frozenId:f}})}if(r.type==="unfrozenEntity"){const{address:n,publicKey:s,entityId:o,sourceChainMagic:a,sourceChainName:p,possessorAddress:l,frozenId:f}=r.applyInfo;return t.emit("unfrozenEntity",{type:"unfrozenEntity",transaction:e,applyInfo:{address:n,publicKeyBuffer:he(s),sourceChainName:p,sourceChainMagic:a,entityId:o,possessorAddress:l,status:0,frozenId:f}})}throw new Ge(c.PROP_IS_INVALID,{prop:"eventType",target:"applyResult"})}};h([J("bfchain-core:BlockCore"),u("design:type",Object)],Ou.prototype,"_blockCore",void 0);Ou=h([j(),u("design:paramtypes",[de,Pe,te,me,ke,Bl,Tr])],Ou);const{ArgumentIllegalException:xA}=re("CONTROLLER","CustomTransactionFactory");let Vl=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.customTransactionEvent=o}async verifyTransactionBody(e,t,r=this.configHelper){if(await super.verifyTransactionBody(e,t,r),!t.custom)throw new xA(c.PARAM_LOST,{param:"custom"});if(this.customTransactionCenter){const s=await this.customTransactionCenter.verify(e,t);if(!s.ret)throw new xA(c.CUSTOM_TRANS_VERIFY_FAIL,{message:s.message})}}init(e,t){return Ia.fromObject({...e,asset:t})}async applyTransaction(e,t){const r=new Lm;if(r.next=super.applyTransaction(e,t),this.customTransactionCenter){const n=await this.customTransactionCenter.apply(e);for(const s of n)await this.customTransactionEvent.verifyApplyResult(s,e),r.next=this.customTransactionEvent.combineApplyEvent(e,t,s)}return r.toPromise()}};h([J("customTransactionCenter"),u("design:type",Object)],Vl.prototype,"customTransactionCenter",void 0);Vl=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,Ou])],Vl);const{ArgumentIllegalException:An}=re("CONTROLLER","RegisterChainTransactionFactory");let $l=class extends Ke{constructor(e,t,r,n,s,o,a){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.registerChainCertificateHelper=o,this.configMap=a}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new An(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new An(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"chain magic",...n});if(e.toMagic!==r.magic)throw new An(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"chain magic",...n});if(!e.storage)throw new An(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="magic")throw new An(c.SHOULD_BE,{to_compare_prop:`key ${s.key}`,to_target:"storage",be_compare_prop:"magic",...n});const o=t.registerChain;if(!o)throw new An(c.PARAM_LOST,{param:"registerChain"});const a={...n,target:"registerChainAsset"},p=o.genesisBlock;if(!p)throw new An(c.PROP_IS_REQUIRE,{prop:"genesisBlock",...a});if(!this.baseHelper.isString(p))throw new An(c.PROP_IS_INVALID,{prop:"genesisBlock",...a});const l=this.registerChainCertificateHelper.decode(p);await this.registerChainCertificateHelper.verifyRegisterChainCertificate(l);const{bnid:f,magic:g,assetType:d,chainName:y}=l.body.genesisBlockInfo;if(g===r.magic)throw new An(c.SHOULD_NOT_BE,{to_compare_prop:`magic ${g}`,to_target:"genesisBlockJson.asset.genesisAsset",be_compare_prop:r.magic,...a});if(d===r.assetType)throw new An(c.SHOULD_NOT_BE,{to_compare_prop:`assetType ${d}`,to_target:"genesisBlockJson.asset.genesisAsset",be_compare_prop:r.assetType,...a});if(y===r.chainName)throw new An(c.SHOULD_NOT_BE,{to_compare_prop:`chainName ${y}`,to_target:"genesisBlockJson.asset.genesisAsset",be_compare_prop:r.chainName,...a});if(r.initials!==f)throw new An(c.NOT_MATCH,{to_compare_prop:`initials ${r.initials}`,be_compare_prop:`bnid ${f}`,to_target:"config",be_target:"genesisBlockJson.asset.genesisBlock",...n})}init(e,t){return Ta.fromObject({...e,asset:t})}async applyTransaction(e,t,r=this.configHelper){const n=new Lm;n.next=super.applyTransaction(e,t,r);const{senderId:s,senderPublicKeyBuffer:o}=e,a=e.asset.registerChain.genesisBlock,p=this.registerChainCertificateHelper.decode(a);return n.next=t.emit("frozenAccount",{type:"frozenAccount",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,accountStatus:16}}),n.next=t.emit("registerChain",{type:"registerChain",transaction:e,applyInfo:{address:s,publicKeyBuffer:o,genesisBlock:p.body.genesisBlockInfo}}),n.toPromise()}};h([J("bfchain-core:BlockCore"),u("design:type",Object)],$l.prototype,"_blockCore",void 0);$l=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,Bl,Tr])],$l);const{ArgumentIllegalException:ai}=re("CONTROLLER","MultipleTransactionFactory");let Ul=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new ai(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new ai(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new ai(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new ai(c.SHOULD_NOT_EXIST,{prop:"storage",...n});const s=t.multiple;if(!s)throw new ai(c.PARAM_LOST,{param:"multiple"});const o={...n,target:"multiple"},{transactions:a}=s;if(!a)throw new ai(c.PROP_IS_REQUIRE,{prop:"transactions",...o});if(a.length===0)throw new ai(c.PROP_LENGTH_SHOULD_GT_FIELD,{prop:"transactions",field:0,...o});const p=new Set;for(const l of a){const{signature:f}=l;if(p.has(f))throw new ai(c.SHOULD_NOT_DUPLICATE,{prop:`transactions ${f}`,...o});p.add(f);const g=this.transactionCore.getTransactionFactoryFromType(l.type),d=await g.fromJSON(l);await g.verify(d)}}init(e,t){return wa.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{transactions:s}=e.asset.multiple;for(const o of s){const a=this.transactionCore.getTransactionFactoryFromType(o.type);n.next=a.applyTransaction(o,t,r)}})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};h([J("bfchain-core:TransactionCore",{dynamics:!0}),u("design:type",qn)],Ul.prototype,"transactionCore",void 0);Ul=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Ul);const{ArgumentIllegalException:jo}=re("CONTROLLER","PromiseTransactionFactory");let Kl=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new jo(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new jo(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new jo(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new jo(c.SHOULD_NOT_EXIST,{prop:"storage",...n});const s=t.promise;if(!s)throw new jo(c.PARAM_LOST,{param:"promise"});const o={...n,target:"promise"},{transaction:a}=s;if(!a)throw new jo(c.PROP_IS_REQUIRE,{prop:"transaction",...o});const p=this.transactionCore.getTransactionFactoryFromType(a.type),l=await p.fromJSON(a);await p.verify(l)}init(e,t){return Na.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r)})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};h([J("bfchain-core:TransactionCore",{dynamics:!0}),u("design:type",qn)],Kl.prototype,"transactionCore",void 0);Kl=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Kl);const{ArgumentIllegalException:xs}=re("CONTROLLER","PromiseResolveTransactionFactory");let Cu=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),!e.recipientId)throw new xs(c.PROP_IS_REQUIRE,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new xs(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new xs(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new xs(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="promiseId")throw new xs(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"promiseId",...n});const o=t.resolve;if(!o)throw new xs(c.PARAM_LOST,{param:"resolve"});const a={...n,target:"resolve"},{promiseId:p}=o;if(!p)throw new xs(c.PROP_IS_REQUIRE,{prop:"promiseId",...a});if(this.baseHelper.isValidSignature(p)===!1)throw new xs(c.PROP_IS_INVALID,{prop:`promiseId ${p}`,...a});if(s.value!==p)throw new xs(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`promiseId ${p}`,to_target:"storage",be_target:"resolve",...n})}init(e,t){return Oa.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r),n.next=t.emit("promiseResolve",{type:"promiseResolve",transaction:e,applyInfo:{promiseId:e.asset.resolve.promiseId,recipientId:e.recipientId}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};Cu=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Cu);const{ArgumentIllegalException:Dt}=re("CONTROLLER","MacrotionFactory");let Gl=class extends Ke{constructor(e,t,r,n,s){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new Dt(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new Dt(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new Dt(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.storage)throw new Dt(c.SHOULD_NOT_EXIST,{prop:"storage",...n});const s=t.macro;if(!s)throw new Dt(c.PARAM_LOST,{param:"macro"});const o={...n,target:"macro"},{inputs:a,template:p}=s;if(!a)throw new Dt(c.PROP_IS_REQUIRE,{prop:"inputs",...o});if(!p)throw new Dt(c.PROP_IS_REQUIRE,{prop:"template",...o});const l=this.transactionCore.getTransactionFactoryFromType(p.type),f=await l.fromJSON(p);await l.verify(f);const g=this.baseHelper,d=new Set,y=new Set;for(const m of a){const{type:E,name:T,keyPath:w}=m;if(!T)throw new Dt(c.PROP_IS_REQUIRE,{prop:"name",target:`macro.inputs.input ${JSON.stringify(m)}`});if(d.has(T))throw new Dt(c.SHOULD_NOT_DUPLICATE,{prop:`name ${T}`,target:`macro.inputs.input ${JSON.stringify(m)}`});if(d.add(T),!w)throw new Dt(c.PROP_IS_REQUIRE,{prop:"keyPath",target:`macro.inputs.input ${JSON.stringify(m)}`});if(y.has(w))throw new Dt(c.SHOULD_NOT_DUPLICATE,{prop:`keyPath ${w}`,target:`macro.inputs.input ${JSON.stringify(m)}`});if(y.add(w),!E)throw new Dt(c.PROP_IS_REQUIRE,{prop:"type",target:`macro.inputs.input ${JSON.stringify(m)}`});if(w.includes(".")){let b=p;const C=w.split("."),N=C.pop();for(const O of C){if(b.hasOwnProperty(O)===!1)throw new Dt(c.NOT_EXIST,{prop:`keyPath ${w}`,target:"macro.template"});b=b[O]}if(b.hasOwnProperty(N)===!1)throw new Dt(c.NOT_EXIST,{prop:`keyPath ${w}`,target:"macro.template"})}else if(p.hasOwnProperty(w)===!1)throw new Dt(c.NOT_EXIST,{prop:`keyPath ${w}`,target:"macro.template"});if(E===pr.NUMBER||E===pr.CALC){const{min:b,max:C,step:N,format:O}=m;if(O===void 0)throw new Dt(c.PROP_IS_REQUIRE,{prop:"format",target:`macro.inputs.input ${JSON.stringify(m)}`});if(O!==Ca.LITERAL&&O!==Ca.STRING)throw new Dt(c.PROP_IS_INVALID,{prop:`format ${O}`,target:`macro.inputs.input ${JSON.stringify(m)}`});if(b&&g.isPositiveBigFloatNotContainZero(b)===!1)throw new Dt(c.PROP_IS_INVALID,{prop:"min",target:`macro.inputs.input ${JSON.stringify(m)}`});if(C&&g.isPositiveBigFloatNotContainZero(C)===!1)throw new Dt(c.PROP_IS_INVALID,{prop:"max",target:`macro.inputs.input ${JSON.stringify(m)}`});if(N&&g.isPositiveBigFloatNotContainZero(N)===!1)throw new Dt(c.PROP_IS_INVALID,{prop:"step",target:`macro.inputs.input ${JSON.stringify(m)}`});if(E===pr.CALC){const{calc:R}=m;if(R===void 0)throw new Dt(c.PROP_IS_REQUIRE,{prop:"calc",target:`macro.inputs.input ${JSON.stringify(m)}`})}}else if(!(E===pr.TEXT||E===pr.ADDRESS||E===pr.SIGNATURE))throw new Dt(c.PROP_IS_INVALID,{prop:`type ${E}`,target:`macro.inputs.input ${JSON.stringify(m)}`})}}init(e,t){return Ra.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r)})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};h([J("bfchain-core:TransactionCore",{dynamics:!0}),u("design:type",qn)],Gl.prototype,"transactionCore",void 0);Gl=h([j(),u("design:paramtypes",[de,me,Pe,te,ke])],Gl);const{ArgumentIllegalException:_r}=re("CONTROLLER","MacroCallTransactionFactory");let zl=class extends Ke{constructor(e,t,r,n,s,o){super(),this.accountBaseHelper=e,this.transactionHelper=t,this.baseHelper=r,this.configHelper=n,this.chainAssetInfoHelper=s,this.jsbiHelper=o}async generateTransaction(e,t,r){const n=e.toJSON();for(const o of t){const{name:a,pattern:p}=o;let l=r[a];if(typeof l!="string")throw new _r(c.PROP_IS_INVALID,{prop:`${o.name} ${l}`,target:"inputs"});if(p&&new RegExp(p).test(l)===!1)throw new _r(c.NOT_MATCH,{to_compare_prop:`${a} ${l}`,to_target:"inputs",be_compare_prop:`pattern ${p}`,be_target:"defineInput"});switch(o.type){case pr.ADDRESS:if(await this.accountBaseHelper.isAddress(l)===!1)throw new _r(c.NOT_MATCH,{to_compare_prop:`${a} ${l}`,to_target:"inputs",be_compare_prop:"pattern chain address",be_target:"defineInput"});break;case pr.SIGNATURE:if(this.transactionHelper.isValidTransactionSignature(l)===!1)throw new _r(c.NOT_MATCH,{to_compare_prop:`${a} ${l}`,to_target:"inputs",be_compare_prop:"pattern chain signature",be_target:"defineInput"});break;case pr.TEXT:break;case pr.CALC:l=vE(o.calc,r);case pr.NUMBER:{if(o.format===Ca.LITERAL&&(l=Number(l)),o.min&&this.jsbiHelper.compareFraction(o.min,{numerator:l,denominator:"1"})===1)throw new _r(c.PROP_SHOULD_GTE_FIELD,{prop:`name ${a} ${l}`,target:"inputs",field:JSON.stringify(o.min)});if(o.max&&this.jsbiHelper.compareFraction(o.max,{numerator:l,denominator:"1"})===-1)throw new _r(c.PROP_SHOULD_LTE_FIELD,{prop:`name ${a} ${l}`,target:"inputs",field:JSON.stringify(o.max)});break}}if(this.trySet(n,o.keyPath,l)===!1)throw new _r(c.PROP_IS_INVALID,{prop:`name ${a}`,target:"inputs"})}return await this.transactionCore.recombineTransaction(n)}trySet(e,t,r){let n;if(t.includes(".")){const s=t.split(".");n=s.pop();for(const o of s){if(e.hasOwnProperty(o)===!1)return!1;e=e[o]}}else n=t;return e.hasOwnProperty(n)===!1?!1:(e[n]=r,!0)}async verifyTransactionBody(e,t,r=this.configHelper){await super.verifyTransactionBody(e,t,r);const n={target:"body"};if(this.emptyRangeType(e,n),e.recipientId)throw new _r(c.SHOULD_NOT_EXIST,{prop:"recipientId",...n});if(e.fromMagic!==r.magic)throw new _r(c.SHOULD_BE,{to_compare_prop:`fromMagic ${e.fromMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(e.toMagic!==r.magic)throw new _r(c.SHOULD_BE,{to_compare_prop:`toMagic ${e.toMagic}`,to_target:"body",be_compare_prop:"local chain magic",...n});if(!e.storage)throw new _r(c.PROP_IS_REQUIRE,{prop:"storage",...n});const s=e.storage;if(s.key!=="macroId")throw new _r(c.SHOULD_BE,{to_compare_prop:`storage.key ${s.key}`,to_target:"storage",be_compare_prop:"macroId",...n});const o=t.call;if(!o)throw new _r(c.PARAM_LOST,{param:"call"});const a={...n,target:"call"},{macroId:p,inputs:l}=o;if(!p)throw new _r(c.PROP_IS_REQUIRE,{prop:"macroId",...a});if(!this.baseHelper.isValidSignature(p))throw new _r(c.PROP_IS_INVALID,{prop:`macroId ${p}`,type:"transaction signature",...a});if(!l)throw new _r(c.PROP_IS_REQUIRE,{prop:"inputs",...a});if(s.value!==p)throw new _r(c.NOT_MATCH,{to_compare_prop:`storage.value ${s.value}`,be_compare_prop:`macroId ${p}`,to_target:"storage",be_target:"call",...n})}init(e,t){return Pa.fromObject({...e,asset:t})}applyTransaction(e,t,r=this.configHelper){return Ve(n=>{n.next=super.applyTransaction(e,t,r);const{macroId:s,inputs:o}=e.asset.call;n.next=t.emit("macroCall",{type:"macroCall",transaction:e,applyInfo:{macroId:s,inputs:o}})})}getMoveAmount(e,t={magic:this.configHelper.magic,assetType:this.configHelper.assetType}){return"0"}};h([J("bfchain-core:TransactionCore",{dynamics:!0}),u("design:type",qn)],zl.prototype,"transactionCore",void 0);zl=h([j(),u("design:paramtypes",[de,me,Pe,te,ke,It])],zl);Ar.VF.set(H.CUSTOM,Vl);Ar.FV.set(Vl,H.CUSTOM);Ar.VF.set(H.REGISTER_CHAIN,$l);Ar.FV.set($l,H.REGISTER_CHAIN);Ar.VF.set(H.MULTIPLE,Ul);Ar.FV.set(Ul,H.MULTIPLE);Ar.VF.set(H.PROMISE,Kl);Ar.FV.set(Kl,H.PROMISE);Ar.VF.set(H.PROMISE_RESOLVE,Cu);Ar.FV.set(Cu,H.PROMISE_RESOLVE);Ar.VF.set(H.MACRO,Gl);Ar.FV.set(Gl,H.MACRO);Ar.VF.set(H.MACRO_CALL,zl);Ar.FV.set(zl,H.MACRO_CALL);class Uf extends Qt{constructor(){super(),this._startTime=Date.now(),this._sleepTime=0,this.onFinished(()=>this.clearTimeout())}get sleepTime(){return this._sleepTime}get endTime(){return this._startTime+this._sleepTime}setTimeout(e,t){this.clearTimeout(),this._startTime=Date.now(),this._sleepTi=Ps(this._sleepTime=e,t)}clearTimeout(){this._sleepTi&&(VE(this._sleepTi),this._sleepTime=0,this._sleepTi=void 0)}}var ci,OA,CA,RA;const{ArgumentIllegalException:_e,ArgumentFormatException:Rt,TimeOutException:Ww}=re("channel","chainChannelHelper");let Ue=ci=class{constructor(e,t,r,n,s){this.baseHelper=e,this.transctionHelper=t,this.blockHelper=r,this.timeHelper=n,this.accountBaseHelper=s}async boxQueryTransactionArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=so.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(F){throw new Rt(c.INVALID_PARAMS,{error:F,params:e})}const r=this.baseHelper,{type:n,types:s,signature:o,senderId:a,recipientId:p,dappid:l,lns:f,storage:g,blockSignature:d,minHeight:y,maxHeight:m,trusteeId:E,purchaseDAppid:T,range:w,offset:b,limit:C,address:N}=t.query;let O=!1;if(n&&(O=!0,!r.isValidTransactionType(n)))throw new _e(c.INVALID_PARAMS_FIELD,{field:`type ${n}`});if(s){O=!0;for(const F of s)if(!r.isValidTransactionType(F))throw new _e(c.INVALID_PARAMS_FIELD,{field:`types.type ${F}`})}if(o&&(O=!0,o.length!==ci.MAX_SIGNATURE_LENGTH))throw new _e(c.INVALID_PARAMS_FIELD,{field:`signature ${o}`});if(a&&(O=!0,a.length>ci.MAX_ADDRESS_LENGTH))throw new _e(c.INVALID_PARAMS_FIELD,{field:`senderId ${a}`});if(p&&(O=!0,p.length>ci.MAX_ADDRESS_LENGTH))throw new _e(c.INVALID_PARAMS_FIELD,{field:`recipientId ${p}`});if(N&&(O=!0,N.length>ci.MAX_ADDRESS_LENGTH))throw new _e(c.INVALID_PARAMS_FIELD,{field:`address ${N}`});if(l&&(O=!0,!r.isValidDAppId(l)))throw new _e(c.INVALID_PARAMS_FIELD,{field:`dappid ${l}`});if(f&&(O=!0,!r.isValidLocationName(f)))throw new _e(c.INVALID_PARAMS_FIELD,{field:`lns ${f}`});if(g){if(O=!0,!(g.key&&g.key.length))throw new _e(c.INVALID_PARAMS_FIELD,{field:`storage.key ${g.key}`});if(!(g.value&&g.value.length))throw new _e(c.INVALID_PARAMS_FIELD,{field:`storage.value ${g.value}`})}if(d&&(O=!0,d.length!==ci.MAX_SIGNATURE_LENGTH))throw new _e(c.INVALID_PARAMS_FIELD,{field:`blockSignature ${d}`});if(y!==void 0&&(O=!0,!r.isUint32(y)))throw new _e(c.INVALID_PARAMS_FIELD,{field:`minHeight ${y}`});if(m!==void 0&&(O=!0,!r.isUint32(m)))throw new _e(c.INVALID_PARAMS_FIELD,{field:`maxHeight ${m}`});if(E&&(O=!0,E.length>ci.MAX_ADDRESS_LENGTH))throw new _e(c.INVALID_PARAMS_FIELD,{field:`trusteeId ${E}`});if(T&&(O=!0,!r.isValidDAppId(T)))throw new _e(c.INVALID_PARAMS_FIELD,{field:`purchaseDAppid ${T}`});if(w&&(O=!0,!r.isString(w)))throw new _e(c.INVALID_PARAMS_FIELD,{field:`range ${w}`});if(O===!1)throw new _e("Invalid QueryTransaction query params, no query conditions");if(!r.isUint32(b))throw new _e(c.INVALID_PARAMS_FIELD,{field:`offset ${b}`});if(C&&!r.isUint32(C))throw new _e(c.INVALID_PARAMS_FIELD,{field:`limit ${C}`});const{tIndex:R}=t.sort;if(R!==void 0&&R!==-1&&R!==1)throw new _e(c.INVALID_PARAMS_FIELD,{field:`tIndex ${R}`});return t}async boxQueryTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=La.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Rt(c.INVALID_PARAMS,{error:r,params:e})}if(t.status===Re.success){const{transactions:r}=t;for(const n of r)await this.transctionHelper.verifyTransactionSignature(n.transaction,{taskLabel:"QueryTransactionReturn"})}return t}get boxIndexTransactionArg(){return this.boxQueryTransactionArg}async boxIndexTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=Ha.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Rt(c.INVALID_PARAMS,{error:r,params:e})}return t}async boxDownloadTransactionArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=Nl.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(s){throw s instanceof nt?s:new Rt(c.INVALID_PARAMS,{error:s,params:e})}const{tIndexes:r}=t;if(r.length===0)throw new _e("Invalid Download transaction query params, no query conditions");const n=this.baseHelper;for(const s of r){const{height:o,tIndex:a,length:p}=s;if(!n.isPositiveInteger(o))throw new _e(c.INVALID_PARAMS_FIELD,{field:`height ${o}`});if(!n.isNaturalNumber(a))throw new _e(c.INVALID_PARAMS_FIELD,{field:`tIndex ${a}`});if(!n.isPositiveInteger(p))throw new _e(c.INVALID_PARAMS_FIELD,{field:`length ${p}`})}return t}async boxDownloadTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=Fa.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Rt(c.INVALID_PARAMS,{error:r,params:e})}if(t.status===Re.success){const{transactions:r}=t;for(const n of r)await this.transctionHelper.verifyTransactionSignature(n.transaction,{taskLabel:"DownloadTransactionReturn"})}return t}async boxNewTransactionArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=wl.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw n instanceof nt?n:new Rt(c.INVALID_PARAMS,{error:n,params:e})}const{transaction:r}=t;return await this.transctionHelper.verifyTransactionSignature(r,{taskLabel:"NewTransactionArg"}),t}boxNewTransactionReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=_s.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Rt(c.INVALID_PARAMS,{error:r,params:e})}if(t.status===Re.success&&(Number.isNaN(parseFloat(t.minFee))||BigInt(t.minFee)<BigInt(0)))throw new _e(c.INVALID_PARAMS_FIELD,{field:"minFee"});return t}async boxOpenBlobArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=xi.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw n instanceof nt?n:new Rt(c.INVALID_PARAMS,{error:n,params:e})}const{hash:r}=t;if(r===void 0||r.length!==64)throw new _e("Invalid Open Blob query params, wrong sha256 value");return t}async boxOpenBlobReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=Oi.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Rt(c.INVALID_PARAMS,{error:r,params:e})}return t}async boxCloseBlobArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=Va.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw r instanceof nt?r:new Rt(c.INVALID_PARAMS,{error:r,params:e})}return t}async boxCloseBlobReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=xl.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Rt(c.INVALID_PARAMS,{error:r,params:e})}return t}async boxReadBlobArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=Ks.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(s){throw s instanceof nt?s:new Rt(c.INVALID_PARAMS,{error:s,params:e})}const{start:r,end:n}=t;if(r<0||r>=n)throw new _e("Invalid Read Blob range");return t}async boxReadBlobReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=oo.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Rt(c.INVALID_PARAMS,{error:r,params:e})}return t}boxQueryBlockArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=$a.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(a){throw new Rt(c.INVALID_PARAMS,{error:a,params:e})}const r=this.baseHelper,{height:n,signature:s}=t.query;let o=!1;if(n&&(o=!0,!r.isUint32(n)))throw new _e(c.INVALID_PARAMS_FIELD,{field:"height"});if(s&&(o=!0,!r.isValidBlockSignature(s)))throw new _e(c.INVALID_PARAMS_FIELD,{field:"signature"});if(o===!1)throw new _e(c.INVALID_QUERYBLOCKARG_QUERY_PARAMS);return t}async boxQueryBlockReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=Ua.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw new Rt(c.INVALID_PARAMS,{error:n,params:e})}const{someBlock:r}=t;return t.status===Re.success&&r&&await this.blockHelper.verifyBlockSignature(r.block,{taskLabel:"QueryBlockReturn"}),t}boxNewBlockArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});let t;try{t=Vr.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw new Rt(c.INVALID_PARAMS,{error:n,params:e})}const r=this.baseHelper;if(!r.isUint32(t.height))throw new _e(c.INVALID_PARAMS_FIELD,{field:`height ${t.height}`});if(!r.isValidBlockSignature(t.signature))throw new _e(c.INVALID_PARAMS_FIELD,{field:`signature ${t.signature}`});if(!r.isValidBlockSignature(t.previousBlockSignature))throw new _e(c.INVALID_PARAMS_FIELD,{field:`previousBlockSignature ${t.previousBlockSignature}`});if(!r.isFiniteBigInt(t.totalFee))throw new _e(c.INVALID_PARAMS_FIELD,{field:`totalFee ${t.totalFee}`});if(!r.isUint32(t.numberOfTransactions))throw new _e(c.INVALID_PARAMS_FIELD,{field:`numberOfTransactions ${t.numberOfTransactions}`});if(!r.isUint32(t.timestamp))throw new _e(c.INVALID_PARAMS_FIELD,{field:`timestamp ${t.timestamp}`});if(!r.isValidPublicKey(t.generatorPublicKeyBuffer))throw new _e(c.INVALID_PARAMS_FIELD,{field:`generatorPublicKey ${t.generatorPublicKey}`});if(!r.isUint32(t.version))throw new _e(c.INVALID_PARAMS_FIELD,{field:`version ${t.version}`});return t}boxNewBlockReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});try{return Ka.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(t){throw new Rt(c.INVALID_PARAMS,{error:t,params:e})}}boxGetPeerInfoArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});try{return Ol.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(t){throw new Rt(c.INVALID_PARAMS,{error:t,params:e})}}boxGetPeerInfoReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{params:e});try{return Ga.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(t){throw new Rt(c.INVALID_PARAMS,{error:t,params:e})}}async boxQueryTindexArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{function:"boxQueryTindexArg",params:e});let t;try{t=Tl.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(R){throw new Rt(c.INVALID_PARAMS,{function:"boxQueryTindexArg",error:R,params:e})}const r=this.baseHelper,{type:n,signature:s,senderId:o,recipientId:a,dappid:p,lns:l,storage:f,blockSignature:g,minHeight:d,maxHeight:y,trusteeId:m,purchaseDAppid:E,range:T,address:w,offset:b,limit:C}=t.query;let N=!1;if(n&&(N=!0,!r.isValidTransactionType(n)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg",field:`type ${n}`});if(s&&(N=!0,!r.isValidTransactionSignature(s)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`signature ${s}`});if(o&&(N=!0,!await this.accountBaseHelper.isAddress(o)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`senderId ${o}`});if(a&&(N=!0,!await this.accountBaseHelper.isAddress(a)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`recipientId ${a}`});if(p&&(N=!0,!r.isValidDAppId(p)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`dappid ${p}`});if(l&&(N=!0,!r.isValidLocationName(l)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`lns ${l}`});if(f){if(N=!0,!(f.key&&f.key.length))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`storage.key ${f.key}`});if(!(f.value&&f.value.length))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`storage.value ${f.value}`})}if(g&&(N=!0,!r.isValidBlockSignature(g)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`blockSignature ${g}`});if(d!==void 0&&(N=!0,!r.isUint32(d)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`minHeight ${d}`});if(y!==void 0&&(N=!0,!r.isUint32(y)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`maxHeight ${y}`});if(m&&(N=!0,!await this.accountBaseHelper.isAddress(m)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`trusteeId ${m}`});if(E&&(N=!0,!r.isValidDAppId(E)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`purchaseDAppid ${E}`});if(T&&(N=!0,!r.isString(T)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`range ${T}`});if(w&&(N=!0,!await this.accountBaseHelper.isAddress(w)))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`address ${w}`});if(N===!1)throw new _e("Invalid QueryTransaction query params, no query conditions");if(!r.isUint32(b))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`offset ${b}`});if(C&&!r.isUint32(C))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.query",field:`limit ${C}`});const{tIndex:O}=t.sort;if(O!==void 0&&O!==-1&&O!==1)throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexArg.sort",field:`tIndex ${O}`});return t}async boxQueryTindexReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{function:"boxQueryTindexesReturn",params:e});let t;try{t=Da.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Rt(c.INVALID_PARAMS,{function:"boxQueryTindexesReturn",error:r,params:e})}if(t.status===Re.success){const r=t.tIndexes,n=this.baseHelper;for(const s of r)if(!n.isNaturalNumber(s))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxQueryTindexesReturn",field:`tIndexes ${s}`})}return t}async boxGetTransactionInBlockArg(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{function:"boxGetTransactionInBlockArg",params:e});let t;try{t=Sl.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(n){throw new Rt(c.INVALID_PARAMS,{function:"boxGetTransactionInBlockArg",error:n,params:e})}if(!this.baseHelper.isValidTindexRanges(t.query.tIndexRanges))throw new _e(c.INVALID_PARAMS_FIELD,{function:"boxGetTransactionInBlockArg.query.tIndexRanges",field:`tIndexRanges ${t.query.tIndexRanges}`});return t}async boxGetTransactionInBlockReturn(e){if(!(e instanceof ArrayBuffer||e instanceof Uint8Array))throw new _e(c.INVALID_PARAMS,{function:"boxGetTransactionInBlockReturn",params:e});let t;try{t=ka.decode(e instanceof Uint8Array?e:new Uint8Array(e))}catch(r){throw new Rt(c.INVALID_PARAMS,{function:"boxGetTransactionInBlockReturn",error:r,params:e})}if(t.status===Re.success){const{transactionInBlocks:r}=t;r.forEach(async n=>{await this.transctionHelper.verifyTransactionSignature(n.transaction,{taskLabel:"GetTransactionInBlockReturn"})})}return t}parserAborterOptions(e,t){if(e.disabledAborterOptions)return;let r;e.aborter&&(r||(r=new Uf),this._bindRejectedToPromiseOut(e.aborter.abortedPromise,r));let n;if(e.timeout!==void 0&&(n=typeof e.timeout=="function"?e.timeout(t):e.timeout),e.deadlineTime!==void 0){const s=this.timeHelper.now(),o=e.deadlineTime-s;n?o<n&&(n=o):n=o}if(n!==void 0){const{reject:s}=r||(r=new Uf);r.setTimeout(n,()=>s(typeof e.timeoutException=="function"?e.timeoutException(t):e.timeoutException||new Ww))}return e.rejected&&(r||(r=new Uf),this._bindRejectedToPromiseOut(e.rejected,r)),r}_bindRejectedToPromiseOut(e,t){Ji(e,void 0,t.reject),t.onFinished(()=>Ph(e,void 0,t.reject))}wrapAborterOptions(e,t,r){const n=t&&this.parserAborterOptions(t,r);return n&&(e.then(n.resolve,n.reject),e=n.promise),e}wrapOutAborterOptions(e,t,r){const n=t&&this.parserAborterOptions(t,r);return n&&(Ji(e.promise,n.resolve,n.reject),Ji(n.promise,e.resolve,e.reject),e=n),e}getChainChannelTimeout(e,t=3e4){return Math.max(Number.isFinite(e.delay)?e.delay:1e3,2e3)+t}verifyDownloadBlobArgs(e){const{algorithm:t,hash:r,downloadSize:n}=e;if(!Number.isInteger(n))throw new _e(c.INVALID_PARAMS_FIELD,{function:"openArg.downloadSize",field:`openArg.downloadSize ${n}`});if(n<=0)throw new _e(c.INVALID_PARAMS_FIELD,{function:"openArg.downloadSize",field:`openArg.downloadSize ${n}`})}};Ue.MAX_ADDRESS_LENGTH=40;Ue.MAX_SIGNATURE_LENGTH=128;h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxQueryTransactionArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxQueryTransactionReturn",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],Ue.prototype,"boxIndexTransactionArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxIndexTransactionReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxDownloadTransactionReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxNewTransactionArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],Ue.prototype,"boxNewTransactionReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxOpenBlobArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxOpenBlobReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxCloseBlobArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxCloseBlobReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxReadBlobArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxReadBlobReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",$a)],Ue.prototype,"boxQueryBlockArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxQueryBlockReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Vr)],Ue.prototype,"boxNewBlockArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Ka)],Ue.prototype,"boxNewBlockReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Ol)],Ue.prototype,"boxGetPeerInfoArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Ga)],Ue.prototype,"boxGetPeerInfoReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxQueryTindexArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxQueryTindexReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxGetTransactionInBlockArg",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",Promise)],Ue.prototype,"boxGetTransactionInBlockReturn",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object,typeof(OA=typeof ENV<"u"&&ENV)=="function"?OA:Object]),u("design:returntype",void 0)],Ue.prototype,"parserAborterOptions",null);h([$e,u("design:type",Function),u("design:paramtypes",[Promise,Object,typeof(CA=typeof ENV<"u"&&ENV)=="function"?CA:Object]),u("design:returntype",void 0)],Ue.prototype,"wrapAborterOptions",null);h([$e,u("design:type",Function),u("design:paramtypes",[Qt,Object,typeof(RA=typeof ENV<"u"&&ENV)=="function"?RA:Object]),u("design:returntype",void 0)],Ue.prototype,"wrapOutAborterOptions",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object,Object]),u("design:returntype",void 0)],Ue.prototype,"getChainChannelTimeout",null);Ue=ci=h([j(),u("design:paramtypes",[Pe,me,_t,Vt,de])],Ue);const{RefuseException:zr,ArgumentFormatException:PA,NoFoundException:YE,error:qw,TimeOutException:zd,success:BA,log:MA}=re("channel","chainChannel");class QE extends HE{toBlockGetterHelper(e){return this._blockGetterHelper||(this._blockGetterHelper={getBlockByHeight:t=>this.findBlock({height:t}),getBlockBySignature:t=>this.findBlock({signature:t}),maxHeight:1,lastBlock:to.fromObject(this.config.genesisBlock),async getLastBlock(){if(this.lastBlock.height!==this.maxHeight){const t=await this.getBlockByHeight(this.maxHeight);if(!t)throw new YE;this.lastBlock=t}return this.lastBlock}}),e&&(this.baseHelper.isPositiveFloatNotContainZero(e.maxHeight)&&(this._blockGetterHelper.maxHeight=e.maxHeight),e.lastBlock&&(this._blockGetterHelper.lastBlock=e.lastBlock)),this._blockGetterHelper}}const Os=new Map,vA=new Uint32Array(1),Xw=()=>{const i=vA[0]++||vA[0]++,e=Os.get(i);return e&&(e.reject(new zd(c.REQID_REUSE)),Os.delete(i)),i},Ic=new Map([[Te.QUERY_TRANSACTION,Te.QUERY_TRANSACTION_RETURN],[Te.INDEX_TRANSACTION,Te.INDEX_TRANSACTION_RETURN],[Te.DOWNLOAD_TRANSACTION,Te.DOWNLOAD_TRANSACTION_RETURN],[Te.NEW_TRANSACTION,Te.NEW_TRANSACTION_RETURN],[Te.QUERY_BLOCK,Te.QUERY_BLOCK_RETURN],[Te.NEW_BLOCK,Te.NEW_BLOCK_RETURN],[Te.GET_PEER_INFO,Te.GET_PEER_INFO_RETURN],[Te.OPEN_BLOB,Te.OPEN_BLOB_RETURN],[Te.READ_BLOB,Te.READ_BLOB_RETURN],[Te.CLOSE_BLOB,Te.CLOSE_BLOB_RETURN]]),Zw=2;let Js=class extends QE{constructor(e,t=1e3){super(),this.endpoint=e,this.refuseTime=t,this._canQueryTindex=!1,this._canGetTransactionInBlock=!1,this._limitQT=100,this._limitIT=100,this._limitDT=100,this.MESSAGE_VERSION=2,this._closed=!1,this._maybeHeight=1,this._lastConsensusVersion=1,this._address="",this._delayHistroyList=new Float32Array(32),this._reqIdSet=new Set,this.reqresLimitInfoEM=wt.from({creater(r){return{preResponseTime:0,preRefuseTime:0,preResponseLimitConfig:{lockTimespan:0,refuseTimespan:1/0}}}}),this._msgPostQuene=wt.from({creater:r=>{const n={taskList:[],running:!1,looper:async()=>{if(!n.running){n.running=!0;do{const s=n.taskList.shift();if(s===void 0)break;const o=this.reqresLimitInfoEM.get(r);if(o!==void 0){const l=o.preResponseTime+o.preResponseLimitConfig.lockTimespan-this.timeHelper.now();l>0&&(MA("req chainChannel(%s) cmd:%d need wait %dms",this.address,s.cmd,l),await Ps(l))}if(s.sign.is_rejected)continue;const a=an.fromObject({version:this.config.version,req_id:s.req_id,cmd:s.cmd,binary:s.binary,messageVersion:this.MESSAGE_VERSION});this.endpoint.postMessage(a.getBytes()),s.sign.resolve();const p=Os.get(s.req_id);p&&await new Promise(l=>p.onFinished(l))}while(n.taskList.length>0);this._msgPostQuene.delete(r)}}};return n}}),this._openedBlobs=new Set,this._busyNewTransaction=0,this.initOnMessage(),e.onClose(()=>{this._closed=!0;for(const r of this._reqIdSet){const n=Os.get(r);n&&(n.reject(new zd(c.CHAINCHANNEL_CLOSED)),Os.delete(r))}this._reqIdSet.clear()})}get canQueryTransactions(){return!1}get canIndexTransactions(){return!1}get canDownloadTransactions(){return!0}get blobSupportAlgorithms(){return[]}get canQueryBlock(){return!0}get canBroadcastTransaction(){return!0}get canBroadcastBlock(){return!0}get canQueryTindex(){return this._canQueryTindex}get canGetTransactionInBlock(){return this._canGetTransactionInBlock}get limitQueryTransactions(){return this._limitQT}get limitIndexTransactions(){return this._limitIT}get limitDownloadTransactions(){return this._limitDT}get defaultReqOptions(){}get diffTime(){return 0}onClose(e,t){if(t){const r=this.endpoint.onClose(n=>{e(n),r()});return r}else return this.endpoint.onClose(e)}close(e){return this.endpoint.close(e)}get maybeHeight(){return this._maybeHeight}get lastConsensusVersion(){return this._lastConsensusVersion}get address(){return this._address}set address(e){this._address=e}get delay(){if(this._delayCache)return this._delayCache.value;const{_delayHistroyList:e}=this;let t=0,r=e.length;for(let s=0;s<e.length;s+=1){const o=e[s];o?t+=o:r-=1}const n=t/r||0;return this._delayCache={value:n},n}pushDelayHistroy(e){const{_delayHistroyList:t}=this,r=t.length;t.set(t.subarray(1,r),0),t[r-1]=e,this._delayCache=void 0}_request(e,t,r,n){return this._requestWithBinaryData(e,this._requestDataToBinary(t),r,n)}_requestDataToBinary(e){return new Uint8Array(e.constructor.encode(e).finish())}_sendWithBinaryData(e,t){return this.postChainChannelMessage(0,e,t)}async _requestWithBinaryData(e,t,r,n=this.defaultReqOptions){const s=Xw();this._reqIdSet.add(s),await this.postChainChannelMessage(s,e,t);let o=new Qt;o.onFinished(()=>{Os.delete(s),this._reqIdSet.delete(s)}),Os.set(s,o),n&&(n.timeout||(n.timeout=1e3),n.timeoutException===void 0&&(n=Object.create(n,{timeoutException:{get(){return new zd(c.CHAINCHANNEL_TIMEOUT,{endpoint:this.endpoint,cmd:Te[e]})}}})),o=this.chainChannelHelper.wrapOutAborterOptions(o,n,{chainChannel:this}));const a=await r(await o.promise);return await this.emit("afterRequestWithBinaryData",{cmd:e,query:t,res:a}),a}_getMaybeQueneTimeCache(){let e=this._maybeQueneTimeFastCache;return e===void 0&&(e=this._maybeQueneTimeFastCache={cache:new Map,releaser:queueMicrotask(()=>this._maybeQueneTimeFastCache=void 0)}),e.cache}getApiMaybeQueueTime(e){if(!(e&Te.RESPONSE))return 0;const t=this._getMaybeQueneTimeCache();let r=t.get(e);if(r===void 0){const n=this.reqresLimitInfoEM.get(e);if(n===void 0)r=0;else{const s=n.preResponseTime+n.preResponseLimitConfig.lockTimespan,o=Math.max(0,s-this.timeHelper.now()),a=this._msgPostQuene.get(e);a===void 0?r=o:r=a.taskList.length*n.preResponseLimitConfig.lockTimespan+o}t.set(e,r)}return r}async postChainChannelMessage(e,t,r){if(this._closed)return;let n=0,s=0;if(Ic.has(t)){if(this.reqresLimitInfoEM.get(t)!==void 0){const p=this._msgPostQuene.forceGet(t),l=new Qt;return p.taskList.push({req_id:e,cmd:t,binary:r,sign:l}),p.looper(),l.promise}}else if(t&Te.RESPONSE&&this.has("onGetResponseLimitConfig")){let a=this.reqresLimitInfoEM.get(t);const p=this.timeHelper.now();if(a){const f=a.preResponseLimitConfig;(a.preResponseTime||p)+f.lockTimespan<p&&(a=void 0)}const l=await this.emit("onGetResponseLimitConfig",{cmd:t,requestLimitInfo:a});l!==void 0&&(a=a||this.reqresLimitInfoEM.forceGet(t),a.preResponseTime=p,a.preResponseLimitConfig=l,n=l.lockTimespan,s=l.refuseTimespan)}const o=an.fromObject({version:this.config.version,req_id:e,cmd:t,binary:r,lockTimespan:n,refuseTimespan:s,messageVersion:this.MESSAGE_VERSION});return this.endpoint.postMessage(o.getBytes())}async queryTransactions(e,t,r){if(!this.canQueryTransactions)return La.fromObject({status:Re.error,error:xt.fromObject(new zr(c.REFUSE_RESPONSE_QUERY_TRANSACTION))});const n=so.fromObject({query:ht.fromObject(e),sort:on.fromObject(t||{})}),s=await this._request(Te.QUERY_TRANSACTION,n,this.chainChannelHelper.boxQueryTransactionReturn,r);return await this._downloadBlobFromTibs(s.transactions),s}async indexTransactions(e,t,r){if(!this.canIndexTransactions)return Ha.fromObject({status:Re.error,error:xt.fromObject(new zr(c.REFUSE_RESPONSE_INDEX_TRANSACTION))});const n=bl.fromObject({query:ht.fromObject(e),sort:on.fromObject(t||{})});return this._request(Te.INDEX_TRANSACTION,n,this.chainChannelHelper.boxIndexTransactionReturn,r)}async downloadTransactions(e,t){if(!this.canDownloadTransactions)return Fa.fromObject({status:Re.error,error:xt.fromObject(new zr(c.REFUSE_RESPONSE_DOWNLOAD_TRANSACTION))});const r=Nl.fromObject({tIndexes:e.map(s=>As.fromObject(s))}),n=await this._request(Te.DOWNLOAD_TRANSACTION,r,this.chainChannelHelper.boxDownloadTransactionReturn,t);return await this._downloadBlobFromTibs(n.transactions),n}async openBlob(e,t){if(!this.blobSupportAlgorithms.includes(e.algorithm))return Oi.fromObject({status:Re.error,error:xt.fromObject(new zr(c.REFUSE_RESPONSE_OPEN_BLOB))});const r=xi.fromObject(e),n=await this._request(Te.OPEN_BLOB,r,this.chainChannelHelper.boxOpenBlobReturn,t);return n.descriptor&&this._openedBlobs.add(n.descriptor),n}async readBlob(e,t){if(this._openedBlobs.has(e.descriptor)===!1)return oo.fromObject({status:Re.error,error:xt.fromObject(new zr(c.REFUSE_RESPONSE_READ_BLOB))});const r=Ks.fromObject(e);return this._request(Te.READ_BLOB,r,this.chainChannelHelper.boxReadBlobReturn,t)}async closeBlob(e,t){if(this._openedBlobs.has(e.descriptor)===!1)return xl.fromObject({status:Re.error,error:xt.fromObject(new zr(c.REFUSE_RESPONSE_CLOSE_BLOB))});const r=Va.fromObject(e),n=await this._request(Te.CLOSE_BLOB,r,this.chainChannelHelper.boxCloseBlobReturn,t);return n.status===Re.success&&this._openedBlobs.delete(e.descriptor),n}async downloadBlob(e){this.chainChannelHelper.verifyDownloadBlobArgs(e);const t={totalSize:-1,totalCount:-1,currentCount:-1};if(await this.blobHelper.exists(e))return;let r;try{const n=await this.openBlob(e);if(n.status===Re.busy&&await Ps(5e3),n.status!==Re.success)throw n.error;r=n.descriptor;const s=e.downloadSize;let o=1024*1024;o=o<s?o:s;const a=await this.blobHelper.requestStorage(e,s,o,n.contentType,0),p=Math.ceil(s/o),l=s-(p-1)*o;t.totalSize=s,t.totalCount=p,t.currentCount=0;const f=[];for(let m=0;m<p;m++)f.push(async()=>{let E=0,T=!1,w=0;for(;E<3;)try{const b=o*m,C=await this.readBlob({descriptor:r,start:b,end:m===p-1?b+l:b+o});if(C.status===Re.busy||C.status!==Re.success)throw C;if(w=C.chunkBuffer.length,w===0)break;await this.blobHelper.saveChunk(a,m,C.chunkBuffer),T=!0;break}catch(b){if(E++,E>=3)throw b;await Ps(100)}return{isSuccess:T,bytesRead:w}});let g=0,d=!0,y=0;e:for(;;){const m=f.slice(g,g+3);if(m.length===0)break;const E=await Promise.all(m.map(T=>T()));for(const T of E){if(T.isSuccess===!1){d=!1;break e}y+=T.bytesRead}g+=m.length}if(!d)throw new zr(c.FAIL_TO_DOWNLOAD_BLOB,{hash:e.hash,size:s});if(y!==s)throw new zr(c.NOT_MATCH,{to_compare_prop:`downloadSize ${y}`,to_target:"real downloaded",be_compare_prop:`downloadSize ${s}`,be_target:"transaction blob"});await this.blobHelper.saveAsBlob(a)}finally{if(r!==void 0)try{await this.closeBlob({descriptor:r})}catch{}}}async _downloadBlobFromTibs(e){for(const t of e)await this.downloadBlobFromTrs(t.transaction)}async downloadBlobFromTrs(e){for(const[t,r,n,s]of e.blobMap.values())await this.downloadBlob({algorithm:t,hash:r,downloadSize:s})}async initBroadcastTransactionArg(e,t){const r=wl.fromObject({transaction:e instanceof Y?e:await this.transactionCore.recombineTransaction(e),grabSecret:t==null?void 0:t.grabSecret});return[Te.NEW_TRANSACTION,this._requestDataToBinary(r),this.chainChannelHelper.boxNewTransactionReturn,t]}calcDiffTimeToTargetTime(e){return this.timeHelper.now()+this.diffTime-e}async broadcastTransaction(e,t){if(!this.canBroadcastTransaction)return _s.fromObject({status:Re.error,error:xt.fromObject(new zr(c.REFUSE_RESPONSE_BROADCAST_TRANSACTION))});const r=await this.initBroadcastTransactionArg(e,t),n=-this.calcDiffTimeToTargetTime(this.timeHelper.getTimeByTimestamp(e.timestamp));n>0&&(MA("chainChannel(%s) seems in feature. need wait %dms then broadcast.",this.address,n),await Ps(n));const s=await this._requestWithBinaryData(...r);return BA("broadcasted Transaction(%s)",this.transactionCore.transactionHelper.getTypeName(e.type),e.asset),s}get isRefusePushNewTransaction(){return this.canBroadcastTransaction?this._busyNewTransaction>this.timeHelper.now()-this.refuseTime:!0}async fastBroadcastTransaction(e){if(this.isRefusePushNewTransaction)return 0;const t=await this.initBroadcastTransactionArg(e);return await this._sendWithBinaryData(t[0],t[1]),1}async queryBlock(e,t){if(!this.canQueryBlock)return Ua.fromObject({status:Re.error,error:xt.fromObject(new zr(c.REFUSE_RESPONSE_QUERY_BLOCK))});const r=$a.fromObject({query:ao.fromObject(e)});return this._request(Te.QUERY_BLOCK,r,this.chainChannelHelper.boxQueryBlockReturn,t)}async findBlock(e,t){const r=await this.queryBlock(e,t);return r.someBlock&&r.someBlock.block}initBroadcastBlockArg(e,t){const r=Vr.fromObject(e);return r.generatorPublicKey=e.generatorPublicKey,[Te.NEW_BLOCK,this._requestDataToBinary(r),this.chainChannelHelper.boxNewBlockReturn,t]}async broadcastBlock(e,t){if(!this.canBroadcastBlock)return Ka.fromObject({status:Re.error,error:xt.fromObject(new zr(c.REFUSE_RESPONSE_BROADCAST_BLOCK))});const r=await this._requestWithBinaryData(...this.initBroadcastBlockArg(e,t));return BA("broadcasted block:",e.height),r}async queryTindexes(e,t,r){if(!this.canQueryTindex)return Da.fromObject({status:Re.error,error:xt.fromObject(new zr("Refuse response query transaction index"))});const n=so.fromObject({query:ht.fromObject(e),sort:on.fromObject(t||{})});return this._request(Te.QUERY_TINDEX,n,this.chainChannelHelper.boxQueryTindexReturn,r)}async queryTransactionInBlocks(e,t){if(!this.canGetTransactionInBlock)return ka.fromObject({status:Re.error,error:xt.fromObject(new zr("Refuse response query transactionInBlock"))});const r=Sl.fromObject({query:io.fromObject(e)});return this._request(Te.GET_TRANSACTIONINBLOCK,r,this.chainChannelHelper.boxGetTransactionInBlockReturn,t)}initOnMessage(){this.endpoint.onMessage(async e=>{try{let t,r,n,s,o;try{s=an.decode(e),t=s.req_id,r=s.cmd,n=s.binary,o=s.messageVersion}catch{throw new PA(c.MESSAGE_TYPE_ERROR)}if(o<Zw)return;let a,p;const l=(f,g)=>(f.status=Re.error,f.error=xt.fromException(g),f);try{let f=!0;if(Ic.has(r)){const g=r|Te.RESPONSE,d=this.reqresLimitInfoEM.get(g),y=this.timeHelper.now();let m=0;if(d){const E=y-d.preResponseTime;E<d.preResponseLimitConfig.lockTimespan&&(d.preResponseLimitConfig.lockTimespan-E>d.preResponseLimitConfig.refuseTimespan?m=2:m=1)}if(this.has("onBreakRequestLimit")){const E=await this.emit("onBreakRequestLimit",{cmd:r,requestLimitStrategy:m,requestLimitInfo:d});E!==void 0&&(m=E.requestLimitStrategy)}if(m===2){d&&(d.preRefuseTime=y),await this.postChainChannelMessage(t,Te.REFUSE,new Uint8Array(0));return}m===1&&(f=!1)}else if(r&Te.RESPONSE){const g=r-Te.RESPONSE;let d=this.reqresLimitInfoEM.get(g);const{lockTimespan:y,refuseTimespan:m}=s,E=y!==0||m!==0;d===void 0?E&&(d=this.reqresLimitInfoEM.forceGet(g),d.preResponseTime=this.timeHelper.now(),d.preResponseLimitConfig={lockTimespan:y,refuseTimespan:m}):E===!1?this.reqresLimitInfoEM.delete(g):(d.preResponseTime=this.timeHelper.now(),d.preResponseLimitConfig={lockTimespan:y,refuseTimespan:m})}switch(r){case Te.QUERY_TRANSACTION:{if(f&&this.has("onQueryTransactionBinary")){p=await this.emit("onQueryTransactionBinary",await this.chainChannelHelper.boxQueryTransactionArg(n));break}const g=La.fromObject({status:Re.busy}),d=f&&this.has("onQueryTransaction")?await this.emit("onQueryTransaction",await this.chainChannelHelper.boxQueryTransactionArg(n)):void 0;d&&(g.status=Re.success,g.transactions=d.transactions.map(y=>Gt.fromObject(y))),a=g;break}case Te.INDEX_TRANSACTION:{if(f&&this.has("onIndexTransactionBinary")){p=await this.emit("onIndexTransactionBinary",await this.chainChannelHelper.boxIndexTransactionArg(n));break}const g=Ha.fromObject({status:Re.busy}),d=f&&this.has("onQueryTransaction")?await this.emit("onIndexTransaction",await this.chainChannelHelper.boxIndexTransactionArg(n)):void 0;d&&(g.status=Re.success,g.tIndexes=d.tIndexes.map(y=>As.fromObject(y))),a=g;break}case Te.DOWNLOAD_TRANSACTION:{if(f&&this.has("onDownloadTransactionBinary")){p=await this.emit("onDownloadTransactionBinary",await this.chainChannelHelper.boxDownloadTransactionArg(n));break}const g=Fa.fromObject({status:Re.busy}),d=f&&this.has("onDownloadTransaction")?await this.emit("onDownloadTransaction",await this.chainChannelHelper.boxDownloadTransactionArg(n)):void 0;d&&(g.status=Re.success,g.transactions=d.transactions.map(y=>Gt.fromObject(y))),a=g;break}case Te.NEW_TRANSACTION:{const g=_s.fromObject({status:Re.busy}),d=this.has("onNewTransaction")?await this.emit("onNewTransaction",await this.chainChannelHelper.boxNewTransactionArg(n)):void 0;d&&(g.status=Re.success,g.minFee=d.minFee,g.newTrsStatus=d.newTrsStatus,g.refuseReason=d.refuseReason,g.errorCode=d.errorCode,g.errorMessage=d.errorMessage),a=g;break}case Te.OPEN_BLOB:{const g=Oi.fromObject({status:Re.busy}),d=await this.chainChannelHelper.boxOpenBlobArg(n),y=this.has("onOpenBlob")?await this.emit("onOpenBlob",d):await this.blobHelper.open(d);y&&(g.status=Re.success,g.descriptor=y.descriptor,g.contentType=y.contentType),a=g;break}case Te.READ_BLOB:{const g=oo.fromObject({status:Re.busy}),d=await this.chainChannelHelper.boxReadBlobArg(n),y=this.has("onReadBlob")?await this.emit("onReadBlob",d):await this.blobHelper.read(d);y&&(g.status=Re.success,g.chunkBuffer=y.chunkBuffer),a=g;break}case Te.CLOSE_BLOB:{const g=xl.fromObject({status:Re.busy}),d=await this.chainChannelHelper.boxCloseBlobArg(n);(this.has("onCloseBlob")?await this.emit("onCloseBlob",d):await this.blobHelper.close(d))&&(g.status=Re.success),a=g;break}case Te.QUERY_BLOCK:{if(f&&this.has("onQueryBlockBinary")){p=await this.emit("onQueryBlockBinary",this.chainChannelHelper.boxQueryBlockArg(n));break}const g=Ua.fromObject({status:Re.busy}),d=f&&this.has("onQueryBlock")?await this.emit("onQueryBlock",this.chainChannelHelper.boxQueryBlockArg(n)):void 0;if(d&&d.block!==void 0){g.status=Re.success;const y=d.block;if(y){const m=new Proxy(dt.fromObject(y),{get(E,T,w){return T==="transactions"||T==="transactionBufferList"?[]:Reflect.get(E,T,w)}});g.someBlock=Si.fromObject({block:m})}}a=g;break}case Te.NEW_BLOCK:{const g=Ka.fromObject({status:Re.busy}),d=this.chainChannelHelper.boxNewBlockArg(n);this._maybeHeight=d.height,(this.has("onNewBlock")?await this.emit("onNewBlock",d):void 0)&&(g.status=Re.success),a=g;break}case Te.GET_PEER_INFO:{const g=Ga.fromObject({status:Re.busy}),d=this.has("onGetPeerInfo")?await this.emit("onGetPeerInfo",this.chainChannelHelper.boxGetPeerInfoArg(n)):void 0;d&&d.peerInfo&&(g.status=Re.success,g.peerInfo=hn.fromObject(d.peerInfo)),a=g;break}case Te.QUERY_TINDEX:{const g=Da.fromObject({status:Re.busy}),d=this.has("onQueryTindexes")?await this.emit("onQueryTindexes",await this.chainChannelHelper.boxQueryTransactionArg(n)):void 0;d&&(g.status=Re.success,g.tIndexes=d.tIndexes),a=g;break}case Te.GET_TRANSACTIONINBLOCK:{const g=ka.fromObject({status:Re.busy}),d=this.has("onGetTransactionInBlocks")?await this.emit("onGetTransactionInBlocks",await this.chainChannelHelper.boxGetTransactionInBlockArg(n)):void 0;d&&(g.status=Re.success,g.transactionInBlocks=d.transactionInBlocks.map(y=>Gt.fromObject(y))),a=g;break}case Te.QUERY_TRANSACTION_RETURN:case Te.INDEX_TRANSACTION_RETURN:case Te.DOWNLOAD_TRANSACTION_RETURN:case Te.NEW_TRANSACTION_RETURN:case Te.QUERY_BLOCK_RETURN:case Te.NEW_BLOCK_RETURN:case Te.GET_PEER_INFO_RETURN:case Te.OPEN_BLOB_RETURN:case Te.READ_BLOB_RETURN:case Te.CLOSE_BLOB_RETURN:case Te.QUERY_TINDEX_RETURN:case Te.GET_TRANSACTIONINBLOCK_RETURN:case Te.RESPONSE:{const g=Os.get(t);if(g===void 0){if(t!==0)qw(new YE(c.ONMESSAGE_GET_INVALID_REQ_ID,{req_id:t}));else if(r===Te.NEW_TRANSACTION_RETURN){const{status:d}=this.chainChannelHelper.boxNewTransactionReturn(n);d===Re.busy&&(this._busyNewTransaction=this.timeHelper.now())}return}g.resolve(n);break}case Te.REFUSE:{const g=Os.get(t);if(g!==void 0){g.reject(new zr(c.REQUEST_LIMIT));return}this.close("chain channel refuse accpet data.");return}default:throw new PA(c.INVALID_MESSAGE_CMD,{cmd:r})}}catch(f){const g=l(rr.fromObject({status:Re.error}),f);throw await this.postChainChannelMessage(t,Ic.get(r)||Te.RESPONSE,rr.encode(g).finish()),f}if(p){await this.postChainChannelMessage(t,Ic.get(r)||Te.RESPONSE,p);return}a&&await this.postChainChannelMessage(t,Ic.get(r)||Te.RESPONSE,a.constructor.encode(a).finish())}catch(t){this.emit("handleMessageError",{handleName:"onMessage",error:t})}})}};h([J("bfchain-core:TransactionCore"),u("design:type",Object)],Js.prototype,"transactionCore",void 0);h([J(te),u("design:type",te)],Js.prototype,"config",void 0);h([J(Pe),u("design:type",Pe)],Js.prototype,"baseHelper",void 0);h([J(Vt),u("design:type",Vt)],Js.prototype,"timeHelper",void 0);h([J(Ue),u("design:type",Ue)],Js.prototype,"chainChannelHelper",void 0);h([J(Ci),u("design:type",Ci)],Js.prototype,"blobHelper",void 0);Js=h([wo(),Oe(0,J(Hh.ENDPOINT)),Oe(1,J(Hh.REFUSETIME,{optional:!0})),u("design:paramtypes",[Object,Object])],Js);class e0 extends Qt{constructor(e){super(),this.filter=e}match(e){return this.filter===void 0||this.filter(e)}}class t0{constructor(){this._queue=new Set}get size(){return this._queue.size}enqueue(e){const t=new e0(e);return this._queue.add(t),t}dequeue(e){for(const t of this._queue)if(t.match(e))return t.resolve(e),this._queue.delete(t),t}}var jd,Jd,Yd,Qd,Wd;re("channel","chainChannelGroup");class sh{constructor(){this._inQueneTaskMap=new Map,this._generateQueneTask=(e,t)=>{const r=this._doRequest(e,t).then(n=>(r.resolved=r.finished=!0,this._inQueneTaskMap.has(e)&&this._retCCMap.set(n,e),n),n=>{throw r.rejected=r.finished=!0,this._inQueneTaskMap.has(e)&&this._retCCMap.set(n,e),n});return r},this._retCCMap=new Map}addChainChannel(e,t){return this._inQueneTaskMap.has(e)||this._inQueneTaskMap.set(e,this._generateQueneTask(e,t)),this.helper.wrapAborterOptions(FE(this._inQueneTaskMap.values()),t,{chainChannel:e})}removeChainChannel(e){return this._inQueneTaskMap.delete(e)}removeChainChannelByResult(e){const t=this._retCCMap.get(e);return t?this.removeChainChannel(t):!1}getChainChannelByResult(e){return this._retCCMap.get(e)}finish(){this._inQueneTaskMap.clear(),this._retCCMap.clear()}}const Ru={QUERY:Symbol("query"),SORT:Symbol("sort")};let Pu=jd=class extends sh{constructor(e,t){super(),this.query=e,this.sort=t}_doRequest(e,t){return e.queryTransactions(this.query,this.sort,t)}static create(e,t,r){return Ot(jd,new et([[Ru.QUERY,t],[Ru.SORT,r]],e))}};h([J(Ue),u("design:type",Ue)],Pu.prototype,"helper",void 0);Pu=jd=h([wo(),Oe(0,J(Ru.QUERY)),Oe(1,J(Ru.SORT,{optional:!0})),u("design:paramtypes",[Object,Object])],Pu);const Bu={QUERY:Symbol("query"),SORT:Symbol("sort")};let Mu=Jd=class extends sh{constructor(e,t){super(),this.query=e,this.sort=t}_doRequest(e,t){return e.indexTransactions(this.query,this.sort,t)}static create(e,t,r){return Ot(Jd,new et([[Bu.QUERY,t],[Bu.SORT,r]],e))}};h([J(Ue),u("design:type",Ue)],Mu.prototype,"helper",void 0);Mu=Jd=h([wo(),Oe(0,J(Bu.QUERY)),Oe(1,J(Bu.SORT,{optional:!0})),u("design:paramtypes",[Object,Object])],Mu);const WE={TINDEXES:Symbol("tIndexes")};let vu=Yd=class extends sh{constructor(e){super(),this.tIndexes=e}_doRequest(e,t){return e.downloadTransactions(this.tIndexes,t)}static create(e,t){return Ot(Yd,new et([[WE.TINDEXES,t]],e))}};h([J(Ue),u("design:type",Ue)],vu.prototype,"helper",void 0);vu=Yd=h([wo(),Oe(0,J(WE.TINDEXES)),u("design:paramtypes",[Array])],vu);const qE={QUERY:Symbol("query")};let Lu=Qd=class extends sh{constructor(e){super(),this.query=e}_doRequest(e,t){return e.queryBlock(this.query,t)}getTimeoutExceptionInfo(){return["[TIMEOUT]: queryBlock({query}).",{query:this.query}]}_getFinishInfo(){return{message:"finish queryBlock from other chainChannel"}}static create(e,t,r){return Ot(Qd,new et([[qE.QUERY,t]],e))}};h([J(Ue),u("design:type",Ue)],Lu.prototype,"helper",void 0);Lu=Qd=h([wo(),Oe(0,J(qE.QUERY)),u("design:paramtypes",[Object])],Lu);const XE={QUERY:Symbol("query")};let qd=Wd=class extends sh{constructor(e){super(),this.query=e}_doRequest(e,t){return e.queryTransactionInBlocks(this.query,t)}getTimeoutExceptionInfo(){return["queryTransactionInBlocks({query} / {sort}) timeout.",{query:JSON.stringify(this.query)}]}_getFinishInfo(){return{message:"finish queryTransactionInBlocks from other chainChannel"}}static create(e,t,r){return Ot(Wd,new et([[XE.QUERY,t]],e))}};h([J(Ue),u("design:type",Ue)],qd.prototype,"helper",void 0);qd=Wd=h([wo(),Oe(0,J(XE.QUERY)),u("design:paramtypes",[Object])],qd);const{error:Kf}=re("channel","IntSet");class r0{constructor(e){this._src=e,this._end=1/0,this._maybeEnd=-1/0,this._srcIte=this._src[Symbol.iterator](),this._rl=[]}setEnd(e){this._end=e,this._maybeEnd=e}_previewSrcNext(){const e=this._cachedSrcNext||(this._cachedSrcNext=this._srcIte.next());if(e.done===!1)return this._maybeEnd=e.value;this._end=this._maybeEnd}_srcNext(){const e=this._previewSrcNext();return e!==void 0&&(this._cachedSrcNext=void 0),e}getSerialRangeSet(e){let t=-1/0,r=0;const n=this._rl[Symbol.iterator]();let s=n.next();if(s.done===!1){if(t=s.value,r=1,r>=e)return{start:t,length:r};delete this._rl[t];do{if(s=n.next(),s.done)break;const o=s.value;if(o-r===t){if(delete this._rl[o],++r,r>=e)return{start:t,length:r}}else return{start:t,length:r}}while(!0)}if(t===-1/0){const o=this._srcNext();if(o===void 0)return;if(t=o,r=1,r>=e)return{start:t,length:r}}do{const o=this._previewSrcNext();if(o===void 0)return{start:t,length:r};if(o-r===t){if(this._cachedSrcNext=void 0,++r,r>=e)break}else break}while(!0);return{start:t,length:r}}getRangeSet(e){let t=0;const r=[];do{const n=this.getSerialRangeSet(e);if(n===void 0||(r[r.length]=n,t+=n.length,t>=e))break}while(!0);return r}recycle(e){if(Number.isInteger(e)===!1){Kf("num:%o is not an integer",e);return}const t=this._previewSrcNext();if(t!==void 0){if(e>t){Kf("num:%d large then the next integer:%d",e,this._end);return}}else if(e>this._end){Kf("num:%d large then the end:%d",e,this._end);return}this.recycleUnSafe(e)}recycleUnSafe(e){this._rl[e]=e}recycleManyUnsafe(e){for(const t of e)this._rl[t]=t}}const{AbortException:Nh,InterruptedException:n0,error:Jo,success:LA,info:s0,warn:Tc,log:DA,TimeOutException:xc,IdempotentException:Yo}=re("channel","chainChannelGroup"),Bc={GROUP_NAME:Symbol("groupName"),CHANNEL_LIST:Symbol("channelList"),OPTIONS:Symbol("options")};let $t=class extends QE{constructor(e,t="",r){super(),this.groupName=t,this._ccBlobSupportAlgorithms=wt.from({creater:n=>{const s=Tn.from({afterDelete:()=>{s.size===0&&this._ccBlobSupportAlgorithms.delete(n)}});return s}}),this._initBlobSupportAlgorithmsBinding=!1,this.chainChannelSet=new Set,this.options={},this._parallelTasksMap=new Map,this._workCountWM=new ps(n=>0),this._DAWCLWM=new WeakMap,this._maybeHeight=1,this._lastConsensusVersion=1,r&&Object.assign(this.options,r);for(const n of e)this.addChainChannel_(n,this.options)}get canQueryTransactions(){for(const e of this.chainChannelSet)if(e.canQueryTransactions)return!0;return!1}get canIndexTransaction(){for(const e of this.chainChannelSet)if(e.canIndexTransactions)return!0;return!1}get canDownloadTransaction(){for(const e of this.chainChannelSet)if(e.canDownloadTransactions)return!0;return!1}get blobSupportAlgorithms(){var e;const t=this._ccBlobSupportAlgorithms;if(this._initBlobSupportAlgorithmsBinding===!1){this._initBlobSupportAlgorithmsBinding=!0;for(const r of this.chainChannelSet)for(const n of r.blobSupportAlgorithms)t.forceGet(n).add(r);this._chainChannelEvents.on("addChainChannel",r=>{for(const n of r.blobSupportAlgorithms)t.forceGet(n).add(r);this._blobSupportAlgorithms=void 0}),this._chainChannelEvents.on("removeChainChannel",r=>{for(const n of r.blobSupportAlgorithms)t.forceGet(n).delete(r);this._blobSupportAlgorithms=void 0})}return(e=this._blobSupportAlgorithms)!==null&&e!==void 0?e:this._blobSupportAlgorithms=[...t.keys()]}get canQueryBlock(){for(const e of this.chainChannelSet)if(e.canQueryBlock)return!0;return!1}get canBroadcastTransaction(){for(const e of this.chainChannelSet)if(e.canBroadcastTransaction)return!0;return!1}get canBroadcastBlock(){for(const e of this.chainChannelSet)if(e.canBroadcastBlock)return!0;return!1}get limitQueryTransactions(){let e=0;for(const t of this.chainChannelSet){const{limitQueryTransactions:r}=t;r>e&&(e=r)}return e}get limitIndexTransactions(){let e=0;for(const t of this.chainChannelSet){const{limitIndexTransactions:r}=t;r>e&&(e=r)}return e}get limitDownloadTransactions(){let e=0;for(const t of this.chainChannelSet){const{limitDownloadTransactions:r}=t;r>e&&(e=r)}return e}getApiMaybeQueueTime(e){let t=1/0;for(let r of this.chainChannelSet)if(t=Math.min(r.getApiMaybeQueueTime(e),t),t===0)break;return t}get canQueryTindex(){for(const e of this.chainChannelSet)if(e.canQueryTindex)return!0;return!1}get canGetTransactionInBlock(){for(const e of this.chainChannelSet)if(e.canGetTransactionInBlock)return!0;return!1}bfOnInit(){let e=this._maybeHeight;for(const t of this.chainChannelSet)e=Math.max(t.maybeHeight,e);this._tryChangeMaybeHeight(e)}bfAfterInit(){this._initMaybeHeightWatcher()}get size(){return this.chainChannelSet.size}forEach(e){let t=0;for(const r of this.chainChannelSet)e(r,t++)}include(e){return this.chainChannelSet.has(e)}[Symbol.iterator](){return this.chainChannelSet[Symbol.iterator]()}$requestParallelTask(e,t={}){let r=this._parallelTasksMap.get(e);if(r)return r;const{channelFirewall:n=()=>!0,abortWhenNoChainChannel:s}=t,o=this._workCountWM,{taskResponseCmd:a}=t,p=a!==void 0?(R,F)=>R.delay*o.forceGet(R)+R.getApiMaybeQueueTime(a)-(F.delay*o.forceGet(F)+F.getApiMaybeQueueTime(a)):(R,F)=>R.delay*o.forceGet(R)-F.delay*o.forceGet(F),l=new Set([...this.chainChannelSet.values()].filter(n).sort(p)),f=new Set,g=new t0,d=new Set,y=()=>l.size>0,m=(R={})=>{if(s&&this.size===0)throw new Nh(c.TASK_ABORT,{task_id:e});const F=R==null?void 0:R.filter;for(const K of l)if(F===void 0||F(K))return K;const z=g.enqueue(F);return b(),z.promise},E=R=>(o.set(R,o.forceGet(R)-1),f.delete(R)?(C(R),!0):!1),T=R=>(o.set(R,o.forceGet(R)+1),f.has(R)?!1:(f.add(R),l.delete(R),b(),!0)),w=async(R={},F)=>{const{autoFreeChainChannel:z=!0}=R,K=await m(R);T(K);const B={chainChannel:K,autoFreeChainChannel:z};try{return await F(B)}finally{B.autoFreeChainChannel&&E(K)}},b=()=>{const R=5e3-Math.min(g.size/f.size,1)*4e3;if(f.size>d.size){const F=Ps(R,()=>{d.delete(F);for(const z of l)if(g.dequeue(z)!==void 0)return;if(f.size!==0){let z=Math.floor(f.size*Math.random());for(const K of f)z--<=0&&E(K)}});d.add(F)}},C=R=>{if(n(R)!==!0)return;g.dequeue(R)===void 0&&l.add(R)};this.onAddChainChannel(C);const N=R=>{f.delete(R),l.delete(R),o.delete(R),b()};return this.onRemoveChainChannel(N),r={freeChainChannels:l,busyChainChannels:f,chainChannelWaiterQueue:g,tiTasks:d,onDestroy:()=>{l.clear(),f.clear();for(const R of d)VE(R);d.clear(),this.offAddChainChannel(C),this.offRemoveChainChannel(N)},helpers:{hasFreeChainChannel:y,getFreeChainChannel:m,freeChainChannel:E,busyChainChannel:T,requestChainChannel:w},refs:new Set},this._parallelTasksMap.set(e,r),r}$startParallelTask(e,t={}){return this.$requestParallelTask(e,t).helpers}$releaseParallelTask(e){const t=this._parallelTasksMap.get(e);if(!t)return!1;this._parallelTasksMap.delete(e),t.onDestroy()}async wrapParallelTask(e,t="unknowParallelTask",r={}){const n=this.$requestParallelTask(t,r);n.refs.add(e);try{return await e(n.helpers)}finally{n.refs.delete(e),n.refs.size===0&&this.$releaseParallelTask(t)}}wrapCbParallelTask(e,t="unknowParallelTask",r={}){const n=this.$requestParallelTask(t,r);return n.refs.add(e),e(n.helpers,()=>{n.refs.delete(e),n.refs.size===0&&this.$releaseParallelTask(t)})}async*wrapAgParallelTask(e,t="unknowParallelTask",r={}){const n=this.$requestParallelTask(t,r);n.refs.add(e);try{return yield*e(n.helpers)}finally{n.refs.delete(e),n.refs.size===0&&this.$releaseParallelTask(t)}}queryTransactionsVerbose(e,t,r,n){const{offset:s,limit:o,...a}=e,p=a.signature?1:o||1/0,l=`Group(${this.groupName}) queryTransactions-${Date.now()+Math.random()}`,f=(r==null?void 0:r.channelFilter)||(()=>!0),{requestChainChannel:g}=this.$startParallelTask(l,{channelFirewall:N=>N.canQueryTransactions&&f(N),abortWhenNoChainChannel:r==null?void 0:r.abortWhenNoChainChannel,taskResponseCmd:Te.QUERY_TRANSACTION_RETURN});let d=()=>!0;{const N=e.maxHeight;typeof N=="number"&&(d=O=>O.maybeHeight>=N)}const y=r&&this.helper.parserAborterOptions(r,{channelGroup:this}),m=n||new Pr,E=y&&y.promise;if(E){Ji(E,void 0,m.reject);const N=(O,R)=>(Ph(E,void 0,m.reject),R());m.on("done",N),m.on("error",N)}const T={timeout:(N,O)=>`peer(${O.address}) queryTransactions(<offset:${N.data.offset},limit:${N.data.limit}>) timeout.
[query:]${JSON.stringify(N.requester.query)}
[sort:]${JSON.stringify(N.requester.sort)}`},w=wt.from({transformKey:N=>`${N.offset}-${N.limit}`,creater:N=>{const O=Pu.create(this.moduleMap,{...a,...N},t);return{requester:O,options:new Mc(T,N,O,this.helper.getChainChannelTimeout,y)}}}),C=(r==null?void 0:r.queryUnitLength)||(o?Math.ceil(o/(this.chainChannelSet.size||1)):100);return(async()=>{let N=Promise.resolve(),O=p+s;const R=D=>{O=D,z()};let F;const z=()=>{F&&(F.resolve(),F=void 0)};let K=-1;m.on("requestAll",(D,W)=>(z(),K=1/0,W()));let B=0;m.on("requestItem",(D,W)=>{const ae=B+s;return ae>K&&(K=ae,z()),W()});const M=(D,W)=>{let ae=0;return N=N.then(async()=>{do if(await g({autoFreeChainChannel:!1,filter:d},async Ee=>{var Ae,P;m.push({type:"success",value:`(${Ee.chainChannel.address})`});const ee=Math.min(Ee.chainChannel.limitQueryTransactions,W),{requester:ye,options:De}=w.forceGet({offset:D,limit:ee});V.resolve(ee);try{const ce=Date.now(),Q=await ye.addChainChannel(Ee.chainChannel,De),oe=Date.now()-ce;if(Q.status===Re.success)return m.push({type:"success",value:`(${Ee.chainChannel.address}) +${oe}ms`}),Q.transactions.forEach((le,pe)=>{const Ce=D-s+pe;m.canPush(m.list.length-B+Ce)&&(B+=1,m.push({type:"result",value:le}))}),Q.transactions.length<ee?(R(D),Ee.autoFreeChainChannel=!0,!0):(ye.finish(),Ee.autoFreeChainChannel=!0,!0);if(Q.status===Re.busy)return m.push({type:"info",value:`(${Ee.chainChannel.address}) +${oe}ms`}),ye.removeChainChannelByResult(Q),ae++,!1;if(Q.status===Re.error)throw m.push({type:"warn",value:`(${Ee.chainChannel.address}): ${(Ae=Q.error)===null||Ae===void 0?void 0:Ae.message} +${oe}ms`}),ye.removeChainChannelByResult(Q),Q.error;if(Q.status===Re.idempotentError){m.push({type:"warn",value:`(${Ee.chainChannel.address}): ${(P=Q.error)===null||P===void 0?void 0:P.message} +${oe}ms`}),ye.removeChainChannelByResult(Q);const le=Q.error;throw new Yo(le.message,le.detail,le.CODE)}Tf(Q.status)}catch(ce){if(ye.removeChainChannelByResult(ce),Nh.is(ce)||m.is_done)throw m.push({type:"info",value:""}),ce;return xc.is(ce)||(Yo.is(ce)?Tc("",ce.message):Jo(ce,"[GROUP]:",this.groupName,"[QUERY]:",e,"[OFFSET]:",D,"[TIMES]:",ae)),m.push({type:"info",value:`${ae}`}),ae++>100}}))break;while(!0)},ue=>V.reject(ue)),V.promise};let V;const U=Math.min(C,p);for(let D=0,W=U;D<p;D+=W){const ae=D+s;for(;ae>K&&!(ae>=O);)F||(F=new Qt,await F.promise);if(ae>=O||(V=new Qt,W=await M(ae,U),D+W>p&&(W=p-D,W<=0)))break}await N,await m.done()})().catch(m.reject).finally(()=>{this.$releaseParallelTask(l)}),m}queryTransactions(e,t,r,n=new Pr){return Pf(this.queryTransactionsVerbose(e,t,r),n,s=>s.type==="result"?{filter:!0,map:s.value}:{filter:!1}),n}indexTransactionsVerbose(e,t,r,n){const{offset:s,limit:o,...a}=e,p=a.signature?1:o||1/0,l=`Group(${this.groupName}) indexTransactions-${Date.now()+Math.random()}`,f=(r==null?void 0:r.channelFilter)||(()=>!0),{requestChainChannel:g}=this.$startParallelTask(l,{channelFirewall:N=>N.canIndexTransactions&&f(N),abortWhenNoChainChannel:r==null?void 0:r.abortWhenNoChainChannel,taskResponseCmd:Te.INDEX_TRANSACTION_RETURN});let d;{const N=e.maxHeight;typeof N=="number"&&(d=O=>O.maybeHeight>=N)}const y=r&&this.helper.parserAborterOptions(r,{channelGroup:this}),m=n||new Pr,E=y&&y.promise;if(E){Ji(E,void 0,m.reject);const N=(O,R)=>(Ph(E,void 0,m.reject),R());m.on("done",N),m.on("error",N)}const T={timeout:(N,O)=>`peer(${O.address}) indexTransactions(<offset:${N.data.offset},limit:${N.data.limit}>) timeout.
[query:]${JSON.stringify(N.requester.query)}
[sort:]${JSON.stringify(N.requester.sort)}`},w=wt.from({transformKey:N=>`${N.offset}-${N.limit}`,creater:N=>{const O=Mu.create(this.moduleMap,{...a,...N},t);return{requester:O,options:new Mc(T,N,O,this.helper.getChainChannelTimeout,y)}}}),C=(r==null?void 0:r.queryUnitLength)||(o?Math.ceil(o/(this.chainChannelSet.size||1)):100);return(async()=>{let N=Promise.resolve(),O=p+s;const R=D=>{O=D,z()};let F;const z=()=>{F&&(F.resolve(),F=void 0)};let K=-1;m.on("requestAll",(D,W)=>(z(),K=1/0,W()));let B=0;m.on("requestItem",(D,W)=>{const ae=B+s;return ae>K&&(K=ae,z()),W()});const M=(D,W)=>{let ae=0;return N=N.then(async()=>{do if(await g({autoFreeChainChannel:!1,filter:d},async Ee=>{var Ae,P;m.push({type:"success",value:`(${Ee.chainChannel.address})`});const ee=Math.min(Ee.chainChannel.limitQueryTransactions,W),{requester:ye,options:De}=w.forceGet({offset:D,limit:ee});V.resolve(ee);try{const ce=Date.now(),Q=await ye.addChainChannel(Ee.chainChannel,De),oe=Date.now()-ce;if(Q.status===Re.success)return m.push({type:"success",value:`(${Ee.chainChannel.address}) +${oe}ms`}),Q.tIndexes.forEach((le,pe)=>{const Ce=D-s+pe;m.canPush(m.list.length-B+Ce)&&(B+=1,m.push({type:"result",value:le}))}),Q.tIndexes.length<ee?(R(D),Ee.autoFreeChainChannel=!0,!0):(ye.finish(),Ee.autoFreeChainChannel=!0,!0);if(Q.status===Re.busy)return m.push({type:"info",value:`(${Ee.chainChannel.address}) +${oe}ms`}),ye.removeChainChannelByResult(Q),ae++,!1;if(Q.status===Re.error)throw m.push({type:"warn",value:`(${Ee.chainChannel.address}): ${(Ae=Q.error)===null||Ae===void 0?void 0:Ae.message} +${oe}ms`}),ye.removeChainChannelByResult(Q),Q.error;if(Q.status===Re.idempotentError){m.push({type:"warn",value:`(${Ee.chainChannel.address}): ${(P=Q.error)===null||P===void 0?void 0:P.message} +${oe}ms`}),ye.removeChainChannelByResult(Q);const le=Q.error;throw new Yo(le.message,le.detail,le.CODE)}Tf(Q.status)}catch(ce){if(ye.removeChainChannelByResult(ce),Nh.is(ce)||m.is_done)throw m.push({type:"info",value:""}),ce;return xc.is(ce)||(Yo.is(ce)?Tc("",ce.message):Jo(ce,"[GROUP]:",this.groupName,"[QUERY]:",e,"[OFFSET]:",D,"[TIMES]:",ae)),m.push({type:"info",value:`${ae}`}),ae++>100}}))break;while(!0)},ue=>V.reject(ue)),V.promise};let V;const U=Math.min(C,p);for(let D=0,W=U;D<p;D+=W){const ae=D+s;for(;ae>K&&!(ae>=O);)F||(F=new Qt,await F.promise);if(ae>=O||(V=new Qt,W=await M(ae,U),D+W>p&&(W=p-D,W<=0)))break}await N,await m.done()})().catch(m.reject).finally(()=>{this.$releaseParallelTask(l)}),m}indexTransactions(e,t,r,n=new Pr){return Pf(this.indexTransactionsVerbose(e,t,r),n,s=>s.type==="result"?{filter:!0,map:s.value}:{filter:!1}),n}_formatHiList(e){const t=[],r=new wt(p=>t.length+1);for(const p of e.slice().sort((l,f)=>l.height-f.height)){const f=r.forceGet(p.height)+p.tIndex;t[f]=f}const n=[];t.forEach(p=>n[n.length]=p);const s=new r0(n),o=[];for(const p of r)o[o.length]={height:p[0],baseIndex:p[1]};let a=0;return s.getRangeSet(1/0).map(p=>{const l=o.findIndex(m=>m.baseIndex>p.start,a);a=l===-1?o.length-1:l-1;const f=o[a],g=f.height,d=p.start-f.baseIndex,y=p.length;return{height:g,tIndex:d,length:y}})}downloadTransactionsVerbose(e,t,r){const n=Math.min(Math.ceil((this.limitDownloadTransactions||1)/Math.SQRT2),1),s=new Map,o=(T,w)=>{s.set(`${T}-${w}`,{height:T,tIndex:w})};for(const T of e)if(T.length>1)for(let w=0;w<T.length;++w)o(T.height,T.tIndex+w);else o(T.height,T.tIndex);const a=[...s.values()],p=a.length,l=t&&this.helper.parserAborterOptions(t,{channelGroup:this}),f=r||new Pr,g=`Group(${this.groupName}) downloadTransactions-${Date.now()+Math.random()}`,d=(t==null?void 0:t.channelFilter)||(()=>!0),{requestChainChannel:y}=this.$startParallelTask(g,{channelFirewall:T=>T.canDownloadTransactions&&d(T),abortWhenNoChainChannel:t==null?void 0:t.abortWhenNoChainChannel,taskResponseCmd:Te.DOWNLOAD_TRANSACTION_RETURN}),m={timeout:(T,w)=>`peer(${w.address}) downloadTransactions(<${T.data.map(b=>`${b.height}/${b.tIndex}:${b.length}`).join(",")}) timeout.`},E=wt.from({transformKey:T=>T.map(w=>`${w.height}/${w.tIndex}:${w.length}`).join(","),creater:T=>{const w=vu.create(this.moduleMap,T);return{requester:w,options:new Mc(m,T,w,this.helper.getChainChannelTimeout,l)}}});return(async()=>{let T;const w=()=>{T&&(T.resolve(),T=void 0)};let b=f.requestProcess;f.on("requestAll",(O,R)=>(w(),b=1/0,R())),f.on("requestItem",(O,R)=>(O>=b&&(b=O+1,w()),R()));let C=0;const N=async()=>{do{const O=a.slice(C,C+=n);if(O.length===0)break;const R=this._formatHiList(O),F=O.length,z=O[O.length-1].height;let K=0;for(;!await y({filter:M=>M.maybeHeight>=z},async M=>{var V,U;f.push({type:"success",value:`(${M.chainChannel.address})`});const{requester:D,options:W}=E.forceGet(R);try{const ae=Date.now(),ue=await D.addChainChannel(M.chainChannel,W),Ae=Date.now()-ae;if(ue.status===Re.success){if(f.push({type:"success",value:`(${M.chainChannel.address}) +${Ae}ms`}),ue.transactions.length<F)return D.removeChainChannelByResult(ue),K++,!1;{const P=ue.transactions.map(ee=>({tib:ee,hiIndex:a.findIndex(ye=>ye.height===ee.height&&ye.tIndex===ee.tIndex)})).sort((ee,ye)=>ee.hiIndex-ye.hiIndex);for(const ee of P)f.canPush(f.list.length)&&f.push({type:"result",value:ee.tib});return!0}}else{if(ue.status===Re.busy)return f.push({type:"info",value:`(${M.chainChannel.address}) +${Ae}ms`}),D.removeChainChannelByResult(ue),K++,!1;if(ue.status===Re.error)throw f.push({type:"warn",value:`(${M.chainChannel.address}): ${(V=ue.error)===null||V===void 0?void 0:V.message} +${Ae}ms`}),D.removeChainChannelByResult(ue),ue.error;if(ue.status===Re.idempotentError){f.push({type:"warn",value:`(${M.chainChannel.address}): ${(U=ue.error)===null||U===void 0?void 0:U.message} +${Ae}ms`}),D.removeChainChannelByResult(ue);const P=ue.error;throw new Yo(P.message,P.detail,P.CODE)}}Tf(ue.status)}catch(ae){if(D.removeChainChannelByResult(ae),Nh.is(ae)||f.is_done)throw f.push({type:"info",value:""}),ae;return xc.is(ae)||(Yo.is(ae)?Tc("",ae.message):Jo(ae,"[GROUP]:",this.groupName,"[TINDEXES]:",O,"[TIMES]:",K)),f.push({type:"info",value:`${K}`}),K++>100}}););}while(!0)};for(let O=0;O<p;O+=n){for(;O>=b;)T||(T=new Qt),await T.promise;await N()}await f.done()})().finally(()=>{this.$releaseParallelTask(g)}),f}downloadTransactions(e,t,r=new Pr){return Pf(this.downloadTransactionsVerbose(e,t),r,n=>n.type==="result"?{filter:!0,map:n.value}:{filter:!1}),r}async broadcastTransaction(e,t,r){let n;const s=this.timeHelper.now(),o=[];let a;try{let f=[];if(t&&t.directAddress&&t.directAddress.size>0){const y=t.directAddress;for(const m of this.chainChannelSet.values())y.has(m.address)&&f.push(m)}else f=[...this.chainChannelSet.values()];let g=r&&await r.emit("startBroadcasting",{chainChannelList:f});if(g&&g.break)return[];const d=new _S(t&&t.max_parallel_num);a=t&&this.helper.parserAborterOptions(t,{channelGroup:this});for(const y of f)d.addTaskExecutor(async()=>{const m=n||(n=await y.initBroadcastTransactionArg(e,{timeout:T=>this.helper.getChainChannelTimeout(T.chainChannel),rejected:a==null?void 0:a.promise}));let E;try{const T=-y.calcDiffTimeToTargetTime(this.timeHelper.getTimeByTimestamp(e.timestamp));if(T>0){if(DA("chainChannel(%s) seems in feature. need wait %dms then broadcast.",y.address,T),a&&a.sleepTime>0&&T+y.delay/2>a.sleepTime){DA("chainChannel(%s) need wait too much time, so skip in resultList."),Ps(T,async()=>{try{E={error:!1,result:await y._requestWithBinaryData(...m),chainChannel:y}}catch(w){E={error:!0,result:w,chainChannel:y}}r&&await r.emit("broadcasted",E)});return}await Ps(T)}o.push(E={error:!1,result:await y._requestWithBinaryData(...m),chainChannel:y})}catch(T){o.push(E={error:!0,result:T,chainChannel:y})}r&&(g=await r.emit("broadcasted",E))});for await(const y of d.yieldResults({ignoreError:!0}))if(g&&g.break)break;a==null||a.resolve(void 0)}catch(f){a==null||a.reject(f)}finally{const f=this.timeHelper.now();r&&r.emit("endBroadcast",{duraction:f-s})}let p=0,l=0;return o.forEach(f=>{f.error?l+=1:p+=1}),(p===0&&l>0?Jo:LA)("chainChannelGroup(%s) broadcasted Transaction(%s), successed: %d, fail: %d",this.groupName,this.transactionHelper.getTypeName(e.type),p,l,e.asset),o}async fastBroadcastTransaction(e,t,r){let n,s=[];if(t&&t.directAddress&&t.directAddress.size>0){const f=t.directAddress;for(const g of this.chainChannelSet.values())f.has(g.address)&&s.push(g)}else for(const f of this.chainChannelSet.values())f.canBroadcastTransaction&&s.push(f);let o=r&&await r.emit("startBroadcasting",{chainChannelList:s}),a=0;if(o&&o.break)return a;const p=this.timeHelper.now();for(const f of s)if(!f.isRefusePushNewTransaction){n||(n=await f.initBroadcastTransactionArg(e));try{a++,await f._sendWithBinaryData(n[0],n[1])}catch{}}const l=this.timeHelper.now();return r&&r.emit("endBroadcast",{duraction:l-p}),a}async queryBlock(e,t,r){if(typeof e.height=="number"){const f=e.height;if(![...this.chainChannelSet.values()].find(d=>d.maybeHeight>=f))return}const n=`Group(${this.groupName}) queryBlock-${Date.now()+Math.random()}`,{requestChainChannel:s}=this.$startParallelTask(n,{channelFirewall:t==null?void 0:t.channelFilter,abortWhenNoChainChannel:t==null?void 0:t.abortWhenNoChainChannel,taskResponseCmd:Te.QUERY_BLOCK_RETURN}),o=t&&this.helper.parserAborterOptions(t,{channelGroup:this});let a=!1;const p=o==null?void 0:o.promise;let l;if(p){const f=g=>{Tc(g),a=!0};Ji(p,void 0,f),l=()=>{Ph(p,void 0,f)}}try{const f=Math.min(Math.max(this.size,2),5),g=Lu.create(this.moduleMap,e),d={rejected:p,timeout:T=>this.helper.getChainChannelTimeout(T.chainChannel)};{const T=new wt(w=>new xc(c.QUERY_BLOCK_FROM_PEER_TIMEOUT,{query:JSON.stringify(g.query),peerId:w.address}));d.timeoutException=w=>T.forceGet(w.chainChannel)}let y=0,m,E=()=>!0;{const T=e.height;typeof T=="number"&&(E=w=>w.maybeHeight>=T)}do{if(a)return;await s({autoFreeChainChannel:!1,filter:E},async T=>{var w,b;try{const C=await g.addChainChannel(T.chainChannel,d);if(C.status===Re.error)throw g.removeChainChannelByResult(C),C.error;if(C.status===Re.busy)throw g.removeChainChannelByResult(C),void 0;if(m=(w=C.someBlock)===null||w===void 0?void 0:w.block,!m){const N=(b=g.getChainChannelByResult(C))===null||b===void 0?void 0:b.maybeHeight;if(N&&N>=this.maybeHeight){a=!0;return}}g.finish()}catch(C){if(a)return;if(g.removeChainChannelByResult(C),C&&Tc(C),y+=1,y>=f){a=!0;return}}})}while(!m);return m}finally{this.$releaseParallelTask(n),l&&l()}}findBlock(e,t){return this.queryBlock(e,t)}async broadcastBlock(e,t){let r,n=[];if(t&&t.directAddress&&t.directAddress.size>0){const l=t.directAddress;for(const f of this.chainChannelSet.values())l.has(f.address)&&n.push(f)}else n=[...this.chainChannelSet.values()];const s=t&&this.helper.parserAborterOptions(t,{channelGroup:this}),o=await Promise.all(n.map(l=>(r||(r=l.initBroadcastBlockArg(e,{timeout:f=>this.helper.getChainChannelTimeout(f.chainChannel),rejected:s==null?void 0:s.promise})),{chainChannel:l,result:l._requestWithBinaryData(...r)})));let a=0,p=0;return await Promise.all(o.map(async l=>{try{(await l.result).error?p+=1:a+=1}catch{p+=1}})),(a===0&&p>0?Jo:LA)("chainChannelGroup(%s) broadcasted Block(%d), successed: %d, fail: %d",this.groupName,e.height,a,p),o}async fastBroadcastBlock(e,t){let r,n=[];if(t&&t.directAddress&&t.directAddress.size>0){const o=t.directAddress;for(const a of this.chainChannelSet.values())o.has(a.address)&&n.push(a)}else for(const o of this.chainChannelSet.values())o.canBroadcastBlock&&n.push(o);let s=0;for(const o of n){r||(r=o.initBroadcastBlockArg(e));try{s++,await o._sendWithBinaryData(r[0],r[1])}catch{}}return s}addChainChannel(e,t=this.options){return this.chainChannelSet.has(e)?!1:(this.addChainChannel_(e,t),this._chainChannelEvents.emit("addChainChannel",e),!0)}addChainChannels(e){let t=0,r=0;const n="size"in e?e:[e];for(const s of n)this.addChainChannel(s)?t+=1:r+=1;return{ADD:t,FAIL:r}}removeChainChannel(e){e.offEmit(this._eventFollower);const t=this._DAWCLWM.get(e);return t&&(this._DAWCLWM.delete(e),t()),this.chainChannelSet.delete(e)?(this._chainChannelEvents.emit("removeChainChannel",e),!0):!1}get _chainChannelEvents(){return new wn}get onAddChainChannel(){return this._chainChannelEvents.on.bind(this._chainChannelEvents,"addChainChannel")}get offAddChainChannel(){return this._chainChannelEvents.off.bind(this._chainChannelEvents,"addChainChannel")}get onRemoveChainChannel(){return this._chainChannelEvents.on.bind(this._chainChannelEvents,"removeChainChannel")}get offRemoveChainChannel(){return this._chainChannelEvents.off.bind(this._chainChannelEvents,"removeChainChannel")}_eventFollower(e){return this.emit(e.eventname,e.args)}addChainChannel_(e,t=this.options){if(this.chainChannelSet.add(e),!t.disableAutoRemove){const r=e.onClose(n=>{n0.is(n)?s0("channel auto removed in [%s], reason:",this.groupName,n.message):Jo("channel auto removed in [%s], reason:",this.groupName,n),this.removeChainChannel(e)});this._DAWCLWM.set(e,r)}e.onEmit(this._eventFollower)}destroy(){for(const e of this.chainChannelSet)this.removeChainChannel(e)}get maybeHeight(){return this._maybeHeight}get lastConsensusVersion(){return this._lastConsensusVersion}get onMaybeHeightChanged(){return this._chainChannelEvents.on.bind(this._chainChannelEvents,"maybeHeightChanged")}get offMaybeHeightChanged(){return this._chainChannelEvents.off.bind(this._chainChannelEvents,"maybeHeightChanged")}_tryChangeMaybeHeight(e,t){this._maybeHeight!==e&&(this._maybeHeight=e,this._chainChannelEvents.emit("maybeHeightChanged",e,t))}_tryChangeConsensusVersion(e){this._lastConsensusVersion!==e&&(this._lastConsensusVersion=e,this._chainChannelEvents.emit("consensusVersionChanged",e))}_initMaybeHeightWatcher(){const e=(r,n)=>(r.height>this._maybeHeight&&this._tryChangeMaybeHeight(r.height,r.version),n());let t=this._maybeHeight;for(const r of this.chainChannelSet)t=Math.max(r.maybeHeight,t);this._tryChangeMaybeHeight(t),this._chainChannelEvents.on("addChainChannel",r=>{this._maybeHeight<r.maybeHeight&&this._tryChangeMaybeHeight(r.maybeHeight),this._lastConsensusVersion<r.lastConsensusVersion&&this._tryChangeConsensusVersion(r.lastConsensusVersion),r.on("onNewBlock",e)}),this._chainChannelEvents.on("removeChainChannel",r=>{if(r.off("onNewBlock",e),r.maybeHeight<this._maybeHeight)return;let n=1;for(const s of this.chainChannelSet)if(n=Math.max(s.maybeHeight,n),n>=r.maybeHeight)return;this._tryChangeMaybeHeight(n)})}};h([J(Pe),u("design:type",Pe)],$t.prototype,"baseHelper",void 0);h([J(te),u("design:type",te)],$t.prototype,"config",void 0);h([J(et),u("design:type",et)],$t.prototype,"moduleMap",void 0);h([J(Vt),u("design:type",Vt)],$t.prototype,"timeHelper",void 0);h([J(Ue),u("design:type",Ue)],$t.prototype,"helper",void 0);h([J(me),u("design:type",me)],$t.prototype,"transactionHelper",void 0);h([J(Ci),u("design:type",Ci)],$t.prototype,"blobHelper",void 0);h([$e,u("design:type",Function),u("design:paramtypes",[Object,Object,Object,Object]),u("design:returntype",void 0)],$t.prototype,"queryTransactions",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object,Object,Object,Pr]),u("design:returntype",void 0)],$t.prototype,"indexTransactionsVerbose",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object,Object,Object,Object]),u("design:returntype",void 0)],$t.prototype,"indexTransactions",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object,Object,Pr]),u("design:returntype",void 0)],$t.prototype,"downloadTransactionsVerbose",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object,Object,Object]),u("design:returntype",void 0)],$t.prototype,"downloadTransactions",null);h([ne,u("design:type",Object),u("design:paramtypes",[])],$t.prototype,"_chainChannelEvents",null);h([ne,u("design:type",Function),u("design:paramtypes",[])],$t.prototype,"onAddChainChannel",null);h([ne,u("design:type",Function),u("design:paramtypes",[])],$t.prototype,"onRemoveChainChannel",null);h([ne,u("design:type",Function),u("design:paramtypes",[])],$t.prototype,"offRemoveChainChannel",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],$t.prototype,"_eventFollower",null);h([ne,u("design:type",Function),u("design:paramtypes",[])],$t.prototype,"onMaybeHeightChanged",null);h([ne,u("design:type",Function),u("design:paramtypes",[])],$t.prototype,"offMaybeHeightChanged",null);$t=h([wo(),Oe(0,J(Bc.CHANNEL_LIST)),Oe(1,J(Bc.GROUP_NAME,{optional:!0})),Oe(2,J(Bc.OPTIONS,{optional:!0})),u("design:paramtypes",[Object,Object,Object])],$t);class Mc{constructor(e,t,r,n,s){this.exmBuilder=e,this.data=t,this.requester=r,this.getChainChannelTimeout=n,this.resultPo=s}get _exm(){return new wt(e=>new xc(this.exmBuilder.timeout(this,e)))}timeoutException(e){return this._exm.forceGet(e.chainChannel)}timeout(e){return this.getChainChannelTimeout(e.chainChannel)}get rejected(){var e;return(e=this.resultPo)===null||e===void 0?void 0:e.promise}}h([ne,u("design:type",Object),u("design:paramtypes",[])],Mc.prototype,"_exm",null);h([$e,u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],Mc.prototype,"timeoutException",null);let Xd=class{constructor(e){this.moduleMap=e,this._groupNameAcc=1}registryChannel(e,t=Js,r=this.moduleMap,n=1e3){return Ot(t,new et([[Hh.ENDPOINT,e],[Hh.REFUSETIME,n]],r))}groupChannel(e,t=`G${this._groupNameAcc++}`,r=$t){const{moduleMap:n}=this;return Ot(r,new et([[Bc.CHANNEL_LIST,e],[Bc.GROUP_NAME,t]],n))}};Xd=h([j(),u("design:paramtypes",[et])],Xd);const Qe=Uint8Array,Gf=Uint16Array,Du=Int32Array,ih=Float64Array;function ku(i,e,t,r){const n=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,s=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,o=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,a=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,p=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,l=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,f=e[0]&255|(e[1]&255)<<8|(e[2]&255)<<16|(e[3]&255)<<24,g=e[4]&255|(e[5]&255)<<8|(e[6]&255)<<16|(e[7]&255)<<24,d=e[8]&255|(e[9]&255)<<8|(e[10]&255)<<16|(e[11]&255)<<24,y=e[12]&255|(e[13]&255)<<8|(e[14]&255)<<16|(e[15]&255)<<24,m=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,E=t[16]&255|(t[17]&255)<<8|(t[18]&255)<<16|(t[19]&255)<<24,T=t[20]&255|(t[21]&255)<<8|(t[22]&255)<<16|(t[23]&255)<<24,w=t[24]&255|(t[25]&255)<<8|(t[26]&255)<<16|(t[27]&255)<<24,b=t[28]&255|(t[29]&255)<<8|(t[30]&255)<<16|(t[31]&255)<<24,C=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24;let N=n,O=s,R=o,F=a,z=p,K=l,B=f,M=g,V=d,U=y,D=m,W=E,ae=T,ue=w,Ee=b,Ae=C,P;for(let ee=0;ee<20;ee+=2)P=N+ae|0,z^=P<<7|P>>>32-7,P=z+N|0,V^=P<<9|P>>>32-9,P=V+z|0,ae^=P<<13|P>>>32-13,P=ae+V|0,N^=P<<18|P>>>32-18,P=K+O|0,U^=P<<7|P>>>32-7,P=U+K|0,ue^=P<<9|P>>>32-9,P=ue+U|0,O^=P<<13|P>>>32-13,P=O+ue|0,K^=P<<18|P>>>32-18,P=D+B|0,Ee^=P<<7|P>>>32-7,P=Ee+D|0,R^=P<<9|P>>>32-9,P=R+Ee|0,B^=P<<13|P>>>32-13,P=B+R|0,D^=P<<18|P>>>32-18,P=Ae+W|0,F^=P<<7|P>>>32-7,P=F+Ae|0,M^=P<<9|P>>>32-9,P=M+F|0,W^=P<<13|P>>>32-13,P=W+M|0,Ae^=P<<18|P>>>32-18,P=N+F|0,O^=P<<7|P>>>32-7,P=O+N|0,R^=P<<9|P>>>32-9,P=R+O|0,F^=P<<13|P>>>32-13,P=F+R|0,N^=P<<18|P>>>32-18,P=K+z|0,B^=P<<7|P>>>32-7,P=B+K|0,M^=P<<9|P>>>32-9,P=M+B|0,z^=P<<13|P>>>32-13,P=z+M|0,K^=P<<18|P>>>32-18,P=D+U|0,W^=P<<7|P>>>32-7,P=W+D|0,V^=P<<9|P>>>32-9,P=V+W|0,U^=P<<13|P>>>32-13,P=U+V|0,D^=P<<18|P>>>32-18,P=Ae+Ee|0,ae^=P<<7|P>>>32-7,P=ae+Ae|0,ue^=P<<9|P>>>32-9,P=ue+ae|0,Ee^=P<<13|P>>>32-13,P=Ee+ue|0,Ae^=P<<18|P>>>32-18;N=N+n|0,O=O+s|0,R=R+o|0,F=F+a|0,z=z+p|0,K=K+l|0,B=B+f|0,M=M+g|0,V=V+d|0,U=U+y|0,D=D+m|0,W=W+E|0,ae=ae+T|0,ue=ue+w|0,Ee=Ee+b|0,Ae=Ae+C|0,i[0]=N>>>0&255,i[1]=N>>>8&255,i[2]=N>>>16&255,i[3]=N>>>24&255,i[4]=O>>>0&255,i[5]=O>>>8&255,i[6]=O>>>16&255,i[7]=O>>>24&255,i[8]=R>>>0&255,i[9]=R>>>8&255,i[10]=R>>>16&255,i[11]=R>>>24&255,i[12]=F>>>0&255,i[13]=F>>>8&255,i[14]=F>>>16&255,i[15]=F>>>24&255,i[16]=z>>>0&255,i[17]=z>>>8&255,i[18]=z>>>16&255,i[19]=z>>>24&255,i[20]=K>>>0&255,i[21]=K>>>8&255,i[22]=K>>>16&255,i[23]=K>>>24&255,i[24]=B>>>0&255,i[25]=B>>>8&255,i[26]=B>>>16&255,i[27]=B>>>24&255,i[28]=M>>>0&255,i[29]=M>>>8&255,i[30]=M>>>16&255,i[31]=M>>>24&255,i[32]=V>>>0&255,i[33]=V>>>8&255,i[34]=V>>>16&255,i[35]=V>>>24&255,i[36]=U>>>0&255,i[37]=U>>>8&255,i[38]=U>>>16&255,i[39]=U>>>24&255,i[40]=D>>>0&255,i[41]=D>>>8&255,i[42]=D>>>16&255,i[43]=D>>>24&255,i[44]=W>>>0&255,i[45]=W>>>8&255,i[46]=W>>>16&255,i[47]=W>>>24&255,i[48]=ae>>>0&255,i[49]=ae>>>8&255,i[50]=ae>>>16&255,i[51]=ae>>>24&255,i[52]=ue>>>0&255,i[53]=ue>>>8&255,i[54]=ue>>>16&255,i[55]=ue>>>24&255,i[56]=Ee>>>0&255,i[57]=Ee>>>8&255,i[58]=Ee>>>16&255,i[59]=Ee>>>24&255,i[60]=Ae>>>0&255,i[61]=Ae>>>8&255,i[62]=Ae>>>16&255,i[63]=Ae>>>24&255}function km(i,e,t,r){const n=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,s=t[0]&255|(t[1]&255)<<8|(t[2]&255)<<16|(t[3]&255)<<24,o=t[4]&255|(t[5]&255)<<8|(t[6]&255)<<16|(t[7]&255)<<24,a=t[8]&255|(t[9]&255)<<8|(t[10]&255)<<16|(t[11]&255)<<24,p=t[12]&255|(t[13]&255)<<8|(t[14]&255)<<16|(t[15]&255)<<24,l=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,f=e[0]&255|(e[1]&255)<<8|(e[2]&255)<<16|(e[3]&255)<<24,g=e[4]&255|(e[5]&255)<<8|(e[6]&255)<<16|(e[7]&255)<<24,d=e[8]&255|(e[9]&255)<<8|(e[10]&255)<<16|(e[11]&255)<<24,y=e[12]&255|(e[13]&255)<<8|(e[14]&255)<<16|(e[15]&255)<<24,m=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,E=t[16]&255|(t[17]&255)<<8|(t[18]&255)<<16|(t[19]&255)<<24,T=t[20]&255|(t[21]&255)<<8|(t[22]&255)<<16|(t[23]&255)<<24,w=t[24]&255|(t[25]&255)<<8|(t[26]&255)<<16|(t[27]&255)<<24,b=t[28]&255|(t[29]&255)<<8|(t[30]&255)<<16|(t[31]&255)<<24,C=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24;let N=n,O=s,R=o,F=a,z=p,K=l,B=f,M=g,V=d,U=y,D=m,W=E,ae=T,ue=w,Ee=b,Ae=C,P;for(let ee=0;ee<20;ee+=2)P=N+ae|0,z^=P<<7|P>>>32-7,P=z+N|0,V^=P<<9|P>>>32-9,P=V+z|0,ae^=P<<13|P>>>32-13,P=ae+V|0,N^=P<<18|P>>>32-18,P=K+O|0,U^=P<<7|P>>>32-7,P=U+K|0,ue^=P<<9|P>>>32-9,P=ue+U|0,O^=P<<13|P>>>32-13,P=O+ue|0,K^=P<<18|P>>>32-18,P=D+B|0,Ee^=P<<7|P>>>32-7,P=Ee+D|0,R^=P<<9|P>>>32-9,P=R+Ee|0,B^=P<<13|P>>>32-13,P=B+R|0,D^=P<<18|P>>>32-18,P=Ae+W|0,F^=P<<7|P>>>32-7,P=F+Ae|0,M^=P<<9|P>>>32-9,P=M+F|0,W^=P<<13|P>>>32-13,P=W+M|0,Ae^=P<<18|P>>>32-18,P=N+F|0,O^=P<<7|P>>>32-7,P=O+N|0,R^=P<<9|P>>>32-9,P=R+O|0,F^=P<<13|P>>>32-13,P=F+R|0,N^=P<<18|P>>>32-18,P=K+z|0,B^=P<<7|P>>>32-7,P=B+K|0,M^=P<<9|P>>>32-9,P=M+B|0,z^=P<<13|P>>>32-13,P=z+M|0,K^=P<<18|P>>>32-18,P=D+U|0,W^=P<<7|P>>>32-7,P=W+D|0,V^=P<<9|P>>>32-9,P=V+W|0,U^=P<<13|P>>>32-13,P=U+V|0,D^=P<<18|P>>>32-18,P=Ae+Ee|0,ae^=P<<7|P>>>32-7,P=ae+Ae|0,ue^=P<<9|P>>>32-9,P=ue+ae|0,Ee^=P<<13|P>>>32-13,P=Ee+ue|0,Ae^=P<<18|P>>>32-18;i[0]=N>>>0&255,i[1]=N>>>8&255,i[2]=N>>>16&255,i[3]=N>>>24&255,i[4]=K>>>0&255,i[5]=K>>>8&255,i[6]=K>>>16&255,i[7]=K>>>24&255,i[8]=D>>>0&255,i[9]=D>>>8&255,i[10]=D>>>16&255,i[11]=D>>>24&255,i[12]=Ae>>>0&255,i[13]=Ae>>>8&255,i[14]=Ae>>>16&255,i[15]=Ae>>>24&255,i[16]=B>>>0&255,i[17]=B>>>8&255,i[18]=B>>>16&255,i[19]=B>>>24&255,i[20]=M>>>0&255,i[21]=M>>>8&255,i[22]=M>>>16&255,i[23]=M>>>24&255,i[24]=V>>>0&255,i[25]=V>>>8&255,i[26]=V>>>16&255,i[27]=V>>>24&255,i[28]=U>>>0&255,i[29]=U>>>8&255,i[30]=U>>>16&255,i[31]=U>>>24&255}const lo=new Qe([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function i0(i,e,t,r,n,s,o){const a=new Qe(16),p=new Qe(64);let l,f;for(f=0;f<16;f++)a[f]=0;for(f=0;f<8;f++)a[f]=s[f];for(;n>=64;){for(ku(p,a,o,lo),f=0;f<64;f++)i[e+f]=t[r+f]^p[f];for(l=1,f=8;f<16;f++)l=l+(a[f]&255)|0,a[f]=l&255,l>>>=8;n-=64,e+=64,r+=64}if(n>0)for(ku(p,a,o,lo),f=0;f<n;f++)i[e+f]=t[r+f]^p[f];return 0}function o0(i,e,t,r,n){const s=new Qe(16),o=new Qe(64);let a,p;for(p=0;p<16;p++)s[p]=0;for(p=0;p<8;p++)s[p]=r[p];for(;t>=64;){for(ku(o,s,n,lo),p=0;p<64;p++)i[e+p]=o[p];for(a=1,p=8;p<16;p++)a=a+(s[p]&255)|0,s[p]=a&255,a>>>=8;t-=64,e+=64}if(t>0)for(ku(o,s,n,lo),p=0;p<t;p++)i[e+p]=o[p];return 0}function a0(i,e,t,r,n){const s=new Qe(32),o=new Qe(8);km(s,r,n,lo);for(let a=0;a<8;a++)o[a]=r[a+16];return o0(i,e,t,o,s)}function ZE(i,e,t,r,n,s,o){const a=new Qe(32),p=new Qe(8);km(a,s,o,lo);for(let l=0;l<8;l++)p[l]=s[l+16];return i0(i,e,t,r,n,p,a)}function c0(i){const e=new Gf(10),t=new Gf(8);let r,n,s,o,a,p,l,f;return r=i[0]&255|(i[1]&255)<<8,e[0]=r&8191,n=i[2]&255|(i[3]&255)<<8,e[1]=(r>>>13|n<<3)&8191,s=i[4]&255|(i[5]&255)<<8,e[2]=(n>>>10|s<<6)&7939,o=i[6]&255|(i[7]&255)<<8,e[3]=(s>>>7|o<<9)&8191,a=i[8]&255|(i[9]&255)<<8,e[4]=(o>>>4|a<<12)&255,e[5]=a>>>1&8190,p=i[10]&255|(i[11]&255)<<8,e[6]=(a>>>14|p<<2)&8191,l=i[12]&255|(i[13]&255)<<8,e[7]=(p>>>11|l<<5)&8065,f=i[14]&255|(i[15]&255)<<8,e[8]=(l>>>8|f<<8)&8191,e[9]=f>>>5&127,t[0]=i[16]&255|(i[17]&255)<<8,t[1]=i[18]&255|(i[19]&255)<<8,t[2]=i[20]&255|(i[21]&255)<<8,t[3]=i[22]&255|(i[23]&255)<<8,t[4]=i[24]&255|(i[25]&255)<<8,t[5]=i[26]&255|(i[27]&255)<<8,t[6]=i[28]&255|(i[29]&255)<<8,t[7]=i[30]&255|(i[31]&255)<<8,{buffer:new Qe(16),r:e,h:new Gf(10),pad:t,leftover:0,fin:0}}function Zd(i,e,t,r){const n=i.fin?0:2048;let s,o,a,p,l,f,g,d,y,m,E,T,w,b,C,N,O,R,F;const{h:z,r:K}=i;let B=z[0],M=z[1],V=z[2],U=z[3],D=z[4],W=z[5],ae=z[6],ue=z[7],Ee=z[8],Ae=z[9];const P=K[0],ee=K[1],ye=K[2],De=K[3],ce=K[4],Q=K[5],se=K[6],oe=K[7],le=K[8],pe=K[9];for(;r>=16;)s=e[t+0]&255|(e[t+1]&255)<<8,B+=s&8191,o=e[t+2]&255|(e[t+3]&255)<<8,M+=(s>>>13|o<<3)&8191,a=e[t+4]&255|(e[t+5]&255)<<8,V+=(o>>>10|a<<6)&8191,p=e[t+6]&255|(e[t+7]&255)<<8,U+=(a>>>7|p<<9)&8191,l=e[t+8]&255|(e[t+9]&255)<<8,D+=(p>>>4|l<<12)&8191,W+=l>>>1&8191,f=e[t+10]&255|(e[t+11]&255)<<8,ae+=(l>>>14|f<<2)&8191,g=e[t+12]&255|(e[t+13]&255)<<8,ue+=(f>>>11|g<<5)&8191,d=e[t+14]&255|(e[t+15]&255)<<8,Ee+=(g>>>8|d<<8)&8191,Ae+=d>>>5|n,y=0,m=y,m+=B*P,m+=M*(5*pe),m+=V*(5*le),m+=U*(5*oe),m+=D*(5*se),y=m>>>13,m&=8191,m+=W*(5*Q),m+=ae*(5*ce),m+=ue*(5*De),m+=Ee*(5*ye),m+=Ae*(5*ee),y+=m>>>13,m&=8191,E=y,E+=B*ee,E+=M*P,E+=V*(5*pe),E+=U*(5*le),E+=D*(5*oe),y=E>>>13,E&=8191,E+=W*(5*se),E+=ae*(5*Q),E+=ue*(5*ce),E+=Ee*(5*De),E+=Ae*(5*ye),y+=E>>>13,E&=8191,T=y,T+=B*ye,T+=M*ee,T+=V*P,T+=U*(5*pe),T+=D*(5*le),y=T>>>13,T&=8191,T+=W*(5*oe),T+=ae*(5*se),T+=ue*(5*Q),T+=Ee*(5*ce),T+=Ae*(5*De),y+=T>>>13,T&=8191,w=y,w+=B*De,w+=M*ye,w+=V*ee,w+=U*P,w+=D*(5*pe),y=w>>>13,w&=8191,w+=W*(5*le),w+=ae*(5*oe),w+=ue*(5*se),w+=Ee*(5*Q),w+=Ae*(5*ce),y+=w>>>13,w&=8191,b=y,b+=B*ce,b+=M*De,b+=V*ye,b+=U*ee,b+=D*P,y=b>>>13,b&=8191,b+=W*(5*pe),b+=ae*(5*le),b+=ue*(5*oe),b+=Ee*(5*se),b+=Ae*(5*Q),y+=b>>>13,b&=8191,C=y,C+=B*Q,C+=M*ce,C+=V*De,C+=U*ye,C+=D*ee,y=C>>>13,C&=8191,C+=W*P,C+=ae*(5*pe),C+=ue*(5*le),C+=Ee*(5*oe),C+=Ae*(5*se),y+=C>>>13,C&=8191,N=y,N+=B*se,N+=M*Q,N+=V*ce,N+=U*De,N+=D*ye,y=N>>>13,N&=8191,N+=W*ee,N+=ae*P,N+=ue*(5*pe),N+=Ee*(5*le),N+=Ae*(5*oe),y+=N>>>13,N&=8191,O=y,O+=B*oe,O+=M*se,O+=V*Q,O+=U*ce,O+=D*De,y=O>>>13,O&=8191,O+=W*ye,O+=ae*ee,O+=ue*P,O+=Ee*(5*pe),O+=Ae*(5*le),y+=O>>>13,O&=8191,R=y,R+=B*le,R+=M*oe,R+=V*se,R+=U*Q,R+=D*ce,y=R>>>13,R&=8191,R+=W*De,R+=ae*ye,R+=ue*ee,R+=Ee*P,R+=Ae*(5*pe),y+=R>>>13,R&=8191,F=y,F+=B*pe,F+=M*le,F+=V*oe,F+=U*se,F+=D*Q,y=F>>>13,F&=8191,F+=W*ce,F+=ae*De,F+=ue*ye,F+=Ee*ee,F+=Ae*P,y+=F>>>13,F&=8191,y=(y<<2)+y|0,y=y+m|0,m=y&8191,y=y>>>13,E+=y,B=m,M=E,V=T,U=w,D=b,W=C,ae=N,ue=O,Ee=R,Ae=F,t+=16,r-=16;z[0]=B,z[1]=M,z[2]=V,z[3]=U,z[4]=D,z[5]=W,z[6]=ae,z[7]=ue,z[8]=Ee,z[9]=Ae}function p0(i,e,t){const r=new Qe(10);let n,s,o,a;const{buffer:p,h:l,pad:f,leftover:g}=i;if(g){for(a=g,p[a++]=1;a<16;a++)p[a]=0;i.fin=1,Zd(i,p,0,16)}for(n=l[1]>>>13,l[1]&=8191,a=2;a<10;a++)l[a]+=n,n=l[a]>>>13,l[a]&=8191;for(l[0]+=n*5,n=l[0]>>>13,l[0]&=8191,l[1]+=n,n=l[1]>>>13,l[1]&=8191,l[2]+=n,r[0]=l[0]+5,n=r[0]>>>13,r[0]&=8191,a=1;a<10;a++)r[a]=l[a]+n,n=r[a]>>>13,r[a]&=8191;for(r[9]-=8192,s=(n^1)-1,a=0;a<10;a++)r[a]&=s;for(s=~s,a=0;a<10;a++)l[a]=l[a]&s|r[a];for(l[0]=(l[0]|l[1]<<13)&65535,l[1]=(l[1]>>>3|l[2]<<10)&65535,l[2]=(l[2]>>>6|l[3]<<7)&65535,l[3]=(l[3]>>>9|l[4]<<4)&65535,l[4]=(l[4]>>>12|l[5]<<1|l[6]<<14)&65535,l[5]=(l[6]>>>2|l[7]<<11)&65535,l[6]=(l[7]>>>5|l[8]<<8)&65535,l[7]=(l[8]>>>8|l[9]<<5)&65535,o=l[0]+f[0],l[0]=o&65535,a=1;a<8;a++)o=(l[a]+f[a]|0)+(o>>>16)|0,l[a]=o&65535;e[t+0]=l[0]>>>0&255,e[t+1]=l[0]>>>8&255,e[t+2]=l[1]>>>0&255,e[t+3]=l[1]>>>8&255,e[t+4]=l[2]>>>0&255,e[t+5]=l[2]>>>8&255,e[t+6]=l[3]>>>0&255,e[t+7]=l[3]>>>8&255,e[t+8]=l[4]>>>0&255,e[t+9]=l[4]>>>8&255,e[t+10]=l[5]>>>0&255,e[t+11]=l[5]>>>8&255,e[t+12]=l[6]>>>0&255,e[t+13]=l[6]>>>8&255,e[t+14]=l[7]>>>0&255,e[t+15]=l[7]>>>8&255}function l0(i,e,t,r){let n,s;const{buffer:o}=i;if(i.leftover){for(s=16-i.leftover,s>r&&(s=r),n=0;n<s;n++)o[i.leftover+n]=e[t+n];if(r-=s,t+=s,i.leftover+=s,i.leftover<16)return;Zd(i,o,0,16),i.leftover=0}if(r>=16&&(s=r-r%16,Zd(i,e,t,s),t+=s,r-=s),r){for(n=0;n<r;n++)o[i.leftover+n]=e[t+n];i.leftover+=r}}function h0(i,e,t){pc(i,e,t),sI(t,e);const r=new Qe(32+i.length),n=new Qe(r.length);for(let s=0;s<i.length;s++)r[s+32]=i[s];return f0(n,r,r.length,e,t),n.subarray(16)}function u0(i,e,t){pc(i,e,t),sI(t,e);const r=new Qe(16+i.length),n=new Qe(r.length);for(let s=0;s<i.length;s++)r[s+16]=i[s];if(!(r.length<32||g0(n,r,r.length,e,t)!==0))return n.subarray(32)}function f0(i,e,t,r,n){if(t<32)return-1;ZE(i,0,e,0,t,r,n),eI(i,16,i,32,t-32,i);for(let s=0;s<16;s++)i[s]=0;return 0}function g0(i,e,t,r,n){const s=new Qe(32);if(t<32||(a0(s,0,32,r,n),d0(e,16,e,32,t-32,s)!==0))return-1;ZE(i,0,e,0,t,r,n);for(let o=0;o<32;o++)i[o]=0;return 0}function eI(i,e,t,r,n,s){const o=c0(s);return l0(o,t,r,n),p0(o,i,e),0}function d0(i,e,t,r,n,s){const o=new Qe(16);return eI(o,0,t,r,n,s),O0(i,e,o,0)}function Be(i){const e=new ih(16);return i&&e.set(i),e}const y0=new Qe(16),m0=new Qe(32);m0[0]=9;const ey=Be(),Wa=Be([1]),_0=Be([56129,1]),A0=Be([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),E0=Be([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),kA=Be([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),HA=Be([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),I0=Be([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function Hn(i,e,t){for(let r=0;r<16;r++)i[r]=e[r]+t[r]}function Vn(i,e,t){for(let r=0;r<16;r++)i[r]=e[r]-t[r]}function Ze(i,e,t){let r,n,s=0,o=0,a=0,p=0,l=0,f=0,g=0,d=0,y=0,m=0,E=0,T=0,w=0,b=0,C=0,N=0,O=0,R=0,F=0,z=0,K=0,B=0,M=0,V=0,U=0,D=0,W=0,ae=0,ue=0,Ee=0,Ae=0,P=t[0],ee=t[1],ye=t[2],De=t[3],ce=t[4],Q=t[5],se=t[6],oe=t[7],le=t[8],pe=t[9],Ce=t[10],Fe=t[11],Ye=t[12],rt=t[13],st=t[14],qe=t[15];r=e[0],s+=r*P,o+=r*ee,a+=r*ye,p+=r*De,l+=r*ce,f+=r*Q,g+=r*se,d+=r*oe,y+=r*le,m+=r*pe,E+=r*Ce,T+=r*Fe,w+=r*Ye,b+=r*rt,C+=r*st,N+=r*qe,r=e[1],o+=r*P,a+=r*ee,p+=r*ye,l+=r*De,f+=r*ce,g+=r*Q,d+=r*se,y+=r*oe,m+=r*le,E+=r*pe,T+=r*Ce,w+=r*Fe,b+=r*Ye,C+=r*rt,N+=r*st,O+=r*qe,r=e[2],a+=r*P,p+=r*ee,l+=r*ye,f+=r*De,g+=r*ce,d+=r*Q,y+=r*se,m+=r*oe,E+=r*le,T+=r*pe,w+=r*Ce,b+=r*Fe,C+=r*Ye,N+=r*rt,O+=r*st,R+=r*qe,r=e[3],p+=r*P,l+=r*ee,f+=r*ye,g+=r*De,d+=r*ce,y+=r*Q,m+=r*se,E+=r*oe,T+=r*le,w+=r*pe,b+=r*Ce,C+=r*Fe,N+=r*Ye,O+=r*rt,R+=r*st,F+=r*qe,r=e[4],l+=r*P,f+=r*ee,g+=r*ye,d+=r*De,y+=r*ce,m+=r*Q,E+=r*se,T+=r*oe,w+=r*le,b+=r*pe,C+=r*Ce,N+=r*Fe,O+=r*Ye,R+=r*rt,F+=r*st,z+=r*qe,r=e[5],f+=r*P,g+=r*ee,d+=r*ye,y+=r*De,m+=r*ce,E+=r*Q,T+=r*se,w+=r*oe,b+=r*le,C+=r*pe,N+=r*Ce,O+=r*Fe,R+=r*Ye,F+=r*rt,z+=r*st,K+=r*qe,r=e[6],g+=r*P,d+=r*ee,y+=r*ye,m+=r*De,E+=r*ce,T+=r*Q,w+=r*se,b+=r*oe,C+=r*le,N+=r*pe,O+=r*Ce,R+=r*Fe,F+=r*Ye,z+=r*rt,K+=r*st,B+=r*qe,r=e[7],d+=r*P,y+=r*ee,m+=r*ye,E+=r*De,T+=r*ce,w+=r*Q,b+=r*se,C+=r*oe,N+=r*le,O+=r*pe,R+=r*Ce,F+=r*Fe,z+=r*Ye,K+=r*rt,B+=r*st,M+=r*qe,r=e[8],y+=r*P,m+=r*ee,E+=r*ye,T+=r*De,w+=r*ce,b+=r*Q,C+=r*se,N+=r*oe,O+=r*le,R+=r*pe,F+=r*Ce,z+=r*Fe,K+=r*Ye,B+=r*rt,M+=r*st,V+=r*qe,r=e[9],m+=r*P,E+=r*ee,T+=r*ye,w+=r*De,b+=r*ce,C+=r*Q,N+=r*se,O+=r*oe,R+=r*le,F+=r*pe,z+=r*Ce,K+=r*Fe,B+=r*Ye,M+=r*rt,V+=r*st,U+=r*qe,r=e[10],E+=r*P,T+=r*ee,w+=r*ye,b+=r*De,C+=r*ce,N+=r*Q,O+=r*se,R+=r*oe,F+=r*le,z+=r*pe,K+=r*Ce,B+=r*Fe,M+=r*Ye,V+=r*rt,U+=r*st,D+=r*qe,r=e[11],T+=r*P,w+=r*ee,b+=r*ye,C+=r*De,N+=r*ce,O+=r*Q,R+=r*se,F+=r*oe,z+=r*le,K+=r*pe,B+=r*Ce,M+=r*Fe,V+=r*Ye,U+=r*rt,D+=r*st,W+=r*qe,r=e[12],w+=r*P,b+=r*ee,C+=r*ye,N+=r*De,O+=r*ce,R+=r*Q,F+=r*se,z+=r*oe,K+=r*le,B+=r*pe,M+=r*Ce,V+=r*Fe,U+=r*Ye,D+=r*rt,W+=r*st,ae+=r*qe,r=e[13],b+=r*P,C+=r*ee,N+=r*ye,O+=r*De,R+=r*ce,F+=r*Q,z+=r*se,K+=r*oe,B+=r*le,M+=r*pe,V+=r*Ce,U+=r*Fe,D+=r*Ye,W+=r*rt,ae+=r*st,ue+=r*qe,r=e[14],C+=r*P,N+=r*ee,O+=r*ye,R+=r*De,F+=r*ce,z+=r*Q,K+=r*se,B+=r*oe,M+=r*le,V+=r*pe,U+=r*Ce,D+=r*Fe,W+=r*Ye,ae+=r*rt,ue+=r*st,Ee+=r*qe,r=e[15],N+=r*P,O+=r*ee,R+=r*ye,F+=r*De,z+=r*ce,K+=r*Q,B+=r*se,M+=r*oe,V+=r*le,U+=r*pe,D+=r*Ce,W+=r*Fe,ae+=r*Ye,ue+=r*rt,Ee+=r*st,Ae+=r*qe,s+=38*O,o+=38*R,a+=38*F,p+=38*z,l+=38*K,f+=38*B,g+=38*M,d+=38*V,y+=38*U,m+=38*D,E+=38*W,T+=38*ae,w+=38*ue,b+=38*Ee,C+=38*Ae,n=1,r=s+n+65535,n=Math.floor(r/65536),s=r-n*65536,r=o+n+65535,n=Math.floor(r/65536),o=r-n*65536,r=a+n+65535,n=Math.floor(r/65536),a=r-n*65536,r=p+n+65535,n=Math.floor(r/65536),p=r-n*65536,r=l+n+65535,n=Math.floor(r/65536),l=r-n*65536,r=f+n+65535,n=Math.floor(r/65536),f=r-n*65536,r=g+n+65535,n=Math.floor(r/65536),g=r-n*65536,r=d+n+65535,n=Math.floor(r/65536),d=r-n*65536,r=y+n+65535,n=Math.floor(r/65536),y=r-n*65536,r=m+n+65535,n=Math.floor(r/65536),m=r-n*65536,r=E+n+65535,n=Math.floor(r/65536),E=r-n*65536,r=T+n+65535,n=Math.floor(r/65536),T=r-n*65536,r=w+n+65535,n=Math.floor(r/65536),w=r-n*65536,r=b+n+65535,n=Math.floor(r/65536),b=r-n*65536,r=C+n+65535,n=Math.floor(r/65536),C=r-n*65536,r=N+n+65535,n=Math.floor(r/65536),N=r-n*65536,s+=n-1+37*(n-1),n=1,r=s+n+65535,n=Math.floor(r/65536),s=r-n*65536,r=o+n+65535,n=Math.floor(r/65536),o=r-n*65536,r=a+n+65535,n=Math.floor(r/65536),a=r-n*65536,r=p+n+65535,n=Math.floor(r/65536),p=r-n*65536,r=l+n+65535,n=Math.floor(r/65536),l=r-n*65536,r=f+n+65535,n=Math.floor(r/65536),f=r-n*65536,r=g+n+65535,n=Math.floor(r/65536),g=r-n*65536,r=d+n+65535,n=Math.floor(r/65536),d=r-n*65536,r=y+n+65535,n=Math.floor(r/65536),y=r-n*65536,r=m+n+65535,n=Math.floor(r/65536),m=r-n*65536,r=E+n+65535,n=Math.floor(r/65536),E=r-n*65536,r=T+n+65535,n=Math.floor(r/65536),T=r-n*65536,r=w+n+65535,n=Math.floor(r/65536),w=r-n*65536,r=b+n+65535,n=Math.floor(r/65536),b=r-n*65536,r=C+n+65535,n=Math.floor(r/65536),C=r-n*65536,r=N+n+65535,n=Math.floor(r/65536),N=r-n*65536,s+=n-1+37*(n-1),i[0]=s,i[1]=o,i[2]=a,i[3]=p,i[4]=l,i[5]=f,i[6]=g,i[7]=d,i[8]=y,i[9]=m,i[10]=E,i[11]=T,i[12]=w,i[13]=b,i[14]=C,i[15]=N}function Fn(i,e){Ze(i,e,e)}const FA=65536;function T0(i,e){for(let t=0;t<e;t+=FA)crypto.getRandomValues(i.subarray(t,t+Math.min(e-t,FA)))}function ui(i,e){for(let t=0;t<16;t++)i[t]=e[t]|0}function zf(i){let e,t,r=1;for(e=0;e<16;e++)t=i[e]+r+65535,r=Math.floor(t/65536),i[e]=t-r*65536;i[0]+=r-1+37*(r-1)}function ea(i,e,t){let r,n=~(t-1);for(let s=0;s<16;s++)r=n&(i[s]^e[s]),i[s]^=r,e[s]^=r}function qa(i,e){const t=Be(),r=Be();let n,s,o;for(n=0;n<16;n++)r[n]=e[n];for(zf(r),zf(r),zf(r),s=0;s<2;s++){for(t[0]=r[0]-65517,n=1;n<15;n++)t[n]=r[n]-65535-(t[n-1]>>16&1),t[n-1]&=65535;t[15]=r[15]-32767-(t[14]>>16&1),o=t[15]>>16&1,t[14]&=65535,ea(r,t,1-o)}for(n=0;n<16;n++)i[2*n]=r[n]&255,i[2*n+1]=r[n]>>8}function VA(i,e){const t=new Qe(32),r=new Qe(32);return qa(t,i),qa(r,e),oI(t,0,r,0)}function tI(i){const e=new Qe(32);return qa(e,i),e[0]&1}function rI(i,e){for(let t=0;t<16;t++)i[t]=e[2*t]+(e[2*t+1]<<8);i[15]&=32767}function Hm(i,e){const t=Be();let r;for(r=0;r<16;r++)t[r]=e[r];for(r=253;r>=0;r--)Fn(t,t),r!==2&&r!==4&&Ze(t,t,e);for(r=0;r<16;r++)i[r]=t[r]}function S0(i,e,t){const r=new Qe(32),n=new ih(80),s=Be(),o=Be(),a=Be(),p=Be(),l=Be(),f=Be();let g,d;for(d=0;d<31;d++)r[d]=e[d];for(r[31]=e[31]&127|64,r[0]&=248,rI(n,t),d=0;d<16;d++)o[d]=n[d],p[d]=s[d]=a[d]=0;for(s[0]=p[0]=1,d=254;d>=0;--d)g=r[d>>>3]>>>(d&7)&1,ea(s,o,g),ea(a,p,g),Hn(l,s,a),Vn(s,s,a),Hn(a,o,p),Vn(o,o,p),Fn(p,l),Fn(f,s),Ze(s,a,s),Ze(a,o,l),Hn(l,s,a),Vn(s,s,a),Fn(o,s),Vn(a,p,f),Ze(s,a,_0),Hn(s,s,p),Ze(a,a,s),Ze(s,p,f),Ze(p,o,n),Fn(o,l),ea(s,o,g),ea(a,p,g);for(d=0;d<16;d++)n[d+16]=s[d],n[d+32]=a[d],n[d+48]=o[d],n[d+64]=p[d];const y=n.subarray(32),m=n.subarray(16);return Hm(y,y),Ze(m,m,y),qa(i,m),0}function w0(i,e,t,r){const n=nI(t,r);return h0(i,e,n)}function nI(i,e){pc(i,e),x0(i,e);const t=new Qe(32);return N0(t,i,e),t}function b0(i,e,t,r){const n=nI(t,r);return u0(i,e,n)}function N0(i,e,t){const r=new Qe(32);return S0(r,t,e),km(i,y0,r,lo)}function sI(i,e){if(i.length!==32)throw new Error("bad key size");if(e.length!==24)throw new Error("bad nonce size")}function x0(i,e){if(i.length!==32)throw new Error("bad public key size");if(e.length!==32)throw new Error("bad secret key size")}function pc(...i){for(const e of i)if(!(e instanceof Uint8Array))throw new TypeError("unexpected type, use ByteArray")}function iI(i,e,t,r,n){let s,o=0;for(s=0;s<n;s++)o|=i[e+s]^t[r+s];return(1&o-1>>>8)-1}function O0(i,e,t,r){return iI(i,e,t,r,16)}function oI(i,e,t,r){return iI(i,e,t,r,32)}function ta(i,e,t){const r=new Du(8),n=new Du(8),s=new Qe(256);let o,a=t;for(r[0]=1779033703,r[1]=3144134277,r[2]=1013904242,r[3]=2773480762,r[4]=1359893119,r[5]=2600822924,r[6]=528734635,r[7]=1541459225,n[0]=4089235720,n[1]=2227873595,n[2]=4271175723,n[3]=1595750129,n[4]=2917565137,n[5]=725511199,n[6]=4215389547,n[7]=327033209,UA(r,n,e,t),t%=128,o=0;o<t;o++)s[o]=e[a-t+o];for(s[t]=128,t=256-128*(t<112?1:0),s[t-9]=0,KA(s,t-8,a/536870912|0,a<<3),UA(r,n,s,t),o=0;o<8;o++)KA(i,8*o,r[o],n[o]);return 0}const $A=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function UA(i,e,t,r){const n=new Du(16),s=new Du(16);let o,a,p,l,f,g,d,y,m,E,T,w,b,C,N,O,R,F,z,K,B,M,V,U,D,W,ae=i[0],ue=i[1],Ee=i[2],Ae=i[3],P=i[4],ee=i[5],ye=i[6],De=i[7],ce=e[0],Q=e[1],se=e[2],oe=e[3],le=e[4],pe=e[5],Ce=e[6],Fe=e[7],Ye=0;for(;r>=128;){for(z=0;z<16;z++)K=8*z+Ye,n[z]=t[K+0]<<24|t[K+1]<<16|t[K+2]<<8|t[K+3],s[z]=t[K+4]<<24|t[K+5]<<16|t[K+6]<<8|t[K+7];for(z=0;z<80;z++)if(o=ae,a=ue,p=Ee,l=Ae,f=P,g=ee,d=ye,y=De,m=ce,E=Q,T=se,w=oe,b=le,C=pe,N=Ce,O=Fe,B=De,M=Fe,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=(P>>>14|le<<32-14)^(P>>>18|le<<32-18)^(le>>>41-32|P<<32-(41-32)),M=(le>>>14|P<<32-14)^(le>>>18|P<<32-18)^(P>>>41-32|le<<32-(41-32)),V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,B=P&ee^~P&ye,M=le&pe^~le&Ce,V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,B=$A[z*2],M=$A[z*2+1],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,B=n[z%16],M=s[z%16],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,R=D&65535|W<<16,F=V&65535|U<<16,B=R,M=F,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=(ae>>>28|ce<<32-28)^(ce>>>34-32|ae<<32-(34-32))^(ce>>>39-32|ae<<32-(39-32)),M=(ce>>>28|ae<<32-28)^(ae>>>34-32|ce<<32-(34-32))^(ae>>>39-32|ce<<32-(39-32)),V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,B=ae&ue^ae&Ee^ue&Ee,M=ce&Q^ce&se^Q&se,V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,y=D&65535|W<<16,O=V&65535|U<<16,B=l,M=w,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=R,M=F,V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,l=D&65535|W<<16,w=V&65535|U<<16,ue=o,Ee=a,Ae=p,P=l,ee=f,ye=g,De=d,ae=y,Q=m,se=E,oe=T,le=w,pe=b,Ce=C,Fe=N,ce=O,z%16===15)for(K=0;K<16;K++)B=n[K],M=s[K],V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=n[(K+9)%16],M=s[(K+9)%16],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,R=n[(K+1)%16],F=s[(K+1)%16],B=(R>>>1|F<<32-1)^(R>>>8|F<<32-8)^R>>>7,M=(F>>>1|R<<32-1)^(F>>>8|R<<32-8)^(F>>>7|R<<32-7),V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,R=n[(K+14)%16],F=s[(K+14)%16],B=(R>>>19|F<<32-19)^(F>>>61-32|R<<32-(61-32))^R>>>6,M=(F>>>19|R<<32-19)^(R>>>61-32|F<<32-(61-32))^(F>>>6|R<<32-6),V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,n[K]=D&65535|W<<16,s[K]=V&65535|U<<16;B=ae,M=ce,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=i[0],M=e[0],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,i[0]=ae=D&65535|W<<16,e[0]=ce=V&65535|U<<16,B=ue,M=Q,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=i[1],M=e[1],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,i[1]=ue=D&65535|W<<16,e[1]=Q=V&65535|U<<16,B=Ee,M=se,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=i[2],M=e[2],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,i[2]=Ee=D&65535|W<<16,e[2]=se=V&65535|U<<16,B=Ae,M=oe,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=i[3],M=e[3],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,i[3]=Ae=D&65535|W<<16,e[3]=oe=V&65535|U<<16,B=P,M=le,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=i[4],M=e[4],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,i[4]=P=D&65535|W<<16,e[4]=le=V&65535|U<<16,B=ee,M=pe,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=i[5],M=e[5],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,i[5]=ee=D&65535|W<<16,e[5]=pe=V&65535|U<<16,B=ye,M=Ce,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=i[6],M=e[6],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,i[6]=ye=D&65535|W<<16,e[6]=Ce=V&65535|U<<16,B=De,M=Fe,V=M&65535,U=M>>>16,D=B&65535,W=B>>>16,B=i[7],M=e[7],V+=M&65535,U+=M>>>16,D+=B&65535,W+=B>>>16,U+=V>>>16,D+=U>>>16,W+=D>>>16,i[7]=De=D&65535|W<<16,e[7]=Fe=V&65535|U<<16,Ye+=128,r-=128}return r}function KA(i,e,t,r){i[e]=t>>24&255,i[e+1]=t>>16&255,i[e+2]=t>>8&255,i[e+3]=t&255,i[e+4]=r>>24&255,i[e+5]=r>>16&255,i[e+6]=r>>8&255,i[e+7]=r&255}function C0(i,e){if(pc(i,e),e.length!==64)throw new Error("bad secret key size");const t=new Qe(64+i.length);return v0(t,i,i.length,e),t}function R0(i,e){const t=C0(i,e),r=new Qe(64);for(let n=0;n<r.length;n++)r[n]=t[n];return r}function P0(i,e,t){if(pc(i,e,t),e.length!==64)throw new Error("bad signature size");if(t.length!==32)throw new Error("bad public key size");const r=new Qe(64+i.length),n=new Qe(64+i.length);return r.set(e),r.set(i,64),L0(n,r,r.length,t)>=0}function B0(i){if(pc(i),i.length!==32)throw new Error("bad seed size");const e=new Qe(32),t=new Qe(64);for(let r=0;r<32;r++)t[r]=i[r];return M0(e,t,!0),{publicKey:e,secretKey:t}}function M0(i,e,t){const r=new Qe(64),n=[Be(),Be(),Be(),Be()];let s;for(t||T0(e,32),ta(r,e,32),r[0]&=248,r[31]&=127,r[31]|=64,Fm(n,r),Vm(i,n),s=0;s<32;s++)e[s+32]=i[s];return 0}function v0(i,e,t,r){const n=new Qe(64),s=new Qe(64),o=new Qe(64),a=new ih(64),p=[Be(),Be(),Be(),Be()];let l,f;ta(n,r,32),n[0]&=248,n[31]&=127,n[31]|=64;const g=t+64;for(l=0;l<t;l++)i[64+l]=e[l];for(l=0;l<32;l++)i[32+l]=n[32+l];for(ta(o,i.subarray(32),t+32),ty(o),Fm(p,o),Vm(i,p),l=32;l<64;l++)i[l]=r[l];for(ta(s,i,t+64),ty(s),l=0;l<64;l++)a[l]=0;for(l=0;l<32;l++)a[l]=o[l];for(l=0;l<32;l++)for(f=0;f<32;f++)a[l+f]+=s[l]*n[f];return pI(i.subarray(32),a),g}function L0(i,e,t,r){const n=new Qe(32),s=new Qe(64),o=[Be(),Be(),Be(),Be()],a=[Be(),Be(),Be(),Be()];let p,l;if(l=-1,t<64||cI(a,r))return-1;for(p=0;p<t;p++)i[p]=e[p];for(p=0;p<32;p++)i[p+32]=r[p];if(ta(s,i,t),ty(s),aI(o,a,s),Fm(a,e.subarray(32)),ry(o,a),Vm(n,o),t-=64,oI(e,0,n,0)){for(p=0;p<t;p++)i[p]=0;return-1}for(p=0;p<t;p++)i[p]=e[p+64];return l=t,l}function Fm(i,e){const t=[Be(),Be(),Be(),Be()];ui(t[0],kA),ui(t[1],HA),ui(t[2],Wa),Ze(t[3],kA,HA),aI(i,t,e)}function aI(i,e,t){let r,n;for(ui(i[0],ey),ui(i[1],Wa),ui(i[2],Wa),ui(i[3],ey),n=255;n>=0;--n)r=t[n/8|0]>>(n&7)&1,GA(i,e,r),ry(e,i),ry(i,i),GA(i,e,r)}function Vm(i,e){const t=Be(),r=Be(),n=Be();Hm(n,e[2]),Ze(t,e[0],n),Ze(r,e[1],n),qa(i,r),i[31]^=tI(t)<<7}function cI(i,e){const t=Be(),r=Be(),n=Be(),s=Be(),o=Be(),a=Be(),p=Be();return ui(i[2],Wa),rI(i[1],e),Fn(n,i[1]),Ze(s,n,A0),Vn(n,n,i[2]),Hn(s,i[2],s),Fn(o,s),Fn(a,o),Ze(p,a,o),Ze(t,p,n),Ze(t,t,s),D0(t,t),Ze(t,t,n),Ze(t,t,s),Ze(t,t,s),Ze(i[0],t,s),Fn(r,i[0]),Ze(r,r,s),VA(r,n)&&Ze(i[0],i[0],I0),Fn(r,i[0]),Ze(r,r,s),VA(r,n)?-1:(tI(i[0])===e[31]>>7&&Vn(i[0],ey,i[0]),Ze(i[3],i[0],i[1]),0)}function ty(i){const e=new ih(64);let t;for(t=0;t<64;t++)e[t]=i[t];for(t=0;t<64;t++)i[t]=0;pI(i,e)}const jf=new ih([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function pI(i,e){let t,r,n,s;for(r=63;r>=32;--r){for(t=0,n=r-32,s=r-12;n<s;++n)e[n]+=t-16*e[r]*jf[n-(r-32)],t=Math.floor((e[n]+128)/256),e[n]-=t*256;e[n]+=t,e[r]=0}for(t=0,n=0;n<32;n++)e[n]+=t-(e[31]>>4)*jf[n],t=e[n]>>8,e[n]&=255;for(n=0;n<32;n++)e[n]-=t*jf[n];for(r=0;r<32;r++)e[r+1]+=e[r]>>8,i[r]=e[r]&255}function ry(i,e){const t=Be(),r=Be(),n=Be(),s=Be(),o=Be(),a=Be(),p=Be(),l=Be(),f=Be();Vn(t,i[1],i[0]),Vn(f,e[1],e[0]),Ze(t,t,f),Hn(r,i[0],i[1]),Hn(f,e[0],e[1]),Ze(r,r,f),Ze(n,i[3],e[3]),Ze(n,n,E0),Ze(s,i[2],e[2]),Hn(s,s,s),Vn(o,r,t),Vn(a,s,n),Hn(p,s,n),Hn(l,r,t),Ze(i[0],o,a),Ze(i[1],l,p),Ze(i[2],p,a),Ze(i[3],o,l)}function GA(i,e,t){for(let r=0;r<4;r++)ea(i[r],e[r],t)}function D0(i,e){const t=Be();let r;for(r=0;r<16;r++)t[r]=e[r];for(r=250;r>=0;r--)Fn(t,t),r!==1&&Ze(t,t,e);for(r=0;r<16;r++)i[r]=t[r]}const k0={create(i){const e=B0(i);return{secretKey:kr.from(e.secretKey),publicKey:kr.from(e.publicKey)}},detached_sign(i,e){return kr.from(R0(i,e))},detached_verify(i,e,t){return P0(i,e,t)},box(i,e,t,r=new Uint8Array(24)){return{encryptedMessage:w0(i,r,e,t),nonce:r}},open(i,e,t,r){return b0(i,e,t,r)||!1}};function H0(i){let e=new Uint8Array(32),t=[Be(),Be(),Be(),Be()],r=Be(),n=Be();if(cI(t,i))throw new TypeError("invalid public key");let s=t[1];return Hn(r,Wa,s),Vn(n,Wa,s),Hm(n,n),Ze(r,r,n),qa(e,r),e}function F0(i){let e=new Uint8Array(64),t=new Uint8Array(32),r;for(ta(e,i,32),e[0]&=248,e[31]&=127,e[31]|=64,r=0;r<32;r++)t[r]=e[r];for(r=0;r<64;r++)e[r]=0;return t}const V0={convertPublicKey:H0,convertSecretKey:F0};let zA=class{createRemark(e){return vc.fromObject({remark:e})}};zA=h([j()],zA);const $0={CURRENT_HEIGHT:Symbol("currentHeight")};let Pi=class{constructor(e=0){this.currentHeight=e,this.emitter=new wn,this.emitter.on("height",t=>{const r=this.currentHeight;this.currentHeight=t,this.emitter.emit("heightChanged",{oldHeight:r,newHeight:t})})}changeHeight(e){this.emitter.emit("height",e)}onHeightChanged(e){this.emitter.on("heightChanged",e)}planAfterHeight(e,t,r){let n=0;this.emitter.on("heightChanged",({newHeight:s,oldHeight:o})=>{s>o?s>=e&&n!==1&&(t(),n=1):s<e&&n!==0&&(r(),n=0)}),this.currentHeight>=e&&(t(),n=1)}get version(){return this._version}};h([J(te),u("design:type",te)],Pi.prototype,"config",void 0);h([J(Fl),u("design:type",Fl)],Pi.prototype,"block",void 0);h([J("blockGetterHelper",{optional:!0,dynamics:!0}),u("design:type",Object)],Pi.prototype,"blockGetterHelper",void 0);Pi=h([j({group:!0}),Oe(0,J($0.CURRENT_HEIGHT,{optional:!0})),u("design:paramtypes",[Number])],Pi);let jA=class extends Pi{constructor(){super(...arguments),this.name="patch-bfmeta-v2",this.patchEffectiveAfterHeight=273714,this._version=1,this.consensusVersion=2}async upgradeHandler(e,t){switch(e){case 0:this.planAfterHeight(this.patchEffectiveAfterHeight,()=>{const r=this.config.getHookGenesisBlock(this.consensusVersion)||{};r.asset=LE(r.asset,{genesisAsset:{voteMinChainAsset:"100000000000"}}),this.config.setHookGenesisBlock(this.consensusVersion,r)},()=>{this.config.rollBackHookGenesisBlock(this.consensusVersion)})}}};jA=h([j()],jA);let ny=class extends Rh{constructor(e,t){super(),this.moduleMap=e,this.config=t,this._consensusVersionAndHeightMap=new Map,this._lastConsensusVersion=1,this._lastPatchEffectiveHeight=1,this._patchVersionMap=new wt(()=>0)}bfAfterInit(){this._isPatchReady=this._installPatchs().then(()=>{this._isPatchReady=void 0})}get lastConsensusVersion(){return this._lastConsensusVersion}get lastPatchEffectiveHeight(){return this._lastPatchEffectiveHeight}installPatch(e){Ot(e,this.moduleMap)}async getPatchEffectiveAfterHeightByVersion(e){let t=0;if(e<=1)return 0;await this._isPatchReady;for(const[r,n]of this._consensusVersionAndHeightMap.entries()){if(e===r)return n;t=n}return t}async changeHeight(e){await this._isPatchReady;const t=this.moduleMap.groupGet(Pi);for(const r of t)r.changeHeight(e)}async _installPatchs(){const e=[...this.moduleMap.groupGet(Pi)];e.sort((n,s)=>n.version-s.version);const t=new wt(n=>e.filter(s=>s.name===n).sort((s,o)=>o.version-s.version)[0].version),r=new wn;this.config.version;try{for(const n of e){r.emit("progress",n);const s=this._patchVersionMap.forceGet(n.name);if(s<n.version){this._consensusVersionAndHeightMap.set(n.consensusVersion,n.patchEffectiveAfterHeight);const o=t.forceGet(n.name);await n.upgradeHandler(s,o),this._patchVersionMap.set(n.name,n.version),this._lastConsensusVersion<n.consensusVersion&&(this._lastConsensusVersion=n.consensusVersion),this._lastPatchEffectiveHeight<n.patchEffectiveAfterHeight&&(this._lastPatchEffectiveHeight=n.patchEffectiveAfterHeight)}}r.emit("done")}catch(n){this.emit("error",n),r.emit("error",n)}this.config.version}};ny=h([j(),u("design:paramtypes",[et,te])],ny);let jl=class{constructor(e,t,r,n,s,o,a,p,l,f,g,d,y,m,E,T,w,b,C,N,O,R,F,z,K,B,M,V){this.config=e,this.cryptoHelper=t,this.keypairHelper=r,this.ed2curveHelper=n,this.Buffer=s,this.base58Helper=o,this.jsbiHelper=a,this.asymmetricHelper=p,this.accountBaseHelper=l,this.transactionHelper=f,this.blockHelper=g,this.milestonesHelper=d,this.parityBitHelper=y,this.baseHelper=m,this.chainAssetInfoHelper=E,this.migrateCertificateHelper=T,this.registerChainCertificateHelper=w,this.configMap=b,this.block=C,this.blockLogicVerifier=N,this.blockTicker=O,this.transaction=R,this.transactionLogicVerifier=F,this.channel=z,this.time=K,this.moduleMap=B,this.patchInstaller=M,this.i18N=V,this.i18N.addErrorCodeList("BFCHAIN-CORE",c,OT)}};jl=h([j(),Oe(1,J("cryptoHelper")),Oe(2,J("keypairHelper")),Oe(3,J("ed2curveHelper")),Oe(4,J("Buffer")),u("design:paramtypes",[te,Object,Object,Object,Object,eu,It,$r,de,me,_t,Es,Zh,Pe,ke,js,Bl,Tr,Fl,Vd,Gd,qn,Ri,Xd,Vt,et,ny,rg])],jl);function lI(i,e=new et,t){["config","Buffer","cryptoHelper","keypairHelper","ed2curveHelper","blockGetterHelper","blobSha256Reader","blobSha256Writer","TIME_SPEED"].forEach(n=>{e.has(n)||e.set(n,i[n])});let r=e.get("configMap");return r||(r=new Tr,e.set("configMap",r)),r.set(i.config.magic,i.config),t&&t.forEach(n=>{Ot(n,e)}),e.set("BFChainCoreFactory",lI),Ot(jl,e)}let un=class{constructor(){this.defaultDiffHeight=20}async _createSomeTransaction(e,t,r,n,s){const{transactionCore:o,timeHelper:a,config:p,accountBaseHelper:l}=this,f=await l.createSecretKeypair(t.mainSecret);let g;t.paySecret&&(t.usePaySecretV1?g=await this.accountBaseHelper.createSecondSecretKeypair(t.mainSecret,t.paySecret):g=await this.accountBaseHelper.createSecondSecretKeypairV2(t.mainSecret,t.paySecret));const d=await this.transactionCore.getTransactionTypeFromTransactionFactoryConstructor(e),y=await l.getAddressFromPublicKey(f.publicKey),m=f.publicKey.toString("hex"),E=r.applyBlockHeight||1,T=g&&g.publicKey.toString("hex"),w=r.fromMagic||p.magic,b=r.toMagic||p.magic,C={...this.customTrsRemark,...r.remark||{}};let N,O=0;const R=[];r.recipientId&&(typeof r.recipientId=="string"?N=r.recipientId:(O=r.recipientId.type,R.push(...r.recipientId.range)));let F;r.effectiveBlockHeight?F=await this.checkEffectiveBlockHeight(r.effectiveBlockHeight,E):F=await this.calcEffectiveBlockHeight(E);const z=(M,V=!0)=>o.createTransaction(e,{version:this.config.version,type:d,senderId:y,senderPublicKey:m,senderSecondPublicKey:T,recipientId:N||void 0,range:R,rangeType:O,fee:M,timestamp:r.timestamp||(r.timestamp=a.getTimestamp()),dappid:r.dappid||void 0,lns:r.lns||void 0,sourceIP:r.sourceIP||void 0,fromMagic:w,toMagic:b,applyBlockHeight:E,effectiveBlockHeight:F,remark:C,storage:s},n,f,g,this.config,void 0,V);let K=r.fee;if(K.startsWith("AUTO")){const M=[];(r.fee.startsWith("AUTO:")?r.fee.slice(5).split(","):[]).forEach(ae=>{const ue=ae[0];ue==="*"?M.push({type:"mul",rate:parseFloat(ae.slice(1))||1}):ue===">"&&M.push({type:"max",value:BigInt(ae.slice(1))})});let U="1";const{maxTransactionSize:D,minTransactionFeePerByte:W}=this.config;if(d===this.transactionHelper.GIFT_ASSET){const{totalGrabableTimes:ae}=n.giftAsset;U=this.jsbiHelper.multiplyCeilFraction(D*(ae+1),W).toString()}else if(d===this.transactionHelper.TRUST_ASSET){const{numberOfSignFor:ae}=n.trustAsset;U=this.jsbiHelper.multiplyCeilFraction(D*(ae+1),W).toString()}else if(d===this.transactionHelper.GIFT_ANY){const{totalGrabableTimes:ae}=n.giftAny;U=this.jsbiHelper.multiplyCeilFraction(D*(ae+1),W).toString()}K=this.calcTransactionFee(await z(U,!0),{modes:M})}return await z(K)}createSignatureTransaction(e,t,r){return this._createSomeTransaction(su,e,t,r)}createUsernameTransaction(e,t,r){return this._createSomeTransaction(nu,e,t,r,{key:"alias",value:r.username.alias})}createTransferAssetTransaction(e,t,r){return this._createSomeTransaction(ou,e,t,r,{key:"assetType",value:r.transferAsset.assetType})}createTransferAnyTransaction(e,t,r,n=!1){return this._createSomeTransaction(au,e,t,r,n?void 0:{key:"assetType",value:r.transferAny.assetType})}createIssueEntityFactoryTransaction(e,t,r){return this._createSomeTransaction(du,e,t,r,{key:"factoryId",value:r.issueEntityFactory.factoryId})}createIssueEntityTransaction(e,t,r){return this._createSomeTransaction(yu,e,t,r,{key:"entityId",value:r.issueEntity.entityId})}createIssueEntityMultiTransaction(e,t,r){return this._createSomeTransaction(_u,e,t,r,{key:"factoryId",value:r.issueEntityMulti.entityFactory.factoryId})}createToExchangeAnyTransaction(e,t,r){return this._createSomeTransaction(Ll,e,t,r)}createBeExchangeAnyTransaction(e,t,r){return this._createSomeTransaction(mu,e,t,r,{key:"transactionSignature",value:r.beExchangeAny.transactionSignature})}createToExchangeAnyMultiTransaction(e,t,r){return this._createSomeTransaction(Au,e,t,r)}createBeExchangeAnyMultiTransaction(e,t,r){return this._createSomeTransaction(Eu,e,t,r,{key:"transactionSignature",value:r.beExchangeAnyMulti.transactionSignature})}createGiftAnyTransaction(e,t,r){return this._createSomeTransaction(vl,e,t,r,{key:"assetType",value:r.giftAny.assetType})}createGrabAnyTransaction(e,t,r){return this._createSomeTransaction(uu,e,t,r,{key:"transactionSignature",value:r.grabAny.transactionSignature})}createDestoryAssetTransaction(e,t,r){return this._createSomeTransaction(cu,e,t,r,{key:"assetType",value:r.destroyAsset.assetType})}calcTransactionFee(e,t={}){const{minTransactionFeePerByte:r=this.config.minTransactionFeePerByte,modes:n}=t;let s=e.getBytes().length,o=e.fee;do{const a=this.jsbiHelper.multiplyCeilFraction(s,r),p=a.toString();if(p.length<=o.length){let l=a;if(n)for(const g of n)g.type==="mul"?l=this.jsbiHelper.multiplyCeil(l,g.rate):g.type==="max"&&g.value>l&&(l=g.value);const f=BigInt(e.fee);return(f>l?f>a?f:a:l).toString()}s+=p.length-o.length,o=p}while(!0)}calcEffectiveBlockHeight(e){return this.checkEffectiveBlockHeight(e+this.defaultDiffHeight,e)}checkEffectiveBlockHeight(e,t){const r=t+this.config.maxApplyAndConfirmedBlockHeightDiff;return e>r?r:e}};h([J("customTrsRemark",{optional:!0,dynamics:!0}),u("design:type",Object)],un.prototype,"customTrsRemark",void 0);h([J(qn),u("design:type",qn)],un.prototype,"transactionCore",void 0);h([J(me),u("design:type",me)],un.prototype,"transactionHelper",void 0);h([J(Vt),u("design:type",Vt)],un.prototype,"timeHelper",void 0);h([J(te),u("design:type",te)],un.prototype,"config",void 0);h([J(js),u("design:type",js)],un.prototype,"migrateCertificateHelper",void 0);h([J(It),u("design:type",It)],un.prototype,"jsbiHelper",void 0);h([J(qh),u("design:type",qh)],un.prototype,"flagsHelper",void 0);h([J(de),u("design:type",de)],un.prototype,"accountBaseHelper",void 0);un=h([j()],un);let Hu=class extends un{async createTransferTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createTransferAssetTransaction(t,s,{transferAsset:{sourceChainName:n.sourceChainName||this.config.chainName,sourceChainMagic:n.sourceChainMagic,assetType:n.assetType,amount:n.amount}})).toJSON()}async getTransferTransactionMinFee(e){const{transaction:t,assetInfo:r}=e,n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},o={fee:"1",recipientId:await this.accountBaseHelper.getAddressFromSecret(`secrets:${Date.now()}-getRecipientId`),remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight},a=await this.createTransferAssetTransaction(n,o,{transferAsset:{sourceChainName:r.sourceChainName||this.config.chainName,sourceChainMagic:r.sourceChainMagic,assetType:r.assetType,amount:r.amount}}),p=(this.transactionHelper.calcTransactionMinFeeByBytes(a,a.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(a)).toString();return String(BigInt(p)*BigInt(2))}async createSignatureTransactionJSON(e,t){const r=await this.accountBaseHelper.getPublicKeyStringFromSecondSecretV2(e.mainSecret,t.newPaySecret);return(await this.createSignatureTransaction(e,{fee:t.fee,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight},{signature:{publicKey:r}})).toJSON()}async getSignatureTransactionMinFee(e){const t={mainSecret:`secrets:${Date.now()}`,paySecret:"1"+e.newPaySecret},r=await this.accountBaseHelper.getPublicKeyStringFromSecondSecretV2(t.mainSecret,e.newPaySecret),n=await this.createSignatureTransaction(t,{fee:"1",applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},{signature:{publicKey:r}}),s=(this.transactionHelper.calcTransactionMinFeeByBytes(n,n.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(n)).toString();return String(BigInt(s)*BigInt(2))}async createCertificateTransferTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createTransferAnyTransaction(t,s,{transferAny:{...n,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,parentAssetType:L.CERTIFICATE}})).toJSON()}async createEntityTransferTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createTransferAnyTransaction(t,s,{transferAny:{...n,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,parentAssetType:L.ENTITY}})).toJSON()}async createEntityTransferTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:await this.accountBaseHelper.getAddressFromSecret(`secrets:${Date.now()}-getRecipientId`),remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},o=await this.createTransferAnyTransaction(r,s,{transferAny:{...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,parentAssetType:L.ENTITY}}),a=(this.transactionHelper.calcTransactionMinFeeByBytes(o,o.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(o)).toString();return String(BigInt(a)*BigInt(12)/BigInt(10))}async createDestoryAssetTransactionJSON(e){const{secrets:t,transaction:r,assetInfo:n}=e,s={fee:r.fee,recipientId:r.recipientId,remark:r.remark,applyBlockHeight:r.applyBlockHeight,timestamp:r.timestamp,effectiveBlockHeight:r.effectiveBlockHeight};return(await this.createDestoryAssetTransaction(t,s,{destroyAsset:{sourceChainName:n.sourceChainName||this.config.chainName,sourceChainMagic:n.sourceChainMagic,assetType:n.assetType,amount:n.amount}})).toJSON()}async getDestoryAssetTransactionMinFee(e){const{transaction:t,assetInfo:r}=e,n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},o={fee:"1",recipientId:await this.accountBaseHelper.getAddressFromSecret(`secrets:${Date.now()}-getRecipientId`),remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight},a=await this.createDestoryAssetTransaction(n,o,{destroyAsset:{sourceChainName:r.sourceChainName||this.config.chainName,sourceChainMagic:r.sourceChainMagic,assetType:r.assetType,amount:r.amount}}),p=(this.transactionHelper.calcTransactionMinFeeByBytes(a,a.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(a)).toString();return String(BigInt(p)*BigInt(2))}};Hu=h([j()],Hu);let Fu=class extends un{async createIssueEntityFactoryTransactionJSON(e,t,r){const n={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight,recipientId:t.recipientId},s={...r,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName};return(await this.createIssueEntityFactoryTransaction(e,n,{issueEntityFactory:s})).toJSON()}async getCreateIssueEntityFactoryTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight,recipientId:e.recipientId},s={...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},o=await this.createIssueEntityFactoryTransaction(r,n,{issueEntityFactory:s}),a=(this.transactionHelper.calcTransactionMinFeeByBytes(o,o.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(o)).toString();return String(BigInt(a)*BigInt(105)/BigInt(100))}async createIssueEntityTransactionJSON(e,t,r){const n={...r.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...r,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},o={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight,recipientId:t.recipientId};return(await this.createIssueEntityTransaction(e,o,{issueEntity:s})).toJSON()}async getCreateIssueEntityTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={...t.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},o={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight,recipientId:e.recipientId},a=await this.createIssueEntityTransaction(r,o,{issueEntity:s}),p=(this.transactionHelper.calcTransactionMinFeeByBytes(a,a.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(a)).toString();return String(BigInt(p)*BigInt(105)/BigInt(100))}async createIssueEntityMultiTransactionJSON(e,t,r){const n={...r.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...r,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},o={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight,recipientId:t.recipientId};return(await this.createIssueEntityMultiTransaction(e,o,{issueEntityMulti:s})).toJSON()}async getCreateIssueEntityMultiTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={...t.entityFactory,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName},s={...t,sourceChainMagic:this.config.magic,sourceChainName:this.config.chainName,entityFactory:n},o={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight,recipientId:e.recipientId},a=await this.createIssueEntityMultiTransaction(r,o,{issueEntityMulti:s}),p=(this.transactionHelper.calcTransactionMinFeeByMulti(a,a.asset.issueEntityMulti.entityStructList.length)+this.transactionHelper.calcTransactionBlobFee(a)).toString();return String(BigInt(p)*BigInt(105)/BigInt(100))}async createToExchangeAnyTransactionJSON(e,t,r){const n={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createToExchangeAnyTransaction(e,n,{toExchangeAny:{...r,cipherPublicKeys:[]}})).toJSON()}async getCreateToExchangeAnyTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},s=await this.createToExchangeAnyTransaction(r,n,{toExchangeAny:{...t,cipherPublicKeys:[]}}),o=(this.transactionHelper.calcTransactionMinFeeByBytes(s,s.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(s)).toString();return String(BigInt(o)*BigInt(105)/BigInt(100))}async createBeExchangeAnyTransactionJSON(e,t,r,n){const s={fee:t.fee,recipientId:t.recipientId,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createBeExchangeAnyTransaction(e,s,{beExchangeAny:{...r,exchangeAny:{...n,cipherPublicKeys:[]}}})).toJSON()}async getCreateBeExchangeAnyTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:e.recipientId,remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},o=await this.createBeExchangeAnyTransaction(n,s,{beExchangeAny:{...t,exchangeAny:{...r,cipherPublicKeys:[]}}}),a=(this.transactionHelper.calcTransactionMinFeeByBytes(o,o.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(o)).toString();return String(BigInt(a)*BigInt(105)/BigInt(100))}async createToExchangeAnyMultiTransactionJSON(e,t,r,n){const s={fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createToExchangeAnyMultiTransaction(e,s,{toExchangeAnyMulti:{cipherPublicKeys:[],toExchangeAssets:r,beExchangeAsset:n}})).toJSON()}async getCreateToExchangeAnyMultiTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},o=await this.createToExchangeAnyMultiTransaction(n,s,{toExchangeAnyMulti:{cipherPublicKeys:[],toExchangeAssets:t,beExchangeAsset:r}}),a=(this.transactionHelper.calcTransactionMinFeeByMulti(o,o.asset.toExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(o)).toString();return String(BigInt(a)*BigInt(105)/BigInt(100))}async createBeExchangeAnyMultiTransactionJSON(e,t,r,n){const s={fee:t.fee,recipientId:t.recipientId,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createBeExchangeAnyMultiTransaction(e,s,{beExchangeAnyMulti:{transactionSignature:t.transactionSignature,toExchangeAssets:r,beExchangeAsset:n}})).toJSON()}async getCreateBeExchangeAnyMultiTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"1",recipientId:e.recipientId,remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},o=await this.createBeExchangeAnyMultiTransaction(n,s,{beExchangeAnyMulti:{transactionSignature:e.transactionSignature,toExchangeAssets:t,beExchangeAsset:r}}),a=(this.transactionHelper.calcTransactionMinFeeByMulti(o,o.asset.beExchangeAnyMulti.toExchangeAssets.length)+this.transactionHelper.calcTransactionBlobFee(o)).toString();return String(BigInt(a)*BigInt(105)/BigInt(100))}async createGiftAnyTransactionJSON(e,t,r){const n={recipientId:{type:1,range:[t.recipientId]},fee:t.fee,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createGiftAnyTransaction(e,n,{giftAny:{...r,cipherPublicKeys:[]}})).toJSON()}async getCreateGiftAnyTransactionMinFee(e,t){const r={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},n={fee:"AUTO",recipientId:{type:1,range:[e.recipientId]},remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},s=await this.createGiftAnyTransaction(r,n,{giftAny:{...t,cipherPublicKeys:[]}});let o=this.transactionHelper.calcTransactionMinFeeByBytes(s,s.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(s);const a=BigInt(s.fee);return a>o&&(o=a),String(o*BigInt(105)/BigInt(100))}async createGrabAnyTransactionJSON(e,t,r,n){const s={fee:t.fee,recipientId:t.recipientId,remark:t.remark,applyBlockHeight:t.applyBlockHeight,timestamp:t.timestamp,effectiveBlockHeight:t.effectiveBlockHeight};return(await this.createGrabAnyTransaction(e,s,{grabAny:{...r,giftAny:{...n,cipherPublicKeys:[]}}})).toJSON()}async getCreateGrabAnyTransactionMinFee(e,t,r){const n={mainSecret:`secrets:${Date.now()}`,paySecret:"1"},s={fee:"AUTO",recipientId:e.recipientId,remark:e.remark,applyBlockHeight:e.applyBlockHeight,timestamp:e.timestamp,effectiveBlockHeight:e.effectiveBlockHeight},o=await this.createGrabAnyTransaction(n,s,{grabAny:{...t,giftAny:{...r,cipherPublicKeys:[]}}});let a=this.transactionHelper.calcTransactionMinFeeByBytes(o,o.getBytes().length)+this.transactionHelper.calcTransactionBlobFee(o);const p=BigInt(o.fee);return p>a&&(a=p),String(a*BigInt(105)/BigInt(100))}};Fu=h([j()],Fu);const U0="BioforestChainBundleCore";exports.BioforestChainBundleCore=class extends wn{constructor(e){super(),this.moduleMap=e,this._init_task=new Qt}accountBaseHelper(){return this.bfchainCore.accountBaseHelper}keypairHelper(){return this.bfchainCore.keypairHelper}config(){return this.bfchainCore.config}getMagic(){return this.bfchainCore.config.magic}getAssetType(){return this.bfchainCore.config.assetType}getChainName(){return this.bfchainCore.config.chainName}afterInit(){return this._init_task.promise}async bfOnInit(){try{this._init_task.resolve()}catch(e){this._init_task.reject(e)}}};h([J(jl),u("design:type",jl)],exports.BioforestChainBundleCore.prototype,"bfchainCore",void 0);h([J(Hu),u("design:type",Hu)],exports.BioforestChainBundleCore.prototype,"transactionController",void 0);h([J(Fu),u("design:type",Fu)],exports.BioforestChainBundleCore.prototype,"exchangeTransactionCtrl",void 0);exports.BioforestChainBundleCore=h([j(U0),u("design:paramtypes",[et])],exports.BioforestChainBundleCore);let JA=new Map;const K0=async(i,e,t={})=>{const r=i.magic;let n=JA.get(r);if(n)return n;const s=new et,o=lI({config:new te(i,"BioforestChain-bundle"),Buffer:as.Buffer,cryptoHelper:e,keypairHelper:k0,ed2curveHelper:V0},s);return s.set("Buffer",as.Buffer),s.set("customTrsRemark",t),JA.set(r,n=Ot(exports.BioforestChainBundleCore,o.moduleMap)),n};exports.setup=K0;
//# sourceMappingURL=bioforest-chain-bundle.js.map
