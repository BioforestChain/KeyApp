var xs=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Ho=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},Nr;const Le=t=>new Kn(t);class Kn{constructor(e=!0){Object.defineProperty(this,"_cbs",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Nr.set(this,!1),Object.defineProperty(this,"_cachedActions",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"listen",{enumerable:!0,configurable:!0,writable:!0,value:r=>(this._cbs.add(r),this._start(),()=>this._cbs.delete(r))}),Object.defineProperty(this,"emit",{enumerable:!0,configurable:!0,writable:!0,value:(...r)=>{this._startAction(()=>{this._emit(r,this._cbs)})}}),Object.defineProperty(this,"emitAndClear",{enumerable:!0,configurable:!0,writable:!0,value:(...r)=>{this._startAction(()=>{const n=[...this._cbs];this._cbs.clear(),this._emit(r,n)})}}),Object.defineProperty(this,"clear",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this._startAction(()=>{this._cbs.clear()})}}),e&&this._start()}_start(){if(!xs(this,Nr,"f")&&(Ho(this,Nr,!0,"f"),this._cachedActions.length)){for(const e of this._cachedActions)e();this._cachedActions.length=0}}_startAction(e){xs(this,Nr,"f")?e():this._cachedActions.push(e)}_emit(e,r){for(const n of r)try{n.apply(null,e)}catch(i){console.warn(i)}}}Nr=new WeakMap;const ba=t=>t instanceof ArrayBuffer||ArrayBuffer.isView(t)||typeof SharedArrayBuffer=="function"&&t instanceof SharedArrayBuffer,mr=t=>t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t),wa=t=>{if(t.length===0)return new Uint8Array;let e=0;const r=t.filter(s=>{const{byteLength:a}=s;return e+=a,a>0});if(r.length===0)return t[0];if(r.length===1)return r[0];const n=new Uint8Array(e);let i=0;for(const s of r)n.set(s,i),i+=s.byteLength;return n};async function*va(t,e){const r=e?.signal;r!==void 0&&r.addEventListener("abort",n=>t.cancel(n));try{for(;;){const n=await t.read();if(n.done)break;yield n.value}}catch(n){t.cancel(n)}finally{t.releaseLock()}}const Qr=(t,e)=>va(t.getReader(),e),Vo=(t,e)=>{const r=Qr(t,e);let n=!1,i=new Uint8Array(0);const s=async()=>{const P=await r.next();return P.done?(n=!0,!1):(i=wa([i,P.value]),!0)},a=async()=>i.length>0?i.length:n?-1:(await s(),a()),o=async P=>{if(i.length===P){const M=i;return i=new Uint8Array,M}if(i.length>P){const M=i.subarray(0,P);return i=i.subarray(P),M}if(await s())return o(P);throw console.log(new TextDecoder().decode(i)),new Error(`fail to read bytes(${i.length}/${P} byte) in stream`)},d=new Uint32Array(1),b=new Uint8Array(d.buffer);return Object.assign(r,{available:a,readBinary:o,readInt:async()=>{const P=await o(4);return b.set(P),d[0]}})},_a=async(t,e={})=>{const r=[];for await(const i of va(t.getReader()))e.map&&r.push(e.map(i));const n=e.complete?.(r);return{maps:r,result:n}},Ko=async t=>(await _a(t,{map(e){return e},complete(e){return wa(e)}})).result;class Bi{constructor(e){Object.defineProperty(this,"strategy",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_on_cancel_signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_on_pull_signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.stream=new ReadableStream({cancel:r=>{this._on_cancel_signal?.emit(r)},start:r=>{this.controller=r},pull:()=>{this._on_pull_signal?.emit()}},this.strategy)}get onCancel(){return(this._on_cancel_signal??(this._on_cancel_signal=Le())).listen}get onPull(){return(this._on_pull_signal??(this._on_pull_signal=Le())).listen}}class Ai{constructor(){Object.defineProperty(this,"streamOut",{enumerable:!0,configurable:!0,writable:!0,value:new Bi}),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:this.streamOut.controller}),Object.defineProperty(this,"_isClosedForSend",{enumerable:!0,configurable:!0,writable:!0,value:!1})}get stream(){return this.streamOut.stream}get isClosedForSend(){return this._isClosedForSend}send(e){if(this._isClosedForSend){console.error("Channel send is close!!");return}this.controller.enqueue(e)}close(e){console.debug("channel_close",e),this._isClosedForSend=!0,this.controller.close()}[Symbol.asyncIterator](){return Qr(this.streamOut.stream)}}const zo=new TextEncoder,yt=(t,e)=>{if(e==="base64"){const r=atob(t),n=new Uint8Array(r.length);for(let i=0;i<r.length;i++)n[i]=r.charCodeAt(i);return n}else if(e==="hex"){const r=new Uint8Array(t.length/2);for(let n=0;n<r.length;n++){const i=n+n;r[n]=parseInt(t.slice(i,i+2),16)}return r}return zo.encode(t)},Jo=new TextDecoder,st=(t,e)=>{if(e==="base64"){let r="";const n=mr(t);for(const i of n)r+=String.fromCharCode(i);return btoa(r)}else if(e==="hex"){let r="";const n=mr(t);for(const i of n)r+=i.toString(16).padStart(2,"0");return r}return Jo.decode(t)};function Go(t){const e=Array.from(t,r=>String.fromCodePoint(r)).join("");return btoa(e)}let Li;try{Li=new TextDecoder}catch{}let w,Bt,f=0;const Qo=105,Xo=57342,Zo=57343,Ts=57337,Fs=6,Ut={};let Er=11281e4,Qe=1681e4,x={},Q,Tn,Fn=0,Kr=0,ee,Re,Z=[],Ci=[],pe,ce,Br,Ns={useRecords:!1,mapsAsObjects:!0},zr=!1,Sa=2;try{new Function("")}catch{Sa=1/0}class Jr{constructor(e){if(e&&((e.keyMap||e._keyMap)&&!e.useRecords&&(e.useRecords=!1,e.mapsAsObjects=!0),e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap)){this.mapKey=new Map;for(let[r,n]of Object.entries(e.keyMap))this.mapKey.set(n,r)}Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let r=new Map;for(let[n,i]of Object.entries(e))r.set(this._keyMap.hasOwnProperty(n)?this._keyMap[n]:n,i);return r}decodeKeys(e){if(!this._keyMap||e.constructor.name!="Map")return e;if(!this._mapKey){this._mapKey=new Map;for(let[n,i]of Object.entries(this._keyMap))this._mapKey.set(i,n)}let r={};return e.forEach((n,i)=>r[Ee(this._mapKey.has(i)?this._mapKey.get(i):i)]=n),r}mapDecode(e,r){let n=this.decode(e);return this._keyMap&&n.constructor.name==="Array"?n.map(i=>this.decodeKeys(i)):n}decode(e,r){if(w)return Ra(()=>(ki(),this?this.decode(e,r):Jr.prototype.decode.call(Ns,e,r)));Bt=r>-1?r:e.length,f=0,Kr=0,Tn=null,ee=null,w=e;try{ce=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(n){throw w=null,e instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof Jr){if(x=this,pe=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return Q=this.structures,un();(!Q||Q.length>0)&&(Q=[])}else x=Ns,(!Q||Q.length>0)&&(Q=[]),pe=null;return un()}decodeMultiple(e,r){let n,i=0;try{let s=e.length;zr=!0;let a=this?this.decode(e,s):ls.decode(e,s);if(r){if(r(a)===!1)return;for(;f<s;)if(i=f,r(un())===!1)return}else{for(n=[a];f<s;)i=f,n.push(un());return n}}catch(s){throw s.lastPosition=i,s.values=n,s}finally{zr=!1,ki()}}}function un(){try{let t=F();if(ee){if(f>=ee.postBundlePosition){let e=new Error("Unexpected bundle position");throw e.incomplete=!0,e}f=ee.postBundlePosition,ee=null}if(f==Bt)Q=null,w=null,Re&&(Re=null);else if(f>Bt){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}else if(!zr)throw new Error("Data read, but end of buffer not reached");return t}catch(t){throw ki(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function F(){let t=w[f++],e=t>>5;if(t=t&31,t>23)switch(t){case 24:t=w[f++];break;case 25:if(e==7)return rc();t=ce.getUint16(f),f+=2;break;case 26:if(e==7){let r=ce.getFloat32(f);if(x.useFloat32>2){let n=cs[(w[f]&127)<<1|w[f+1]>>7];return f+=4,(n*r+(r>0?.5:-.5)>>0)/n}return f+=4,r}t=ce.getUint32(f),f+=4;break;case 27:if(e==7){let r=ce.getFloat64(f);return f+=8,r}if(e>1){if(ce.getUint32(f)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");t=ce.getUint32(f+4)}else x.int64AsNumber?(t=ce.getUint32(f)*4294967296,t+=ce.getUint32(f+4)):t=ce.getBigUint64(f);f+=8;break;case 31:switch(e){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let r=[],n,i=0;for(;(n=F())!=Ut;){if(i>=Er)throw new Error(`Array length exceeds ${Er}`);r[i++]=n}return e==4?r:e==3?r.join(""):Buffer.concat(r);case 5:let s;if(x.mapsAsObjects){let a={},o=0;if(x.keyMap)for(;(s=F())!=Ut;){if(o++>=Qe)throw new Error(`Property count exceeds ${Qe}`);a[Ee(x.decodeKey(s))]=F()}else for(;(s=F())!=Ut;){if(o++>=Qe)throw new Error(`Property count exceeds ${Qe}`);a[Ee(s)]=F()}return a}else{Br&&(x.mapsAsObjects=!0,Br=!1);let a=new Map;if(x.keyMap){let o=0;for(;(s=F())!=Ut;){if(o++>=Qe)throw new Error(`Map size exceeds ${Qe}`);a.set(x.decodeKey(s),F())}}else{let o=0;for(;(s=F())!=Ut;){if(o++>=Qe)throw new Error(`Map size exceeds ${Qe}`);a.set(s,F())}}return a}case 7:return Ut;default:throw new Error("Invalid major type for indefinite length "+e)}default:throw new Error("Unknown token "+t)}switch(e){case 0:return t;case 1:return~t;case 2:return tc(t);case 3:if(Kr>=f)return Tn.slice(f-Fn,(f+=t)-Fn);if(Kr==0&&Bt<140&&t<32){let i=t<16?Pa(t):ec(t);if(i!=null)return i}return Yo(t);case 4:if(t>=Er)throw new Error(`Array length exceeds ${Er}`);let r=new Array(t);for(let i=0;i<t;i++)r[i]=F();return r;case 5:if(t>=Qe)throw new Error(`Map size exceeds ${Er}`);if(x.mapsAsObjects){let i={};if(x.keyMap)for(let s=0;s<t;s++)i[Ee(x.decodeKey(F()))]=F();else for(let s=0;s<t;s++)i[Ee(F())]=F();return i}else{Br&&(x.mapsAsObjects=!0,Br=!1);let i=new Map;if(x.keyMap)for(let s=0;s<t;s++)i.set(x.decodeKey(F()),F());else for(let s=0;s<t;s++)i.set(F(),F());return i}case 6:if(t>=Ts){let i=Q[t&8191];if(i)return i.read||(i.read=$i(i)),i.read();if(t<65536){if(t==Zo){let s=nr(),a=F(),o=F();Mi(a,o);let d={};if(x.keyMap)for(let b=2;b<s;b++){let _=x.decodeKey(o[b-2]);d[Ee(_)]=F()}else for(let b=2;b<s;b++){let _=o[b-2];d[Ee(_)]=F()}return d}else if(t==Xo){let s=nr(),a=F();for(let o=2;o<s;o++)Mi(a++,F());return F()}else if(t==Ts)return cc();if(x.getShared&&(os(),i=Q[t&8191],i))return i.read||(i.read=$i(i)),i.read()}}let n=Z[t];if(n)return n.handlesRead?n(F):n(F());{let i=F();for(let s=0;s<Ci.length;s++){let a=Ci[s](t,i);if(a!==void 0)return a}return new Ct(i,t)}case 7:switch(t){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:let i=(pe||Ot())[t];if(i!==void 0)return i;throw new Error("Unknown token "+t)}default:if(isNaN(t)){let i=new Error("Unexpected end of CBOR data");throw i.incomplete=!0,i}throw new Error("Unknown CBOR token "+t)}}const Bs=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function $i(t){if(!t)throw new Error("Structure is required in record definition");function e(){let r=w[f++];if(r=r&31,r>23)switch(r){case 24:r=w[f++];break;case 25:r=ce.getUint16(f),f+=2;break;case 26:r=ce.getUint32(f),f+=4;break;default:throw new Error("Expected array header, but got "+w[f-1])}let n=this.compiledReader;for(;n;){if(n.propertyCount===r)return n(F);n=n.next}if(this.slowReads++>=Sa){let s=this.length==r?this:this.slice(0,r);return n=x.keyMap?new Function("r","return {"+s.map(a=>x.decodeKey(a)).map(a=>Bs.test(a)?Ee(a)+":r()":"["+JSON.stringify(a)+"]:r()").join(",")+"}"):new Function("r","return {"+s.map(a=>Bs.test(a)?Ee(a)+":r()":"["+JSON.stringify(a)+"]:r()").join(",")+"}"),this.compiledReader&&(n.next=this.compiledReader),n.propertyCount=r,this.compiledReader=n,n(F)}let i={};if(x.keyMap)for(let s=0;s<r;s++)i[Ee(x.decodeKey(this[s]))]=F();else for(let s=0;s<r;s++)i[Ee(this[s])]=F();return i}return t.slowReads=0,e}function Ee(t){if(typeof t=="string")return t==="__proto__"?"__proto_":t;if(typeof t=="number"||typeof t=="boolean"||typeof t=="bigint")return t.toString();if(t==null)return t+"";throw new Error("Invalid property name type "+typeof t)}let Yo=Di;function Di(t){let e;if(t<16&&(e=Pa(t)))return e;if(t>64&&Li)return Li.decode(w.subarray(f,f+=t));const r=f+t,n=[];for(e="";f<r;){const i=w[f++];if((i&128)===0)n.push(i);else if((i&224)===192){const s=w[f++]&63;n.push((i&31)<<6|s)}else if((i&240)===224){const s=w[f++]&63,a=w[f++]&63;n.push((i&31)<<12|s<<6|a)}else if((i&248)===240){const s=w[f++]&63,a=w[f++]&63,o=w[f++]&63;let d=(i&7)<<18|s<<12|a<<6|o;d>65535&&(d-=65536,n.push(d>>>10&1023|55296),d=56320|d&1023),n.push(d)}else n.push(i);n.length>=4096&&(e+=re.apply(String,n),n.length=0)}return n.length>0&&(e+=re.apply(String,n)),e}let re=String.fromCharCode;function ec(t){let e=f,r=new Array(t);for(let n=0;n<t;n++){const i=w[f++];if((i&128)>0){f=e;return}r[n]=i}return re.apply(String,r)}function Pa(t){if(t<4)if(t<2){if(t===0)return"";{let e=w[f++];if((e&128)>1){f-=1;return}return re(e)}}else{let e=w[f++],r=w[f++];if((e&128)>0||(r&128)>0){f-=2;return}if(t<3)return re(e,r);let n=w[f++];if((n&128)>0){f-=3;return}return re(e,r,n)}else{let e=w[f++],r=w[f++],n=w[f++],i=w[f++];if((e&128)>0||(r&128)>0||(n&128)>0||(i&128)>0){f-=4;return}if(t<6){if(t===4)return re(e,r,n,i);{let s=w[f++];if((s&128)>0){f-=5;return}return re(e,r,n,i,s)}}else if(t<8){let s=w[f++],a=w[f++];if((s&128)>0||(a&128)>0){f-=6;return}if(t<7)return re(e,r,n,i,s,a);let o=w[f++];if((o&128)>0){f-=7;return}return re(e,r,n,i,s,a,o)}else{let s=w[f++],a=w[f++],o=w[f++],d=w[f++];if((s&128)>0||(a&128)>0||(o&128)>0||(d&128)>0){f-=8;return}if(t<10){if(t===8)return re(e,r,n,i,s,a,o,d);{let b=w[f++];if((b&128)>0){f-=9;return}return re(e,r,n,i,s,a,o,d,b)}}else if(t<12){let b=w[f++],_=w[f++];if((b&128)>0||(_&128)>0){f-=10;return}if(t<11)return re(e,r,n,i,s,a,o,d,b,_);let P=w[f++];if((P&128)>0){f-=11;return}return re(e,r,n,i,s,a,o,d,b,_,P)}else{let b=w[f++],_=w[f++],P=w[f++],M=w[f++];if((b&128)>0||(_&128)>0||(P&128)>0||(M&128)>0){f-=12;return}if(t<14){if(t===12)return re(e,r,n,i,s,a,o,d,b,_,P,M);{let te=w[f++];if((te&128)>0){f-=13;return}return re(e,r,n,i,s,a,o,d,b,_,P,M,te)}}else{let te=w[f++],ke=w[f++];if((te&128)>0||(ke&128)>0){f-=14;return}if(t<15)return re(e,r,n,i,s,a,o,d,b,_,P,M,te,ke);let de=w[f++];if((de&128)>0){f-=15;return}return re(e,r,n,i,s,a,o,d,b,_,P,M,te,ke,de)}}}}}function tc(t){return x.copyBuffers?Uint8Array.prototype.slice.call(w,f,f+=t):w.subarray(f,f+=t)}let ja=new Float32Array(1),fn=new Uint8Array(ja.buffer,0,4);function rc(){let t=w[f++],e=w[f++],r=(t&127)>>2;if(r===31)return e||t&3?NaN:t&128?-1/0:1/0;if(r===0){let n=((t&3)<<8|e)/16777216;return t&128?-n:n}return fn[3]=t&128|(r>>1)+56,fn[2]=(t&7)<<5|e>>3,fn[1]=e<<5,fn[0]=0,ja[0]}new Array(4096);class Ct{constructor(e,r){this.value=e,this.tag=r}}Z[0]=t=>new Date(t);Z[1]=t=>new Date(Math.round(t*1e3));Z[2]=t=>{let e=BigInt(0);for(let r=0,n=t.byteLength;r<n;r++)e=BigInt(t[r])+(e<<BigInt(8));return e};Z[3]=t=>BigInt(-1)-Z[2](t);Z[4]=t=>+(t[1]+"e"+t[0]);Z[5]=t=>t[1]*Math.exp(t[0]*Math.log(2));const Mi=(t,e)=>{t=t-57344;let r=Q[t];r&&r.isShared&&((Q.restoreStructures||(Q.restoreStructures=[]))[t]=r),Q[t]=e,e.read=$i(e)};Z[Qo]=t=>{let e=t.length,r=t[1];Mi(t[0],r);let n={};for(let i=2;i<e;i++){let s=r[i-2];n[Ee(s)]=t[i]}return n};Z[14]=t=>ee?ee[0].slice(ee.position0,ee.position0+=t):new Ct(t,14);Z[15]=t=>ee?ee[1].slice(ee.position1,ee.position1+=t):new Ct(t,15);let nc={Error,RegExp};Z[27]=t=>(nc[t[0]]||Error)(t[1],t[2]);const Oa=t=>{if(w[f++]!=132){let r=new Error("Packed values structure must be followed by a 4 element array");throw w.length<f&&(r.incomplete=!0),r}let e=t();if(!e||!e.length){let r=new Error("Packed values structure must be followed by a 4 element array");throw r.incomplete=!0,r}return pe=pe?e.concat(pe.slice(e.length)):e,pe.prefixes=t(),pe.suffixes=t(),t()};Oa.handlesRead=!0;Z[51]=Oa;Z[Fs]=t=>{if(!pe)if(x.getShared)os();else return new Ct(t,Fs);if(typeof t=="number")return pe[16+(t>=0?2*t:-2*t-1)];let e=new Error("No support for non-integer packed references yet");throw t===void 0&&(e.incomplete=!0),e};Z[28]=t=>{Re||(Re=new Map,Re.id=0);let e=Re.id++,r=f,n=w[f],i;n>>5==4?i=[]:i={};let s={target:i};Re.set(e,s);let a=t();return s.used?(Object.getPrototypeOf(i)!==Object.getPrototypeOf(a)&&(f=r,i=a,Re.set(e,{target:i}),a=t()),Object.assign(i,a)):(s.target=a,a)};Z[28].handlesRead=!0;Z[29]=t=>{let e=Re.get(t);return e.used=!0,e.target};Z[258]=t=>new Set(t);(Z[259]=t=>(x.mapsAsObjects&&(x.mapsAsObjects=!1,Br=!0),t())).handlesRead=!0;function qt(t,e){return typeof t=="string"?t+e:t instanceof Array?t.concat(e):Object.assign({},t,e)}function Ot(){if(!pe)if(x.getShared)os();else throw new Error("No packed values available");return pe}const ic=1399353956;Ci.push((t,e)=>{if(t>=225&&t<=255)return qt(Ot().prefixes[t-224],e);if(t>=28704&&t<=32767)return qt(Ot().prefixes[t-28672],e);if(t>=1879052288&&t<=2147483647)return qt(Ot().prefixes[t-1879048192],e);if(t>=216&&t<=223)return qt(e,Ot().suffixes[t-216]);if(t>=27647&&t<=28671)return qt(e,Ot().suffixes[t-27639]);if(t>=1811940352&&t<=1879048191)return qt(e,Ot().suffixes[t-1811939328]);if(t==ic)return{packedValues:pe,structures:Q.slice(0),version:e};if(t==55799)return e});const sc=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,As=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],ac=[64,68,69,70,71,72,77,78,79,85,86];for(let t=0;t<As.length;t++)oc(As[t],ac[t]);function oc(t,e){let r="get"+t.name.slice(0,-5),n;typeof t=="function"?n=t.BYTES_PER_ELEMENT:t=null;for(let i=0;i<2;i++){if(!i&&n==1)continue;let s=n==2?1:n==4?2:n==8?3:0;Z[i?e:e-4]=n==1||i==sc?a=>{if(!t)throw new Error("Could not find typed array for code "+e);return!x.copyBuffers&&(n===1||n===2&&!(a.byteOffset&1)||n===4&&!(a.byteOffset&3)||n===8&&!(a.byteOffset&7))?new t(a.buffer,a.byteOffset,a.byteLength>>s):new t(Uint8Array.prototype.slice.call(a,0).buffer)}:a=>{if(!t)throw new Error("Could not find typed array for code "+e);let o=new DataView(a.buffer,a.byteOffset,a.byteLength),d=a.length>>s,b=new t(d),_=o[r];for(let P=0;P<d;P++)b[P]=_.call(o,P<<s,i);return b}}}function cc(){let t=nr(),e=f+F();for(let n=2;n<t;n++){let i=nr();f+=i}let r=f;return f=e,ee=[Di(nr()),Di(nr())],ee.position0=0,ee.position1=0,ee.postBundlePosition=f,f=r,F()}function nr(){let t=w[f++]&31;if(t>23)switch(t){case 24:t=w[f++];break;case 25:t=ce.getUint16(f),f+=2;break;case 26:t=ce.getUint32(f),f+=4;break}return t}function os(){if(x.getShared){let t=Ra(()=>(w=null,x.getShared()))||{},e=t.structures||[];x.sharedVersion=t.version,pe=x.sharedValues=t.packedValues,Q===!0?x.structures=Q=e:Q.splice.apply(Q,[0,e.length].concat(e))}}function Ra(t){let e=Bt,r=f,n=Fn,i=Kr,s=Tn,a=Re,o=ee,d=new Uint8Array(w.slice(0,Bt)),b=Q,_=x,P=zr,M=t();return Bt=e,f=r,Fn=n,Kr=i,Tn=s,Re=a,ee=o,w=d,zr=P,Q=b,x=_,ce=new DataView(w.buffer,w.byteOffset,w.byteLength),M}function ki(){w=null,Re=null,Q=null}const cs=new Array(147);for(let t=0;t<256;t++)cs[t]=+("1e"+Math.floor(45.15-t*.30103));let ls=new Jr({useRecords:!1});const lc=ls.decode;ls.decodeMultiple;let wn;try{wn=new TextEncoder}catch{}let Ui,Ea;const zn=typeof globalThis=="object"&&globalThis.Buffer,Xr=typeof zn<"u",ri=Xr?zn.allocUnsafeSlow:Uint8Array,Ls=Xr?zn:Uint8Array,Cs=256,$s=Xr?4294967296:2144337920;let ni,l,W,c=0,ot,Y=null;const uc=61440,fc=/[\u0080-\uFFFF]/,we=Symbol("record-id");class dc extends Jr{constructor(e){super(e),this.offset=0;let r,n,i,s,a;e=e||{};let o=Ls.prototype.utf8Write?function(u,v,h){return l.utf8Write(u,v,h)}:wn&&wn.encodeInto?function(u,v){return wn.encodeInto(u,l.subarray(v)).written}:!1,d=this,b=e.structures||e.saveStructures,_=e.maxSharedStructures;if(_==null&&(_=b?128:0),_>8190)throw new Error("Maximum maxSharedStructure is 8190");let P=e.sequential;P&&(_=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let M,te,ke=e.sharedValues,de;if(ke){de=Object.create(null);for(let u=0,v=ke.length;u<v;u++)de[ke[u]]=u}let Ge=[],Yn=0,ln=0;this.mapEncode=function(u,v){return this._keyMap&&!this._mapped&&u.constructor.name==="Array"&&(u=u.map(h=>this.encodeKeys(h))),this.encode(u,v)},this.encode=function(u,v){if(l||(l=new ri(8192),W=new DataView(l.buffer,0,8192),c=0),ot=l.length-10,ot-c<2048?(l=new ri(l.length),W=new DataView(l.buffer,0,l.length),ot=l.length-10,c=0):v===ks&&(c=c+7&2147483640),r=c,d.useSelfDescribedHeader&&(W.setUint32(c,3654940416),c+=3),a=d.structuredClone?new Map:null,d.bundleStrings&&typeof u!="string"?(Y=[],Y.size=1/0):Y=null,n=d.structures,n){if(n.uninitialized){let g=d.getShared()||{};d.structures=n=g.structures||[],d.sharedVersion=g.version;let y=d.sharedValues=g.packedValues;if(y){de={};for(let S=0,j=y.length;S<j;S++)de[y[S]]=S}}let h=n.length;if(h>_&&!P&&(h=_),!n.transitions){n.transitions=Object.create(null);for(let g=0;g<h;g++){let y=n[g];if(!y)continue;let S,j=n.transitions;for(let O=0,I=y.length;O<I;O++){j[we]===void 0&&(j[we]=g);let N=y[O];S=j[N],S||(S=j[N]=Object.create(null)),j=S}j[we]=g|1048576}}P||(n.nextId=h)}if(i&&(i=!1),s=n||[],te=de,e.pack){let h=new Map;if(h.values=[],h.encoder=d,h.maxValues=e.maxPrivatePackedValues||(de?16:1/0),h.objectMap=de||!1,h.samplingPackedValues=M,vn(u,h),h.values.length>0){l[c++]=216,l[c++]=51,We(4);let g=h.values;B(g),We(0),We(0),te=Object.create(de||null);for(let y=0,S=g.length;y<S;y++)te[g[y]]=y}}ni=v&si;try{if(ni)return;if(B(u),Y&&Ms(r,B),d.offset=c,a&&a.idsToInsert){c+=a.idsToInsert.length*2,c>ot&&Mt(c),d.offset=c;let h=yc(l.subarray(r,c),a.idsToInsert);return a=null,h}return v&ks?(l.start=r,l.end=c,l):l.subarray(r,c)}finally{if(n){if(ln<10&&ln++,n.length>_&&(n.length=_),Yn>1e4)n.transitions=null,ln=0,Yn=0,Ge.length>0&&(Ge=[]);else if(Ge.length>0&&!P){for(let h=0,g=Ge.length;h<g;h++)Ge[h][we]=void 0;Ge=[]}}if(i&&d.saveShared){d.structures.length>_&&(d.structures=d.structures.slice(0,_));let h=l.subarray(r,c);return d.updateSharedData()===!1?d.encode(u):h}v&gc&&(c=r)}},this.findCommonStringsToPack=()=>(M=new Map,de||(de=Object.create(null)),u=>{let v=u&&u.threshold||4,h=this.pack?u.maxPrivatePackedValues||16:0;ke||(ke=this.sharedValues=[]);for(let[g,y]of M)y.count>v&&(de[g]=h++,ke.push(g),i=!0);for(;this.saveShared&&this.updateSharedData()===!1;);M=null});const B=u=>{c>ot&&(l=Mt(c));var v=typeof u,h;if(v==="string"){if(te){let j=te[u];if(j>=0){j<16?l[c++]=j+224:(l[c++]=198,j&1?B(15-j>>1):B(j-16>>1));return}else if(M&&!e.pack){let O=M.get(u);O?O.count++:M.set(u,{count:1})}}let g=u.length;if(Y&&g>=4&&g<1024){if((Y.size+=g)>uc){let O,I=(Y[0]?Y[0].length*3+Y[1].length:0)+10;c+I>ot&&(l=Mt(c+I)),l[c++]=217,l[c++]=223,l[c++]=249,l[c++]=Y.position?132:130,l[c++]=26,O=c-r,c+=4,Y.position&&Ms(r,B),Y=["",""],Y.size=0,Y.position=O}let j=fc.test(u);Y[j?0:1]+=u,l[c++]=j?206:207,B(g);return}let y;g<32?y=1:g<256?y=2:g<65536?y=3:y=5;let S=g*3;if(c+S>ot&&(l=Mt(c+S)),g<64||!o){let j,O,I,N=c+y;for(j=0;j<g;j++)O=u.charCodeAt(j),O<128?l[N++]=O:O<2048?(l[N++]=O>>6|192,l[N++]=O&63|128):(O&64512)===55296&&((I=u.charCodeAt(j+1))&64512)===56320?(O=65536+((O&1023)<<10)+(I&1023),j++,l[N++]=O>>18|240,l[N++]=O>>12&63|128,l[N++]=O>>6&63|128,l[N++]=O&63|128):(l[N++]=O>>12|224,l[N++]=O>>6&63|128,l[N++]=O&63|128);h=N-c-y}else h=o(u,c+y,S);h<24?l[c++]=96|h:h<256?(y<2&&l.copyWithin(c+2,c+1,c+1+h),l[c++]=120,l[c++]=h):h<65536?(y<3&&l.copyWithin(c+3,c+2,c+2+h),l[c++]=121,l[c++]=h>>8,l[c++]=h&255):(y<5&&l.copyWithin(c+5,c+3,c+3+h),l[c++]=122,W.setUint32(c,h),c+=4),c+=h}else if(v==="number")if(!this.alwaysUseFloat&&u>>>0===u)u<24?l[c++]=u:u<256?(l[c++]=24,l[c++]=u):u<65536?(l[c++]=25,l[c++]=u>>8,l[c++]=u&255):(l[c++]=26,W.setUint32(c,u),c+=4);else if(!this.alwaysUseFloat&&u>>0===u)u>=-24?l[c++]=31-u:u>=-256?(l[c++]=56,l[c++]=~u):u>=-65536?(l[c++]=57,W.setUint16(c,~u),c+=2):(l[c++]=58,W.setUint32(c,~u),c+=4);else{let g;if((g=this.useFloat32)>0&&u<4294967296&&u>=-2147483648){l[c++]=250,W.setFloat32(c,u);let y;if(g<4||(y=u*cs[(l[c]&127)<<1|l[c+1]>>7])>>0===y){c+=4;return}else c--}l[c++]=251,W.setFloat64(c,u),c+=8}else if(v==="object")if(!u)l[c++]=246;else{if(a){let y=a.get(u);if(y){if(l[c++]=216,l[c++]=29,l[c++]=25,!y.references){let S=a.idsToInsert||(a.idsToInsert=[]);y.references=[],S.push(y)}y.references.push(c-r),c+=2;return}else a.set(u,{offset:c-r})}let g=u.constructor;if(g===Object)ei(u);else if(g===Array){h=u.length,h<24?l[c++]=128|h:We(h);for(let y=0;y<h;y++)B(u[y])}else if(g===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(l[c++]=217,l[c++]=1,l[c++]=3),h=u.size,h<24?l[c++]=160|h:h<256?(l[c++]=184,l[c++]=h):h<65536?(l[c++]=185,l[c++]=h>>8,l[c++]=h&255):(l[c++]=186,W.setUint32(c,h),c+=4),d.keyMap)for(let[y,S]of u)B(d.encodeKey(y)),B(S);else for(let[y,S]of u)B(y),B(S);else{for(let y=0,S=Ui.length;y<S;y++){let j=Ea[y];if(u instanceof j){let O=Ui[y],I=O.tag;I==null&&(I=O.getTag&&O.getTag.call(this,u)),I<24?l[c++]=192|I:I<256?(l[c++]=216,l[c++]=I):I<65536?(l[c++]=217,l[c++]=I>>8,l[c++]=I&255):I>-1&&(l[c++]=218,W.setUint32(c,I),c+=4),O.encode.call(this,u,B,Mt);return}}if(u[Symbol.iterator]){if(ni){let y=new Error("Iterable should be serialized as iterator");throw y.iteratorNotHandled=!0,y}l[c++]=159;for(let y of u)B(y);l[c++]=255;return}if(u[Symbol.asyncIterator]||ii(u)){let y=new Error("Iterable/blob should be serialized as iterator");throw y.iteratorNotHandled=!0,y}if(this.useToJSON&&u.toJSON){const y=u.toJSON();if(y!==u)return B(y)}ei(u)}}else if(v==="boolean")l[c++]=u?245:244;else if(v==="bigint"){if(u<BigInt(1)<<BigInt(64)&&u>=0)l[c++]=27,W.setBigUint64(c,u);else if(u>-(BigInt(1)<<BigInt(64))&&u<0)l[c++]=59,W.setBigUint64(c,-u-BigInt(1));else if(this.largeBigIntToFloat)l[c++]=251,W.setFloat64(c,Number(u));else{u>=BigInt(0)?l[c++]=194:(l[c++]=195,u=BigInt(-1)-u);let g=[];for(;u;)g.push(Number(u&BigInt(255))),u>>=BigInt(8);qi(new Uint8Array(g.reverse()),Mt);return}c+=8}else if(v==="undefined")l[c++]=247;else throw new Error("Unknown type: "+v)},ei=this.useRecords===!1?this.variableMapSize?u=>{let v=Object.keys(u),h=Object.values(u),g=v.length;if(g<24?l[c++]=160|g:g<256?(l[c++]=184,l[c++]=g):g<65536?(l[c++]=185,l[c++]=g>>8,l[c++]=g&255):(l[c++]=186,W.setUint32(c,g),c+=4),d.keyMap)for(let y=0;y<g;y++)B(d.encodeKey(v[y])),B(h[y]);else for(let y=0;y<g;y++)B(v[y]),B(h[y])}:u=>{l[c++]=185;let v=c-r;c+=2;let h=0;if(d.keyMap)for(let g in u)(typeof u.hasOwnProperty!="function"||u.hasOwnProperty(g))&&(B(d.encodeKey(g)),B(u[g]),h++);else for(let g in u)(typeof u.hasOwnProperty!="function"||u.hasOwnProperty(g))&&(B(g),B(u[g]),h++);l[v+++r]=h>>8,l[v+r]=h&255}:(u,v)=>{let h,g=s.transitions||(s.transitions=Object.create(null)),y=0,S=0,j,O;if(this.keyMap){O=Object.keys(u).map(N=>this.encodeKey(N)),S=O.length;for(let N=0;N<S;N++){let Is=O[N];h=g[Is],h||(h=g[Is]=Object.create(null),y++),g=h}}else for(let N in u)(typeof u.hasOwnProperty!="function"||u.hasOwnProperty(N))&&(h=g[N],h||(g[we]&1048576&&(j=g[we]&65535),h=g[N]=Object.create(null),y++),g=h,S++);let I=g[we];if(I!==void 0)I&=65535,l[c++]=217,l[c++]=I>>8|224,l[c++]=I&255;else if(O||(O=g.__keys__||(g.__keys__=Object.keys(u))),j===void 0?(I=s.nextId++,I||(I=0,s.nextId=1),I>=Cs&&(s.nextId=(I=_)+1)):I=j,s[I]=O,I<_){l[c++]=217,l[c++]=I>>8|224,l[c++]=I&255,g=s.transitions;for(let N=0;N<S;N++)(g[we]===void 0||g[we]&1048576)&&(g[we]=I),g=g[O[N]];g[we]=I|1048576,i=!0}else{if(g[we]=I,W.setUint32(c,3655335680),c+=3,y&&(Yn+=ln*y),Ge.length>=Cs-_&&(Ge.shift()[we]=void 0),Ge.push(g),We(S+2),B(57344+I),B(O),v)return;for(let N in u)(typeof u.hasOwnProperty!="function"||u.hasOwnProperty(N))&&B(u[N]);return}if(S<24?l[c++]=128|S:We(S),!v)for(let N in u)(typeof u.hasOwnProperty!="function"||u.hasOwnProperty(N))&&B(u[N])},Mt=u=>{let v;if(u>16777216){if(u-r>$s)throw new Error("Encoded buffer would be larger than maximum buffer size");v=Math.min($s,Math.round(Math.max((u-r)*(u>67108864?1.25:2),4194304)/4096)*4096)}else v=(Math.max(u-r<<2,l.length-1)>>12)+1<<12;let h=new ri(v);return W=new DataView(h.buffer,0,v),l.copy?l.copy(h,0,r,u):h.set(l.slice(r,u)),c-=r,r=0,ot=h.length-10,l=h};let jt=100,Os=1e3;this.encodeAsIterable=function(u,v){return Rs(u,v,kt)},this.encodeAsAsyncIterable=function(u,v){return Rs(u,v,Es)};function*kt(u,v,h){let g=u.constructor;if(g===Object){let y=d.useRecords!==!1;y?ei(u,!0):Ds(Object.keys(u).length,160);for(let S in u){let j=u[S];y||B(S),j&&typeof j=="object"?v[S]?yield*kt(j,v[S]):yield*ti(j,v,S):B(j)}}else if(g===Array){let y=u.length;We(y);for(let S=0;S<y;S++){let j=u[S];j&&(typeof j=="object"||c-r>jt)?v.element?yield*kt(j,v.element):yield*ti(j,v,"element"):B(j)}}else if(u[Symbol.iterator]&&!u.buffer){l[c++]=159;for(let y of u)y&&(typeof y=="object"||c-r>jt)?v.element?yield*kt(y,v.element):yield*ti(y,v,"element"):B(y);l[c++]=255}else ii(u)?(Ds(u.size,64),yield l.subarray(r,c),yield u,Rr()):u[Symbol.asyncIterator]?(l[c++]=159,yield l.subarray(r,c),yield u,Rr(),l[c++]=255):B(u);h&&c>r?yield l.subarray(r,c):c-r>jt&&(yield l.subarray(r,c),Rr())}function*ti(u,v,h){let g=c-r;try{B(u),c-r>jt&&(yield l.subarray(r,c),Rr())}catch(y){if(y.iteratorNotHandled)v[h]={},c=r+g,yield*kt.call(this,u,v[h]);else throw y}}function Rr(){jt=Os,d.encode(null,si)}function Rs(u,v,h){return v&&v.chunkThreshold?jt=Os=v.chunkThreshold:jt=100,u&&typeof u=="object"?(d.encode(null,si),h(u,d.iterateProperties||(d.iterateProperties={}),!0)):[d.encode(u)]}async function*Es(u,v){for(let h of kt(u,v,!0)){let g=h.constructor;if(g===Ls||g===Uint8Array)yield h;else if(ii(h)){let y=h.stream().getReader(),S;for(;!(S=await y.read()).done;)yield S.value}else if(h[Symbol.asyncIterator])for await(let y of h)Rr(),y?yield*Es(y,v.async||(v.async={})):yield d.encode(y);else yield h}}}useBuffer(e){l=e,W=new DataView(l.buffer,l.byteOffset,l.byteLength),c=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let r=this.structures.slice(0),n=new Ia(r,this.sharedValues,this.sharedVersion),i=this.saveShared(n,s=>(s&&s.version||0)==e);return i===!1?(n=this.getShared()||{},this.structures=n.structures||[],this.sharedValues=n.packedValues,this.sharedVersion=n.version,this.structures.nextId=this.structures.length):r.forEach((s,a)=>this.structures[a]=s),i}}function Ds(t,e){t<24?l[c++]=e|t:t<256?(l[c++]=e|24,l[c++]=t):t<65536?(l[c++]=e|25,l[c++]=t>>8,l[c++]=t&255):(l[c++]=e|26,W.setUint32(c,t),c+=4)}class Ia{constructor(e,r,n){this.structures=e,this.packedValues=r,this.version=n}}function We(t){t<24?l[c++]=128|t:t<256?(l[c++]=152,l[c++]=t):t<65536?(l[c++]=153,l[c++]=t>>8,l[c++]=t&255):(l[c++]=154,W.setUint32(c,t),c+=4)}const pc=typeof Blob>"u"?function(){}:Blob;function ii(t){if(t instanceof pc)return!0;let e=t[Symbol.toStringTag];return e==="Blob"||e==="File"}function vn(t,e){switch(typeof t){case"string":if(t.length>3){if(e.objectMap[t]>-1||e.values.length>=e.maxValues)return;let n=e.get(t);if(n)++n.count==2&&e.values.push(t);else if(e.set(t,{count:1}),e.samplingPackedValues){let i=e.samplingPackedValues.get(t);i?i.count++:e.samplingPackedValues.set(t,{count:1})}}break;case"object":if(t)if(t instanceof Array)for(let n=0,i=t.length;n<i;n++)vn(t[n],e);else{let n=!e.encoder.useRecords;for(var r in t)t.hasOwnProperty(r)&&(n&&vn(r,e),vn(t[r],e))}break;case"function":console.log(t)}}const hc=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;Ea=[Date,Set,Error,RegExp,Ct,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,Ia];Ui=[{tag:1,encode(t,e){let r=t.getTime()/1e3;(this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296?(l[c++]=26,W.setUint32(c,r),c+=4):(l[c++]=251,W.setFloat64(c,r),c+=8)}},{tag:258,encode(t,e){let r=Array.from(t);e(r)}},{tag:27,encode(t,e){e([t.name,t.message])}},{tag:27,encode(t,e){e(["RegExp",t.source,t.flags])}},{getTag(t){return t.tag},encode(t,e){e(t.value)}},{encode(t,e,r){qi(t,r)}},{getTag(t){if(t.constructor===Uint8Array&&(this.tagUint8Array||Xr&&this.tagUint8Array!==!1))return 64},encode(t,e,r){qi(t,r)}},Ue(68,1),Ue(69,2),Ue(70,4),Ue(71,8),Ue(72,1),Ue(77,2),Ue(78,4),Ue(79,8),Ue(85,4),Ue(86,8),{encode(t,e){let r=t.packedValues||[],n=t.structures||[];if(r.values.length>0){l[c++]=216,l[c++]=51,We(4);let i=r.values;e(i),We(0),We(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let s=0,a=i.length;s<a;s++)packedObjectMap[i[s]]=s}if(n){W.setUint32(c,3655335424),c+=3;let i=n.slice(0);i.unshift(57344),i.push(new Ct(t.version,1399353956)),e(i)}else e(new Ct(t.version,1399353956))}}];function Ue(t,e){return!hc&&e>1&&(t-=4),{tag:t,encode:function(n,i){let s=n.byteLength,a=n.byteOffset||0,o=n.buffer||n;i(Xr?zn.from(o,a,s):new Uint8Array(o,a,s))}}}function qi(t,e){let r=t.byteLength;r<24?l[c++]=64+r:r<256?(l[c++]=88,l[c++]=r):r<65536?(l[c++]=89,l[c++]=r>>8,l[c++]=r&255):(l[c++]=90,W.setUint32(c,r),c+=4),c+r>=l.length&&e(c+r),l.set(t.buffer?t:new Uint8Array(t),c),c+=r}function yc(t,e){let r,n=e.length*2,i=t.length-n;e.sort((s,a)=>s.offset>a.offset?1:-1);for(let s=0;s<e.length;s++){let a=e[s];a.id=s;for(let o of a.references)t[o++]=s>>8,t[o]=s&255}for(;r=e.pop();){let s=r.offset;t.copyWithin(s+n,s,i),n-=2;let a=s+n;t[a++]=216,t[a++]=28,i=s}return t}function Ms(t,e){W.setUint32(Y.position+t,c-Y.position-t+1);let r=Y;Y=null,e(r[0]),e(r[1])}let us=new dc({useRecords:!1});const Zr=us.encode;us.encodeAsIterable;us.encodeAsAsyncIterable;const ks=512,gc=1024,si=2048;var gt;(function(t){t.LIFECYCLE="life",t.IPC="ipc"})(gt||(gt={}));const xa=t=>({type:t}),m=()=>(t,e,r)=>{const n=r.get;if(n===void 0)throw new Error(`${t}.${e} should has getter`);return r.get=function(){const i=n.call(this);return r.set?r.get=()=>i:(delete r.set,delete r.get,r.value=i,r.writable=!1),Object.defineProperty(this,e,r),i},r};class ve{constructor(e){Object.defineProperty(this,"getter",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"_first",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_value",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}get value(){return this._first&&(this._first=!1,this._value=this.getter()),this._value}reset(){this._first=!0,this._value=void 0}}const mc={},Us=bc(globalThis,mc);function bc(t,e){return new Proxy(t,{get(r,n,i){return n in e?e[n]:t[n]},set(r,n,i){return n in e&&delete e[n],t[n]=i,!0},deleteProperty(r,n){let i=!1;return n in e&&(delete e[n],i=!0),n in t&&(delete t[n],i=!0),i},ownKeys(r){const n=Reflect.ownKeys(t),i=Reflect.ownKeys(e),s=new Set(i);return[...n.filter(a=>!s.has(a)),...i]},defineProperty(r,n,i){return n in e&&delete e[n],Reflect.defineProperty(t,n,i),!0},getOwnPropertyDescriptor(r,n){return n in e?Reflect.getOwnPropertyDescriptor(e,n):Reflect.getOwnPropertyDescriptor(t,n)},has(r,n){return n in e||n in t}})}const wc=()=>qs??(qs="document"in Us?document.baseURI:"location"in Us&&(location.protocol==="http:"||location.protocol==="https:"||location.protocol==="file:"||location.protocol==="chrome-extension:")?location.href:"file:///");let qs;const Wi=(t,e=wc())=>new URL(t,e);class _e extends Headers{init(e,r){return this.has(e)===!1&&this.set(e,r),this}toJSON(){const e={};return this.forEach((r,n)=>{e[n.replace(/\w+/g,i=>i[0].toUpperCase()+i.slice(1))]=r}),e}}var V;(function(t){t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t.OPTIONS="OPTIONS",t.TRACE="TRACE",t.PATCH="PATCH",t.PURGE="PURGE",t.HEAD="HEAD"})(V||(V={}));const vc=t=>{if(t==null)return V.GET;switch(t.toUpperCase()){case V.GET:return V.GET;case V.POST:return V.POST;case V.PUT:return V.PUT;case V.DELETE:return V.DELETE;case V.OPTIONS:return V.OPTIONS;case V.TRACE:return V.TRACE;case V.PATCH:return V.PATCH;case V.PURGE:return V.PURGE;case V.HEAD:return V.HEAD}throw new Error(`invalid method: ${t}`)},_c=async t=>{const e=t.method??"GET",r=Ta(e,t.headers)?await Sc(t.body):"",n=jc(t.headers);return{method:e,body:r,headers:n}},Sc=async(t,e)=>{let r="";if((t instanceof FormData||t instanceof URLSearchParams)&&(t=await new Request("",{body:t}).blob()),t instanceof ReadableStream)r=t;else if(t instanceof Blob)t.size>=16*1024*1024&&(r=t?.stream()||""),r===""&&(r=new Uint8Array(await t.arrayBuffer()));else if(ba(t))r=mr(t);else if(typeof t=="string")r=t;else if(t)throw new Error(`unsupport body type: ${t?.constructor.name}`);return r},Pc=(t,e)=>t==="GET"&&e.get("Upgrade")?.toLowerCase()==="websocket",jc=t=>{let e=Object.create(null);if(t){let r;t instanceof Array?r=new Headers(t):t instanceof Headers?r=t:e=t,r!==void 0&&r.forEach((n,i)=>{e[i]=n})}return e},Ta=(t,e)=>e!==void 0&&t==="GET"?Pc(t,e instanceof Headers?e:new Headers(e)):t!=="GET"&&t!=="HEAD"&&t!=="TRACE"&&t!=="OPTIONS",rt=new class{getOrPut(t,e,r){if(t.has(e))return t.get(e);const n=r(e);return t.set(e,n),n}getAndRemove(t,e){const r=t.get(e);if(t.delete(e))return r}},Fa=t=>t instanceof Object&&typeof t.then=="function";class C{static resolve(e){const r=new C;return r.resolve(e),r}static reject(e){const r=new C;return r.reject(e),r}static sleep(e){const r=new C;let n=setTimeout(()=>{n=void 0,r.resolve()},e);return r.onFinished(()=>n!==void 0&&clearTimeout(n)),r}constructor(){Object.defineProperty(this,"promise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"is_resolved",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"is_rejected",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"is_finished",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reason",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resolve",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reject",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_innerFinally",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_innerFinallyArg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_innerThen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_innerCatch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.promise=new Promise((e,r)=>{this.resolve=n=>{try{Fa(n)?n.then(this.resolve,this.reject):(this.is_resolved=!0,this.is_finished=!0,e(this.value=n),this._runThen(),this._innerFinallyArg=Object.freeze({status:"resolved",result:this.value}),this._runFinally())}catch(i){this.reject(i)}},this.reject=n=>{this.is_rejected=!0,this.is_finished=!0,r(this.reason=n),this._runCatch(),this._innerFinallyArg=Object.freeze({status:"rejected",reason:this.reason}),this._runFinally()}})}onSuccess(e){this.is_resolved?this.__callInnerThen(e):(this._innerThen||(this._innerThen=[])).push(e)}onError(e){this.is_rejected?this.__callInnerCatch(e):(this._innerCatch||(this._innerCatch=[])).push(e)}onFinished(e){this.is_finished?this.__callInnerFinally(e):(this._innerFinally||(this._innerFinally=[])).push(e)}_runFinally(){if(this._innerFinally){for(const e of this._innerFinally)this.__callInnerFinally(e);this._innerFinally=void 0}}__callInnerFinally(e){queueMicrotask(async()=>{try{await e(this._innerFinallyArg)}catch(r){console.error("Unhandled promise rejection when running onFinished",e,r)}})}_runThen(){if(this._innerThen){for(const e of this._innerThen)this.__callInnerThen(e);this._innerThen=void 0}}_runCatch(){if(this._innerCatch){for(const e of this._innerCatch)this.__callInnerCatch(e);this._innerCatch=void 0}}__callInnerThen(e){queueMicrotask(async()=>{try{await e(this.value)}catch(r){console.error("Unhandled promise rejection when running onSuccess",e,r)}})}__callInnerCatch(e){queueMicrotask(async()=>{try{await e(this.value)}catch(r){console.error("Unhandled promise rejection when running onError",e,r)}})}}const br=t=>{let e=!0,r,n,i=!1;return Object.defineProperties(function(...s){if(e){e=!1;try{r=t.apply(this,s),i=!0}catch(a){n=a}}if(i)return r;throw n},{hasRun:{get(){return!e}},result:{get(){if(i)return r;throw n}},origin:{configurable:!0,writable:!1,value:t},reset:{configurable:!0,writable:!0,value:()=>{e=!0,r=void 0,n=void 0,i=!1}}})},Ve=()=>(t,e,r)=>{const n=r.get;if(n===void 0)throw new Error(`${t}.${e} should has getter`);return r.get=function(){const i=n.call(this);return r.set?r.get=()=>i:(delete r.set,delete r.get,r.value=i,r.writable=!1),Object.defineProperty(this,e,r),i},r};var L;(function(t){t[t.UTF8=2]="UTF8",t[t.BASE64=4]="BASE64",t[t.BINARY=8]="BINARY"})(L||(L={}));const Na=(t,e)=>{switch(e){case L.BINARY:return t;case L.BASE64:return yt(t,"base64");case L.UTF8:return yt(t,"utf8")}throw new Error(`unknown encoding: ${e}`)},Ba=(t,e)=>{switch(e){case L.BINARY:return st(t,"utf8");case L.BASE64:return st(yt(t,"base64"),"utf8");case L.UTF8:return t}throw new Error(`unknown encoding: ${e}`)};var q;(function(t){t.LIFECYCLE="life",t.REQUEST="req",t.RESPONSE="res",t.STREAM_DATA="data",t.STREAM_PULLING="pull",t.STREAM_PAUSED="pause",t.STREAM_END="end",t.STREAM_ABORT="abo",t.EVENT="event",t.ERROR="err",t.FORK="fork"})(q||(q={}));const Ke=t=>({type:t}),Ir=(t,e,r,n)=>({...Ke(q.EVENT),name:t,data:e,encoding:r,order:n}),Nn=Object.assign(Ir,{fromBase64(t,e,r){return Ir(t,st(e,"base64"),L.BASE64,r)},fromBinary(t,e,r){return Object.assign(Ir(t,e,L.BINARY,r),{toJSON:br(()=>Nn.fromBase64(t,e,r))})},fromUtf8(t,e,r){return Ir(t,st(e,"utf8"),L.UTF8,r)},fromText(t,e,r){return Ir(t,e,L.UTF8,r)},binary(t){return Na(t.data,t.encoding)},text(t){return Ba(t.data,t.encoding)}});var dn=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},Xe=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Qt,Rt,Xt;const Bn="ยง-",Aa=Symbol.for("pureChannel.income"),La=Symbol.for("pureChannel.outgoing");class Jn{constructor(e=new Bi,r=new Bi){Qt.set(this,void 0),Rt.set(this,void 0),Object.defineProperty(this,"_startLock",{enumerable:!0,configurable:!0,writable:!0,value:new C}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:br(()=>{this._startLock.resolve();const n={[Aa]:Xe(this,Qt,"f"),[La]:Xe(this,Rt,"f"),sendText:i=>{n.send(new $a(i))},sendBinary:i=>{n.send(new Da(i))},send:i=>{Xe(this,Rt,"f").controller.enqueue(i)},close:()=>{this.close()}};return n})}),Xt.set(this,void 0),dn(this,Qt,e,"f"),dn(this,Rt,r,"f")}afterStart(){return this._startLock.promise}close(){Xe(this,Qt,"f").controller.close(),Xe(this,Rt,"f").controller.close()}reverse(){if(Xe(this,Xt,"f")===void 0){const e=new Jn(Xe(this,Rt,"f"),Xe(this,Qt,"f"));dn(e,Xt,this,"f"),dn(this,Xt,e,"f")}return Xe(this,Xt,"f")}}Qt=new WeakMap,Rt=new WeakMap,Xt=new WeakMap;var Gr;(function(t){t[t.Text=0]="Text",t[t.Binary=1]="Binary"})(Gr||(Gr={}));class Ca{constructor(e){Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class $a extends Ca{constructor(e){super(Gr.Text),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class Da extends Ca{constructor(e){super(Gr.Binary),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e})}}const Oc=t=>{switch(t.encoding){case L.UTF8:return new $a(t.data);case L.BINARY:case L.BASE64:return new Da(Nn.binary(t))}},Rc=(t,e,r)=>e.type===Gr.Text?Nn.fromText(t,e.data,r):Nn.fromBinary(t,e.data,r),Ma=async(t,e,r)=>{const n=`${Bn}data`,i=-1,s=new C,a=t.onEvent("pureChannelToIpcEvent");a.collect(async b=>{const _=b.consumeMapNotNull(P=>{if(P.name===n)return P});_!==void 0&&(await s.promise).enqueue(Oc(_))});const o=e.start();s.resolve(o[Aa].controller);const d=o[La].stream;await t.start(void 0,r);for await(const b of Qr(d))t.postMessage(Rc(n,b,i));a.close()},ka="X-Dweb-Ipc-Upgrade-Key",Ua=new WeakMap,Ec=t=>Ua.get(t),Ic=(t,e,r)=>rt.getOrPut(Ua,e,()=>(r===void 0&&(r=t.fork()),Promise.resolve(r).then(n=>(e.set(ka,`${Bn}${n.pid}`),n))));typeof crypto.randomUUID!="function"&&(crypto.randomUUID=function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>{const r=+e;return(r^crypto.getRandomValues(new Uint8Array(1))[0]&15>>r/4).toString(16)})});const At=t=>{let e=0;if(t.length===0)return e;for(let r=0;r<t.length;r++){const n=t.charCodeAt(r);e=(e<<5)-e+n,e=e&e}return e};class wr{get raw(){return this._bodyHub.data}async u8a(){const e=this._bodyHub;let r=e.u8a;if(r===void 0){if(e.stream)r=await Ko(e.stream);else if(e.text!==void 0)r=yt(e.text,"utf8");else throw new Error("invalid body type");e.u8a=r,wr.CACHE.raw_ipcBody_WMap.set(r,this)}return r}async stream(){const e=this._bodyHub;let r=e.stream;return r===void 0&&(r=new Blob([await this.u8a()]).stream(),e.stream=r,wr.CACHE.raw_ipcBody_WMap.set(r,this)),r}async text(){const e=this._bodyHub;let r=e.text;return r===void 0&&(r=st(await this.u8a(),"utf8"),e.text=r),r}}Object.defineProperty(wr,"CACHE",{enumerable:!0,configurable:!0,writable:!0,value:new class{constructor(){Object.defineProperty(this,"raw_ipcBody_WMap",{enumerable:!0,configurable:!0,writable:!0,value:new WeakMap}),Object.defineProperty(this,"streamId_receiverIpc_Map",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"streamId_ipcBodySender_Map",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}}});class Ar{constructor(e){Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"u8a",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof e=="string"?this.text=e:e instanceof ReadableStream?this.stream=e:this.u8a=e}}var xc=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Ws=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};const ct=(t,e=4)=>t.padEnd(Math.ceil(t.length/e)*e," ");class qa{constructor(e){Object.defineProperty(this,"scope",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"isEnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"log",{enumerable:!0,configurable:!0,writable:!0,value:(r,...n)=>{this.isEnable&&console.log(this.prefix,ct(r)+"|",...Wt(n))}}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:(r,...n)=>{this.isEnable&&console.debug(this.prefix,ct(r)+"|",...Wt(n))}}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:(r,...n)=>{this.isEnable&&console.error(this.prefix,ct(r)+"|",...Wt(n))}}),Object.defineProperty(this,"warn",{enumerable:!0,configurable:!0,writable:!0,value:(...r)=>console.warn(this.prefix,...Wt(r))}),Object.defineProperty(this,"debugLazy",{enumerable:!0,configurable:!0,writable:!0,value:(r,n)=>{if(this.isEnable){const i=n();Symbol.iterator in i?console.debug(this.prefix,ct(r)+"|",...Wt(i)):console.debug(this.prefix,ct(r)+"|",An(i))}}}),Object.defineProperty(this,"errorLazy",{enumerable:!0,configurable:!0,writable:!0,value:(r,n)=>{if(this.isEnable){const i=n();Symbol.iterator in i?console.error(this.prefix,ct(r)+"|",...Wt(i)):console.error(this.prefix,ct(r)+"|",An(i))}}})}get prefix(){return ct(String(this.scope))+"|"}}xc([Ve(),Ws("design:type",Object),Ws("design:paramtypes",[])],qa.prototype,"prefix",null);const Yr=t=>new qa(t),An=t=>{if(typeof t!="object")return t;if(t!==null&&Se in t&&(t=t[Se]()),typeof t=="object"&&t!==null)try{return JSON.stringify(t,(e,r)=>typeof r=="object"&&r!==null&&Se in r?r[Se]():r)}catch{return t}return t},Wt=t=>t.filter(e=>e!==void 0).map(An),Se=Symbol.for("inspect.custom"),pn=(t,e,r,n)=>({...Ke(q.STREAM_DATA),stream_id:t,data:e,encoding:r,order:n}),fs=Object.assign(pn,{fromBase64(t,e,r=At(t)){const n=st(e,"base64");return Object.assign(pn(t,n,L.BASE64,r),{[Se](){return{...this,data:n.length<=100?n:`${n.slice(0,20)}...${n.slice(-20)}`}}})},fromBinary(t,e,r=At(t)){return Object.assign(pn(t,e,L.BINARY,r),{toJSON:br(()=>fs.fromBase64(t,e,r)),[Se](){return this.toJSON()[Se]()}})},fromUtf8(t,e,r=At(t)){return pn(t,st(e,"utf8"),L.UTF8,r)},binary(t){return Na(t.data,t.encoding)},text(t){return Ba(t.data,t.encoding)}}),Tc=(t,e=At(t))=>({...Ke(q.STREAM_END),stream_id:t,order:e});var hn=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Et,Hi,Vi,Ki,zi;class or{constructor(e,r,n,i,s){Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"senderUid",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"streamId",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"receiverUid",{enumerable:!0,configurable:!0,writable:!0,value:s}),Hi.set(this,new ve(()=>{switch(this.type&254){case L.UTF8:return L.UTF8;case L.BASE64:return L.BASE64;case L.BINARY:return L.BINARY;default:return L.UTF8}})),Vi.set(this,new ve(()=>(this.type&Ne.INLINE)!==0)),Ki.set(this,new ve(()=>(this.type&Ne.INLINE)===0)),zi.set(this,new ve(()=>this.type_encoding===L.BINARY?Et.fromBase64(this.senderUid,st(this.data,"base64"),this.streamId,this.receiverUid):this))}static fromJSON(e){return e instanceof Et||(e=new Et(e.type,e.senderUid,e.data,e.streamId,e.receiverUid)),e}static fromText(e,r,n,i){return new Et(n==null?Ne.INLINE_TEXT:Ne.STREAM_WITH_TEXT,e,r,n,i)}static fromBase64(e,r,n,i){return new Et(n==null?Ne.INLINE_BASE64:Ne.STREAM_WITH_BASE64,e,r,n,i)}static fromBinary(e,r,n,i){return new Et(n==null?Ne.INLINE_BINARY:Ne.STREAM_WITH_BINARY,e,r,n,i)}get type_encoding(){return hn(this,Hi,"f").value}get type_isInline(){return hn(this,Vi,"f").value}get type_isStream(){return hn(this,Ki,"f").value}get jsonAble(){return hn(this,zi,"f").value}toJSON(){return{...this.jsonAble}}}Et=or,Hi=new WeakMap,Vi=new WeakMap,Ki=new WeakMap,zi=new WeakMap;var Ne;(function(t){t[t.STREAM_ID=0]="STREAM_ID",t[t.INLINE=1]="INLINE",t[t.STREAM_WITH_TEXT=2]="STREAM_WITH_TEXT",t[t.STREAM_WITH_BASE64=4]="STREAM_WITH_BASE64",t[t.STREAM_WITH_BINARY=8]="STREAM_WITH_BINARY",t[t.INLINE_TEXT=3]="INLINE_TEXT",t[t.INLINE_BASE64=5]="INLINE_BASE64",t[t.INLINE_BINARY=9]="INLINE_BINARY"})(Ne||(Ne={}));var et;(function(t){t[t.PULLING=0]="PULLING",t[t.PAUSED=1]="PAUSED",t[t.ABORTED=2]="ABORTED"})(et||(et={}));class z extends wr{static fromAny(e,r){if(typeof e!="string"){const n=z.CACHE.raw_ipcBody_WMap.get(e);if(n!==void 0)return n}return new z(e,r)}static fromText(e,r){return this.fromAny(e,r)}static fromBinary(e,r){return this.fromAny(e,r)}static fromStream(e,r){return this.fromAny(e,r)}constructor(e,r){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"ipc",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"isStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamCtorSignal",{enumerable:!0,configurable:!0,writable:!0,value:Le()}),Object.defineProperty(this,"usedIpcMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"UsedIpcInfo",{enumerable:!0,configurable:!0,writable:!0,value:class{constructor(i,s,a=0,o=0){Object.defineProperty(this,"ipcBody",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"ipc",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"bandwidth",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"fuse",{enumerable:!0,configurable:!0,writable:!0,value:o})}emitStreamPull(i){return this.ipcBody.emitStreamPull(this,i)}emitStreamPaused(i){return this.ipcBody.emitStreamPaused(this,i)}emitStreamAborted(){return this.ipcBody.emitStreamAborted(this)}}}),Object.defineProperty(this,"closeSignal",{enumerable:!0,configurable:!0,writable:!0,value:Le()}),Object.defineProperty(this,"openSignal",{enumerable:!0,configurable:!0,writable:!0,value:Le()}),Object.defineProperty(this,"_isStreamOpened",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_isStreamClosed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_bodyHub",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaBody",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._bodyHub=new Ar(e),this.metaBody=this.$bodyAsMeta(e,r),this.isStream=e instanceof ReadableStream,typeof e!="string"&&z.CACHE.raw_ipcBody_WMap.set(e,this),z.$usableByIpc(r,this)}useByIpc(e){const r=this.usedIpcMap.get(e);if(r!==void 0)return r;if(this.isStream&&!this._isStreamOpened){const n=new this.UsedIpcInfo(this,e);return this.usedIpcMap.set(e,n),this.closeSignal.listen(()=>{this.emitStreamAborted(n)}),n}}emitStreamPull(e,r){e.bandwidth=r.bandwidth,this.streamCtorSignal.emit(et.PULLING)}emitStreamPaused(e,r){e.bandwidth=-1,e.fuse=r.fuse;let n=!0;for(const i of this.usedIpcMap.values())if(i.bandwidth>=0){n=!1;break}n&&this.streamCtorSignal.emit(et.PAUSED)}emitStreamAborted(e){this.usedIpcMap.delete(e.ipc)!=null&&this.usedIpcMap.size===0&&this.streamCtorSignal.emit(et.ABORTED)}onStreamClose(e){return this.closeSignal.listen(e)}onStreamOpen(e){return this.openSignal.listen(e)}get isStreamOpened(){return this._isStreamOpened}set isStreamOpened(e){this._isStreamOpened!==e&&(this._isStreamOpened=e,e&&this.openSignal.emitAndClear())}get isStreamClosed(){return this._isStreamClosed}set isStreamClosed(e){this._isStreamClosed!==e&&(this._isStreamClosed=e,e&&this.closeSignal.emitAndClear())}emitStreamClose(){this.isStreamOpened=!0,this.isStreamClosed=!0}$bodyAsMeta(e,r){return typeof e=="string"?or.fromText(r.pool.poolId,e):e instanceof ReadableStream?this.$streamAsMeta(e,r):or.fromBinary(r.pool.poolId,e)}$streamAsMeta(e,r){const n=Fc(e);let i;const s=()=>i??(i=Vo(e));(async()=>{let b=new C;for(this.streamCtorSignal.listen(async _=>{switch(_){case et.PULLING:{b.resolve();break}case et.PAUSED:{b.is_finished&&(b=new C);break}case et.ABORTED:await s().return(),await e.cancel(),this.emitStreamClose()}});;){await b.promise;const _=s(),P=await _.available();if(P>0){this.isStreamOpened=!0;const M=fs.fromBinary(n,await _.readBinary(P));for(const te of this.usedIpcMap.keys())te.postMessage(M)}else if(P===-1){const M=Tc(n);for(const te of this.usedIpcMap.keys())te.postMessage(M);await e.cancel(),this.emitStreamClose();break}}})().catch(console.error);const a=Ne.STREAM_ID,o="";"preReadableSize"in e&&typeof e.preReadableSize=="number"&&e.preReadableSize>0;const d=new or(a,r.pool.poolId,o,n);return z.CACHE.streamId_ipcBodySender_Map.set(n,this),this.streamCtorSignal.listen(b=>{b==et.ABORTED&&z.CACHE.streamId_ipcBodySender_Map.delete(n)}),d}}Object.defineProperty(z,"$usableByIpc",{enumerable:!0,configurable:!0,writable:!0,value:(t,e)=>{if(e.isStream&&!e._isStreamOpened){const r=e.metaBody.streamId;let n=ai.get(t);if(n===void 0){const i=new Bc;ai.set(t,i);const s=t.onStream("usableByIpc");s.collect(a=>{const o=a.data;switch(o.type){case q.STREAM_PULLING:i.get(o.stream_id)?.useByIpc(t)?.emitStreamPull(o);break;case q.STREAM_PAUSED:i.get(o.stream_id)?.useByIpc(t)?.emitStreamPaused(o);break;case q.STREAM_ABORT:i.get(o.stream_id)?.useByIpc(t)?.emitStreamAborted();break;default:return}a.consume()}),i.onDestroy(()=>{s.close(),ai.delete(t)}),n=i}n.add(r,e)&&e.onStreamClose(()=>n.remove(r))}}});const Ln=new WeakMap,Wa=At(crypto.randomUUID()).toString(36);let Ha=0;const Fc=t=>{let e=Ln.get(t);return e===void 0&&(e=`${Wa}-${Ha++}-ยง`,Ln.set(t,e)),e},Nc=(t,e)=>{let r=Ln.get(t);return r===void 0&&Ln.set(t,r=`${Wa}-${Ha++}-ยง[${e}]`),r};class Bc{constructor(){Object.defineProperty(this,"map",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"destroySignal",{enumerable:!0,configurable:!0,writable:!0,value:Le()})}add(e,r){return this.map.has(e)?!1:(this.map.set(e,r),!0)}get(e){return this.map.get(e)}remove(e){this.map.get(e)!==void 0&&(this.map.delete(e),this.map.size===0&&this.destroySignal.emitAndClear())}onDestroy(e){this.destroySignal.listen(e)}}const ai=new WeakMap,Ac=(t,e,r,n,i)=>({...Ke(q.REQUEST),reqId:t,method:e,url:r,headers:n,metaBody:i});class Va{constructor(e,r,n,i,s,a){Object.defineProperty(this,"reqId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"method",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"ipc",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:q.REQUEST}),Object.defineProperty(this,"_parsed_url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lazyDuplexIpcId",{enumerable:!0,configurable:!0,writable:!0,value:new ve(()=>{const o=this.headers.get(ka);if(o?.startsWith(Bn)){const d=+o.slice(Bn.length);if(Number.isFinite(d))return d}})}),s instanceof z&&z.$usableByIpc(a,s)}get parsed_url(){return this._parsed_url??(this._parsed_url=Wi(this.url))}get hasDuplex(){return this.duplexIpcId!==void 0}get duplexIpcId(){return this.lazyDuplexIpcId.value}getChannel(){return this.channel.value}toSerializable(){return Ac(this.reqId,this.method,this.url,this.headers.toJSON(),this.body.metaBody)}toJSON(){return this.toSerializable()}}class nt extends Va{constructor(){super(...arguments),Object.defineProperty(this,"server",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pureChannel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:new ve(()=>{const e=Ec(this.headers);if(e===void 0)throw new Error("no channel");const r=this.pureChannel??(this.pureChannel=new Jn);return(async()=>{const n=await e;await Ma(n,r,"IpcClientRequest")})(),r})})}toServer(e){return this.server??(this.server=new Ka(this,e))}static fromText(e,r,n=V.GET,i=new _e,s,a){return new nt(e,r,n,i,z.fromText(s,a),a)}static fromBinary(e,r,n=V.GET,i=new _e,s,a){return i.init("Content-Type","application/octet-stream"),i.init("Content-Length",s.byteLength+""),new nt(e,r,n,i,z.fromBinary(mr(s),a),a)}static fromStream(e,r,n=V.GET,i=new _e,s,a){return i.init("Content-Type","application/octet-stream"),new nt(e,r,n,i,z.fromStream(s,a),a)}static async fromRequest(e,r,n,i={}){const s=vc(i.method),a=i.headers instanceof _e?i.headers:new _e(i.headers);let o;if(ba(i.body)){let _;i.body instanceof Uint8Array?_=i.body:i.body instanceof ArrayBuffer?_=new Uint8Array(i.body):_=new Uint8Array(i.body.buffer,i.body.byteOffset,i.body.byteLength),o=z.fromBinary(_,r)}else i.body instanceof ReadableStream?o=z.fromStream(i.body,r):i.body instanceof Blob?o=z.fromStream(i.body.stream(),r):o=z.fromText(i.body??"",r);const d=new nt(e,n,s,a,o,r),b=i.headers instanceof Headers?za.get(i.headers):void 0;return b!==void 0&&(await r.prepareChannel(a),d.pureChannel=b,d.getChannel()),d}}class Ka extends Va{constructor(e,r){super(e.reqId,e.url,e.method,e.headers,e.body,r),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:new ve(()=>{const n=this.duplexIpcId,i=new Jn;return(async()=>{const s=await this.ipc.waitForkedIpc(n);await Ma(s,i,"IpcServerRequest")})(),i})})}toPureClientRequest(){const e=this.url,r=this.method,n=Ta(r)?this.body.raw:void 0,i={method:r,headers:new Headers(this.headers),body:n};n instanceof ReadableStream&&Reflect.set(i,"duplex","half");const s=new Lc(e,i);if(this.hasDuplex){const o=this.getChannel().reverse();za.set(s.headers,o)}return s}}class Lc extends Request{constructor(e,r){super(e,r),Object.defineProperty(this,"stream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.stream=r?.body}get body(){return this.stream instanceof ReadableStream?this.stream:super.body}get bodyUsed(){return super.bodyUsed}async arrayBuffer(){return this.stream?await new Response(this.stream).arrayBuffer():new ArrayBuffer(0)}async blob(){return this.stream?await new Response(this.stream).blob():new Blob}async formData(){return this.stream?await new Response(this.stream).formData():new FormData}async json(){return this.stream?await new Response(this.stream).json():null}async text(){return this.stream?new Response(this.stream).text():""}}const za=new WeakMap;var Cc=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},$c=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},_n;const Dc=(t,e,r,n)=>({...Ke(q.RESPONSE),reqId:t,statusCode:e,headers:r,metaBody:n});class it{constructor(e,r,n,i,s){Object.defineProperty(this,"reqId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"statusCode",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"ipc",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:q.RESPONSE}),_n.set(this,void 0),i instanceof z&&z.$usableByIpc(s,i)}get ipcHeaders(){return $c(this,_n,Cc(this,_n,"f")??new _e(this.headers),"f")}toResponse(e){const r=this.body.raw;r instanceof Uint8Array&&this.headers.init("Content-Length",r.length+"");let n;return this.statusCode<200||this.statusCode>599?(n=new Response(r,{headers:this.headers,status:200}),Object.defineProperty(n,"status",{value:this.statusCode,enumerable:!0,configurable:!0,writable:!1})):n=new Response(r,{headers:this.headers,status:this.statusCode}),e&&Object.defineProperty(n,"url",{value:e,enumerable:!0,configurable:!0,writable:!1}),n}static async fromResponse(e,r,n,i=!1){if(r.bodyUsed)throw new Error("body used");let s;i||r.body==null||parseInt(r.headers.get("Content-Length")||"NaN")<16*1024*1024?s=z.fromBinary(mr(await r.arrayBuffer()),n):(Nc(r.body,r.url),s=z.fromStream(r.body,n));const a=new _e(r.headers);return new it(e,r.status,a,s,n)}static fromJson(e,r,n=new _e,i,s){return n.init("Content-Type","application/json"),this.fromText(e,r,n,JSON.stringify(i),s)}static fromText(e,r,n=new _e,i,s){return n.init("Content-Type","text/plain"),new it(e,r,n,z.fromText(i,s),s)}static fromBinary(e,r,n=new _e,i,s){return n.init("Content-Type","application/octet-stream"),n.set("Content-Length",i.byteLength+""),new it(e,r,n,z.fromBinary(mr(i),s),s)}static fromStream(e,r,n=new _e,i,s){return n.init("Content-Type","application/octet-stream"),new it(e,r,n,z.fromStream(i,s),s)}toSerializable(){return Dc(this.reqId,this.statusCode,this.headers.toJSON(),this.body.metaBody)}toJSON(){return this.toSerializable()}}_n=new WeakMap;const Mc=(t,e=At(t))=>({...Ke(q.STREAM_ABORT),stream_id:t,order:e}),kc=(t,e,r=At(t))=>({...Ke(q.STREAM_PULLING),stream_id:t,bandwidth:e??0,order:r});class tt extends wr{static from(e,r){if(e.streamId){const n=tt.CACHE.streamId_ipcBodySender_Map.get(e.streamId);if(n)return n}return new tt(e,r)}constructor(e,r){if(super(),Object.defineProperty(this,"metaBody",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"_bodyHub",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.type_isStream){const n=e.streamId;tt.CACHE.streamId_receiverIpc_Map.has(n)===!1&&(r.onClosed(()=>{tt.CACHE.streamId_receiverIpc_Map.delete(n)}),tt.CACHE.streamId_receiverIpc_Map.set(n,r),e.receiverUid=r.pool.poolId);const i=tt.CACHE.streamId_receiverIpc_Map.get(n);if(i===void 0)throw new Error(`no found ipc by streamId:${n}`);r=i,this._bodyHub=new Ar(Uc(this.metaBody,r))}else switch(e.type_encoding){case L.UTF8:this._bodyHub=new Ar(e.data);break;case L.BASE64:this._bodyHub=new Ar(yt(e.data,"base64"));break;case L.BINARY:this._bodyHub=new Ar(e.data);break;default:throw new Error(`invalid metaBody type: ${e.type}`)}}}const Uc=(t,e)=>{if(e==null)throw new Error("miss ipc when ipc-response has stream-body");const r=e,n=t.streamId;let i=!0;return new ReadableStream({start(a){e.onClosed(()=>{try{a.close()}catch{}});let o;switch(t.type_encoding){case L.UTF8:o=yt(t.data,"utf8");break;case L.BASE64:o=yt(t.data,"base64");break;case L.BINARY:o=t.data;break}o&&a.enqueue(o),e.onStream("metaToStream").collect(d=>{const b=d.consumeMapNotNull(_=>{if(_.stream_id===n)return _});if(b!==void 0)switch(b.type){case q.STREAM_DATA:a.enqueue(fs.binary(b));break;case q.STREAM_END:a.close();break}})},pull(a){i&&(i=!1,r.postMessage(kc(n)))},cancel(){r.postMessage(Mc(n))}},{highWaterMark:0})};new WritableStream({});const qc=t=>Zr(Ja(t)),Wc=t=>JSON.stringify(Ja(t)),Hc=t=>lc(ArrayBuffer.isView(t)?t:new Uint8Array(t)),Hs=t=>JSON.parse(t),Vc=(t,e)=>{switch(t.type){case q.REQUEST:return new nt(t.reqId,t.url,t.method,new _e(t.headers),tt.from(or.fromJSON(t.metaBody),e),e);case q.RESPONSE:return new it(t.reqId,t.statusCode,new _e(t.headers),tt.from(or.fromJSON(t.metaBody),e),e);default:return t}},Ja=t=>{switch(t.type){case gt.LIFECYCLE:return t;case gt.IPC:switch(t.ipcMessage.type){case q.REQUEST:return{...t,ipcMessage:t.ipcMessage.toSerializable()};case q.RESPONSE:return{...t,ipcMessage:t.ipcMessage.toSerializable()};default:return t}}};var Kc=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Ji;class zc{constructor(){Ji.set(this,new Map)}tryInvoke(e,r){return typeof e=="object"&&e!==null&&("order"in e&&typeof e.order=="number"?e=e.order:e=void 0),typeof e=="number"?rt.getOrPut(Kc(this,Ji,"f"),e,()=>new Jc).queue(r):r()}}Ji=new WeakMap;class Jc{constructor(e){Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:e})}queue(e){const r=this.current,n=(async()=>(r&&await r,e()))();return this.current=n,n.finally(()=>{this.current===n&&(this.current=void 0)}),n}}var Ze=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},oi=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},Ye,It;class ds{get state(){return Ze(this,Ye,"f")}constructor(e,r=(n,i)=>n===i){Object.defineProperty(this,"equals",{enumerable:!0,configurable:!0,writable:!0,value:r}),Ye.set(this,void 0),It.set(this,new Kn),Object.defineProperty(this,"emit",{enumerable:!0,configurable:!0,writable:!0,value:n=>{this.equals(n,Ze(this,Ye,"f"))||(oi(this,Ye,n,"f"),Ze(this,It,"f").emit(n))}}),Object.defineProperty(this,"emitAndClear",{enumerable:!0,configurable:!0,writable:!0,value:n=>{this.equals(n,Ze(this,Ye,"f"))?Ze(this,It,"f").clear():(oi(this,Ye,n,"f"),Ze(this,It,"f").emitAndClear(n))}}),Object.defineProperty(this,"clear",{enumerable:!0,configurable:!0,writable:!0,value:()=>{Ze(this,It,"f").clear()}}),Object.defineProperty(this,"listen",{enumerable:!0,configurable:!0,writable:!0,value:n=>(n(Ze(this,Ye,"f")),Ze(this,It,"f").listen(n))}),oi(this,Ye,e,"f")}asReadyonly(){return this}}Ye=new WeakMap,It=new WeakMap;var k;(function(t){t.INIT="init",t.OPENING="opening",t.OPENED="opened",t.CLOSING="closing",t.CLOSED="closed"})(k||(k={}));var Be;(function(t){t.JSON="JSON",t.CBOR="CBOR"})(Be||(Be={}));const en=t=>({name:t}),ps=()=>en(k.INIT),Gi=(t,e)=>({...en(k.OPENING),subProtocols:[...t],sessionIds:[...e]}),Qi=(t,e)=>({...en(k.OPENED),subProtocols:[...t],sessionPair:e}),Ga=t=>({...en(k.CLOSING),reason:t}),Qa=t=>({...en(k.CLOSED),reason:t}),Gc=(t,e=Xa)=>({...xa(gt.LIFECYCLE),state:t,order:e}),Xa=-1,Oe=Object.assign(Gc,{equals:(t,e)=>Oe.stateEquals(t.state,e.state),stateEquals:(t,e)=>t.name!==e.name?!1:t.name===k.CLOSING||t.name===k.CLOSED?t.reason===e.reason:t.name===k.OPENING||t.name===k.OPENED?JSON.stringify(t)===JSON.stringify(e):!0,DEFAULT_ORDER:Xa,init:ps,opening:Gi,opend:Qi,closing:Ga,closed:Qa});class Qc{constructor(e){Object.defineProperty(this,"po",{enumerable:!0,configurable:!0,writable:!0,value:new C}),Object.defineProperty(this,"prev",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"curr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prev=e?.curr,this.curr=this.prev?.then(()=>this.po.promise)??this.po.promise}get isUnLocked(){return this.po.is_finished}}class Za{constructor(e){Object.defineProperty(this,"_lockers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),e&&this.lock()}get isLocked(){return this._lockers.length>0}get _lastLocker(){return this._lockers[this._lockers.length-1]}lock(){const e=new Qc(this._lastLocker);return this._lockers.push(e),e.prev}unlock(){this._lockers.shift()?.po.resolve()}async withLock(e){const r=this.lock();r&&await r;try{const n=e();return Fa(n)?await n:n}finally{this.unlock()}}}var U=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},mt=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},Ht,ir,Ya,xt,Xi,eo,Zi,Zt,ci,yn,lt,xr,li,Tr,Vs,ui,gn,fi,Ks,di,zs;class _r{constructor(e,r={}){Ht.add(this),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"console",{enumerable:!0,configurable:!0,writable:!0,value:Yr(this)}),Object.defineProperty(this,"bufferLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"bufferOverflowBehavior",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"consumers",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"buffers",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),xt.set(this,void 0),Zt.set(this,!1),ci.set(this,Le(!1)),Object.defineProperty(this,"onClosed",{enumerable:!0,configurable:!0,writable:!0,value:U(this,ci,"f").listen}),this.bufferLimit=r.bufferLimit??10,this.bufferOverflowBehavior=r.bufferOverflowBehavior||"warn"}toString(){return`Producer<${this.name}>`}[(xt=new WeakMap,Zt=new WeakMap,ci=new WeakMap,Ht=new WeakSet,Se)](){return this.toString()}event(e){return new(U(ir,ir,"f",Ya))(e,this)}send(e){U(this,Ht,"m",Zi).call(this),U(this,Ht,"m",Xi).call(this,e)}sendBeacon(e){const r=this.event(e);return this.doEmit(r)}trySend(e){return this.isClosedForSend?this.sendBeacon(e):U(this,Ht,"m",Xi).call(this,e)}async doEmit(e){for(const r of this.consumers)if(!(!r.started||r.startingBuffers?.has(e)==!0)&&(await e.emitBy(r),e.stoped))break}consumer(e){return U(this,Ht,"m",Zi).call(this),new(U(ir,ir,"f",eo))(e,this)}get isClosedForSend(){return U(this,Zt,"f")}async close(e){if(U(this,Zt,"f"))return;mt(this,Zt,!0,"f");const r=this.buffers;for(const n of r)n.consumed||(n.consume(),n.complete(),console.debug("closeWrite",`event=${n} consumed by close`));for(const n of this.consumers)n.close(e);this.consumers.clear(),this.buffers.clear(),e&&this.console.verbose("producer-close",e)}}ir=_r,Xi=function(e){const r=this.event(e);if(this.buffers.add(r),this.buffers.size>this.bufferLimit){if(this.bufferOverflowBehavior==="warn")U(this,xt,"f")===void 0&&mt(this,xt,setTimeout(()=>{this.buffers.size>this.bufferLimit&&this.console.warn(`${this} buffers overflow maybe leak: ${this.buffers.size}`)},1e3),"f");else if(this.bufferOverflowBehavior==="throw")throw new Error(`${this} buffers overflow: ${this.buffers.size}/${this.bufferLimit}`)}else U(this,xt,"f")!==void 0&&(clearTimeout(U(this,xt,"f")),mt(this,xt,void 0,"f"));return this.doEmit(r)},Zi=function(){if(U(this,Zt,"f"))throw new Error(`${this} already close for emit.`)};Ya={value:class{constructor(e,r){Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"producer",{enumerable:!0,configurable:!0,writable:!0,value:r}),yn.set(this,new C),lt.set(this,0),xr.set(this,!1),li.set(this,new Za)}toString(){return`Event<${An(this.data)}>`}[(yn=new WeakMap,lt=new WeakMap,xr=new WeakMap,li=new WeakMap,Se)](){return this.toString()}get job(){return U(this,yn,"f").promise}get consumed(){return U(this,lt,"f")>0}consume(){var e;return mt(this,lt,(e=U(this,lt,"f"),e++,e),"f"),this.data}get stoped(){return U(this,xr,"f")}stopImmediatePropagation(){this.consume(),mt(this,xr,!0,"f")}complete(){U(this,yn,"f").resolve(),this.producer.buffers.delete(this)}consumeMapNotNull(e){const r=e(this.data);if(r!=null)return this.consume(),r}consumeFilter(e){if(e(this.data)===!0)return this.consume()}emitBy(e){if(!U(this,xr,"f"))return U(this,li,"f").withLock(async()=>{const r=setTimeout(()=>{console.warn("emitBy TIMEOUT!!","consumer=",e,"data=",this.data)},1e3),n=U(this,lt,"f");try{await e.input.emit(this)}catch(i){console.error("emitBy ERROR!!","consumer=",e,"data=",this.data,i)}clearTimeout(r),this.consumed&&(this.complete(),U(this,lt,"f")!=n&&this.producer.console.verbose("emitBy","event=",this,`consumed[${n}>>${U(this,lt,"f")}] by consumer=`,e))})}}};Object.defineProperty(_r,"EasyFlow",{enumerable:!0,configurable:!0,writable:!0,value:(Vs=class{constructor(){Tr.set(this,void 0)}close(){mt(this,Tr,void 0,"f")}collect(e){mt(this,Tr,e,"f")}async emit(e){await U(this,Tr,"f")?.call(this,e)}},Tr=new WeakMap,Vs)});eo={value:(zs=class{constructor(e,r){ui.add(this),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"producer",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:new ir.EasyFlow}),gn.set(this,!1),Object.defineProperty(this,"startingBuffers",{enumerable:!0,configurable:!0,writable:!0,value:null}),fi.set(this,new C),di.set(this,Le()),Object.defineProperty(this,"onDestroy",{enumerable:!0,configurable:!0,writable:!0,value:U(this,di,"f").listen})}toString(){return`Consumer<[${this.producer.name}]${this.name}>`}[(gn=new WeakMap,fi=new WeakMap,di=new WeakMap,ui=new WeakSet,Se)](){return this.toString()}get started(){return U(this,gn,"f")}collect(e){return this.input.collect(e),U(this,ui,"m",Ks).call(this)}mapNotNull(e){const r=new Kn;return this.collect(n=>{const i=e(n.data);i!==void 0&&r.emit(i)}),r.listen}close(e){this.input.close(),this.producer.consumers.delete(this),U(this,fi,"f").resolve(e)}},Ks=function(){this.producer.consumers.add(this),mt(this,gn,!0,"f"),this.startingBuffers=new Set(this.producer.buffers);for(const e of this.startingBuffers)e.emitBy(this);this.startingBuffers.clear(),this.startingBuffers=null},zs)};const Sn=new class{sort(t,e){return[...t].sort(e)}union(t,e){const r=new Set(t);for(const n of e)r.add(n);return r}intersect(t,e){const r=new Set(t),n=new Set(e),i=new Set([...r,...n]);for(const s of i)(r.has(s)&&n.has(s))===!1&&i.delete(s);return i}subtract(t,e){const r=new Set(t);for(const n of e)r.delete(n);return r}equals(t,e){const r=new Set(t);for(const n of e)if(r.delete(n)===!1)return!1;return!0}add(t,e){return t.has(e)?!1:(t.add(e),!0)}};class Xc{constructor(e){Object.defineProperty(this,"debugId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"console",{enumerable:!0,configurable:!0,writable:!0,value:Yr(this)}),Object.defineProperty(this,"accPid",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"generatePid",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.accPid+=2}),Object.defineProperty(this,"ipcMessageProducers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"lifecycleLocaleFlow",{enumerable:!0,configurable:!0,writable:!0,value:new ds(Oe(ps()),Oe.equals)}),Object.defineProperty(this,"onLifecycle",{enumerable:!0,configurable:!0,writable:!0,value:this.lifecycleLocaleFlow.listen}),Object.defineProperty(this,"localSessionId",{enumerable:!0,configurable:!0,writable:!0,value:"s-"+crypto.randomUUID()}),Object.defineProperty(this,"startOnce",{enumerable:!0,configurable:!0,writable:!0,value:br(async()=>{this.console.verbose("startOnce",this.lifecycle),await this.doStart();const r=this.getLocaleSubProtocols(),n=this.localSessionId;if(this.lifecycle.state.name===k.INIT){const i=Oe(Gi(r,[n]));this.sendLifecycleToRemote(i),this.console.verbose("emit-locale-lifecycle",i),this.lifecycleLocaleFlow.emit(i)}else throw new Error(`endpoint state=${this.lifecycle.state.name}`);this.lifecycleRemoteFlow.listen(i=>{const s=i.state;switch(this.console.verbose("remote-lifecycle-in",s),s.name){case k.CLOSING:case k.CLOSED:{this.close();break}case k.OPENED:{const a=this.lifecycle.state;if(this.console.verbose("remote-opend-&-locale-lifecycle",a),a.name===k.OPENING){const o=Oe(Qi(a.subProtocols,a.sessionIds.join("~")));this.accPid=a.sessionIds.indexOf(n),this.sendLifecycleToRemote(o),this.console.verbose("emit-locale-lifecycle",o),this.lifecycleLocaleFlow.emit(o)}break}case k.INIT:{this.sendLifecycleToRemote(this.lifecycle);break}case k.OPENING:{const a=this.lifecycle.state;if(a.name===k.OPENING){let o;if(Oe.stateEquals(a,s)===!1){const d=Sn.intersect(r,s.subProtocols),b=Sn.sort(Sn.union(a.sessionIds,s.sessionIds),(P,M)=>P.localeCompare(M)),_=Oe(Gi(d,b));this.console.verbose("emit-locale-lifecycle",_),this.lifecycleLocaleFlow.emit(_),o=_}else o=Oe(Qi(a.subProtocols,a.sessionIds.join("~"))),this.accPid=a.sessionIds.indexOf(n);this.sendLifecycleToRemote(o)}break}}})})}),Object.defineProperty(this,"closedPo",{enumerable:!0,configurable:!0,writable:!0,value:new C}),Object.defineProperty(this,"_isClose",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"beforeClose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"afterClosed",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}[Se](){return this.toString()}ipcMessageProducer(e){const r=new C,n=new _r(`ipc-msg/${this.debugId}/${e}`);return n.onClosed(()=>{this.ipcMessageProducers.delete(e)}),{pid:e,ipcPo:r,producer:n}}getIpcMessageProducer(e){return rt.getOrPut(this.ipcMessageProducers,e,()=>this.ipcMessageProducer(e))}getIpcMessageProducerByIpc(e){const r=this.getIpcMessageProducer(e.pid);return e.onClosed(()=>{this.ipcMessageProducers.delete(e.pid)}),r.ipcPo.resolve(e),r}get lifecycle(){return this.lifecycleLocaleFlow.state}get isActivity(){return k.OPENED==this.lifecycle.state.name}async start(e=!0){this.startOnce(),e&&await this.awaitOpen("from-start")}async awaitOpen(e){if(this.lifecycle.state.name==k.OPENED)return this.lifecycle;const r=new C,n=this.onLifecycle(s=>{switch(s.state.name){case k.OPENED:{r.resolve(s);break}case(k.CLOSED,k.CLOSING):{r.reject("endpoint already closed");break}}}),i=await r.promise;return this.console.verbose("awaitOpen",i,e),n(),i}get isClose(){return this._isClose}async close(e){this._isClose=!0,await this.doClose(e)}awaitClosed(){return this.closedPo.promise}async doClose(e){e=e&&e.toString();try{switch(this.lifecycle.state.name){case k.OPENED:case k.OPENING:{this.sendLifecycleToRemote(Oe(Ga(e)));break}case k.CLOSED:return}this.beforeClose?.();for(const r of this.ipcMessageProducers.values())await r.producer.close(e);this.ipcMessageProducers.clear(),this.sendLifecycleToRemote(Oe(Qa(e))),this.afterClosed?.()}finally{this.closedPo.resolve(e)}}}var mn=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Zc=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},Lr,Pn;class Yc extends Xc{constructor(){super(...arguments),Lr.set(this,Be.JSON),Object.defineProperty(this,"endpointMsgChannel",{enumerable:!0,configurable:!0,writable:!0,value:new Ai}),Pn.set(this,new ds(Oe(ps()),Oe.equals)),Object.defineProperty(this,"lifecycleRemoteFlow",{enumerable:!0,configurable:!0,writable:!0,value:mn(this,Pn,"f").asReadyonly()})}get protocol(){return mn(this,Lr,"f")}getLocaleSubProtocols(){return new Set([Be.JSON])}sendLifecycleToRemote(e){if(this.console.verbose("lifecycle-out",e),Be.CBOR===this.protocol)return this.postBinaryMessage(Zr(e));if(Be.JSON===this.protocol)return this.postTextMessage(JSON.stringify(e))}async doStart(){this.lifecycleLocaleFlow.listen(e=>{e.state.name===k.OPENED&&e.state.subProtocols.includes(Be.CBOR)&&Zc(this,Lr,Be.CBOR,"f")}),(async()=>{const e=new zc;for await(const r of this.endpointMsgChannel)e.tryInvoke(r,async()=>{switch(r.type){case gt.IPC:{const n=this.getIpcMessageProducer(r.pid),i=await n.ipcPo.promise;n.producer.trySend(Vc(r.ipcMessage,i));break}case gt.LIFECYCLE:{mn(this,Pn,"f").emit(r);break}}})})()}async postIpcMessage(e){switch(await this.awaitOpen("then-postIpcMessage"),this.console.verbose("out",e),mn(this,Lr,"f")){case Be.JSON:this.postTextMessage(Wc(e));break;case Be.CBOR:this.postBinaryMessage(qc(e));break}}}Lr=new WeakMap,Pn=new WeakMap;var ft=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Yi,Yt,Dr,to;class el extends Yc{toString(){return`ChannelEndpoint#${this.debugId}`}constructor(e,r){super(e),Yi.add(this),Yt.set(this,new Ai),Dr.set(this,new Ai),Object.defineProperty(this,"beforeClose",{enumerable:!0,configurable:!0,writable:!0,value:()=>{ft(this,Dr,"f").close()}}),Object.defineProperty(this,"afterClosed",{enumerable:!0,configurable:!0,writable:!0,value:()=>{ft(this,Yt,"f").close()}}),ft(this,Yi,"m",to).call(this,r)}get stream(){return ft(this,Yt,"f").stream}send(e){ft(this,Dr,"f").send(e)}postTextMessage(e){ft(this,Yt,"f").send(yt(e,"utf8"))}postBinaryMessage(e){ft(this,Yt,"f").send(e)}}Yt=new WeakMap,Dr=new WeakMap,Yi=new WeakSet,to=function(e){e==null&&(e=ft(this,Dr,"f").stream);const r=Qr(e);(async()=>{for await(const n of r){let i;typeof n=="string"?i=Hs(n):this.protocol===Be.CBOR?i=Hc(n):i=Hs(st(n,"utf8")),this.endpointMsgChannel.send(i)}this.close()})()};const tl={},hs=rl(globalThis,tl);function rl(t,e){return new Proxy(t,{get(r,n,i){return n in e?e[n]:t[n]},set(r,n,i){return n in e&&delete e[n],t[n]=i,!0},deleteProperty(r,n){let i=!1;return n in e&&(delete e[n],i=!0),n in t&&(delete t[n],i=!0),i},ownKeys(r){const n=Reflect.ownKeys(t),i=Reflect.ownKeys(e),s=new Set(i);return[...n.filter(a=>!s.has(a)),...i]},defineProperty(r,n,i){return n in e&&delete e[n],Reflect.defineProperty(t,n,i),!0},getOwnPropertyDescriptor(r,n){return n in e?Reflect.getOwnPropertyDescriptor(e,n):Reflect.getOwnPropertyDescriptor(t,n)},has(r,n){return n in e||n in t}})}var Js;(function(t){t.Service="service",t.Routing_Service="routing-service",t.Process_Service="process-service",t.Render_Service="render-service",t.Protocol_Service="protocol-service",t.Device_Management_Service="device-management-service",t.Computing_Service="computing-service",t.Storage_Service="storage-service",t.Database_Service="database-service",t.Network_Service="network-service",t.Hub_Service="hub-service",t.Distribution_Service="distribution-service",t.Security_Service="security-service",t.Log_Service="log-service",t.Indicator_Service="indicator-service",t.Tracking_Service="tracking-service",t.Visual_Service="visual-service",t.Audio_Service="audio-service",t.Text_Service="text-service",t.Machine_Learning_Service="machine-learning-service",t.Application="application",t.Settings="settings",t.Desktop="desktop",t.Web_Browser="web-browser",t.Files="files",t.Wallet="wallet",t.Assistant="assistant",t.Business="business",t.Developer="developer",t.Education="education",t.Finance="finance",t.Productivity="productivity",t.Messages="messages",t.Live="live",t.Entertainment="entertainment",t.Games="games",t.Lifestyle="lifestyle",t.Music="music",t.News="news",t.Sports="sports",t.Video="video",t.Photo="photo",t.Graphics_a_Design="graphics-design",t.Photography="photography",t.Personalization="personalization",t.Books="books",t.Magazines="magazines",t.Food="food",t.Health="health",t.Fitness="fitness",t.Medical="medical",t.Navigation="navigation",t.Reference="reference",t.Utilities="utilities",t.Travel="travel",t.Weather="weather",t.Kids="kids",t.Shopping="shopping",t.Security="security",t.Social="social",t.Career="career",t.Government="government",t.Politics="politics",t.Action_Games="action-games",t.Adventure_Games="adventure-games",t.Arcade_Games="arcade-games",t.Board_Games="board-games",t.Card_Games="card-games",t.Casino_Games="casino-games",t.Dice_Games="dice-games",t.Educational_Games="educational-games",t.Family_Games="family-games",t.Kids_Games="kids-games",t.Music_Games="music-games",t.Puzzle_Games="puzzle-games",t.Racing_Games="racing-games",t.Role_Playing_Games="role-playing-games",t.Simulation_Games="simulation-games",t.Sports_Games="sports-games",t.Strategy_Games="strategy-games",t.Trivia_Games="trivia-games",t.Word_Games="word-games"})(Js||(Js={}));const nl=t=>t,il=()=>t=>t,ro=nl({async number(){return+await this.text()},async ok(){const t=await this;if(t.status>=400){const e=new Error(`[${t.status}] ${t.statusText}`);throw t.text().then(r=>e.cause=r),e}else return t},async text(){return(await this.ok()).text()},async binary(){return(await this.ok()).arrayBuffer()},async boolean(){return await this.text()==="true"},async object(){const t=await this.ok();try{return await t.json()}catch(e){debugger;throw e}}});class sl extends TransformStream{constructor(e){let r="";const n=(i,s)=>{try{i.enqueue(JSON.parse(s))}catch(a){return e?e(a,i):i.error(a),!0}};super({transform:(i,s)=>{r+=i;let a;for(;(a=r.indexOf(`
`))!==-1;){const o=r.slice(0,a);if(r=r.slice(o.length+1),n(s,o))break}},flush:i=>{r=r.trim(),r.length>0&&n(i,r),i.terminate()}})}}const al=t=>no(t.pipeThrough(new TextDecoderStream)),no=t=>t.pipeThrough(new sl),ol=(t,e)=>Qr(no(t),e),cl=t=>t,ll=cl({async jsonlines(){return al(await this.stream())},async stream(){const t=await this,e=t.body;if(e==null)throw new Error(`request ${t.url} could not by stream.`);return e}}),io={...ro,...ll},Gs=(t,e)=>{let r,n=e;if(typeof t=="string"?r=Wi(t):t instanceof Request?(r=Wi(t.url),n=t):t instanceof URL&&(r=t),r===void 0)throw new Error("no found url for fetch");return{parsed_url:r,request_init:n??{}}},es=t=>e=>{t.then(e)};var $t=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ge=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Ft=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Qs=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},dt,Cr,sr;(function(t){t[t.BOOTSTRAP=0]="BOOTSTRAP",t[t.SHUTDOWN=1]="SHUTDOWN"})(sr||(sr={}));class ul{constructor(){dt.set(this,void 0)}get console(){return Yr(this)}toString(){return`MicroModule(${this.manifest.mmid})`}get isRunning(){return Ft(this,dt,"f")?.isRunning===!0}get runtime(){const e=Ft(this,dt,"f");if(e===void 0)throw new Error(`${this.manifest.mmid} is no running`);return e}async bootstrap(e){if(Ft(this,dt,"f")===void 0){const r=await this.createRuntime(e);r.onShutdown(()=>{Qs(this,dt,void 0,"f")}),await r.bootstrap(),Qs(this,dt,r,"f")}return Ft(this,dt,"f")}}dt=new WeakMap;$t([Ve(),ge("design:type",Object),ge("design:paramtypes",[])],ul.prototype,"console",null);class Sr{constructor(){Object.defineProperty(this,"stateLock",{enumerable:!0,configurable:!0,writable:!0,value:new Za}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:sr.SHUTDOWN}),Object.defineProperty(this,"connectionLinks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"connectionMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Cr.set(this,new _r("ipcConnect"))}get connectedIpcs(){return this.connectionLinks}get console(){return this.microModule.console}onConnect(e){return Ft(this,Cr,"f").consumer(e)}get isRunning(){return this.state===sr.BOOTSTRAP}bootstrap(){return this.stateLock.withLock(async()=>{this.state!=sr.BOOTSTRAP?(this.console.verbose("bootstrap-start"),await this._bootstrap(),this.console.verbose("bootstrap-end")):this.console.verbose("bootstrap",`${this.mmid} already running`),this.state=sr.BOOTSTRAP})}get beforeShotdownPo(){return new C}get onBeforeShutdown(){return es(this.beforeShotdownPo.promise)}get shutdownPo(){return new C}get onShutdown(){return es(this.shutdownPo.promise)}shutdown(){return this.stateLock.withLock(async()=>{this.beforeShotdownPo.resolve(void 0),await this._shutdown(),this.shutdownPo.resolve(void 0),Ft(this,Cr,"f").close()})}connect(e,r=!0){return rt.getOrPut(this.connectionMap,e,()=>{const n=new C;return n.resolve((async()=>{const i=await this.bootstrapContext.dns.connect(e);return r&&i.start(),i.onClosed(()=>{this.connectionMap.delete(e)}),i})()),n.onError(()=>{this.connectionMap.delete(e)}),n}).promise}async beConnect(e,r){Sn.add(this.connectionLinks,e)&&(this.console.verbose("beConnect",e),e.onFork("beConnect").collect(async n=>{e.console.verbose("onFork",n.data),await this.beConnect(n.consume(),void 0)}),this.onBeforeShutdown(()=>e.close()),e.onClosed(()=>{this.connectionMap.delete(e.remote.mmid),this.connectionLinks.delete(e)}),this.connectionMap.has(e.remote.mmid)===!1&&this.connectionMap.set(e.remote.mmid,C.resolve(e)),Ft(this,Cr,"f").send(e),this.console.verbose("beConnect-end",e))}getConnected(e){return this.connectionMap.get(e)?.promise}async _getIpcForFetch(e){if(e.protocol==="dweb:"){const r=(await this.bootstrapContext.dns.queryDeeplink(e.href))?.id;return r===void 0?void 0:await this.connect(r)}return await this.connect(e.hostname)}async _nativeRequest(e,r){if(e.protocol==="file:"||e.protocol==="dweb:"){const n=await this._getIpcForFetch(e);if(n){const i=await _c(r);let s=await n.request(e.href,i);if(s.statusCode===401)try{const a=await s.body.text();a&&await this.requestDwebPermissions(a)&&(s=await n.request(e.href,i))}catch(a){console.error("fail to request permission:",a)}return s}}}async nativeRequest(e,r){const n=Gs(e,r),i=await this._nativeRequest(n.parsed_url,n.request_init);if(!i)throw new Error(`fail to ipc-request of ${n.parsed_url}`);return i}async _nativeFetch(e,r){const{parsed_url:n,request_init:i}=Gs(e,r),s=await this._nativeRequest(n,i);return s?s.toResponse(n.href):fetch(n,i)}nativeFetch(e,r){return Object.assign(this._nativeFetch(e,r),io)}async requestDwebPermissions(e){const r=await(await this.nativeFetch(new URL(`file://permission.std.dweb/request?permissions=${encodeURIComponent(e)}`))).text(),n=JSON.parse(r);return Object.values(n).every(i=>i==="granted")}get _manifest(){return{mmid:this.mmid,name:this.name,short_name:this.short_name,ipc_support_protocols:this.ipc_support_protocols,dweb_deeplinks:this.dweb_deeplinks,categories:this.categories,dir:this.dir,lang:this.lang,description:this.description,icons:this.icons,screenshots:this.screenshots,display:this.display,orientation:this.orientation,theme_color:this.theme_color,background_color:this.background_color,shortcuts:this.shortcuts}}toManifest(){return this._manifest}}Cr=new WeakMap;$t([Ve(),ge("design:type",Object),ge("design:paramtypes",[])],Sr.prototype,"console",null);$t([Ve(),ge("design:type",Object),ge("design:paramtypes",[])],Sr.prototype,"beforeShotdownPo",null);$t([Ve(),ge("design:type",Object),ge("design:paramtypes",[])],Sr.prototype,"onBeforeShutdown",null);$t([Ve(),ge("design:type",Object),ge("design:paramtypes",[])],Sr.prototype,"shutdownPo",null);$t([Ve(),ge("design:type",Object),ge("design:paramtypes",[])],Sr.prototype,"onShutdown",null);$t([Ve(),ge("design:type",Object),ge("design:paramtypes",[])],Sr.prototype,"_manifest",null);const so=(t,e)=>({...xa(gt.IPC),pid:t,ipcMessage:e}),fl=(t,e,r,n,i)=>({...Ke(q.FORK),pid:t,autoStart:e,locale:r,remote:n,startReason:i});var G;(function(t){t.INIT="init",t.OPENING="opening",t.OPENED="opened",t.CLOSING="closing",t.CLOSED="closed"})(G||(G={}));const tn=t=>({name:t}),ao=(t,e,r)=>({...tn(G.INIT),pid:t,locale:e,remote:r}),oo=()=>({...tn(G.OPENING)}),co=()=>({...tn(G.OPENED)}),lo=t=>({...tn(G.CLOSING),reason:t}),uo=t=>({...tn(G.CLOSED),reason:t}),dl=(t,e=pl)=>({...Ke(q.LIFECYCLE),state:t,order:e}),pl=-1,Vt=Object.assign(dl,{equals:(t,e)=>t.state.name!==e.state.name?!1:t.state.name===G.CLOSING||t.state.name===G.CLOSED?t.state.reason===e.state.reason:t.state.name===G.INIT?JSON.stringify(t.state)===JSON.stringify(e.state):!0,init:ao,opening:oo,opened:co,closing:lo,closed:uo});var fo=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Cn=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},$r=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},T=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},se,$n,er,ut,Fr,tr,Kt,rr,pi,hi,yi,gi,mi,ts,po,ho,bi,wi;class rn{constructor(e,r,n,i,s,a=`${r.debugId}/${e}`){se.add(this),Object.defineProperty(this,"pid",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"locale",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"remote",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"pool",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"debugId",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"console",{enumerable:!0,configurable:!0,writable:!0,value:Yr(this)}),$n.set(this,0),er.set(this,void 0),ut.set(this,void 0),Object.defineProperty(this,"lifecycleLocaleFlow",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onLifecycle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Fr.set(this,void 0),Object.defineProperty(this,"lifecycleRemoteFlow",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"startOnce",{enumerable:!0,configurable:!0,writable:!0,value:br(()=>{if(this.console.verbose("startOnce",this.lifecycle),this.lifecycle.state.name===G.INIT){const o=Vt(oo());T(this,se,"m",tr).call(this,o),T(this,ut,"f").emit(o)}else throw new Error(`fail to start: ipc=${this} state=${this.lifecycle}`);T(this,Fr,"f").call(this,o=>{const d=()=>{const b=Vt(co());T(this,se,"m",tr).call(this,b),T(this,ut,"f").emit(b)};switch(o.state.name){case(G.CLOSING,G.CLOSED):{this.close(o.state.reason);break}case G.OPENED:{this.lifecycle.state.name===G.OPENING&&d();break}case G.INIT:{T(this,se,"m",tr).call(this,this.lifecycle);break}case G.OPENING:{d();break}}}),this.onMessage(`fork#${this.debugId}`).collect(o=>{const d=o.consumeMapNotNull(_=>{if(_.type===q.FORK)return _});if(d===void 0)return;const b=new rn(d.pid,this.endpoint,this.locale,this.remote,this.pool);this.pool.safeCreatedIpc(b,d.autoStart,d.startReason),rt.getOrPut(this.forkedIpcMap,b.pid,()=>new C).resolve(b),T(this,Kt,"f").send(b)})})}),Object.defineProperty(this,"forkedIpcMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Kt.set(this,void 0),pi.set(this,new ve(()=>T(this,se,"m",rr).call(this,"request",o=>{if(o instanceof nt)return o.toServer(this);if(o instanceof Ka)return o}))),hi.set(this,new ve(()=>T(this,se,"m",rr).call(this,"response",o=>{if(o instanceof it)return o}))),yi.set(this,new ve(()=>T(this,se,"m",rr).call(this,"stream",o=>{if("stream_id"in o)return o}))),gi.set(this,new ve(()=>T(this,se,"m",rr).call(this,"event",o=>{if(o.type===q.EVENT)return o}))),mi.set(this,new ve(()=>T(this,se,"m",rr).call(this,"error",o=>{if(o.type===q.ERROR)return o}))),ts.set(this,new ve(()=>{const o=new Map;return this.onResponse(`${this.debugId}-reqResMap-onResponse`).collect(d=>{const b=d.consume(),_=rt.getAndRemove(o,b.reqId);if(_===void 0)throw new Error(`no found response by reqId: ${d.data.reqId}`);_.resolve(b)}),o})),wi.set(this,br(async o=>{o=o?o.toString():void 0,this.console.verbose("closing",o);{const d=Vt(lo(o));T(this,ut,"f").emit(d),T(this,se,"m",tr).call(this,d)}await T(this,er,"f").producer.close(o),this._closePo.resolve(o);{const d=Vt(uo(o));T(this,ut,"f").emitAndClear(d),T(this,se,"m",tr).call(this,d)}})),$r(this,er,this.endpoint.getIpcMessageProducerByIpc(this),"f"),$r(this,ut,new ds(Vt(ao(this.pid,this.locale,this.remote)),Vt.equals),"f"),this.lifecycleLocaleFlow=T(this,ut,"f").asReadyonly(),this.onLifecycle=this.lifecycleLocaleFlow.listen,$r(this,Fr,this.onMessage(`ipc-lifecycle-remote#${this.pid}`).mapNotNull(o=>{if(o.type===q.LIFECYCLE)return o}),"f"),this.lifecycleRemoteFlow=T(this,Fr,"f"),$r(this,Kt,new _r(`fork#${this.debugId}`),"f"),r.awaitClosed().then(o=>{this.close(o)})}toString(){return`Ipc#${this.debugId}`}[($n=new WeakMap,er=new WeakMap,ut=new WeakMap,Fr=new WeakMap,Kt=new WeakMap,pi=new WeakMap,hi=new WeakMap,yi=new WeakMap,gi=new WeakMap,mi=new WeakMap,ts=new WeakMap,wi=new WeakMap,se=new WeakSet,Se)](){return this.toString()}onMessage(e){return T(this,er,"f").producer.consumer(e)}get lifecycle(){return this.lifecycleLocaleFlow.state}get isActivity(){return this.endpoint.isActivity}async awaitOpen(e){if(this.lifecycle.state.name===G.OPENED)return this.lifecycle;const r=new C,n=this.onLifecycle(s=>{switch(s.state.name){case G.OPENED:{r.resolve(s);break}case(G.CLOSED,G.CLOSING):{r.reject("endpoint already closed");break}}}),i=await r.promise;return this.console.verbose("awaitOpen",i,e),n(),i}async start(e=!0,r){this.console.verbose("start",r),e?(this.endpoint.start(!0),this.startOnce(),await this.awaitOpen(`from-start ${r}`)):(this.endpoint.start(!0),this.startOnce())}waitForkedIpc(e){return rt.getOrPut(this.forkedIpcMap,e,()=>new C).promise}async fork(e=this.locale,r=this.remote,n=!1,i){await this.awaitOpen("then-fork");const s=this.pool.createIpc(this.endpoint,this.endpoint.generatePid(),e,r,n,i);return rt.getOrPut(this.forkedIpcMap,s.pid,()=>new C).resolve(s),T(this,Kt,"f").send(s),this.postMessage(fl(s.pid,n,s.remote,s.locale,i)),s}onFork(e){return T(this,Kt,"f").consumer(e)}onRequest(e){return T(this,pi,"f").value.consumer(e)}onResponse(e){return T(this,hi,"f").value.consumer(e)}onStream(e){return T(this,yi,"f").value.consumer(e)}onEvent(e){return T(this,gi,"f").value.consumer(e)}onError(e){return T(this,mi,"f").value.consumer(e)}async request(e,r){const n=e instanceof nt?e:await T(this,se,"m",ho).call(this,e,r),i=T(this,se,"m",po).call(this,n.reqId);return this.postMessage(n),i.promise}async postMessage(e){try{await this.awaitOpen("then-postMessage")}catch(r){this.console.error(`ipc(${this}) fail to poseMessage: ${r}`);return}this.endpoint.postIpcMessage(so(this.pid,e))}get _closePo(){return new C}awaitClosed(){return this._closePo.promise}get onClosed(){return es(this._closePo.promise)}get isClosed(){return this.lifecycle.state.name==G.CLOSED}async close(e){await T(this,wi,"f").call(this,e)}prepareChannel(e,r){return Ic(this,e,r)}}tr=function(e){this.console.verbose("lifecycle-out",e),this.endpoint.postIpcMessage(so(this.pid,e))},rr=function(e,r){const n=new _r(this.debugId+T(this,er,"f").producer.name+"/"+e);this.onClosed(s=>n.close(s));const i=this.onMessage(e);return i.collect(s=>{const a=s.consumeMapNotNull(r);a!==void 0&&n.send(a)}),n.onClosed(()=>{i.close()}),n},po=function(e=T(this,se,"m",bi).call(this)){return rt.getOrPut(T(this,ts,"f").value,e,()=>new C)},ho=function(e,r){const n=T(this,se,"m",bi).call(this);return nt.fromRequest(n,this,e,r)},bi=function(){var e,r;return $r(this,$n,(r=T(this,$n,"f"),e=r++,r),"f"),e};fo([Ve(),Cn("design:type",Object),Cn("design:paramtypes",[])],rn.prototype,"_closePo",null);fo([Ve(),Cn("design:type",Object),Cn("design:paramtypes",[])],rn.prototype,"onClosed",null);var zt=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Jt,Xs,bn;class yo{constructor(e=`js-${crypto.randomUUID()}`){Object.defineProperty(this,"poolId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"console",{enumerable:!0,configurable:!0,writable:!0,value:Yr(this)}),Jt.set(this,new Set),Xs.set(this,new Map),bn.set(this,Le()),Object.defineProperty(this,"onDestory",{enumerable:!0,configurable:!0,writable:!0,value:zt(this,bn,"f").listen})}toString(){return`IpcPool#${this.poolId}`}[(Jt=new WeakMap,Xs=new WeakMap,bn=new WeakMap,Se)](){return this.toString()}createIpc(e,r,n,i,s=!1,a){const o=new rn(r,e,n,i,this,a);return this.safeCreatedIpc(o,s,a),o}safeCreatedIpc(e,r,n){zt(this,Jt,"f").add(e),r&&(this.console.verbose("do stat",n),e.start(!0,n??"autoStart")),e.onClosed(()=>{zt(this,Jt,"f").delete(e),this.console.verbose("ipcpool-remote-ipc",e)})}async destroy(){zt(this,bn,"f").emit();for(const e of zt(this,Jt,"f"))await e.close();zt(this,Jt,"f").clear()}}new yo;const hl=Object.assign((t,e)=>({...Ke(q.ERROR),errorCode:t,message:e}),{internalServer:t=>hl(500,t)});var Zs;(function(t){t.START="renderer",t.DESTROY="renderer-destroy"})(Zs||(Zs={}));var Ys;(function(t){t.Activity="activity",t.Renderer="renderer",t.RendererDestroy="renderer-destroy",t.Shortcut="shortcut"})(Ys||(Ys={}));var rs;(function(t){t.PROXY="X-Plaoc-Proxy",t.EXTERNAL_URL="X-Plaoc-External-Url",t.SESSION_ID="X-Plaoc-Session-Id",t.GET_CONFIG_URL="x-Plaoc-Config-Url"})(rs||(rs={}));function yl(t,e){return go(e?.search,(r,n)=>{t.searchParams.append(r,n)}),Object.assign(new Request(t,e),il()({fetch(){return Object.assign(fetch(this),io)}}))}function go(t,e){if(t){let r;t instanceof URLSearchParams?r=t:typeof t=="string"?r=new URLSearchParams(t):r=new URLSearchParams(Object.entries(t).filter(([n,i])=>i!=null).map(([n,i])=>[n,typeof i=="object"?JSON.stringify(i):String(i)])),r.forEach((n,i)=>{e(i,n)})}}const gl=new yo(`web-${location.host}`);class ${mmid;static urlData=new URLSearchParams(location.search);static api_url=location.origin.replace("//www","//api");static external_url=$.getUrl(rs.EXTERNAL_URL);self={mmid:"localhost.dweb",ipc_support_protocols:{cbor:!1,protobuf:!1,json:!1},dweb_deeplinks:[],categories:[],name:"plugins"};constructor(e){this.mmid=e,this.self.mmid=e}fetchApi(e,r){return this.buildApiRequest(e,r).fetch()}buildApiRequest(e,r){const n=new URL(r?.base??$.api_url);return n.pathname=`${r?.pathPrefix??this.mmid}${e}`,yl(n,r)}async buildChannel(e,r){const n=this.buildApiRequest(e,r).url.replace("http","ws"),i=new WebSocket(n);return i.binaryType=r?.binaryType??"blob",await new Promise((s,a)=>{i.onopen=s,i.onerror=a,i.onclose=a}),i}createSignal=Le;static getUrl(e){const r=this.urlData.get(e)||localStorage.getItem("url:"+e);return r===null?(console.error(`unconfig url: ${e}`),""):(localStorage.setItem("url:"+e,r),r)}}typeof HTMLElement!="function"&&Object.assign(hs,{HTMLElement:class{},customElements:{define:()=>{}}});class mo{#e;#t;#r;#n=5;ipc;constructor(e,r,n=5){this.#e=e,this.#t=r,this.#n=n,this.#r=new el(`client-${this.#e}`),this.ipc=gl.createIpc(this.#r,0,this.#t,this.#t,!0),_a(this.#r.stream,{map:async i=>{(await this.getWs()).send(i)}})}#i;async getWs(){let e=this.#i;if(e?.value?.readyState===WebSocket.CLOSING&&(e=void 0),e===void 0)for(e=new C,this.#i=e;e.is_resolved===!1;){if(this.#n--,this.#n<=0){console.error("Web Socket has exceeded the maximum number of reconnections!");break}try{const r=await new Promise((n,i)=>{const s=new WebSocket(this.#e);s.binaryType="arraybuffer",s.onclose=()=>{this.#i?.value===s&&(this.#i=void 0)},s.onerror=a=>{i(a)},s.onopen=()=>{n(s)},s.onmessage=a=>{try{const o=a.data;this.#r.send(o)}catch(o){console.error("onmessage=>",o)}}});e.resolve(r)}catch(r){console.error("WebSocketIpcBuilder",this.#n,r),await new Promise(n=>setTimeout(n,3e3))}}return e.promise}}const p=(t,e,r)=>{const n=r.value;if(typeof n!="function")throw new Error(`${t}.${e} should be function`);return r.get=function(){const i=n.bind(this);return delete r.get,r.value=i,r.writable=!0,Object.defineProperty(this,e,r),i},delete r.value,delete r.writable,r};var ns;(function(t){t.FRONT="user",t.BACK="environment"})(ns||(ns={}));var Dn;(function(t){t.QR_CODE="QR_CODE"})(Dn||(Dn={}));var Tt;(function(t){t.UserReject="UserReject",t.UserAgree="UserAgree",t.UserError="UserError"})(Tt||(Tt={}));var bo=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},cr=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class ys extends ${constructor(){super("barcode-scanning.sys.dweb")}async process(e,r=0,n=Dn.QR_CODE){return(await this.processV2(e,r,n)).map(i=>i.data)}async processV2(e,r=0,n=Dn.QR_CODE){const i=this.buildApiRequest("/process",{search:{rotation:r,formats:n},method:"POST",body:e});return await(await fetch(i)).json()}async createProcesser(){const e=await this.buildChannel("/process");e.onmessage=async a=>{const o=i.shift(),d=typeof a.data=="string"?a.data:await a.data.text();o&&o.resolve(JSON.parse(d))},e.onclose=()=>{s.stop()};const r=new ArrayBuffer(4),n=new Int32Array(r),i=[],s={setRotation(a){n[0]=a,e.send(r)},process(a){const o=new C;return i.push(o),e.send(a),o.promise},stop(){e.readyState<WebSocket.CLOSING&&e.close();for(const a of i)a.reject("stop");i.length=0}};return s}async stop(){return await this.fetchApi("/stop").boolean()}}bo([p,cr("design:type",Function),cr("design:paramtypes",[]),cr("design:returntype",Promise)],ys.prototype,"createProcesser",null);bo([p,cr("design:type",Function),cr("design:paramtypes",[]),cr("design:returntype",Promise)],ys.prototype,"stop",null);const ml=new ys;var gs=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},vr=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};const ea=String.raw;class pt extends HTMLElement{static tagName="dweb-barcode-scanning";plugin=ml;_dialog=null;_video;_canvas;_ctx;controller;_activity;_rotation=0;_isCloseLock=!1;constructor(){super();const e=this.attachShadow({mode:"open"});let r=ea`<canvas slot="canvas"></canvas>
      <video muted autoplay hidden playsinline></video>
      <style>
        :host {
          display: flex;
          justify-content: center;
          align-items: center;
        }
        video {
          display: none;
        }
        video::-webkit-media-controls {
          display: none !important;
        }

        video::-webkit-media-controls-start-playback-button {
          display: none !important;
          -webkit-appearance: none;
        }

        canvas {
          object-fit: cover;
          max-width: 100%;
          max-height: 100%;
        }
        dialog {
          max-height: unset;
          max-width: unset;
          padding: 0;
          border: 0;
          margin: 0;
          width: 100%;
          height: 100%;
          user-select: none;
          -webkit-user-select: none;
        }
      </style>`;pt._support_native_request_full_screen===!1&&(r=ea`<dialog>${r}</dialog>`),e.innerHTML=r,this._dialog=e.querySelector("dialog"),this._dialog?.addEventListener("close",()=>{this.stopScanning()}),this._dialog?.addEventListener("dblclick",()=>{this._dialog?.close()}),this._canvas=e.querySelector("canvas"),this._video=e.querySelector("video"),this._ctx=this._canvas.getContext("2d")}static _support_native_request_full_screen=!1;async requestFullscreen(e){const r=this._dialog;if(r===null)return super.requestFullscreen(e);if(r.showModal(),this._isCloseLock==!1){const n=new CloseWatcher;r.onclose=()=>n.close(),this._isCloseLock=!0,n.addEventListener("close",i=>{this._isCloseLock=!1,r.onclose=null,r.close()})}}async connectedCallback(){this.controller||(this.controller=await this.plugin.createProcesser())}disconnectedCallback(){this.stopScanning(),this.controller?.stop()}get getView(){return this._video?this._video.parentElement:null}get process(){return this.plugin.createProcesser}get stop(){return this.plugin.stop}async startScanning(e){const r=e?.rotation,n=e?.direction??ns.BACK;r&&this._rotation!=r&&(this._rotation=r,this.controller?.setRotation(this._rotation));try{const i=await this._startVideo(n,e?.width,e?.height);let s=[];return i===Tt.UserAgree&&(this.requestFullscreen({navigationUI:"show"}),s=await this.taskPhoto()),{hasContent:s.length!==0,content:s,permission:i}}catch(i){return console.log("startScanning error",i),{hasContent:!1,content:[],permission:Tt.UserError}}finally{this.stopScanning()}}stopScanning(){if(this._activity!==void 0&&(this._activity.resolve([]),this._activity=void 0),this._video.srcObject){this.plugin.stop(),this._video.pause();const e=this._video.srcObject;e instanceof MediaStream&&e.getTracks().forEach(r=>r.stop()),this._video.srcObject=null}this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=void 0),this._dialog?.close()}taskPhoto(){return this._activity===void 0?this._taskPhoto(this._activity=new C):console.warn("already running taskPhoto"),this._activity.promise}async _taskPhoto(e){if(this._canvas===null)return console.error("service close๏ผ"),[];try{const r=await(async()=>{const n=(s=.8)=>{const a=new C,o=this._canvas;return o?o.toBlob(d=>{d?a.resolve(d):a.reject("canvas fail to toBlob")},"image/jpeg",s):a.reject("canvas stop"),a.promise},i=()=>new Promise(s=>requestAnimationFrame(s));for(;e.is_finished===!1;){await i();const s=await this.controller?.process(await n());if(s&&s.length!=0)return s.map(a=>a.data)}return[]})();e.resolve(r)}catch(r){e.reject(r)}finally{e.resolve([])}}async _startVideo(e,r,n){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const i=r??innerWidth*devicePixelRatio,s=n??innerHeight*devicePixelRatio,a={audio:!1,video:{facingMode:{exact:e},width:{min:1280,ideal:i,max:1920},height:{min:720,ideal:s,max:1080}}};console.log("video window=>",i,s,innerWidth,innerHeight);const o=await navigator.mediaDevices.getUserMedia(a);try{return await this.gotMedia(o),Tt.UserAgree}catch(d){return console.warn("You need to authorize the camera permission to use the scan code!",d),this.stopScanning(),Tt.UserReject}}else return this.stopScanning(),console.error("Your browser does not support scanning code!"),Tt.UserError}rafId;async gotMedia(e){this._video.srcObject=e,await new Promise((n,i)=>{this._video.onloadedmetadata=n,this._video.onerror=i}),this._canvas.width=this._video.videoWidth,this._canvas.height=this._video.videoHeight,this._canvas.style.width=this._canvas.width+"px",this._canvas.style.height=this._canvas.height+"px";const r=e.getVideoTracks();if(console.log("ๅฝๅไฝฟ็จ็ๆๅๅคด๏ผ",r),r.length>0&&this._canvas){this._canvas.captureStream(100);const n=()=>{this.rafId=requestAnimationFrame(()=>{this._ctx.drawImage(this._video,0,0,this._canvas.width,this._canvas.height),n()})};n()}}}gs([m(),vr("design:type",Object),vr("design:paramtypes",[])],pt.prototype,"getView",null);gs([m(),vr("design:type",Object),vr("design:paramtypes",[])],pt.prototype,"process",null);gs([m(),vr("design:type",Object),vr("design:paramtypes",[])],pt.prototype,"stop",null);customElements.get(pt.tagName)||customElements.define(pt.tagName,pt);var wo=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},lr=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class ms extends ${constructor(){super("biometrics.sys.dweb")}async check(){const r=await(await this.fetchApi("/check")).text();return r=="true"?0:r=="false"?-1:+r}async biometrics(){return await this.fetchApi("/biometrics").object()}}wo([p,lr("design:type",Function),lr("design:paramtypes",[]),lr("design:returntype",Promise)],ms.prototype,"check",null);wo([p,lr("design:type",Function),lr("design:paramtypes",[]),lr("design:returntype",Promise)],ms.prototype,"biometrics",null);const bl=new ms;var ta;(function(t){t.fingerprint="fingerprint",t.faceRecognition="faceRecognition"})(ta||(ta={}));var ra;(function(t){t[t.BIOMETRIC_ERROR_NONE_ENROLLED=11]="BIOMETRIC_ERROR_NONE_ENROLLED",t[t.BIOMETRIC_SUCCESS=0]="BIOMETRIC_SUCCESS",t[t.BIOMETRIC_STATUS_UNKNOWN=-1]="BIOMETRIC_STATUS_UNKNOWN",t[t.BIOMETRIC_ERROR_UNSUPPORTED=-2]="BIOMETRIC_ERROR_UNSUPPORTED",t[t.BIOMETRIC_ERROR_HW_UNAVAILABLE=1]="BIOMETRIC_ERROR_HW_UNAVAILABLE",t[t.BIOMETRIC_ERROR_NO_HARDWARE=12]="BIOMETRIC_ERROR_NO_HARDWARE",t[t.BIOMETRIC_ERROR_SECURITY_UPDATE_REQUIRED=15]="BIOMETRIC_ERROR_SECURITY_UPDATE_REQUIRED"})(ra||(ra={}));var vo=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Mn=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Mr extends HTMLElement{static tagName="dweb-biometrics";plugin=bl;get check(){return this.plugin.check}get biometrics(){return this.plugin.biometrics}}vo([m(),Mn("design:type",Object),Mn("design:paramtypes",[])],Mr.prototype,"check",null);vo([m(),Mn("design:type",Object),Mn("design:paramtypes",[])],Mr.prototype,"biometrics",null);customElements.get(Mr.tagName)||customElements.define(Mr.tagName,Mr);var _o=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ur=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class bs extends ${constructor(){super("clipboard.sys.dweb")}async read(){return await this.fetchApi("/read").object()}async write(e){await this.fetchApi("/write",{search:{string:e.string,url:e.url,image:e.image,label:e.label}})}}_o([p,ur("design:type",Function),ur("design:paramtypes",[]),ur("design:returntype",Promise)],bs.prototype,"read",null);_o([p,ur("design:type",Function),ur("design:paramtypes",[Object]),ur("design:returntype",Promise)],bs.prototype,"write",null);const wl=new bs;var So=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},kn=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class kr extends HTMLElement{static tagName="dweb-clipboard";plugin=wl;get read(){return this.plugin.read}get write(){return this.plugin.write}}So([m(),kn("design:type",Object),kn("design:paramtypes",[])],kr.prototype,"read",null);So([m(),kn("design:type",Object),kn("design:paramtypes",[])],kr.prototype,"write",null);customElements.get(kr.tagName)||customElements.define(kr.tagName,kr);var Po=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},fr=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class ws extends ${constructor(){super("config.sys.dweb")}async setLang(e,r=!0){const n=await this.fetchApi("/setLang",{search:{lang:e},base:location.href}).boolean();return n&&r&&location.reload(),n}getLang(){return this.fetchApi("/getLang",{base:location.href}).text()}}Po([p,fr("design:type",Function),fr("design:paramtypes",[String,Object]),fr("design:returntype",Promise)],ws.prototype,"setLang",null);Po([p,fr("design:type",Function),fr("design:paramtypes",[]),fr("design:returntype",void 0)],ws.prototype,"getLang",null);const vl=new ws;var jo=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Un=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Ur extends HTMLElement{static tagName="dweb-config";plugin=vl;get setLang(){return this.plugin.setLang}get getLang(){return this.plugin.getLang}}jo([m(),Un("design:type",Object),Un("design:paramtypes",[])],Ur.prototype,"setLang",null);jo([m(),Un("design:type",Object),Un("design:paramtypes",[])],Ur.prototype,"getLang",null);customElements.get(Ur.tagName)||customElements.define(Ur.tagName,Ur);var _l=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},vi=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Oo extends ${constructor(){super("device.sys.dweb")}getUUID(){return this.fetchApi("/uuid").object()}}_l([p,vi("design:type",Function),vi("design:paramtypes",[]),vi("design:returntype",Promise)],Oo.prototype,"getUUID",null);const Sl=new Oo;class _i extends HTMLElement{static tagName="dweb-device";plugin=Sl;getUUID(){return this.plugin.getUUID()}}customElements.get(_i.tagName)||customElements.define(_i.tagName,_i);class Pl extends Event{fetchEvent;plugin;constructor(e,r){super("fetch"),this.fetchEvent=e,this.plugin=r}get request(){return this.fetchEvent.request}async getRemoteManifest(){const{request:e}=this.fetchEvent,r=e.headers.get("X-External-Dweb-Host");return console.log("getRemoteManifestๆฅ่ฏขid=>",r),await(await this.plugin.buildApiRequest("/query",{pathPrefix:"dns.std.dweb",search:{mmid:r}}).fetch()).json()}async respondWith(e,r){const n=new Response(e,r),{ipc:i,ipcRequest:s}=this.fetchEvent;i.postMessage(await it.fromResponse(s.reqId,n,i))}}var nn=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},le=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Pr extends ${tagName="dweb-service-worker";constructor(){super("dns.std.dweb")}ipc=this.createIpc();createIpc(){const e=$.api_url.replace("://api","://external"),r=new URL(e.replace(/^http/,"ws")),n=location.host.slice(9),i=$.external_url;return r.pathname=`/${i}`,new mo(r,{mmid:n,ipc_support_protocols:{cbor:!1,protobuf:!1,json:!1},dweb_deeplinks:[],categories:[],name:n}).ipc}close(){return this.fetchApi("/close").boolean()}restart(){return this.fetchApi("/restart").boolean()}async clearCache(){const e="--plaoc-session-id--",r=localStorage.getItem(e);localStorage.clear(),r&&localStorage.setItem(e,r),sessionStorage.clear();const n=[],i=indexedDB.databases().then(s=>{for(const a of s)a.name&&indexedDB.deleteDatabase(a.name)});if(n.push(i.catch(console.error)),typeof cookieStore=="object"){const s=cookieStore.getAll().then(a=>{for(const o of a)cookieStore.delete(o.name)});n.push(s.catch(console.error))}await Promise.all(n),location.replace(location.href)}async has(e){return(await this.fetchApi("/query",{search:{mmid:e}})).status===200}async fetch(e,r){const n=new URL(e);return go(r?.search,(s,a)=>{n.searchParams.append(s,a)}),[...n.searchParams.keys()].includes("activate")||n.searchParams.append("activate",String(!!r?.activate)),(await this.ipc.request(n.href,r)).toResponse()}}nn([p,le("design:type",Function),le("design:paramtypes",[]),le("design:returntype",void 0)],Pr.prototype,"close",null);nn([p,le("design:type",Function),le("design:paramtypes",[]),le("design:returntype",void 0)],Pr.prototype,"restart",null);nn([p,le("design:type",Function),le("design:paramtypes",[]),le("design:returntype",Promise)],Pr.prototype,"clearCache",null);nn([p,le("design:type",Function),le("design:paramtypes",[String]),le("design:returntype",Promise)],Pr.prototype,"has",null);nn([p,le("design:type",Function),le("design:paramtypes",[String,Object]),le("design:returntype",Promise)],Pr.prototype,"fetch",null);const jl=new Pr;var Ol=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Rl=function(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r},jn;class El{constructor(e,r){Object.defineProperty(this,"ipcRequest",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"ipc",{enumerable:!0,configurable:!0,writable:!0,value:r}),jn.set(this,void 0)}get url(){return this.ipcRequest.parsed_url}get pathname(){return this.url.pathname}get search(){return this.url.search}get searchParams(){return this.url.searchParams}get request(){return Rl(this,jn,Ol(this,jn,"f")??this.ipcRequest.toPureClientRequest(),"f")}get body(){return this.request.body}get bodyUsed(){return this.request.bodyUsed}arrayBuffer(){return this.request.arrayBuffer()}async typedArray(){return new Uint8Array(await this.request.arrayBuffer())}blob(){return this.request.blob()}formData(){return this.request.formData()}json(){return this.request.json()}text(){return this.request.text()}get headers(){return this.ipcRequest.headers}get method(){return this.ipcRequest.method}get href(){return this.url.href}get reqId(){return this.ipcRequest.reqId}}jn=new WeakMap;class na extends Event{eventName;data;constructor(e,r){super(e),this.eventName=e,this.data=r}}var ar;(function(t){t.fetch="fetch",t.shortcut="shortcut",t.close="close"})(ar||(ar={}));var Gn=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},bt=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class sn extends EventTarget{plugin=jl;messageQueue=[];shortQueue=[];isRegister=!1;constructor(){super(),this.plugin.ipc.onRequest("get-message").collect(e=>{const r=e.data;console.log("ๆถๅฐfetchๆถๆฏ",r.parsed_url.href,this.isRegister);const n=new Pl(new El(r,this.plugin.ipc),this.plugin);this.isRegister||this.messageQueue.push(n),this.dispatchEvent(n)}),this.plugin.ipc.onEvent("get-event").collect(e=>{const r=e.data,n=String(r.data);console.log("ๆถๅฐEventๆถๆฏ",r.name,n,this.isRegister);const i=new na(r.name,n);!this.isRegister&&r.name===ar.shortcut&&this.shortQueue.push(i),this.dispatchEvent(i)}),this.plugin.ipc.onClosed(e=>{this.dispatchEvent(new na(ar.close,e??""))})}start(){for(console.log("่งฆๅ็ผๅญๆถๆฏ",this.messageQueue.length);this.messageQueue.length>0;){const e=this.messageQueue.shift();console.log("ๆดพๅๆถๆฏ",e,"ๅฝๅๆถๆฏ๏ผ",this.messageQueue.length),e&&this.dispatchEvent(e)}}startShortcut(){for(console.log("่งฆๅstartShortcut็ผๅญๆถๆฏ",this.shortQueue.length);this.shortQueue.length>0;){const e=this.shortQueue.shift();console.log("ๆดพๅstartShortcutๆถๆฏ",e,"ๅฝๅๆถๆฏ๏ผ",this.shortQueue.length),e&&this.dispatchEvent(e)}}fetch(e,r){return this.plugin.fetch(e,r)}get has(){return this.plugin.has}get close(){return this.plugin.close}get restart(){return this.plugin.restart}get clearCache(){return this.plugin.clearCache}addEventListener(e,r,n){switch(super.addEventListener(e,r,n),e){case ar.fetch:{this.start(),this.isRegister=!0;break}case ar.shortcut:{this.startShortcut(),this.isRegister=!0;break}}}removeEventListener(e,r,n){return this.isRegister=!1,super.removeEventListener(e,r,n)}}Gn([m(),bt("design:type",Object),bt("design:paramtypes",[])],sn.prototype,"has",null);Gn([m(),bt("design:type",Object),bt("design:paramtypes",[])],sn.prototype,"close",null);Gn([m(),bt("design:type",Object),bt("design:paramtypes",[])],sn.prototype,"restart",null);Gn([m(),bt("design:type",Object),bt("design:paramtypes",[])],sn.prototype,"clearCache",null);const iu=new sn;var Il=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Si=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Ro extends ${constructor(){super("geolocation.sys.dweb")}getLocation(){return this.fetchApi("/location").object()}async createLocation(e){const r=await this.buildChannel("/location",{search:{precise:e?.precise,minDistance:e?.minDistance}});return new xl(r)}}Il([p,Si("design:type",Function),Si("design:paramtypes",[]),Si("design:returntype",void 0)],Ro.prototype,"getLocation",null);class xl{#e;constructor(e){this.#e=e}listen(e){if(this.isClosed)throw new Error("GeolocationController already closed");const r=async n=>{const i=typeof n.data=="string"?n.data:await n.data.text();if(i){const s=JSON.parse(i);e(s)}};return this.#e.addEventListener("message",r),()=>{this.#e.removeEventListener("message",r)}}get isClosed(){return this.#e.readyState===WebSocket.CLOSING||this.#e.readyState===WebSocket.CLOSED}stop(){this.#e.close()}get onclose(){return this.#e.onclose}set onclose(e){this.#e.onclose=e}}const Tl=new Ro;var ia;(function(t){t[t.success=0]="success",t[t.permission_denied=1]="permission_denied",t[t.position_unavailable=2]="position_unavailable",t[t.timeout=3]="timeout"})(ia||(ia={}));var Fl=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},sa=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class On extends HTMLElement{static tagName="dweb-geolocation";plugin=Tl;get getLocation(){return this.plugin.getLocation}async createLocation(e){const r=await this.plugin.createLocation(e);return r.listen(n=>{this.dispatchEvent(new CustomEvent("location",{detail:n}))}),r}}Fl([m(),sa("design:type",Object),sa("design:paramtypes",[])],On.prototype,"getLocation",null);customElements.get(On.tagName)||customElements.define(On.tagName,On);var vt=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},J=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Te extends ${static isIOSDWebBrowser=typeof self?.webkit?.messageHandlers?.haptics?.postMessage=="function";constructor(){super(Te.isIOSDWebBrowser?"haptics.browser.dweb":"haptics.sys.dweb")}async impactLight(e){return await this.fetchApi("/impactLight",{search:{style:e.style}})}async notification(e){return await this.fetchApi("/notification",{search:{style:e.type}})}async vibrateClick(){return await this.fetchApi("/vibrateClick")}async vibrateDisabled(){return await this.fetchApi("/vibrateDisabled")}async vibrateDoubleClick(){return await this.fetchApi("/vibrateDoubleClick")}async vibrateHeavyClick(){return await this.fetchApi("/vibrateHeavyClick")}async vibrateTick(){return await this.fetchApi("/vibrateTick")}async vibrate(e){const r=e?.duration||[300];return await this.fetchApi("/customize",{search:{duration:JSON.stringify(r)}})}fetchApi(e,r){return Te.isIOSDWebBrowser?hs.webkit.messageHandlers.haptics.postMessage({path:e,search:r?.search}):this.buildApiRequest(e,r).fetch()}}vt([p,J("design:type",Function),J("design:paramtypes",[Object]),J("design:returntype",Promise)],Te.prototype,"impactLight",null);vt([p,J("design:type",Function),J("design:paramtypes",[Object]),J("design:returntype",Promise)],Te.prototype,"notification",null);vt([p,J("design:type",Function),J("design:paramtypes",[]),J("design:returntype",Promise)],Te.prototype,"vibrateClick",null);vt([p,J("design:type",Function),J("design:paramtypes",[]),J("design:returntype",Promise)],Te.prototype,"vibrateDisabled",null);vt([p,J("design:type",Function),J("design:paramtypes",[]),J("design:returntype",Promise)],Te.prototype,"vibrateDoubleClick",null);vt([p,J("design:type",Function),J("design:paramtypes",[]),J("design:returntype",Promise)],Te.prototype,"vibrateHeavyClick",null);vt([p,J("design:type",Function),J("design:paramtypes",[]),J("design:returntype",Promise)],Te.prototype,"vibrateTick",null);vt([p,J("design:type",Function),J("design:paramtypes",[Object]),J("design:returntype",Promise)],Te.prototype,"vibrate",null);const Nl=new Te;var is;(function(t){t.Heavy="HEAVY",t.Medium="MEDIUM",t.Light="LIGHT"})(is||(is={}));var ss;(function(t){t.Success="SUCCESS",t.Warning="WARNING",t.Error="ERROR"})(ss||(ss={}));const su=ss,au=is;var _t=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ae=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Ce extends HTMLElement{static tagName="dweb-haptics";plugin=Nl;get vibrate(){return this.plugin.vibrate}get impactLight(){return this.plugin.impactLight}get notification(){return this.plugin.notification}get vibrateClick(){return this.plugin.vibrateClick}get vibrateDisabled(){return this.plugin.vibrateDisabled}get vibrateDoubleClick(){return this.plugin.vibrateDoubleClick}get vibrateHeavyClick(){return this.plugin.vibrateHeavyClick}get vibrateTick(){return this.plugin.vibrateTick}}_t([m(),ae("design:type",Object),ae("design:paramtypes",[])],Ce.prototype,"vibrate",null);_t([m(),ae("design:type",Object),ae("design:paramtypes",[])],Ce.prototype,"impactLight",null);_t([m(),ae("design:type",Object),ae("design:paramtypes",[])],Ce.prototype,"notification",null);_t([m(),ae("design:type",Object),ae("design:paramtypes",[])],Ce.prototype,"vibrateClick",null);_t([m(),ae("design:type",Object),ae("design:paramtypes",[])],Ce.prototype,"vibrateDisabled",null);_t([m(),ae("design:type",Object),ae("design:paramtypes",[])],Ce.prototype,"vibrateDoubleClick",null);_t([m(),ae("design:type",Object),ae("design:paramtypes",[])],Ce.prototype,"vibrateHeavyClick",null);_t([m(),ae("design:type",Object),ae("design:paramtypes",[])],Ce.prototype,"vibrateTick",null);customElements.get(Ce.tagName)||customElements.define(Ce.tagName,Ce);var an=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ue=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class jr extends ${constructor(){super("keychain.sys.dweb")}async keys(){return await this.fetchApi("/keys").object()}async get(e){const r=await this.fetchApi("/get",{search:{key:e}});if(r.status!==404)return await ro.ok.call(r),new Uint8Array(await r.arrayBuffer())}async set(e,r){let n,i;return typeof r=="string"?i=r:i=Go(r),await this.fetchApi("/set",{search:{key:e,value:i,encoding:n}}).object()}async delete(e){return await this.fetchApi("/delete",{search:{key:e}}).object()}async has(e){return await this.fetchApi("/has",{search:{key:e}}).object()}}an([p,ue("design:type",Function),ue("design:paramtypes",[]),ue("design:returntype",Promise)],jr.prototype,"keys",null);an([p,ue("design:type",Function),ue("design:paramtypes",[String]),ue("design:returntype",Promise)],jr.prototype,"get",null);an([p,ue("design:type",Function),ue("design:paramtypes",[String,Object]),ue("design:returntype",Promise)],jr.prototype,"set",null);an([p,ue("design:type",Function),ue("design:paramtypes",[String]),ue("design:returntype",Promise)],jr.prototype,"delete",null);an([p,ue("design:type",Function),ue("design:paramtypes",[String]),ue("design:returntype",Promise)],jr.prototype,"has",null);const Bl=new jr;var on=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},He=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class ht extends HTMLElement{static tagName="dweb-keychain";plugin=Bl;get keys(){return this.plugin.keys}get get(){return this.plugin.get}get set(){return this.plugin.set}get has(){return this.plugin.has}get delete(){return this.plugin.delete}}on([m(),He("design:type",Object),He("design:paramtypes",[])],ht.prototype,"keys",null);on([m(),He("design:type",Object),He("design:paramtypes",[])],ht.prototype,"get",null);on([m(),He("design:type",Object),He("design:paramtypes",[])],ht.prototype,"set",null);on([m(),He("design:type",Object),He("design:paramtypes",[])],ht.prototype,"has",null);on([m(),He("design:type",Object),He("design:paramtypes",[])],ht.prototype,"delete",null);customElements.get(ht.tagName)||customElements.define(ht.tagName,ht);var Nt;(function(t){t.UTF8="utf8",t.BASE64="base64",t.BINARY="binary"})(Nt||(Nt={}));async function as(t){const e=new FileReader,r=new C;return e.onloadend=()=>{let n="";const i=new Uint8Array(e.result);for(const s of i)n+=String.fromCharCode(s);r.resolve(btoa(n))},e.readAsArrayBuffer(t),await r.promise}var Al=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Pi=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Eo extends ${constructor(){super("media.file.sys.dweb")}async savePictures(e){const r=await this.#t(e),n=Zr(r);return this.buildApiRequest("/savePictures",{search:{saveLocation:e.saveLocation},headers:{"Content-Type":"application/cbor","Content-Length":n.length.toString()},method:"POST",body:n}).fetch()}#e(e){const r=new FormData;return e.file&&r.append("files",e.file),this.buildApiRequest("/savePictures",{search:{saveLocation:e.saveLocation},method:"POST",body:r}).fetch()}async#t(e){const r=[];if(e.file&&e.file.type.startsWith("image/")){const n=await as(e.file);r.push({name:e.file.name,type:e.file.type,size:e.file.size,encoding:Nt.BASE64,data:n})}return r}}Al([p,Pi("design:type",Function),Pi("design:paramtypes",[Object]),Pi("design:returntype",Promise)],Eo.prototype,"savePictures",null);const Ll=new Eo;var Cl=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},aa=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Rn extends HTMLElement{static tagName="dweb-media";plugin=Ll;get savePictures(){return this.plugin.savePictures}}Cl([m(),aa("design:type",Object),aa("design:paramtypes",[])],Rn.prototype,"savePictures",null);customElements.get(Rn.tagName)||customElements.define(Rn.tagName,Rn);var Io=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},dr=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class vs extends ${constructor(){super("motion-sensors.sys.dweb")}coder={decode:e=>e,encode:e=>e};async startAccelerometer(e){const r=await this.buildChannel("/observe/accelerometer",{search:{fps:e}});return{listen(i){r.onmessage=async s=>{const a=typeof s.data=="string"?s.data:await s.data.text(),o=JSON.parse(a);i(o)}},stop(){r.close()}}}async startGyroscope(e){const r=await this.buildChannel("/observe/gyroscope",{search:{fps:e}});return{listen(i){r.onmessage=async s=>{const a=typeof s.data=="string"?s.data:await s.data.text(),o=JSON.parse(a);i(o)}},stop(){r.close()}}}}Io([p,dr("design:type",Function),dr("design:paramtypes",[Number]),dr("design:returntype",Promise)],vs.prototype,"startAccelerometer",null);Io([p,dr("design:type",Function),dr("design:paramtypes",[Number]),dr("design:returntype",Promise)],vs.prototype,"startGyroscope",null);const ji=new vs;class oa extends HTMLElement{static tagName="dweb-motion-sensors";plugin=ji;async startAccelerometer(e){const r=await ji.startAccelerometer(e);return r.listen(n=>{this.dispatchEvent(new CustomEvent("readAccelerometer",{detail:n}))}),r}async startGyroscope(e){const r=await ji.startGyroscope(e);return r.listen(n=>{this.dispatchEvent(new CustomEvent("readGyroscope",{detail:n}))}),r}}customElements.define(oa.tagName,oa);var ca;(function(t){t.SHOW="onShow",t.HIDE="onHide",t.COLOR_CHANGE="onColorChange"})(ca||(ca={}));const xo=t=>new Qn(t.left,t.top,t.right,t.bottom),To=t=>({left:t.left,top:t.top,right:t.right,bottom:t.bottom});class Qn{left;top;right;bottom;constructor(e,r,n,i){this.left=e,this.top=r,this.right=n,this.bottom=i}toCss(e){const{css_var_prefix:r,density:n}=$l(e);return[[`${r}left`,`${this.left/n}px`],[`${r}top`,`${this.top/n}px`],[`${r}right`,`${this.right/n}px`],[`${r}bottom`,`${this.bottom/n}px`]]}toCssText(e){return this.toCss(e).map(([r,n])=>`${r}:${n};`).join(" ")}setStyle(e,r){for(const[n,i]of this.toCss(r))e.setProperty(n,i)}effect(e){const r=e.css_var_prefix?.concat("<<prefix")??e.css_var_name?.concat("<<name")??"default";let n=document.getElementById(r);n==null&&(n=document.createElement("style"),document.head.appendChild(n),n.id=r);let i=`:root {${this.toCssText(e)}}`;e.layer&&(i=`@layer ${e.layer} {${i}}`),n.innerHTML=i}}const $l=(t={})=>{const e=t.css_var_prefix??(t.css_var_name?`--${t.css_var_name}-inset-`:"--inset-"),r=t.density??globalThis.devicePixelRatio;return{css_var_prefix:e,density:r}};var Dl=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Oi=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Xn{plugin;fetcher;coder;buildWsUrl;_ipc;constructor(e,r,n,i=async s=>s){this.plugin=e,this.fetcher=r,this.coder=n,this.buildWsUrl=i}ws;async jsonlines(e){const r=$.api_url,n=new URL(r.replace(/^http/,"ws"));n.pathname=`/${this.plugin.mmid}/observe`;const i=(await this.buildWsUrl(n)??n).href;return ol(new ReadableStream({pull:s=>{this.pullMessage(i,s)},cancel:()=>{this.ws?.close()}}),e)}pullMessage(e,r){(this.ws==null||this.ws.readyState===WebSocket.CLOSING)&&(console.log(`re-create=>${e}`,this.ws?.readyState),this.ws=new WebSocket(e),this.ws.onmessage=n=>{const i=n.data;typeof i=="string"&&(this.currentState=JSON.parse(i),r.enqueue(i))})}stopObserve(){this._ipc?.close()}_currentState;get currentState(){return this._currentState}set currentState(e){this._currentState=e,e&&this._signalCurrentStateChange.emit(e)}_signalCurrentStateChange=Le();onChange=this._signalCurrentStateChange.listen;async getState(e=!1){return e||this.currentState===void 0?await this._updateCurrentState():this.currentState}async _updateCurrentState(){const e=await this.fetcher();return this.currentState=this.coder.decode(e)}}Dl([p,Oi("design:type",Function),Oi("design:paramtypes",[Object]),Oi("design:returntype",Promise)],Xn.prototype,"getState",null);var cn=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},he=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class St extends ${baseCoder={decode:e=>({...e,insets:xo(e.insets)}),encode:e=>({...e,insets:To(e.insets)})};get state(){return new Xn(this,()=>this.commonGetState(),this.coder)}async commonSetState(e){await this.fetchApi("/setState",{search:e}).ok()}static rid_acc=1;async commonGetState(){return await this.fetchApi("/getState",{search:{rid:St.rid_acc++}}).object()}get getState(){return this.state.getState}setOverlay(e){return this.setStateByKey("overlay",e)}async getOverlay(){return(await this.state.getState()).overlay}}cn([m(),he("design:type",Object),he("design:paramtypes",[])],St.prototype,"state",null);cn([p,he("design:type",Function),he("design:paramtypes",[Object]),he("design:returntype",Promise)],St.prototype,"commonSetState",null);cn([p,he("design:type",Function),he("design:paramtypes",[]),he("design:returntype",Promise)],St.prototype,"commonGetState",null);cn([p,he("design:type",Function),he("design:paramtypes",[Boolean]),he("design:returntype",void 0)],St.prototype,"setOverlay",null);cn([p,he("design:type",Function),he("design:paramtypes",[]),he("design:returntype",Promise)],St.prototype,"getOverlay",null);var ze=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},D=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},Ie;(function(t){t.Dark="DARK",t.Light="LIGHT",t.Default="DEFAULT"})(Ie||(Ie={}));class Je extends St{setColor(e){return this.setStateByKey("color",e)}async getColor(){return(await this.state.getState()).color}setStyle(e){return this.setStateByKey("style",e)}async getStyle(){return(await this.state.getState()).style}show(){return this.setVisible(!0)}hide(){return this.setVisible(!1)}setVisible(e){return this.setStateByKey("visible",e)}async getVisible(){return(await this.state.getState()).visible}setOverlay(e){return this.setStateByKey("overlay",e)}async getOverlay(){return(await this.state.getState()).overlay}}ze([p,D("design:type",Function),D("design:paramtypes",[String]),D("design:returntype",void 0)],Je.prototype,"setColor",null);ze([p,D("design:type",Function),D("design:paramtypes",[]),D("design:returntype",Promise)],Je.prototype,"getColor",null);ze([p,D("design:type",Function),D("design:paramtypes",[Object]),D("design:returntype",void 0)],Je.prototype,"setStyle",null);ze([p,D("design:type",Function),D("design:paramtypes",[]),D("design:returntype",Promise)],Je.prototype,"getStyle",null);ze([p,D("design:type",Function),D("design:paramtypes",[]),D("design:returntype",void 0)],Je.prototype,"show",null);ze([p,D("design:type",Function),D("design:paramtypes",[]),D("design:returntype",void 0)],Je.prototype,"hide",null);ze([p,D("design:type",Function),D("design:paramtypes",[Boolean]),D("design:returntype",void 0)],Je.prototype,"setVisible",null);ze([p,D("design:type",Function),D("design:paramtypes",[]),D("design:returntype",Promise)],Je.prototype,"getVisible",null);ze([p,D("design:type",Function),D("design:paramtypes",[Boolean]),D("design:returntype",void 0)],Je.prototype,"setOverlay",null);ze([p,D("design:type",Function),D("design:paramtypes",[]),D("design:returntype",Promise)],Je.prototype,"getOverlay",null);var De=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},A=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},la;class Fe extends ${constructor(){super("window.sys.dweb")}async setState(e){let r;switch(e.style){case Ie.Dark:r="#000000";break;case Ie.Light:r="#FFFFFF";break;default:r="auto"}Ae.setStyle({bottomBarBackgroundColor:e.color,bottomBarContentColor:r,bottomBarOverlay:e.overlay})}setStateByKey(e,r){return this.setState({[e]:r})}async getState(){const e=await Ae.getState();let r=Ie.Default;switch(e.bottomBarContentColor){case"#FFFFFF":r=Ie.Light;break;case"#000000":r=Ie.Dark;break}return{color:e.bottomBarBackgroundColor,style:r,overlay:e.bottomBarOverlay,visible:!0,insets:new Qn(0,0,0,0)}}setColor(e){return this.setStateByKey("color",e)}async getColor(){return(await this.getState()).color}setStyle(e){return this.setState({style:e})}async getStyle(){return(await this.getState()).style}setOverlay(e){return this.setState({overlay:e})}async getOverlay(){return(await this.getState()).overlay}setVisible(e){return this.setState({visible:e})}async getVisible(){return(await this.getState()).visible}}De([p,A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",Promise)],Fe.prototype,"setState",null);De([p,A("design:type",Function),A("design:paramtypes",[typeof(la=typeof K<"u"&&K)=="function"?la:Object,Object]),A("design:returntype",void 0)],Fe.prototype,"setStateByKey",null);De([p,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Promise)],Fe.prototype,"getState",null);De([p,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",void 0)],Fe.prototype,"setColor",null);De([p,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Promise)],Fe.prototype,"getColor",null);De([p,A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",void 0)],Fe.prototype,"setStyle",null);De([p,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Promise)],Fe.prototype,"getStyle",null);De([p,A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",void 0)],Fe.prototype,"setOverlay",null);De([p,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Promise)],Fe.prototype,"getOverlay",null);De([p,A("design:type",Function),A("design:paramtypes",[Boolean]),A("design:returntype",void 0)],Fe.prototype,"setVisible",null);De([p,A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",Promise)],Fe.prototype,"getVisible",null);const qe=new Fe;var at=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ne=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class xe extends HTMLElement{static tagName="dweb-navigation-bar";plugin=qe;get setColor(){return qe.setColor}get getColor(){return qe.getColor}get setStyle(){return qe.setStyle}get getStyle(){return qe.getStyle}get setVisible(){return qe.setVisible}get getVisible(){return qe.getVisible}get getState(){return qe.getState}get setOverlay(){return qe.setOverlay}get getOverlay(){return qe.getOverlay}}at([m(),ne("design:type",Object),ne("design:paramtypes",[])],xe.prototype,"setColor",null);at([m(),ne("design:type",Object),ne("design:paramtypes",[])],xe.prototype,"getColor",null);at([m(),ne("design:type",Object),ne("design:paramtypes",[])],xe.prototype,"setStyle",null);at([m(),ne("design:type",Object),ne("design:paramtypes",[])],xe.prototype,"getStyle",null);at([m(),ne("design:type",Object),ne("design:paramtypes",[])],xe.prototype,"setVisible",null);at([m(),ne("design:type",Object),ne("design:paramtypes",[])],xe.prototype,"getVisible",null);at([m(),ne("design:type",Object),ne("design:paramtypes",[])],xe.prototype,"getState",null);at([m(),ne("design:type",Object),ne("design:paramtypes",[])],xe.prototype,"setOverlay",null);at([m(),ne("design:type",Object),ne("design:paramtypes",[])],xe.prototype,"getOverlay",null);customElements.get(xe.tagName)||customElements.define(xe.tagName,xe);var Ml=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Ri=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Fo extends ${constructor(){super("window.sys.dweb")}getOverlay(){return!1}}Ml([p,Ri("design:type",Function),Ri("design:paramtypes",[]),Ri("design:returntype",void 0)],Fo.prototype,"getOverlay",null);const ua=new Fo;var kl=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},fa=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class En extends HTMLElement{static tagName="dweb-safe-area";plugin=ua;get getOverlay(){return ua.getOverlay}}kl([m(),fa("design:type",Object),fa("design:paramtypes",[])],En.prototype,"getOverlay",null);customElements.get(En.tagName)||customElements.define(En.tagName,En);var Pe=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},E=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},da;class me extends ${constructor(){super("window.sys.dweb")}setState(e){let r;switch(e.style){case Ie.Dark:r="#000000";break;case Ie.Light:r="#FFFFFF";break;default:r="auto"}Ae.setStyle({topBarBackgroundColor:e.color,topBarContentColor:r,topBarOverlay:e.overlay})}setStateByKey(e,r){return this.setState({[e]:r})}async getState(){const e=await Ae.getState();let r=Ie.Default;switch(e.topBarContentColor){case"#FFFFFF":r=Ie.Light;break;case"#000000":r=Ie.Dark;break}return{color:e.topBarBackgroundColor,style:r,overlay:e.topBarOverlay,visible:!0,insets:new Qn(0,0,0,0)}}setColor(e){return this.setStateByKey("color",e)}async getColor(){return(await this.getState()).color}setStyle(e){return this.setState({style:e})}async getStyle(){return(await this.getState()).style}setOverlay(e){return this.setState({overlay:e})}async getOverlay(){return(await this.getState()).overlay}setVisible(e){return this.setState({visible:e})}async getVisible(){return(await this.getState()).visible}async show(){}async hide(){}}Pe([p,E("design:type",Function),E("design:paramtypes",[Object]),E("design:returntype",void 0)],me.prototype,"setState",null);Pe([p,E("design:type",Function),E("design:paramtypes",[typeof(da=typeof K<"u"&&K)=="function"?da:Object,Object]),E("design:returntype",void 0)],me.prototype,"setStateByKey",null);Pe([p,E("design:type",Function),E("design:paramtypes",[]),E("design:returntype",Promise)],me.prototype,"getState",null);Pe([p,E("design:type",Function),E("design:paramtypes",[String]),E("design:returntype",void 0)],me.prototype,"setColor",null);Pe([p,E("design:type",Function),E("design:paramtypes",[]),E("design:returntype",Promise)],me.prototype,"getColor",null);Pe([p,E("design:type",Function),E("design:paramtypes",[String]),E("design:returntype",void 0)],me.prototype,"setStyle",null);Pe([p,E("design:type",Function),E("design:paramtypes",[]),E("design:returntype",Promise)],me.prototype,"getStyle",null);Pe([p,E("design:type",Function),E("design:paramtypes",[Boolean]),E("design:returntype",void 0)],me.prototype,"setOverlay",null);Pe([p,E("design:type",Function),E("design:paramtypes",[]),E("design:returntype",Promise)],me.prototype,"getOverlay",null);Pe([p,E("design:type",Function),E("design:paramtypes",[Boolean]),E("design:returntype",void 0)],me.prototype,"setVisible",null);Pe([p,E("design:type",Function),E("design:paramtypes",[]),E("design:returntype",Promise)],me.prototype,"getVisible",null);Pe([p,E("design:type",Function),E("design:paramtypes",[]),E("design:returntype",Promise)],me.prototype,"show",null);Pe([p,E("design:type",Function),E("design:paramtypes",[]),E("design:returntype",Promise)],me.prototype,"hide",null);const je=new me;var Me=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},X=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class ye extends HTMLElement{static tagName="dweb-status-bar";plugin=je;get setColor(){return je.setColor}get getColor(){return je.getColor}get setStyle(){return je.setStyle}get getStyle(){return je.getStyle}get show(){return je.show}get hide(){return je.hide}get setVisible(){return je.setVisible}get getVisible(){return je.getVisible}get getState(){return je.getState}get setOverlay(){return je.setOverlay}get getOverlay(){return je.getOverlay}}Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"setColor",null);Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"getColor",null);Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"setStyle",null);Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"getStyle",null);Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"show",null);Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"hide",null);Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"setVisible",null);Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"getVisible",null);Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"getState",null);Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"setOverlay",null);Me([m(),X("design:type",Object),X("design:paramtypes",[])],ye.prototype,"getOverlay",null);customElements.get(ye.tagName)||customElements.define(ye.tagName,ye);var No=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},pr=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class _s extends ${constructor(){super("torch.nativeui.browser.dweb")}async toggleTorch(){return await this.fetchApi("/toggleTorch").boolean()}async getTorchState(){return await this.fetchApi("/torchState").boolean()}}No([p,pr("design:type",Function),pr("design:paramtypes",[]),pr("design:returntype",Promise)],_s.prototype,"toggleTorch",null);No([p,pr("design:type",Function),pr("design:paramtypes",[]),pr("design:returntype",Promise)],_s.prototype,"getTorchState",null);const Ei=new _s;var Bo=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},qn=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class qr extends HTMLElement{static tagName="dweb-torch";plugin=Ei;get toggleTorch(){return Ei.toggleTorch}get getTorchState(){return Ei.getTorchState}}Bo([m(),qn("design:type",Object),qn("design:paramtypes",[])],qr.prototype,"toggleTorch",null);Bo([m(),qn("design:type",Object),qn("design:paramtypes",[])],qr.prototype,"getTorchState",null);customElements.get(qr.tagName)||customElements.define(qr.tagName,qr);class Ul extends EventTarget{addEventListener(e,r,n){super.addEventListener(e,r,n)}removeEventListener(e,r,n){super.removeEventListener(e,r,n)}dispatchEvent(e){const r=Reflect.get(this,"on"+e.type);if(typeof r=="function")try{r.call(this,e)}catch{}return super.dispatchEvent(e)}}class Ii extends Event{constructor(e,r){super(e,r)}}class ql extends Event{state;constructor(e,r){super(e,r),this.state=r.state}}var H;(function(t){t.INIT="init",t.OPENING="opening",t.OPEN="open",t.CLOSING="closing",t.CLOSE="close",t.DESTROYING="destroying",t.DESTROY="destroy"})(H||(H={}));class Ao extends Ul{plugin;modal;constructor(e,r,n){super(),this.plugin=e,this.modal=r,n.listen(i=>{switch(i.type){case"open":this.setState(H.OPEN);break;case"close":this.setState(H.CLOSE);break;case"close-alert":this.setState(H.CLOSE);break}}),this._init()}_init(){}#e=H.INIT;setState(e){if(e!==this.#e)switch(this.#e=e,this.dispatchEvent(new ql("statechange",{state:e})),e){case H.OPEN:this.dispatchEvent(new Ii(H.OPEN));break;case H.CLOSE:this.dispatchEvent(new Ii(H.CLOSE));break;case H.DESTROY:this.dispatchEvent(new Ii(H.DESTROY));break}}get state(){return this.#e}isState(...e){for(const r of e)if(r===this.state)return!0;return!1}awaitState(e){if(this.state===e)return;const r=new C,n=this;return this.addEventListener("statechange",function i(s){s.state===e&&(r.resolve(),n.removeEventListener("statechange",i))}),r.promise}get isDestroyed(){return this.isState(H.DESTROYING,H.DESTROY)}async open(){this.isDestroyed||this.isState(H.OPENING,H.OPEN)||(this.setState(H.OPENING),await this.plugin.fetchApi("/openModal",{pathPrefix:"window.sys.dweb",search:{modalId:this.modal.modalId}}).boolean(),await this.awaitState(H.OPEN))}async close(){this.isDestroyed||this.isState(H.CLOSING,H.CLOSE)||(this.setState(H.CLOSING),await this.plugin.fetchApi("/closeModal",{pathPrefix:"window.sys.dweb",search:{modalId:this.modal.modalId}}).boolean(),await this.awaitState(H.CLOSE))}async destroy(){this.isDestroyed||(this.setState(H.DESTROYING),await this.plugin.fetchApi("/removeModal",{pathPrefix:"window.sys.dweb",search:{modalId:this.modal.modalId}}).boolean(),await this.awaitState(H.DESTROY))}}class Wl extends Ao{constructor(e,r,n){super(e,r,n),n.listen(i=>{i.type==="close-alert"&&(this.#e=i.confirm),i.type==="open"&&(this.#e=!1)})}#e=!1;get result(){return this.#e}}class Hl extends Ao{constructor(e,r,n){super(e,r,n)}}var be=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},R=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class fe extends ${constructor(){super("window.sys.dweb")}coder={decode:e=>({...e}),encode:e=>({...e})};get windowInfo(){return this.fetchApi("/window-info",{pathPrefix:"internal"}).object()}get state(){return new Xn(this,()=>this.fetchState(),this.coder,async e=>{e.searchParams.set("wid",(await this.windowInfo).wid)})}async fetchState(){return await this.fetchApi("/getState",{search:await this.windowInfo}).object()}async getDisplay(){return await this.fetchApi("/getDisplayInfo",{search:await this.windowInfo}).object()}async setBounds(e,r,n){return this.fetchApi("/setBounds",{search:{wid:(await this.windowInfo).wid,resizable:e,width:r,height:n}})}get getState(){return this.state.getState}async setStyle(e){return this.fetchApi("/setStyle",{search:{...e,...await this.windowInfo}})}async focusWindow(){return this.fetchApi("/focus",{search:await this.windowInfo})}async blurWindow(){return this.fetchApi("/blur",{search:await this.windowInfo})}async maximize(){return this.fetchApi("/maximize",{search:await this.windowInfo})}async unMaximize(){return this.fetchApi("/unMaximize",{search:await this.windowInfo})}async visible(){return this.fetchApi("/visible",{search:await this.windowInfo})}async close(){return this.fetchApi("/close",{search:await this.windowInfo})}getWindowIpc(e){return new mo(e,this.self).ipc}async createModalArgs(e,r,n=!1,i=!1){const s=`${e}-${Math.random().toString(26).substring(2)}`,a=new URL(`/internal/callback?id=${s}`,$.api_url),o=new URL("/internal/registry-callback",$.api_url);o.protocol="wss",o.searchParams.set("id",s),console.log("window#createModalArgs=>",o.href);const d=this.getWindowIpc(o),b=new Kn;d.onRequest("registry-callback").collect(async P=>{const M=P.consume(),te=JSON.parse(await M.body.text());b.emit(te),d.postMessage(it.fromText(M.reqId,200,void 0,"",d))});const _=await this.fetchApi("/createModal",{search:{type:e,...r,callbackUrl:a,open:n,once:i}}).object();return{onCallback:b,modal:_}}async alert(e){const r=await this.createModalArgs("alert",e,!0,!0),n=new Wl(this,r.modal,r.onCallback),i=new C;return n.addEventListener("close",()=>{i.resolve(n.result)}),i.promise}async createBottomSheets(e){const r=await this.createModalArgs("bottom-sheets",{},!0,!0),n=new Hl(this,r.modal,r.onCallback);return await this.fetchApi("/open",{pathPrefix:"webview.sys.dweb",search:{url:e,rid:n.modal.renderId}}),n}}be([m(),R("design:type",Object),R("design:paramtypes",[])],fe.prototype,"windowInfo",null);be([m(),R("design:type",Object),R("design:paramtypes",[])],fe.prototype,"state",null);be([p,R("design:type",Function),R("design:paramtypes",[]),R("design:returntype",Promise)],fe.prototype,"fetchState",null);be([p,R("design:type",Function),R("design:paramtypes",[]),R("design:returntype",Promise)],fe.prototype,"getDisplay",null);be([p,R("design:type",Function),R("design:paramtypes",[Boolean,Number,Number]),R("design:returntype",Promise)],fe.prototype,"setBounds",null);be([p,R("design:type",Function),R("design:paramtypes",[Object]),R("design:returntype",Promise)],fe.prototype,"setStyle",null);be([p,R("design:type",Function),R("design:paramtypes",[]),R("design:returntype",Promise)],fe.prototype,"focusWindow",null);be([p,R("design:type",Function),R("design:paramtypes",[]),R("design:returntype",Promise)],fe.prototype,"blurWindow",null);be([p,R("design:type",Function),R("design:paramtypes",[]),R("design:returntype",Promise)],fe.prototype,"maximize",null);be([p,R("design:type",Function),R("design:paramtypes",[]),R("design:returntype",Promise)],fe.prototype,"unMaximize",null);be([p,R("design:type",Function),R("design:paramtypes",[]),R("design:returntype",Promise)],fe.prototype,"visible",null);be([p,R("design:type",Function),R("design:paramtypes",[]),R("design:returntype",Promise)],fe.prototype,"close",null);be([p,R("design:type",Function),R("design:paramtypes",[Object]),R("design:returntype",Promise)],fe.prototype,"alert",null);be([p,R("design:type",Function),R("design:paramtypes",[String]),R("design:returntype",Promise)],fe.prototype,"createBottomSheets",null);const Ae=new fe;var Or=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ie=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)},pa;class Dt extends ${constructor(){super("window.sys.dweb")}coder={decode:e=>({overlay:e.overlay,insets:xo(e.insets)}),encode:e=>({overlay:e.overlay,insets:To(e.insets)})};get state(){return new Xn(this,()=>this.getState(),this.coder,async e=>{e.pathname="/observe-keyboard",e.searchParams.set("wid",(await Ae.windowInfo).wid)})}async setState(e){await Ae.setStyle({keyboardOverlaysContent:e.overlay})}setStateByKey(e,r){return this.setState({[e]:r})}async getState(){return{overlay:(await Ae.getState()).keyboardOverlaysContent,insets:new Qn(0,0,0,0)}}setOverlay(e){return this.setStateByKey("overlay",e)}async getOverlay(){return(await this.getState()).overlay}}Or([m(),ie("design:type",Object),ie("design:paramtypes",[])],Dt.prototype,"state",null);Or([p,ie("design:type",Function),ie("design:paramtypes",[Object]),ie("design:returntype",Promise)],Dt.prototype,"setState",null);Or([p,ie("design:type",Function),ie("design:paramtypes",[typeof(pa=typeof K<"u"&&K)=="function"?pa:Object,Object]),ie("design:returntype",void 0)],Dt.prototype,"setStateByKey",null);Or([p,ie("design:type",Function),ie("design:paramtypes",[]),ie("design:returntype",Promise)],Dt.prototype,"getState",null);Or([p,ie("design:type",Function),ie("design:paramtypes",[Boolean]),ie("design:returntype",void 0)],Dt.prototype,"setOverlay",null);Or([p,ie("design:type",Function),ie("design:paramtypes",[]),ie("design:returntype",Promise)],Dt.prototype,"getOverlay",null);const Gt=new Dt;class Lo extends HTMLElement{state;constructor(e){super(),this.state=e,(async()=>{const r=await e.jsonlines();for await(const n of r);})()}#e;async connectedCallback(){this.#e=this.state.onChange(e=>{this.dispatchEvent(new CustomEvent("statechange",{detail:e}))}),await this.state.getState(!0)}async disconnectedCallback(){this.#e&&(this.#e(),this.#e=void 0),await this.state.stopObserve()}}var Zn=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},wt=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Lt extends Lo{static tagName="dweb-virtual-keyboard";plugin=Gt;constructor(){super(Gt.state)}get getState(){return Gt.getState}get setState(){return Gt.setStateByKey}get setOverlay(){return Gt.setOverlay}get getOverlay(){return Gt.getOverlay}}Zn([m(),wt("design:type",Object),wt("design:paramtypes",[])],Lt.prototype,"getState",null);Zn([m(),wt("design:type",Object),wt("design:paramtypes",[])],Lt.prototype,"setState",null);Zn([m(),wt("design:type",Object),wt("design:paramtypes",[])],Lt.prototype,"setOverlay",null);Zn([m(),wt("design:type",Object),wt("design:paramtypes",[])],Lt.prototype,"getOverlay",null);customElements.get(Lt.tagName)||customElements.define(Lt.tagName,Lt);class Vl extends EventTarget{app_kit;constructor(e){super(),this.app_kit=e}addEventListener(e,r,n){this.app_kit._listeners[e]||(this.app_kit._listeners[e]=[]),this.app_kit._listeners[e].push(r);const s=this.app_kit._windowListeners[e];s&&!s.registered&&this.addWindowListener(s,n);const a=()=>this.removeEventListener(e,r),o=Promise.resolve({remove:a});return Object.defineProperty(o,"remove",{value:()=>{console.warn("Using addListener() without 'await' is deprecated."),a()}}),o}addWindowListener(e,r){super.addEventListener(e.windowEventName,e.handler,r),e.registered=!0}removeEventListener(e,r,n){const i=this.app_kit._listeners[e];if(!i)return;const s=i.indexOf(r);this.app_kit._listeners[e].splice(s,1),this.app_kit._listeners[e].length||this.removeWindowListener(this.app_kit._windowListeners[e],n)}removeWindowListener(e,r){e&&(super.removeEventListener(e.windowEventName,e.handler,r),e.registered=!1)}hasListeners(e){return!!this.app_kit._listeners[e].length}notifyListeners(e,r){const n=this.app_kit._listeners[e];n&&n.forEach(i=>i(r))}}var Co=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},hr=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};const Kl={_listeners:{},_windowListeners:{}};class Ss extends Vl{constructor(){super(Kl),typeof hs<"u"&&(globalThis.addEventListener("online",this.handleOnline),globalThis.addEventListener("offline",this.handleOffline))}onLine(){return navigator.onLine}async getStatus(){if(!globalThis.navigator)throw Error("Browser does not support the Network Information API");const e=globalThis.navigator.onLine,r=ha();return{connected:e,connectionType:e?r:"none"}}handleOnline=()=>{const r={connected:!0,connectionType:ha()};this.notifyListeners("onLine",new Event("onLine")),this.notifyListeners("change",r)};handleOffline=()=>{const e={connected:!1,connectionType:"none"};this.notifyListeners("offLine",new Event("offLine")),this.notifyListeners("change",e)}}Co([p,hr("design:type",Function),hr("design:paramtypes",[]),hr("design:returntype",Boolean)],Ss.prototype,"onLine",null);Co([p,hr("design:type",Function),hr("design:paramtypes",[]),hr("design:returntype",Promise)],Ss.prototype,"getStatus",null);const zl=new Ss;function ha(){const t=globalThis.navigator.connection||globalThis.navigator.mozConnection||globalThis.navigator.webkitConnection;let e="unknown";const r=t?t.type||t.effectiveType:null;if(r&&typeof r=="string")switch(r){case"bluetooth":case"cellular":e="cellular";break;case"none":e="none";break;case"ethernet":case"wifi":case"wimax":e="wifi";break;case"other":case"unknown":e="unknown";break;case"slow-2g":case"2g":e="2g";break;case"3g":e="3g";break;case"4g":e="4g";break;case"5g":e="5g";break;case"6g":e="6g";break}return e}var $o=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Wn=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Wr extends HTMLElement{static tagName="dweb-network";plugin=zl;get getStatus(){return this.plugin.getStatus}get onLine(){return this.plugin.onLine}}$o([m(),Wn("design:type",Object),Wn("design:paramtypes",[])],Wr.prototype,"getStatus",null);$o([m(),Wn("design:type",Object),Wn("design:paramtypes",[])],Wr.prototype,"onLine",null);customElements.get(Wr.tagName)||customElements.define(Wr.tagName,Wr);var Do=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},yr=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Ps extends ${constructor(){super("share.sys.dweb")}async canShare(){return!(typeof navigator>"u"||!navigator.share)}async#e(e){const r=new FormData;if(e.files&&e.files.length!==0)for(let i=0;i<e.files.length;i++){const s=e.files.item(i);r.append("files",s)}return e.file&&r.append("files",e.file),await this.buildApiRequest("/share",{search:{title:e?.title,text:e?.text,url:e?.url},method:"POST",body:r}).fetch().object()}async#t(e,r){const n=new C,i=new Image;return i.onload=()=>{const s=i.width,a=i.height,o=document.createElement("canvas"),d=o.getContext("2d");o.width=s,o.height=a,d.drawImage(i,0,0,s,a);const b=o.toDataURL(r.type.startsWith("image/")?r.type:"image/jpeg",r.quality>0&&r.quality<=1?r.quality:.8).split(",")[1];n.resolve(b)},i.src=URL.createObjectURL(e),await n.promise}async#r(e){const r=[];if(e.files&&e.files.length!==0)for(let n=0;n<e.files.length;n++){const i=e.files.item(n),s=await as(i);r.push({name:i.name,type:i.type,size:i.size,encoding:Nt.BASE64,data:s})}if(e.file){const n=await as(e.file);r.push({name:e.file.name,type:e.file.type,size:e.file.size,encoding:Nt.BASE64,data:n})}return r}async#n(e){const r=[];if(e.files&&e.files.length!==0)for(let n=0;n<e.files.length;n++){const i=e.files.item(n),s=await this.#t(i,e.imageBlobOptions);r.push({name:i.name,type:i.type,size:i.size,encoding:Nt.BASE64,data:s})}if(e.file){const n=await this.#t(e.file,e.imageBlobOptions);r.push({name:e.file.name,type:e.file.type,size:e.file.size,encoding:Nt.BASE64,data:n})}return r}async#i(e){let r=[];e.imageBlobOptions?r=await this.#n(e):r=await this.#r(e);const n=Zr(r);return await this.buildApiRequest("/share",{search:{title:e?.title,text:e?.text,url:e?.url},headers:{"Content-Type":"application/cbor","Content-Length":n.length.toString()},method:"POST",body:n}).fetch().object()}async share(e){return e.file&&e.file.type.startsWith("image/")||e.files&&e.files[0].type.startsWith("image/")?await this.#i(e):await this.#e(e)}}Do([p,yr("design:type",Function),yr("design:paramtypes",[]),yr("design:returntype",Promise)],Ps.prototype,"canShare",null);Do([p,yr("design:type",Function),yr("design:paramtypes",[Object]),yr("design:returntype",Promise)],Ps.prototype,"share",null);const xi=new Ps;var Mo=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Hn=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Hr extends HTMLElement{static tagName="dweb-share";plugin=xi;get canShare(){return xi.canShare}get share(){return xi.share}}Mo([m(),Hn("design:type",Object),Hn("design:paramtypes",[])],Hr.prototype,"canShare",null);Mo([m(),Hn("design:type",Object),Hn("design:paramtypes",[])],Hr.prototype,"share",null);customElements.get(Hr.tagName)||customElements.define(Hr.tagName,Hr);var Jl=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Ti=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class ko extends ${constructor(){super("shortcut.sys.dweb")}registry(e){const r=Zr({title:e.title,data:e.data,icon:e.icon});return this.fetchApi("/registry",{method:"POST",body:r,headers:{"Content-Type":"application/cbor","Content-Length":r.length.toString()}}).boolean()}}Jl([p,Ti("design:type",Function),Ti("design:paramtypes",[Object]),Ti("design:returntype",void 0)],ko.prototype,"registry",null);const Gl=new ko;var Ql=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ya=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class In extends HTMLElement{static tagName="dweb-shortcut";plugin=Gl;get registry(){return this.plugin.registry}}Ql([m(),ya("design:type",Object),ya("design:paramtypes",[])],In.prototype,"registry",null);customElements.get(In.tagName)||customElements.define(In.tagName,In);var Uo=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},gr=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class js extends ${constructor(){super("splash-screen.nativeui.browser.dweb")}async show(e){return await this.fetchApi("/show",{search:{autoHide:e?.autoHide,showDuration:e?.showDuration,fadeOutDuration:e?.fadeOutDuration,fadeInDuration:e?.fadeInDuration}}).boolean()}async hide(e){return await this.fetchApi("/hide",{search:{fadeOutDuration:e?.fadeOutDuration}}).boolean()}}Uo([p,gr("design:type",Function),gr("design:paramtypes",[Object]),gr("design:returntype",Promise)],js.prototype,"show",null);Uo([p,gr("design:type",Function),gr("design:paramtypes",[Object]),gr("design:returntype",Promise)],js.prototype,"hide",null);const Fi=new js;var qo=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Vn=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Vr extends HTMLElement{static tagName="dweb-splash-screen";plugin=Fi;get show(){return Fi.show}get hide(){return Fi.hide}}qo([m(),Vn("design:type",Object),Vn("design:paramtypes",[])],Vr.prototype,"show",null);qo([m(),Vn("design:type",Object),Vn("design:paramtypes",[])],Vr.prototype,"hide",null);customElements.get(Vr.tagName)||customElements.define(Vr.tagName,Vr);var Xl=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},Ni=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class Wo extends ${constructor(){super("toast.sys.dweb")}async show(e){const{text:r,duration:n="long",position:i="bottom"}=e;await this.fetchApi("/show",{search:{message:r,duration:n,position:i}})}}Xl([p,Ni("design:type",Function),Ni("design:paramtypes",[Object]),Ni("design:returntype",Promise)],Wo.prototype,"show",null);const ga=new Wo;var Zl=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},ma=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class xn extends HTMLElement{static tagName="dweb-toast";plugin=ga;get show(){return ga.show}}Zl([m(),ma("design:type",Object),ma("design:paramtypes",[])],xn.prototype,"show",null);customElements.get(xn.tagName)||customElements.define(xn.tagName,xn);var Pt=function(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var o=t.length-1;o>=0;o--)(a=t[o])&&(s=(i<3?a(s):i>3?a(e,r,s):a(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s},oe=function(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)};class $e extends Lo{static tagName="dweb-window";plugin=Ae;constructor(){super(Ae.state)}getState=Ae.getState;setStyle=Ae.setStyle;get getDisplay(){return this.plugin.getDisplay}get focusWindow(){return this.plugin.focusWindow}get blurWindow(){return this.plugin.blurWindow}get maximize(){return this.plugin.maximize}get unMaximize(){return this.plugin.unMaximize}get setBounds(){return this.plugin.setBounds}get visible(){return this.plugin.visible}get close(){return this.plugin.close}}Pt([m(),oe("design:type",Object),oe("design:paramtypes",[])],$e.prototype,"getDisplay",null);Pt([m(),oe("design:type",Object),oe("design:paramtypes",[])],$e.prototype,"focusWindow",null);Pt([m(),oe("design:type",Object),oe("design:paramtypes",[])],$e.prototype,"blurWindow",null);Pt([m(),oe("design:type",Object),oe("design:paramtypes",[])],$e.prototype,"maximize",null);Pt([m(),oe("design:type",Object),oe("design:paramtypes",[])],$e.prototype,"unMaximize",null);Pt([m(),oe("design:type",Object),oe("design:paramtypes",[])],$e.prototype,"setBounds",null);Pt([m(),oe("design:type",Object),oe("design:paramtypes",[])],$e.prototype,"visible",null);Pt([m(),oe("design:type",Object),oe("design:paramtypes",[])],$e.prototype,"close",null);customElements.get($e.tagName)||customElements.define($e.tagName,$e);export{ia as $GeolocationCode,Tt as BarcodeScannerPermission,ys as BarcodeScannerPlugin,$ as BasePlugin,ra as BioetricsCheckResult,ms as BiometricsPlugin,ta as BiometricsTypes,ns as CameraDirection,bs as ClipboardPlugin,ws as ConfigPlugin,Oo as DevicePlugin,Pr as DwebServiceWorkerPlugin,xl as GeolocationController,Ro as GeolocationPlugin,_i as HTMLDeviceElement,pt as HTMLDwebBarcodeScanningElement,Mr as HTMLDwebBiometricsElement,kr as HTMLDwebClipboardElement,Ur as HTMLDwebConfigElement,Ce as HTMLDwebHapticsElement,ht as HTMLDwebKeychainElement,Rn as HTMLDwebMediaElement,oa as HTMLDwebMotionSensorsElement,xe as HTMLDwebNavigationBarElement,Wr as HTMLDwebNetworkElement,En as HTMLDwebSafeAreaElement,Hr as HTMLDwebShareElement,In as HTMLDwebShortcutElement,Vr as HTMLDwebSplashScreenElement,ye as HTMLDwebStatusBarElement,xn as HTMLDwebToastElement,qr as HTMLDwebTorchElement,Lt as HTMLDwebVirtualKeyboardElement,$e as HTMLDwebWindowElement,On as HTMLGeolocationElement,au as HapticsImpactStyle,su as HapticsNotificationType,Te as HapticsPlugin,is as ImpactStyle,jr as KeyChainPlugin,Eo as MediaPlugin,vs as MotionSensorsPlugin,Ie as NAVIGATION_BAR_STYLE,Fe as NavigationBarPlugin,ca as NavigationBarPluginEvents,Ss as NetworkPlugin,ss as NotificationType,Ie as STATUS_BAR_STYLE,Fo as SafeAreaPlugin,Pl as ServiceWorkerFetchEvent,Ps as SharePlugin,ko as ShortcutPlugin,js as SplashScreenPlugin,me as StatusBarPlugin,Dn as SupportedFormat,Wo as ToastPlugin,_s as TorchPlugin,mo as WebSocketIpcBuilder,fe as WindowPlugin,ml as barcodeScannerPlugin,bl as biometricsPlugin,wl as clipboardPlugin,vl as configPlugin,Sl as devicePlugin,iu as dwebServiceWorker,jl as dwebServiceWorkerPlugin,ar as eventHandle,Tl as geolocationPlugin,Nl as hapticsPlugin,Bl as keychainPlugin,Ll as mediaPlugin,ji as motionSensorsPlugin,qe as navigationBarPlugin,zl as networkPlugin,ua as safeAreaPlugin,xi as sharePlugin,Gl as shortcutPlugin,Fi as splashScreenPlugin,je as statusBarPlugin,ga as toastPlugin,Ei as torchPlugin,Gt as virtualKeyboardPlugin,gl as webIpcPool,Ae as windowPlugin};
