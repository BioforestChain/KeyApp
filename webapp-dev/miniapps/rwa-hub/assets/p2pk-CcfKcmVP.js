import{b as y}from"./networks-ZN7vFv_C.js";import{a as p,i as o,d as a,c as s}from"./script-DpwGRPf-.js";import{p as u,v as m}from"./address-Cne5lK_s.js";import{t as e}from"./typeforce-BBtR0LCj.js";import{OPS as b}from"./ops-CO93g0rg.js";const f=b;function O(t,i){if(!t.input&&!t.output&&!t.pubkey&&!t.input&&!t.signature)throw new TypeError("Not enough data");i=Object.assign({validate:!0},i||{}),e({network:e.maybe(e.Object),output:e.maybe(e.Buffer),pubkey:e.maybe(o),signature:e.maybe(p),input:e.maybe(e.Buffer)},t);const n=m(()=>a(t.input)),r={name:"p2pk",network:t.network||y};if(u(r,"output",()=>{if(t.pubkey)return s([t.pubkey,f.OP_CHECKSIG])}),u(r,"pubkey",()=>{if(t.output)return t.output.slice(1,-1)}),u(r,"signature",()=>{if(t.input)return n()[0]}),u(r,"input",()=>{if(t.signature)return s([t.signature])}),u(r,"witness",()=>{if(r.input)return[]}),i.validate){if(t.output){if(t.output[t.output.length-1]!==f.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!o(r.pubkey))throw new TypeError("Output pubkey is invalid");if(t.pubkey&&!t.pubkey.equals(r.pubkey))throw new TypeError("Pubkey mismatch")}if(t.signature&&t.input&&!t.input.equals(r.input))throw new TypeError("Signature mismatch");if(t.input){if(n().length!==1)throw new TypeError("Input is invalid");if(!p(r.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(r,t)}export{O as p};
