import{r as v,g as z,u as U,h as q,f as n,c as B,a as M,i as Q,R as w,k as C,j as t,b as P}from"./index-15D1tlVU.js";import{u as $,d as G,P as J,g as K}from"./page-BL_iZuG4.js";import{T as V,N as W,a as X}from"./navbar-DAOi6kaL.js";import{B as g}from"./dialog-DgNFENJS.js";import"./pull-to-refresh-BMqB5p-4.js";import{S as Y,a as Z}from"./subnavbar-Mkpp6rKn.js";import{g as tt,a as et}from"./icon.component-DqZ9lCdm.js";import{L as st}from"./loading-page-data-CCKDne7Y.js";import{N as at}from"./no-data-CDzRffdr.js";import{z as rt}from"./organization-profile.model-CAD2aKmP.js";import{f as I,a as L}from"./asset-type-balance-BGw1Ilcq.js";import{f as T}from"./date-time-format-CBKMROy6.js";import{u as ot}from"./use_easy_state-D4HEqK2h.js";import{u as nt}from"./use_page_query_state-DR-eHdQu.js";import{u as it}from"./use_refresh-BOPBhM6q.js";import{i as lt}from"./dex-api-54xdAOHY.js";function S(){return S=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},S.apply(this,arguments)}const ct=v.forwardRef((e,a)=>{const{className:i,id:r,style:m,tabbar:o,icons:f,scrollable:b,hidden:l,outline:y=!0,position:s,topMd:x,topIos:h,top:p,bottomMd:j,bottomIos:_,bottom:F,inner:H=!0}=e,D=z(e),c=v.useRef(null),E=u=>{c.current===u&&C(e,"toolbarHide")},R=u=>{c.current===u&&C(e,"toolbarShow")},k=u=>{n&&n.toolbar.hide(c.current,u)},A=u=>{n&&n.toolbar.show(c.current,u)};v.useImperativeHandle(a,()=>({el:c.current,hide:k,show:A})),U(()=>(q(()=>{o&&n&&c.current&&n.toolbar.setHighlight(c.current),n.on("toolbarShow",R),n.on("toolbarHide",E)}),()=>{n&&(n.off("toolbarShow",R),n.off("toolbarHide",E))}));const d=$(),O=B(i,"toolbar",{tabbar:o,"toolbar-bottom":d&&d.md&&j||d&&d.ios&&_||F||s==="bottom","toolbar-top":d&&d.md&&x||d&&d.ios&&h||p||s==="top","tabbar-icons":f,"tabbar-scrollable":b,"toolbar-hidden":l,"no-outline":!y},M(e)),N=Q(e);return w.createElement("div",S({id:r,style:m,className:O,ref:c},D),w.createElement(V.Provider,{value:{tabbarHasIcons:f}},N["before-inner"],H?w.createElement("div",{className:"toolbar-inner"},N.default):N.default,N["after-inner"]))});ct.displayName="f7-toolbar";const Et=G(e=>{const a=ot("all"),i=v.useRef({el:null}),r=it(),m=K(),o=async s=>{a.value!==s&&(i.current.el&&i.current.el.scrollTo({left:0,top:0,behavior:"smooth"}),a.value=s,await b[s].loadFirst(),r())},f=s=>nt([],1,async(x,h)=>{const p=await m.trpcClient.exchange.getPublishedExchangeList.query({page:h,pageSize:20,status:s});console.log(p,s),x.push(...p.data.map(_=>({..._,showMoreInfo:!1})));const j=x;return{content:j,nextPage:h+1,end:j.length>=p.total}}),b={all:f(),progress:f("in_progress"),announcement:f("not_started"),ended:f("ended")},l=b[a.value];v.useEffect(()=>{l.loadFirst();const s=lt(()=>{l.loadFirst()});return()=>{s()}},[]);const y=async s=>{await b[a.value].loadFirst(),l.onPtrRefresh(s)};return t.jsxs(J,{name:"discover",style:{"--f7-page-toolbar-bottom-offset":"0"},ref:i,...l.f7PagePtrProps,onPtrRefresh:y,...l.f7PageInfiniteProps,children:[t.jsxs(W,{title:"兑换",className:"text-white !filter-none",style:{"--f7-bars-bg-color-rgb":"100,15,243","--f7-bars-border-color":"transparent"},children:[t.jsx(X,{children:t.jsx(g,{type:"button",className:"bg-white !text-primary",onClick:()=>{e.safeF7Navigater.exchangeList()},children:"记录"})}),t.jsx(Y,{className:"rounded-t-5 !bg-white",children:t.jsx("div",{className:"w-full",children:t.jsxs(Z,{strong:!0,style:{"--f7-segmented-strong-button-active-bg-color":P.active,"--f7-segmented-strong-button-text-color":P.subtext,"--f7-segmented-strong-button-active-text-color":P.white},className:"w-full flex-shrink-0",children:[t.jsx(g,{active:a.value==="all",onClick:()=>o("all"),children:"全部"}),t.jsx(g,{active:a.value==="progress",onClick:()=>o("progress"),children:"进行中"}),t.jsx(g,{active:a.value==="announcement",onClick:()=>o("announcement"),children:"公示中"}),t.jsx(g,{active:a.value==="ended",onClick:()=>o("ended"),children:"已结束"})]})})})]}),t.jsx("div",{className:"min-h-full bg-white p-4 pb-[5rem]",children:l.render({loading:()=>t.jsx(st,{}),listEmpty:()=>t.jsx(at,{}),listItem:(s,x,h)=>t.jsx("div",{className:"mb-3",onClick:()=>{e.safeF7Navigater.exchangeInfo({props:{id:s.id}})},children:t.jsx(dt,{exchange:s,...e})},s.id)})})]})}),dt=({exchange:e,safeF7Navigater:a,...i})=>{e.status;let r="";switch(e.status){case rt.enum.chain_error:r="上链失败";break}let m="bg-primary text-white";const o=Date.now();return e.start_at&&e.start_at<o&&e.end_at&&e.end_at<o&&(r="已结束",m="text-red border-red border-tiny border-solid"),e.start_at&&e.start_at>o&&(r="公示中",m="text-text border-text border-tiny border-solid"),e.start_at&&e.start_at<=o&&e.end_at&&e.end_at>o&&(r="进行中"),t.jsxs("div",{className:"card_bg bg-gray rounded-4 p-4",children:[t.jsxs("div",{className:"mb-4 flex items-center text-sm",children:[t.jsxs("div",{className:"relative",children:[t.jsx("img",{src:tt(e.exchange_info.asset_type,e.exchange_info.chainName),alt:"",className:"h-9 w-9"}),t.jsx("img",{src:et(e.exchange_info.chainName),alt:"",className:"absolute -bottom-1 -right-0.5 h-5 w-5"})]}),t.jsxs("div",{className:"ml-2",children:[t.jsx("div",{className:"text-base font-bold text-title",children:e.exchange_info.asset_type}),t.jsx("div",{className:"text-xs text-subtext",children:e.exchange_info.chainName})]}),t.jsx("div",{className:"ml-auto flex items-center justify-end",children:t.jsx("span",{className:`rounded-full px-4 py-1.5 ${m}`,children:r})})]}),t.jsxs("div",{className:"mb-2 flex items-center justify-between text-text",children:[t.jsx("div",{children:"兑换费用"}),t.jsxs("div",{className:"text-title",children:[I(L(e.exchange_info.price2U??"0",8,!1)),"USDT(",e.exchange_info.chainName,")"]})]}),t.jsxs("div",{className:"mb-2 flex items-center justify-between text-text",children:[t.jsx("div",{children:"兑换数量"}),t.jsxs("div",{className:"text-title",children:[I(L(e.exchange_info.amount,8,!1)),e.exchange_info.asset_type]})]}),t.jsxs("div",{className:"mb-2 flex items-center justify-between text-text",children:[t.jsx("div",{children:"兑换份数"}),t.jsxs("div",{className:"text-title",children:[e.use_quantity,t.jsxs("span",{className:"text-subtext",children:["/",e.total_quantity]})]})]}),t.jsxs("div",{className:"mb-2 flex items-center justify-between text-text",children:[t.jsx("div",{children:"开始时间"}),t.jsx("div",{className:"text-title",children:T(e.start_at)})]}),t.jsxs("div",{className:"mb-2 flex items-center justify-between text-text",children:[t.jsx("div",{children:"结束时间"}),t.jsx("div",{className:"text-title",children:T(e.end_at)})]})]})};export{Et as D,dt as E,ct as T};
