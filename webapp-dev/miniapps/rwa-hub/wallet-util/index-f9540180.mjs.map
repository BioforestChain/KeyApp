{"version":3,"file":"index-f9540180.mjs","sources":["../../dist/lib/bitcoin-lib/payments/embed.mjs"],"sourcesContent":["import { bitcoin as BITCOIN_NETWORK } from '../networks.mjs';\nimport * as bscript from '../script.mjs';\nimport { typeforce as typef } from '../types.mjs';\nimport * as lazy from './lazy.mjs';\nconst OPS = bscript.OPS;\nfunction stacksEqual(a, b) {\n    if (a.length !== b.length)\n        return false;\n    return a.every((x, i) => {\n        return x.equals(b[i]);\n    });\n}\n// output: OP_RETURN ...\nexport function p2data(a, opts) {\n    if (!a.data && !a.output)\n        throw new TypeError('Not enough data');\n    opts = Object.assign({ validate: true }, opts || {});\n    typef({\n        network: typef.maybe(typef.Object),\n        output: typef.maybe(typef.Buffer),\n        data: typef.maybe(typef.arrayOf(typef.Buffer)),\n    }, a);\n    const network = a.network || BITCOIN_NETWORK;\n    const o = { name: 'embed', network };\n    lazy.prop(o, 'output', () => {\n        if (!a.data)\n            return;\n        return bscript.compile([OPS.OP_RETURN].concat(a.data));\n    });\n    lazy.prop(o, 'data', () => {\n        if (!a.output)\n            return;\n        return bscript.decompile(a.output).slice(1);\n    });\n    // extended validation\n    if (opts.validate) {\n        if (a.output) {\n            const chunks = bscript.decompile(a.output);\n            if (chunks[0] !== OPS.OP_RETURN)\n                throw new TypeError('Output is invalid');\n            if (!chunks.slice(1).every(typef.Buffer))\n                throw new TypeError('Output is invalid');\n            if (a.data && !stacksEqual(a.data, o.data))\n                throw new TypeError('Data mismatch');\n        }\n    }\n    return Object.assign(o, a);\n}\n//# sourceMappingURL=embed.mjs.map"],"names":["bscript.OPS","typef","BITCOIN_NETWORK","lazy.prop","bscript.compile","bscript.decompile"],"mappings":";;;;;;;;;;;;;;;AAIA,MAAM,GAAG,GAAGA,KAAW,CAAA;AACvB,SAAS,WAAW,CAAC,CAAC,EAAE,CAAC,EAAE;AAC3B,IAAI,IAAI,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,MAAM;AAC7B,QAAQ,OAAO,KAAK,CAAA;AACpB,IAAI,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK;AAC7B,QAAQ,OAAO,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;AAC7B,KAAK,CAAC,CAAA;AACN,CAAA;AACA;AACO,SAAS,MAAM,CAAC,CAAC,EAAE,IAAI,EAAE;AAChC,IAAI,IAAI,CAAC,CAAC,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,MAAM;AAC5B,QAAQ,MAAM,IAAI,SAAS,CAAC,iBAAiB,CAAC,CAAA;AAC9C,IAAI,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE,EAAE,IAAI,IAAI,EAAE,CAAC,CAAA;AACxD,IAAIC,SAAK,CAAC;AACV,QAAQ,OAAO,EAAEA,SAAK,CAAC,KAAK,CAACA,SAAK,CAAC,MAAM,CAAC;AAC1C,QAAQ,MAAM,EAAEA,SAAK,CAAC,KAAK,CAACA,SAAK,CAAC,MAAM,CAAC;AACzC,QAAQ,IAAI,EAAEA,SAAK,CAAC,KAAK,CAACA,SAAK,CAAC,OAAO,CAACA,SAAK,CAAC,MAAM,CAAC,CAAC;AACtD,KAAK,EAAE,CAAC,CAAC,CAAA;AACT,IAAI,MAAM,OAAO,GAAG,CAAC,CAAC,OAAO,IAAIC,OAAe,CAAA;AAChD,IAAI,MAAM,CAAC,GAAG,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,CAAA;AACxC,IAAIC,IAAS,CAAC,CAAC,EAAE,QAAQ,EAAE,MAAM;AACjC,QAAQ,IAAI,CAAC,CAAC,CAAC,IAAI;AACnB,YAAY,OAAM;AAClB,QAAQ,OAAOC,OAAe,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAA;AAC9D,KAAK,CAAC,CAAA;AACN,IAAID,IAAS,CAAC,CAAC,EAAE,MAAM,EAAE,MAAM;AAC/B,QAAQ,IAAI,CAAC,CAAC,CAAC,MAAM;AACrB,YAAY,OAAM;AAClB,QAAQ,OAAOE,SAAiB,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;AACnD,KAAK,CAAC,CAAA;AACN;AACA,IAAI,IAAI,IAAI,CAAC,QAAQ,EAAE;AACvB,QAAQ,IAAI,CAAC,CAAC,MAAM,EAAE;AACtB,YAAY,MAAM,MAAM,GAAGA,SAAiB,CAAC,CAAC,CAAC,MAAM,CAAC,CAAA;AACtD,YAAY,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,SAAS;AAC3C,gBAAgB,MAAM,IAAI,SAAS,CAAC,mBAAmB,CAAC,CAAA;AACxD,YAAY,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAACJ,SAAK,CAAC,MAAM,CAAC;AACpD,gBAAgB,MAAM,IAAI,SAAS,CAAC,mBAAmB,CAAC,CAAA;AACxD,YAAY,IAAI,CAAC,CAAC,IAAI,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC;AACtD,gBAAgB,MAAM,IAAI,SAAS,CAAC,eAAe,CAAC,CAAA;AACpD,SAAQ;AACR,KAAI;AACJ,IAAI,OAAO,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;AAC9B;;;;"}