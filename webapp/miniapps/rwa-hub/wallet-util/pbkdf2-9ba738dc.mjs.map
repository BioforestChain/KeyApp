{"version":3,"file":"pbkdf2-9ba738dc.mjs","sources":["../../dist/lib/hash-wasm/pbkdf2.mjs"],"sourcesContent":["/* eslint-disable no-bitwise */\nimport { createHMACSync } from './hmac.mjs';\nimport { getDigestHex, getUInt8Buffer } from './util.mjs';\nfunction calculatePBKDF2(digest, salt, iterations, hashLength, outputType) {\n    const DK = new Uint8Array(hashLength);\n    const block1 = new Uint8Array(salt.length + 4);\n    const block1View = new DataView(block1.buffer);\n    const saltBuffer = getUInt8Buffer(salt);\n    const saltUIntBuffer = new Uint8Array(saltBuffer.buffer, saltBuffer.byteOffset, saltBuffer.length);\n    block1.set(saltUIntBuffer);\n    let destPos = 0;\n    const hLen = digest.digestSize;\n    const l = Math.ceil(hashLength / hLen);\n    let T;\n    let U;\n    for (let i = 1; i <= l; i++) {\n        block1View.setUint32(salt.length, i);\n        digest.init();\n        digest.update(block1);\n        T = digest.digest('binary');\n        U = T.slice();\n        for (let j = 1; j < iterations; j++) {\n            digest.init();\n            digest.update(U);\n            U = digest.digest('binary');\n            for (let k = 0; k < hLen; k++) {\n                T[k] ^= U[k];\n            }\n        }\n        DK.set(T.subarray(0, hashLength - destPos), destPos);\n        destPos += hLen;\n    }\n    if (outputType === 'hex') {\n        const digestChars = new Uint8Array(hashLength * 2);\n        return getDigestHex(digestChars, DK, hashLength);\n    }\n    return DK;\n}\nconst validateBaseOptions = (options) => {\n    if (!options || typeof options !== 'object') {\n        throw new Error('Invalid options parameter. It requires an object.');\n    }\n    if (!Number.isInteger(options.iterations) || options.iterations < 1) {\n        throw new Error('Iterations should be a positive number');\n    }\n    if (!Number.isInteger(options.hashLength) || options.hashLength < 1) {\n        throw new Error('Hash length should be a positive number');\n    }\n    if (options.outputType === undefined) {\n        options.outputType = 'binary';\n    }\n    if (!['hex', 'binary'].includes(options.outputType)) {\n        throw new Error(`Insupported output type ${options.outputType}. Valid values: ['hex', 'binary']`);\n    }\n};\n/**\n * Generates a new PBKDF2 hash for the supplied password\n */\nexport const pbkdf2 = async (options) => {\n    const hashFunction = await options.hashFunction;\n    if (!hashFunction) {\n        throw new Error('Invalid hash function is provided! Usage: pbkdf2(\"password\", \"salt\", 1000, 32, createSHA1()).');\n    }\n    return pbkdf2Sync({\n        ...options,\n        hashFunction,\n    });\n};\nexport const pbkdf2Sync = (options) => {\n    if (!options.hashFunction) {\n        throw new Error('Invalid hash function is provided! Usage: pbkdf2Sync(\"password\", \"salt\", 1000, 32, createSHA1Sync()).');\n    }\n    validateBaseOptions(options);\n    const hmac = createHMACSync(options.hashFunction, options.password);\n    return calculatePBKDF2(hmac, options.salt, options.iterations, options.hashLength, options.outputType);\n};\n//# sourceMappingURL=pbkdf2.mjs.map"],"names":[],"mappings":"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"}