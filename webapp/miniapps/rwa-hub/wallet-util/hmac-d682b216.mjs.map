{"version":3,"file":"hmac-d682b216.mjs","sources":["../../dist/lib/hash-wasm/hmac.mjs"],"sourcesContent":["/* eslint-disable no-bitwise */\nimport { getUInt8Buffer } from './util.mjs';\nfunction calculateKeyBuffer(hasher, key) {\n    const { blockSize } = hasher;\n    const buf = getUInt8Buffer(key);\n    if (buf.length > blockSize) {\n        hasher.update(buf);\n        const uintArr = hasher.digest('binary');\n        hasher.init();\n        return uintArr;\n    }\n    return new Uint8Array(buf.buffer, buf.byteOffset, buf.length);\n}\nfunction calculateHmac(hasher, key) {\n    hasher.init();\n    const { blockSize } = hasher;\n    const keyBuf = calculateKeyBuffer(hasher, key);\n    const keyBuffer = new Uint8Array(blockSize);\n    keyBuffer.set(keyBuf);\n    const opad = new Uint8Array(blockSize);\n    for (let i = 0; i < blockSize; i++) {\n        const v = keyBuffer[i];\n        opad[i] = v ^ 0x5c;\n        keyBuffer[i] = v ^ 0x36;\n    }\n    hasher.update(keyBuffer);\n    const obj = {\n        init: () => {\n            hasher.init();\n            hasher.update(keyBuffer);\n            return obj;\n        },\n        update: (data) => {\n            hasher.update(data);\n            return obj;\n        },\n        digest: (outputType) => {\n            const uintArr = hasher.digest('binary');\n            hasher.init();\n            hasher.update(opad);\n            hasher.update(uintArr);\n            return hasher.digest(outputType);\n        },\n        save: () => {\n            throw new Error('save() not supported');\n        },\n        load: () => {\n            throw new Error('load() not supported');\n        },\n        blockSize: hasher.blockSize,\n        digestSize: hasher.digestSize,\n    };\n    return obj;\n}\n/**\n * Calculates HMAC hash\n * @param hash Hash algorithm to use. It has to be the return value of a function like createSHA1()\n * @param key Key (string, Buffer or TypedArray)\n */\nexport function createHMAC(hash, key) {\n    if (!hash || !hash.then) {\n        throw new Error('Invalid hash function is provided! Usage: createHMAC(createMD5(), \"key\").');\n    }\n    return hash.then((hasher) => calculateHmac(hasher, key));\n}\nexport const createHMACSync = calculateHmac;\n//# sourceMappingURL=hmac.mjs.map"],"names":[],"mappings":"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"}