import{r as m,j as e,f as k}from"./index-AshhoVut.js";import{C as Z,A as G}from"./nilai-dialog-Dbtzo5f5.js";import{O as D,P as L,Q as J,R as W,S as K,U as tt,V as et,W as st,X as rt,M as it,Y as nt,Z as at,_ as ot,a0 as lt}from"./messages-D1uWWbBR.js";import{u as ct}from"./use_flow-Buvyb0TW.js";import{B as y}from"./dialog-w37VgwE_.js";import{L as ut}from"./input-BIdqiBhy.js";import{L as h}from"./list-item-C_pVthwN.js";import{N as mt}from"./navbar-CWXVbsHK.js";import{d as dt,g as ht,P as gt}from"./page-BnBmgj2e.js";import{u as ft}from"./use_refresh-BXPRqJ_V.js";import{B as i}from"./big-Dt19vo1Q.js";import{L as xt}from"./list-DOTUY-rD.js";import{P as pt}from"./preloader-Cr80DtbA.js";import{t as g,k as wt,j as _t,b as jt}from"./dex-api-WCaY78Dk.js";import"./use_easy_state-BCfQ0rqw.js";import"./list-DTz1iW3n.js";const $t=dt(({chainName:x,assetType:a,external_user_id:P,exchangeId:$,exchangeInfo:R,decimals:r,amount:v,type:p,...I})=>{const w=R.airdrop_info.withdrawal_or_u_asset_type_list.find(t=>t.assetType===a),[E]=ct(jt),[q,M]=m.useState(!0),[T,O]=m.useState(!1),[Q,_]=m.useState(!1),[f,b]=m.useState(""),[o,V]=m.useState(""),[l,j]=m.useState(""),B=m.useRef({withdrawal_ratio:["10","100"],mini:.5,usdt2bfm:["10","1"]}),N=ht(),c=(t,s)=>{const n=new i(t);return S(n.div(Math.pow(10,s)).toFixed(18),s)};function S(t,s=8,n=!1){const[u,d=""]=String(t).split("."),A=d.slice(0,s),C=A.length>0?`${u}.${A}`:u;return n?C:C.replace(/(?:\.0*|(\.\d+?)0+)$/,"$1")}const U=()=>{const t=i(o).mul(10**r).toString().split(".")[0];if(!l)return"0";const s=BigInt(t)-BigInt(l);if(s<=BigInt(0))return"0";const n=String(s);return String(i(n).div(w.price2U).mul(1e8).round(0,i.roundDown))};m.useEffect(()=>{N.trpcClient.exchange.getExchangeWithdrawalConfig.query().then(t=>{if(M(!1),B.current=t,a==="BFM"){const s=String(i(t.mini).div(t.usdt2bfm[0]).mul(t.usdt2bfm[1]).mul(10**r).round(0,i.roundUp)).split(".")[0];b(c(s,r))}else{const s=String(i(t.mini).mul(10**r).div(w.price2U).mul(1e8).round(0,i.roundUp)).split(".")[0];b(c(s,r))}}).catch(t=>{throw g(String(t?.message||t)),t})},[]);const z=t=>{const s=B.current;if(!t||isNaN(+t))j("");else{t=i(t).mul(10**r).toString().split(".")[0];const n=BigInt(t)*BigInt(s.withdrawal_ratio[0])/BigInt(s.withdrawal_ratio[1]);let u="0";if(a==="BFM"){const d=BigInt(String(i(s.mini).div(s.usdt2bfm[0]).mul(s.usdt2bfm[1]).mul(10**r).round(0,i.roundUp)).split(".")[0]);u=d>n?d.toString():n.toString(),j(u)}else{const d=BigInt(String(i(s.mini).mul(10**r).div(w.price2U).mul(1e8).round(0,i.roundUp)).split(".")[0]);u=d>n?d.toString():n.toString(),j(u)}}},H=async()=>{k.preloader.show();try{await N.trpcClient.exchange.withdrawal.mutate({chain:x,assetType:a,amount:i(o).mul(10**r).toString().split(".")[0],exchangeUSDT:p=="exchange",external_user_id:P,exchangeId:$}),_(!1),wt.emit({success:!0}),g(lt()),_t.emit({success:!0}),I.safeF7Navigater.exchangeWithdrawalList({reloadCurrent:!0})}catch(t){throw g(String(t)),t}finally{k.preloader.hide()}},X=ft(),F=t=>{let s=t?S(t,r,!0):"";if(s){const n=c(v,r);i(n).lt(s)&&(s=n),s=S(s,8,!0)}z(s),V(s),X()},Y=t=>{const s=(t.target?.value||"").trim();F(s)};return e.jsxs(gt,{name:"withdrawal",style:{"--f7-toolbar-bottom-height":"3.25rem"},children:[e.jsx(mt,{title:D(),backLink:!0}),e.jsx("div",{className:"bg-gray min-h-full w-full pt-5",children:q?e.jsx(pt,{size:32,className:"mx-auto mt-0 !block",color:"black"}):e.jsxs(e.Fragment,{children:[e.jsxs(xt,{strongIos:!0,dividersIos:!0,insetIos:!0,className:"mt-0",children:[e.jsxs(ut,{type:"number",value:o,placeholder:L(),onChange:Y,children:[e.jsxs("div",{slot:"label",className:"text-text",children:[J(),f&&e.jsxs(e.Fragment,{children:["(",W({amount:f,assetType:a}),")"]})]}),e.jsx(y,{slot:"input",className:"text-gradient absolute right-0 top-1",onClick:()=>F(c(v,r)),children:K()})]}),e.jsxs(h,{children:[e.jsx("div",{slot:"header",className:"text-text",children:tt()}),e.jsxs("div",{slot:"title",children:[l?c(l,r):"--"," ",e.jsx("span",{className:"text-sm",children:a})]})]}),p=="exchange"&&e.jsxs(h,{children:[e.jsx("div",{slot:"header",className:"text-text",children:"兑换成USDT"}),e.jsxs("div",{slot:"title",children:[l?c(U(),r):"--"," ",e.jsx("span",{className:"text-sm",children:"USDT"})]})]}),e.jsx(h,{title:x,children:e.jsx("div",{slot:"header",className:"text-text",children:et()})}),e.jsx(h,{title:a,children:e.jsx("div",{slot:"header",className:"text-text",children:st()})}),e.jsxs(h,{children:[e.jsx("div",{slot:"header",className:"text-text",children:rt()}),e.jsx("div",{slot:"title",className:"text-wrap break-all",children:E.addressList.find(t=>t.chainName===x)?.address})]})]}),e.jsx(y,{className:"mx-5 bg-primary py-5 text-lg !text-white",onClick:()=>{if(!o||isNaN(+o)){g(L());return}if(+o<=+f){g(W({amount:f,assetType:a}));return}_(!0)},children:D()})]})}),e.jsx(Z,{open:Q,title:nt(),confirmText:it(),onRequireClose:()=>{_(!1)},onConfirmCallback:()=>H(),children:p=="exchange"?e.jsxs("div",{children:[l&&c(U(),r)," USDT"]}):e.jsxs("div",{children:[o&&l&&i(o).minus(c(l,r)).toString()," ",a]})}),e.jsx(G,{open:T,onRequireClose:()=>{O(!1),I.f7router.back()},title:ot(),children:at()})]})});export{$t as default};
