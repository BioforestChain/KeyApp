import{r as f,j as e}from"./index-CQoRotV0.js";import"./pull-to-refresh-Ds11js0j.js";import{N as b}from"./navbar-DIMKluRQ.js";import{d as v,g as j,P as w,e as y,z as m}from"./page-C3-Jo2og.js";import{A as N}from"./nilai-dialog-BtwcJOk2.js";import{a as _}from"./organization-profile.model-B6zWAUQQ.js";import{f as T,a as I}from"./asset-type-balance-BGw1Ilcq.js";import{u as c}from"./use_easy_state-9wGY1NnM.js";import{u as E}from"./use_flow-JGTGsfZ1.js";import{P}from"./preloader-D58IadfG.js";import{b as A}from"./dex-api-Cq_3td3P.js";import{UserExchangeItem as C}from"./exchange-list.page-D-kl9SBE.js";import{g as q}from"./setting.page-DZgwFYfY.js";import"./messages-BUgBjWr1.js";import"./dialog-Cf3dK15b.js";import"./big-Dt19vo1Q.js";import"./icon.component-D9ZYQvGY.js";import"./loading-page-data-BiZn-gxc.js";import"./no-data-BZNSMxiq.js";import"./date-time-format-CBKMROy6.js";import"./use_page_query_state-Ch0Feqt_.js";import"./use_refresh-BaoWdsKS.js";import"./nilai-dialog-B36LF-Pi.js";import"./list-item-CLfYZ1Rn.js";import"./list-CP82UPn7.js";import"./noop-ChEnm3CV.js";const ie=v(({id:g,...x})=>{const[U]=E(A),l=c(!1),n=c(null),p=j(),h=c([]),d=c([]);return f.useEffect(()=>{Promise.all([p.trpcClient.exchange.getUserExchangeDetail.query(g).then(t=>{n.value=t;const r=new Map;t.airInfo.withdrawal_only.forEach(s=>{let a=r.get(s.address);a||r.set(s.address,a=new Map([[s.assetType,{assetType:s.assetType,amount:s.amount}]]));const i=a.get(s.assetType);i?i.amount=String(BigInt(i.amount)+BigInt(s.amount)):a.set(s.assetType,{assetType:s.assetType,amount:s.amount})}),t.airInfo.withdrawal_and_u_list.forEach(s=>{s.forEach(a=>{let i=r.get(a.address);i||r.set(a.address,i=new Map([[a.assetType,{assetType:a.assetType,amount:a.amount}]]));const u=i.get(a.assetType);u?u.amount=String(BigInt(u.amount)+BigInt(a.amount)):i.set(a.assetType,{assetType:a.assetType,amount:a.amount})})}),h.value=[...r.entries()],t.exchangeInfo.airdrop_info.withdrawal_or_u_asset_type_list?.some(s=>s.type===_.enum.public_queue)&&p.trpcClient.exchange.getUserPublicQueueRecords.query({exchangeId:t.exchangeId}).then(s=>{d.value=s.data}).catch(()=>{})})]).catch(t=>{l.value=!0})},[]),e.jsxs(w,{name:"exchange-detail",pageContent:!1,children:[e.jsx(b,{backLink:!0,color:"white",title:"详情",className:"text-white !filter-none",style:{"--f7-bars-bg-color-rgb":"100,15,243","--f7-bars-border-color":"transparent"}}),e.jsx(y,{style:{"--f7-toolbar-height":"72px"},children:e.jsx("div",{className:"min-h-full rounded-t-4 bg-white p-4 pb-[4.5rem]",children:n.value?e.jsxs("div",{className:"pt-6",children:[e.jsx("img",{src:`./images/exchange_${n.value.status}.webp`,className:"mx-auto mb-3",alt:""}),e.jsx("div",{className:"mb-6 text-center text-lg font-bold",children:m(n.value.status).with("fail",()=>"失败").with("success",()=>e.jsxs("div",{children:["已完成",e.jsx("div",{className:"text-xs text-subtext",children:"兑换数量已发放到用户链上地址"})]})).with("untreated",()=>"确认中").otherwise(()=>e.jsx(e.Fragment,{}))}),e.jsx("div",{className:"mb-6",children:e.jsx(C,{userExchange:n.value,hideTips:!0,...x})}),n.value.status==="success"&&e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-xs text-red",children:"*兑换成功后的空投奖励，需到“乐园” - “领取收益”进行提取"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"mb-1 text-base font-bold text-title",children:"空投奖励详情"}),h.value.map((t,r)=>e.jsxs("div",{className:"mb-2 border-b-tiny border-solid border-title/20 pb-1",children:[e.jsx("div",{className:"text-text",children:`${t[0].slice(0,8)}...${t[0].slice(-8)}`}),e.jsx("div",{className:"text-right",children:[...t[1].values()].map(o=>e.jsxs("div",{className:"text-text",children:[e.jsxs("span",{className:"text-green-500",children:["+",T(I(o.amount,8,q()))]}),o.assetType]},o.assetType))})]},r))]}),d.value.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"mb-1 text-base font-bold text-title",children:"公排队列记录"}),d.value.map((t,r)=>e.jsxs("div",{className:"mb-2 border-b-tiny border-solid border-title/20 pb-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-text",children:["排队序号: ",t.in_numero]}),e.jsx("div",{className:m(t.reward_status).with("queued",()=>"text-orange-500").with("triggered",()=>"text-blue-500").with("distributed",()=>"text-green-500").exhaustive(),children:m(t.reward_status).with("queued",()=>"排队中").with("triggered",()=>"已触发").with("distributed",()=>"已发放").exhaustive()})]}),t.reward_status!=="queued"&&t.reward_triggered_at&&e.jsxs("div",{className:"text-right text-xs text-text",children:["触发时间: ",new Date(t.reward_triggered_at).toLocaleString()]})]},r))]})]})]}):e.jsx("div",{className:"mt-4 flex w-full items-center justify-center",children:e.jsx(P,{size:32,color:"black",bgColor:"transparent"})})})}),e.jsx("div",{children:e.jsx(N,{open:l.value,title:"警告",confirmText:"确认",onRequireClose:()=>{l.value=!1},onConfirmCallback:()=>{x.f7router.back(),l.value=!1},children:"获取兑换信息错误"})})]})});export{ie as default};
