import{r as g,j as e,f as L}from"./index-AshhoVut.js";import{N as k,g as U,a as _}from"./icon.component-Bbnu8uvo.js";import{A as F}from"./nilai-dialog-Dbtzo5f5.js";import{z as n,k as R,d as f,b as X}from"./dex-api-WCaY78Dk.js";import{a5 as q,O as P,a6 as O,a7 as W}from"./messages-D1uWWbBR.js";import{u as z}from"./use_easy_state-BCfQ0rqw.js";import{u as $}from"./use_flow-Buvyb0TW.js";import{L as H}from"./list-item-C_pVthwN.js";import{N as Q,a as K}from"./navbar-CWXVbsHK.js";import{d as G,P as J,K as E}from"./page-BnBmgj2e.js";import{B as V}from"./big-Dt19vo1Q.js";import{L as Y}from"./list-DOTUY-rD.js";import{c as Z}from"./dex-paradise.page-711HsBZy.js";import"./dialog-w37VgwE_.js";import"./list-DTz1iW3n.js";import"./use_refresh-BXPRqJ_V.js";import"./clipboard-CegwBCT4.js";import"./pull-to-refresh-BEcMoqjd.js";import"./loading-page-data-6-Awkqnm.js";import"./preloader-Cr80DtbA.js";import"./no-data-C6uCQg27.js";import"./setting.page-Cw2AtfIG.js";import"./noop-ChEnm3CV.js";const ye=G(C=>{const u=z(!1),x=z(!1),[h]=$(X),[p,M]=g.useState(!0),A=[{assetType:"BFM",chainName:n.enum.BFMeta,withdrawalAmount:"0",freezeAmount:"0",decimals:8,contractAddress:"",address:h.address},{assetType:"DEXT",chainName:n.enum.BFMeta,withdrawalAmount:"0",freezeAmount:"0",decimals:8,contractAddress:"",address:h.address},{assetType:"USDT",chainName:n.enum.BFMeta,withdrawalAmount:"0",freezeAmount:"0",decimals:8,contractAddress:"",address:h.address}];h.addressList.forEach(s=>{(s.chainName===n.enum.Tron||s.chainName===n.enum.Ethereum||s.chainName===n.enum.Binance)&&A.push({assetType:"USDT",chainName:s.chainName,withdrawalAmount:"0",freezeAmount:"0",decimals:s.chainName===n.enum.Binance?18:6,contractAddress:Z[s.chainName],address:s.address})});const j=g.useRef(A),y=(s,a)=>localStorage.getItem("hidden_user_asset")?"********":new V(s).div(Math.pow(10,a)).toFixed(18);function B(s,a=8){const[l,c=""]=String(s).split("."),o=c.slice(0,a);return(o.length>0?`${l}.${o}`:l).replace(/(?:\.0*|(\.\d+?)0+)$/,"$1")}const b=async()=>{const s=j.current;try{const a=await f.user.getUserAssetInfo.query();if(a){const c=(await f.admin.getWithdrawalConfig.query()).withdrawalLimit[h.level];if(!c)throw new Error("找不到指定提现信息");const o=await f.user.getAirdropRecord.query(),w=await f.user.getUserAirdropFreezeAssetTypeAmount.query(),N={DEXT:"0",BFM:"0"},v={DEXT:"0",BFM:"0"};if(w&&(v.BFM=w.BFM||"0",v.DEXT=w.DEXT||"0"),o&&o.airdrop?.BFMeta){const d=o.airdrop.BFMeta;let i=BigInt(0);Object.values(d.BFM||{}).forEach(r=>i=i+BigInt(r||"0")),N.BFM=String(i);let t=BigInt(0);Object.values(d.DEXT||{}).forEach(r=>t=t+BigInt(r||"0")),N.DEXT=String(t)}for(const d of Object.keys(a.assets)){const i=a.assets[d];if(i)for(const t of Object.keys(i)){const r=i[t];r&&s.find(m=>{if(m.chainName===d&&m.assetType===t)if(d==="BFMeta"&&(t==="BFM"||t==="DEXT")){const T=BigInt(N[t])-BigInt(v[t]),D=T*BigInt(c[0])/BigInt(c[1]),I=T-D,S=BigInt(r.totalWithdrawal)-BigInt(r.useWithdrawal)-BigInt(I);m.withdrawalAmount=String(S),m.freezeAmount=String(BigInt(r.freeze)+BigInt(I))}else m.withdrawalAmount=r.effectiveWithdrawal,m.freezeAmount=r.freeze})}}j.current=s}}finally{p&&M(!1)}};return g.useEffect(()=>{b()},[]),g.useEffect(()=>{const s=R(a=>{a.success&&b()});return()=>{s()}},[]),e.jsxs(J,{name:"withdrawal",style:{"--f7-toolbar-bottom-height":"3.25rem"},children:[e.jsx(Q,{title:q(),bgColor:"white",color:"black",backLink:!0,children:e.jsx(K,{children:e.jsx("div",{onClick:()=>{u.value=!0},children:e.jsx(k,{name:"common-help",className:"text-[28px] text-primary",style:{"--color-1":"#640ff3"}})})})}),e.jsx("div",{className:"min-h-full w-full bg-white pt-2",children:e.jsx(Y,{className:"mx-2.5 mt-0 rounded-3 bg-white p-2.5",children:j.current.map((s,a)=>e.jsx(H,{style:{"--f7-list-item-padding-horizontal":"0"},children:e.jsx("div",{className:"bg-gray w-full rounded-2 px-4 py-2",children:e.jsxs("div",{className:"w-full p-1",children:[e.jsxs("div",{className:"mb-2 flex items-center text-sm",children:[e.jsxs("div",{className:"relative mr-1",children:[e.jsx("img",{src:U(s.assetType,s.chainName),alt:"",className:"h-7 w-7"}),e.jsx("img",{src:_(s.chainName),alt:"",className:"absolute -bottom-0.5 -right-0.5 h-3.5 w-3.5"})]}),e.jsx("div",{children:s.assetType}),e.jsxs("div",{className:"text-xs text-text",children:["(",s.chainName,")"]}),!p&&e.jsx("div",{className:"ml-auto flex items-center justify-end text-sm",children:e.jsx("button",{className:"w-auto rounded-1 bg-primary px-2 py-1 text-white",onClick:async()=>{L.preloader.show();try{const{canUp:l}=await f.user.getUserLevelUpCondition.query();if(l){x.value=!0;return}}finally{L.preloader.hide()}C.safeF7Navigater.withdrawal({props:{chainName:s.chainName,assetType:s.assetType,decimals:s.decimals,amount:s.withdrawalAmount}})},children:P()})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("div",{className:"flex items-center text-sm text-text",children:O()}),e.jsx("div",{children:p?e.jsx(E,{size:16,color:"black"}):e.jsxs("div",{className:"my-1 flex items-center",children:[B(y(s.freezeAmount,s.decimals))," "]})})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("div",{className:"text-sm text-text",children:W()}),e.jsx("div",{children:p?e.jsx(E,{size:16,color:"black"}):e.jsx("div",{children:B(y(s.withdrawalAmount,s.decimals))})})]})]})]})})},a))})}),e.jsx(F,{open:u.value,title:"冻结说明",confirmText:"好的",maxHeight:"max-h-[80%]",onRequireClose:()=>{u.value=!1},onConfirmCallback:()=>{u.value=!1},children:e.jsxs("div",{className:"text-left text-sm",children:[e.jsxs("ul",{className:"mb-2 text-red",children:[e.jsx("li",{className:"mb-1",children:"*提现功能需用户等级至少为Lv.2"}),e.jsx("li",{className:"mb-1",children:"*用户当前满足晋级条件，需先完成晋级操作"})]}),e.jsxs("ol",{children:[e.jsx("li",{className:"mb-2",children:e.jsx("p",{children:"1.空投奖励以及用户晋级费用的一半，冻结5分钟后解冻"})}),e.jsx("li",{className:"mb-2",children:e.jsx("p",{children:"2.冻结额度 = 5分钟冻结额度 + 等级不可提取额度（等级不可提取额度不包含用户晋级费用）"})}),e.jsxs("li",{className:"mb-1",children:[e.jsx("p",{children:"3.不同的用户等级可提取额度如下："}),e.jsxs("ul",{children:[e.jsx("li",{className:"ml-5",children:"Lv.0：0%"}),e.jsx("li",{className:"ml-5",children:"Lv.1：60%"}),e.jsx("li",{className:"ml-5",children:"Lv.2：65%"}),e.jsx("li",{className:"ml-5",children:"Lv.3：70%"}),e.jsx("li",{className:"ml-5",children:"Lv.4：75%"}),e.jsx("li",{className:"ml-5",children:"Lv.5：80%"}),e.jsx("li",{className:"ml-5",children:"Lv.6：85%"}),e.jsx("li",{className:"ml-5",children:"Lv.7：90%"}),e.jsx("li",{className:"ml-5",children:"Lv.8：95%"}),e.jsx("li",{className:"ml-5",children:"Lv.9：100%"})]})]})]})]})}),e.jsx(F,{open:x.value,title:"注意",confirmText:"好的",onRequireClose:()=>{x.value=!1},onConfirmCallback:()=>{x.value=!1},children:"用户可当前晋级，请先晋级后，在来提取"})]})});export{ye as default};
