import{r as y,j as e,f as b}from"./index-AshhoVut.js";import{B}from"./dialog-w37VgwE_.js";import"./pull-to-refresh-BEcMoqjd.js";import{N as k}from"./navbar-CWXVbsHK.js";import{d as q,g as P,P as U,e as F}from"./page-BnBmgj2e.js";import{A as w,C as I}from"./nilai-dialog-Bpsg58kA.js";import{z as L,a as _}from"./organization-profile.model-DEuuhspX.js";import{$,g as M,a as R}from"./signature-MTDex1F4.js";import{d as z,f as O}from"./noop-ChEnm3CV.js";import{f as T,a as C}from"./asset-type-balance-BGw1Ilcq.js";import{u as p}from"./use_easy_state-BCfQ0rqw.js";import{u as Q}from"./use_flow-Buvyb0TW.js";import{E as W,T as H}from"./discover.page-3MPEOUat.js";import{u as G}from"./use_refresh-BXPRqJ_V.js";import{B as o}from"./big-Dt19vo1Q.js";import{P as V}from"./preloader-Cr80DtbA.js";import{t as d,b as Y}from"./dex-api-WCaY78Dk.js";import"./messages-D1uWWbBR.js";import"./bridge-DyWekW1m.js";import"./subnavbar-C_obbOeJ.js";import"./icon.component-Bbnu8uvo.js";import"./loading-page-data-6-Awkqnm.js";import"./no-data-C6uCQg27.js";import"./date-time-format-CBKMROy6.js";import"./use_page_query_state-Dd2x2gMX.js";const we=q(({id:a,...i})=>{const[m]=Q(Y),h=p(!1),x=p(!1),l=p(!1),t=p(null),c=G(),g=P(),f=p(""),u=p(0),E=()=>{if(!t.value)return;if(t.value.end_at&&t.value.end_at<Date.now()){d("兑换已结束"),c();return}if(t.value.total_quantity<=t.value.use_quantity){d("兑换已被抢光");return}const s=String(o(f.value||0).round(0,o.roundDown));if(+s<=0){l.value=!0;return}if(+s>+u.value){d(`单次兑换最多${u.value}份，请调低份数`);return}h.value=!0},S=async()=>{if(!t.value)return;if(t.value.end_at&&t.value.end_at<Date.now()){d("兑换已结束"),c();return}if(t.value.total_quantity<=t.value.use_quantity){d("兑换已被抢光");return}const s=String(o(f.value||0).round(0,o.roundDown));if(+s<=0){l.value=!0;return}if(+s>+u.value){d(`单次兑换最多${u.value}份，请调低份数`);return}try{b.preloader.show();const r=t.value.receive_pay_info[0],n=m.addressList.find(A=>A.chainName===r.chain_name)||{chainName:"BFMeta",address:m.address};if(!n){d("未找到授权地址，请重试"),console.warn(r,m.addressList);return}const v={type:$.transfer,chainName:r.chain_name,senderAddress:n.address,receiveAddress:r.address,assetType:"USDT",balance:String(BigInt(t.value.exchange_info.price2U??"0")*BigInt(s)),remark:{exchangeId:a,exchangeType:"userExchange"}},N=await(await M(z.BFMPay().mmid,R.signature,[v])).getData();if(O(),!N){b.preloader.hide(),d("授权失败");return}const D=await g.trpcClient.exchange.submitExchangeTrs.mutate({trs:N[0].transaction,exchangeId:a,quantity:+s});d("提交成功"),i.safeF7Navigater.exchangeDetail({reloadCurrent:!0,props:{id:D}})}catch(r){d(String(r)),b.preloader.hide()}finally{b.preloader.hide()}};y.useEffect(()=>{g.trpcClient.exchange.getPublishedExchangeInfo.query(a).then(s=>{t.value=s,u.value=s.max_exchange_quantity}).catch(s=>{x.value=!0})},[]);const j=p(0);return y.useEffect(()=>{if(!t.value)return;const s=t.value.start_at-Date.now();s>0&&setTimeout(()=>{j.value=s},1e3)},[j,t]),e.jsxs(U,{name:"exchange-info",pageContent:!1,children:[e.jsx(k,{backLink:!0,color:"white",title:"兑换",className:"text-white !filter-none",style:{"--f7-bars-bg-color-rgb":"100,15,243","--f7-bars-border-color":"transparent"}}),e.jsx(F,{style:{"--f7-toolbar-height":"72px"},children:e.jsx("div",{className:"min-h-full rounded-t-4 bg-white p-4 pb-[4.5rem]",children:t.value?e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx(W,{exchange:t.value,...i})}),e.jsxs("div",{className:"bg-gray mb-3 rounded-4 p-4 text-base text-title",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"font-bold",children:"要兑换的份数"}),e.jsx("div",{className:"text-text",children:e.jsx("input",{type:"number",className:"text-right text-title",placeholder:"请输入兑换份数",min:0,step:1,value:f.value,onChange:s=>{const r=s.target;let n=r.value;if(n=n.replace(/[^0-9]/g,""),n){let v=isNaN(+n)?0:+n;String(v).includes(".")&&(v=0),v<0&&(v=0),+n>+u.value&&(n=String(u.value)),f.value=n,r.value=n,c();return}f.value=n,r.value=n,c()}})})]}),e.jsxs("div",{className:"text-right text-xs text-red",children:["*单次兑换最大可兑换",u.value,"份"]})]}),!!t.value.receive_pay_info.length&&e.jsxs("div",{className:"mb-1 rounded-4 bg-white p-4",children:[e.jsx("div",{className:"mb-2 text-base font-bold text-title",children:"兑换费用接收地址"}),t.value.receive_pay_info.map((s,r)=>e.jsxs("div",{className:`break-all ${r&&"mt-2"}`,children:[e.jsxs("span",{className:"text-text",children:[s.chain_name,":"]}),e.jsx("span",{className:"ml-1 text-title",children:s.address})]},r))]}),!!t.value.introduce&&e.jsxs("div",{className:"mb-1 rounded-4 bg-white p-4",children:[e.jsx("div",{className:"mb-2 text-base font-bold text-title",children:"信息介绍"}),e.jsx("div",{className:"max-h-60 overflow-scroll break-all text-text",children:t.value.introduce})]}),e.jsxs("div",{className:"mb-1 rounded-4 bg-white p-4",children:[e.jsx("div",{className:"mb-2 text-base font-bold text-title",children:"兑换激励"}),e.jsxs("div",{className:"break-all text-text",children:[e.jsxs("div",{className:"mb-1",children:["1. 用户支付兑换费用成功后，即可获取所兑换资产",t.value.exchange_info.asset_type,"(",t.value.exchange_info.chainName,")，资产直接转入用户链上地址"]}),o(t.value.airdrop_info.withdrawal_asset_type.ratio).gt(0)&&e.jsxs("div",{className:"mb-1",children:["2. 进行总价值为兑换费用",o(t.value.airdrop_info.withdrawal_asset_type.ratio).mul(100).toString(),"% 的BFM(BFMeta)空投，按一定比例给到兑换用户及其上级9层各邀请人，该空投只可提现"]}),t.value.airdrop_info.withdrawal_or_u_asset_type_list.filter(s=>s.enable).map((s,r)=>{const n=o(t.value.airdrop_info.withdrawal_asset_type.ratio).gt(0)?r+3:r+2;return e.jsx("div",{className:"mb-1",children:e.jsx(K,{airInfo:s,showIndex:n,chainName:"BFMeta"})},r)})]})]}),e.jsxs("div",{className:"mb-3 rounded-4 bg-white p-4",children:[e.jsx("div",{className:"mb-2 text-base font-bold text-title",children:"风险提示"}),e.jsxs("div",{className:"max-h-60 overflow-scroll break-all text-text",children:["本平台提供的兑换服务，绝不构成任何形式的投资建议。建议您在参与前，投入足够时间独立、深入地进行研究，了解所兑换资产的信息以及所有潜在风险。",e.jsx("span",{className:"text-title",children:"所有兑换决策均由您独立做出，基于您自己的判断和风险承受能力。"})]})]})]}):e.jsx("div",{className:"mt-4 flex w-full items-center justify-center",children:e.jsx(V,{size:32,color:"black",bgColor:"transparent"})})})}),e.jsx(H,{bottom:!0,style:{"--f7-toolbar-height":"4rem","--f7-bars-bg-color-rgb":"transparent","--f7-bars-border-color":"transparent"},className:"!backdrop-filter-none",children:!!t.value&&e.jsx(J,{exchange:t.value,onConfirmCallback:E,...i})}),e.jsxs("div",{children:[e.jsx(w,{open:x.value,title:"警告",confirmText:"确认",onRequireClose:()=>{x.value=!1},onConfirmCallback:()=>{i.f7router.back(),x.value=!1},children:"获取兑换信息错误"}),e.jsx(w,{open:l.value,title:"警告",confirmText:"确认",onRequireClose:()=>{l.value=!1},onConfirmCallback:()=>{l.value=!1},children:"请输入本次兑换份数"}),e.jsx(I,{open:h.value,title:"兑换确认",confirmText:"兑换",cancelText:"取消",onRequireClose:()=>{h.value=!1},onCancelCallback:()=>{h.value=!1},onConfirmCallback:()=>{S(),h.value=!1},children:e.jsxs("div",{children:[e.jsxs("div",{children:["您将支出：",!!t.value&&e.jsxs("span",{children:[e.jsxs("span",{className:"text-red",children:["-",T(C(String(BigInt(t.value.exchange_info.price2U??"0")*BigInt(f.value)),8,!1))]}),"USDT(",t.value.exchange_info.chainName,")"]})]}),e.jsxs("div",{children:["您将获得：",!!t.value&&e.jsxs("span",{children:[e.jsxs("span",{className:"text-green-500",children:["+",T(C(String(BigInt(t.value.exchange_info.amount)*BigInt(f.value)),8,!1))]}),t.value.exchange_info.asset_type,"(",t.value.exchange_info.chainName,")"]})]})]})})]})]})}),J=({exchange:a,onConfirmCallback:i,safeF7Navigater:m,...h})=>{let x=!1,l="";switch(a.status){case L.enum.chain_error:l="上链失败";break}const t=Date.now();if(a.start_at&&a.start_at<t&&a.end_at&&a.end_at<t&&(l="兑换结束",x=!0),a.start_at&&a.start_at>t){const c=(a.start_at-t)/1e3,g=Math.floor(c/3600),f=Math.floor(c%3600/60),u=Math.floor(c%60);l=`${g}:${f}:${u}`,x=!0}return a.start_at&&a.start_at<=t&&a.end_at&&a.end_at>t&&(l="授权兑换"),e.jsx(B,{raised:!0,textColor:"white",className:"h-12 w-full rounded-full bg-primary px-4 text-base !text-white",preloaderColor:"white",disabled:x,onClick:c=>{i&&i(c)},children:l})},K=({airInfo:a,showIndex:i,chainName:m,...h})=>{switch(a.type){case _.enum.direct_push:return e.jsxs("div",{className:"mb-1",children:[i,". 直推人奖励：空投总价值兑换费用的",o(a.ratio).mul(100).toString(),"% 的",a.assetType,"(",m,")，该空投可提现也可兑换USDT"]});case _.enum.inter_push:return e.jsxs("div",{className:"mb-1",children:[i,". 间推人奖励：空投总价值兑换费用的",o(a.ratio).mul(100).toString(),"% 的",a.assetType,"(",m,")，该空投可提现也可兑换USDT"]});case _.enum.dictyosome:return e.jsxs("div",{className:"mb-1",children:[i,". 进行总价值为兑换费用的",o(a.ratio).mul(100).toString(),"% 的",a.assetType,"(",m,")空投，按一定比例给到兑换用户及其上级",a.count-1,"层各邀请人，该空投可提现也可兑换USDT"]});case _.enum.first_max_level:return e.jsxs("div",{className:"mb-1",children:[i,". 团队长奖励：邀请关系往上找到第一个Lv.9，空投总价值兑换费用的",o(a.ratio).mul(100).toString(),"% 的",a.assetType,"(",m,")，该空投可提现也可兑换USDT"]})}};export{J as ExchangeButton,we as default};
