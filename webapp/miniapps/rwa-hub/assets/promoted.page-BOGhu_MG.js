import{r as p,j as e,f as j}from"./index-AshhoVut.js";import{g as R,a as W}from"./icon.component-Bbnu8uvo.js";import{L as G}from"./loading-page-data-6-Awkqnm.js";import{d as x,z as i,t as v,h as B,b as H}from"./dex-api-WCaY78Dk.js";import{g as J,$ as C,a as X}from"./signature-MTDex1F4.js";import{d as Y,P as I,z as K}from"./page-BnBmgj2e.js";import{f as Q,d as V}from"./noop-ChEnm3CV.js";import{o as A,y as Z,q as ee,t as se,v as ae,x as te,T as re,z as ne,A as ie,B as ce,C as le,D as oe,E as me,F as de,G as U}from"./messages-D1uWWbBR.js";import{u as xe}from"./use_easy_state-BCfQ0rqw.js";import{u as he}from"./use_flow-Buvyb0TW.js";import{B as b}from"./dialog-w37VgwE_.js";import{L as pe}from"./list-item-C_pVthwN.js";import{N as ue}from"./navbar-CWXVbsHK.js";import{B as m}from"./big-Dt19vo1Q.js";import{L as fe}from"./list-DOTUY-rD.js";import{c as ge}from"./dex-paradise.page-711HsBZy.js";import"./preloader-Cr80DtbA.js";import"./bridge-DyWekW1m.js";import"./list-DTz1iW3n.js";import"./nilai-dialog-Dbtzo5f5.js";import"./use_refresh-BXPRqJ_V.js";import"./clipboard-CegwBCT4.js";import"./pull-to-refresh-BEcMoqjd.js";import"./no-data-C6uCQg27.js";import"./setting.page-Cw2AtfIG.js";const We=Y(S=>{const[c]=he(H),[E,P]=p.useState(!0),h=xe({needCount:0,currentCount:0,canUp:!1}),[u,M]=p.useState(null),[y,k]=p.useState({uid:"",superiorId:"",address:"",addressList:[],nickname:"",level:0,createTime:0}),D=(s,a)=>new m(s).div(10**a).toString(),z=c.level>=9,w=async s=>{j.preloader.show();try{const a=await x.user.levelUp.mutate({checkTask:s});if(a){M(a);const r=await x.user.searchUser.query({uid:a.toUid}),d=await x.admin.getPlatformAccount.query();if(r){k(r),console.log(r);const F=new m(a.exchangeConfigSnapshot.usdt2mlb[0]),l=new m(a.exchangeConfigSnapshot.usdt2mlb[1]),f=new m(a.exchangeConfigSnapshot.usdt2dext[0]),T=new m(a.exchangeConfigSnapshot.usdt2dext[1]),o=new m(a.reqExp),n=o.div(F.div(l)),$=o.div(f.div(T)),g=(t,N)=>t.times(10**N).round(0,m.roundUp).toString(),L=[{assetType:"BFM",chainName:i.enum.BFMeta,decimals:8,contractAddress:"",address:r.address,platformAddress:d.BFMeta,amount:g(n,8)},{assetType:"DEXT",chainName:i.enum.BFMeta,decimals:8,contractAddress:"",address:r.address,platformAddress:d.BFMeta,amount:g($,8)},{assetType:"USDT",chainName:i.enum.BFMeta,decimals:8,contractAddress:"",address:r.address,platformAddress:d.BFMeta,amount:g(o,8)}],O=new Set(c.addressList.map(t=>t.chainName));r.addressList.forEach(t=>{if(O.has(t.chainName)&&(t.chainName===i.enum.Tron||t.chainName===i.enum.Ethereum||t.chainName===i.enum.Binance)){const N=t.chainName===i.enum.Binance?18:6;L.push({assetType:"USDT",chainName:t.chainName,decimals:N,contractAddress:ge[t.chainName],address:t.address,platformAddress:d[t.chainName],amount:g(o,N)})}}),_.current=L}}}finally{j.preloader.hide()}},_=p.useRef([]);p.useEffect(()=>{(async()=>{try{await x.admin.getAirdropConfig.query();const a=await x.user.getUserLevelUpCondition.query();h.value=a,a.canUp&&await w(!0)}finally{P(!1)}})()},[]);const q=async s=>{const a=c.addressList.find(n=>n.chainName===s.chainName);if(!a){v(de()),console.warn(s,c.addressList);return}const r={type:C.transfer,chainName:s.chainName,senderAddress:a.address,receiveAddress:s.platformAddress,assetType:s.assetType,balance:s.amount,contractInfo:s.contractAddress?{contractAddress:s.contractAddress,assetType:s.assetType,decimals:s.decimals}:void 0},d={type:C.json,chainName:i.enum.BFMeta,senderAddress:a.address,json:{toAddress:s.address,fromAddress:a.address,amount:s.amount,timestamp:Date.now(),trsInfo:{chain:B[s.chainName],info:s.chainName===i.enum.BFMeta?{assetType:s.assetType}:{contractAddress:s.contractAddress}}},jsonInterpolation:[{path:"trsInfo.info.trs",index:0}]},l=await(await J(V.BFMPay().mmid,X.signature,[r,d])).getData();if(!l){v(U());return}let f="";if(l.find(n=>n?typeof n!="string"&&"error"in n&&n.error?(typeof n.message=="string"&&(f=n.message),!0):!1:!0)){v(f||U());return}const o={toAddress:s.address,fromAddress:a.address,amount:s.amount,timestamp:Date.now(),trsInfo:{chain:B[s.chainName],info:s.chainName===i.enum.BFMeta?{assetType:s.assetType,trs:l[0].transaction}:{contractAddress:s.contractAddress,trs:l[0].transaction}},trsId:l[0].txId};console.log(o),Q(),j.preloader.show();try{await x.user.levelUpBroadcast.mutate({tid:u.tid,trs:[o],chainName:s.chainName,assetType:s.assetType,amount:s.amount}),v(me()),await w(!1)}finally{j.preloader.hide()}};return e.jsxs(I,{name:"promoted",children:[e.jsx(ue,{title:A(),backLink:!0}),e.jsx("div",{className:"bg-gray min-h-full w-full",children:K(E).with(!0,()=>e.jsx(G,{color:"black",size:38,className:"mt-20"})).otherwise(()=>e.jsxs(e.Fragment,{children:[z?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"./images/paradise/level_9.svg",className:"mx-auto h-auto w-24 pt-20",alt:""}),e.jsx("div",{className:"pt-5 text-center text-base font-bold text-title",children:Z()})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-1 flex items-center justify-around px-5 pt-10",children:[e.jsxs("div",{className:"rounded-3 text-center",children:[e.jsx("img",{src:`./images/paradise/level_${c.level}.svg`,className:"mx-auto h-auto w-16",alt:""}),e.jsx("div",{className:"mt-2 text-base font-bold text-title",children:ee()})]}),e.jsx("img",{src:"./images/paradise/arrow.webp",className:"my-5 h-auto w-6 -rotate-90",alt:"arrow"}),e.jsxs("div",{className:"rounded-3 text-center",children:[e.jsx("img",{src:`./images/paradise/level_${c.level+1}.svg`,className:"mx-auto h-auto w-16",alt:""}),e.jsx("div",{className:"mt-2 text-base font-bold text-title",children:se()})]})]}),e.jsx("p",{className:"text-center font-bold text-title",children:"晋级成功后，您将获得一定数量的空投奖励"}),e.jsxs("p",{className:"mb-4 text-center text-sm font-bold text-title",children:["(",ae(),")"]}),u?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mx-5 rounded-3 bg-white p-5",children:[e.jsxs("div",{className:"mb-2 text-base font-bold text-title",children:[te(),"："]}),e.jsxs("div",{className:"mb-3 flex items-center",children:[e.jsx("img",{src:"./images/paradise/home-user-tx.webp",className:"mr-2 h-10 w-10",alt:""}),e.jsxs("div",{className:"items-center",children:[e.jsx("img",{src:`./images/paradise/level_${y.level}.svg`,className:"mr-1 h-auto w-8",alt:""}),e.jsx("div",{className:"w-full text-base",children:y.nickname})]})]}),u.logs.length?e.jsx(e.Fragment,{children:u.logs.map((s,a)=>e.jsx("div",{className:"mb-2 rounded-3 bg-[#E7E3D7] p-2 text-center font-bold",children:s.text},a))}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-red-500",children:re()}),e.jsx("div",{className:"text-golden-text text-base",children:ne()}),e.jsx(fe,{className:"m-0 mt-2",children:_.current.map((s,a)=>e.jsx(pe,{className:"mb-3 rounded-2",style:{background:"linear-gradient(90deg, #F6F7FC 0%, #F6F7FC 99%)",boxShadow:"0px 4px 8px 0px #F6F7FC,0px 1px 1px 0px #F6F7FC"},children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{children:[e.jsx("div",{className:"flex w-full items-center justify-between p-1",children:e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:R(s.assetType,s.chainName),alt:"",className:"h-9 w-9"}),e.jsx("img",{src:W(s.chainName),alt:"",className:"absolute -bottom-1 -right-0.5 h-5 w-5"})]}),e.jsx("div",{className:"ml-2",children:e.jsxs("div",{className:"mt-2 text-xs text-title",children:[e.jsx("div",{className:"text-xs text-text",children:s.chainName}),e.jsxs("div",{className:"flex items-center",children:[ie()," ",e.jsxs("div",{children:[e.jsx("span",{className:"text-red-600 mr-0.5 text-sm font-bold",children:D(s.amount,s.decimals)}),s.assetType]})]})]})})]})}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"text-xs text-text",children:[ce(),":"]}),e.jsx("div",{className:"text-xs text-text",children:s.platformAddress})]}),e.jsx(b,{className:"bg-primary/80 px-4 text-white",onClick:()=>q(s),children:le()})]})})},a))})]})]})}):e.jsxs("div",{children:[!h.value.canUp&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("img",{src:"./images/paradise/close.svg",alt:"",className:"inline-block h-auto w-6"}),e.jsx("span",{children:"您的邀请层级对应达标人数不足"})]}),e.jsx("div",{className:"text-green-500 mt-2 text-center",children:"最低有效邀请的用户等级"}),e.jsx("img",{src:"./images/paradise/level_1.svg",alt:"",className:"mx-auto h-auto w-16"}),e.jsx("div",{className:"mx-5 mb-3 mt-2",children:e.jsxs("div",{className:"rounded-3 bg-[#321d00] py-4 text-white",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between text-center text-sm",children:[e.jsx("div",{className:"w-1/2",children:"邀请层级"}),e.jsx("div",{className:"flex w-1/2 items-center justify-center",children:"人数"})]}),e.jsx("div",{className:"mb-4 rounded-2 bg-[#321d00] text-sm text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-1/2",children:e.jsx("img",{alt:"",className:"m-auto h-auto w-14",src:`./images/paradise/l${c.level}.png`})}),e.jsxs("div",{className:"w-1/2 text-center",children:[e.jsx("span",{className:"text-green-500",children:h.value.currentCount})," /"," ",e.jsx("span",{children:h.value.needCount})]})]})})]})})]}),e.jsx(b,{disabled:!h.value.canUp,className:"mx-5 bg-primary py-5 text-lg text-white",onClick:()=>w(!1),children:A()})]})]}),e.jsx(b,{className:"mx-5 mb-5 mt-5 border-grey bg-text py-5 text-lg text-white",onClick:()=>{S.safeF7Navigater.promotedList()},children:oe()})]}))})]})});export{We as default};
