import{a2 as h,B as g}from"./page-C3-Jo2og.js";import{_ as f}from"./index-CQoRotV0.js";const u=a=>typeof a.default=="object"?a.default:JSON.parse(a.default),d=async()=>{const a=await f(()=>import("./ccchain-genesisBlock.prod-ho0gY3uq.js"),[]);return u(a)},y=await d(),c=58,k=(()=>{const a={timestamp:0,count:0};return e=>(e!==a.timestamp?(a.timestamp=e,a.count=0):a.count--,Number(BigInt(a.timestamp)+BigInt(a.count)))})();class _ extends h{constructor(e,t,r,s,i){super(),this._bundleCore=e,this._isProd=t,this._i18n=r,this.walletUrl=s,this.browserUrl=i,this.getBlockInfo_task={hasRunning:!1,task:Promise.withResolvers()},this.broadcastTransaction=async l=>{try{return await this.SERVER_API.broadcastTransaction(l)}catch(n){if(typeof n=="string")throw n;const o=n;throw o.message?o.message:o.error?o.error.message||o.error:n}}}get genesitBlockAsset(){return y}get genesitBlockConfig(){return this.genesitBlockAsset.asset.genesisAsset}get signUtil(){return this._bundleCore.bioforestChainSignUtil}isAddress(e){return this._bundleCore.bioforestChainSignUtil.isAddress(e)}async checkSecondSecret(e,t,r){return await this._bundleCore.bioforestChainSignUtil.checkSecondSecretV2(e,t,r)||await this._bundleCore.bioforestChainSignUtil.checkSecondSecret(e,t,r)}createKeypair(e){return this._bundleCore.bioforestChainSignUtil.createKeypair(e)}async getAddressByMainSecret(e){const{publicKey:t}=await this.createKeypair(e);return this.getAddressByPublicKeyString(t.toString("hex"))}getAddressByPublicKeyString(e){return this._bundleCore.bioforestChainSignUtil.getAddressFromPublicKeyString(e)}getAddressByPrivateKeyString(e){const t=this._bundleCore.bioforestChainSignUtil.createKeypairBySecretKeyString(e);return this._bundleCore.bioforestChainSignUtil.getAddressFromPublicKey(t.publicKey)}async getTransactionInBlockById(e,t){t||(t=(await this.getBlockInfo()).height);const{trs:r}=await this.SERVER_API.getTransactionInBlockById(e,t);return r&&r[0]}async getBlockInfo(e){if(e){const{blocks:t}=await this.SERVER_API.queryBlock(e);if(t.length===0)throw new Error(this._i18n.$chain$_failed_to_query_block_with_height_of_$height$({chain:g.CCChain,height:e}));return t[0]}try{if(this.getBlockInfo_task.hasRunning)return this.getBlockInfo_task.task.promise;this.getBlockInfo_task.hasRunning=!0,this.getBlockInfo_task.task=Promise.withResolvers();const t=await this.SERVER_API.getLastBlock();return this.getBlockInfo_task.task.resolve(t),t}catch(t){throw this.getBlockInfo_task.task.reject(t),t}finally{this.getBlockInfo_task.hasRunning=!1}}async getAddressAsset(e,t){const r=await this.SERVER_API.getAddressAsset(e,t);return r?(r.assets||{})[this.genesitBlockConfig.magic]||{}:{}}async getAddressSecondPublicKey(e){const t=await this.SERVER_API.getAddressInfo(e);if(t)return t.secondPublicKey||void 0}async getCreateTransactionBlockInfo(){const e=await this.getBlockInfo();return{applyBlockHeight:e.height,timestamp:k(e.timestamp)}}async createEntityTransaction(e,t){const{fee:r,applyBlockHeight:s,timestamp:i}=await this.getCreateEntityTransactionMinFee(e,t);return e.fee||(e.fee=r),this._bundleCore.bioforestChain.transactionController.createEntityTransferTransactionJSON({secrets:{mainSecret:e.mainSecret,paySecret:e.paySecret},transaction:{fee:e.fee,recipientId:e.receiveAddress,applyBlockHeight:s,timestamp:i,remark:e.remark??void 0,effectiveBlockHeight:s+c},assetInfo:{assetType:e.entityId,amount:"1",taxInformation:{taxCollector:e.entityFeeReceiveAddress,taxAssetPrealnum:e.entityFee}}})}async getCreateEntityTransactionMinFee(e,t){const{applyBlockHeight:r,timestamp:s}=t||await this.getCreateTransactionBlockInfo();return{fee:await this._bundleCore.bioforestChain.transactionController.createEntityTransferTransactionMinFee({applyBlockHeight:r,timestamp:s,remark:e.remark,effectiveBlockHeight:r+c},{assetType:e.entityId,amount:"1",taxInformation:{taxCollector:e.entityFeeReceiveAddress,taxAssetPrealnum:e.entityFee}}),applyBlockHeight:r,timestamp:s}}async getTransferTransaction(e,t){const{fee:r,applyBlockHeight:s,timestamp:i}=await this.getTransferTransactionMinFee(e,t);return e.fee||(e.fee=r),this._bundleCore.bioforestChain.transactionController.createTransferTransactionJSON({secrets:{mainSecret:e.mainSecret,paySecret:e.paySecret},transaction:{fee:e.fee,recipientId:e.receiveAddress,applyBlockHeight:s,timestamp:i,remark:e.remark??void 0,effectiveBlockHeight:s+c},assetInfo:{sourceChainName:this.genesitBlockConfig.chainName,sourceChainMagic:this.genesitBlockConfig.magic,assetType:e.assetType,amount:e.amount}})}async getTransferTransactionMinFee(e,t){const{applyBlockHeight:r,timestamp:s}=t||await this.getCreateTransactionBlockInfo();return{fee:await this._bundleCore.bioforestChain.transactionController.getTransferTransactionMinFee({transaction:{applyBlockHeight:r,timestamp:s},assetInfo:{sourceChainName:this.genesitBlockConfig.chainName,sourceChainMagic:this.genesitBlockConfig.magic,assetType:e.assetType,amount:e.amount}}),applyBlockHeight:r,timestamp:s}}}export{_ as CCChainController,y as PROD_GENESIS_BLOCK_ASSET};
