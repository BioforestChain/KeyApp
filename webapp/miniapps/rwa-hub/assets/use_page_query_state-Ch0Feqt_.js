import{j as f,f as A,r as d}from"./index-CQoRotV0.js";import{O as k}from"./page-C3-Jo2og.js";const O=(c,n,i)=>r=>{if(c){const o=i==null?null:r.error?.(i);if(r.listItem)if(Array.isArray(n)&&n.length>0){const s=n.map(r.listItem);return o?f.jsxs(f.Fragment,{children:[s,o]}):s}else return o||r.listEmpty?.();else if(r.content){const s=r.content(n);return o?f.jsxs(f.Fragment,{children:[s,o]}):s}}else return r.loading?.()},T=c=>n=>{const i=A.ptr.get(n.$pageEl.find(".ptr-content"));i?i.refresh():c()},C=(c,n,i)=>{const[r,o]=d.useState(null),[s,p]=d.useState(c),[u,m]=d.useState(n),[P,x]=d.useState(!1),[t,j]=d.useState(null);d.useEffect(()=>{if(t){const e=new AbortController;return(async()=>{try{const l=k(e.signal,t.signal);l.addEventListener("abort",()=>{t.job.reject(r)});let a;if(t.mode==="first")a=await i(c,n,{signal:l});else if(t.mode==="next")a=await i(s,u,{signal:l});else throw new Error("invalid load mode: "+t.mode);p(a.content),m(a.nextPage),x(a.end),o(null),t.job.resolve(),console.log("loading success")}catch(l){t.job.reject(l),o({page:u,error:l}),console.log("loading error")}finally{j(null),console.log("loading done")}})(),()=>e.abort("cancel")}},[t]);const b=(e,l)=>{if(t==null){const a=Promise.withResolvers();return j({...l,mode:e,job:a}),a.promise}return t.job.promise},y=e=>b("next",e),g=e=>b("first",e),h=t?.mode==="first",E=t?.mode==="next",N=t!==null,w=u!==n||r!==null,I=e=>{g().finally(e)},S=e=>{y().finally(e)},v={ptr:!0,ptrMousewheel:!0,ptrPreloader:h,onPtrRefresh:I},F={infiniteDistance:180,infinite:!P,infinitePreloader:E,onInfinite:S},L=T(g),R={onPageInit:L,...v,...F};return{get content(){return s},set content(e){p(e)},get page(){return u},set page(e){m(e)},get end(){return P},set end(e){x(e)},get error(){return r},set error(e){o(e)},loadFirst:g,loadNext:y,isLoadingFirst:h,isLoadingNext:E,isLoading:N,isReady:w,onPtrRefresh:I,onInfinite:S,render:O(w,s,r),f7OnPageInit:L,f7PagePtrProps:v,f7PageInfiniteProps:F,f7PageProps:R}};export{C as u};
