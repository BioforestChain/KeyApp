# 订阅系统

## 概述

订阅系统允许用户添加多个小程序源，将不同来源的小程序聚合展示在"生态"页面。

## 订阅源格式

```typescript
interface EcosystemSource {
  name: string           // 源名称
  version: string        // 版本
  updated: string        // 更新时间 (ISO 8601)
  apps: MiniappManifest[]
}

interface MiniappManifest {
  id: string             // 唯一标识
  name: string           // 显示名称
  description: string    // 描述
  icon: string           // 图标 URL
  url: string            // 入口 URL
  version: string        // 版本
  author?: string        // 作者
  permissions?: string[] // 需要的权限
  chains?: string[]      // 支持的链
}
```

## 示例

```json
{
  "name": "Bio 官方生态",
  "version": "1.0.0",
  "updated": "2024-12-27",
  "apps": [
    {
      "id": "teleport",
      "name": "一键传送",
      "description": "跨钱包资产转移",
      "icon": "/miniapps/teleport/icon.svg",
      "url": "/miniapps/teleport/",
      "version": "0.1.0",
      "permissions": ["bio_requestAccounts", "bio_signMessage"],
      "chains": ["bfmeta", "bfchainv2"]
    }
  ]
}
```

## 可信源管理

### 添加订阅

1. 打开设置 → 小程序可信源
2. 输入订阅 URL
3. 确认添加

### 订阅验证

- 检查 HTTPS
- 验证 JSON 格式
- 检查必要字段

### 安全考虑

- 只允许 HTTPS 源（本地开发除外）
- 显示源来源标识
- 用户需确认权限

## 存储结构

```typescript
interface EcosystemStore {
  sources: {
    url: string          // 订阅 URL
    name: string         // 源名称
    lastUpdated: string  // 最后更新时间
    enabled: boolean     // 是否启用
  }[]
  permissions: {
    appId: string        // 小程序 ID
    granted: string[]    // 已授权的权限
  }[]
}
```

## API

```typescript
// 加载订阅源
async function loadSource(url: string): Promise<EcosystemSource>

// 刷新所有源
async function refreshSources(): Promise<void>

// 获取所有小程序
function getAllApps(): MiniappManifest[]

// 检查权限
function hasPermission(appId: string, permission: string): boolean

// 授予权限
function grantPermissions(appId: string, permissions: string[]): void
```
