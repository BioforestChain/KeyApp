# 实现状态

## 已完成

### Phase 1: 基础设施 ✅

| 组件 | 路径 | 状态 |
|------|------|------|
| Monorepo 配置 | `pnpm-workspace.yaml` | ✅ 完成 |
| Bio SDK 包 | `packages/bio-sdk/` | ✅ 完成 |
| 一键传送小程序 | `miniapps/teleport/` | ✅ 完成 |
| 锻造小程序 | `miniapps/forge/` | ✅ 完成 |
| 订阅源配置 | `public/ecosystem.json` | ✅ 完成 |

### Phase 2: Host Provider ✅

| 组件 | 路径 | 状态 |
|------|------|------|
| 类型定义 | `src/services/ecosystem/types.ts` | ✅ 完成 |
| PostMessage Bridge | `src/services/ecosystem/bridge.ts` | ✅ 完成 |
| Wallet Handlers | `src/services/ecosystem/handlers/wallet.ts` | ✅ 完成 |
| Signing Handlers | `src/services/ecosystem/handlers/signing.ts` | ✅ 完成 |
| Transfer Handlers | `src/services/ecosystem/handlers/transfer.ts` | ✅ 完成 |
| Registry | `src/services/ecosystem/registry.ts` | ✅ 完成 |
| Provider Entry | `src/services/ecosystem/provider.ts` | ✅ 完成 |

### Phase 3: UI 集成 ✅

| 组件 | 路径 | 状态 |
|------|------|------|
| EcosystemTab | `src/stackflow/activities/tabs/EcosystemTab.tsx` | ✅ 完成 |
| MiniappActivity | `src/stackflow/activities/MiniappActivity.tsx` | ✅ 完成 |
| MiniappPage | `src/pages/ecosystem/miniapp.tsx` | ✅ 完成 |
| TabBar 更新 | `src/stackflow/components/TabBar.tsx` | ✅ 完成 |
| 路由注册 | `src/stackflow/stackflow.ts` | ✅ 完成 |

### 测试 ✅

| 测试文件 | 覆盖内容 |
|----------|----------|
| `types.test.ts` | 错误码、响应构造函数 |
| `bridge.test.ts` | Handler 注册、iframe 绑定、事件发送 |
| `registry.test.ts` | 源管理、刷新、应用查询 |

### Phase 4: UI 对话框 ✅

| 组件 | 路径 | 状态 |
|------|------|------|
| AccountPickerJob | `src/stackflow/activities/sheets/AccountPickerJob.tsx` | ✅ 完成 |
| SigningConfirmJob | `src/stackflow/activities/sheets/SigningConfirmJob.tsx` | ✅ 完成 |
| PermissionRequestJob | `src/stackflow/activities/sheets/PermissionRequestJob.tsx` | ✅ 完成 |
| MiniappPage 回调注册 | `src/pages/ecosystem/miniapp.tsx` | ✅ 完成 |

### Phase 5: 权限与架构 ✅

| 组件 | 路径 | 状态 |
|------|------|------|
| EcosystemStore | `src/stores/ecosystem.ts` | ✅ 完成 |
| 权限控制模块 | `src/services/ecosystem/permissions.ts` | ✅ 完成 |
| Bridge 权限检查 | `src/services/ecosystem/bridge.ts` | ✅ 完成 |
| HandlerContext | `src/services/ecosystem/handlers/context.ts` | ✅ 完成 |
| Handler 重构 | `src/services/ecosystem/handlers/*.ts` | ✅ 完成 |

### Phase 6: 功能完善 ✅

| 组件 | 路径 | 状态 |
|------|------|------|
| MiniappTransferConfirmJob | `src/stackflow/activities/sheets/MiniappTransferConfirmJob.tsx` | ✅ 完成 |
| SettingsSourcesActivity | `src/stackflow/activities/SettingsSourcesActivity.tsx` | ✅ 完成 |
| 设置页入口 | `src/pages/settings/index.tsx` | ✅ 完成 |

## 待完成

### Phase 7: 后续优化

- [ ] 实际签名服务集成（需要钱包解锁流程）
- [ ] 实际转账服务集成
- [ ] 订阅系统 v2：本地缓存（IndexedDB + ETag）
- [ ] 订阅系统 v2：评分模型（official/community/featured）+ 部分列出策略
- [ ] 订阅系统 v2：搜索接口（订阅列表以外的应用）
- [ ] 交易流水线：createTransaction + signTransaction（不可省略）
- [ ] AppId 命名规范（反向域名）校验与迁移策略
- [ ] 自维护导航同步插件：`packages/plugin-navigation-sync`（URLPattern polyfill）

### Phase 8: 小程序完善

- [ ] 一键传送后端 API 集成
- [ ] 锻造后端 API 集成
- [ ] E2E 测试

### Phase 9: DWEB 集成

- [ ] Transport 抽象层
- [ ] DWEB 适配器

## 构建命令

```bash
# SDK
pnpm sdk:build           # 构建 SDK
pnpm sdk:dev             # 监听模式

# 小程序
pnpm miniapps:build      # 构建所有小程序
pnpm miniapps:dev:teleport   # 开发一键传送
pnpm miniapps:dev:forge      # 开发锻造

# 测试
pnpm test -- --testPathPattern=ecosystem
```

## 目录结构

```
packages/
└── bio-sdk/                 # @biochain/bio-sdk
    ├── src/
    │   ├── index.ts         # 入口，注入 window.bio
    │   ├── types.ts         # 类型定义
    │   ├── provider.ts      # BioProvider 实现
    │   └── events.ts        # 事件发射器
    └── dist/                # 构建输出

miniapps/
├── teleport/                # 一键传送
└── forge/                   # 锻造

src/services/ecosystem/
├── types.ts                 # Host 端类型
├── bridge.ts                # PostMessage 通信
├── provider.ts              # Provider 初始化
├── registry.ts              # 小程序注册表
├── handlers/
│   ├── wallet.ts            # 钱包方法
│   ├── signing.ts           # 签名方法
│   └── transfer.ts          # 转账方法
└── __tests__/               # 单元测试
```
