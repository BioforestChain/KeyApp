# 第七章：技术选型

> 定义技术栈及选型理由

---

## 7.1 技术栈总览

| 领域 | 技术 | 版本 | 说明 |
|-----|------|------|------|
| **框架** | React | 19.x | UI 框架 |
| **构建** | Vite | 7.x | 现代构建工具 |
| **语言** | TypeScript | 5.x | 类型安全 |
| **导航** | Stackflow | 1.x | 栈式导航 |
| **服务端状态** | TanStack Query | 5.x | 异步数据管理 |
| **客户端状态** | TanStack Store | 0.x | 响应式状态 |
| **表单** | TanStack Form | 1.x | 类型安全表单 |
| **UI 组件** | shadcn/ui | latest | 可定制组件库 |
| **样式** | Tailwind CSS | 4.x | CSS-first 配置 |
| **验证** | Zod | 4.x | 类型安全验证 |
| **组件文档** | Storybook | 10.x | 组件开发与文档 |
| **单元测试** | Vitest | 4.x | 快速测试框架 |
| **E2E 测试** | Playwright | 1.x | 端到端测试 |
| **国际化** | i18next | 25.x | 多语言支持 |
| **加密** | @noble/* | 2.x | 密码学库 |

---

## 7.2 框架选型

### React 19

**选择理由**：
- ✅ 最大的生态系统和社区支持
- ✅ 函数组件 + Hooks 模式成熟
- ✅ 与 TanStack 全家桶完美配合
- ✅ 团队熟悉度高

**对比 mpay (Angular)**：
| 方面 | Angular | React |
|-----|---------|-------|
| 学习曲线 | 陡峭 | 平缓 |
| 包体积 | 较大 | 较小 |
| 生态系统 | 中等 | 最大 |
| 灵活性 | 受限 | 高 |

### Vite 7

**选择理由**：
- ✅ 极快的开发服务器启动
- ✅ 原生 ESM 支持
- ✅ 内置 TypeScript 支持
- ✅ 简洁的配置

**对比其他构建工具**：
| 工具 | 冷启动 | HMR | 配置复杂度 |
|-----|-------|-----|----------|
| Vite | ~300ms | ~50ms | 低 |
| Webpack | ~10s | ~500ms | 高 |
| Parcel | ~3s | ~200ms | 低 |

---

## 7.3 状态管理选型

### TanStack 全家桶

**选择理由**：
- ✅ 统一的 API 心智模型
- ✅ 类型安全，TypeScript 优先
- ✅ 功能完备，覆盖所有状态场景
- ✅ 活跃维护，持续更新

**三层状态分离**：

```
┌─────────────────────────────────────────┐
│           TanStack Form                 │  ← 表单状态
│         (短期、临时、可重置)             │
├─────────────────────────────────────────┤
│           TanStack Query                │  ← 服务端状态
│       (缓存、同步、后台刷新)             │
├─────────────────────────────────────────┤
│           TanStack Store                │  ← 客户端状态
│       (持久化、跨组件、响应式)           │
└─────────────────────────────────────────┘
```

### 对比其他方案

| 方案 | 优点 | 缺点 |
|-----|------|------|
| Redux | 成熟、生态大 | 样板代码多、学习曲线陡 |
| Zustand | 简单、轻量 | 功能较少、缺乏类型推断 |
| Jotai | 原子化、灵活 | 心智模型新、生态小 |
| MobX | 响应式、直观 | 隐式依赖、调试困难 |
| **TanStack** | **类型安全、功能全** | 需要学习多个库 |

---

## 7.4 导航选型

### Stackflow

**选择理由**：
- ✅ 栈式导航，原生 App 体验
- ✅ Activity 模式，清晰的参数传递
- ✅ 支持 URL 同步 (hash/history)
- ✅ 手势返回支持

**对比 TanStack Router**：
| 方面 | TanStack Router | Stackflow |
|-----|-----------------|-----------|
| 模型 | 声明式路由 | 栈式导航 |
| 适用场景 | Web 应用 | 移动优先 |
| 动画支持 | 需配置 | 内置 |
| URL 同步 | 原生支持 | 插件支持 |

**选择 Stackflow 的原因**：
BFM Pay 是移动优先的应用，栈式导航更符合用户对移动 App 的心智模型。

---

## 7.5 UI 组件选型

### shadcn/ui

**选择理由**：
- ✅ 不是组件库，是组件集合（可定制）
- ✅ 基于 Radix UI，无障碍支持好
- ✅ 与 Tailwind CSS 完美配合
- ✅ 复制到项目中，完全掌控

**对比其他方案**：
| 方案 | 优点 | 缺点 |
|-----|------|------|
| Ant Design | 功能丰富 | 体积大、定制困难 |
| MUI | 美观、完整 | 体积大、样式覆盖难 |
| Chakra UI | 简洁、易用 | 性能一般 |
| **shadcn/ui** | **可定制、轻量** | 需要自己组合 |

### Tailwind CSS 4.x

**选择理由**：
- ✅ CSS-first 配置，无需 JS 配置文件
- ✅ 内置容器查询支持
- ✅ 构建时优化，产物极小
- ✅ 与 shadcn/ui 完美配合

**4.x 新特性**：
```css
/* CSS-first 配置 */
@import "tailwindcss";

@theme {
  --color-primary: oklch(0.6 0.13 163);
  --container-xs: 20rem;
}
```

---

## 7.6 测试选型

### Vitest + Storybook

**单元/组件测试**：
- Vitest 4.x：快速、兼容 Jest API
- @testing-library/react：组件测试
- Storybook 10.x：组件文档 + 交互测试

**E2E 测试**：
- Playwright 1.x：跨浏览器、稳定

**测试分层**：
```
┌─────────────────────────────────────────┐
│              E2E (Playwright)           │  ← 完整用户流程
├─────────────────────────────────────────┤
│         组件测试 (Storybook)            │  ← 组件交互
├─────────────────────────────────────────┤
│          单元测试 (Vitest)              │  ← 业务逻辑
└─────────────────────────────────────────┘
```

---

## 7.7 加密库选型

### @noble 系列

**选择理由**：
- ✅ 纯 JavaScript，无原生依赖
- ✅ 审计过的安全实现
- ✅ 类型完善
- ✅ 体积小

**使用的库**：
| 库 | 用途 |
|---|------|
| @noble/hashes | SHA256, RIPEMD160 等哈希 |
| @noble/curves | secp256k1, ed25519 签名 |
| @scure/bip32 | HD 密钥派生 |
| @scure/bip39 | 助记词生成/验证 |

---

## 7.8 国际化选型

### i18next

**选择理由**：
- ✅ 功能最完善的 i18n 库
- ✅ React 集成成熟
- ✅ 支持动态加载语言包
- ✅ 支持 RTL 语言

**配套库**：
- react-i18next：React 绑定
- i18next-browser-languagedetector：语言检测
- i18next-http-backend：动态加载

---

## 7.9 版本策略

### 依赖更新原则

| 类型 | 更新频率 | 策略 |
|-----|---------|------|
| 安全补丁 | 立即 | 自动合并 |
| 小版本 | 每周 | 审查后合并 |
| 大版本 | 评估后 | 计划升级 |

### 版本锁定

使用 `pnpm-lock.yaml` 锁定依赖版本，确保构建可复现。

---

## 本章小结

- React 19 + Vite 7 提供现代开发体验
- TanStack 全家桶统一状态管理
- Stackflow 提供原生移动体验
- shadcn/ui + Tailwind CSS 4 实现可定制 UI
- Vitest + Storybook + Playwright 覆盖测试
- @noble 系列保证加密安全
- i18next 实现国际化

---

## 下一章

继续阅读 [第八章：系统架构](../02-系统架构/)，了解分层架构设计。
